var w=window;var ui=w["ui"];var Laya=w["Laya"];var laya=w["laya"];var JSZip=w["JSZip"];var GameWXmini=w["GameWXmini"];var isometric=w["isometric"];var scene=w["scene"];var items=w["items"];var role=w["role"];var app=w["app"];var common=w["common"];var avatar=w["avatar"];var list=w["list"];var game=w["game"];var gm=w["gm"];var grids=w["grids"];var main=w["main"];var pet=w["pet"];var shop=w["shop"];var activitytaren=w["activitytaren"];var ai=w["ai"];var bag=w["bag"];var battle=w["battle"];var boss=w["boss"];var chat=w["chat"];var dailytask=w["dailytask"];var danfang=w["danfang"];var dianfenceshi=w["dianfenceshi"];var equip=w["equip"];var friend=w["friend"];var garden=w["garden"];var guaji=w["guaji"];var guild=w["guild"];var synthesis=w["synthesis"];var hulupick=w["hulupick"];var csv=w["csv"];var mjhole=w["mjhole"];var mount=w["mount"];var pedlar=w["pedlar"];var rank=w["rank"];var skill=w["skill"];var sixBox=w["sixBox"];var soul=w["soul"];var talk=w["talk"];var task=w["task"];var team=w["team"];var tip=w["tip"];var touzilic=w["touzilic"];var xinfa=w["xinfa"];var yuanshencode=w["yuanshencode"];var ent=w["ent"];var manager=w["manager"];var gamesdk=w["gamesdk"];var util=w["util"];var cfgCls=w["cfgCls"];var fc=w["fc"];var bc=w["bc"];var component=w["component"];var actdenglu=w["actdenglu"];var actHuntRich=w["actHuntRich"];var sevendaysign=w["sevendaysign"];var actSignIn=w["actSignIn"];var aniSoul=w["aniSoul"];var weapons=w["weapons"];var chart=w["chart"];var chengzhanjijing=w["chengzhanjijing"];var chouka=w["chouka"];var copy=w["copy"];var rebirth=w["rebirth"];var fabaonew=w["fabaonew"];var fatepool=w["fatepool"];var forum=w["forum"];var fulicode=w["fulicode"];var gaiming=w["gaiming"];var goddungeon=w["goddungeon"];var guajiexp=w["guajiexp"];var guardisland=w["guardisland"];var guide=w["guide"];var guildboss=w["guildboss"];var huodong=w["huodong"];var amulet=w["amulet"];var jihuoma=w["jihuoma"];var jinjiericode=w["jinjiericode"];var jjcnew=w["jjcnew"];var kaifuchongban=w["kaifuchongban"];var leijichongzhi=w["leijichongzhi"];var leijixiaofei=w["leijixiaofei"];var levelpackage=w["levelpackage"];var lianpenglianziCode=w["lianpenglianziCode"];var achievement=w["achievement"];var limitgiftbag=w["limitgiftbag"];var limitshop=w["limitshop"];var limittimegift=w["limittimegift"];var login=w["login"];var onlineActivity=w["onlineActivity"];var sevenday=w["sevenday"];var upgrade=w["upgrade"];var mall=w["mall"];var medal=w["medal"];var meirichongzhi=w["meirichongzhi"];var meiritehui=w["meiritehui"];var book=w["book"];var monthCard=w["monthCard"];var mountain=w["mountain"];var newshangcheng=w["newshangcheng"];var pedlarnew=w["pedlarnew"];var qiYu=w["qiYu"];var question=w["question"];var renyichongzhi=w["renyichongzhi"];var xiulian=w["xiulian"];var sevenSoul=w["sevenSoul"];var share=w["share"];var shouchonghaoli=w["shouchonghaoli"];var guard=w["guard"];var shoujibanding=w["shoujibanding"];var skin=w["skin"];var social=w["social"];var talent=w["talent"];var styles=w["styles"];var title=w["title"];var tongtiange=w["tongtiange"];var tower=w["tower"];var treasure=w["treasure"];var verifiedcode=w["verifiedcode"];var vipcode=w["vipcode"];var waixiantegou=w["waixiantegou"];var xianshimiaosha=w["xianshimiaosha"];var xianyaodingzhi=w["xianyaodingzhi"];var xsqg=w["xsqg"];var yaowangfight=w["yaowangfight"];var yishou=w["yishou"];var zeroshopping=w["zeroshopping"];var zhanlin=w["zhanlin"];var zhanqi=w["zhanqi"];var zhenjiuqiwa=w["zhenjiuqiwa"];var zhuanpan=w["zhuanpan"];var ByteUtil=w["ByteUtil"];var Point2D=w["Point2D"];var RoleHpView=w["RoleHpView"];var CombatInfo=w["CombatInfo"];var CommonInfo=w["CommonInfo"];var UserViewData=w["UserViewData"];var ElementPropInf=w["ElementPropInf"];var ObjViewData=w["ObjViewData"];var PropValue=w["PropValue"];var RoleView=w["RoleView"];var RoleScore=w["RoleScore"];var ItemData=w["ItemData"];var ItemCost=w["ItemCost"];var ResourceData=w["ResourceData"];var PropRand=w["PropRand"];var GemData=w["GemData"];var ItemInfoData=w["ItemInfoData"];var EquipStrenData=w["EquipStrenData"];var TaskRd=w["TaskRd"];var TaskData=w["TaskData"];var TaskRecord=w["TaskRecord"];var TaskDailyInf=w["TaskDailyInf"];var MailSimpleData=w["MailSimpleData"];var AnnexInf=w["AnnexInf"];var MailData=w["MailData"];var MailStateInf=w["MailStateInf"];var StringCell=w["StringCell"];var SysMsgParam=w["SysMsgParam"];var MallBuyData=w["MallBuyData"];var BlackMallDataItem=w["BlackMallDataItem"];var BlackMallData=w["BlackMallData"];var MallDB=w["MallDB"];var JoinGuildInf=w["JoinGuildInf"];var GuildSelfInf=w["GuildSelfInf"];var GuildMember=w["GuildMember"];var GuildInf=w["GuildInf"];var GuildListInf=w["GuildListInf"];var GuildViewInf=w["GuildViewInf"];var GuildSkillInf=w["GuildSkillInf"];var PosGuildSkill=w["PosGuildSkill"];var GuildConInf=w["GuildConInf"];var GuildTaskHelpRd=w["GuildTaskHelpRd"];var BattleUserData=w["BattleUserData"];var BattleMonsterData=w["BattleMonsterData"];var BuffData=w["BuffData"];var EffectHpData=w["EffectHpData"];var UseSkillData=w["UseSkillData"];var TrigMasterSkillData=w["TrigMasterSkillData"];var BattleRecord=w["BattleRecord"];var SkillData=w["SkillData"];var MasterSkill=w["MasterSkill"];var MasterTreeSkill=w["MasterTreeSkill"];var PetPropRand=w["PetPropRand"];var PetSpace=w["PetSpace"];var PetInfo=w["PetInfo"];var PetInfoEquip=w["PetInfoEquip"];var BossRank=w["BossRank"];var DgnDailyTime=w["DgnDailyTime"];var BossFocus=w["BossFocus"];var DgnDailyVipTime=w["DgnDailyVipTime"];var BossFreshInfo=w["BossFreshInfo"];var BossFreshInfoNew=w["BossFreshInfoNew"];var KingBossRoleSize=w["KingBossRoleSize"];var BossFreshDB=w["BossFreshDB"];var BossPersonalDB=w["BossPersonalDB"];var InspireInf=w["InspireInf"];var BossBelong=w["BossBelong"];var WorldHostility=w["WorldHostility"];var BossRobot=w["BossRobot"];var BossRobotState=w["BossRobotState"];var PackDB=w["PackDB"];var EquipFromDB=w["EquipFromDB"];var BuffDB=w["BuffDB"];var PetDB=w["PetDB"];var PetFromDB=w["PetFromDB"];var WorldBossFreshDB=w["WorldBossFreshDB"];var CrossBossDrop=w["CrossBossDrop"];var CrossBossDropShow=w["CrossBossDropShow"];var CrossUser=w["CrossUser"];var ExtDB=w["ExtDB"];var GuildAwardDB=w["GuildAwardDB"];var GuildTask=w["GuildTask"];var GuildHelpTask=w["GuildHelpTask"];var GuildPkgDB=w["GuildPkgDB"];var ActHorse=w["ActHorse"];var ActHorseCom=w["ActHorseCom"];var HorseUseSkill=w["HorseUseSkill"];var HorseDB=w["HorseDB"];var LotusData=w["LotusData"];var LotusSeedData=w["LotusSeedData"];var FriendData=w["FriendData"];var VipMallData=w["VipMallData"];var VipData=w["VipData"];var VipDataDB=w["VipDataDB"];var TeamData=w["TeamData"];var TeamMemberData=w["TeamMemberData"];var TeamInviteData=w["TeamInviteData"];var NineTowerLayer=w["NineTowerLayer"];var NineTowerInf=w["NineTowerInf"];var RoleCDInf=w["RoleCDInf"];var DailyDrawData=w["DailyDrawData"];var OpenDrawData=w["OpenDrawData"];var DailyDrawInf=w["DailyDrawInf"];var DailyDrawLuckInf=w["DailyDrawLuckInf"];var DialDrawData=w["DialDrawData"];var CheckpointData=w["CheckpointData"];var DgnGradeData=w["DgnGradeData"];var DailyActInf=w["DailyActInf"];var DailyDgnInf=w["DailyDgnInf"];var GourdInf=w["GourdInf"];var GourdDB=w["GourdDB"];var WaterRecord=w["WaterRecord"];var HomeBubbleData=w["HomeBubbleData"];var HomeQuestionData=w["HomeQuestionData"];var HomeQuestionLotteryData=w["HomeQuestionLotteryData"];var ActivityStartTimeInfo=w["ActivityStartTimeInfo"];var AloneActInfo=w["AloneActInfo"];var AloneActStatus=w["AloneActStatus"];var AloneActIcon=w["AloneActIcon"];var MonsterSoulInfo=w["MonsterSoulInfo"];var TitleData=w["TitleData"];var HeadFrameData=w["HeadFrameData"];var SkinData=w["SkinData"];var GuardData=w["GuardData"];var GuardEquipData=w["GuardEquipData"];var AwakeData=w["AwakeData"];var TransfData=w["TransfData"];var QuenchMagicData=w["QuenchMagicData"];var QuenchData=w["QuenchData"];var SoulFromDB=w["SoulFromDB"];var SoulItemData=w["SoulItemData"];var SoulData=w["SoulData"];var XinfaItemData=w["XinfaItemData"];var XinfaData=w["XinfaData"];var XinfaDbData=w["XinfaDbData"];var BoxBelong=w["BoxBelong"];var BoxRecord=w["BoxRecord"];var GardenEnvData=w["GardenEnvData"];var GardenPlantData=w["GardenPlantData"];var ActivityListInfo=w["ActivityListInfo"];var ActivityRedStatus=w["ActivityRedStatus"];var ActivityIconStatus=w["ActivityIconStatus"];var StatusItem=w["StatusItem"];var StampBuff=w["StampBuff"];var StatusItemGroup=w["StatusItemGroup"];var ActRankList=w["ActRankList"];var StatusBless=w["StatusBless"];var Limitinf=w["Limitinf"];var MedalData=w["MedalData"];var MedalHisttorData=w["MedalHisttorData"];var MedalDbData=w["MedalDbData"];var MedalMallBuyData=w["MedalMallBuyData"];var MedalGlobalData=w["MedalGlobalData"];var MedalRoleSizeRankData=w["MedalRoleSizeRankData"];var MedalMagicWeaponSizeRankData=w["MedalMagicWeaponSizeRankData"];var MedalPetRankData=w["MedalPetRankData"];var MedalOfflineTaskData=w["MedalOfflineTaskData"];var MedalGlobalDbData=w["MedalGlobalDbData"];var MonthCardData=w["MonthCardData"];var MonthCardDbData=w["MonthCardDbData"];var LifeCardDbData=w["LifeCardDbData"];var WeekCardData=w["WeekCardData"];var CardDbData=w["CardDbData"];var RechargeMallData=w["RechargeMallData"];var RechargeMallDbData=w["RechargeMallDbData"];var WarOrderRewardData=w["WarOrderRewardData"];var WarOrderShopData=w["WarOrderShopData"];var WarOrderTaskData=w["WarOrderTaskData"];var WarOrderDbData=w["WarOrderDbData"];var PedlarDbActtime=w["PedlarDbActtime"];var PedlarDbData=w["PedlarDbData"];var OffLineAwardItemData=w["OffLineAwardItemData"];var AmuleteData=w["AmuleteData"];var AmuleteDbData=w["AmuleteDbData"];var TreasureHuntLuckData=w["TreasureHuntLuckData"];var TreasureHuntUnitData=w["TreasureHuntUnitData"];var TreasureHuntData=w["TreasureHuntData"];var TreasureHuntRecordData=w["TreasureHuntRecordData"];var DBTreasureHuntData=w["DBTreasureHuntData"];var DBAllTreasureHuntData=w["DBAllTreasureHuntData"];var DBTreasureHuntRecordData=w["DBTreasureHuntRecordData"];var DBAllTreasureHuntRecordData=w["DBAllTreasureHuntRecordData"];var GuildDgnBuff=w["GuildDgnBuff"];var GuildBuffCD=w["GuildBuffCD"];var GuildDgnJoinInf=w["GuildDgnJoinInf"];var ArenaRecord=w["ArenaRecord"];var WeaponData=w["WeaponData"];var WeaponDataDB=w["WeaponDataDB"];var QuickHangUpDB=w["QuickHangUpDB"];var CtlCode=w["CtlCode"];var GmCombatInfo=w["GmCombatInfo"];var GmItemInfo=w["GmItemInfo"];var GmSyncRoleInfo=w["GmSyncRoleInfo"];var GmDngInfo=w["GmDngInfo"];var GmRankInfo=w["GmRankInfo"];var GmGuildList=w["GmGuildList"];var GmGuildMember=w["GmGuildMember"];var LuheFromDB=w["LuheFromDB"];var LuheItemData=w["LuheItemData"];var LuheData=w["LuheData"];var SvrGroup=w["SvrGroup"];var GuildChampionMember=w["GuildChampionMember"];var GuildChampionBattleInfo=w["GuildChampionBattleInfo"];var GuildChampionTeam=w["GuildChampionTeam"];var GuildChampionBattleList=w["GuildChampionBattleList"];var ServerGuildChampionBattleList=w["ServerGuildChampionBattleList"];var GuildChampionRank=w["GuildChampionRank"];var GuildChampionTeamDB=w["GuildChampionTeamDB"];var GuildChampionBattleInfoDB=w["GuildChampionBattleInfoDB"];var GuildChampionServerGuildDB=w["GuildChampionServerGuildDB"];var GuildChampionGuildPairDB=w["GuildChampionGuildPairDB"];var GuildChampionGroupDB=w["GuildChampionGroupDB"];var GuildChampionDB=w["GuildChampionDB"];var GuildChampionServerRankDB=w["GuildChampionServerRankDB"];var CrossChampionSeverInfo=w["CrossChampionSeverInfo"];var MailAnnex=w["MailAnnex"];var SkillCDData=w["SkillCDData"];var RPGetList=w["RPGetList"];var RedPacketData=w["RedPacketData"];var SaveSeventhBoxData=w["SaveSeventhBoxData"];var BtComInf=w["BtComInf"];var BtComAskResult=w["BtComAskResult"];var DailyBtComInf=w["DailyBtComInf"];var BtComShowInf=w["BtComShowInf"];var BtComRecord=w["BtComRecord"];var TitleRankDataDB=w["TitleRankDataDB"];var DilaoCombatInf=w["DilaoCombatInf"];var DgnBuff=w["DgnBuff"];var ArboretumEnv=w["ArboretumEnv"];var ArboretumSpace=w["ArboretumSpace"];var ArboretumPetSlot=w["ArboretumPetSlot"];var ArboretumMyPetSlot=w["ArboretumMyPetSlot"];var ArboretumPetAward=w["ArboretumPetAward"];var ArboretumOrder=w["ArboretumOrder"];var ArboretumOrderInfo=w["ArboretumOrderInfo"];var ArboretumDevelop=w["ArboretumDevelop"];var ArboretumGuard=w["ArboretumGuard"];var ArboretumUsingGuard=w["ArboretumUsingGuard"];var ArboretumFriend=w["ArboretumFriend"];var ArboretumInfo=w["ArboretumInfo"];var ArboretumRecord=w["ArboretumRecord"];var ArboretumEnvDB=w["ArboretumEnvDB"];var ArboretumSpaceDB=w["ArboretumSpaceDB"];var ArboretumPetSlotDB=w["ArboretumPetSlotDB"];var ArboretumInfoDB=w["ArboretumInfoDB"];var ResDataToClient=w["ResDataToClient"];var LeftData=w["LeftData"];var ResDataToDB=w["ResDataToDB"];var ResFindBack=w["ResFindBack"];var PetDispatchMap=w["PetDispatchMap"];var PetDispatchMapDB=w["PetDispatchMapDB"];var DayShopData=w["DayShopData"];var DayComData=w["DayComData"];var SDayTaskData=w["SDayTaskData"];var SDayPointDdata=w["SDayPointDdata"];var ActDrawData=w["ActDrawData"];var TanbaoInf=w["TanbaoInf"];var SimpleTeamData=w["SimpleTeamData"];var HangUpInfo=w["HangUpInfo"];var DongfuTreasure=w["DongfuTreasure"];var DongfuInfo=w["DongfuInfo"];var SecSoulInfo=w["SecSoulInfo"];var ElixirInfo=w["ElixirInfo"];var SecTimeInfo=w["SecTimeInfo"];var EventData=w["EventData"];var MakeUpData=w["MakeUpData"];var DailyRechargeItem=w["DailyRechargeItem"];var MagicData=w["MagicData"];var MagicLayUnitData=w["MagicLayUnitData"];var MagicEquipUnitData=w["MagicEquipUnitData"];var MagicResonanceInfo=w["MagicResonanceInfo"];var MagicAddInfo=w["MagicAddInfo"];var MagicPluginInfo=w["MagicPluginInfo"];var MagicInfoDB=w["MagicInfoDB"];var SecretAreaOpenData=w["SecretAreaOpenData"];var SecretAreaRecord=w["SecretAreaRecord"];var SecretAreaData=w["SecretAreaData"];var MountDataDB=w["MountDataDB"];var Arboretum2PlantInfo=w["Arboretum2PlantInfo"];var Arboretum2GuardInfo=w["Arboretum2GuardInfo"];var Arboretum2HelpRecord=w["Arboretum2HelpRecord"];var Arboretum2Info=w["Arboretum2Info"];var Arboretum2StewardInfo=w["Arboretum2StewardInfo"];var Arboretum2PlantInfoDB=w["Arboretum2PlantInfoDB"];var Arboretum2StewardInfoDB=w["Arboretum2StewardInfoDB"];var Arboretum2HelpedInfoDB=w["Arboretum2HelpedInfoDB"];var Arboretum2HelpedTimeDB=w["Arboretum2HelpedTimeDB"];var Arboretum2InfoDB=w["Arboretum2InfoDB"];var SimpleArenaBattleRecordData=w["SimpleArenaBattleRecordData"];var RefineDataDB=w["RefineDataDB"];var ElixirDataDB=w["ElixirDataDB"];var GiftData=w["GiftData"];var PedlarNewItemData=w["PedlarNewItemData"];var ActLimitedBuyData=w["ActLimitedBuyData"];var CrossRankData=w["CrossRankData"];var RankData=w["RankData"];var RankShowPlayerData=w["RankShowPlayerData"];var ArenaRankTitleDB=w["ArenaRankTitleDB"];var UserRank=w["UserRank"];var RoleShowView=w["RoleShowView"];var ShowPlayerMagicPluginInfo=w["ShowPlayerMagicPluginInfo"];var ShowPlayerData=w["ShowPlayerData"];var ChartData=w["ChartData"];var MijingUnlockData=w["MijingUnlockData"];var SimpleBubbleData=w["SimpleBubbleData"];var ForumData=w["ForumData"];var ForumRawData=w["ForumRawData"];var InvestFundData=w["InvestFundData"];var DialDrawResult=w["DialDrawResult"];var TimeGiftData=w["TimeGiftData"];var CrossXiuLianData=w["CrossXiuLianData"];var CrossXlInf=w["CrossXlInf"];var BattleHpCacheData=w["BattleHpCacheData"];var CrossXiuLianBattleRecordData=w["CrossXiuLianBattleRecordData"];var CrossXiuLianSecenesData=w["CrossXiuLianSecenesData"];var CrossXiuLianUserData=w["CrossXiuLianUserData"];var SpecialItem=w["SpecialItem"];var PeakRecord=w["PeakRecord"];var PeakParamRecord=w["PeakParamRecord"];var Peakinf=w["Peakinf"];var PeakTask=w["PeakTask"];var CltUseDataInfo=w["CltUseDataInfo"];var CustomGiftData=w["CustomGiftData"];var LingtaiRd=w["LingtaiRd"];var HomeAwardRd=w["HomeAwardRd"];var BuildData=w["BuildData"];var TongtianSData=w["TongtianSData"];var TongtianPData=w["TongtianPData"];var FateDB=w["FateDB"];var YsKillData=w["YsKillData"];var YiShouSData=w["YiShouSData"];var YiShouPData=w["YiShouPData"];var QiYuSData=w["QiYuSData"];var QiYuPData=w["QiYuPData"];var WxShareData=w["WxShareData"];var WxGmRoleData=w["WxGmRoleData"];var FumoData=w["FumoData"];var ShenbingData=w["ShenbingData"];var ShenbingTaskData=w["ShenbingTaskData"];var ShenbingGoingData=w["ShenbingGoingData"];var ActivityStartTimeAck=w["ActivityStartTimeAck"];var GetMainPanelResp=w["GetMainPanelResp"];var RecvPrizeResp=w["RecvPrizeResp"];var ActEffectResp=w["ActEffectResp"];var ActOpenNoti=w["ActOpenNoti"];var RedTipsNoti=w["RedTipsNoti"];var ShowIconNoti=w["ShowIconNoti"];var GetActMainPanelResp=w["GetActMainPanelResp"];var RecvActPrizeResp=w["RecvActPrizeResp"];var ActRedTipsNoti=w["ActRedTipsNoti"];var ActShowIconNoti=w["ActShowIconNoti"];var OnlineActTimeNoti=w["OnlineActTimeNoti"];var FirstChargeNoti=w["FirstChargeNoti"];var GetActRankListResp=w["GetActRankListResp"];var ZeroBuyResp=w["ZeroBuyResp"];var ActDrawResp=w["ActDrawResp"];var ActDrawInfoResp=w["ActDrawInfoResp"];var ActDrawCountNtf=w["ActDrawCountNtf"];var ActLimitedBuyDataNtf=w["ActLimitedBuyDataNtf"];var AmuletDataAck=w["AmuletDataAck"];var AmuletUpdateAck=w["AmuletUpdateAck"];var Arboretum2Ntf=w["Arboretum2Ntf"];var Arboretum2PlantNtf=w["Arboretum2PlantNtf"];var Arboretum2PlantAck=w["Arboretum2PlantAck"];var Arboretum2WaterAck=w["Arboretum2WaterAck"];var Arboretum2FricendListAck=w["Arboretum2FricendListAck"];var Arboretum2FriendAck=w["Arboretum2FriendAck"];var Arboretum2GuardUpLvAck=w["Arboretum2GuardUpLvAck"];var Arboretum2StewardInfoNtf=w["Arboretum2StewardInfoNtf"];var Arboretum2StewardSetNtf=w["Arboretum2StewardSetNtf"];var Arboretum2RewardAck=w["Arboretum2RewardAck"];var Arboretum2SetPetAck=w["Arboretum2SetPetAck"];var ArboretumNtf=w["ArboretumNtf"];var ArboretumAddEnvAck=w["ArboretumAddEnvAck"];var ArboretumPlantAck=w["ArboretumPlantAck"];var ArboretumOrderAck=w["ArboretumOrderAck"];var ArboretumFosterPetAck=w["ArboretumFosterPetAck"];var ArboretumFriendAck=w["ArboretumFriendAck"];var ArboretumStealAck=w["ArboretumStealAck"];var ArboretumRecordAck=w["ArboretumRecordAck"];var ArboretumGuardOperateAck=w["ArboretumGuardOperateAck"];var ArboretumDevelopAck=w["ArboretumDevelopAck"];var ArboretumUnlockPetSlotAck=w["ArboretumUnlockPetSlotAck"];var ArboretumPetAwardtAck=w["ArboretumPetAwardtAck"];var ArboretumPetAwardtNtf=w["ArboretumPetAwardtNtf"];var ChargeArenaAck=w["ChargeArenaAck"];var ChargePkAck=w["ChargePkAck"];var SimpleArenaDataNtf=w["SimpleArenaDataNtf"];var SimpleArenaRecordAck=w["SimpleArenaRecordAck"];var SimpleArenaAwardAck=w["SimpleArenaAwardAck"];var SimpleArenaMatchAck=w["SimpleArenaMatchAck"];var SimpleArenaChallengeAck=w["SimpleArenaChallengeAck"];var AwakInfoAck=w["AwakInfoAck"];var AwakGetRewardAck=w["AwakGetRewardAck"];var BattleStartNtf=w["BattleStartNtf"];var BattleMonsterNtf=w["BattleMonsterNtf"];var BattleEndNtf=w["BattleEndNtf"];var BattleAwardNtf=w["BattleAwardNtf"];var BattleRecordNtf=w["BattleRecordNtf"];var UseSkillStartNtf=w["UseSkillStartNtf"];var UseSkillEndNtf=w["UseSkillEndNtf"];var TrigMasterSkillNtf=w["TrigMasterSkillNtf"];var UseBackNtf=w["UseBackNtf"];var HpChangeNtf=w["HpChangeNtf"];var BuffChangeNtf=w["BuffChangeNtf"];var CallSummonNtf=w["CallSummonNtf"];var EndTimeSummonNtf=w["EndTimeSummonNtf"];var BattleAttributeNoti=w["BattleAttributeNoti"];var BattleSkillCD=w["BattleSkillCD"];var BattleReportStream=w["BattleReportStream"];var BossDailyNtf=w["BossDailyNtf"];var BossDailyModifyNtf=w["BossDailyModifyNtf"];var BossFocusNtf=w["BossFocusNtf"];var FightBossNtf=w["FightBossNtf"];var BossRobotNtf=w["BossRobotNtf"];var BossRobotStateNtf=w["BossRobotStateNtf"];var BossDailyVipNtf=w["BossDailyVipNtf"];var FreshBossAck=w["FreshBossAck"];var JoinBossAck=w["JoinBossAck"];var BossHurtNtf=w["BossHurtNtf"];var LeaveBossAck=w["LeaveBossAck"];var FocusBossAck=w["FocusBossAck"];var BossAliveNtf=w["BossAliveNtf"];var InspireNtf=w["InspireNtf"];var InspireAck=w["InspireAck"];var BossBelongNtf=w["BossBelongNtf"];var WorldHostilityNtf=w["WorldHostilityNtf"];var WorldBelongNtf=w["WorldBelongNtf"];var ChargeBelongAck=w["ChargeBelongAck"];var ChargeBelongNtf=w["ChargeBelongNtf"];var RelieveAck=w["RelieveAck"];var BuyBossDailyAck=w["BuyBossDailyAck"];var DailyTimeSetNtf=w["DailyTimeSetNtf"];var CrossGroupNtf=w["CrossGroupNtf"];var StateFightNtf=w["StateFightNtf"];var IceWorldNtf=w["IceWorldNtf"];var IceWorldKickNtf=w["IceWorldKickNtf"];var IceWorldBagNtf=w["IceWorldBagNtf"];var CrossBossAwardNtf=w["CrossBossAwardNtf"];var WorldBossBagAllNtf=w["WorldBossBagAllNtf"];var WorldBossBagAddNtf=w["WorldBossBagAddNtf"];var WorldBossBagAwardAck=w["WorldBossBagAwardAck"];var BossFreshInfoNewNtf=w["BossFreshInfoNewNtf"];var KingBossFreshInfoNewNtf=w["KingBossFreshInfoNewNtf"];var KingBossKillListNtf=w["KingBossKillListNtf"];var KingBossRoleSizeNtf=w["KingBossRoleSizeNtf"];var DevilBossRoleAndHurtNtf=w["DevilBossRoleAndHurtNtf"];var DevilBossHurtAwardAck=w["DevilBossHurtAwardAck"];var DevilBossDataNtf=w["DevilBossDataNtf"];var BossClientTipsNtf=w["BossClientTipsNtf"];var BtCompanionNtf=w["BtCompanionNtf"];var BtCompanionModifyNtf=w["BtCompanionModifyNtf"];var NoBtCompanionNtf=w["NoBtCompanionNtf"];var AwardBcActAck=w["AwardBcActAck"];var JoinBcMapAck=w["JoinBcMapAck"];var StartBcAck=w["StartBcAck"];var AskBcReq=w["AskBcReq"];var AskBcResultNtf=w["AskBcResultNtf"];var LeaveBcAck=w["LeaveBcAck"];var OpenBcInfAck=w["OpenBcInfAck"];var ChangeBcNameAck=w["ChangeBcNameAck"];var ChangeBcNtf=w["ChangeBcNtf"];var TransfLeaderBcAck=w["TransfLeaderBcAck"];var AttributeNoti=w["AttributeNoti"];var LevChangeNoti=w["LevChangeNoti"];var AddExpNoti=w["AddExpNoti"];var RoleDataNoti=w["RoleDataNoti"];var ResourceNoti=w["ResourceNoti"];var RoleModifyNtf=w["RoleModifyNtf"];var TransfChangeNoti=w["TransfChangeNoti"];var RealNamePrizeNoti=w["RealNamePrizeNoti"];var CreateCombatAck=w["CreateCombatAck"];var ChangeNameCDNtf=w["ChangeNameCDNtf"];var ChangeNameResp=w["ChangeNameResp"];var ChangeHuluNameAck=w["ChangeHuluNameAck"];var UserScoreResp=w["UserScoreResp"];var UseExpAck=w["UseExpAck"];var GainAwardOnlineAck=w["GainAwardOnlineAck"];var GainAwardItemNtf=w["GainAwardItemNtf"];var OffLineAwardItemNtf=w["OffLineAwardItemNtf"];var QuackHangUpInfoAck=w["QuackHangUpInfoAck"];var StatusItemNtf=w["StatusItemNtf"];var IdentityAuthDataNoti=w["IdentityAuthDataNoti"];var RecvIdentityPrizeResp=w["RecvIdentityPrizeResp"];var IdentityAuthTimeNoti=w["IdentityAuthTimeNoti"];var IdentityAuthKickNoti=w["IdentityAuthKickNoti"];var GetChargeSignResp=w["GetChargeSignResp"];var SaveSettingsAck=w["SaveSettingsAck"];var SaveSettingsNoti=w["SaveSettingsNoti"];var AskAwardNtf=w["AskAwardNtf"];var SetInFightAck=w["SetInFightAck"];var GainBanPhoneAck=w["GainBanPhoneAck"];var CombatAddExpNoti=w["CombatAddExpNoti"];var SectionBattleScoreAck=w["SectionBattleScoreAck"];var CltUseDataNtf=w["CltUseDataNtf"];var ChartDataNtf=w["ChartDataNtf"];var ChartSynthesisResp=w["ChartSynthesisResp"];var ChartMagicLayResp=w["ChartMagicLayResp"];var ChattingResponse=w["ChattingResponse"];var ChattingLangParamResponse=w["ChattingLangParamResponse"];var SysMsgNtf=w["SysMsgNtf"];var SysMsgParamNtf=w["SysMsgParamNtf"];var SysNoticeParamNtf=w["SysNoticeParamNtf"];var SysNewNoticeParamNtf=w["SysNewNoticeParamNtf"];var DialogLangParamNtf=w["DialogLangParamNtf"];var SysMsgStringNtf=w["SysMsgStringNtf"];var BossAIMsgNtf=w["BossAIMsgNtf"];var RoleArenaRecordNtf=w["RoleArenaRecordNtf"];var AddRoleArenaRecordNtf=w["AddRoleArenaRecordNtf"];var DailyActNtf=w["DailyActNtf"];var DailyActModifyNtf=w["DailyActModifyNtf"];var AwardDailyActAck=w["AwardDailyActAck"];var AwardActPointAck=w["AwardActPointAck"];var RoleCDModifyNtf=w["RoleCDModifyNtf"];var PetGemTowerNtf=w["PetGemTowerNtf"];var PetGemTowerAck=w["PetGemTowerAck"];var JoinMountGodAck=w["JoinMountGodAck"];var DailyInspireNtf=w["DailyInspireNtf"];var DailyInspireAck=w["DailyInspireAck"];var MonsterbookNtf=w["MonsterbookNtf"];var AwardMonsterbookAck=w["AwardMonsterbookAck"];var SweepMonsterbookAck=w["SweepMonsterbookAck"];var BuyDailyNumAck=w["BuyDailyNumAck"];var MissPalaceAck=w["MissPalaceAck"];var JoinMissPalaceAck=w["JoinMissPalaceAck"];var MissPalaceExpNtf=w["MissPalaceExpNtf"];var FuncOpenNtf=w["FuncOpenNtf"];var AwardFuncOpenAck=w["AwardFuncOpenAck"];var AchieveInfNtf=w["AchieveInfNtf"];var AwardAchieveAck=w["AwardAchieveAck"];var TaskTowerNtf=w["TaskTowerNtf"];var TaskTowerAck=w["TaskTowerAck"];var TowerAwardNtf=w["TowerAwardNtf"];var TowerAwardAck=w["TowerAwardAck"];var BraveChallengeNtf=w["BraveChallengeNtf"];var BraveChallengeAck=w["BraveChallengeAck"];var EliteChallengeNtf=w["EliteChallengeNtf"];var EliteChallengeAck=w["EliteChallengeAck"];var SweepEliteChallengeAck=w["SweepEliteChallengeAck"];var SignNtf=w["SignNtf"];var SignAck=w["SignAck"];var SignDaysAck=w["SignDaysAck"];var DgnSzjdSweepNtf=w["DgnSzjdSweepNtf"];var DgnSzjdAck=w["DgnSzjdAck"];var DgnSzjdStepNtf=w["DgnSzjdStepNtf"];var SweepDgnSzjdAck=w["SweepDgnSzjdAck"];var DgnNineTowerNtf=w["DgnNineTowerNtf"];var DgnNineTowerAck=w["DgnNineTowerAck"];var AwardNineTowerAck=w["AwardNineTowerAck"];var SweepNineTowerAck=w["SweepNineTowerAck"];var NineTowerBuyAck=w["NineTowerBuyAck"];var DgnSaveSeventhAck=w["DgnSaveSeventhAck"];var SaveSeventhHPNotice=w["SaveSeventhHPNotice"];var SaveSeventhAddBoxNotice=w["SaveSeventhAddBoxNotice"];var SaveSeventhGetBoxAck=w["SaveSeventhGetBoxAck"];var ResFindBackDataAck=w["ResFindBackDataAck"];var ResFindBackAck=w["ResFindBackAck"];var SevenDayDataAck=w["SevenDayDataAck"];var SevenDayRewardAck=w["SevenDayRewardAck"];var DailyDrawResp=w["DailyDrawResp"];var DailyDrawDataNtf=w["DailyDrawDataNtf"];var CheckpointDataNtf=w["CheckpointDataNtf"];var CheckpointAck=w["CheckpointAck"];var CheckpointAwardAck=w["CheckpointAwardAck"];var CaveTreasureDataNtf=w["CaveTreasureDataNtf"];var CaveTreasureBattleAck=w["CaveTreasureBattleAck"];var SecretAreaOpenNtf=w["SecretAreaOpenNtf"];var SecretAreaDataAck=w["SecretAreaDataAck"];var SecretAreaAwardResp=w["SecretAreaAwardResp"];var SecretAreaFightResp=w["SecretAreaFightResp"];var SecretAreaStartResp=w["SecretAreaStartResp"];var SSSSGradeInfoNtf=w["SSSSGradeInfoNtf"];var SSSSSweapAck=w["SSSSSweapAck"];var DialDrawResp=w["DialDrawResp"];var DialDrawDataNtf=w["DialDrawDataNtf"];var DialDrawAwardResp=w["DialDrawAwardResp"];var DailyDrawRecvResp=w["DailyDrawRecvResp"];var DilaoNtf=w["DilaoNtf"];var DilaoCombatNtf=w["DilaoCombatNtf"];var DilaoBuffNtf=w["DilaoBuffNtf"];var GainLayerAwardAck=w["GainLayerAwardAck"];var DilaoLayerAck=w["DilaoLayerAck"];var ResetLayerAck=w["ResetLayerAck"];var ChangeRoleAck=w["ChangeRoleAck"];var ChooseDilaoBuffNtf=w["ChooseDilaoBuffNtf"];var ChooseDilaoBuffAck=w["ChooseDilaoBuffAck"];var AlchemistNtf=w["AlchemistNtf"];var PrescriptionNtf=w["PrescriptionNtf"];var RefineDataNtf=w["RefineDataNtf"];var RefineStartResp=w["RefineStartResp"];var BreakRefineResp=w["BreakRefineResp"];var GetRefineAwardResp=w["GetRefineAwardResp"];var EveryRefineNtf=w["EveryRefineNtf"];var EquipStrenAck=w["EquipStrenAck"];var EquipGemAck=w["EquipGemAck"];var EquipGemLvAck=w["EquipGemLvAck"];var EquipclAck=w["EquipclAck"];var EquipJlAck=w["EquipJlAck"];var TransfEquipAck=w["TransfEquipAck"];var FmPeifangNtf=w["FmPeifangNtf"];var ModifyFmPeifangNtf=w["ModifyFmPeifangNtf"];var FateDataAck=w["FateDataAck"];var FateDrawAck=w["FateDrawAck"];var FateGiftAck=w["FateGiftAck"];var PostCommentAck=w["PostCommentAck"];var PostLikeAck=w["PostLikeAck"];var GetCommentListAck=w["GetCommentListAck"];var GetVerifyDataAck=w["GetVerifyDataAck"];var BlackListDataAck=w["BlackListDataAck"];var BlackListAddAck=w["BlackListAddAck"];var BlackListDelAck=w["BlackListDelAck"];var FriendListDataAck=w["FriendListDataAck"];var friendListAddAck=w["friendListAddAck"];var friendListAcceptAck=w["friendListAcceptAck"];var friendListDelAck=w["friendListDelAck"];var FriendApplyListAck=w["FriendApplyListAck"];var FriendStateListAck=w["FriendStateListAck"];var friendSearchAck=w["friendSearchAck"];var GardenInfoAck=w["GardenInfoAck"];var GardenUpdateAck=w["GardenUpdateAck"];var GardenEnvUpdateAck=w["GardenEnvUpdateAck"];var GardenPlantUpdateAck=w["GardenPlantUpdateAck"];var StartGatherAck=w["StartGatherAck"];var EndGatherAck=w["EndGatherAck"];var StopGatherAck=w["StopGatherAck"];var GuardNtf=w["GuardNtf"];var SpeedGuardAck=w["SpeedGuardAck"];var AwardGuardAck=w["AwardGuardAck"];var GoldSpeedGuardAck=w["GoldSpeedGuardAck"];var NewGuardNtf=w["NewGuardNtf"];var GuajiAck=w["GuajiAck"];var GuardhuluChallengeAck=w["GuardhuluChallengeAck"];var GuardInspireNtf=w["GuardInspireNtf"];var GuardInspireAck=w["GuardInspireAck"];var GuardhuluTimeAck=w["GuardhuluTimeAck"];var GuardPrivateInspireNtf=w["GuardPrivateInspireNtf"];var GuardIslandNtf=w["GuardIslandNtf"];var GuardIslandStartNtf=w["GuardIslandStartNtf"];var GuardIslandEndNtf=w["GuardIslandEndNtf"];var GuardIslandObjNtf=w["GuardIslandObjNtf"];var GuildBuffNtf=w["GuildBuffNtf"];var GuardBossAck=w["GuardBossAck"];var JoinGuardIslandAck=w["JoinGuardIslandAck"];var GuardIslandAwardNtf=w["GuardIslandAwardNtf"];var GuildCDNtf=w["GuildCDNtf"];var GuardIslandExpNtf=w["GuardIslandExpNtf"];var JoinInfIslandAck=w["JoinInfIslandAck"];var GuardInfoAck=w["GuardInfoAck"];var GuardEquipAck=w["GuardEquipAck"];var GuardOverDueNotice=w["GuardOverDueNotice"];var GuardSellAck=w["GuardSellAck"];var GuardRenewAck=w["GuardRenewAck"];var GuardFollowAck=w["GuardFollowAck"];var GuildChampionSessionAck=w["GuildChampionSessionAck"];var GuildChampionBaomingAck=w["GuildChampionBaomingAck"];var GuildChampionBattleListAck=w["GuildChampionBattleListAck"];var GuildChampionBattleRecordAck=w["GuildChampionBattleRecordAck"];var GuildChampionSetPositionAck=w["GuildChampionSetPositionAck"];var GuildChampionOpenNotice=w["GuildChampionOpenNotice"];var GuildNtf=w["GuildNtf"];var GuildReqNtf=w["GuildReqNtf"];var GuildInfListAck=w["GuildInfListAck"];var CreateGuildAck=w["CreateGuildAck"];var UpdateGuildSelfAck=w["UpdateGuildSelfAck"];var UpdateGuildInfAck=w["UpdateGuildInfAck"];var UpdateGuildChiefAck=w["UpdateGuildChiefAck"];var OpenGuildAck=w["OpenGuildAck"];var GuildMemberListAck=w["GuildMemberListAck"];var OperateGuildAck=w["OperateGuildAck"];var LeaveGuildNtf=w["LeaveGuildNtf"];var OpenJoinGuildAck=w["OpenJoinGuildAck"];var OperateJoinGuildAck=w["OperateJoinGuildAck"];var AutoJoinGuildLimitAck=w["AutoJoinGuildLimitAck"];var JoinNotify=w["JoinNotify"];var PlayerGuildChangeNtf=w["PlayerGuildChangeNtf"];var ChangeGuildNameAck=w["ChangeGuildNameAck"];var ChangeGuildNcAck=w["ChangeGuildNcAck"];var UpdateGuildNoticeAck=w["UpdateGuildNoticeAck"];var GuildInfAck=w["GuildInfAck"];var UpgraGuildAck=w["UpgraGuildAck"];var ConGuildAck=w["ConGuildAck"];var ConGuildRecordAck=w["ConGuildRecordAck"];var GuildMallRecordNtf=w["GuildMallRecordNtf"];var GuildMallRandNtf=w["GuildMallRandNtf"];var BuyGuildMallNumAck=w["BuyGuildMallNumAck"];var GuildTechNtf=w["GuildTechNtf"];var ChangeGuildTechNtf=w["ChangeGuildTechNtf"];var GuildTechAck=w["GuildTechAck"];var GuildTreasureNtf=w["GuildTreasureNtf"];var ModifyGuildTreasureNtf=w["ModifyGuildTreasureNtf"];var DelGuildTreasureNtf=w["DelGuildTreasureNtf"];var GainGuildTreasureAck=w["GainGuildTreasureAck"];var GuildTreasureDailyNtf=w["GuildTreasureDailyNtf"];var GuildTaskNtf=w["GuildTaskNtf"];var GuildTaskStarAwardAck=w["GuildTaskStarAwardAck"];var SubGuildQuestItemAck=w["SubGuildQuestItemAck"];var GuildQuestAck=w["GuildQuestAck"];var GuildQuestNumNtf=w["GuildQuestNumNtf"];var HelpGuildQuestAck=w["HelpGuildQuestAck"];var FreshGuildQuestStarAck=w["FreshGuildQuestStarAck"];var SubGuildQuestBuyAck=w["SubGuildQuestBuyAck"];var GuildTaskHelpAck=w["GuildTaskHelpAck"];var CrossBossHelpAck=w["CrossBossHelpAck"];var CrossBossHelpNtf=w["CrossBossHelpNtf"];var GuildGourdNtf=w["GuildGourdNtf"];var HangUpInfoAck=w["HangUpInfoAck"];var HangUpRewardAck=w["HangUpRewardAck"];var HeadFrameInfoAck=w["HeadFrameInfoAck"];var HeadFrameActiveNotice=w["HeadFrameActiveNotice"];var HeadFramePastDueNotice=w["HeadFramePastDueNotice"];var HeadFrameEquipAck=w["HeadFrameEquipAck"];var HeadTitleInfoAck=w["HeadTitleInfoAck"];var HeadTitleUpgradeAck=w["HeadTitleUpgradeAck"];var HomeBubbleDataAck=w["HomeBubbleDataAck"];var HomeQuestionAck=w["HomeQuestionAck"];var HomeAnswerAck=w["HomeAnswerAck"];var HomeLotteryDataAck=w["HomeLotteryDataAck"];var HomeLotteryAck=w["HomeLotteryAck"];var HomeKungDataAck=w["HomeKungDataAck"];var HomeImpartKungAck=w["HomeImpartKungAck"];var HomeInviteKungListAck=w["HomeInviteKungListAck"];var HomeAcceptKungAck=w["HomeAcceptKungAck"];var HomeStartKungAck=w["HomeStartKungAck"];var HomeFinishKungAck=w["HomeFinishKungAck"];var HomePlayerLvAck=w["HomePlayerLvAck"];var HomeWorshipInfoAck=w["HomeWorshipInfoAck"];var HomeWorshipStartAck=w["HomeWorshipStartAck"];var HomeWorshipStopAck=w["HomeWorshipStopAck"];var HomeWorshipFinishAck=w["HomeWorshipFinishAck"];var HomeRunningActivityIdAck=w["HomeRunningActivityIdAck"];var HomeDataNtf=w["HomeDataNtf"];var AwardHomeAck=w["AwardHomeAck"];var HorseListNtf=w["HorseListNtf"];var RideHorseAck=w["RideHorseAck"];var UseHorseSkillAck=w["UseHorseSkillAck"];var RideLvAck=w["RideLvAck"];var ActHorseAck=w["ActHorseAck"];var HorseLvAck=w["HorseLvAck"];var HorseComNtf=w["HorseComNtf"];var AddHorseComNtf=w["AddHorseComNtf"];var ActNewHorseComNtf=w["ActNewHorseComNtf"];var TouziNtf=w["TouziNtf"];var AwardTouziAck=w["AwardTouziAck"];var DayAwardTouziAck=w["DayAwardTouziAck"];var NewMallInfoNtf=w["NewMallInfoNtf"];var GetFreeGiftResp=w["GetFreeGiftResp"];var GetOtherGiftResp=w["GetOtherGiftResp"];var NewTouziNtf=w["NewTouziNtf"];var TimeGiftNtf=w["TimeGiftNtf"];var BuyGiftResp=w["BuyGiftResp"];var SpecialItemNtf=w["SpecialItemNtf"];var CustomGiftChoiceResp=w["CustomGiftChoiceResp"];var CustomGiftChoiceSyn=w["CustomGiftChoiceSyn"];var WxShareDataNtf=w["WxShareDataNtf"];var WxShareAwardResp=w["WxShareAwardResp"];var ItemDelNtf=w["ItemDelNtf"];var ItemModifyNtf=w["ItemModifyNtf"];var PackListNtf=w["PackListNtf"];var PackExpandNtf=w["PackExpandNtf"];var UseItemAck=w["UseItemAck"];var ItemMoveAck=w["ItemMoveAck"];var SellAck=w["SellAck"];var MixEngulfingAck=w["MixEngulfingAck"];var BagUnlockAck=w["BagUnlockAck"];var ItemGainPush=w["ItemGainPush"];var SynthesisAck=w["SynthesisAck"];var UseResItemNtf=w["UseResItemNtf"];var ShowItemAck=w["ShowItemAck"];var ShowItemInfoAck=w["ShowItemInfoAck"];var ItemQuaUpResp=w["ItemQuaUpResp"];var AwardItemScrNtf=w["AwardItemScrNtf"];var LoginResp=w["LoginResp"];var CreateRoleResp=w["CreateRoleResp"];var HeartBeatResp=w["HeartBeatResp"];var EnterGameResp=w["EnterGameResp"];var ServerTimeResp=w["ServerTimeResp"];var BanRoleResp=w["BanRoleResp"];var SysNoticeResp=w["SysNoticeResp"];var LotusDataAck=w["LotusDataAck"];var LotusCultivateAck=w["LotusCultivateAck"];var LotusSeedUseAck=w["LotusSeedUseAck"];var LuheInfoAck=w["LuheInfoAck"];var LuheMoveAck=w["LuheMoveAck"];var LuheModifyNtf=w["LuheModifyNtf"];var LuheDecomposeAck=w["LuheDecomposeAck"];var LuheUpdateAck=w["LuheUpdateAck"];var LuheSynthesisAck=w["LuheSynthesisAck"];var LuheAutoDecomposeAck=w["LuheAutoDecomposeAck"];var MagicDataAck=w["MagicDataAck"];var MagicUpLevelAck=w["MagicUpLevelAck"];var MagicUpStarAck=w["MagicUpStarAck"];var MagicWearAck=w["MagicWearAck"];var MagicLayAck=w["MagicLayAck"];var MagicLayBuyAck=w["MagicLayBuyAck"];var MagicResonanceInfoAck=w["MagicResonanceInfoAck"];var MagicResonanteAck=w["MagicResonanteAck"];var MagicAddExtNtf=w["MagicAddExtNtf"];var ModifyMagicAddExtNtf=w["ModifyMagicAddExtNtf"];var MagicAlmightyPieceAck=w["MagicAlmightyPieceAck"];var MagicPluginAck=w["MagicPluginAck"];var MagicPluginNtf=w["MagicPluginNtf"];var MagicLingtaiNtf=w["MagicLingtaiNtf"];var UpMagicLingtaiAck=w["UpMagicLingtaiAck"];var MailBoxAck=w["MailBoxAck"];var MailBoxInfAck=w["MailBoxInfAck"];var MailDeleteAck=w["MailDeleteAck"];var MailAnnexAck=w["MailAnnexAck"];var NewMailAck=w["NewMailAck"];var MallBuyRecordAck=w["MallBuyRecordAck"];var BuyMallWithNumberAck=w["BuyMallWithNumberAck"];var KfMallBuyRecordNtf=w["KfMallBuyRecordNtf"];var BuyKfMallWithNumberAck=w["BuyKfMallWithNumberAck"];var BlackMallAck=w["BlackMallAck"];var BuyBlackMallAck=w["BuyBlackMallAck"];var FreshBlackMallAck=w["FreshBlackMallAck"];var MoveResponse=w["MoveResponse"];var SetPosistionResponse=w["SetPosistionResponse"];var JoinNewMapNtf=w["JoinNewMapNtf"];var UserViewAck=w["UserViewAck"];var MapObjViewAck=w["MapObjViewAck"];var ViewportDestroyAck=w["ViewportDestroyAck"];var TeleportAck=w["TeleportAck"];var UserViewHpAck=w["UserViewHpAck"];var UserDeadRelieveNtf=w["UserDeadRelieveNtf"];var ChangeNameNoti=w["ChangeNameNoti"];var RoleStatusNtf=w["RoleStatusNtf"];var MapObjFightNtf=w["MapObjFightNtf"];var SetSkinNtf=w["SetSkinNtf"];var SkillTreeListNoti=w["SkillTreeListNoti"];var ModitySkillTreeNtf=w["ModitySkillTreeNtf"];var LearnSkillTreeAck=w["LearnSkillTreeAck"];var ClearTreeAck=w["ClearTreeAck"];var MedalInfoAck=w["MedalInfoAck"];var MedalHistoryInfoAck=w["MedalHistoryInfoAck"];var MedalGetRewardAck=w["MedalGetRewardAck"];var MedalMallRecordNtf=w["MedalMallRecordNtf"];var BuyMedalMallNumAck=w["BuyMedalMallNumAck"];var MijingUnLockNtf=w["MijingUnLockNtf"];var ModifyMijingUnLockNtf=w["ModifyMijingUnLockNtf"];var MijingUnLockAck=w["MijingUnLockAck"];var MonsterSoulInfoAck=w["MonsterSoulInfoAck"];var MonsterSoulUpdateAck=w["MonsterSoulUpdateAck"];var MonthCardInfoAck=w["MonthCardInfoAck"];var MonthCardGetRewardAck=w["MonthCardGetRewardAck"];var LifeCardInfoAck=w["LifeCardInfoAck"];var WeekCardInfoAck=w["WeekCardInfoAck"];var ReceiveWeekCardRewardAck=w["ReceiveWeekCardRewardAck"];var MountainInfoAck=w["MountainInfoAck"];var MountainChallengeAck=w["MountainChallengeAck"];var MountainSweepAck=w["MountainSweepAck"];var AwardMountainAck=w["AwardMountainAck"];var PeakNtf=w["PeakNtf"];var ModifyPeakNtf=w["ModifyPeakNtf"];var PeakTaskNtf=w["PeakTaskNtf"];var PeakTestNtf=w["PeakTestNtf"];var ChargePeakAck=w["ChargePeakAck"];var TestPeakAck=w["TestPeakAck"];var TupoTestAck=w["TupoTestAck"];var AwardTestAck=w["AwardTestAck"];var FinishPeakTaskAck=w["FinishPeakTaskAck"];var GainPeakAwardAck=w["GainPeakAwardAck"];var OpenPeakAck=w["OpenPeakAck"];var PedlarInfoAck=w["PedlarInfoAck"];var PedlarBuyAck=w["PedlarBuyAck"];var PedlarNewNtf=w["PedlarNewNtf"];var PedlarNewAwardAck=w["PedlarNewAwardAck"];var PetDispatchInfoAck=w["PetDispatchInfoAck"];var PetDispatchRewardAck=w["PetDispatchRewardAck"];var PetDispatchAck=w["PetDispatchAck"];var PetDelNtf=w["PetDelNtf"];var PetModifyNtf=w["PetModifyNtf"];var PetGainPush=w["PetGainPush"];var PetPackNtf=w["PetPackNtf"];var PetReputationNtf=w["PetReputationNtf"];var FullPetStarNtf=w["FullPetStarNtf"];var PetFormNtf=w["PetFormNtf"];var PetMoveAck=w["PetMoveAck"];var FreePetAck=w["FreePetAck"];var PetSpaceNtf=w["PetSpaceNtf"];var UnlockPetSpaceAck=w["UnlockPetSpaceAck"];var HatchPetAck=w["HatchPetAck"];var SpeedPetAck=w["SpeedPetAck"];var GainPetAck=w["GainPetAck"];var UpdatePetAck=w["UpdatePetAck"];var PetStarAck=w["PetStarAck"];var PetReputionAck=w["PetReputionAck"];var QuenchMagicAck=w["QuenchMagicAck"];var QuenchOneKeyMagicAck=w["QuenchOneKeyMagicAck"];var GetRankListResp=w["GetRankListResp"];var RankShowPlayerResp=w["RankShowPlayerResp"];var GetShowPlayerResp=w["GetShowPlayerResp"];var GetTarPlayerIpAck=w["GetTarPlayerIpAck"];var RecharegeMallInfoAck=w["RecharegeMallInfoAck"];var RecharegeTaskNotify=w["RecharegeTaskNotify"];var DailyRechargeDataNtf=w["DailyRechargeDataNtf"];var DailyRechargeAwardAck=w["DailyRechargeAwardAck"];var RechargeInfoNtf=w["RechargeInfoNtf"];var RPInfoAck=w["RPInfoAck"];var RPGetAck=w["RPGetAck"];var RPHistoryAck=w["RPHistoryAck"];var RPSendInfo=w["RPSendInfo"];var RPGetTimes=w["RPGetTimes"];var SecSoulTupoAck=w["SecSoulTupoAck"];var SecSoulDataNtf=w["SecSoulDataNtf"];var SecSoulDujieStartAck=w["SecSoulDujieStartAck"];var SecSoulDujieDamage=w["SecSoulDujieDamage"];var SecSoulDujieEnd=w["SecSoulDujieEnd"];var SecSoulShieldNtf=w["SecSoulShieldNtf"];var SecSoulStartResp=w["SecSoulStartResp"];var SecSoulEventNtf=w["SecSoulEventNtf"];var SecSoulEventResp=w["SecSoulEventResp"];var SecSoulTreasureUpResp=w["SecSoulTreasureUpResp"];var SecSoulMakeUpResp=w["SecSoulMakeUpResp"];var CrossSecSoulSecenesAck=w["CrossSecSoulSecenesAck"];var CrossSecSoulBattleRecordAck=w["CrossSecSoulBattleRecordAck"];var CrossSecSoulBattleRecordShowAck=w["CrossSecSoulBattleRecordShowAck"];var CrossSecSoulChallengeAck=w["CrossSecSoulChallengeAck"];var CrossSecSoulSetBattleArrayAck=w["CrossSecSoulSetBattleArrayAck"];var CrossSecSoulTimeNtf=w["CrossSecSoulTimeNtf"];var OpenDongfuResp=w["OpenDongfuResp"];var DongfuMagicLayResp=w["DongfuMagicLayResp"];var SevenInfoAck=w["SevenInfoAck"];var SevenUpAck=w["SevenUpAck"];var SevenSpiritLvAck=w["SevenSpiritLvAck"];var SevenEffectChooseAck=w["SevenEffectChooseAck"];var ShenbingDataNotify=w["ShenbingDataNotify"];var ShenbingOnGoingNotify=w["ShenbingOnGoingNotify"];var ShenbingOprateAck=w["ShenbingOprateAck"];var SimpleTeamDataNtf=w["SimpleTeamDataNtf"];var SimpleTeamUpdateAvatarAck=w["SimpleTeamUpdateAvatarAck"];var TeamElementPropNtf=w["TeamElementPropNtf"];var TeamElementSkillNtf=w["TeamElementSkillNtf"];var UseElementSkillAck=w["UseElementSkillAck"];var SimpleBubbleDataNtf=w["SimpleBubbleDataNtf"];var SimpleBubbleUpdateAck=w["SimpleBubbleUpdateAck"];var SkinInfoAck=w["SkinInfoAck"];var SkinEquipAck=w["SkinEquipAck"];var SkinActiveAck=w["SkinActiveAck"];var SkinReceiveAck=w["SkinReceiveAck"];var SkinUpStarAck=w["SkinUpStarAck"];var SoulInfoAck=w["SoulInfoAck"];var SoulAck=w["SoulAck"];var SoulDecomposeAck=w["SoulDecomposeAck"];var SoulUpdateeAck=w["SoulUpdateeAck"];var TanbaoNtf=w["TanbaoNtf"];var TanbaoActNtf=w["TanbaoActNtf"];var TanbaoBuffNtf=w["TanbaoBuffNtf"];var TanbaoMoveAck=w["TanbaoMoveAck"];var TanbaoResetLayerAck=w["TanbaoResetLayerAck"];var TaskInfoNtf=w["TaskInfoNtf"];var TaskRecordNtf=w["TaskRecordNtf"];var UpdateTaskRecordNtf=w["UpdateTaskRecordNtf"];var TaskSubmitAck=w["TaskSubmitAck"];var TaskGiveUpAck=w["TaskGiveUpAck"];var SubQuestItemAck=w["SubQuestItemAck"];var QuestDgnAck=w["QuestDgnAck"];var QuestKillAck=w["QuestKillAck"];var FuncItemRecordNtf=w["FuncItemRecordNtf"];var JoinEndlessAck=w["JoinEndlessAck"];var LeaveTeamDgnAck=w["LeaveTeamDgnAck"];var EndlessInfNtf=w["EndlessInfNtf"];var EndlessAwardNtf=w["EndlessAwardNtf"];var RollAwardAck=w["RollAwardAck"];var ViewRollAwardAck=w["ViewRollAwardAck"];var TeamInspireNtf=w["TeamInspireNtf"];var TeamInspireAck=w["TeamInspireAck"];var MyTeamDataAck=w["MyTeamDataAck"];var TeamListAck=w["TeamListAck"];var TeamCreateAck=w["TeamCreateAck"];var TeamSetCopyIdAck=w["TeamSetCopyIdAck"];var TeamInviteListAck=w["TeamInviteListAck"];var TeamInviteNotice=w["TeamInviteNotice"];var TeamMemberAcceptAck=w["TeamMemberAcceptAck"];var TeamApplyAck=w["TeamApplyAck"];var TeamApplyListAck=w["TeamApplyListAck"];var TeamApplyAcceptAck=w["TeamApplyAcceptAck"];var TeamEnterCopyAck=w["TeamEnterCopyAck"];var TeamEnterCopyNotice=w["TeamEnterCopyNotice"];var TeamAcceptEnterCopyAck=w["TeamAcceptEnterCopyAck"];var TeamEnterFinalNotice=w["TeamEnterFinalNotice"];var TeamExitAck=w["TeamExitAck"];var TeamChangeCaptainAck=w["TeamChangeCaptainAck"];var TeamInviteAck=w["TeamInviteAck"];var TeamDissolveAck=w["TeamDissolveAck"];var TitleInfoAck=w["TitleInfoAck"];var TitleActiveNotice=w["TitleActiveNotice"];var TitlePastDueNotice=w["TitlePastDueNotice"];var TitleEquipAck=w["TitleEquipAck"];var TongtiangeNtf=w["TongtiangeNtf"];var TongtiangeBuildResp=w["TongtiangeBuildResp"];var TongtiangeAwardResp=w["TongtiangeAwardResp"];var TongtiangeExchangeResp=w["TongtiangeExchangeResp"];var YiShouNtf=w["YiShouNtf"];var YiShouKillResp=w["YiShouKillResp"];var YiShouAwardResp=w["YiShouAwardResp"];var YiShouExchangeResp=w["YiShouExchangeResp"];var QiYuNtf=w["QiYuNtf"];var QiYuDrawResp=w["QiYuDrawResp"];var QiYuAwardResp=w["QiYuAwardResp"];var QiYuExchangeResp=w["QiYuExchangeResp"];var TransfListNtf=w["TransfListNtf"];var RoleTransfAck=w["RoleTransfAck"];var RoleFinishTransfAck=w["RoleFinishTransfAck"];var StartDujieResp=w["StartDujieResp"];var TreasureHuntDataAck=w["TreasureHuntDataAck"];var TreasureHuntRecordAck=w["TreasureHuntRecordAck"];var TreasureHuntDrawAck=w["TreasureHuntDrawAck"];var TreasureHuntReceiveLuckAck=w["TreasureHuntReceiveLuckAck"];var TreasureHuntRefreshAck=w["TreasureHuntRefreshAck"];var TreasureHuntBuyAck=w["TreasureHuntBuyAck"];var VipDataAck=w["VipDataAck"];var VipUseitemAck=w["VipUseitemAck"];var WarOrderInfoAck=w["WarOrderInfoAck"];var WarOrderGetRewardAck=w["WarOrderGetRewardAck"];var WarOrderUpGradeAck=w["WarOrderUpGradeAck"];var WarOrderShopInfoAck=w["WarOrderShopInfoAck"];var WarOrderShopBuyAck=w["WarOrderShopBuyAck"];var WarOrderGetExpBagAck=w["WarOrderGetExpBagAck"];var WarOrderRewardInfoAck=w["WarOrderRewardInfoAck"];var WarOrderTaskInfoAck=w["WarOrderTaskInfoAck"];var WarGetTaskRewardAck=w["WarGetTaskRewardAck"];var WarBuyLevelAck=w["WarBuyLevelAck"];var WarBuyExpAck=w["WarBuyExpAck"];var WeaponInfoAck=w["WeaponInfoAck"];var WeaponUpLevelAck=w["WeaponUpLevelAck"];var WeaponStrengthlvAck=w["WeaponStrengthlvAck"];var XinfaInfoAck=w["XinfaInfoAck"];var XinfaEquipAck=w["XinfaEquipAck"];var XinfaDecomposeAck=w["XinfaDecomposeAck"];var XinfaUpdateeAck=w["XinfaUpdateeAck"];var XinfaUnlockAck=w["XinfaUnlockAck"];var XinfaGongMingAttr=w["XinfaGongMingAttr"];var Int64=w["Int64"];var SocketRequestBase=w["SocketRequestBase"];var Uint64=w["Uint64"];var Csv=w["Csv"];var LayaConfig=w["LayaConfig"];var LogUtil=w["LogUtil"];var ObServer=w["ObServer"];var ObDispatcher=w["ObDispatcher"];var ScreenAdapter=w["ScreenAdapter"];var SortUtil=w["SortUtil"];var ByteCfg=w["ByteCfg"];var ByteStatus=w["ByteStatus"];var AttributeData=w["AttributeData"];var Attributes=w["Attributes"];var HpBarMediator=w["HpBarMediator"];var IHpBarCache=w["IHpBarCache"];var ZjqwHpBarMediator=w["ZjqwHpBarMediator"];var Loader=Laya.Loader;var Byte=Laya.Byte;var Dialog=Laya.Dialog;var View=Laya.View;var P=app.Protocol;var B=ByteUtil;var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var guild;(function(i){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.refreshCd=0;t.listwanjiaArray=[];t.banghuilist1Array=[];t.banghuilist2Array=[];t.secCount=0;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this._model=i.GuildPkModel.getIns();this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listwanjia.itemRender=i.GuildPkItem;this.listwanjia.renderHandler=new Laya.Handler(this,this.onGuildPkItem);this.banghuilist1.itemRender=i.GuildPkGuildNameItem;this.banghuilist1.renderHandler=new Laya.Handler(this,this.onGuildPkGuildNameItem);this.banghuilist2.itemRender=i.GuildPkGuildNameItem;this.banghuilist2.renderHandler=new Laya.Handler(this,this.onGuildPkGuildNameItem);this.btnduizhanjiangli.on(Laya.Event.CLICK,this,this.onShowRwd);game.HelperViewHandler.register(csv.FunctionsProxy.ENUMS.GUILD_PK,[this.btntishi,this.labeltishi]);this.labeltibu01.text=app.getLang("kuafu_tips4")};t.prototype.onShowRwd=function(){app.ViewManager.toggleDialog(i.GuildPkRwdView,1,0)};t.prototype.onGuildPkItem=function(t){t.setData(t.dataSource)};t.prototype.onGuildPkGuildNameItem=function(t){t.setData(t.dataSource)};t.prototype.onDisplay=function(){this._model.on(i.GuildPkModel.INIT,this,this.refreshAll);this._model.on(i.GuildPkModel.REFRESH,this,this.refreshAll);Laya.timer.loop(1e3,this,this.onTimer);app.ProtocolRequest.GuildChampionSessionReq();app.ProtocolRequest.GuildChampionBattleListReq();this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){this._model.off(i.GuildPkModel.INIT,this,this.refreshAll);this._model.off(i.GuildPkModel.REFRESH,this,this.refreshAll);Laya.timer.clearAll(this)};t.prototype.refreshAll=function(){var t=this._model.info;if(!t){return}this._model.setGuildPkName();this.labeltime.text=app.getLang("guild_battle_tips8")+this.getSeasonTime(t.startTime,t.endTime-1);this.onTimer();for(var e=0;e<3;e++){if(!Uint64.equal(this._model.GuildPairs[e].benfu.guildId,Uint64.ZERO)||!Uint64.equal(this._model.GuildPairs[e].waifu.guildId,Uint64.ZERO)){this.listwanjiaArray[e]=this._model.GuildPairs[e];this.banghuilist1Array[e]=this._model.benfuGuilds[e];this.banghuilist2Array[e]=this._model.WaifuGuilds[e]}}this.listwanjia.array=this.listwanjiaArray;this.banghuilist1.array=this.banghuilist1Array;this.banghuilist2.array=this.banghuilist2Array;this.startFight=t.battleStartTime<game.Context.getServerTime()};t.prototype.onTimer=function(){if(this._model.info.battleStartTime>game.Context.getServerTime()){this.labeltishi.text=app.getLang("kuafu_tips5",util.TimeUtil.formatTime(this._model.info.battleStartTime-game.Context.getServerTime()));this.imgyijiesu.skin="res/static/kuafuzhengba/bg_kuafuzhengba_zdzbz.png"}else if(!this._model.IsBattleEnd){this.labeltishi.text=app.getLang("kuafu_tips6");this.imgyijiesu.skin="res/static/kuafuzhengba/bg_kuafuzhengba_zdjxz.png";if(this.secCount>30){app.ProtocolRequest.GuildChampionBattleListReq();this.secCount=0}else{this.secCount++}}else{this.labeltishi.text=app.getLang("kuafu_tips6");this.imgyijiesu.skin="res/static/kuafuzhengba/bg_kuafuzhengba_blzbyjs.png"}if(!this.startFight&&this._model.info.battleStartTime<game.Context.getServerTime()){app.ProtocolRequest.GuildChampionSessionReq()}};t.prototype.getSeasonTime=function(t,e){var i="";i+=util.TimeUtil.formatDate(t,true,false,true,true);i+="—";i+=util.TimeUtil.formatDate(e,true,false,true,true);return i};t.SINGLE_KEY="guild.GuildPkView";return t}(ui.kuafuzhengba.kuafuzhengbaview0UI);i.GuildPkView=t})(guild||(guild={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var battle;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.on(Laya.Event.CLICK,this,this.onClick);this.x=110;this.y=5};e.prototype.onClick=function(){tip.TipManager.showHelpInfoTip(app.getLang(this.ele.explain))};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){var t=app.str2Array(this.dataSource[0],"-");this.ele=csv.StatusProxy.getIns().getCfg(parseInt(t[0]),parseInt(t[1]));this.img.skin="res/icon/buff/"+this.ele.iconid+".png";if(this.dataSource[1]>this.ele.overlaymax){this.shuzi.text="x"+this.ele.overlaymax}else{this.shuzi.text="x"+this.dataSource[1]}};e.SINGLE_KEY="guild.LeftPvpDebuffView";return e}(ui.banghuizhengba.pvpdebuffUI);t.LeftPvpDebuffView=e})(battle||(battle={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var battle;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.on(Laya.Event.CLICK,this,this.onClick);this.x=Laya.stage.width-110-this.width;this.y=5};e.prototype.onClick=function(){tip.TipManager.showHelpInfoTip(app.getLang(this.ele.explain))};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){var t=app.str2Array(this.dataSource[0],"-");this.ele=csv.StatusProxy.getIns().getCfg(parseInt(t[0]),parseInt(t[1]));this.img.skin="res/icon/buff/"+this.ele.iconid+".png";if(this.dataSource[1]>this.ele.overlaymax){this.shuzi.text="x"+this.ele.overlaymax}else{this.shuzi.text="x"+this.dataSource[1]}};e.SINGLE_KEY="guild.RightPvpDebuffView";return e}(ui.banghuizhengba.pvpdebuffUI);t.RightPvpDebuffView=e})(battle||(battle={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var synthesis;(function(n){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){this._model=n.HechengModel.getIns();game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.HECHENG_BAOSHI,n.HechengBaoshiView);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.HECHENG_ITEM,n.HechengItemView);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.HECHENG_EQUIP,n.HechengEquipView);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.HECHENG_PET,n.HechengPetView);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.FABAO_HECHENG,n.HechengFabaoView)};e.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.SynthesisAck,this,this.onSynthesisAck);game.FuncDotAdapter.registRedFunc(csv.FunctionsProxy.ENUMS.HECHENG_BAOSHI,this._model,this._model.updataBaoshiRed);game.FuncDotAdapter.registRedFunc(csv.FunctionsProxy.ENUMS.HECHENG_ITEM,this._model,this._model.updataItemRed);game.FuncDotAdapter.registRedFunc(csv.FunctionsProxy.ENUMS.HECHENG_EQUIP,this._model,this._model.updataEquipRed);game.FuncDotAdapter.registRedFunc(csv.FunctionsProxy.ENUMS.HECHENG_PET,this._model,this._model.updataPetRed);game.FuncDotAdapter.registRedFunc(csv.FunctionsProxy.ENUMS.SIX_BOX_HECHENG,this._model,this._model.updataSixBoxRed)};e.prototype.onSynthesisAck=function(t,e){if(e.result){var i=csv.ItemProxy.getIns().itemCfgMap[e.itemID];if(i.type==csv.ItemProxy.TYPES.FA_BAO){}else{app.ViewManager.toggleDialog(n.HechengSuccessView,1,0,[e.itemID,e.num])}}else{manager.FlowManager.instance.flowByStyle1(app.getLang("compose_2"))}n.HechengModel.getIns().event(n.HechengModel.SYNTHESIS_ACK,e.result)};e.SINGLE_KEY="synthesis.HeChengModule";return e}(app.ModuleBase);n.HeChengModule=t})(synthesis||(synthesis={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var synthesis;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){};e.prototype.openHechengByType=function(t,e){if(t==csv.HechengProxy.ENUM.BAOSHI){game.ClosureManager.callFunction(csv.FunctionsProxy.ENUMS.HECHENG_BAOSHI,true,false,e)}else if(t==csv.HechengProxy.ENUM.ITEM){game.ClosureManager.callFunction(csv.FunctionsProxy.ENUMS.HECHENG_ITEM,true,false,e)}else if(t==csv.HechengProxy.ENUM.EQUIP){game.ClosureManager.callFunction(csv.FunctionsProxy.ENUMS.HECHENG_EQUIP,true,false,e)}else if(t==csv.HechengProxy.ENUM.PET){game.ClosureManager.callFunction(csv.FunctionsProxy.ENUMS.HECHENG_PET,true,false,e)}};e.prototype.openHechengByItemId=function(t){var e=csv.HechengProxy.getIns().getEleByItemId(t);if(!e){manager.FlowManager.instance.flowByStyle1(app.getLang("无此类道具合成"))}else{var i=parseInt(e.type);if(i==csv.HechengProxy.ENUM.BAOSHI){game.ClosureManager.callFunction(csv.FunctionsProxy.ENUMS.HECHENG_BAOSHI,true,false,e)}else if(i==csv.HechengProxy.ENUM.ITEM){game.ClosureManager.callFunction(csv.FunctionsProxy.ENUMS.HECHENG_ITEM,true,false,e)}else if(i==csv.HechengProxy.ENUM.EQUIP){game.ClosureManager.callFunction(csv.FunctionsProxy.ENUMS.HECHENG_EQUIP,true,false,e)}else if(i==csv.HechengProxy.ENUM.PET){game.ClosureManager.callFunction(csv.FunctionsProxy.ENUMS.HECHENG_PET,true,false,e)}}};e.prototype.updataBaoshiRed=function(){var t=false;var e=csv.HechengProxy.getIns().getArr(csv.HechengProxy.ENUM.BAOSHI);for(var i=0,n=e.length;i<n;++i){if(this.getSynthesisRed(e[i])){t=true;break}}if(t){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.HECHENG_BAOSHI)}else{game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.HECHENG_BAOSHI)}};e.prototype.getBaoshiRed=function(){var t=false;var e=csv.HechengProxy.getIns().getArr(csv.HechengProxy.ENUM.BAOSHI);for(var i=0,n=e.length;i<n;++i){if(this.getSynthesisRed(e[i])){t=true;break}}return t};e.prototype.updataEquipRed=function(){var t=false;var e=csv.HechengProxy.getIns().getArr(csv.HechengProxy.ENUM.EQUIP);for(var i=0,n=e.length;i<n;++i){if(this.getSynthesisRed(e[i])){t=true;break}}var a=false;if(t||a){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.HECHENG_EQUIP)}else{game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.HECHENG_EQUIP)}};e.prototype.updataItemRed=function(){var t=false;var e=csv.HechengProxy.getIns().getArr(csv.HechengProxy.ENUM.ITEM);for(var i=0,n=e.length;i<n;++i){if(this.getSynthesisRed(e[i])){t=true;break}}if(t){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.HECHENG_ITEM)}else{game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.HECHENG_ITEM)}};e.prototype.updataPetRed=function(){var t=false;var e=csv.HechengProxy.getIns().getArr(csv.HechengProxy.ENUM.PET);for(var i=0,n=e.length;i<n;++i){if(this.getSynthesisRed(e[i])){t=true;break}}if(t){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.HECHENG_PET)}else{game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.HECHENG_PET)}};e.prototype.updataSixBoxRed=function(){var t=false;var e=csv.HechengProxy.getIns().getArr(csv.HechengProxy.ENUM.SIXBOX);for(var i=0,n=e.length;i<n;++i){if(this.getSynthesisRed(e[i])){t=true;break}}if(t){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.SIX_BOX_HECHENG)}else{game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.SIX_BOX_HECHENG)}};e.prototype.getTypeRed=function(t){var e=false;var i=csv.HechengProxy.getIns().getTypeArr(t);for(var n=0,a=i.length;n<a;++n){if(this.getSynthesisRed(i[n])){e=true;break}}return e};e.prototype.getSynthesisRed=function(t,e){if(e===void 0){e=true}if(e&&t.redflag){return false}if(!game.Context.isTeamLvReach(t.team_level,false)){return false}var i=false;if(t.synthesis_materials1.length>0){var n=t.synthesis_materials1.split("-");var a=n[0];var o=csv.ItemProxy.getIns().itemCfgMap[a];if(o&&o.type==csv.ItemProxy.TYPES.FA_BAO_PIECE){var s=fabaonew.FaBaoNewModel.getIns().magicCfgMap[t.synthesis_item];if(s.isActive==1){return false}}}if(t.batch==1){i=game.GridsModel.getIns().hasEnoughItems(t.synthesis_materials1)}else{if(t.synthesis_materials1==""){i=game.GridsModel.getIns().hasEnoughItems(t.synthesis_materials2)}else{var r=void 0;var l=app.str2Array(t.synthesis_materials1,";");if(l.length>1){r=game.GridsModel.getIns().hasEnoughItems(game.GridsModel.getIns().hebingItems(t.synthesis_materials1))}else{r=game.GridsModel.getIns().hasEnoughItems(t.synthesis_materials1,true)}if(r){i=game.GridsModel.getIns().hasEnoughItems(t.synthesis_materials2)}}}return i};e.prototype.getOneKeyEquips=function(t,n,e){var i=t.serverData?t.serverData.instId:null;var a=t.getItemId();var o=[];if(e){var s=game.GridsModel.getIns().getWearEquipsById(a);for(var r=0,l=s.length;r<l;++r){var h=s[r];var p=void 0;if(i==null){p={item:h,select:false}}else{p={item:h,select:Uint64.equal(i,h.serverData.instId)}}o.push(p)}}var u=game.GridsModel.getIns().getBagEquipsById(a);for(var r=0,l=u.length;r<l;++r){var h=u[r];var p=void 0;if(i==null){if(c(h.serverData.instId)){continue}p={item:h,select:false}}else{if(Uint64.equal(i,h.serverData.instId)){p={item:h,select:true}}else{if(c(h.serverData.instId)){continue}p={item:h,select:false}}}o.push(p)}SortUtil.sortOnArr(o,["select"],[SortUtil.DESCENDING]);function c(t){for(var e=0,i=n.length;e<i;e++){if(Uint64.equal(n[e],t)){return true}}return false}return o};e.SINGLE_KEY="synthesis.HechengModel";e.SYNTHESIS_ACK="synthesis.SynthesisAck";e.EquipSynthesisAck="synthesis.EquipSynthesisAck";e.COST_NUM=4;e.SOUL_COST_NUM=5;e.SOUL_COMMON_COST_NUM=2;return e}(app.ModelBase);t.HechengModel=e})(synthesis||(synthesis={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("synthesis.csv");this.cfgArr=t.getArray();var e=app.Config.getResById("synthesis_equip.csv");this.equipArr=e.getArray();this.arr=[];this._typeMap={};this._typeNameMap={};this._typeKeyArr=[];this.materialMap={};this.hechengMap={};for(var i=0,n=this.cfgArr.length;i<n;i++){var a=this.cfgArr[i];if(!this.arr[parseInt(a.type)]){this.arr[parseInt(a.type)]=[]}var o=a.type+"-"+a.synthesistype;a.totaltype=o;if(a.typename!=""){this._typeNameMap[o]=a.typename;this._typeKeyArr.push(o)}else{a.batch=1;this.arr[parseInt(a.type)].push(a);if(!this._typeMap[o]){this._typeMap[o]=[]}this._typeMap[o].push(a);var s=app.str2Array(a.synthesis_materials1,"-");var r=parseInt(s[0]);this.materialMap[r]=[r,parseInt(s[1]),a]}if(a.type==2&&a.synthesistype==7&&a.synthesis_item!=""){this.hechengMap[a.synthesis_item]=a}}for(var i=0,n=this.equipArr.length;i<n;i++){var a=this.equipArr[i];if(!this.arr[parseInt(a.type)]){this.arr[parseInt(a.type)]=[]}var o=a.type+"-"+a.synthesistype;a.totaltype=o;if(a.typename!=""){this._typeNameMap[o]=a.typename;this._typeKeyArr.push(o)}else{a.batch=0;this.arr[parseInt(a.type)].push(a);if(!this._typeMap[o]){this._typeMap[o]=[]}this._typeMap[o].push(a)}}};e.prototype.getKeyArr=function(){return this._typeKeyArr};e.prototype.getTypeArr=function(t){return this._typeMap[t]};e.prototype.getTypeName=function(t){return this._typeNameMap[t]||""};e.prototype.getArr=function(t){return this.arr[t]||[]};e.prototype.getCostUpInfo=function(t){return this.materialMap[t]};e.prototype.getHechengInfo=function(t){return this.hechengMap[t]};e.prototype.getEleByItemId=function(t){for(var e=0,i=this.cfgArr.length;e<i;e++){var n=this.cfgArr[e];var a=parseInt(n.synthesis_item);if(a==t){return n}}for(var e=0,i=this.equipArr.length;e<i;e++){var n=this.equipArr[e];var a=parseInt(n.synthesis_item);if(a==t){return n}}return null};e.SINGLE_KEY="csv.HechengProxy";e.ENUM={BAOSHI:1,ITEM:2,EQUIP:3,SOUL:4,PET:5,SIXBOX:6,FABAO:7};e.ENUM_EQUIP_SUB={HULU:1,SHOUSHI:2};return e}(app.ModelBase);t.HechengProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var synthesis;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.list=new component.SimpleGroupList;this.list.groupRender=i.HechengTypeItem;this.list.itemRender=i.BaoshiHechengSubTypeItem;this.list.itemRenderHandler=new Laya.Handler(this,this.onSubTypeRenderHandler);this.list.groupRenderHandler=new Laya.Handler(this,this.onTypeRenderHandler);this.list.vScrollBarSkin=" ";this.list.groupKey="totaltype";this.list.boOpenOne=false;this.addChild(this.list);this.list.width=608;this.list.height=1002;this.list.x=20;this.list.y=20};e.prototype.onTypeRenderHandler=function(t,e){t.setData(t.dataSource)};e.prototype.onSubTypeRenderHandler=function(t,e){t.setData(t.dataSource)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){this.list.dataSource=csv.HechengProxy.getIns().getArr(csv.HechengProxy.ENUM.BAOSHI);var t=-1;if(this.dataSource.length>0){var e=this.dataSource[0];if(typeof e=="number"){t=e-1}else if(e&&e.synthesistype){t=parseInt(e.synthesistype)-1}}if(t!=-1){this.list.selectedIndex=t;this.list.scrollToIndex(t)}};e.SINGLE_KEY="synthesis.HechengBaoshiView";return e}(ui.hecheng.hechengviewUI);i.HechengBaoshiView=t})(synthesis||(synthesis={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var synthesis;(function(p){var t=function(i){__extends(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){i.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.costItemArr=[];for(var t=1;t<=p.HechengModel.COST_NUM;t++){var e=this["gezi"+t];e.position=t;this.costItemArr.push(e)}this.numChoose=new game.NumChoose(this.jianhaobtn,this.jiahaobtn,this.shulianglab,this.zuidabtn);this.hechengbtn.on(Laya.Event.CLICK,this,this.onHecheng);this.hechengbtn1.on(Laya.Event.CLICK,this,this.onHecheng);this.hechengbtn2.on(Laya.Event.CLICK,this,this.onHecheng);this.yijianbtn.on(Laya.Event.CLICK,this,this.onOneKey)};t.prototype.onOneKey=function(){for(var t=0;t<this.selectLen;t++){var e=this.costItemArr[t];if(e.selectItem){continue}var i=p.HechengModel.getIns().getOneKeyEquips(e.costItem,this.getPushEquip(),this.boRole);e.onekeySelect(i[0].item)}};t.prototype.onHecheng=function(){if(!game.Context.isTeamLvReach(this.dataSource.team_level,true)){return}if(this.hechengType==0){}else if(this.hechengType==1){if(this.selectLen==1){var t=this.costItemArr[0];if(t.selectItem){}else{manager.FlowManager.instance.flowByStyle1(app.getLang("hecheng_1"));return}}else{var e=[];for(var i=0;i<this.selectLen;i++){var t=this.costItemArr[i];if(t.selectItem){e.push(t.selectItem.getInstId())}else{manager.FlowManager.instance.flowByStyle1(app.getLang("hecheng_1"));return}}}}else if(this.hechengType==2){app.ProtocolRequest.SynthesisReq(this.dataSource.id,this.numChoose.currValue,[])}};t.prototype.closeDialog=function(){app.ViewManager.toggleDialog(t,-1,0)};t.prototype.onDisplay=function(){p.HechengModel.getIns().on(p.HechengModel.SYNTHESIS_ACK,this,this.onSynthesisAck);p.HechengModel.getIns().on(p.HechengModel.EquipSynthesisAck,this,this.onEquipSynthesisAck);this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){p.HechengModel.getIns().off(p.HechengModel.SYNTHESIS_ACK,this,this.onSynthesisAck);p.HechengModel.getIns().on(p.HechengModel.EquipSynthesisAck,this,this.onEquipSynthesisAck)};t.prototype.onSynthesisAck=function(t){this.refreshAll()};t.prototype.onEquipSynthesisAck=function(){this.refreshAll();app.ViewManager.toggleDialog(p.HechengSuccessView,1,0,[this.dataSource.synthesis_item,1])};t.prototype.refreshAll=function(){var t=this.dataSource;var e=game.ItemUtil.createVO(t.synthesis_item);this.gezi.setData(e);game.RedDotView.removeFrom(this.hechengbtn2);for(var i=0;i<p.HechengModel.COST_NUM;i++){game.RedDotView.removeFrom(this.costItemArr[i])}if(t.batch==0){var n=p.HechengModel.getIns().getSynthesisRed(this.dataSource);if(t.synthesis_materials1==""){this.hechengType=0;if(n){game.RedDotView.addTo(this.hechengbtn);this.hechengbtn.gray=false;this.hechengbtn.mouseEnabled=true}else{game.RedDotView.removeFrom(this.hechengbtn);this.hechengbtn.gray=true;this.hechengbtn.mouseEnabled=false}this.hechengbtn.visible=true;this.shiyongbox.visible=false;this.shuliangbox.visible=false;var a=game.ItemUtil.parserList(t.synthesis_materials2);for(var i=0;i<p.HechengModel.COST_NUM;i++){this.costItemArr[i].setData(a[i]||game.GridsModel.LOCKED)}}else{this.hechengType=1;if(n){game.RedDotView.addTo(this.hechengbtn1);this.yijianbtn.gray=false;this.yijianbtn.mouseEnabled=true}else{game.RedDotView.removeFrom(this.hechengbtn1);this.yijianbtn.gray=true;this.yijianbtn.mouseEnabled=false}this.hechengbtn.visible=false;this.shiyongbox.visible=true;this.shuliangbox.visible=false;var o="";var s=app.str2Array(t.synthesis_materials1,";");var r=app.str2Array(t.des,";");this.selectLen=s.length;this.boRole=Boolean(this.selectLen==1);for(var i=0;i<this.selectLen;i++){o+=s[i]+"-1;"}var a=game.ItemUtil.parserList(o+t.synthesis_materials2);for(var i=0;i<p.HechengModel.COST_NUM;i++){if(i<this.selectLen){if(n){game.RedDotView.addTo(this.costItemArr[i])}this.costItemArr[i].setData(a[i]||game.GridsModel.LOCKED,r[i]);this.costItemArr[i].boRole=this.selectLen==1}else{this.costItemArr[i].boRole=false;this.costItemArr[i].setData(a[i]||game.GridsModel.LOCKED)}}}}else{this.hechengType=2;this.hechengbtn.visible=false;this.shiyongbox.visible=false;this.shuliangbox.visible=true;var a=game.ItemUtil.parserList(t.synthesis_materials1);for(var i=0;i<p.HechengModel.COST_NUM;i++){this.costItemArr[i].setData(a[i]||game.GridsModel.LOCKED)}var l=1;var h=game.GridsModel.getIns().getEnoughNum(a);if(h==0){l=0;this.hechengbtn2.gray=true;this.hechengbtn2.mouseEnabled=false}else{this.hechengbtn2.gray=false;this.hechengbtn2.mouseEnabled=true;game.RedDotView.addTo(this.hechengbtn2)}if(t.type==csv.HechengProxy.ENUM.FABAO&&h>1){h=1}this.numChoose.init(l,1,1,h)}};t.prototype.getPushEquip=function(){var t=[];for(var e=0;e<this.selectLen;e++){var i=this.costItemArr[e];if(i.selectItem){t.push(i.selectItem.getInstId())}}return t};t.SINGLE_KEY="synthesis.HechengControlView";return t}(ui.hecheng.hechengtip1UI);p.HechengControlView=t})(synthesis||(synthesis={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var synthesis;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.list=new component.SimpleGroupList;this.list.groupRender=i.HechengTypeItem;this.list.itemRender=i.HechengSubTypeItem;this.list.itemRenderHandler=new Laya.Handler(this,this.onSubTypeRenderHandler);this.list.groupRenderHandler=new Laya.Handler(this,this.onTypeRenderHandler);this.list.vScrollBarSkin=" ";this.list.groupKey="totaltype";this.list.boOpenOne=false;this.addChild(this.list);this.list.width=608;this.list.height=1002;this.list.x=20;this.list.y=20};e.prototype.onTypeRenderHandler=function(t,e){t.setData(t.dataSource)};e.prototype.onSubTypeRenderHandler=function(t,e){t.setData(t.dataSource)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){var t=-1;if(this.dataSource.length>0){var e=this.dataSource[0];if(typeof e=="number"){t=e-1}else if(e&&e.synthesistype){t=parseInt(e.synthesistype)-1}}this.list.dataSource=csv.HechengProxy.getIns().getArr(csv.HechengProxy.ENUM.EQUIP);if(t!=-1){this.list.selectedIndex=t;this.list.scrollToIndex(t)}};e.SINGLE_KEY="synthesis.HechengEquipView";return e}(ui.hecheng.hechengviewUI);i.HechengEquipView=t})(synthesis||(synthesis={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var synthesis;(function(i){var u;(function(t){t[t["HaveAll"]=1]="HaveAll";t[t["HavePieceCanHc"]=2]="HavePieceCanHc";t[t["HavePieceNotHc"]=3]="HavePieceNotHc";t[t["NotHavePieceAndFb"]=4]="NotHavePieceAndFb"})(u||(u={}));var a=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.list=new component.SimpleGroupList;this.list.groupRender=n;this.list.itemRender=i.HechengFabaoSubTypeItem;this.list.getArrayHandler=new Laya.Handler(this,this.getArrayHandler);this.list.itemRenderHandler=new Laya.Handler(this,this.onSubTypeRenderHandler);this.list.groupRenderHandler=new Laya.Handler(this,this.onTypeRenderHandler);this.list.vScrollBarSkin=" ";this.list.groupKey="totaltype";this.list.boOpenOne=false;this.addChild(this.list);this.list.boOpenOne=true;this.list.width=608;this.list.height=1002;this.list.x=20;this.list.y=20;this._model=fabaonew.FaBaoNewModel.getIns()};e.prototype.canHc=function(t){var e=t.synthesis_materials1.split("-");var i=game.GridsModel.getIns().getItemCount(parseInt(e[0]));if(i>=parseInt(e[1])){return true}};e.prototype.sortHandler=function(t,e){if(t.id<e.id){return-1}else if(t.id>e.id){return 1}return 0};e.prototype.sortList=function(t){var e=[];var i=[];for(var n=0;n<t.length;n++){var a=t[n];if(this.canHc(a)){e.push(a)}else{i.push(a)}}e.sort(this.sortHandler);i.sort(this.sortHandler);e=e.concat(i);return e};e.prototype.getArrayHandler=function(t){var e=t.dataSource;var i=[];if(t.curStatus==u.HaveAll||t.curStatus==u.NotHavePieceAndFb){return i}else if(t.curStatus==u.HavePieceCanHc||t.curStatus==u.HavePieceNotHc){for(var n=0;n<this._dataList.length;n++){var a=this._dataList[n];if(a[this.list.groupKey]==e){var o=this._model.magicCfgMap[a.synthesis_item];if(o.isActive==0){var s=a.synthesis_materials1.split("-");var r=game.GridsModel.getIns().getItemCount(parseInt(s[0]));if(r>0){i.push(a)}}}}}i=this.sortList(i);return i};e.prototype.getListByType=function(t,e){var i=[];if(this._dataList){for(var n=0;n<this._dataList.length;n++){var a=this._dataList[n];if(a.type==t&&a.synthesistype==e){i.push(a)}}}return i};e.prototype.getTitleStatus=function(t,e){var i=this.getListByType(t,e);var n=0;var a=false;var o=false;for(var s=0;s<i.length;s++){var r=i[s];var l=this._model.magicCfgMap[r.synthesis_item];if(l.isActive==1){n++}if(n>=i.length){return u.HaveAll}var h=r.synthesis_materials1.split("-");if(l.isActive==0){var p=game.GridsModel.getIns().getItemCount(parseInt(h[0]));if(p>parseInt(h[1])){a=true}if(p>0){o=true}}}if(a){return u.HavePieceCanHc}if(o){return u.HavePieceNotHc}return u.NotHavePieceAndFb};e.prototype.onTypeRenderHandler=function(t,e){t.setData(t.dataSource)};e.prototype.onSubTypeRenderHandler=function(t,e){t.setData(t.dataSource)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){var t=csv.HechengProxy.getIns().getArr(csv.HechengProxy.ENUM.FABAO);this._dataList=t;this.list.dataSource=t;var e=-1;if(this.dataSource.length>0){var i=this.dataSource[0];if(typeof i=="number"){e=i-1}else if(i&&i.synthesistype){e=parseInt(i.synthesistype)-1}}if(e!=-1){this.list.selectedIndex=e;this.list.scrollToIndex(e)}};e.prototype.openByShowArrow=function(){};e.SINGLE_KEY="synthesis.HechengFabaoView";return e}(ui.hecheng.hechengviewUI);i.HechengFabaoView=a;var n=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.jiantou.pivotX=29;this.jiantou.pivotY=14;this.jiantou.x=548;this.jiantou.y=34};e.prototype.onDisplay=function(){game.GridsModel.getIns().on(game.GridsModel.EVENTS.UPDATE,this,this.setRed);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){game.GridsModel.getIns().off(game.GridsModel.EVENTS.UPDATE,this,this.setRed)};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){var e=t.split("-");var i=a.getIns().getTitleStatus(parseInt(e[0]),parseInt(e[1]));this.curStatus=i;var n=csv.HechengProxy.getIns().getTypeName(t);this.taozhuangname.text=app.getLang(n);switch(i){case u.HaveAll:this.labeltihsi.text=app.getLang("fabaonew_04");break;case u.HavePieceCanHc:this.labeltihsi.text="";break;case u.HavePieceNotHc:this.labeltihsi.text="";break;case u.NotHavePieceAndFb:this.labeltihsi.text=app.getLang("fabaonew_06");break}this.setRed()};e.prototype.setArrow=function(t){if(this.curStatus==u.HaveAll||this.curStatus==u.NotHavePieceAndFb){this.jiantou.visible=false}else{this.jiantou.visible=true;if(t==component.SimpleGroupList.OPEN){this.jiantou.scaleY=-1}else{this.jiantou.scaleY=1}}};e.prototype.setRed=function(){var t=i.HechengModel.getIns().getTypeRed(this.dataSource);if(t){game.RedDotView.addTo(this,this.width-20,8)}else{game.RedDotView.removeFrom(this)}};return e}(ui.hecheng.xialaitem3UI)})(synthesis||(synthesis={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var synthesis;(function(i){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.boGuide=false;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.list=new component.SimpleGroupList;this.list.groupRender=i.HechengTypeItem;this.list.itemRender=i.HechengSubTypeItem;this.list.itemRenderHandler=new Laya.Handler(this,this.onSubTypeRenderHandler);this.list.groupRenderHandler=new Laya.Handler(this,this.onTypeRenderHandler);this.list.vScrollBarSkin=" ";this.list.groupKey="totaltype";this.list.boOpenOne=false;this.addChild(this.list);this.list.width=608;this.list.height=1002;this.list.x=20;this.list.y=20;guide.GuideModel.getIns().register(csv.GuideProxy.ENUM_VIEW.HECHENG_ITEM,this,this.getGuideItem)};t.prototype.getGuideItem=function(t,e){this.boGuide=true;var i=csv.HechengProxy.getIns().getArr(csv.HechengProxy.ENUM.ITEM);this.list.dataSource=i;var n=0;var a;for(var o=0,s=i.length;o<s;o++){var r=i[o];if(t==r.synthesistype&&e==r.subtypeid){n=o;a=r;break}}this.list.selectedIndex=n;this.list.mouseEnabled=true;if(a){var l=a.type+"-"+a.synthesistype;return this.list.getSubItem(l,a)}return null};t.prototype.onTypeRenderHandler=function(t,e){t.setData(t.dataSource)};t.prototype.onSubTypeRenderHandler=function(t,e){t.setData(t.dataSource)};t.prototype.onDisplay=function(){this.list.mouseEnabled=false;this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){this.boGuide=false};t.prototype.refreshAll=function(){if(this.boGuide){return}this.list.mouseEnabled=true;this.list.dataSource=csv.HechengProxy.getIns().getArr(csv.HechengProxy.ENUM.ITEM);var t=-1;if(this.dataSource.length>0){var e=this.dataSource[0];if(typeof e=="number"){t=e-1}else if(e&&e.synthesistype){t=parseInt(e.synthesistype)-1}}if(t!=-1){this.list.selectedIndex=t;this.list.scrollToIndex(t)}};t.SINGLE_KEY="synthesis.HechengItemView";return t}(ui.hecheng.hechengviewUI);i.HechengItemView=t})(synthesis||(synthesis={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var synthesis;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.list=new component.SimpleGroupList;this.list.groupRender=i.HechengTypeItem;this.list.itemRender=i.HechengSubTypeItem;this.list.itemRenderHandler=new Laya.Handler(this,this.onSubTypeRenderHandler);this.list.groupRenderHandler=new Laya.Handler(this,this.onTypeRenderHandler);this.list.vScrollBarSkin=" ";this.list.groupKey="totaltype";this.list.boOpenOne=false;this.addChild(this.list);this.list.width=608;this.list.height=1002;this.list.x=20;this.list.y=20};e.prototype.onTypeRenderHandler=function(t,e){t.setData(t.dataSource)};e.prototype.onSubTypeRenderHandler=function(t,e){t.setData(t.dataSource)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){this.list.dataSource=csv.HechengProxy.getIns().getArr(csv.HechengProxy.ENUM.PET);var t=-1;if(this.dataSource.length>0){var e=this.dataSource[0];if(typeof e=="number"){t=e-1}else if(e&&e.synthesistype){t=parseInt(e.synthesistype)-1}}if(t!=-1){this.list.selectedIndex=t;this.list.scrollToIndex(t)}};e.SINGLE_KEY="synthesis.HechengPetView";return e}(ui.hecheng.hechengviewUI);i.HechengPetView=t})(synthesis||(synthesis={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var synthesis;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.quxiaobtn.clickHandler=new Laya.Handler(this,this.onQuxiao);this.xuanzebtn.clickHandler=new Laya.Handler(this,this.onXuanze)};e.prototype.onQuxiao=function(){if(this.selectHandler){this.selectHandler.runWith(0);app.ViewManager.toggleDialog(i.HechengSelectView,-1,0)}};e.prototype.onXuanze=function(){if(this.selectHandler){this.selectHandler.runWith([1,this.equipVo]);app.ViewManager.toggleDialog(i.HechengSelectView,-1,0)}};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t,e){this.equipVo=t.item;this.selectHandler=e;this.xuanzhong.visible=false;this.daoju.setData(this.equipVo);this.wenben.color=game.STYLES.ITEM_QUALITY_S[this.equipVo.getQuality()];this.wenben.text=this.equipVo.getName();this.quxiaobtn.visible=t.select;this.xuanzebtn.visible=!t.select;var i=game.GridsModel.EquipEnums.indexOf(this.equipVo.flag);if(i==-1){this.shuxing.visible=false}else{this.shuxing.visible=true;this.shuxing.text=app.getLang("hecheng_2",i+1)}};e.SINGLE_KEY="synthesis.HechengSelectItem";return e}(ui.hecheng.daojuxuanzeitemUI);i.HechengSelectItem=t})(synthesis||(synthesis={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var synthesis;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.baoshilist.itemRender=i.HechengSelectItem;this.baoshilist.renderHandler=new Laya.Handler(this,this.onRenderHandler)};e.prototype.onRenderHandler=function(t,e){t.setData(t.dataSource,this.selectHandler)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){this.selectHandler=this.dataSource[3];var t=i.HechengModel.getIns().getOneKeyEquips(this.dataSource[0],this.dataSource[1],this.dataSource[2]);this.baoshilist.array=t;this.imghechengtishi.visible=Boolean(t.length==0)};e.SINGLE_KEY="synthesis.HechengSelectView";return e}(ui.hecheng.daojuxuanzetipUI);i.HechengSelectView=t})(synthesis||(synthesis={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var synthesis;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.daoju.locktip=true;this.anis=[this.hechenghenggong,this.resetSuccess]};e.prototype.onDisplay=function(){this.on(Laya.Event.CLICK,this,this.onQuick);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){this.stopAll();this.off(Laya.Event.CLICK,this,this.onQuick)};e.prototype.onQuick=function(){this.close()};e.prototype.refreshAll=function(){var t=this.dataSource[0];var e=this.dataSource[1];this.stopAll();if(this.dataSource[2]){this.anis[this.dataSource[2]].play(0,true);this.anis[this.dataSource[2]].visible=true}else{this.anis[0].play(0,true);this.anis[0].visible=true}var i=game.ItemUtil.createVO(t);i.setCount(e);this.daoju.setData(i)};e.prototype.stopAll=function(){for(var t=0;t<this.anis.length;t++){this.anis[t].stop();this.anis[t].visible=false}};e.SINGLE_KEY="hecheng.HechengSuccessView";e.ANI_TYPE={HECHENG_ITEM:0,RESET_EQUIP:1};return e}(ui.hecheng.hechengchenggongUI);t.HechengSuccessView=e})(synthesis||(synthesis={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var synthesis;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.jiantou.pivotX=29;this.jiantou.pivotY=14;this.jiantou.x=548;this.jiantou.y=34};e.prototype.onDisplay=function(){game.GridsModel.getIns().on(game.GridsModel.EVENTS.UPDATE,this,this.setRed);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){game.GridsModel.getIns().off(game.GridsModel.EVENTS.UPDATE,this,this.setRed)};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){var e=csv.HechengProxy.getIns().getTypeName(t);this.taozhuangname.text=app.getLang(e);this.setRed()};e.prototype.setArrow=function(t){if(t==component.SimpleGroupList.OPEN){this.jiantou.scaleY=-1}else{this.jiantou.scaleY=1}};e.prototype.setRed=function(){var t=i.HechengModel.getIns().getTypeRed(this.dataSource);if(t){game.RedDotView.addTo(this,this.width-20,8)}else{game.RedDotView.removeFrom(this)}};e.SINGLE_KEY="synthesis.HechengTypeItem";return e}(ui.hecheng.xialaitem1UI);i.HechengTypeItem=t})(synthesis||(synthesis={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var hulupick;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){app.ViewManager.regist(i.HuluPickViewNew,"caizhaihulu.atlas");game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.HULU_PICK,i.HuluPickViewNew,new Laya.Handler(this,this.checkOpen),0);this._model=i.HuluPickModel.getIns()};e.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.NewGuardNtf,this,this.onNewGuardNtf);this.addMsgListener(app.ProtocolResponse.SpeedGuardAck,this,this.onSpeedGuardAck);this.addMsgListener(app.ProtocolResponse.GoldSpeedGuardAck,this,this.onGoldSpeedGuardAck);this.addMsgListener(app.ProtocolResponse.AwardGuardAck,this,this.onAwardGuardAck)};e.prototype.checkOpen=function(){if(guild.GuildModel.getIns().isGuild){game.ClosureManager.callFunction(csv.FunctionsProxy.ENUMS.HULU_PICK,true,true)}else{game.ClosureManager.callFunction(csv.FunctionsProxy.ENUMS.GUILD_LIST,true,true)}};e.prototype.onNewGuardNtf=function(t,e){this._model.waterNum=e.snum;this._model.freeNum=e.fnum;this._model.getRewardArr=e.gnum;this._model.event(i.HuluPickModel.HULUPICK_WATER_INFO_UPDATE);guild.GuildModel.getIns().event(guild.GuildFunView.RED_DOT_UPDATE,guild.GUILD_BUILD_ENUM.HULU_PICK)};e.prototype.onGuardNtf=function(t,e){this._model.recordTime=game.Context.getServerTime();this._model.curgrow=e.curgrow;this._model.growexp=e.growexp;this._model.endtime=e.endtime;this._model.snum=e.snum;this._model.gnum=e.gnum;this._model.fnum=e.fnum;this._model.huluArr=e.guards;this._model.event(i.HuluPickModel.HULU_STATE_CHANGE)};e.prototype.onSpeedGuardAck=function(t,e){if(e.result==1){this._model.event(i.HuluPickModel.HULUPICK_WATER_SUC)}};e.prototype.onGoldSpeedGuardAck=function(t,e){if(e.result==1){if(e.fdouble==0){manager.EffectManager.playStageEffect("skill_chenggong")}else{manager.EffectManager.playStageEffect("skill_baoji")}}};e.prototype.onAwardGuardAck=function(t,e){if(e.result==1){var i=[];for(var n=0;n<e.award.length;n++){i.push(e.award[n])}for(var a=0;a<e.res.length;a++){i.push(e.res[a])}app.ViewManager.toggleDialog(common.AwardListView,1,0,i)}};e.SINGLE_KEY="hulupick.HuluPickModule";return e}(app.ModuleBase);i.HuluPickModule=t})(hulupick||(hulupick={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("pick.csv");this.cfgMap=t.getMap("id");this.cfgArr=t.getArray();this.huluMax=this.cfgArr.length};e.prototype.getCfg=function(t){return this.cfgMap[t]};e.prototype.getArr=function(){return this.cfgArr};e.prototype.getTotalProgress=function(){var t=this.cfgArr[this.cfgArr.length-1].progress;return t};Object.defineProperty(e.prototype,"totalExp",{get:function(){if(!this._texp){var t=this.cfgArr[0];this._texp=parseInt(t.progress)}return this._texp},enumerable:true,configurable:true});e.SINGLE_KEY="csv.HuluPickProxy";return e}(app.ModelBase);t.HuluPickProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var hulupick;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.on(Laya.Event.CLICK,this,this.onClick);this.xuanzhongani.visible=false;this.xuanzhongani.mouseEnabled=false;this.fengyingani.visible=false;this.fengyingani.mouseEnabled=false;this._model=i.HuluPickModel.getIns()};e.prototype.onClick=function(){if(this.selectHandler){this.selectHandler.runWith(this.index)}};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t,e){this.cfgId=t.id;this.ditu.skin="caizhaihulu/bg_caizhaihulu_hulu_"+t.id+".png";this.zhezhaoimg.visible=false;this.xuanzhongimg.visible=false;var i=this._model.isGetReward(t.id);if(i){this.scaleX=this.scaleY=.8;this.ditu.gray=true;this.hideChengshu()}else{this.ditu.gray=false;if(this._model.watervalue>=Number(t.progress)){this.scaleX=this.scaleY=1;this.playChengshu();this.playDou()}else{this.scaleX=this.scaleY=.8;this.hideChengshu()}}this.suipian1.visible=this.suipian2.visible=this.suipian3.visible=false;if(e){this.scaleX=this.scaleY=.8;this.fengyingani.visible=true;this.fengyingani.play()}else{var n=game.SystemSetModel.getInstance().settingData.getValueByType(game.SettingType.huluPickLock);if(t.ulock>n.value){this.fengyingani.play();this.fengyingani.visible=true;app.SoundManager.getIns().playSound("ulock");Laya.timer.once(1e3,this,this.playLock,[t.ulock])}else{this.fengyingani.stop();this.fengyingani.visible=false}}};e.prototype.playDou=function(){this.rotation=0;var t=this._model.isGetReward(this.cfgId);if(!t){Laya.timer.once(game.SceneModel.random(1e3,1500),this,this.shake)}};e.prototype.shake=function(t,e){if(t===void 0){t=600}if(e===void 0){e=3}this._shakeDuration=t;this._shakeStart=Laya.timer.currTimer;Laya.timer.frameLoop(e,this,this.onShake)};e.prototype.onShake=function(){if(Laya.timer.currTimer-this._shakeStart>this._shakeDuration){Laya.timer.clear(this,this.onShake);this.playDou();return}this.rotation=game.SceneModel.random(-10,10)};e.prototype.playLock=function(t){this.fengyingani.stop();this.fengyingani.visible=false;this.suipian1.visible=this.suipian2.visible=this.suipian3.visible=true;game.SystemSetModel.getInstance().setValueByType(t,game.SettingType.huluPickLock);this.ani1.on(Laya.Event.COMPLETE,this,this.onLockEnd);this.ani1.play(0,false)};e.prototype.onLockEnd=function(){this.ani1.off(Laya.Event.COMPLETE,this,this.onLockEnd);this.suipian1.visible=this.suipian2.visible=this.suipian3.visible=false;game.Alert.show(app.getLang("pickgourd_des12"))};e.prototype.setSelect=function(t){this.xuanzhongimg.visible=t};e.prototype.playChengshu=function(){this.xuanzhongani.visible=true;this.xuanzhongani.play(0)};e.prototype.hideChengshu=function(){this.xuanzhongani.stop();this.xuanzhongani.visible=false};e.SINGLE_KEY="hulupick.HuluPickItem";return e}(ui.caizhaihulu.caizhaihuluitemUI);i.HuluPickItem=t})(hulupick||(hulupick={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var hulupick;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){this.labeltime01.text=util.TimeUtil.formatDate(t.watertime,false,false,false,true,"-");this.labelxinxi.text=app.getLang("pickgourd_des1",t.name,t.addvalue)};e.SINGLE_KEY="hulupick.HuluPickRecordItem";return e}(ui.caizhaihulu.caizhaihuluitem02UI);t.HuluPickRecordItem=e})(hulupick||(hulupick={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var hulupick;(function(n){var t=function(i){__extends(t,i);function t(){var t=i!==null&&i.apply(this,arguments)||this;t.recordState=0;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){i.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.cuishubtn.clickHandler=new Laya.Handler(this,this.onClickBtn);this.itemxinxi.btnchakan.clickHandler=new Laya.Handler(this,this.onClickOpenBtn);this.itemxinxi2.btnshouqi.clickHandler=new Laya.Handler(this,this.onClickCloseBtn);this.imgbg.on(Laya.Event.CLICK,this,this.onClickBgImg);this._model=n.HuluPickModel.getIns();this.huluArr=[];this.gapArr=[];for(var t=1;t<=csv.HuluPickProxy.getIns().huluMax;t++){var e=this["hulu"+t];e.index=t-1;e.selectHandler=new Laya.Handler(this,this.onSelectHandler);this.huluArr.push(e);this.gapArr.push(e.x-this.caizhiani.x)}this.itemdaoju.listdaoju.itemRender=grids.GridView;this.itemdaoju.listdaoju.renderHandler=grids.GridView.CommonItemRender;this.centerLayout=new game.CenterLayoutMediator(this.itemdaoju.listdaoju,this.itemdaoju.boxdaoju,96,this.itemdaoju.listdaoju.spaceX);this.aniMask=new Laya.Sprite;this.aniMask.graphics.drawRect(0,0,this.teng.width,this.teng.height,1);this.caizhiani.mask=this.aniMask;this.caizhiani.play(0);this.itemxinxi.list.itemRender=n.HuluPickRecordItem;this.itemxinxi.list.renderHandler=new Laya.Handler(this,this.onRender);this.itemxinxi2.list.itemRender=n.HuluPickRecordItem;this.itemxinxi2.list.renderHandler=new Laya.Handler(this,this.onRender);this.recordState=0;this.totalRecordH=0;this.activityTimeView=new activitytaren.ActivityTimeView(this.labeltime01,new Laya.Handler(this,this.endTimeCallBack),"");this.labeltip.text=app.getLang("pickgourd_des8");game.HelperViewHandler.registerStr([this.btntip,this.labeltip],"func86t","pickgourd_des10");this.labeltime.text=app.getLang("pickgourd_des3");this.znimationjiaoshui.stop();this.znimationjiaoshui.visible=false;this.znimationjiaoshui.on(Laya.Event.COMPLETE,this,this.onWaterAniComplete)};t.prototype.onRender=function(t){t.setData(t.dataSource)};t.prototype.onDisplay=function(){guide.GuideModel.getIns().boOpen=false;this.ani1.play(0,false);this._model.on(n.HuluPickModel.HULUPICK_INFO_UPDATE,this,this.onUpdateInfo);this._model.on(n.HuluPickModel.HULUPICK_WATER_INFO_UPDATE,this,this.onUpdateInfo);this._model.on(n.HuluPickModel.HULUPICK_WATER_SUC,this,this.onWaterSuc);this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){guide.GuideModel.getIns().boOpen=true;this._model.off(n.HuluPickModel.HULUPICK_INFO_UPDATE,this,this.onUpdateInfo);this._model.off(n.HuluPickModel.HULUPICK_WATER_INFO_UPDATE,this,this.onUpdateInfo);this._model.off(n.HuluPickModel.HULUPICK_WATER_SUC,this,this.onWaterSuc);Laya.timer.clear(this,this.loopFreshTime);this._selectIndex=-1;this.znimationjiaoshui.stop();this.znimationjiaoshui.visible=false};t.prototype.onUpdateInfo=function(){this.callLater(this.refreshAll)};t.prototype.onWaterSuc=function(){this.znimationjiaoshui.visible=true;this.znimationjiaoshui.play(0,false);app.SoundManager.getIns().playSound("watering")};t.prototype.refreshAll=function(){this.labelchengzhangzhi.text=app.getLang("pickgourd_des2",this._model.watervalue);this.updataProgress(this._model.watervalue);this.updateHuluData();this.updateBtnData();this.updateRecordData();if(this._selectIndex==undefined||this._selectIndex==-1){this.onSelectHandler(0,true)}else{this.selectHulu()}};t.prototype.updataProgress=function(t){var e=csv.HuluPickProxy.getIns().getTotalProgress();if(t>=e){this.setProgress(this.teng.width)}else{var i=csv.HuluPickProxy.getIns().getArr();var n=0;var a=0;for(var o=0;o<csv.HuluPickProxy.getIns().huluMax;o++){var s=i[o].progress;if(t<s){n+=(this.gapArr[o]-n)*(t-a)/(s-a);break}n=this.gapArr[o];a=s}this.setProgress(n)}};t.prototype.updateHuluData=function(){var t=csv.HuluPickProxy.getIns().getArr();for(var e=0;e<csv.HuluPickProxy.getIns().huluMax;e++){var i=t[e];var n=guild.GuildModel.getIns().guildVO.guildInf.level<i.ulock;this.huluArr[e].setData(i,n);this["labeljindu0"+(e+1)].text=i.progress+"";if(!n){this.maxValue=i.progress}}};t.prototype.updateBtnData=function(){var t=dailytask.DailyTaskModel.getIns().getOpenActivityByType(csv.ActivityFunction.ENUM.HULU_PICk);if(t){Laya.timer.clear(this,this.loopFreshTime);this.boxkaiqi.visible=false;if(this._model.waterNum>=this._model.maxWaterNum){this.imgyidashangxian.visible=true;this.boxjiaoshui.visible=false}else{this.imgyidashangxian.visible=false;this.boxjiaoshui.visible=true;if(this._model.freeNum>0){this.labelmianfei.visible=true;this.imgmoney.visible=this.lblCuishuCost.visible=false}else{this.labelmianfei.visible=false;this.imgmoney.visible=this.lblCuishuCost.visible=true;var e=this.getCostItem();this.lblCuishuCost.text=e?e.count+"":"";if(game.GridsModel.getIns().hasEnoughItems(e,false,false)){this.lblCuishuCost.color=game.STYLES.DESC_TXT_COLOR_S}else{this.lblCuishuCost.color=game.STYLES.RED_COLOR_S}}}}else{this.boxkaiqi.visible=true;this.boxjiaoshui.visible=false;this.imgyidashangxian.visible=false;this.loopFreshTime();Laya.timer.loop(1e3,this,this.loopFreshTime)}if(this._model.hasFreeRedDot()){game.RedDotView.addTo(this.cuishubtn)}else{game.RedDotView.removeFrom(this.cuishubtn)}};t.prototype.loopFreshTime=function(){var t=csv.ActivityFunction.getIns().getNextOpenTime(csv.ActivityFunction.ENUM.HULU_PICk);if(t>0){this.labeltime01.text=util.TimeUtil.formatTime1(t,true,true,true)}else{Laya.timer.clear(this,this.loopFreshTime);this.callLater(this.updateBtnData)}};t.prototype.onSelectHandler=function(t,e){if(e===void 0){e=false}this._selectIndex=t;this.selectHulu();this.updateRewardData();for(var i=0;i<this.huluArr.length;i++){if(i==t){this["imgjiantou0"+(i+1)].visible=true}else{this["imgjiantou0"+(i+1)].visible=false}}var n=csv.HuluPickProxy.getIns().getArr();var a=n[this._selectIndex];if(this._model.canGetReward(a.id)){var o=dailytask.DailyTaskModel.getIns().getOpenActivityByType(csv.ActivityFunction.ENUM.HULU_PICk);if(!o){manager.FlowManager.instance.flowByStyle1(app.getLang("pickgourd_des7"));return}if(!e){app.ProtocolRequest.AwardGuardReq()}}};t.prototype.selectHulu=function(){for(var t=0;t<csv.HuluPickProxy.getIns().huluMax;t++){this.huluArr[t].setSelect(this._selectIndex==t)}};t.prototype.updateRewardData=function(){var t=csv.HuluPickProxy.getIns().getArr();var e=t[this._selectIndex];this.centerLayout.array=game.ItemUtil.parserList(e.award);if(guild.GuildModel.getIns().guildVO.guildInf.level<e.ulock){this.itemdaoju.labelyilingqu.color=game.STYLES.DESC_TXT_COLOR;this.itemdaoju.labelyilingqu.text=app.getLang("pickgourd_des11",e.ulock)}else{var i=this._model.isGetReward(e.id);if(i){this.itemdaoju.labelyilingqu.color=game.STYLES.GRee;this.itemdaoju.labelyilingqu.text=app.getLang("huodong_text04")}else{this.itemdaoju.labelyilingqu.text=""}}};t.prototype.setProgress=function(t,e){if(e===void 0){e=true}if(e){Laya.Tween.to(this.aniMask,{x:t-this.teng.width},100)}else{this.aniMask.x=t-this.teng.width}};t.prototype.endTimeCallBack=function(){this.activityTimeView.stop();this.labeltime01.text=""};t.prototype.updateRecordData=function(){if(this.recordState==0){this.itemxinxi.visible=true;this.itemxinxi2.visible=false;this.itemxinxi.list.array=this._model.record;if(this._model.record&&this._model.record.length){this.itemxinxi.imgtishi.visible=false}else{this.itemxinxi.imgtishi.visible=true}}else{this.itemxinxi.visible=false;this.itemxinxi2.visible=true;this.itemxinxi2.list.array=this._model.record}};t.prototype.onClickCloseBtn=function(){this.recordState=0;this.updateRecordData()};t.prototype.onClickOpenBtn=function(){this.recordState=1;this.updateRecordData()};t.prototype.onClickBgImg=function(){if(this.recordState==1){this.onClickCloseBtn()}};t.prototype.onClickBtn=function(){var t=dailytask.DailyTaskModel.getIns().getOpenActivityByType(csv.ActivityFunction.ENUM.HULU_PICk);if(!t){manager.FlowManager.instance.flowByStyle1(app.getLang("pickgourd_des4"));return}var e=csv.HuluPickProxy.getIns().getTotalProgress();if(this._model.watervalue>=e){manager.FlowManager.instance.flowByStyle1(app.getLang("pickgourd_des9"));return}if(this._model.freeNum<=0){if(this._model.waterNum>=this._model.maxWaterNum){manager.FlowManager.instance.flowByStyle1(app.getLang("pickgourd_des6"));return}var i=this.getCostItem();if(this._model.watervalue>=this.maxValue){game.Alert.show(app.getLang("pickgourd_des13",i.getItemId(),i.count),new Laya.Handler(this,this.onOkHandler,[i]),new Laya.Handler)}else{game.Alert.show(app.getLang("pickgourd_des14",i.getItemId(),i.count),new Laya.Handler(this,this.onOkHandler,[i]),new Laya.Handler)}}else{app.ProtocolRequest.SpeedGuardReq()}};t.prototype.onAlertLater=function(t){if(!game.GridsModel.getIns().hasEnoughItems(t,false,true)){return}app.ProtocolRequest.SpeedGuardReq()};t.prototype.onOkHandler=function(t){Laya.timer.callLater(this,this.onAlertLater,[t])};t.prototype.onWaterAniComplete=function(){this.znimationjiaoshui.stop();this.znimationjiaoshui.visible=false;this._model.showWaterRewardDialog()};t.prototype.getCostItem=function(){var t=dailytask.DailyTaskModel.getIns().getOpenActivityByType(csv.ActivityFunction.ENUM.HULU_PICk);var e;if(t){var i=game.ItemUtil.parserList(t.param3);e=this._model.waterNum<this._model.maxWaterNum?i[this._model.waterNum]:i[this._model.maxWaterNum-1]}return e};t.SINGLE_KEY="hulupick.HuluPickViewNew";return t}(ui.caizhaihulu.caizhaihulunew01UI);n.HuluPickViewNew=t})(hulupick||(hulupick={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var huodong;(function(s){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.isCloseXinIcon=false;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.init=function(){this.on(s.HuoDongEvent.EVENT_RED_CHECK,this,this.onCheckHandlerRed);game.RoleModel.getIns().on(game.RoleModel.EVENTS.TEAM_LEVEL_CHANGE,this,this.onTeamLvHandler);var t=s.HuoDongShangChengProxy.getIns().getFloorlist()};t.prototype.hasLimitGiftOpen=function(t){var e=s.HuoDongShangChengProxy.getIns().getFloorlist();for(var i=0;i<e.length;i++){var n=e[i];if(n.huodonglist){for(var a=0;a<n.huodonglist.length;a++){var o=n.huodonglist[a];if(o.getType()==t&&o.isOpen){return true}}}}return false};t.prototype.isGiftOpen=function(t){if(t&&this.infoNtf){if(t.server){var e=t.server.split(";");var i=false;for(var n=0;n<e.length;n++){var a=parseInt(e[n]);if(game.Context.cursvrid==a){i=true}}if(!i){return false}}if(t.recharge){var o=t.recharge.split(";");if(this.infoNtf.giftdata){var s=this.infoNtf.giftdata;for(var n=0;n<s.length;n++){var r=s[n];if(o.indexOf(r.rechargeid.toString())!=-1){return true}}}}return true}return false};t.prototype.onTeamLvHandler=function(){this.onCheckHandlerRed();login.LoginModel.getIns().sysNotice.updateRedPoint()};t.prototype.getGift=function(t){if(this.infoNtf){var e=this.infoNtf.giftdata;if(e){for(var i=0;i<e.length;i++){if(e[i].rechargeid==t){return e[i]}}}}};t.prototype.onTimeEnd=function(){};t.prototype.hasRed=function(){var t=s.HuoDongShangChengProxy.getIns().getFloorlist();for(var e=0;e<t.length;e++){if(t[e].hasRed()){return true}}if(vipcode.VipModel.getIns().updataVipRed()){return true}return false};t.prototype.hasLimtGitRed=function(t){var e=t.getRechargeList();for(var i=0;i<e.length;i++){var n=e[i];if(this.getChengZhangLiBaoStatus(n.id)==s.EChengZhangLiBaoStatus.CanLinQu){return true}}return false};t.prototype.getRed=function(t){var e=t.cfg.type;switch(e){case n.FreeGift:if(this.infoNtf){if(this.infoNtf.freecount>0){return true}}break;case n.EveryDayTeHui:return meiritehui.MeiRITeHuiModel.getIns().refreshReds();case n.JiTianHaoLi:return activitytaren.ActivityTaRenModel.getIns().hasRedByFuncid(csv.FunctionsProxy.ENUMS.LIAN_XU_LEI_CHONG);case n.Month:return monthCard.MonthCardModel.getIns().checkRedDot();case n.TouZiLiCai:return touzilic.TouZiLiCaiModel.getIns().isCanLingQu();case n.ChengZhangJiJing:return chengzhanjijing.ChengZhanJiJingModel.getIns().isCanLingQu();case n.WeekLiBao:return s.WeekMonthForeverModel.getIns().redWeekGift();case n.MonthLiBao:return s.WeekMonthForeverModel.getIns().redMonthGift();case n.Week:return s.WeekMonthForeverModel.getIns().redWeekCard();case n.OneTimeGift:return this.oneTimeGiftRed();case n.LimtGift:return this.hasLimtGitRed(t)}return false};t.prototype.needShowCanLingQuTxt=function(t){switch(t){case n.WeekLiBao:case n.MonthLiBao:case n.LimtGift:return true}return false};t.prototype.onCheckHandlerRed=function(){var t=false;var e=false;var i=csv.FunctionsProxy.ENUMS.HOD_DONG_SHANG_CHENG;game.ClosureManager.removeDot(i);game.ClosureManager.removeXin(i);if(!this.isCloseXinIcon&&this.hasLimitGiftOpen(n.LimtGift)){t=true}else{e=this.hasRed()}if(t){game.ClosureManager.addXin(i)}else{if(e){game.ClosureManager.addDot(i)}}s.WeekMonthForeverModel.getIns().updateRedActs()};t.prototype.oneTimeGiftRed=function(){var t=csv.RechargeProxy.getIns().getCfgListByType(csv.IRechargeType.OneTimeGift);for(var e=0;e<t.length;e++){if(this.getChengZhangLiBaoStatus(t[e].id)==s.EChengZhangLiBaoStatus.CanLinQu){return true}}return false};t.prototype.isOneTimeGiftAllFinish=function(){var t=csv.RechargeProxy.getIns().getCfgListByType(csv.IRechargeType.OneTimeGift);var e=0;for(var i=0;i<t.length;i++){if(this.getChengZhangLiBaoStatus(t[i].id)==s.EChengZhangLiBaoStatus.AlreadyLingQuFinish){e++}}if(t.length==e){return true}return false};t.prototype.getChengZhangLiBaoStatus=function(t){var e=this.getGift(t);if(e){if(e.status==0){return s.EChengZhangLiBaoStatus.WeiGouMai}else if(e.status==1){return s.EChengZhangLiBaoStatus.CanLinQu}else if(e.status==2){return s.EChengZhangLiBaoStatus.AlreadyLingQuFinish}}return s.EChengZhangLiBaoStatus.WeiGouMai};t.prototype.convertTimeStr=function(t){var e=86400;if(t<e){return util.TimeUtil.sec2Str(t)}else{var i=t/e;i=Math.floor(i);return app.getLang("huodong_text_01",i)}};t.prototype.convertTimeWithHour=function(t){var e=86400;if(t<e){return util.TimeUtil.sec2Str(t)}else{var i=t/e;i=Math.floor(i);var n=(t-i*e)/3600;if(n>0){return app.getLang("huodong_text_07",i,Math.floor(n))}return app.getLang("huodong_text_01",i)}};t.prototype.getSortList=function(t){var e=[];for(var i=0;i<t.length;i++){if(this.getChengZhangLiBaoStatus(t[i].id)==s.EChengZhangLiBaoStatus.CanLinQu){e.push(t[i])}}for(var i=0;i<t.length;i++){if(this.getChengZhangLiBaoStatus(t[i].id)==s.EChengZhangLiBaoStatus.WeiGouMai){e.push(t[i])}}for(var i=0;i<t.length;i++){if(this.getChengZhangLiBaoStatus(t[i].id)==s.EChengZhangLiBaoStatus.AlreadyLingQuFinish){e.push(t[i])}}return e};t.prototype.getLimitList=function(t){var e=t.getRechargeList();return this.getSortList(e)};t.prototype.getStartTime=function(t){if(t.start_time!=""){var e=t.start_time.split("-");var i=util.TimeUtil.getTimeByDate(parseInt(e[0]),parseInt(e[1]),parseInt(e[2]),parseInt(e[3]),parseInt(e[4]),parseInt(e[5]));return i}return 0};t.prototype.getEndTime=function(t){if(t.end_time!=""){var e=t.end_time.split("-");var i=util.TimeUtil.getTimeByDate(parseInt(e[0]),parseInt(e[1]),parseInt(e[2]),parseInt(e[3]),parseInt(e[4]),parseInt(e[5]));return i}return 0};t.SINGLE_KEY="huodong.HuoDongShangChengModel";return t}(app.ModelBase);s.HuoDongShangChengModel=t;var n;(function(t){t[t["FreeGift"]=1]="FreeGift";t[t["EveryDayTeHui"]=2]="EveryDayTeHui";t[t["JiTianHaoLi"]=3]="JiTianHaoLi";t[t["OneTimeGift"]=4]="OneTimeGift";t[t["Week"]=5]="Week";t[t["Month"]=6]="Month";t[t["ZhongShengKa"]=7]="ZhongShengKa";t[t["TouZiLiCai"]=8]="TouZiLiCai";t[t["ChengZhangJiJing"]=9]="ChengZhangJiJing";t[t["WeekLiBao"]=10]="WeekLiBao";t[t["MonthLiBao"]=11]="MonthLiBao";t[t["LimtGift"]=12]="LimtGift"})(n=s.EHuoDongType||(s.EHuoDongType={}))})(huodong||(huodong={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var huodong;(function(n){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.oldOpen=false;t.isInit=true;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.GetOtherGiftResp,this,this.onGetOtherGiftResp);this.addMsgListener(app.ProtocolResponse.GetFreeGiftResp,this,this.onGetFreeGiftResp);this.addMsgListener(app.ProtocolResponse.NewMallInfoNtf,this,this.onNewMallInfoNtf);this.addMsgListener(app.ProtocolResponse.LifeCardInfoAck,this,this.onLifeCardInfoAck);this.addMsgListener(app.ProtocolResponse.WeekCardInfoAck,this,this.onWeekCardInfoAck)};t.prototype.init=function(){app.ViewManager.regist(n.ZhouLiBaoview,"shangcheng.atlas");app.ViewManager.regist(n.ForeverCardView,"shouchongjiangli.atlas");app.ViewManager.regist(n.Xinshangchengview,"shouchongjiangli.atlas");app.ViewManager.regist(n.XianshilibaoView,"shangcheng.atlas");this._model=n.HuoDongShangChengModel.getIns();this._model2=n.WeekMonthForeverModel.getIns();game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.HOD_DONG_SHANG_CHENG,n.Xinshangchengview,null,game.ECommonType.DIALOG_TYPE);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.DAY_AWARD,n.NewRiLiBaoview);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.WEEK_AWARD,n.NewZhouLiBaoview);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.MONTH_AWARD,n.NewYueLiBaoview);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.WEEK_CARD,n.ZhouCardView);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.MONTH_CARD,monthCard.MonthCardMainViewNew);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.FOREVER_CARD,n.ForeverCardView)};t.prototype.onNewMallInfoNtf=function(t,e){this._model.infoNtf=e;if(this.isInit){this.oldOpen=this._model.hasLimitGiftOpen(n.EHuoDongType.LimtGift);this.isInit=false}else{var i=this._model.hasLimitGiftOpen(n.EHuoDongType.LimtGift);if(!this.oldOpen&&i){this.oldOpen=i;this._model.isCloseXinIcon=false}}this._model2.giftdataArr=e.giftdata;this._model2.getWeekGiftArr();this._model.event(a.EVENT_MALL_INFO_NTF,[e]);this._model.event(n.HuoDongEvent.EVENT_RED_CHECK)};t.prototype.onGetOtherGiftResp=function(t,e){this._model.event(a.EVENT_OTHER_GIFT,[e]);this._model.event(n.HuoDongEvent.EVENT_RED_CHECK)};t.prototype.onGetFreeGiftResp=function(t,e){this._model.event(a.EVENT_FREE_GIFT,[e])};t.prototype.onLifeCardInfoAck=function(t,e){this._model2.isBuy=e.isBuy;this._model2.event(n.WeekMonthForeverModel.FORVER_CARD_CHANGE);this._model.event(n.HuoDongEvent.EVENT_RED_CHECK)};t.prototype.onWeekCardInfoAck=function(t,e){this._model2.weekNetData=e.monthCardList[0];this._model2.getWeekCardArr();this._model2.event(n.WeekMonthForeverModel.WEEK_CARD_CHANGE);this._model.event(n.HuoDongEvent.EVENT_RED_CHECK)};t.SINGLE_KEY="huodong.HuoDongShangChengModule";return t}(app.ModuleBase);n.HuoDongShangChengModule=t;var a=function(){function t(){}t.EVENT_OTHER_GIFT="EVENT_OTHER_GIFT";t.EVENT_FREE_GIFT="EVENT_FREE_GIFT";t.EVENT_MALL_INFO_NTF="EVENT_MALL_INFO_NTF";t.EVENT_RED_CHECK="EVENT_RED_CHECK";return t}();n.HuoDongEvent=a})(huodong||(huodong={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var huodong;(function(n){var a=function(){function t(){}return t}();n.LiBaoVo=a;var o=function(){function t(){}return t}();n.WeekCardVo=o;var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.isBuy=0;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.init=function(){this._initDayGiftData();this._initWeekGiftData();this._initMonthGiftData();this._initWeekCard()};t.prototype._initWeekGiftData=function(){var i=this;this.clientWeekGiftArr=[];var t=csv.RechargeProxy.getIns().getArrByType(14);t.map(function(t){var e=new a;e.id=t.id;e.cfg=t;e.net=null;i.clientWeekGiftArr.push(e)})};t.prototype._initMonthGiftData=function(){var i=this;this.clientMonthGiftArr=[];var t=csv.RechargeProxy.getIns().getArrByType(15);t.map(function(t){var e=new a;e.id=t.id;e.cfg=t;e.net=null;i.clientMonthGiftArr.push(e)})};t.prototype._initDayGiftData=function(){var i=this;this.clientDayGiftArr=[];var t=csv.RechargeProxy.getIns().getArrByType(18);t.map(function(t){var e=new a;e.id=t.id;e.cfg=t;e.net=null;i.clientDayGiftArr.push(e)})};t.prototype.getDayGiftArr=function(){this._initDayGiftData();if(this.giftdataArr){for(var t=0;t<this.giftdataArr.length;t++){for(var e=0;e<this.clientDayGiftArr.length;e++){if(this.giftdataArr[t].rechargeid==this.clientDayGiftArr[e].id){this.clientDayGiftArr[e].net=this.giftdataArr[t]}}}}return this.clientDayGiftArr};t.prototype.getWeekGiftArr=function(){this._initWeekGiftData();if(this.giftdataArr){for(var t=0;t<this.giftdataArr.length;t++){for(var e=0;e<this.clientWeekGiftArr.length;e++){if(this.giftdataArr[t].rechargeid==this.clientWeekGiftArr[e].id){this.clientWeekGiftArr[e].net=this.giftdataArr[t]}}}}return this.clientWeekGiftArr};t.prototype.getMonthGiftArr=function(){this._initMonthGiftData();if(this.giftdataArr){for(var t=0;t<this.giftdataArr.length;t++){for(var e=0;e<this.clientMonthGiftArr.length;e++){if(this.giftdataArr[t].rechargeid==this.clientMonthGiftArr[e].id){this.clientMonthGiftArr[e].net=this.giftdataArr[t]}}}}return this.clientMonthGiftArr};t.prototype._initWeekCard=function(){var i=this;this.clientWeekCardArr=[];var t=n.HuoDongShangChengProxy.getIns().getWeekCardCfgArr();t.map(function(t){var e=new o;e.day=t.day;e.cfg=t;e.state=0;i.clientWeekCardArr.push(e)})};t.prototype.getWeekCardArr=function(){this._initWeekCard();if(this.weekNetData&&this.weekNetData.buyTime!=0){for(var t=0;t<this.clientWeekCardArr.length;t++){var e=game.Context.getServerZeroTime(this.weekNetData.buyTime);if(game.Context.getServerTime()>=e+t*24*3600){this.clientWeekCardArr[t].state=2;if(this.weekNetData.rewardDay&&this.weekNetData.rewardDay.length>0){for(var i=0;i<this.weekNetData.rewardDay.length;i++){if(this.weekNetData.rewardDay[i]==this.clientWeekCardArr[t].day){this.clientWeekCardArr[t].state=3}}}}else{this.clientWeekCardArr[t].state=1}}}return this.clientWeekCardArr};t.prototype.weekCardDayTime=function(){if(this.weekNetData&&this.weekNetData.buyTime!=0){var t=game.Context.getServerZeroTime(this.weekNetData.buyTime);var e=t+7*24*3600;var i=e-game.Context.getServerTime();return i}return 0};t.prototype.weekCardDayState=function(){if(this.weekCardDayTime()==0){return 0}if(this.weekCardDayTime()<3600*24){return 1}else{return 2}};t.prototype.redDayGift=function(){for(var t=0;t<this.clientDayGiftArr.length;t++){if(!this.clientDayGiftArr[t].net&&+this.clientDayGiftArr[t].cfg.recharge==0){return true}}return false};t.prototype.redWeekGift=function(){for(var t=0;t<this.clientWeekGiftArr.length;t++){if(this.clientWeekGiftArr[t].net&&this.clientWeekGiftArr[t].net.status==1){return true}}return false};t.prototype.redMonthGift=function(){for(var t=0;t<this.clientMonthGiftArr.length;t++){if(this.clientMonthGiftArr[t].net&&this.clientMonthGiftArr[t].net.status==1){return true}}return false};t.prototype.redWeekCard=function(){for(var t=0;t<this.clientWeekCardArr.length;t++){if(this.clientWeekCardArr[t].state==2){return true}}return false};t.prototype.updateRedActs=function(){monthCard.MonthCardModel.getIns().checkRedDot();if(n.WeekMonthForeverModel.getIns().redDayGift()){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.DAY_AWARD)}else{game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.DAY_AWARD)}if(n.WeekMonthForeverModel.getIns().redWeekCard()){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.WEEK_CARD)}else{game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.WEEK_CARD)}if(n.WeekMonthForeverModel.getIns().redWeekGift()){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.WEEK_AWARD)}else{game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.WEEK_AWARD)}if(n.WeekMonthForeverModel.getIns().redMonthGift()){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.MONTH_AWARD)}else{game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.MONTH_AWARD)}};t.SINGLE_KEY="huodong.WeekMonthForeverModel";t.FORVER_CARD_CHANGE="FORVER_CARD_CHANGE";t.WEEK_CARD_CHANGE="WEEK_CARD_CHANGE";return t}(app.ModelBase);n.WeekMonthForeverModel=t})(huodong||(huodong={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var huodong;(function(n){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.getFloorlist=function(){if(!this._floorlist){this._floorlist=[];for(var t in this.floorMaps){this._floorlist.push(new n.HuoDongFloorVo(parseInt(t),this.floorMaps[t]))}}var e=[];for(var i=0;i<this._floorlist.length;i++){if(this._floorlist[i].isOpen()){e.push(this._floorlist[i])}}return e};e.prototype.init=function(){var t=app.Config.getResById("mall.csv");this.floorMaps=t.getMapList("floor");this.cfglist=t.getArray();var e=app.Config.getResById("lifecard.csv");this._lifeCardMap=e.getMap("id");this._lifeCardArr=e.getArray();var i=app.Config.getResById("weekcard.csv");this._weekCardMap=i.getMap("day");this._weekCardArr=i.getArray();var n=app.Config.getResById("shangchengicon.csv");this.shangchengiconList=n.getArray();this.funcidlist=[];for(var a=0;a<this.shangchengiconList.length;a++){var o=this.shangchengiconList[a];if(o.functionid.length!=""){var s=o.functionid.split(";");for(var r=0;r<s.length;r++){this.funcidlist.push(parseInt(s[r]))}}}};e.prototype.getLifeCardCfgMap=function(){return this._lifeCardMap};e.prototype.getLifeCardCfgMapItem=function(t){return this._lifeCardMap[t]};e.prototype.getLifeCardCfgArr=function(){return this._lifeCardArr};e.prototype.getWeekCardCfgMap=function(){return this._weekCardMap};e.prototype.getWeekCardCfgMapItem=function(t){return this._weekCardMap[t]};e.prototype.getWeekCardCfgArr=function(){return this._weekCardArr};e.SINGLE_KEY="csv.HuoDongShangChengProxy";return e}(app.ModelBase);n.HuoDongShangChengProxy=t})(huodong||(huodong={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var huodong;(function(i){var o;(function(t){t[t["CanLinQu"]=1]="CanLinQu";t[t["WeiGouMai"]=2]="WeiGouMai";t[t["AlreadyLingQuFinish"]=3]="AlreadyLingQuFinish"})(o=i.EChengZhangLiBaoStatus||(i.EChengZhangLiBaoStatus={}));var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}Object.defineProperty(e.prototype,"model",{get:function(){return i.HuoDongShangChengModel.getIns()},enumerable:true,configurable:true});e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.libaolist.itemRender=n;this.libaolist.renderHandler=new Laya.Handler(this,this.itemRenderHandler);this.libaolist.repeatX=1;this.libaolist.repeatY=0};e.prototype.itemRenderHandler=function(t,e){t.setData(t.dataSource)};e.prototype.onDisplay=function(){this.model.on(i.HuoDongEvent.EVENT_RED_CHECK,this,this.onRefresh);this.callLater(this.onRefresh)};e.prototype.onRefresh=function(){var t=csv.RechargeProxy.getIns().getCfgListByType(csv.IRechargeType.OneTimeGift);this.libaolist.array=this.model.getSortList(t)};e.prototype.onUnDisplay=function(){this.model.off(i.HuoDongEvent.EVENT_RED_CHECK,this,this.onRefresh)};return e}(ui.xinshangcheng.chengzhanglibaoUI);i.ChengZhangLiBao=t;var n=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}Object.defineProperty(e.prototype,"model",{get:function(){return i.HuoDongShangChengModel.getIns()},enumerable:true,configurable:true});e.prototype.initialize=function(){t.prototype.initialize.call(this);this.gezilist.itemRender=grids.GridView;this.gezilist.renderHandler=grids.GridView.CommonItemRender;this.btnchongzhi.clickHandler=new Laya.Handler(this,this.onClickHandler);this.btnlingqu.clickHandler=new Laya.Handler(this,this.onLingQuHandler)};e.prototype.onLingQuHandler=function(){app.ProtocolRequest.GetOtherGiftReq(this._cfg.id)};e.prototype.onClickHandler=function(){shop.ShopModel.getIns().chongzhi(this._cfg.id)};e.prototype.setData=function(t){this._cfg=t;var e=app.convert_Yuan(t.recharge);this.cliptianshu.value=e.toString();this.gezilist.array=game.ItemUtil.parserList(t.reward);if(t.limit<=0){this.labelxiangou.text=""}else{var i=t.limit;var n=this.model.getGift(t.id);if(n){i=i-n.buynum}this.labelxiangou.text=app.getLang("huodong_text_02",i,t.limit)}var a=this.model.getChengZhangLiBaoStatus(t.id);game.RedDotView.removeFrom(this.btnlingqu);this.btnlingqu.visible=false;this.btnchongzhi.visible=false;this.imgyilingqu.visible=false;switch(a){case o.CanLinQu:this.btnlingqu.visible=true;this.btnlingqu.label=app.getLang("lingqu");game.RedDotView.addTo(this.btnlingqu);break;case o.WeiGouMai:this.btnchongzhi.visible=true;this.btnchongzhi.label=app.getLang("huodong_text_03",e);break;case o.AlreadyLingQuFinish:this.imgyilingqu.visible=true;break}};return e}(ui.xinshangcheng.chengzhanglibaoitemUI)})(huodong||(huodong={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var huodong;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.liebiao1.itemRender=grids.GridView;this.liebiao1.renderHandler=grids.GridView.CommonItemRender;this.liebiao2.itemRender=grids.GridView;this.liebiao2.renderHandler=grids.GridView.CommonItemRender;this._model=i.WeekMonthForeverModel.getIns();this.goumaibtn.clickHandler=new Laya.Handler(this,this.onChongZhiHandler)};e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.setBtnEffect=function(t){if(t){this.guangxiao.visible=true;this.guangxiao.play(0,true)}else{this.guangxiao.visible=false;this.guangxiao.stop()}};e.prototype.onDisplay=function(){app.ProtocolRequest.LifeCardInfoReq();this._model.on(i.WeekMonthForeverModel.FORVER_CARD_CHANGE,this,this.refreshAll)};e.prototype.onUnDisplay=function(){this.setBtnEffect(false);this._model.off(i.WeekMonthForeverModel.FORVER_CARD_CHANGE,this,this.refreshAll)};e.prototype.refreshAll=function(){var t=this._rechargeItem=csv.RechargeProxy.getIns().getCfgByType(13);var e=i.HuoDongShangChengProxy.getIns().getLifeCardCfgMapItem(1);this.liebiao1.array=game.ItemUtil.parserList(t.reward);this.liebiao2.array=game.ItemUtil.parserList(e.reward);this.goumaibtn.label=t.recharge/100+"元购买";this.setBtnEffect(false);if(this._model.isBuy==0){this.setBtnEffect(true);this.goumaibtn.visible=true;this.lingquimg.visible=false}else{this.goumaibtn.visible=false;this.lingquimg.visible=true}};e.prototype.onChongZhiHandler=function(){var t=this._rechargeItem.id;shop.ShopModel.getIns().chongzhi(t)};e.prototype.openView=function(){app.ViewManager.toggleDialog(i.ForeverCardView,1,0)};return e}(ui.xinshangcheng2.zhongshenkaviewUI);i.ForeverCardView=t})(huodong||(huodong={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var huodong;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.gezilist.itemRender=grids.GridView;this.gezilist.renderHandler=grids.GridView.CommonItemRender;this.btnlingqu.clickHandler=new Laya.Handler(this,this.onLingquHandler);this.btnchongzhi.clickHandler=new Laya.Handler(this,this.onChongZhiHandler);game.RedDotView.addTo(this.btnlingqu);this._model=i.WeekMonthForeverModel.getIns()};e.prototype.onChongZhiHandler=function(){var t=+this._data.id;shop.ShopModel.getIns().chongzhi(t)};e.prototype.onLingquHandler=function(){app.ProtocolRequest.GetOtherGiftReq(this._data.id)};e.prototype.onDisplay=function(){};e.prototype.onUnDisplay=function(){};e.prototype.setData=function(t){var e=this;this._data=t;this.clipshuzi.value=+t.cfg.recharge/100+"";this.btnchongzhi.label=+t.cfg.recharge/100+"元";this.gezilist.array=game.ItemUtil.parserList(t.cfg.reward);this.callLater(function(){e.wenziimg.x=e.clipshuzi.x+e.clipshuzi.width+10});this.imgyilingqu.visible=false;this.btnlingqu.visible=false;this.btnchongzhi.visible=false;if(t.net){this.xiangoulab.text="限购："+(+t.cfg.limit-t.net.buynum)+"/"+t.cfg.limit+"次";if(t.net.status==0){this.btnchongzhi.visible=true}else if(t.net.status==1){this.btnlingqu.visible=true}else{this.imgyilingqu.visible=true}}else{this.xiangoulab.text="限购："+t.cfg.limit+"/"+t.cfg.limit+"次";this.btnchongzhi.visible=true}};return e}(ui.xinshangcheng.zhoulibaoitemUI);i.LiBaoItem=t})(huodong||(huodong={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var huodong;(function(n){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listdaoju.itemRender=grids.GridView;this.listdaoju.renderHandler=new Laya.Handler(this,this.onItemRender);this.on(Laya.Event.CLICK,this,this.onChongZhiHandler);this._model=n.WeekMonthForeverModel.getIns();this.imgxuanzhong.visible=false};e.prototype.onItemRender=function(t){t.setData(t.dataSource);t.setCntScale(this.listdaoju.scaleX)};e.prototype.onChongZhiHandler=function(){var t=+this._data.id;var e=this._data.net?this._data.net.buynum:0;var i=+(this._data.cfg.limit-e);if(this._data.cfg.recharge==0){app.ProtocolRequest.GetOtherGiftReq(t)}else{app.ViewManager.toggleDialog(n.NewLiBaoTips,1,0,[this._data.cfg,this.funId,i])}};e.prototype.onLingquHandler=function(){app.ProtocolRequest.GetOtherGiftReq(this._data.id)};e.prototype.onDisplay=function(){};e.prototype.onUnDisplay=function(){};e.prototype.onWidthChange=function(){var t=this.clipmoney.width;this.clipmoney.x=(this.boxmoney.width-t-this.imgmoney.width)/2;this.imgmoney.x=this.clipmoney.x+t+10};e.prototype.setData=function(t,e){this._data=t;this.funId=e;this.imgbaoxiang.skin=t.cfg.res;game.RedDotView.removeFrom(this);if(+t.cfg.recharge==0){this.boxmoney.visible=false;this.imgmianfei.visible=true}else{this.boxmoney.visible=true;this.imgmianfei.visible=false}if(t.cfg.showicon!=""){this.imgdaoju.skin=csv.ItemProxy.getUrl(t.cfg.showicon)}else{this.imgdaoju.skin=""}this.clipmoney.value=+t.cfg.recharge/100+"";this.zhekou.skin="";this.imgjiaobiao.skin=t.cfg.subscript;this.clipmoney.on(Laya.Event.RESIZE,this,this.onWidthChange);this.listdaoju.array=game.ItemUtil.parserList(t.cfg.reward);this.mouseEnabled=true;if(t.net){this.labelnum.text="限购："+(+t.cfg.limit-t.net.buynum)+"/"+t.cfg.limit+"次";if(t.net.status==0){this.labelnum.visible=true;this.imgtitlebg.visible=true;this.imgshouqin.visible=false}else{this.labelnum.visible=false;this.imgtitlebg.visible=false;this.imgshouqin.visible=true;this.mouseEnabled=false}}else{this.labelnum.visible=true;this.imgtitlebg.visible=true;this.labelnum.text="限购："+t.cfg.limit+"/"+t.cfg.limit+"次";this.imgshouqin.visible=false}if(+t.cfg.recharge==0&&!t.net){game.RedDotView.addTo(this)}};return e}(ui.xinshangcheng2.huodonglibaoitem02UI);n.NewLiBaoItem=t})(huodong||(huodong={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var huodong;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.listdaoju.itemRender=grids.GridView;this.listdaoju.renderHandler=grids.GridView.CommonItemRender;this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.quedingbtn.clickHandler=new Laya.Handler(this,this.onClickHandler)};e.prototype.onClickHandler=function(){shop.ShopModel.getIns().chongzhi(this.rechargeCfg.id);app.ViewManager.toggleDialog(i.NewLiBaoTips,-1)};e.prototype.onDisplay=function(){this.callLater(this.onCallter)};e.prototype.onCallter=function(){var t=this.dataSource[0];var e=this.dataSource[1];var i=this.dataSource[2];this.titleimg.text=app.getLang(csv.FunctionsProxy.getIns().getCfg(e).windowname);this.rechargeCfg=t;newshangcheng.NewShangChengModel.getIns().setListVaule(this.listdaoju,t.reward);this.label01.text=app.getLang("xinshangcheng_01",i,t.limit);this.quedingbtn.label=app.getLang("xinshangcheng_02",app.convert_Yuan(t.recharge))};e.SINGLE_KEY="huodong.NewLiBaoTips";return e}(ui.xinshangcheng2.huodonglibaotipUI);i.NewLiBaoTips=t})(huodong||(huodong={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var huodong;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listbaoxiang.repeatX=3;this.listbaoxiang.itemRender=i.NewLiBaoItem;this.listbaoxiang.renderHandler=new Laya.Handler(this,this.onRenderHandler);this._model=i.WeekMonthForeverModel.getIns()};e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll);this.updateTime();Laya.timer.loop(1e3,this,this.updateTime);i.HuoDongShangChengModel.getIns().on(i.HuoDongEvent.EVENT_MALL_INFO_NTF,this,this.refreshAll)};e.prototype.onUnDisplay=function(){Laya.timer.clearAll(this);i.HuoDongShangChengModel.getIns().off(i.HuoDongEvent.EVENT_MALL_INFO_NTF,this,this.refreshAll)};e.prototype.refreshAll=function(){var t=csv.RechargeProxy.getIns().getCfgByType(18);newshangcheng.Huodonglibaoview.skinFull(this);this.imgbanner.skin=t.res;var e=this._model.getDayGiftArr();this.listbaoxiang.array=e.sort(function(t,e){if(t.net&&t.net.status==2){return 1}if(e.net&&e.net.status==2){return-1}})};e.prototype.updateTime=function(){var t=game.Context.getServerZeroTime()+24*60*60-game.Context.getServerTime();this.labeldaojishi.text="重置时间："+util.TimeUtil.sec2Str(t)};e.prototype.onRenderHandler=function(t,e){t.setData(t.dataSource,csv.FunctionsProxy.ENUMS.DAY_AWARD)};e.prototype.openView=function(){app.ViewManager.toggleDialog(i.ZhouLiBaoview,1,0)};return e}(ui.xinshangcheng2.huodonglibaoviewUI);i.NewRiLiBaoview=t})(huodong||(huodong={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var huodong;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listbaoxiang.repeatX=3;this.listbaoxiang.itemRender=i.NewLiBaoItem;this.listbaoxiang.renderHandler=new Laya.Handler(this,this.onRenderHandler);this._model=i.WeekMonthForeverModel.getIns()};e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll);this.updateTime();Laya.timer.loop(1e3,this,this.updateTime);i.HuoDongShangChengModel.getIns().on(i.HuoDongEvent.EVENT_MALL_INFO_NTF,this,this.refreshAll)};e.prototype.onUnDisplay=function(){Laya.timer.clearAll(this);i.HuoDongShangChengModel.getIns().off(i.HuoDongEvent.EVENT_MALL_INFO_NTF,this,this.refreshAll)};e.prototype.refreshAll=function(){var t=csv.RechargeProxy.getIns().getCfgByType(15);newshangcheng.Huodonglibaoview.skinFull(this);this.imgbanner.skin=t.res;var e=this._model.getMonthGiftArr();this.listbaoxiang.array=e.sort(function(t,e){if(t.net&&t.net.status==2){return 1}if(e.net&&e.net.status==2){return-1}})};e.prototype.updateTime=function(){var t=util.TimeUtil.getMonthEndTime(game.Context.getServerTime());this.labeldaojishi.text="重置时间："+util.TimeUtil.sec2Str(t)};e.prototype.onRenderHandler=function(t,e){t.setData(t.dataSource,csv.FunctionsProxy.ENUMS.MONTH_AWARD)};e.prototype.openView=function(){app.ViewManager.toggleDialog(i.ZhouLiBaoview,1,0)};return e}(ui.xinshangcheng2.huodonglibaoviewUI);i.NewYueLiBaoview=t})(huodong||(huodong={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var huodong;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listbaoxiang.repeatX=3;this.listbaoxiang.itemRender=i.NewLiBaoItem;this.listbaoxiang.renderHandler=new Laya.Handler(this,this.onRenderHandler);this._model=i.WeekMonthForeverModel.getIns()};e.getIns=function(){return app.Singleton.getInstance(i.ZhouLiBaoview)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll);this.updateTime();Laya.timer.loop(1e3,this,this.updateTime);i.HuoDongShangChengModel.getIns().on(i.HuoDongEvent.EVENT_MALL_INFO_NTF,this,this.refreshAll)};e.prototype.onUnDisplay=function(){Laya.timer.clearAll(this);i.HuoDongShangChengModel.getIns().off(i.HuoDongEvent.EVENT_MALL_INFO_NTF,this,this.refreshAll)};e.prototype.refreshAll=function(){var t=csv.RechargeProxy.getIns().getCfgByType(14);this.imgbanner.skin=t.banner;newshangcheng.Huodonglibaoview.skinFull(this);var e=this._model.getWeekGiftArr();this.listbaoxiang.array=e.sort(function(t,e){if(t.net&&e.net){if(t.net.status==e.net.status){return t.cfg.recharge-e.cfg.recharge}else{if(t.net.status==2){return 1}if(e.net.status==2){return-1}}}else{if(t.net&&t.net.status==2){return 1}if(e.net&&e.net.status==2){return-1}return t.cfg.recharge-e.cfg.recharge}})};e.prototype.updateTime=function(){var t=util.TimeUtil.getWeekEndTimeNow(game.Context.getServerTime());this.labeldaojishi.text="重置时间："+util.TimeUtil.sec2Str(t)};e.prototype.onRenderHandler=function(t,e){t.setData(t.dataSource,csv.FunctionsProxy.ENUMS.WEEK_AWARD)};e.prototype.openView=function(){app.ViewManager.toggleDialog(i.ZhouLiBaoview,1,0)};return e}(ui.xinshangcheng2.huodonglibaoviewUI);i.NewZhouLiBaoview=t})(huodong||(huodong={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var huodong;(function(n){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}Object.defineProperty(e.prototype,"model",{get:function(){return n.HuoDongShangChengModel.getIns()},enumerable:true,configurable:true});e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.libaolist.repeatX=1;this.libaolist.itemRender=i;this.libaolist.renderHandler=new Laya.Handler(this,this.onRenderHandler);this.activityTimeView=new activitytaren.ActivityTimeView(this.shijian,new Laya.Handler(this,this.endTimeCallBack),app.getLang("huodong_text_10"))};e.prototype.endTimeCallBack=function(){this.shijian.text=""};e.prototype.onDisplay=function(){this.callLater(this.refreshAll);this.model.on(n.HuoDongEvent.EVENT_MALL_INFO_NTF,this,this.refreshAll);this.model.on(n.HuoDongEvent.EVENT_RED_CHECK,this,this.refreshAll)};e.prototype.onRenderHandler=function(t,e){t.setData(t.dataSource,this._vo)};e.prototype.refreshAll=function(){var t=this.dataSource[0];if(t){this._vo=t;this.libaolist.array=this.model.getLimitList(this._vo);var e=t.end_time;this.activityTimeView.start(e)}};e.prototype.onUnDisplay=function(){this.model.off(n.HuoDongEvent.EVENT_MALL_INFO_NTF,this,this.refreshAll);this.model.off(n.HuoDongEvent.EVENT_RED_CHECK,this,this.refreshAll);this.activityTimeView.stop();this.shijian.text=""};return e}(ui.xinshangcheng.xianshilibaoUI);n.XianshilibaoView=t;var i=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}Object.defineProperty(e.prototype,"model",{get:function(){return n.HuoDongShangChengModel.getIns()},enumerable:true,configurable:true});e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.gezilist.itemRender=grids.GridView;this.gezilist.renderHandler=grids.GridView.CommonItemRender;this.btnlingqu.clickHandler=new Laya.Handler(this,this.onLingquHandler);this.btnchongzhi.clickHandler=new Laya.Handler(this,this.onChongZhiHandler);game.RedDotView.addTo(this.btnlingqu)};e.prototype.onChongZhiHandler=function(){if(this._vo&&this._vo.isOpen==false){manager.FlowManager.instance.flowByStyle1(app.getLang("huodong_text_14"));return}var t=+this.cfg.id;shop.ShopModel.getIns().chongzhi(t)};e.prototype.onLingquHandler=function(){app.ProtocolRequest.GetOtherGiftReq(this.cfg.id)};e.prototype.onDisplay=function(){};e.prototype.onUnDisplay=function(){};e.prototype.onTxtResize=function(){this.wenziimg.x=this.clipshuzi.x+this.clipshuzi.width+10};e.prototype.setData=function(t,e){this._vo=e;this.cfg=t;this.gezilist.array=game.ItemUtil.parserList(t.reward);this.clipshuzi.value=app.convert_Yuan(t.recharge).toString();this.btnchongzhi.label=app.convert_Yuan(t.recharge).toString()+app.getLang("shop_text_1");this.callLater(this.onTxtResize);var i=this.model.getGift(t.id);this.imgyilingqu.visible=false;this.btnlingqu.visible=false;this.btnchongzhi.visible=false;if(i){this.xiangoulab.text=app.getLang("huodong_text_09",t.limit-i.buynum,t.limit);switch(this.model.getChengZhangLiBaoStatus(t.id)){case n.EChengZhangLiBaoStatus.WeiGouMai:this.btnchongzhi.visible=true;break;case n.EChengZhangLiBaoStatus.CanLinQu:this.btnlingqu.visible=true;break;case n.EChengZhangLiBaoStatus.AlreadyLingQuFinish:this.imgyilingqu.visible=true;break}}else{this.xiangoulab.text=app.getLang("huodong_text_09",t.limit,t.limit);this.btnchongzhi.visible=true}if(e.isOpen){this.btnchongzhi.gray=false}else{this.btnchongzhi.gray=true}};return e}(ui.xinshangcheng.zhoulibaoitemUI)})(huodong||(huodong={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var huodong;(function(r){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.panellibaoList=new list.JListCustom;t.fullScreen="fullScreen";t.hMap={};t.oldList=[];return t}t.getIns=function(){return app.Singleton.getInstance(t)};Object.defineProperty(t.prototype,"model",{get:function(){return r.HuoDongShangChengModel.getIns()},enumerable:true,configurable:true});t.prototype.getHeight=function(t){var e="xinshangcheng_zhu_item0"+t+"UI";if(!this.hMap[e]){var i=Laya.Pool.getItemByClass(e,ui.xinshangcheng["xinshangcheng_zhu_item0"+t+"UI"]);this.hMap[e]=i.height;Laya.Pool.recover(e,i)}return this.hMap[e]};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.panellibao.vScrollBarSkin="";this.btnviptequan.clickHandler=new Laya.Handler(this,this.onVipHandler)};t.prototype.onVipHandler=function(){game.ClosureManager.callFunction(csv.FunctionsProxy.ENUMS.VIP)};t.prototype.onAni2Complete=function(){this.ani3.play(0,true);this.onResizeHandler();this.callLater(this.onRefreshHandler)};t.prototype.onResizeHandler=function(){if(!this.panellibaoBottom){this.panellibaoBottom=this.imgdiban.height-this.panellibao.y-this.panellibao.height}if(!this.panellibaoY){this.panellibaoY=this.panellibao.y}this.imgdiban.x=-this.x;this.imgdiban.y=-this.y;this.imgdiban.width=Laya.stage.width;this.imgdiban.height=Laya.stage.height;if(!this.xiajiantouOffsetY){this.xiajiantouOffsetY=this.xiajiantou.y-this.boxfanhui.y;this.xiajiantou.bottom=undefined}this.boxfanhui.x=this.imgdiban.x;this.boxfanhui.y=this.imgdiban.y+this.imgdiban.height-this.boxfanhui.height-ScreenAdapter.OFFSET_BOTTOM;this.boxbtn.x=this.imgdiban.x+this.imgdiban.width-this.boxbtn.width;this.boxbtn.y=this.imgdiban.y+this.imgdiban.height-this.boxbtn.height-ScreenAdapter.OFFSET_BOTTOM;this.xiajiantou.x=this.boxfanhui.x+this.imgdiban.width/2;this.xiajiantou.y=this.boxfanhui.y+this.xiajiantouOffsetY;this.panellibao.y=this.imgdiban.y+ScreenAdapter.OFFSET_Y+this.panellibaoY;this.panellibao.height=this.imgdiban.y+this.imgdiban.height-this.panellibaoBottom-ScreenAdapter.OFFSET_BOTTOM-this.panellibao.y;this.hitArea=new Laya.Rectangle(this.imgdiban.x,this.imgdiban.y,this.imgdiban.width,this.imgdiban.height)};t.prototype.onDisplay=function(){this.model.isCloseXinIcon=true;this.model.onCheckHandlerRed();app.SoundManager.getIns().playSound("functionopen");this.on(Laya.Event.RESIZE,this,this.onResizeHandler);this.ani2.on(Laya.Event.COMPLETE,this,this.onAni2Complete);this.ani2.play(0,false);this.ani4.play(0,true);this.model.on(r.HuoDongEvent.EVENT_RED_CHECK,this,this.onRedCheck);vipcode.VipModel.getIns().on(vipcode.VipEvent.VIP_CHANGE,this,this.onVipRedDotChange)};t.prototype.onRedCheck=function(){this.onRefreshHandler(true)};t.prototype.onVipRedDotChange=function(){if(vipcode.VipModel.getIns().updataVipRed()){game.RedDotView.addTo(this.btnviptequan,282,35)}else{game.RedDotView.removeFrom(this.btnviptequan)}};t.prototype.onRefreshHandler=function(t){this.panellibaoList.init(this.panellibao);this.panellibaoList.clear();var e=false;var i=r.HuoDongShangChengProxy.getIns().getFloorlist();if(this.oldList&&this.oldList.length!=i.length){e=true}this.oldList=i;for(var n=0;n<i.length;n++){var a=i[n];var o=this.getHeight(a.curIconType);this.panellibaoList.split([a],l,o)}var s=0;if(!e){s=this.panellibao.vScrollBar.value}if(t){}else{for(var n=0;n<i.length;n++){i[n].needPlayAnim=true}s=0}this.panellibaoList.end(s);this.panellibaoList.on(list.JListCustom.EVENT_END,this,this.onAnimComolete,[i]);this.onVipRedDotChange()};t.prototype.onAnimComolete=function(t){for(var e=0;e<t.length;e++){t[e].needPlayAnim=false}if(this.panellibaoList.isLastDraw()){this.xiajiantou.visible=false}else{this.xiajiantou.visible=true}};t.prototype.onUnDisplay=function(){app.SoundManager.getIns().playSound("functionclose");this.off(Laya.Event.RESIZE,this,this.onResizeHandler);this.ani3.stop();this.ani2.stop();this.ani4.stop();vipcode.VipModel.getIns().off(vipcode.VipEvent.VIP_CHANGE,this,this.onVipRedDotChange);this.model.off(r.HuoDongEvent.EVENT_RED_CHECK,this,this.onRedCheck);if(app.ViewManager.DisplayedInStage(shouchonghaoli.QitianleichongView)){shouchonghaoli.QitianleichongView.getIns().onMoneyChange()}};t.SINGLE_KEY="huodong.Xinshangchengview";t.txtDEBUG=false;return t}(ui.xinshangcheng.xinshangchengviewUI);r.Xinshangchengview=t;var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e}(Laya.Sprite);var i=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t.bubbleCls="huodong.XinShangChengZhuQiPaoItemView";t._tipsList=[];t.on(Laya.Event.UNDISPLAY,t,t.onUnDisplay);return t}Object.defineProperty(t.prototype,"model",{get:function(){return r.HuoDongShangChengModel.getIns()},enumerable:true,configurable:true});t.prototype.onUnDisplay=function(){this.clear()};t.prototype.clear=function(){if(this.view){this.view.removeSelf();for(var t=0;t<this.richList.length;t++){var e=this.richList[t];e.clear()}}while(this._tipsList.length>0){var i=this._tipsList.pop();Laya.Pool.recover(this.bubbleCls,i)}this.view.ani1.stop();this.view.ani2.stop();this.view.animation01.stop();this.view.animation02.stop();this.view.animation12.stop();this.view.animation13.stop();this.view.animation01.visible=false;this.view.animation02.visible=false;this.view.animation12.visible=false;this.view.animation13.visible=false};t.prototype.onClickHandler=function(t){switch(t.cfg.type){case r.EHuoDongType.FreeGift:app.ProtocolRequest.GetFreeGiftReq();break;case r.EHuoDongType.EveryDayTeHui:break;case r.EHuoDongType.JiTianHaoLi:app.ViewManager.toggleDialog(shouchonghaoli.DuoRiChongZhijiangliView,1,0,null,null,null,true,csv.FunctionsProxy.ENUMS.LIAN_XU_LEI_CHONG);break;case r.EHuoDongType.Month:app.ViewManager.toggleDialog(monthCard.MonthCardMainViewNew,1,0);break;case r.EHuoDongType.TouZiLiCai:app.ViewManager.toggleDialog(touzilic.TouZiLiCaiView,1,0,[t]);break;case r.EHuoDongType.ChengZhangJiJing:app.ViewManager.toggleDialog(chengzhanjijing.ChengZhanJiJingView,1,0);break;case r.EHuoDongType.WeekLiBao:app.ViewManager.toggleDialog(r.ZhouLiBaoview,1,0);break;case r.EHuoDongType.MonthLiBao:app.ViewManager.toggleDialog(r.YueLiBaoview,1,0);break;case r.EHuoDongType.ZhongShengKa:app.ViewManager.toggleDialog(r.ForeverCardView,1,0);break;case r.EHuoDongType.Week:app.ViewManager.toggleDialog(r.ZhouCardView,1,0);break;case r.EHuoDongType.OneTimeGift:app.ViewManager.toggleDialog(r.ChengZhangLiBao,1,0);break;case r.EHuoDongType.LimtGift:app.ViewManager.toggleDialog(r.XianshilibaoView,1,0,[t]);break}};t.prototype.setData=function(t){this._vo=t;if(t){var e=new ui.xinshangcheng["xinshangcheng_zhu_item0"+t.curIconType+"UI"];this.view=e;this.richList=[];this.richList.push(new n(this.view.txttime01,this.view.imgimgtxtdiban01,this.view.imgyilingqu01,this.view.imgyigoumai01));this.richList.push(new n(this.view.txttime02,this.view.imgimgtxtdiban02,this.view.imgyilingqu02,this.view.imgyigoumai02));this.richList.push(new n(this.view.txttime03,this.view.imgimgtxtdiban03,this.view.imgyilingqu03,this.view.imgyigoumai03));this.clear();var i=[];switch(t.curIconType){case 1:i.push(e.btnmianfeilibao,e.btnjitianhaoli,e.btnmeiritehui);break;case 2:i.push(e.btnyicixinglibao);break;case 3:i.push(e.btnyueka,e.btnzhouka,e.btnzhongshenka);break;case 4:i.push(e.btntouzilicai,e.btnchengzhangjijin);break;case 5:i.push(e.btnzhoulibao);break;case 6:i.push(e.btnyuelibao);break}this.btns=i;this.addChild(this.view);e.on(Laya.Event.DISPLAY,this,this.onViewDisplay);e.on(Laya.Event.UNDISPLAY,this,this.onViewUnDisplay)}};t.prototype.addTips=function(t){if(this.view){this.view.addChild(t)}};t.prototype.updateBtn=function(t,e,i){t.skin=e.cfg.icon_res;t.clickHandler=new Laya.Handler(this,this.onClickHandler,[e]);if(e.hasRed()){var n=10;if(t.scaleX<0){game.RedDotView.addTo(t,n)}else{game.RedDotView.addTo(t,t.width,n)}}else{game.RedDotView.removeFrom(t)}this.timeTickHandler(e,i);if(this.model.needShowCanLingQuTxt(e.getType())){if(this.model.getRed(e)){i.setText(app.getLang("huodong_text_13"))}}if(e.hasBubble()||e.isDialog()){var a=Laya.Pool.getItemByClass(this.bubbleCls,r.XinShangChengZhuQiPaoItemView);a.clear();a.setData(e);if(this._vo.needPlayAnim){this.view.ani1.once(Laya.Event.COMPLETE,this,this.addTips,[a])}else{this.view.addChild(a)}this._tipsList.push(a)}i.setGouMai(e.isShowIsBuy());i.setLingQu(e.isShowIsLingQu())};t.prototype.onReresh=function(){var t=this._vo;for(var e=0;e<t.huodonglist.length;e++){var i=t.huodonglist[e];var n=this.btns[e];if(n){var a=this.richList[e];this.updateBtn(n,i,a)}}};t.prototype.timeTickHandler=function(t,e){var i=t.getSubTime();if(this.view.parent){if(i>0){e.setText(t.getTimeStr(i));Laya.timer.once(1e3,this,this.timeTickHandler,[t,e])}else{e.setText("")}}};t.prototype.onViewUnDisplay=function(){this.view.ani1.off(Laya.Event.COMPLETE,this,this.addTips);this.skt&&this.skt.stop();this.model.off(r.HuoDongEvent.EVENT_FREE_GIFT,this,this.onFreeGift);this.model.off(r.HuoDongEvent.EVENT_MALL_INFO_NTF,this,this.onFreeGift);this.model.off(r.HuoDongEvent.EVENT_RED_CHECK,this,this.onFreeGift);activitytaren.ActivityTaRenModel.getIns().off(activitytaren.ActivityTaRenModel.ACTIVIT_TAREN_EVENT.UPDATE_ACTIVIT_DATA,this,this.onFreeGift)};t.prototype.setAvatar=function(t){if(!this.view.spritehulu){return}if(this.skt&&this.skt.parent){this.skt.removeSelf()}else{this.skt=new common.CSkt}this.skt.init(t);this.view.spritehulu.addChild(this.skt)};t.prototype.onViewDisplay=function(){activitytaren.ActivityTaRenModel.getIns().on(activitytaren.ActivityTaRenModel.ACTIVIT_TAREN_EVENT.UPDATE_ACTIVIT_DATA,this,this.onFreeGift);this.model.on(r.HuoDongEvent.EVENT_FREE_GIFT,this,this.onFreeGift);this.model.on(r.HuoDongEvent.EVENT_MALL_INFO_NTF,this,this.onFreeGift);this.model.on(r.HuoDongEvent.EVENT_RED_CHECK,this,this.onFreeGift);this.setAvatar("res/sks/hulu.sk");this.onReresh();if(this._vo.needPlayAnim){this.view.ani1.play(0,false);this.view.ani1.once(Laya.Event.COMPLETE,this,this.onAnimComplete)}else{this.view.ani1.gotoAndStop(this.view.ani1.count-1);this.onAnimComplete()}var t=[];switch(this._vo.effect){case 1:t.push(this.view.animation01,this.view.animation02);break;case 2:t.push(this.view.animation12,this.view.animation13);break}for(var e=0;e<t.length;e++){if(t[e]){t[e].visible=true;t[e].play(0,true)}}};t.prototype.onFreeGift=function(){this.onReresh()};t.prototype.onAnimComplete=function(){this.view.ani2.play(0,true)};return t}(Laya.Sprite);var l=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.clsKey="XinshangchengZhuItem";return t}t.prototype.createNode=function(t){var e=Laya.Pool.getItemByClass(this.clsKey,i);e.setData(this.list[t]);e.x=t*e.width;e.y=this.y;return e};return t}(list.RowMoveBaseNode);var n=function(){function t(t,e,i,n){this.txt=t;if(t){t.cacheAsBitmap=true}this.img=e;this.lingqu=i;this.imgyigoumai=n}t.prototype.setText=function(t){if(this.txt){this.txt.text=t;if(t.length<=0){this.img.visible=false}else{this.img.visible=true}}};t.prototype.setLingQu=function(t){if(this.lingqu){this.lingqu.visible=t}};t.prototype.setGouMai=function(t){if(this.imgyigoumai){this.imgyigoumai.visible=t}};t.prototype.clear=function(){this.setText("");this.setGouMai(false);this.setLingQu(false)};return t}()})(huodong||(huodong={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var huodong;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};Object.defineProperty(e.prototype,"model",{get:function(){return i.HuoDongShangChengModel.getIns()},enumerable:true,configurable:true});e.prototype.onDisplay=function(){this.callLater(this.onRefresh)};e.prototype.onUIComplete=function(){this.setXY();this.imgdiban01.skin=this._vo.cfg.dailog};e.prototype.setXY=function(){var t=Laya.loader.getRes(this._vo.cfg.dailog);this.imgdiban01.width=t.width;this.imgdiban01.height=t.height;if(this._vo.cfg.direct==1){this.x=this.imgdiban01.width/2+50}else{if(this.parent){this.x=this.parent.width-this.imgdiban01.width/2}}if(this.parent){this.y=0}this.txtmiaoshu.leading=0;this.txtmiaoshu.y=this.imgdiban01.height/2-this.txtmiaoshu.fontSize*2-10};e.prototype.setImg=function(){Laya.loader.load([{url:this._vo.cfg.dailog,type:Laya.Loader.IMAGE}],Laya.Handler.create(this,this.onUIComplete))};e.prototype.onRefresh=function(){if(this._vo.cfg.dailog==""){this.graphics.clear();this.graphics.drawRect(0,0,this.width,this.height,null,"#ff0000",2)}this.txtmiaoshu.text="";this.setImg();if(this._vo.hasBubble()){this.timeTickHandler(this._vo,this.txtmiaoshu)}};e.prototype.clear=function(){Laya.timer.clear(this,this.timeTickHandler)};e.prototype.setData=function(t){this._vo=t;this.onRefresh()};e.prototype.timeTickHandler=function(t,e){var i=t.getBubbleSubTime();if(this.parent&&e){if(i>0){e.text=t.getTimeStr(i);Laya.timer.once(1e3,this,this.timeTickHandler,[t,e])}else{e.text="";this.removeSelf()}}};e.prototype.onUnDisplay=function(){this.graphics.clear()};return e}(ui.xinshangcheng.xinshangcheng_zhu_qipaoitemUI);i.XinShangChengZhuQiPaoItemView=t})(huodong||(huodong={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var huodong;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.libaolist.repeatX=1;this.libaolist.itemRender=i.LiBaoItem;this.libaolist.renderHandler=new Laya.Handler(this,this.onRenderHandler);this._model=i.WeekMonthForeverModel.getIns();this.labeihunpohecheng.text=app.getLang("月礼包")};e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll);this.updateTime();Laya.timer.loop(1e3,this,this.updateTime);i.HuoDongShangChengModel.getIns().on(i.HuoDongEvent.EVENT_MALL_INFO_NTF,this,this.refreshAll)};e.prototype.onUnDisplay=function(){Laya.timer.clearAll(this);i.HuoDongShangChengModel.getIns().off(i.HuoDongEvent.EVENT_MALL_INFO_NTF,this,this.refreshAll)};e.prototype.refreshAll=function(){var t=this._model.getMonthGiftArr();this.libaolist.array=t.sort(function(t,e){if(t.net&&t.net.status==2){return 1}if(e.net&&e.net.status==2){return-1}})};e.prototype.updateTime=function(){var t=util.TimeUtil.getMonthEndTime(game.Context.getServerTime());this.shijian.text="重置时间："+util.TimeUtil.sec2Str(t)};e.prototype.onRenderHandler=function(t,e){t.setData(t.dataSource)};e.prototype.openView=function(){app.ViewManager.toggleDialog(e,1,0)};return e}(ui.xinshangcheng.yuelibaoUI);i.YueLiBaoview=t})(huodong||(huodong={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var huodong;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.gezilist.itemRender=grids.GridView;this.gezilist.renderHandler=new Laya.Handler(this,this.onItemRender);this.btnchongzhi.clickHandler=new Laya.Handler(this,this.onChongZhiHandler);this.btnweikaiqi.gray=true;this._model=i.WeekMonthForeverModel.getIns()};e.prototype.onItemRender=function(t){t.setData(t.dataSource);t.setCntScale(this.gezilist.scaleX)};e.prototype.onChongZhiHandler=function(){app.ProtocolRequest.ReceiveWeekCardRewardReq(this._data.day)};e.prototype.onDisplay=function(){};e.prototype.onUnDisplay=function(){};e.prototype.setData=function(t){this._data=t;this.gezilist.array=game.ItemUtil.parserList(t.cfg.reward);this.btnchongzhi.visible=false;this.btnweikaiqi.visible=false;this.imgyilingqu.visible=false;this.wenziimg.skin="res/static/xinshangcheng/bg_zhouka_tianshu0"+t.day+".png";if(t.state==0||t.state==1){this.btnweikaiqi.visible=true}else if(t.state==2){this.btnchongzhi.label="领取";this.btnchongzhi.gray=false;this.btnchongzhi.mouseEnabled=true;this.btnchongzhi.visible=true;game.RedDotView.addTo(this.btnchongzhi)}else{this.imgyilingqu.visible=true;game.RedDotView.removeFrom(this.btnchongzhi)}};return e}(ui.xinshangcheng2.zhoukaitemUI);i.ZhouCardItem=t})(huodong||(huodong={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var huodong;(function(l){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listdaoju.itemRender=grids.GridView;this.listdaoju.renderHandler=new Laya.Handler(this,this.onItemRender);this.listliebiao.itemRender=l.ZhouCardItem;this.listliebiao.renderHandler=new Laya.Handler(this,this.onRenderHandler);this._model=l.WeekMonthForeverModel.getIns();this.btnmonth.clickHandler=new Laya.Handler(this,this.onChongZhiHandler)};e.prototype.onItemRender=function(t){t.setData(t.dataSource);t.setCntScale(this.listdaoju.scaleX)};e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.onDisplay=function(){app.ProtocolRequest.WeekCardInfoReq();this._model.on(l.WeekMonthForeverModel.WEEK_CARD_CHANGE,this,this.refreshAll);this.anniutexiao.play(0,true)};e.prototype.onUnDisplay=function(){this._model.off(l.WeekMonthForeverModel.WEEK_CARD_CHANGE,this,this.refreshAll)};e.prototype.refreshAll=function(){if(this._model.weekNetData&&this._model.weekNetData.buyTime!=0){var t=game.Context.getServerZeroTime(this._model.weekNetData.buyTime);var e=t+7*24*3600;var i=e-game.Context.getServerTime();if(i<3600*24){this.labeltishi.text=util.TimeUtil.sec2Str(i)+"后可以购买"}else{this.labeltishi.text="剩余"+util.TimeUtil.sec2Str(i,false,1)+"可领取"}this.btnmonth.label="已购买";this.btnmonth.gray=true;this.btnmonth.mouseEnabled=false;this.anniutexiao.visible=false}else{this.btnmonth.label=csv.RechargeProxy.getIns().getCfgByType(4).recharge/100+"元购买";this.btnmonth.gray=false;this.btnmonth.mouseEnabled=true;this.labeltishi.text="";this.anniutexiao.visible=true}var n=this._model.getWeekCardArr();var a=l.HuoDongShangChengProxy.getIns().getWeekCardCfgArr();var o={};a.map(function(t){var e=t.reward.split(";");e.map(function(t){var e=t.split("-");if(o[e[0]]){o[e[0]]+=+e[1]}else{o[e[0]]=+e[1]}})});var s="";for(var r in o){s+=r+"-"+o[r]+";"}this.lingqu1.text=csv.RechargeProxy.getIns().getCfgByType(4).reward.split("-")[1];this.listdaoju.array=game.ItemUtil.parserList(s);this.listliebiao.array=n.sort(function(t,e){if(t.state==3){return 1}if(e.state==3){return-1}})};e.prototype.onRenderHandler=function(t,e){t.setData(t.dataSource)};e.prototype.onChongZhiHandler=function(){var t=csv.RechargeProxy.getIns().getCfgByType(4);var e=t.id;shop.ShopModel.getIns().chongzhi(e)};e.prototype.openView=function(){app.ViewManager.toggleDialog(l.ZhouCardView,1,0)};return e}(ui.xinshangcheng2.zhoukaviewUI);l.ZhouCardView=t})(huodong||(huodong={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var huodong;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.libaolist.repeatX=1;this.libaolist.itemRender=i.LiBaoItem;this.libaolist.renderHandler=new Laya.Handler(this,this.onRenderHandler);this._model=i.WeekMonthForeverModel.getIns()};e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll);this.updateTime();Laya.timer.loop(1e3,this,this.updateTime);i.HuoDongShangChengModel.getIns().on(i.HuoDongEvent.EVENT_MALL_INFO_NTF,this,this.refreshAll)};e.prototype.onUnDisplay=function(){Laya.timer.clearAll(this);i.HuoDongShangChengModel.getIns().off(i.HuoDongEvent.EVENT_MALL_INFO_NTF,this,this.refreshAll)};e.prototype.refreshAll=function(){var t=this._model.getWeekGiftArr();this.libaolist.array=t.sort(function(t,e){if(t.net&&t.net.status==2){return 1}if(e.net&&e.net.status==2){return-1}})};e.prototype.updateTime=function(){var t=util.TimeUtil.getWeekEndTimeNow(game.Context.getServerTime());this.shijian.text="重置时间："+util.TimeUtil.sec2Str(t)};e.prototype.onRenderHandler=function(t,e){t.setData(t.dataSource)};e.prototype.openView=function(){app.ViewManager.toggleDialog(i.ZhouLiBaoview,1,0)};return e}(ui.xinshangcheng.zhoulibaoUI);i.ZhouLiBaoview=t})(huodong||(huodong={}));var huodong;(function(s){var t=function(){function t(t,e){this.needPlayAnim=false;this.floor=t;this._cfgList=e;this.huodonglist=[];for(var i=0;i<this._cfgList.length;i++){this.huodonglist.push(new n(this._cfgList[i]))}}t.prototype.isOpen=function(){for(var t=0;t<this.huodonglist.length;t++){var e=this.huodonglist[t];if(e.isOpen){return true}}return false};t.prototype.hasRed=function(){if(this.huodonglist){for(var t=0;t<this.huodonglist.length;t++){if(this.huodonglist[t].hasRed()){return true}}}return false};Object.defineProperty(t.prototype,"effect",{get:function(){var t=0;for(var e=0;e<this._cfgList.length;e++){if(this._cfgList[e].effect!=0){t=this._cfgList[e].effect}}return t},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"curIconType",{get:function(){if(this._cfgList&&this._cfgList.length){return this._cfgList[this._cfgList.length-1].icon}return 1},enumerable:true,configurable:true});return t}();s.HuoDongFloorVo=t;var n=function(){function t(t){this.cfg=t;if(t.type==s.EHuoDongType.JiTianHaoLi){activitytaren.ActivityTaRenModel.getIns().on(activitytaren.ActivityIconStatuManager.EVENT_ACRIVITY_SINGLE_VISIBLE,this,this.onShowHide)}this.start_time=this.model.getStartTime(t);this.end_time=this.model.getEndTime(t);this.onCheckStart()}t.prototype.getRechargeList=function(){var t=[];if(this.cfg.recharge&&this.cfg.recharge.length>0){var e=this.cfg.recharge.split(";");for(var i=0;i<e.length;i++){t.push(csv.RechargeProxy.getIns().cfgMap[parseInt(e[i])])}}return t};t.prototype.onShowHide=function(t){if(t.visible){if(t.client_type==activitytaren.ActivityTaRenType.JITIAN_HAOLI){activitytaren.ActivityTaRenModel.getIns().getInfoByActID(t.actId)}}};t.prototype.onCheckStart=function(){if(this.start_time!=0&&this.end_time!=0){if(game.Context.getServerTime()<this.start_time&&this.isOpen==false){Laya.timer.once(1e3,this,this.onCheckStart)}else{this.model.event(s.HuoDongEvent.EVENT_RED_CHECK);this.onCheckEnd()}}};t.prototype.onCheckEnd=function(){if(this.isOpen){Laya.timer.once(1e3,this,this.onCheckEnd)}else{this.model.event(s.HuoDongEvent.EVENT_RED_CHECK)}};Object.defineProperty(t.prototype,"model",{get:function(){return s.HuoDongShangChengModel.getIns()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"isOpen",{get:function(){var t=this.cfg.type;if(t==s.EHuoDongType.OneTimeGift){if(this.model.isOneTimeGiftAllFinish()){return false}}else if(t==s.EHuoDongType.TouZiLiCai||t==s.EHuoDongType.ChengZhangJiJing){return!this.isTouziChengzhangIsAllLingQu()}else if(t==s.EHuoDongType.LimtGift){if(!this.model.isGiftOpen(this.cfg)){return false}var e=this.end_time;var i=this.start_time;var n=game.Context.getServerTime();if(n<i||n>e){return false}}return true},enumerable:true,configurable:true});t.prototype.getType=function(){return this.cfg.type};Object.defineProperty(t.prototype,"weekModel",{get:function(){return s.WeekMonthForeverModel.getIns()},enumerable:true,configurable:true});t.prototype.getTimeStr=function(t){var e=this.model.convertTimeStr(t);switch(this.cfg.type){case s.EHuoDongType.FreeGift:return e+app.getLang("huodong_text_05");case s.EHuoDongType.Week:if(this.weekModel.weekNetData&&this.weekModel.weekNetData.buyTime!=0){if(t<3600*24){return util.TimeUtil.sec2Str(t)+app.getLang("huodong_text_11")}else{return app.getLang("huodong_text_12",util.TimeUtil.sec2Str(t,false,1))}}else{return""}case s.EHuoDongType.WeekLiBao:e=this.model.convertTimeWithHour(t);return app.getLang("mall_text_02",e);case s.EHuoDongType.MonthLiBao:e=this.model.convertTimeWithHour(t);return app.getLang("mall_text_03",e);case s.EHuoDongType.LimtGift:e=this.model.convertTimeWithHour(t);return app.getLang("mall_text_04",e)}return e};t.prototype.hasRed=function(){return this.model.getRed(this)};t.prototype.getSubTime=function(){var t=0;switch(this.cfg.type){case s.EHuoDongType.FreeGift:if(!this.hasRed()){t=game.Context.getServerZeroTime()+3600*24-game.Context.getServerTime()}break;case s.EHuoDongType.Week:t=s.WeekMonthForeverModel.getIns().weekCardDayTime();break}return t};t.prototype.hasBubble=function(){return this.cfg.bubble==1};t.prototype.isShowIsBuy=function(){if(this.getType()==s.EHuoDongType.ZhongShengKa){return s.WeekMonthForeverModel.getIns().isBuy!=0}return false};t.prototype.isShowIsLingQu=function(){if(this.getType()==s.EHuoDongType.TouZiLiCai){return touzilic.TouZiLiCaiModel.getIns().isAllLingQu()}else if(this.getType()==s.EHuoDongType.JiTianHaoLi){var t=activitytaren.ActivityTaRenModel.getIns().iconMan.getActVOlist_by_client_type(activitytaren.ActivityTaRenType.JITIAN_HAOLI);if(t.length>0){var e=t[t.length-1];var i=e.cfgList;var n=0;for(var a=0;a<i.length;a++){var o=e.getSubInfo(i[a].id);if(o){if(o.status==activitytaren.ActivityTaRenLingQuStatus.IS_ALREADY_LING_QU){n++}}}if(n>=i.length){return true}}}else if(this.getType()==s.EHuoDongType.ChengZhangJiJing){return chengzhanjijing.ChengZhanJiJingModel.getIns().isAllLingQu()}return false};t.prototype.isTouziChengzhangIsAllLingQu=function(){if(chengzhanjijing.ChengZhanJiJingModel.getIns().isAllLingQu()&&touzilic.TouZiLiCaiModel.getIns().isAllLingQu()){return true}return false};t.prototype.getBubbleSubTime=function(){switch(this.cfg.type){case s.EHuoDongType.WeekLiBao:return util.TimeUtil.getWeekEndTimeNow(game.Context.getServerTime());case s.EHuoDongType.MonthLiBao:return util.TimeUtil.getMonthEndTime(game.Context.getServerTime());case s.EHuoDongType.LimtGift:var t=this.end_time-game.Context.getServerTime();if(t<0){t=0}return t}return 0};t.prototype.isDialog=function(){return this.cfg.dailog!=""};return t}();s.HuoDongVo=n})(huodong||(huodong={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var amulet;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.HU_SHEN_FU,i.AmuletMainNewView);game.FuncDotAdapter.registRedFunc(csv.FunctionsProxy.ENUMS.HU_SHEN_FU,i.AmuletModel.getIns(),i.AmuletModel.getIns().updataRed)};e.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.AmuletDataAck,this,this.onAmuletDataAck);this.addMsgListener(app.ProtocolResponse.AmuletUpdateAck,this,this.onAmuletUpdateAck)};e.prototype.onAmuletDataAck=function(t,e){i.AmuletModel.getIns().updateInfoNetData(e);i.AmuletModel.getIns().updataRed()};e.prototype.onAmuletUpdateAck=function(t,e){if(e.success==1){if(e.vecItem[0].lv==1){i.AmuletModel.getIns().event(i.AmuletModel.ACTIVE_AMULET_ACT,e.vecItem[0])}else{i.AmuletModel.getIns().event(i.AmuletModel.LV_UP_AMULET_ACT,e.vecItem[0])}}};e.SINGLE_KEY="amulet.AmuletModule";return e}(app.ModuleBase);i.AmuletModule=t})(amulet||(amulet={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var amulet;(function(t){var a=csv.AmuletProxy;var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){};e.prototype.updateInfoNetData=function(t){this._amuletList=t.vecAmulete};e.prototype.getPosNetArr=function(t){var e=[];for(var i=0;i<this._amuletList.length;i++){if(this._amuletList[i].combatPos==t){e.push(this._amuletList[i])}}return this.vanSort(e)};e.prototype.getCommonPosNetArr=function(t){var e=[];for(var i=0;i<this._amuletList.length;i++){if(this._amuletList[i].combatPos==t){e.push(this._amuletList[i])}}return e};e.prototype.vanSort=function(t){var e=[];var i=[];var n=[];for(var a=0;a<t.length;a++){if(t[a].lv==0){var o=this.getTypeLvItem(t[a].id,1);var s=game.ItemUtil.parserList(o.cost)[0];var r=game.GridsModel.getIns().hasEnoughItems(s,false);if(r){e.push(t[a])}else{n.push(t[a])}}else{i.push(t[a])}}return e.concat(i).concat(n)};e.prototype.getTypeArr=function(t){var e=[];var i=a.getIns().getCfgArr();for(var n=0;n<i.length;n++){if(i[n].amuletid==t){e.push(i[n])}}return e};e.prototype.getTypeLvItem=function(t,e){var i=this.getTypeArr(t);for(var n=0;n<i.length;n++){if(i[n].lv==e){return i[n]}}return null};e.prototype.getComBat=function(t){var e=Attributes.decode(t.attr).baseList;return e};e.prototype.getCostItem=function(){};e.prototype.getSameItemIndex=function(t,e){for(var i=0;i<t.length;i++){if(t[i].id==e.id){return i}}};e.prototype.updataRed=function(){if(this._amuletList){var t=this.getRedDotArr();game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.HU_SHEN_FU);for(var e in game.Context.roleList){if(t[e]){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.HU_SHEN_FU);break}}}};e.prototype.getRedDotArr=function(t){if(t===void 0){t=false}var e=[];for(var i=0;i<game.Context.TOTAL_ROLE_NUM;i++){e[i]=false;var n=i+1;if(this._amuletList){var a=void 0;if(t){a=this.getCommonPosNetArr(n)}else{a=this.getPosNetArr(n)}for(var o=0;o<a.length;o++){var s=this.getTypeArr(a[o].id).length;if(a[o].lv<s){var r=this.getTypeLvItem(a[o].id,a[o].lv==0?1:a[o].lv).cost;var l=game.GridsModel.getIns().hasEnoughItems(r);if(l){e[i]=true;break}}}}}return e};e.SINGLE_KEY="amulet.AmuletModel";e.ACTIVE_AMULET_ACT="ACTIVE_AMULET_ACT";e.LV_UP_AMULET_ACT="LV_UP_AMULET_ACT";return e}(app.ModelBase);t.AmuletModel=e})(amulet||(amulet={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var amulet;(function(i){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t._currentIndex=0;t._url="";return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this._model=i.AmuletModel.getIns();this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.roleMediator=new common.RoleListMediator(this.itemxuanze.xuanzelist,equip.RoleItem,new Laya.Handler(this,this.roleSelectChange));this.roleMediator.setData(0);this.itemcailiao.showBagCount(1);this.itemcailiao1.showBagCount(1);this.listhushenfu.vScrollBarSkin=" ";this.listhushenfu.itemRender=i.AmuletItem;this.listhushenfu.renderHandler=new Laya.Handler(this,this.onCellHandler);this.listhushenfu.selectHandler=new Laya.Handler(this,this.onUpdateView);this.listhushenfu.selectEnable=true;this.listshuxing.itemRender=game.ComAttrItem1;this.listshuxing.renderHandler=new Laya.Handler(this,this.onAttrRender);this._tempImg=new Laya.Image;this._tempImg.x=this.hushenfuPos.x;this._tempImg.y=this.hushenfuPos.y;this._tempImg.anchorX=this._tempImg.anchorY=.5;this.addChild(this._tempImg);game.HelperViewHandler.register(csv.FunctionsProxy.ENUMS.HU_SHEN_FU,[this.btntips,this.labeltips]);this.listshuxingjinlian.itemRender=i.AmuletLvUpPropItem;this.listshuxingjinlian.renderHandler=new Laya.Handler(this,this.onAttrRender2)};t.prototype.onDisplay=function(){this.imgup.on(Laya.Event.CLICK,this,this.onLeft);this.imgdown.on(Laya.Event.CLICK,this,this.onRight);this.btnjihuo.on(Laya.Event.CLICK,this,this.onJiHuo);this.btnjinglian.on(Laya.Event.CLICK,this,this.onJingLian);this._model.on(i.AmuletModel.ACTIVE_AMULET_ACT,this,this.ActUpdateView);this._model.on(i.AmuletModel.LV_UP_AMULET_ACT,this,this.lvUpdateView);app.ProtocolRequest.AmuletDataReq();this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){this.imgup.off(Laya.Event.CLICK,this,this.onLeft);this.imgdown.off(Laya.Event.CLICK,this,this.onRight);this.btnjihuo.off(Laya.Event.CLICK,this,this.onJiHuo);this.btnjinglian.off(Laya.Event.CLICK,this,this.onJingLian);this._model.off(i.AmuletModel.ACTIVE_AMULET_ACT,this,this.ActUpdateView);this._model.off(i.AmuletModel.LV_UP_AMULET_ACT,this,this.lvUpdateView);this.roleMediator.setData(0);this.listhushenfu.scrollTo(0)};t.prototype.onAttrRender2=function(t){t.setData(t.dataSource)};t.prototype.refreshAll=function(){this.updateAmuletArrData();var t=this._model.getRedDotArr();this.roleMediator.setRedArr(t);this.onUpdateView()};t.prototype.roleSelectChange=function(){this.listhushenfu.scrollTo(0);var t=this.itemxuanze.xuanzelist.selectedIndex;this.updateAmuletArrData(t);this.onUpdateView()};t.prototype.ActUpdateView=function(t){this.listhushenfu.setItem(this.listhushenfu.selectedIndex,t);this.activeSuccess(t);this.onUpdateView(this.listhushenfu.selectedIndex,true)};t.prototype.lvUpdateView=function(t){this.listhushenfu.array=this._model.getPosNetArr(t.combatPos);var e=this._model.getSameItemIndex(this.listhushenfu.array,t);this.listhushenfu.selectedIndex=e;this.onUpdateView(e,true);manager.EffectManager.playStageEffect("skill_chenggong",0)};t.prototype.onUpdateView=function(t,e){if(t===void 0){t=0}if(e===void 0){e=false}var i=this._model.getRedDotArr(e);this.roleMediator.setRedArr(i);var n=this.listhushenfu.array;var a=this._selItem=n[t];var o=a.lv==0?false:true;var s=this._model.getTypeArr(a.id).length;this._updateBoxjinjie(a);this.imgyimanji.visible=false;if(o){this.boxjihuo.visible=false;this.boxjinlian.visible=true;this._updateJinLianView();this._updateBoxActView(a);if(a.lv>=s){this.boxjihuo.visible=true;this.boxjinlian.visible=false;this.itemcailiao.visible=false;this.btnjihuo.visible=false}}else{this.boxjihuo.visible=true;this.boxjinlian.visible=false;this.itemcailiao.visible=true;this.btnjihuo.visible=true;this._updateBoxActView(a)}};t.prototype._updateJinLianView=function(){this.onRedUpdate2();this.imgname.x=213;var t=this._model.getTypeLvItem(this._selItem.id,this._selItem.lv);var e=this._model.getTypeArr(this._selItem.id).length;var i=parseInt(t.lv+1)>e?e:parseInt(t.lv+1);this.playAni(t.effect);var n=Attributes.decode(t.attr).baseList;var a=this._model.getTypeLvItem(this._selItem.id,i);var o=Attributes.decode(a.attr).baseList;this.listshuxingjinlian.array=this.getArray(n,o);var s=t.skill.split("-");this.labeljineng.text=csv.SkillProxy.getSkillDesSp(parseInt(s[0]),parseInt(s[1]),a.skillparameters1);var r=game.ItemUtil.parserList(t.cost)[0];r.setCount(parseInt(t.cost.split("-")[1]));this.itemcailiao1.setData(r);this.imglv.visible=true;this.cliplv1.visible=true;this.cliplv1.value=this._selItem.lv+""};t.prototype.getArray=function(t,e){var i=[];for(var n=0,a=t.length;n<a;n++){var o={};o.data=t[n];i.push(o)}for(var n=0,a=e.length;n<a;n++){var o=i[n];o.nextData=e[n]}return i};t.prototype._updateBoxjinjie=function(t){var e=t.lv==0?false:true;var i=this._model.getTypeArr(t.id).length;if(e){this.imgzhandouli.visible=false;this.cliplv2.visible=false;this._tempImg.visible=false;this.boxjinjie.visible=true;this.labelshuzi02.visible=false;this.labelshuzi01.visible=true;this.labelshuzi03.visible=true;this.imgjiantouheng.visible=true;var n=this._model.getTypeLvItem(t.id,t.lv);this.labelshuzi01.text="Lv."+n.lv;var a=parseInt(n.lv+1)>i?i:parseInt(n.lv+1);this.labelshuzi03.text="Lv."+a;if(t.lv>=i){this.labelshuzi02.visible=true;this.labelshuzi01.visible=false;this.labelshuzi03.visible=false;this.imgjiantouheng.visible=false;this.labelshuzi02.text="Lv."+n.lv}}else{this.boxjinjie.visible=false}};t.prototype._updateBoxActView=function(t){var e=this._model.getTypeLvItem(t.id,t.lv==0?this._model.getTypeArr(t.id).length:t.lv);var i=e.skill.split("-");this.labelshuxing03.text=csv.SkillProxy.getSkillDesSp(parseInt(i[0]),parseInt(i[1]),e.skillparameters1);this.listshuxing.array=Attributes.decode(e.attr).baseList;this.onRedUpdate();var n=t.lv==0?false:true;var a=this._model.getTypeArr(t.id).length;this.imgyimanji.visible=false;this._tempImg.skin="res/static/hushenfu/"+e.res+".png";if(n){this.playAni(e.effect);this._tempImg.visible=false;this.imgname.x=213;this.imgname.skin="res/static/hushenfu/"+e.word+".png";this.imglv.visible=true;this.cliplv1.visible=true;this.cliplv1.value=t.lv+"";this.imgzhandouli.visible=false;this.cliplv2.visible=false;this.boxzhanli.visible=true;var o=this._model.getComBat(e);this.clipzhanli.value=this._setScore(o);this.labelshuxing01.text=app.getLang("当前属性:");this.labelshuxing02.text=app.getLang("当前技能:");if(t.lv>=a){this.imgyimanji.visible=true}}else{this._tempImg.visible=true;this.stopAni();this.imgname.x=252;this.imgname.skin="res/static/hushenfu/"+e.word+".png";this.imglv.visible=false;this.cliplv1.visible=false;var o=this._model.getComBat(this._model.getTypeLvItem(t.id,1));this.cliplv2.value=this._setScore(o);this.imgzhandouli.visible=true;this.cliplv2.visible=true;this.boxzhanli.visible=false;this.boxjihuo.visible=true;this.boxjinlian.visible=false;this.labelshuxing01.text=app.getLang("满级属性:");this.labelshuxing02.text=app.getLang("满级技能:");var s=this._model.getTypeLvItem(t.id,1);var r=game.ItemUtil.parserList(s.cost)[0];r.setCount(parseInt(s.cost.split("-")[1]));this.itemcailiao.setData(r)}};t.prototype.updateAmuletArrData=function(t){if(t===void 0){t=0}this.listhushenfu.array=this._model.getPosNetArr(t+1);this.listhushenfu.selectedIndex=0};t.prototype.onCellHandler=function(t,e){t.setData(t.dataSource,e);if(this.listhushenfu.selectedIndex==e){t.setSelect(true)}else{t.setSelect(false)}};t.prototype.onAttrRender=function(t){t.setData(t.dataSource)};t.prototype.onRedUpdate=function(){var t=this._selItem.lv==0?false:true;if(t){var e=this._model.getTypeLvItem(this._selItem.id,this._selItem.lv);if(game.GridsModel.getIns().hasEnoughItems(e.cost)){var i=this._model.getTypeArr(this._selItem.id).length;if(this._selItem.lv<i){game.RedDotView.addTo(this.btnjinglian)}}else{game.RedDotView.removeFrom(this.btnjinglian)}}else{var e=this._model.getTypeLvItem(this.getAmuletIndex(),1);if(game.GridsModel.getIns().hasEnoughItems(e.cost)){game.RedDotView.addTo(this.btnjihuo)}else{game.RedDotView.removeFrom(this.btnjihuo)}}};t.prototype.onRedUpdate2=function(){};t.prototype.getRoleIndex=function(){return this.roleMediator.selectedIndex+1};t.prototype.getAmuletIndex=function(){return this._selItem.id};t.prototype.onJiHuo=function(){var t=this._model.getTypeLvItem(this.getAmuletIndex(),1);if(game.GridsModel.getIns().hasEnoughItems(t.cost,false,true,true)){app.ProtocolRequest.AmuletUpdateReq(this.getRoleIndex(),this.getAmuletIndex())}};t.prototype.activeSuccess=function(t){var e=this._model.getTypeLvItem(t.id,t.lv==0?this._model.getTypeArr(t.id).length:t.lv);var i=e.effect;var n=this.localToGlobal(new Laya.Point(this.hushenfuPos.x,this.hushenfuPos.y));app.ViewManager.toggleDialog(game.JiHuoSuccessView,1,0,[game.Config.ENUM_TYPE.ANI,i,n.x,n.y])};t.prototype.onJingLian=function(){var t=this._model.getTypeLvItem(this._selItem.id,this._selItem.lv);if(game.GridsModel.getIns().hasEnoughItems(t.cost,false,true,true)){app.ProtocolRequest.AmuletUpdateReq(this._selItem.combatPos,this._selItem.id)}};Object.defineProperty(t.prototype,"repeatY",{get:function(){return this.listhushenfu.repeatY},enumerable:true,configurable:true});t.prototype.onLeft=function(){this._currentIndex-=1;this.onMoveList()};t.prototype.onRight=function(){this._currentIndex+=1;this.onMoveList()};t.prototype._setScore=function(t){var e=game.Context.roleList[this.roleMediator.selectedIndex];var i=Attributes.getScore(e.level,t);return i+""};t.prototype.onMoveList=function(){this._currentIndex=Math.min(Math.max(this._currentIndex,0),this.listhushenfu.array.length-this.listhushenfu.repeatY+1);this.listhushenfu.tweenTo(this._currentIndex,350,new Laya.Handler(this,this.onComplete));if(this._currentIndex==0){this.imgup.disabled=true}else{this.imgup.disabled=false}if(this._currentIndex==this.listhushenfu.array.length-this.listhushenfu.repeatY+1){this.imgdown.disabled=true}else{this.imgdown.disabled=false}};t.prototype.onComplete=function(){Laya.timer.callLater(this,this.doDotUpdate)};t.prototype.doDotUpdate=function(){};t.prototype.playAni=function(t){if(!this.ysani){this.ysani=new game.AniView;this.hushenfuPos.addChild(this.ysani)}if(this._url==t){if(!this.ysani.isPlaying){this.ysani.visible=true;this.ysani.play(0,true)}}else{this.ysani.load(t,game.AniView.FILE_NAME.UI)}this.ysani.play(0,true);this.ysani.visible=true;this._url=t};t.prototype.stopAni=function(){if(!this.ysani){return}this.ysani.visible=false;if(this.ysani.isPlaying){this.ysani.stop()}};t.SINGLE_KEY="amulet.AmuletMainNewView";return t}(ui.hushenfu.hushenfuviewnewUI);i.AmuletMainNewView=t})(amulet||(amulet={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var amulet;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.starMediator=new common.StarClipMediator([this.xing1,this.xing2,this.xing3])};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t,e){this._data=t;this.shuzi.visible=false;this.shuzhibg.visible=false;if(e){this.tempBox(false);this.img.skin="res/icon/item/"+t.icon+".png";this.starMediator.value=t.lv-1}else{this.tempBox(true);this.img.skin="res/icon/item/"+t.icon+".png";this.starMediator.value=0}};e.prototype.tempBox=function(t){this.gezibg.gray=t;this.img.gray=t;this.shuzhibg.gray=t;this.shuzi.gray=t;this.xing1.gray=t;this.xing2.gray=t;this.xing3.gray=t};e.SINGLE_KEY="amulet.AmuletGridView";return e}(ui.hushenfu.geziitemUI);t.AmuletGridView=e})(amulet||(amulet={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var amulet;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this._model=i.AmuletModel.getIns();this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t,e){var i=t.lv==0?false:true;this.gezi.biankuang.visible=false;this._data=t;this.labelweijihuo.visible=!i;var n=this._model.getTypeLvItem(t.id,t.lv==0?1:t.lv);this.gezi.setData(n,i);this.setRed()};e.prototype.setSelect=function(t){this.gezi.imgxuanzhong.visible=t;this.gezi.biankuang.visible=t;if(t){this.gezi.biankuang.play()}};e.prototype.setRed=function(){var t=this._data.lv==0?false:true;if(t){var e=this._model.getTypeLvItem(this._data.id,this._data.lv);if(game.GridsModel.getIns().hasEnoughItems(e.cost)){var i=this._model.getTypeArr(this._data.id).length;if(this._data.lv<i){game.RedDotView.addTo(this.gezi)}else{game.RedDotView.removeFrom(this.gezi)}}else{game.RedDotView.removeFrom(this.gezi)}}else{var e=this._model.getTypeLvItem(this._data.id,1);if(game.GridsModel.getIns().hasEnoughItems(e.cost)){game.RedDotView.addTo(this.gezi)}else{game.RedDotView.removeFrom(this.gezi)}}};e.SINGLE_KEY="amulet.AmuletItem";return e}(ui.hushenfu.hushenfuitem01UI);i.AmuletItem=t})(amulet||(amulet={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var amulet;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){this.txtValue.width=83;this.txtNext.width=83};e.prototype.setData=function(t){if(!t){return}this.txtName.text=Attributes.getPropName(t.data.propId);this.txtValue.text="+"+Attributes.getPropValue(t.data.propId,t.data.value,t.data.formula);if(t.nextData){this.imgArrow.visible=true;this.txtNext.text="    +"+Attributes.getPropValue(t.nextData.propId,t.nextData.value,t.nextData.formula)}else{this.imgArrow.visible=false;this.txtNext.text=""}};e.SINGLE_KEY="amulet.AmuletLvUpPropItem";return e}(game.ComAttrItem0);t.AmuletLvUpPropItem=e})(amulet||(amulet={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var game;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){};e.prototype.initCommands=function(){};e.SINGLE_KEY="game.ItemModule";return e}(app.ModuleBase);t.ItemModule=e})(game||(game={}));var items;(function(t){function e(t){}t.LinkHandler=e})(items||(items={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(e){__extends(o,e);function o(){var t=e!==null&&e.apply(this,arguments)||this;t.useTypes=[csv.ItemProxy.TYPES.XIAO_HAO_PING,csv.ItemProxy.TYPES.CAI_LIAO,csv.ItemProxy.TYPES.LIBAO,csv.ItemProxy.TYPES.TITLE_ITEM,csv.ItemProxy.TYPES.PET,csv.ItemProxy.TYPES.SKIN,csv.ItemProxy.TYPES.DANYAO,csv.ItemProxy.TYPES.SEVEN_GOLD,csv.ItemProxy.TYPES.HULU_FULI_PACKAGE];t.clientUseTypes=[csv.ItemProxy.TYPES.CAI_LIAO,csv.ItemProxy.TYPES.SOUL_MONSTER,csv.ItemProxy.TYPES.SKIN,csv.ItemProxy.TYPES.DANYAO];t.expTypes=[csv.ItemProxy.XH_SUB_TYPES.SUB_1,csv.ItemProxy.XH_SUB_TYPES.SUB_2,csv.ItemProxy.XH_SUB_TYPES.SUB_5];t.itemList={};return t}o.getIns=function(){return app.Singleton.getInstance(o)};o.prototype.init=function(){var t=app.Config.getResById("item.csv");var e=t.getArray();this.arr=e;this.itemCfgMap=t.getMap("id");this.resMap={};this.petMap={};for(var i=0,n=e.length;i<n;++i){var a=e[i];if(a.type==o.TYPES.ZI_YUAN){this.resMap[a.subtype]=a}else if(a.type==o.TYPES.PET){this.petMap[a.p1]=a}}this.sixBoxArray=new Array;t=app.Config.getResById("bagtype.csv");this.bagTypes=t.getArray();t=app.Config.getResById("goldentouch.csv");this.goldChangeMap=t.getMap("item1");t=app.Config.getResById("box_show.csv");this.boxRateShowMap=t.getMap("id");this.itemList={}};o.prototype.getBagTuijian=function(t){for(var e=0;e<this.bagTypes.length;e++){var i=this.bagTypes[e];var n=i.bagflag;if(n&&n!=""){var a=n.split("-");if(a.indexOf(t.toString())!=-1){return i}}}};o.prototype.getTuiLattle=function(t){for(var e=0;e<this.bagTypes.length;e++){var i=this.bagTypes[e];if(i.type==1&&i.subtype==t){return i}}};o.prototype.getListByType=function(t){if(!this.itemList[t]){this.itemList[t]=[];for(var e=0,i=this.arr.length;e<i;++e){var n=this.arr[e];if(n.type==o.TYPES.GARDEN){this.itemList[t].push(n)}}}return this.itemList[t]};o.prototype.getArrayByType=function(){if(this.sixBoxArray.length==0){var t=[];for(var e=0,i=this.arr.length;e<i;++e){var n=this.arr[e];if(n.type==o.TYPES.SIX_BOX){var a=t[n.subtype];if(a){a.push(n)}else{t[n.subtype]=[n]}}}for(var e=1;e<t.length;e++){this.sixBoxArray.push(t[e])}}return this.sixBoxArray};o.prototype.getBagTuiByID=function(t){for(var e=0;e<this.bagTypes.length;e++){var i=this.bagTypes[e];if(i.id==t){return i}}};o.prototype.canUse=function(t){return this.useTypes.indexOf(t)>=0};o.prototype.canGoldChange=function(t){if(csv.ItemProxy.getIns().goldChangeMap[t]){return true}return false};o.prototype.getItemCfgById=function(t){return this.itemCfgMap[t]};o.formatCfg=function(t){if(typeof t=="number"){t=o.getIns().getItemCfgById(t)}else if(typeof t=="string"){t=o.getIns().getItemCfgById(parseInt(t))}else if(t instanceof items.ItemVO){t=t.itemCfg}return t};o.getName=function(t){return app.getLang("itemname_"+o.formatCfg(t).id)};o.getQua=function(t){return app.getLang(o.formatCfg(t).qua)};o.getType=function(t){return parseInt(o.formatCfg(t).type)};o.getSubType=function(t){return parseInt(o.formatCfg(t).subtype)};o.getUrl=function(t){var e=o.formatCfg(t);if(!e){return"icn_tongqian"}return"res/icon/item/"+e.reskey+".png"};o.getItemSmallIcon=function(t){var e=o.formatCfg(t);if(!e){return""}if(e.redtype==329){return"res/static/jinjiewuxing/"+e.littleicon+".png"}return"public/"+e.littleicon+".png"};o.getHtmlName=function(t,e){var i=o.formatCfg(t);e=e?e:i.qua;return"<span color='"+game.STYLES.ITEM_QUALITY_S[e]+"'>"+o.getName(i)+"</span>"};o.getTipHtmlName=function(t,e){var i=o.formatCfg(t);e=e?e:i.qua;return"<span color='"+game.STYLES.ITEM_QUALITY[e]+"'>"+o.getName(i)+"</span>"};o.getItemDes=function(t){return app.getLang("item_desc_"+t)};o.getItemGetWay=function(t){return app.getLang("item_get_"+t)};o.getItemEffect=function(t){var e="";switch(t){case 1:e="";break;case 2:e="effect_zhuangebeiliuguang01";break;case 3:e="effect_zhuangebeiliuguang02";break;case 4:e="effect_zhuangebeiliuguang03";break;case 5:e="effect_zhuangebeiliuguang04";break;case 6:e="effect_zhuangebeiliuguang05";break}return e};o.SINGLE_KEY="csv.ItemProxy";o.TYPES={EQUIP:1,XIAO_HAO_PING:2,CAI_LIAO:3,REN_WU:4,ZI_YUAN:5,LIBAO:6,BAOSHI:7,TAOZHUANG:8,PET:9,SOUL_MONSTER:10,TITLE_ITEM:11,SKIN:12,GUARD:13,FUMP_STONE:14,SOUL_EQUIP:15,XIN_FA:16,SIX_BOX:17,FARM:19,TEAM_ICON:21,DANYAO:22,FA_BAO_PIECE:23,FA_BAO:24,MOUNT:25,PET_CHIP:107,GARDEN:27,CAOYAO:29,SEVEN_GOLD:32,HULU_FULI_PACKAGE:33};o.XH_SUB_TYPES={SUB_1:1,SUB_2:2,SUB_3:3,SUB_4:4,SUB_5:5,SUB_6:6,SUB_7:7,SUB_8:8};o.SUB_TYPES={CLOTHING:1,HULU_YEZI:9,HULU:10,SEED:28};return o}(app.ModelBase);t.ItemProxy=e})(csv||(csv={}));var game;(function(l){var t=function(){function t(){}t.showType1=function(t,e,i,n){var a=l.ItemUtil.createVO(t.getItemId());var o=t.count;var s=l.GridsModel.getIns().getItemCount(t.getItemId());e.setData(a);var r=false;if(s>=o){i.color=l.STYLES.GREEN_COLOR_S;r=true}else{i.color=l.STYLES.RED_COLOR_S}i.text=l.MoneyModel.format(s)+"/"+l.MoneyModel.format(o);return r};t.showType2=function(t,e,i,n,a){t.setCount(a);e.setData(t);if(n>=a){i.color=l.STYLES.GREEN_COLOR_S}else{i.color=l.STYLES.RED_COLOR_S}if(t.itemCfg.type==csv.ItemProxy.TYPES.ZI_YUAN){i.text=a.toString()}else{i.text=n+"/"+a}};t.showType3=function(t,e,i){if(i===void 0){i=true}t.setCount(t.count);e.setData(t);i?e.gezibg.visible=true:e.gezibg.visible=false;e.quaEff&&(i?e.quaEff.visible=true:e.quaEff.visible=false)};t.showType4=function(t,e,i,n,a){var o="";if(n){o=n}else{o=l.STYLES.DESC_TXT_COLOR_S}var s=i<e?l.STYLES.RED_COLOR_S:o;if(a){t.text=app.getLang("<span color='{2}'>{0}/{1}</span>",i,e,s)}else{t.text=app.getLang("<span color='{2}'>{0}</span>/{1}",i,e,s)}};t.showType5=function(t,e,i){var n=l.ItemUtil.createVO(t.getItemId());var a=t.count;var o=l.GridsModel.getIns().getItemCount(t.getItemId());e.setData(n);var s=false;var r;if(o>=a){r=l.STYLES.GREEN_COLOR_S;s=true}else{r=l.STYLES.RED_COLOR_S}i.text=app.getLang("<span color='{2}'>{0}</span>/{1}",o,a,r);return s};t.showLabelColor=function(t,e,i){var n=Boolean(i>=e);if(n){t.color=l.STYLES.GREEN_COLOR_S}else{t.color=l.STYLES.RED_COLOR_S}return n};return t}();l.ItemShowUtil=t})(game||(game={}));var game;(function(u){var e=bag.BagModel;var t=function(){function h(){}h.flowMsg=function(t,e){for(var i=0;i<t.length;i++){if(t[i].itemID==e&&t[i].value>0){var n=u.ItemUtil.createVO(e);u.NoticeManager.getIns().flowMsg(csv.ItemProxy.getTipHtmlName(n.getItemId())+"<span>x"+u.MoneyModel.format(t[i].value)+"</span>",n.getIconUrl());break}}};h.createVO=function(t,e,i){if(t===0){return null}var n=csv.ItemProxy.getIns().getItemCfgById(t);var a;if(!n){console.log("道具配置不存在 itemid:"+t);return null}if(n.type==1){a=new items.EquipVO(n,e,i)}else if(n.type==15){a=new items.EquipSoulVO(n,e,i)}else{a=new items.ItemVO(n,e,i)}return a};h.parserItemStr=function(t){var e=app.str2Array(t,"-");return[parseInt(e[0]),parseInt(e[1])]};h.parserList=function(t,e){if(!t){return[]}var i;if(typeof t=="number"){i=t.toString()}else{i=t}var n=[];var a=app.str2Array(i,";","-");for(var o=0;o<a.length;++o){var s=a[o];if(s.length===1){var r=parseInt(s[0]);if(r){var l=h.createVO(r);if(l){l.setCount(1);n.push(l)}else{console.error("检查item配置表:"+r)}}}if(s.length===2){var r=parseInt(s[0]);if(r){var l=h.createVO(r);if(l){l.setCount(parseInt(s[1]));n.push(l)}}}if(s.length===3){if(e&&parseInt(s[0])!==e){continue}var r=parseInt(s[1]);if(r){var l=h.createVO(r);if(l){l.setCount(parseInt(s[2]));n.push(l)}}}}return n};h.sortItemsByQua=function(t){if(t.length>0){var e=t[0];if(e instanceof ItemData){t.sort(this.sortItemData)}else{t.sort(this.sortItemVO)}}return t};h.discountItemsByStr=function(t,e){var i=[];for(var n=0,a=t.length;n<a;n++){var o={id:t[n].id,count:Math.floor(t[n].count*e/100)};i.push(o)}return i};h.hebingItemsByStr=function(t){var e=[];var i=t.length;var n={};for(var a=0;a<i;++a){var o=app.str2Array(t[a],";","-");for(var s=0,r=o.length;s<r;s++){var l=o[s];var h={id:parseInt(l[0]),count:parseInt(l[1])};if(!n[h.id]){n[h.id]=h}else{n[h.id].count+=parseInt(l[1])}}}for(var p in n){e.push(n[p])}return e};h.hebingItemsByObj=function(t){var e=[];var i={};for(var n=0,a=t.length;n<a;n++){var o=t[n];if(!i[o.id]){i[o.id]=o}else{i[o.id].count+=o.count}}for(var s in i){var o=i[s];var r=u.ItemUtil.createVO(o.id);r.setCount(o.count);e.push(r)}return e};h.hebingItems=function(t){if(!t){return[]}var e=t.length;if(e<=1){return t}var i=[];var n={};for(var a=0;a<e;++a){var o=t[a];var s=void 0;if(o instanceof ItemData){s=o.itemID;if(n[s]==undefined){n[s]=o}else{n[s].value+=o.value}}else{s=o.getItemId();if(n[s]==undefined){n[s]=o}else{n[s].setCount(n[s].count+o.count)}}}for(var r in n){i.push(n[r])}return i};h.sortItemData=function(t,e){var i=csv.ItemProxy.getIns().getItemCfgById(t.itemID);var n=csv.ItemProxy.getIns().getItemCfgById(e.itemID);if(i.ordertype!==n.ordertype){return n.ordertype-i.ordertype}if(i.qua!==n.qua){return n.qua-i.qua}if(i.id!==n.id){return i.id-n.id}return 0};h.sortItemVO=function(t,e){if(t.itemCfg.ordertype!==e.itemCfg.ordertype){return e.itemCfg.ordertype-t.itemCfg.ordertype}if(t.getQuality()!==e.getQuality()){return e.getQuality()-t.getQuality()}if(t.getItemId()!==e.getItemId()){return t.getItemId()-e.getItemId()}return 0};h.equip=function(t,e,i){if(i===void 0){i=false}app.ProtocolRequest.ItemMoveReq(t.flag,t.getInstId(),e)};h.transf=function(t,e){app.ProtocolRequest.TransfEquipReq(t.flag,t.getInstId(),e)};h.equipSoulEquip=function(t,e,i){if(i===void 0){i=false}var n=parseInt(e[0]);var a=parseInt(e[1]);var o=parseInt(e[2]);var s=soul.SoulBodyModel.getIns().canEquip(t.getItemId(),a,o);if(s){app.ProtocolRequest.ItemMoveReq(u.GridsModel.BAG_SOUL,t.getInstId(),n)}else{manager.FlowManager.instance.flowByStyle1(app.getLang("soultips_25"))}};h.unload=function(t){if(e.getIns().checkIfBagMax(u.GridsModel.BAG_ITEM)){u.ClosureManager.callFunction(csv.FunctionsProxy.ENUMS.BAG_TOOL);return}app.ProtocolRequest.ItemMoveReq(t.flag,t.getInstId(),u.GridsModel.BAG_ITEM)};h.unloadSoulEquip=function(t){if(e.getIns().checkIfBagMax(u.GridsModel.BAG_SOUL)){return}app.ProtocolRequest.ItemMoveReq(t.flag,t.getInstId(),u.GridsModel.BAG_SOUL)};h.use=function(t,e,i){if(e===void 0){e=Uint64.ZERO}if(i===void 0){i=1}var n=t.itemCfg.type;var a=t.itemCfg.subtype;if(csv.ItemProxy.getIns().clientUseTypes.indexOf(n)>=0){if(t.itemCfg.activityuse>0){var o=activitytaren.ActivityTaRenModel.getIns().iconMan.getActVOlist_by_client_type(t.itemCfg.activityuse);var s=void 0;for(var r=0;r<o.length;r++){if(o[r].isopen){s=o[r];break}}var l=0;var h=csv.ActivityTarenProxy.getIns().clientTypeCfgArr[t.itemCfg.activityuse];if(h.length>0){l=h[0].functionid}if(o.length>0){l=o[0].funid;if(s){l=s.funid}else{if(t.itemCfg.clientUse){l=t.itemCfg.clientUse}}}u.ClosureManager.callFunction(l,t.itemCfg)}else if(t.itemCfg.clientUse==csv.FunctionsProxy.ENUMS.MOUNT){var p=csv.HorseattrProxy.getIns().getHorseIdByCost(t.itemCfg.id);u.ClosureManager.callFunction(t.itemCfg.clientUse,true,false,p.toString())}else{u.ClosureManager.callFunction(t.itemCfg.clientUse,t.itemCfg)}}else if(n==6){if(a==1||a==3){u.GridsModel.getIns().useItemCount=i;app.ProtocolRequest.UseItemReq(t.getInstId(),i,e)}else if(a==2){u.ItemUtil.showItemChooseView(t,i)}}else if(n==9){if(a==1){u.ClosureManager.callFunction(csv.FunctionsProxy.ENUMS.PET_EGGS,true,false,"2")}else if(a==2){u.ClosureManager.callFunction(csv.FunctionsProxy.ENUMS.PET_LIST)}}else{app.ProtocolRequest.UseItemReq(t.getInstId(),i,e)}};h.showItemChooseView=function(t,e){app.ViewManager.toggleDialog(items.ItemChooseView,1,0,[t,e])};h.sale=function(t,e){if(!t||!t.getInstId()){return}app.ProtocolRequest.SellReq([t.getInstId()])};h.getAwardItem=function(t,e){var i=[];var n;for(var a=0,o=t;a<o.length;a++){var s=o[a];n=u.ItemUtil.createVO(s.itemId,s);n.setCount(s.count);i.push(n)}for(var r=0,l=e;r<l.length;r++){var s=l[r];n=u.ItemUtil.createVO(s.itemID);n.setCount(s.value);i.push(n)}this.sortItemsByQua(i);var h=[];for(var p=0;p<i.length;p++){if(i[p].getItemId()==8024){h.push(i[p]);i.splice(p,1);break}}for(var p=0;p<i.length;p++){if(i[p].getItemId()==8003){h.push(i[p]);i.splice(p,1);break}}i=h.concat(i);return i};h.sortByItemIdDown=function(t,e){if(t.getItemId()>e.getItemId()){return-1}else if(t.getItemId()<e.getItemId()){return 1}return 0};h.sortByItemIdUp=function(t,e){if(t.getItemId()>e.getItemId()){return 1}else if(t.getItemId()<e.getItemId()){return-1}return 0};h.getDesc=function(t){var e="";if(t.equipCfg){}else{e=app.getLang(csv.ItemProxy.getItemDes(t.getItemId()),u.MoneyModel.format(t.getSpecialNum()))}if(t.itemCfg&&t.itemCfg.type==csv.ItemProxy.TYPES.FA_BAO_PIECE){var i=t.itemCfg.p1;var n=fabaonew.FaBaoNewModel.getIns();var a=n.getMagicCfgById(i);if(a.isActive==1){e+=app.getLang("magicchip_2")}else{e+=app.getLang("magicchip_1")}}return e};h.ENUMS={TONGBI:8e3,YUANBAO_BAND:8001,YUANBAO:8002,EXP:8003,SKILL:8004,PET:8005,GUILD_GONGXIAN:8006,GUILD_GOLD:8007,RONGYU:8008,CHENGJIU:8009,XING_FA_ZHENQING:56202,SOUL_ITEM:8011,MEDAL:8010,ZHAN_LING:8012,TREASURE_PET_SCROE:8014,YUANBAO_GUILD:8019,ZHANYOU_MONEY:8020,TURNTABLE_MONEY:8021,TAN_BAO:8023,TEAM_EXP:8024,YISHOU__MONEY:8032,SIX_BOX:58197,FABAO_MOUNTAIN:60023,PET_LEVELUP:[84001,84002,84003],PET_EXP_ITEM:88001,ITEM_BUFF:4105};return h}();u.ItemUtil=t})(game||(game={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("pack_rule.csv");this.cfgMap=t.getMap("id")};e.prototype.getCfg=function(t){return this.cfgMap[t]};e.SINGLE_KEY="csv.PackRule";return e}(app.ModelBase);t.PackRule=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var items;(function(t){var e=function(n){__extends(t,n);function t(t,e,i){return n.call(this,t,e,i)||this}Object.defineProperty(t.prototype,"equipCfg",{get:function(){return csv.SoulBodyProxy.getIns().getSoulCfg(this.getItemId())},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"pos",{get:function(){var t=this.equipCfg;if(t.position){return parseInt(t.position)}return 0},enumerable:true,configurable:true});t.prototype.getQuality=function(){return parseInt(this.itemCfg.qua)};return t}(t.EquipVO);t.EquipSoulVO=e})(items||(items={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var jihuoma;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){app.ViewManager.regist(i.JihuomaView,"jihuoma.atlas");app.ViewManager.regist(i.JihuojiangliView,"jihuoma.atlas");game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.JIHUOMA,i.JihuomaView)};e.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.GainAwardItemNtf,this,this.onGainAwardItemNtf)};e.prototype.onGainAwardItemNtf=function(t,e){app.ViewManager.toggleDialog(i.JihuojiangliView,1,0,[e.laward])};e.SINGLE_KEY="jihuoma.JihuomaModule";return e}(app.ModuleBase);i.JihuomaModule=t})(jihuoma||(jihuoma={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var jihuoma;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){};e.SINGLE_KEY="jihuoma.JihuomaModel";return e}(app.ModelBase);t.JihuomaModel=e})(jihuoma||(jihuoma={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var jihuoma;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listjiangli.renderHandler=grids.GridView.CommonItemRender;this.listjiangli.itemRender=grids.GridView;this.listjiangli.hScrollBarSkin=" ";this.quedingbtn.clickHandler=new Laya.Handler(this,this.close)};e.prototype.onDisplay=function(){this.callLater(this.callLaterHandler)};e.prototype.callLaterHandler=function(){this.listjiangli.array=this.dataSource[0]};e.prototype.onUnDisplay=function(){};e.SINGLE_KEY="jihuoma.JihuojiangliView";return e}(ui.jihuoma.jihuojiangliUI);t.JihuojiangliView=e;var i=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.labelshuru.removeSelf();this.imgtishi.removeSelf();this.jihuoma.color="#ffffff";this.btnlingqu.clickHandler=new Laya.Handler(this,this.onClickHandler);this.jihuoma.on(Laya.Event.FOCUS,this,gamesdk.onTomatoForceHandler,[this.jihuoma])};e.prototype.reset=function(){this.jihuoma.text="";this.jihuoma.prompt=app.getLang("duihuanma01")};e.prototype.onClickHandler=function(){app.ProtocolRequest.GainAwardOnlineReq(this.jihuoma.text)};e.prototype.onDisplay=function(){this.reset();gamesdk.onTomatoForceHandler(this.jihuoma)};e.prototype.onUnDisplay=function(){};e.SINGLE_KEY="jihuoma.JihuomaView";return e}(ui.jihuoma.jihuomaviewUI);t.JihuomaView=i})(jihuoma||(jihuoma={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var jinjiericode;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){app.ViewManager.regist(i.LianPengRiView,"shangcheng.atlas","jinjieri.atlas");app.ViewManager.regist(i.LingZhiRiView,"shangcheng.atlas","jinjieri.atlas");app.ViewManager.regist(i.QiShuRiView,"shangcheng.atlas","jinjieri.atlas");app.ViewManager.regist(i.JinJieRiTeHuiView,"shangcheng.atlas","jinjieri.atlas");game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.RANK_UP_LIAN_PENG,i.LianPengRiView,null,3);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.RANK_UP_QI_SHU,i.QiShuRiView,null,3);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.RANK_UP_LING_ZHI,i.LingZhiRiView,null,3);this._model=i.JinJieRiModel.getIns()};e.prototype.initCommands=function(){};e.prototype.onRedDotChange=function(){Laya.timer.callLater(this,this.onUpdateRedDot)};e.prototype.onUpdateRedDot=function(){};e.SINGLE_KEY="jinjiericode.JinJieRiModule";return e}(app.ModuleBase);i.JinJieRiModule=t})(jinjiericode||(jinjiericode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var jinjiericode;(function(i){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t._state=-1;t._linkto=-1;return t}t.prototype.initialize=function(){e.prototype.initialize.call(this);this._model=i.JinJieRiModel.getIns();this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listdaoju.itemRender=grids.GridView;this.listdaoju.renderHandler=new Laya.Handler(this,this.onCellHandler);this.textareamiaoshu.mouseEnabled=false};t.prototype.onDisplay=function(){this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){};t.prototype.refreshAll=function(){this.btnqianwang.visible=false;this.btnlingqu.on(Laya.Event.CLICK,this,this.onClick);this.textareamiaoshu.editable=false};t.prototype.onCellHandler=function(t,e){t.setData(t.dataSource)};t.prototype.setData=function(t){var e=[];this._tempData=t;this._state=t.state;this._linkto=t.linkToId;var i=t.award.split(";");for(var n=0;n<i.length;n++){e.push(game.ItemUtil.parserList(i[n])[0])}this.listdaoju.array=e;var a=csv.TaskProxy.getIns().getCfg(t.taskId);var o;if(game.TaskModel.getIns().getTaskData(t.taskId)){o=game.TaskModel.getIns().getTaskData(t.taskId).getNum()}else{o="0"}var s;var r=app.str2Array(a.param,"-");if(r.length==1){s=parseInt(r[0])}else{s=parseInt(r[1])}this.textareamiaoshu.text=a.name+"("+o+"/"+s+")";game.RedDotView.removeFrom(this.btnlingqu);if(t.state==0){this.btnlingqu.label="前往";this.imgyilingqu.visible=false;this.btnlingqu.visible=true}else if(t.state==1){game.RedDotView.addTo(this.btnlingqu);this.btnlingqu.label="领取";this.imgyilingqu.visible=false;this.btnlingqu.visible=true}else if(t.state==2){this.imgyilingqu.visible=true;this.btnlingqu.visible=false}};t.prototype.onClick=function(){if(this._state==0){game.ClosureManager.callFunction(this._linkto)}else{this._model.itemActId=this._tempData.actId;if(!this._model.lock){app.ProtocolRequest.RecvActPrizeReq(this._tempData.id);this._model.lock=true}}};t.SINGLE_KEY="jinjiericode.JinJieRiCellItem";return t}(ui.jinjieri.jinjieriitemUI);i.JinJieRiCellItem=t})(jinjiericode||(jinjiericode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var jinjiericode;(function(i){var n=shop.ShopModel;var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t._state=-1;return t}t.prototype.initialize=function(){e.prototype.initialize.call(this);this._model=i.JinJieRiModel.getIns();this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.btngoumai.on(Laya.Event.CLICK,this,this.onClick);this.listdaoju.itemRender=grids.GridView;this.listdaoju.renderHandler=new Laya.Handler(this,this.onCellHandler)};t.prototype.onDisplay=function(){this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){};t.prototype.refreshAll=function(){};t.prototype.onCellHandler=function(t,e){t.setData(t.dataSource)};t.prototype.setData=function(t){var e=[];var i=t.shopId;var n=mall.MallModel.getIns().getBuyRecord(i);if(n&&mall.MallModel.getIns().getCnt(n)!=0){var a=csv.MallProxy.getIns().getArrayByType(9);for(var o=0;o<a.length;o++){if(a[o].priority!=""&&!mall.MallModel.getIns().getBuyRecord(a[o].id)){i=a[o].id;break}}}var s=csv.MallProxy.getIns().getCfgById(i);this._tempData=s;var r=csv.ItemProxy.getIns().getItemCfgById(s.item);this.baoxiangimg.skin="res/icon/item/"+r.reskey+".png";var l=s.showitem.split(";");for(var o=0;o<l.length;o++){e.push(game.ItemUtil.parserList(l[o])[0])}this.listdaoju.array=e;var h=app.str2Array(s.trueprice);var p=csv.ItemProxy.getItemSmallIcon(parseInt(h[0]));this.imghuobi1.skin=p;this.imghuobi.skin=p;this.labelshuzi1.text=s.showprice.split("-")[1];this.labelshuzi.text=h[0].split("-")[1];this._model.discount=Math.ceil(+this.labelshuzi.text/+s.showprice.split("-")[1]);var u=mall.MallModel.getIns().getBuyRecord(i);if(!u){this.imgyihsouqing.visible=false;this.btngoumai.visible=true}else{if(mall.MallModel.getIns().getCnt(u)!=0){this.imgyihsouqing.visible=true;this.btngoumai.visible=false}else{this.imgyihsouqing.visible=false;this.btngoumai.visible=true}}};t.prototype.onClick=function(){if(this._tempData){var t=this._tempData;if(!n.getIns().isSellOut(t.id)){n.getIns().buyItem(n.ENNUMS.NORMAL_SHOP,t,n.getIns().getTimes(t))}}};t.SINGLE_KEY="jinjiericode.JinJieRiTeHuiView";return t}(ui.jinjieri.jinjietehuiitemUI);i.JinJieRiTeHuiView=t})(jinjiericode||(jinjiericode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var jinjiericode;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=i.JinJieRiModel.getIns();this.listlingqu.itemRender=i.JinJieRiCellItem;this.listlingqu.renderHandler=new Laya.Handler(this,this.onCellHandler);this.listlingqu.vScrollBarSkin=""};e.prototype.onCellHandler=function(t,e){t.setData(t.dataSource)};e.prototype.onDisplay=function(){activitytaren.ActivityTaRenModel.getIns().on(activitytaren.ActivityTaRenModel.ACTIVIT_TAREN_EVENT.UPDATE_ACTIVIT_DATA,this,this.refrshNetData);mall.MallModel.getIns().on(mall.MallModel.UPDATE_MALL_BUY_RECORD_DATA,this,this.refrshNetData);this.callLater(this.onGetInfo)};e.prototype.onGetInfo=function(){if(this.functionid){this._model.netData=this.actVo;this.refreshAll()}};e.prototype.onUnDisplay=function(){activitytaren.ActivityTaRenModel.getIns().off(activitytaren.ActivityTaRenModel.ACTIVIT_TAREN_EVENT.UPDATE_ACTIVIT_DATA,this,this.refrshNetData);mall.MallModel.getIns().off(mall.MallModel.UPDATE_MALL_BUY_RECORD_DATA,this,this.refrshNetData)};e.prototype.refreshAll=function(){this.setCellList();this.labeljishi.text=app.getLang("活动持续时间:周"+util.TimeUtil.getWeekCn(parseInt(this.actVo.cfgList[0].date_juti))+"0点到24:00");this.viewtehuilibao.setData(this._model.getJinJieRiSpArr()[0]);this.imgzhekou.skin=game.ResUrls.getZheKou1(this._model.discount)};e.prototype.setCellList=function(){this.listlingqu.array=this._model.getJinJieRiArr();this.listlingqu.refresh()};e.prototype.refrshNetData=function(){var e=this;this._model.lock=false;activitytaren.ActivityTaRenModel.getIns().getInfoByActID(this._model.itemActId,new Laya.Handler(this,function(t){e._model.netData.info=t;e.refreshAll()}))};e.SINGLE_KEY="jinjiericode.LianPengRiView";return e}(ui.jinjieri.lianpengjinjieriviewUI);i.LianPengRiView=t})(jinjiericode||(jinjiericode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var jinjiericode;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=i.JinJieRiModel.getIns();this.listlingqu.itemRender=i.JinJieRiCellItem;this.listlingqu.renderHandler=new Laya.Handler(this,this.onCellHandler);this.listlingqu.vScrollBarSkin=""};e.prototype.onCellHandler=function(t,e){t.setData(t.dataSource)};e.prototype.onDisplay=function(){activitytaren.ActivityTaRenModel.getIns().on(activitytaren.ActivityTaRenModel.ACTIVIT_TAREN_EVENT.UPDATE_ACTIVIT_DATA,this,this.refrshNetData);mall.MallModel.getIns().on(mall.MallModel.UPDATE_MALL_BUY_RECORD_DATA,this,this.refrshNetData);this.callLater(this.onGetInfo)};e.prototype.onGetInfo=function(){if(this.functionid){this._model.netData=this.actVo;this.refreshAll()}};e.prototype.onUnDisplay=function(){activitytaren.ActivityTaRenModel.getIns().off(activitytaren.ActivityTaRenModel.ACTIVIT_TAREN_EVENT.UPDATE_ACTIVIT_DATA,this,this.refrshNetData);mall.MallModel.getIns().off(mall.MallModel.UPDATE_MALL_BUY_RECORD_DATA,this,this.refrshNetData)};e.prototype.refreshAll=function(){this.setCellList();this.labeljishi.text=app.getLang("活动持续时间:周"+util.TimeUtil.getWeekCn(parseInt(this.actVo.cfgList[0].date_juti))+"0点到24:00");this.viewtehuilibao.setData(this._model.getJinJieRiSpArr()[0]);this.imgzhekou.skin=game.ResUrls.getZheKou1(this._model.discount)};e.prototype.setCellList=function(){this.listlingqu.array=this._model.getJinJieRiArr();this.listlingqu.refresh()};e.prototype.refrshNetData=function(){var e=this;this._model.lock=false;activitytaren.ActivityTaRenModel.getIns().getInfoByActID(this._model.itemActId,new Laya.Handler(this,function(t){e._model.netData.info=t;e.refreshAll()}))};e.SINGLE_KEY="jinjiericode.LingZhiRiView";return e}(ui.jinjieri.lingzhijinjieriviewUI);i.LingZhiRiView=t})(jinjiericode||(jinjiericode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var jinjiericode;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=i.JinJieRiModel.getIns();this.listlingqu.itemRender=i.JinJieRiCellItem;this.listlingqu.renderHandler=new Laya.Handler(this,this.onCellHandler);this.listlingqu.vScrollBarSkin=""};e.prototype.onCellHandler=function(t,e){t.setData(t.dataSource)};e.prototype.onDisplay=function(){activitytaren.ActivityTaRenModel.getIns().on(activitytaren.ActivityTaRenModel.ACTIVIT_TAREN_EVENT.UPDATE_ACTIVIT_DATA,this,this.refrshNetData);mall.MallModel.getIns().on(mall.MallModel.UPDATE_MALL_BUY_RECORD_DATA,this,this.refrshNetData);this.callLater(this.onGetInfo)};e.prototype.onGetInfo=function(){if(this.functionid){this._model.netData=this.actVo;this.refreshAll()}};e.prototype.onUnDisplay=function(){activitytaren.ActivityTaRenModel.getIns().off(activitytaren.ActivityTaRenModel.ACTIVIT_TAREN_EVENT.UPDATE_ACTIVIT_DATA,this,this.refrshNetData);mall.MallModel.getIns().off(mall.MallModel.UPDATE_MALL_BUY_RECORD_DATA,this,this.refrshNetData)};e.prototype.refreshAll=function(){this.setCellList();this.labeljishi.text=app.getLang("活动持续时间:周"+util.TimeUtil.getWeekCn(parseInt(this.actVo.cfgList[0].date_juti))+"0点到24:00");this.viewtehuilibao.setData(this._model.getJinJieRiSpArr()[0]);this.imgzhekou.skin=game.ResUrls.getZheKou1(this._model.discount)};e.prototype.setCellList=function(){this.listlingqu.array=this._model.getJinJieRiArr();this.listlingqu.refresh()};e.prototype.refrshNetData=function(){var e=this;this._model.lock=false;activitytaren.ActivityTaRenModel.getIns().getInfoByActID(this._model.itemActId,new Laya.Handler(this,function(t){e._model.netData.info=t;e.refreshAll()}))};e.SINGLE_KEY="jinjiericode.QiShuRiView";return e}(ui.jinjieri.qishujinjieriviewUI);i.QiShuRiView=t})(jinjiericode||(jinjiericode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var jinjiericode;(function(t){var e=function(){function t(){}t.ONLINE_ACT_REFRESH="ONLINE_ACT_REFRESH";t.ONLINE_ACT_CHANGE="ONLINE_ACT_CHANGE";t.ONLINE_ACT_ICON_TIME="ONLINE_ACT_ICON_TIME";return t}();t.JinJieRiEvent=e;var s=function(){function t(){}return t}();t.JinJieRiVo=s;var i;(function(t){t[t["DENG_JI_AWARD"]=1]="DENG_JI_AWARD";t[t["ZAI_XIAN_AWARD"]=2]="ZAI_XIAN_AWARD"})(i=t.JinJieRi_Client_Type||(t.JinJieRi_Client_Type={}));var n=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.itemActId=-1;t.iconTime=-1;t._lock=false;return t}Object.defineProperty(t.prototype,"lock",{get:function(){return this._lock},set:function(t){this._lock=t},enumerable:true,configurable:true});t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.init=function(){};t.prototype.getJinJieRiSpArr=function(){var t=this.netData.cfgList;var e=this.netData.info.prize;this.retSpArr=[];for(var i=0;i<t.length;i++){var n=new s;if(t[i].p1!=""){n.id=+t[i].id;n.actId=+t[i].activityid;n.shopId=+t[i].p1;n.taskId=+t[i].p2;n.linkToId=+t[i].p3;n.award=t[i].award;this.retSpArr.push(n)}}for(var i=0;i<this.retSpArr.length;i++){var a=this.retSpArr[i];var o=e[i];a.state=o.status}this.itemActId=this.retSpArr[0].actId;return this.retSpArr};t.prototype.getJinJieRiArr=function(){var t=this.netData.cfgList;var e=this.netData.info.prize;this.retArr=[];for(var i=0;i<t.length;i++){var n=new s;if(t[i].p1==""){n.id=+t[i].id;n.actId=+t[i].activityid;n.shopId=+t[i].p1;n.taskId=+t[i].p2;n.linkToId=+t[i].p3;n.award=t[i].award;this.retArr.push(n)}}for(var i=0;i<this.retArr.length;i++){var a=this.retArr[i];var o=e[i];a.state=o.status}this.retArr.sort(function(t,e){if(t!=e){if(t.state==1){return-1}else if(e.state==1){return 1}if(t.state==2){return 1}else if(e.state==2){return-1}}});return this.retArr};t.SINGLE_KEY="jinjiericode.JinJieRiModel";return t}(app.ModelBase);t.JinJieRiModel=n})(jinjiericode||(jinjiericode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){this.initActivityTaRen()};e.prototype.initActivityTaRen=function(){var t=app.Config.getResById("activity_taren.csv");this._activityTaRenMap=t.getMap("id");this._activityTaRenArr=t.getArray()};e.prototype.getActivityTaRenMapCell=function(t){return this._activityTaRenMap[t]};e.prototype.getActivityTaRenArr=function(){return this._activityTaRenArr};e.SINGLE_KEY="csv.JinJieRiProxy";return e}(app.ModelBase);t.JinJieRiProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var jjcnew;(function(n){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){this._model=n.JingjiChangModel.getIns();app.ViewManager.regist(n.JingJiChangView,"jingjichang.atlas");game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.NEW_JJC,n.JingJiChangView);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.NEW_JJC_RANK,n.JingJiChangPaihangView)};e.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.SimpleArenaDataNtf,this,this.onSimpleArenaDataNtf);this.addMsgListener(app.ProtocolResponse.SimpleArenaRecordAck,this,this.onSimpleArenaRecordAck);this.addMsgListener(app.ProtocolResponse.SimpleArenaAwardAck,this,this.onSimpleArenaAwardAck);this.addMsgListener(app.ProtocolResponse.SimpleArenaMatchAck,this,this.onSimpleArenaMatchAck);this.addMsgListener(app.ProtocolResponse.SimpleArenaChallengeAck,this,this.onSimpleArenaChallengeAck)};e.prototype.onSimpleArenaChallengeAck=function(t,e){};e.prototype.onSimpleArenaAwardAck=function(t,e){if(e.result==1){this._model.simpleArena.weekly_received=e.weekly_received;this._model.rewardRed();this._model.event(n.JingjiChangEvent.UPDATE_DATA)}};e.prototype.onSimpleArenaMatchAck=function(t,e){if(e.result==1){var i=e.rank_data;this._model.playerList=i}this._model.event(n.JingjiChangEvent.GET_PLAYER_LIST)};e.prototype.onSimpleArenaRecordAck=function(t,e){};e.prototype.onSimpleArenaDataNtf=function(t,e){this._model.simpleArena=e;this._model.curRank=e.rank;this._model.rewardRed();this._model.event(n.JingjiChangEvent.UPDATE_DATA)};e.SINGLE_KEY="jjcnew.JingJiChangModule";return e}(app.ModuleBase);n.JingJiChangModule=t})(jjcnew||(jjcnew={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var jjcnew;(function(h){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};Object.defineProperty(e.prototype,"curType",{get:function(){return rank.RankModel.TYPE_ENUM.ENMRANKTYPE_JJC_NEW},enumerable:true,configurable:true});e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.btnpaimingjiangli.clickHandler=new Laya.Handler(this,this.onClickHandler);this._model=rank.RankModel.getIns();this.listpaihang.itemRender=i;this.listpaihang.renderHandler=new Laya.Handler(this,this.onListPaihang);this._topViewList=[];this._topViewList.push(new n(this.itemwanjia02));this._topViewList.push(new n(this.itemwanjia01));this._topViewList.push(new n(this.itemwanjia03))};e.prototype.onListPaihang=function(t,e){t.setData(t.dataSource,e)};e.prototype.onClickHandler=function(){app.ViewManager.toggleDialog(h.Meirijianglitip,1,0)};e.prototype.onDisplay=function(){app.ProtocolRequest.GetRankListReq(this.curType);this._model.on(rank.RankModel.RANK_DATA_CHANGE,this,this.onDataChange);rank.RankModel.getIns().on(rank.RankModel.RANK_FIRST_CHANGE,this,this.showModels)};e.prototype.showModels=function(){var t=rank.RankModel.getIns().getRankShowPlayerData(this.curType);for(var e=0;e<this._topViewList.length;e++){var i=void 0;if(this.topArr){i=this.topArr[e]}this._topViewList[e].setData(e+1,i,t?t[e]:undefined)}};e.prototype.onDataChange=function(t){if(t==this.curType){var e=rank.RankModel.getIns().getRankInfo(t);var i=e.rankList.length;var n=3;var a=Math.min(n,i);var o=[];for(var s=0;s<a;s++){var r=e.rankList[s];o.push(r)}this.topArr=o;this.showModels();var l=[];for(var s=n;s<i;s++){var r=e.rankList[s];l.push(r)}for(var s=l.length;s<100-n;s++){l.push(new RankData)}this.listpaihang.array=l;this.listpaihang.scrollTo(0);this.labelwo02.text=game.Context.clearPlayerName(game.Context.mainRole.playername);this.itemtouxiang.imgtouxiang.skin=csv.MyTeamProxy.getIns().getTeamIcon(game.Context.teamAvatar);this.itemtouxiang.imgframe.skin=game.Context.mainRole.getHeadFrameUrl();h.JingjiChangModel.getIns().curRank=e.rank;this.labelwo01.text=this.vo.rankText(true);this.labelwo03.text=this.vo.getSelfPoint.toString()+this.vo.getHisMax()}};Object.defineProperty(e.prototype,"vo",{get:function(){return h.JingjiChangModel.getIns().vo},enumerable:true,configurable:true});e.prototype.getSelfRank=function(){var t=rank.RankModel.getIns().getRankInfo(this.curType).rankList;for(var e=0;e<t.length;e++){var i=t[e];if(Uint64.equal(i.uid,game.Context.mainRoleId)){return e}}return-1};e.prototype.onUnDisplay=function(){this._model.off(rank.RankModel.RANK_DATA_CHANGE,this,this.onDataChange);rank.RankModel.getIns().off(rank.RankModel.RANK_FIRST_CHANGE,this,this.showModels)};e.SINGLE_KEY="jjcnew.JingJiChangPaihangView";return e}(ui.paihangbang.tongyongpaihangviewnewUI);h.JingJiChangPaihangView=t;var i=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.CLICK,this,this.showMenu)};e.prototype.showMenu=function(t){t.stopPropagation();h.JingjiChangModel.getIns().showMenu(this._vo)};e.prototype.setData=function(t,e){this._vo=t;this.labelnum.text=(e+4).toString();if(t.name){this.labelname.text=t.name;this.itemtouxiang.imgtouxiang.skin=csv.MyTeamProxy.getIns().getTeamIcon(t.simpleteamavatar);this.itemtouxiang.imgframe.skin=csv.HeadFrameProxy.getIns().getIcon(t.headframeId);this.labeljifen.text=t.value.toNumber().toString()}else{this.labelname.text=app.getLang("jingjichang11");this.itemtouxiang.imgtouxiang.skin=csv.MyTeamProxy.getIns().getDefaultTeamIcon();this.itemtouxiang.imgframe.skin="";this.labeljifen.text=""}};return e}(ui.jingjichang.paihangbangitem01UI);var n=function(){function t(t){this.skin=t}t.prototype.showMenu=function(t){t.stopPropagation();h.JingjiChangModel.getIns().showMenu(this._vo)};t.prototype.setData=function(t,e,i){this._vo=e;if(!this._shadows){this._shadows=new Laya.Image("res/assist/circle.png");this._shadows.anchorX=this._shadows.anchorY=.5}this.skin.spritejuese.addChild(this._shadows);this.skin.labelname.text="";this.skin.labeljifen.text="";this.skin.imgchenghao.skin="";this.skin.xuweilab.visible=false;if(e){this.skin.labelname.text=game.Context.clearPlayerName(e.name);this.skin.labeljifen.text=app.getLang("jingjichang04",e.value.toNumber().toString())}else{this.skin.xuweilab.visible=true}if(i){if(!this.roleAvatarDatas){this.roleAvatarDatas=new avatar.AvatarData;this.roleAvatars=new avatar.AvatarAnimation;this.roleAvatars.scaleX=1.5;this.roleAvatars.scaleY=1.5;this.roleAvatars.on(Laya.Event.CLICK,this,this.showMenu);this.skin.spritejuese.addChild(this.roleAvatars)}var n="";var a=i;var o=csv.SkinProxy.getIns().getCfg(a.fashion);if(o){n=o.modelres}else{if(a.setskin>0){n=csv.DefclassProxy.getIns().getCfg(a.setskin).model}else{n=csv.DefclassProxy.getIns().getCfg(e.classskin).model}}this.roleAvatarDatas.roleKey=n;this.roleAvatars.setAniData(this.roleAvatarDatas);this.roleAvatars.setAni(avatar.AvatarAnimation.ANI_ENUMS.IDLE,0);this.roleAvatars.play();if(this.waitRoles){this.waitRoles.removeSelf();this.waitRoles=null}var s=csv.JingJiChangProxy.getIns().getCfgByRank(2,t);if(s){this.skin.imgchenghao.skin=csv.TitleProxy.getIns().getTitleUrl(s.showtitle)}else{this.skin.imgchenghao.skin=""}}else{if(!this.waitRoles){this.waitRoles=new Laya.Image("res/static/wuxing/bg_wuxing_jianying.png");this.waitRoles.anchorX=.5;this.waitRoles.anchorY=1}this.skin.spritejuese.addChild(this.waitRoles)}};return t}()})(jjcnew||(jjcnew={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var jjcnew;(function(a){var t=function(t){__extends(n,t);function n(){return t!==null&&t.apply(this,arguments)||this}n.getIns=function(){return app.Singleton.getInstance(n)};n.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=a.JingjiChangModel.getIns();this._vo=this._model.vo;this._rewardList=[];this._rewardList.push(new e(this.itemjiangli01));this._rewardList.push(new e(this.itemjiangli02));this._rewardList.push(new e(this.itemjiangli03));this._rewardList.push(new e(this.itemjiangli04));this._rewardList.push(new e(this.itemjiangli05));this.btnadd.clickHandler=new Laya.Handler(this,this.onAddClickHandler);this.btnshuaxin.clickHandler=new Laya.Handler(this,this.toDoRefresh);this.listketiaozhan.itemRender=i;this.listketiaozhan.renderHandler=new Laya.Handler(this,this.onKeTiaoZhanHandler);this.btnzhanbao.clickHandler=new Laya.Handler(this,this.onFightReport);this.animationfaguang.visible=false;this.animationfaguang.stop();game.HelperViewHandler.register(csv.FunctionsProxy.ENUMS.NEW_JJC,[this.btntip])};n.prototype.onFightReport=function(){app.ViewManager.toggleDialog(o,1,0)};n.prototype.onKeTiaoZhanHandler=function(t){t.setData(t.dataSource)};n.prototype.onAddClickHandler=function(){app.ViewManager.toggleDialog(boss.BossBuyTimeTips,1,0,[csv.DailyTimeProxy.ENUM_TYPE.JJC_NEW,"jingjichang02","jingjichang03"])};n.prototype.toDoRefresh=function(){app.ProtocolRequest.SimpleArenaMatchReq()};n.prototype.onDisplay=function(){this.jianglibox.visible=false;this._model.on(a.JingjiChangEvent.UPDATE_DATA,this,this.refreshAll);this._model.on(a.JingjiChangEvent.GET_PLAYER_LIST,this,this.refreshAll);boss.BossModel.getIns().on(boss.BossEvent.BOSS_DAILY_TIME_CHANGE,this,this.refreshAll);this.toDoRefresh()};n.prototype.onUnDisplay=function(){this._model.off(a.JingjiChangEvent.UPDATE_DATA,this,this.refreshAll);this._model.off(a.JingjiChangEvent.GET_PLAYER_LIST,this,this.refreshAll);boss.BossModel.getIns().off(boss.BossEvent.BOSS_DAILY_TIME_CHANGE,this,this.refreshAll)};n.prototype.sortHandler=function(t,e){if(t.value.toNumber()<e.value.toNumber()){return 1}else if(t.value.toNumber()>e.value.toNumber()){return-1}return 0};n.prototype.refreshAll=function(){this.labeltip.text=app.getLang("jingjichang01");if(!n._disableTop){for(var t=0;t<this._rewardList.length;t++){var e=this._rewardList[t];e.setData(csv.JingJiChangProxy.getIns().jjcawardArr[t]);e.skin.x=this.barjindu.x+e.percent*this.barjindu.width}this.barjindu.value=this._vo.alreadyFightCnt/csv.JingJiChangProxy.getIns().getMaxScore()}this.labelshengyucishunum.text=this._vo.hasCnt()+"/"+this._vo.totalCnt();var i=(this._model.playerList||[]).sort(this.sortHandler);this.listketiaozhan.array=i;this.labelwode02.text=game.Context.clearPlayerName(game.Context.mainRole.playername);this.itemwo01.imgtouxiang.skin=csv.MyTeamProxy.getIns().getTeamIcon(game.Context.teamAvatar);this.itemwo01.imgframe.skin=game.Context.mainRole.getHeadFrameUrl();this.labelwode03.text=this._vo.rankText();this.labelwode04.text=app.getLang("jingjichang04",this._vo.getSelfPoint);this.labelwode05.text=game.MoneyModel.format(game.Context.score).toString();this.itemwo02.icon.skin="public/bg_renwu_chuzhan.png"};n.SINGLE_KEY="jjcnew.JingJiChangView";n._disableTop=true;return n}(ui.jingjichang.jingjichangviewnewUI);a.JingJiChangView=t;var s=function(){function t(){}t.setMoneyIcon=function(t,e){t.skin=e;t.scaleX=t.scaleY=.4};t.parseItemList=function(t,e){for(var i=0;i<t.length;i++){var n=t[i];if(e[i]){n.visible=true;n.setData(e[i])}else{n.visible=false}}};return t}();var e=function(){function t(t){this.skin=t;this.skin.on(Laya.Event.DISPLAY,this,this.onDisplay);this.skin.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.skin.on(Laya.Event.CLICK,this,this.onClick)}t.prototype.onClick=function(){if(this._status==a.ELingQuType.canLingQu){app.ProtocolRequest.SimpleArenaAwardReq(this.cfg.id)}else{tip.TipManager.show(this._itemVo)}};t.prototype.onDisplay=function(){};t.prototype.onUnDisplay=function(){this.stopAnim()};t.prototype.stopAnim=function(){this.skin.animationlingqu.stop();this.skin.animationlingqu.visible=false};t.prototype.clear=function(){this.skin.imgyilingqu.visible=false;this.stopAnim()};Object.defineProperty(t.prototype,"percent",{get:function(){return this.cfg.time/csv.JingJiChangProxy.getIns().getMaxScore()},enumerable:true,configurable:true});t.prototype.setData=function(t){var e=a.JingjiChangModel.getIns().vo;this._vo=e;this._status=e.getlingqu(t.id);this.cfg=t;this._itemVo=game.ItemUtil.parserList(t.award)[0];this.clear();this.skin.labelnum01.text=this._itemVo.count+"";this.skin.lblPoint.text=t.time+"";this.skin.imgicon.skin=this._itemVo.getIconUrl();game.RedDotView.removeFrom(this.skin);switch(this._status){case a.ELingQuType.canLingQu:this.skin.animationlingqu.visible=true;this.skin.animationlingqu.play(0,true);game.RedDotView.addTo(this.skin);break;case a.ELingQuType.isLingQued:this.skin.imgyilingqu.visible=true;break;case a.ELingQuType.canNotLingQu:break}};return t}();var i=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.curTime=0;return t}Object.defineProperty(t.prototype,"vo",{get:function(){return a.JingjiChangModel.getIns().vo},enumerable:true,configurable:true});t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.btntiaozhan.clickHandler=new Laya.Handler(this,this.onTiaoZhangHandler)};t.prototype.onTiaoZhangHandler=function(){if(this.vo.hasCnt()<=0){manager.FlowManager.instance.flowByStyle1(app.getLang("jingjichang12"))}else{if(Laya.timer.currTimer-this.curTime<=5e3){return}this.curTime=Laya.timer.currTimer;app.ProtocolRequest.SimpleArenaChallengeReq(this._data.uid)}};t.prototype.onDisplay=function(){};t.prototype.onUnDisplay=function(){};t.prototype.setData=function(t){this._data=t;this.itemtouxiang.imgtouxiang.skin=csv.MyTeamProxy.getIns().getTeamIcon(t.simpleteamavatar);this.itemtouxiang.imgframe.skin=csv.HeadFrameProxy.getIns().getIcon(t.headframeId);this.labelname.text=t.name;this.labelnum.text=app.getLang("jingjichang04",t.value.toNumber());this.itemmoney.icon.skin="public/bg_renwu_chuzhan.png";this.labelmoney.text=game.MoneyModel.format(t.expval.toNumber()).toString()};return t}(ui.jingjichang.tiaozhanliebiaoitemUI);var n=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.labeltime02.text="";this.btnbofang.clickHandler=new Laya.Handler(this,this.onHuiFang)};e.prototype.onHuiFang=function(){app.ProtocolRequest.SimpleArenaRecordReq(a.JingjiChangModel.getIns().vo.record_data.indexOf(this._data))};e.prototype.setData=function(t){this._data=t;var e="+";if(t.is_win){this.imgshengli.skin="jingjichang/bg_jingjichang_sheng.png"}else{this.imgshengli.skin="jingjichang/bg_jingjichang_bai.png";e="-"}this.labeljifen.text=e+t.score;this.imgzhudongtiaozhan.skin=t.is_active==0?"jingjichang/bg_jjc_fang.png":"jingjichang/bg_jjc_gong.png";this.itemtouxiang.imgtouxiang.skin=csv.MyTeamProxy.getIns().getTeamIcon(t.simpleteamavatar);this.itemtouxiang.imgframe.skin=csv.HeadFrameProxy.getIns().getIcon(t.headframeId);this.labelname.text=t.name;this.labeltime01.text=util.TimeUtil.formatDate(t.time,true)};return e}(ui.jingjichang.zhanbaoitemUI);var o=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.btnqueding.clickHandler=new Laya.Handler(this,this.close);this.listjilu.itemRender=n;this.listjilu.renderHandler=new Laya.Handler(this,this.onRenderHander)};e.prototype.onRenderHander=function(t){t.setData(t.dataSource)};e.prototype.sortFightList=function(t,e){if(t.time>e.time){return-1}else if(t.time<e.time){return 1}return 0};Object.defineProperty(e.prototype,"model",{get:function(){return a.JingjiChangModel.getIns()},enumerable:true,configurable:true});e.prototype.newList=function(){var t=[];for(var e=0;e<this.model.vo.record_data.length;e++){t.push(this.model.vo.record_data[e])}return t};e.prototype.onDisplay=function(){var t=this.newList();t=t.sort(this.sortFightList);this.wuimg.visible=t.length>0?false:true;this.listjilu.array=t;if(t.length>0){this.listjilu.scrollTo(0)}};e.prototype.onUnDisplay=function(){};e.SINGLE_KEY="jjcnew.Zhanbaotip";return e}(ui.jingjichang.zhanbaotipUI);var r=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.list=[];this.list.push(this.itemdaoju01);this.list.push(this.itemdaoju02)};e.prototype.setData=function(t,e,i){this.labelpaiming.visible=false;this.imgpaiming.visible=false;if(e.rank<=3){this.imgpaiming.visible=true;this.imgpaiming.skin="res/static/common/bg_paiming_jingjichang_"+e.rank+".png"}else{var n=t[i-1];var a=t[i+1];this.labelpaiming.visible=true;if(a){this.labelpaiming.text=n.rank+1+"-"+e.rank}else{this.labelpaiming.text=app.getLang("jingjichang08",n.rank)}}this.imgchenghao.skin=csv.TitleProxy.getIns().getBigTitleUrl(e.showtitle);var o=game.ItemUtil.parserList(e.award);s.parseItemList(this.list,o)};return e}(ui.jingjichang.meirijiangliitemnewUI);var l=function(n){__extends(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}t.getIns=function(){return app.Singleton.getInstance(a.Meirijianglitip)};Object.defineProperty(t.prototype,"vo",{get:function(){return a.JingjiChangModel.getIns().vo},enumerable:true,configurable:true});t.prototype.initialize=function(){n.prototype.initialize.call(this);this.listjiangli.renderHandler=new Laya.Handler(this,this.onListJiangLi);this.listjiangli.itemRender=r;this.on(Laya.Event.DISPLAY,this,this.onDisplay);this._list=[];this._list.push(this.itemjiangli01);this._list.push(this.itemjiangli02);var t=["jingjichang16","jingjichang17"];for(var e=0;e<this.tabyeqian.numChildren;e++){var i=this.tabyeqian.getChildAt(e);i.label=t[e]}this.tabyeqian.selectHandler=new Laya.Handler(this,this.onSelectHandler)};t.prototype.onSelectHandler=function(t){var e=0;switch(t){case 0:e=1;break;case 1:e=2;break}this.curArr=csv.JingJiChangProxy.getIns().getListByType(e);this.listjiangli.array=this.curArr;this.listjiangli.scrollTo(0)};t.prototype.upDateSelf=function(t){if(this.vo.isJoin){var e=a.JingjiChangModel.getIns().getAwardCfg(this.vo.selfRank,t);var i=game.ItemUtil.parserList(e.award);s.parseItemList(this._list,i);var n=csv.JingJiChangProxy.getIns().getCfgByRank(t,this.vo.selfRank);if(n){this.chenghaoimg.skin=csv.TitleProxy.getIns().getTitleUrl(n.showtitle)}}else{this.wulab.visible=true}};t.prototype.onListJiangLi=function(t,e){t.setData(this.curArr,t.dataSource,e)};t.prototype.onDisplay=function(){this.labeltip.text=app.getLang("jingjichang18");for(var t=0;t<this._list.length;t++){this._list[t].visible=false}this.wulab.visible=false;this.labelwo02.text=this.vo.rankText();this.chenghaoimg.skin="";this.tabyeqian.selectedIndex=0;this.upDateSelf(2)};t.SINGLE_KEY="jjcnew.Meirijianglitip";return t}(ui.jingjichang.meirijianglitipUI);a.Meirijianglitip=l})(jjcnew||(jjcnew={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var jjcnew;(function(o){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.vo=new o.JingJiChangVo;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.init=function(){boss.BossModel.getIns().on(boss.BossEvent.BOSS_DAILY_TIME_CHANGE,this,this.rewardRed);csv.FunctionsProxy.getIns().on(csv.FunctionsProxy.EVENTS.ADD,this,this.onFunOpen)};t.prototype.getAwardCfg=function(t,e){var i=csv.JingJiChangProxy.getIns().getListByType(e);if(t==0){return i[i.length-1]}for(var n=0;n<i.length;n++){var a=i[n];var o=i[n-1];if(!o&&t<=1){return a}if(o&&t>o.rank&&t<=a.rank){return a}}};t.prototype.refreshReds=function(){var t=false;if(t){}};t.prototype.showMenu=function(t){if(t.uid&&!Uint64.equal(t.uid,game.Context.mainRoleId)){rank.RankModel.showRankBtnList(t.uid,t.name,t.teamlv,t.classskin,t.headframeId)}else{if(app.ViewManager.DisplayedInStage(friend.HaoYouCaiDanView.SINGLE_KEY)){app.ViewManager.toggleView(friend.HaoYouCaiDanView,app.AppContainer.flowLayer,-1)}}};t.prototype.onFunOpen=function(t){if(t.id==csv.FunctionsProxy.ENUMS.NEW_JJC){this.rewardRed()}};t.prototype.rewardRed=function(){var t=false;if(this.vo.hasCnt()>0){t=true}if(o.JingJiChangView._disableTop){}else{var e=csv.JingJiChangProxy.getIns().jjcawardArr;for(var i=0;i<e.length;i++){var n=e[i];var a=this.vo.getlingqu(n.id);if(a==o.ELingQuType.canLingQu){t=true;break}}}if(t){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.NEW_JJC)}else{game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.NEW_JJC)}};t.SINGLE_KEY="jjcnew.JingjiChangModel";return t}(app.ModelBase);o.JingjiChangModel=t;var e=function(){function t(){}t.UPDATE_DATA="UPDATE_DATA";t.RANK_LIST="RANK_LIST";t.GET_PLAYER_LIST="GET_PLAYER_LIST";return t}();o.JingjiChangEvent=e})(jjcnew||(jjcnew={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("jjcaward.csv");this.jjcawardArr=t.getArray();this.jjcawardMap=t.getMap("id");this.maxscore=-1;var e=app.Config.getResById("jjcrank.csv");this.jjcrankArr=e.getArray()};e.prototype.getListByType=function(t){var e=[];for(var i=0;i<this.jjcrankArr.length;i++){var n=this.jjcrankArr[i];if(n.type==t){e.push(n)}}return e};e.prototype.getCfgByRank=function(t,e){for(var i=0;i<this.jjcrankArr.length;i++){var n=this.jjcrankArr[i];if(n.type==t&&n.rank==e){return n}}};e.prototype.getMaxScore=function(){if(this.maxscore==-1){for(var t=0;t<this.jjcawardArr.length;t++){var e=this.jjcawardArr[t];if(e.time>this.maxscore){this.maxscore=e.time}}}return this.maxscore};Object.defineProperty(e.prototype,"maxRank",{get:function(){if(!this._maxR){var t=this.getListByType(1);this._maxR=t[t.length-2].rank}return this._maxR},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"maxPoint",{get:function(){return parseInt(game.Config.getParams(1128).split("-")[0])},enumerable:true,configurable:true});e.SINGLE_KEY="csv.JingJiChangProxy";return e}(app.ModelBase);t.JingJiChangProxy=e})(csv||(csv={}));var jjcnew;(function(e){var n;(function(t){t[t["isLingQued"]=1]="isLingQued";t[t["canNotLingQu"]=2]="canNotLingQu";t[t["canLingQu"]=3]="canLingQu"})(n=e.ELingQuType||(e.ELingQuType={}));var t=function(){function t(){}Object.defineProperty(t.prototype,"model",{get:function(){return e.JingjiChangModel.getIns()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"gloryId",{get:function(){return game.Config.getIntParams(262)},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"gloryImg",{get:function(){return game.ItemUtil.parserList(this.gloryId)[0].getIconUrl()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"selfRank",{get:function(){return this.model.curRank},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"getSelfPoint",{get:function(){if(this.model.simpleArena){return this.model.simpleArena.score}return 0},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"daliyVo",{get:function(){var t=boss.BossModel.getIns();var e=csv.DailyTimeProxy.ENUM_TYPE.JJC_NEW;return t.getDailyTime(e)},enumerable:true,configurable:true});t.prototype.getDailyTime=function(){var t=this.daliyVo;var e=t.fnum+t.gnum;return e};t.prototype.getlingqu=function(t){if(this.model.simpleArena){var e=this.model.simpleArena.weekly_received.indexOf(t);if(e!=-1){return n.isLingQued}var i=csv.JingJiChangProxy.getIns().jjcawardMap[t];if(this.alreadyFightCnt>=i.time){return n.canLingQu}}return n.canNotLingQu};t.prototype.totalCnt=function(){return csv.DailyTimeProxy.getIns().getCfg(csv.DailyTimeProxy.ENUM_TYPE.JJC_NEW).time};t.prototype.hasCnt=function(){return this.getDailyTime()};Object.defineProperty(t.prototype,"alreadyFightCnt",{get:function(){if(this.model.simpleArena){return this.model.simpleArena.weekly_total_times}return 0},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"record_data",{get:function(){if(this.model.simpleArena){return this.model.simpleArena.record_data}return[]},enumerable:true,configurable:true});t.prototype.rankText=function(t){if(t===void 0){t=false}var e=this.selfRank;if(this.model.simpleArena){if(this.model.simpleArena.join_flag==0){return app.getLang("jingjichang09")}if(e==0){return">"+csv.JingJiChangProxy.getIns().maxRank.toString()}if(t){return e.toString()}return app.getLang("jingjichang05",e)+this.getHisMax()}return""};t.prototype.getHisMax=function(){var t=this.selfRank;if(t==0){return""}if(this.model.simpleArena){if(this.model.simpleArena.join_flag==0){return""}return app.getLang("jingjichang15",this.model.simpleArena.high_rank)}return""};Object.defineProperty(t.prototype,"isJoin",{get:function(){if(this.model.simpleArena){return this.model.simpleArena.join_flag==1}return false},enumerable:true,configurable:true});return t}();e.JingJiChangVo=t})(jjcnew||(jjcnew={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var kaifuchongban;(function(n){var p=activitytaren.ActivityTaRenModel;var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){app.ViewManager.regist(n.Jinjiepaihangview,"paihangbang.atlas");game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.BOSS_SHOU_SHA,n.BossshoushaView);game.FuncDotAdapter.registRedFunc(csv.FunctionsProxy.ENUMS.BOSS_SHOU_SHA,n.KaiFuChongBanModel.getIns(),n.KaiFuChongBanModel.getIns().updateRed);var t=[];t.push(csv.FunctionsProxy.ENUMS.CB_RANK_LEVEL,csv.FunctionsProxy.ENUMS.CB_RANK_BROTHER,csv.FunctionsProxy.ENUMS.CB_RANK_EQUIP,csv.FunctionsProxy.ENUMS.CB_RANK_MAGIC,csv.FunctionsProxy.ENUMS.CB_RANK_LILIAN,csv.FunctionsProxy.ENUMS.CB_RANK_ZPLUS,csv.FunctionsProxy.ENUMS.CB_RANK_ZUOQI,csv.FunctionsProxy.ENUMS.CB_RANK_PET,csv.FunctionsProxy.ENUMS.CB_RANK_QIANGHUA);this.funcList=t;for(var e=0;e<t.length;e++){var i=t[e];game.WindowsResigter.registFunctionView(i,n.Jinjiepaihangview);csv.FunctionsProxy.getIns().tab.add(i,new Laya.Handler(this,this.onGetCurCheck))}csv.FunctionsProxy.getIns().mainIconRedirectMap[csv.FunctionsProxy.ENUMS.BOSS_SHOU_SHA]=new Laya.Handler(this,this.onCheckRedicHandler);csv.MainIconProxy.getIns().on(main.MainUIIcon.EVENT_CREATE_BTN,this,this.onCreateBtnHandler);n.KaiFuChongBanModel.getIns().initFuncReg();n.KaiFuChongBanModel.getIns().refreshTime()};e.prototype.onCreateBtnHandler=function(t){if(t==csv.MainIconProxy.TYPE_ICON_KAIFU_CHONGBAN){n.KaiFuChongBanModel.getIns().updateRed()}};e.prototype.onCheckRedicHandler=function(t){for(var e=0;e<this.funcList.length;e++){if(this.onCheckHandler(this.funcList[e])){return this.funcList[e]}}return t};e.prototype.onGetCurCheck=function(t){var e=p.getIns().getActivityID_By_functionid(t);if(!e){return false}var i=e.curCfg;var n=e.timeVo.startTime+parseInt(i.p5);var a=n+86400;var o=game.Context.getServerTime();if(o>=n&&o<=a){return true}};e.prototype.onCheckHandler=function(t){var e=p.getIns().getActivityID_By_functionid(t);if(!e){return false}var i=e.cfgList;for(var n=0;n<i.length;n++){var a=i[n];var o=activitytaren.ActivityTaRenModel.getIns().getSubInfo(a.id);if(o&&o.status==activitytaren.ActivityTaRenLingQuStatus.YOU_CAN_LING_QU){return true}}var s=e.curCfg;var r=e.timeVo.startTime+parseInt(s.p5);var l=r+86400;var h=game.Context.getServerTime();if(h>=r&&h<=l){return true}};e.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.GetActRankListResp,this,this.onGetActRankListRespHandler)};e.prototype.onGetActRankListRespHandler=function(t,e){n.KaiFuChongBanModel.getIns().saveRank(e);n.KaiFuChongBanModel.getIns().event(n.KaiFuChongBanModel.EVENT_GET_RANK_LIST)};return e}(app.ModuleBase);n.KaiFuChongBanModule=t})(kaifuchongban||(kaifuchongban={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var kaifuchongban;(function(o){var s;(function(t){t[t["Brother"]=10]="Brother"})(s=o.E_KF_Rank_Type||(o.E_KF_Rank_Type={}));var t;(function(t){t[t["RankReward"]=1]="RankReward";t[t["TargetReward"]=2]="TargetReward"})(t=o.E_Reward_Type||(o.E_Reward_Type={}));var r;(function(t){t[t["NORMAL"]=0]="NORMAL";t[t["IS_NOT_START"]=1]="IS_NOT_START";t[t["IS_FINISH"]=2]="IS_FINISH"})(r=o.E_KF_ACTIVITY_STATUS||(o.E_KF_ACTIVITY_STATUS={}));var e=function(t){__extends(a,t);function a(){return t!==null&&t.apply(this,arguments)||this}a.getIns=function(){return app.Singleton.getInstance(a)};a.prototype.init=function(){};a.prototype.curRankList=function(t){if(this.rankList){return this.rankList[t]}};a.prototype.saveRank=function(t){if(!this.rankList){this.rankList={}}this.rankList[t.actId]=t};a.prototype.getRankList=function(t,e){a.getIns().once(a.EVENT_GET_RANK_LIST,this,function(){e.run()});app.ProtocolRequest.GetActRankListReq(parseInt(t))};a.prototype.getBuildList=function(t){var e=app.str2Array(t,";");for(var i=0;i<e.length;i++){if(e[i].length<=0)e.splice(i,1)}return e};a.prototype.isLiLianEnable=function(t){if(t==csv.FunctionsProxy.ENUMS.LILIAN){var e=game.TaskModel.getIns().currMainTask;if(!e){var i=csv.DungeonProxy.getIns().getZxrwCfg(dailytask.DailyTaskModel.getIns().taskMainId+1);if(!i){return true}}return false}return true};a.prototype.openTips=function(t,e){var i=a.getIns().getBuildList(t);if(i.length>0){if(i.length>1){app.ViewManager.toggleDialog(o.Tishengfangshitip,1,0,i)}else{var n=parseInt(i[0]);if(this.isLiLianEnable(n)==false){manager.FlowManager.instance.flowByStyle1(app.getLang("func_er_7"))}else{if(e){game.ClosureManager.callFunction(n,undefined,undefined,e)}else{game.ClosureManager.callFunction(n)}}}}else{console.error("cfg.p8功能没有配置")}};a.prototype.hasRed=function(t){var e=app.str2Array(t.trueprice,"-");var i=game.ItemUtil.createVO(parseInt(e[0]));var n=game.GridsModel.getIns().getItemCount(i.getItemId());var a=parseInt(e[1]);var o=false;if(n<a){}else{o=true}var s=0;if(shop.ShopModel.getIns().isbelongLimit(t)){s=1}else{s=shop.ShopModel.getIns().getLimitCnt(t)}if(o&&s>0){return true}return false};a.prototype.hasShopRed=function(){var t=csv.MallProxy.getIns().getArrayByType(csv.MallProxy.ENUM_TYPE.KAI_FU_CHONG_RANK_DUI_HUANG);for(var e=0;e<t.length;e++){var i=t[e];if(this.hasRed(i)){return true}}return false};a.prototype.updateRed=function(){var t=csv.FunctionsProxy.ENUMS.BOSS_SHOU_SHA;if(this.hasShopRed()||activitytaren.ActivityTaRenModel.getIns().hasRedByFuncid(t)){game.ClosureManager.addDot(t)}else{game.ClosureManager.removeDot(t)}this.event(o.KaiFuChongBanModel.EVENT_UPDATE_SHOP)};a.prototype.getActivityTimeStatus=function(t){var e=t.curCfg;var i=t.timeVo.startTime+parseInt(e.p5);var n=t.timeVo.endTime+parseInt(e.p6);var a=game.Context.getServerTime();if(a>i&&a<n){return r.NORMAL}if(a<i){return r.IS_NOT_START}return r.IS_FINISH};a.prototype.getEndTime=function(t){var e=t.curCfg;var i=t.timeVo.startTime+parseInt(e.p6);return i};a.prototype.getRankType=function(t){return parseInt(t.p4)};a.prototype.getLabel=function(t){var e=this.getRankType(t);if(e==s.Brother){var i=csv.DungeonProxy.getIns().getZxrwCfg(t.p1);if(i){var n=app.getLang("kaifuchongban_text_type_"+e,i.chapter+"-"+i.round);return n}else{return e.toString()+","+t.p1}}else{var a=parseInt(t.p1);var n=game.MoneyModel.format(a);return app.getLang("kaifuchongban_text_type_"+e,n)}};a.prototype.getBrotherStr=function(t){var e=csv.DungeonProxy.getIns().getZxrwCfg(t);if(e){return e.chapter+"-"+e.round}return""};a.prototype.getStrByActRank=function(t,e){if(!t){return app.getLang("kaifuchongban_text_09")}var i=this.getRankType(e);if(i==s.Brother){return this.getBrotherStr(t.value)}else{return t.value.toString()}};a.prototype.getRankStr=function(t,e){var i=this.getRankType(e.curCfg);if(i==s.Brother){return this.getBrotherStr(t.value)}var n=game.MoneyModel.format(t.value);return n};a.prototype.refreshTime=function(){this.subTime=this.getNext();Laya.timer.once(this.subTime*1e3,this,this.updateTime)};a.prototype.getNext=function(){return game.Context.getServerZeroTime()+86400-game.Context.getServerTime()};a.prototype.updateTime=function(){csv.FunctionsProxy.getIns().tab.refresh();var t=util.TimeUtil.getDay();this.refreshTime()};a.prototype.getBossList=function(t){var e=[];if(t){var i=t.cfgList;for(var n=0;n<i.length;n++){var a=new o.BossItemVo;a.cfg=i[n];e.push(a)}}return e};a.prototype.initFuncReg=function(){activitytaren.ActivityTaRenModel.getIns().registRedList[csv.FunctionsProxy.ENUMS.BOSS_SHOU_SHA]=new Laya.Handler(this,this.hasShopRed)};a.SINGLE_KEY="kaifuchongban.KaiFuChongBanModel";a.EVENT_GET_RANK_LIST="EVENT_GET_RANK_LIST";a.EVENT_UPDATE_SHOP="EVENT_UPDATE_SHOP";return a}(app.ModelBase);o.KaiFuChongBanModel=e})(kaifuchongban||(kaifuchongban={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var kaifuchongban;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.onInit)};e.prototype.onInit=function(){this.refreshAll()};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){var e=this,i=e.imgxuanzhong,n=e.imgyijisha,a=e.labelname,o=e.imgtouxiang,s=e.imglock;i.visible=t.selected;n.visible=t.isKilled;if(t.hasRed){game.RedDotView.addTo(this,this.width-5,10)}else{game.RedDotView.removeFrom(this)}var r=csv.MonsterProxy.getIns().getCfg(t.monsterCfgId);if(r){a.text=app.getLang(r.monname);o.skin=csv.MonsterProxy.getMonsterHeadUrl(r);this.labellv.text=r.monlevel.toString()}else{}s.visible=false};return e}(ui.kaifuchongbang.bossshoushaitemUI);t.BossshoushaitemView=e})(kaifuchongban||(kaifuchongban={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var kaifuchongban;(function(r){var a=activitytaren.ActivityTimeView;var t=function(n){__extends(t,n);function t(){var t=n!==null&&n.apply(this,arguments)||this;t.bossList=[];return t}t.prototype.initialize=function(){n.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);var t=this,e=t.listboss01,i=t.listboss02;this.listboss.itemRender=r.BossshoushaitemView;this.listboss.renderHandler=new Laya.Handler(this,this.onRenderHandler);this.listboss.hScrollBarSkin="";this.listboss.selectEnable=true;this.listboss.selectHandler=new Laya.Handler(this,this.onSelectHandle);this.listboss.refresh();e.itemRender=grids.GridView;e.renderHandler=grids.GridView.CommonItemRender;this.center1=new game.CenterLayoutMediator(this.listboss01,this,96,e.spaceX);i.itemRender=grids.GridView;i.renderHandler=grids.GridView.CommonItemRender;this.center2=new game.CenterLayoutMediator(this.listboss02,this,96,i.spaceX);this.timec=new a(this.labeltishi02,new Laya.Handler(this,this.onEndHandler),app.getLang("kaifuchongban_text_04"));this.btnqianwangjisha.clickHandler=new Laya.Handler(this,this.onQianWangHandler);this.btnduihuanshangdian.clickHandler=new Laya.Handler(this,this.onDuiHuangHandler)};t.prototype.onFuncRed=function(t){var e=this.functionid;if(e){if(t==e){var i=this.btnduihuanshangdian;if(game.ClosureManager.hasDot(t)){game.RedDotView.addTo(i)}else{game.RedDotView.removeFrom(i)}}}};t.prototype.onDuiHuangHandler=function(){app.ViewManager.toggleDialog(r.DuihuanshangdianView,1,0,this.functionid)};t.prototype.onQianWangHandler=function(){var t=this.listboss.selectedItem;if(t){r.KaiFuChongBanModel.getIns().openTips(t.cfg.p8,t.bossId)}};t.prototype.hideSubTime=function(){this.timec.stop();this.labeltishi02.text=""};t.prototype.onEndHandler=function(){this.hideSubTime()};t.prototype.onSelectHandle=function(t){var e=this,i=e.bossList,n=e.listboss;for(var a=0;a<i.length;a++){var o=i[a];o.selected=a==t}n.refresh();var s=this.bossList[t];if(s){var r=this,l=r.listboss01,h=r.listboss02;var p=s.cfg;this.center1.array=game.ItemUtil.parserList(p.p2);this.center2.array=game.ItemUtil.parserList(p.award);this.imgname.skin="res/static/kaifuchongbang/"+p.cp1+".png"}};t.prototype.onRenderHandler=function(t,e){t.setData(t.dataSource)};t.prototype.onDisplay=function(){r.KaiFuChongBanModel.getIns().on(r.KaiFuChongBanModel.EVENT_UPDATE_SHOP,this,this.updateShopRed);game.Context.on(game.ContextEvent.FUNCTION_DOT_CHANGE,this,this.onFuncRed);this.callLater(this.onInit)};t.prototype.updateShopRed=function(){if(r.KaiFuChongBanModel.getIns().hasShopRed()){game.RedDotView.addTo(this.btnduihuanshangdian)}else{game.RedDotView.removeFrom(this.btnduihuanshangdian)}};t.prototype.onInit=function(){this.refreshAll()};t.prototype.onUnDisplay=function(){r.KaiFuChongBanModel.getIns().off(r.KaiFuChongBanModel.EVENT_UPDATE_SHOP,this,this.updateShopRed);game.Context.off(game.ContextEvent.FUNCTION_DOT_CHANGE,this,this.onFuncRed);this.listboss.selectedIndex=-1;this.hideSubTime()};t.prototype.refreshAll=function(){var t=this,e=t.labelboss01,i=t.labelboss02,n=t.labeltishi01,a=t.btntishi;e.text=app.getLang("kaifuchongban_text_01");i.text=app.getLang("kaifuchongban_text_02");n.text=app.getLang("kaifuchongban_text_03");this.updateShopRed();var o=this.functionid;if(o){var s=this.actVo;this.bossList=r.KaiFuChongBanModel.getIns().getBossList(this.actVo);this.listboss.array=this.bossList;this.listboss.selectedIndex=0;this.timec.start(s.timeVo.endTime)}else{console.error("functionid = null!")}};return t}(ui.kaifuchongbang.bossshoushaviewUI);r.BossshoushaView=t})(kaifuchongban||(kaifuchongban={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var kaifuchongban;(function(p){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.defatultColor=this.labelname.color};e.prototype.setRankBg=function(t){this.imgbg.skin=rank.RankModel.getRankBgUrl(t)};e.prototype.onDisplay=function(){};e.prototype.onUnDisplay=function(){};e.prototype.setData=function(t,e,i){this.rank=i+1;this.actVo=e;this.rankItemData=t;var n=this,a=n.imgpaiming,o=n.labelpaiming,s=n.labelname,r=n.labellevel;var l=this.defatultColor;if(this.rank>3&&e){var h=p.KaiFuChongBanModel.getIns().curRankList(e.actid);if(h&&h.rank>0&&t.name==game.Context.mainRole.playername){l=game.STYLES.YELLOW_COLOR}}if(this.rank<=3){a.visible=true;o.text="";a.skin="paihangbang/bg_paiming_"+this.rank+".png"}else{a.visible=false;o.text=this.rank.toString()}r.text=p.KaiFuChongBanModel.getIns().getRankStr(t,e);s.text=t.name;s.color=r.color=o.color=l;this.setRankBg(this.rank)};return e}(ui.kaifuchongbang.dengjipaihangitemUI);p.Dengjipaihangitem=t})(kaifuchongban||(kaifuchongban={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var kaifuchongban;(function(a){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listpaihang.itemRender=a.Dengjipaihangitem;this.listpaihang.renderHandler=new Laya.Handler(this,this.onListPaiHangHandler)};Object.defineProperty(e.prototype,"actVo",{get:function(){return this.dataSource},enumerable:true,configurable:true});e.prototype.onListPaiHangHandler=function(t,e){t.setData(t.dataSource,this.actVo,e)};e.prototype.onDisplay=function(){this.callLater(this.onInit)};e.prototype.onInit=function(){a.KaiFuChongBanModel.getIns().getRankList(this.actVo.actid,new Laya.Handler(this,this.onRankCallBack))};e.prototype.onRankCallBack=function(){this.refreshAll()};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){var t=this.labeltitle;var e=this.actVo.curCfg;this.cfg=e;var i=csv.FunctionsProxy.getIns().getCfg(e.functionid);t.text=i.buttonname;var n=this.labellevel;n.text=app.getLang("kaifuchongban_text_label_"+a.KaiFuChongBanModel.getIns().getRankType(e));this.rankData=a.KaiFuChongBanModel.getIns().curRankList(this.actVo.actid);if(this.rankData){this.listpaihang.array=this.rankData.data}else{this.listpaihang.array=[]}};e.SINGLE_KEY="kaifuchongban.Dengjipaihangview";return e}(ui.kaifuchongbang.dengjipaihangviewUI);a.Dengjipaihangview=t})(kaifuchongban||(kaifuchongban={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var kaifuchongban;(function(t){var d=shop.ShopModel;var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.btnduihuan.clickHandler=new Laya.Handler(this,this.onDuiHuangHandler);this.defaultColor=this.labelmoneynum.color};e.prototype.onDuiHuangHandler=function(){var t=this,e=t.moneyVo,i=t.cfg;if(!e){return}if(game.GridsModel.getIns().hasEnoughItems(e,true,true)){d.getIns().buy(i,1)}};e.prototype.onDisplay=function(){this.callLater(this.onInit)};e.prototype.onInit=function(){this.refreshAll()};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){this.cfg=t;var e=game.ItemUtil.createVO(t.item);e.setCount(t.num);this.itemVo=e;this.itemdaoju.setData(e);var i=this,n=i.itemmoney,a=i.labelmoneynum,o=i.labelname,s=i.labelxiangou;var r=t.trueprice;var l=app.str2Array(r,"-");var h=game.ItemUtil.createVO(parseInt(l[0]));var p=parseInt(l[1]);h.setCount(p);this.moneyVo=h;n.icon.skin=h.getIconUrl();n.icon.scaleX=.4;n.icon.scaleY=.4;var u=game.GridsModel.getIns().getItemCount(h.getItemId());var c=false;if(u<p){a.color=game.STYLES.RED_COLOR_S}else{a.color=this.defaultColor;c=true}var g=0;if(d.getIns().isbelongLimit(t)){s.text=app.getLang("buxiangliang");g=1}else{g=d.getIns().getLimitCnt(t);s.text=app.getLang("kaifuchongban_text_05",g)}var f=this.btnduihuan;if(c&&g>0){game.RedDotView.addTo(f)}else{game.RedDotView.removeFrom(f)}a.text=p.toString();o.text=e.getName();o.color=game.STYLES.ITEM_QUALITY_S[e.getQuality()]};return e}(ui.kaifuchongbang.duihuanshangdianitemUI);t.Duihuanshangdianitem=e})(kaifuchongban||(kaifuchongban={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var kaifuchongban;(function(i){var t=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);var t=this.listshangdian;t.itemRender=i.Duihuanshangdianitem;t.renderHandler=new Laya.Handler(this,this.renderHandler)};t.prototype.renderHandler=function(t,e){t.setData(t.dataSource)};t.prototype.onDisplay=function(){game.GridsModel.getIns().on(game.GridsModel.EVENTS.UPDATE,this,this.onInit);this.callLater(this.onInit)};t.prototype.onInit=function(){this.refreshAll()};t.prototype.onUnDisplay=function(){game.GridsModel.getIns().off(game.GridsModel.EVENTS.UPDATE,this,this.onInit)};t.prototype.refreshAll=function(){var t=csv.MallProxy.getIns().getArrayByType(csv.MallProxy.ENUM_TYPE.KAI_FU_CHONG_RANK_DUI_HUANG);this.listshangdian.array=t;var e=this,i=e.imgmoney,n=e.labelmoneynum;if(t.length){var a=t[0];var o=a.trueprice;var s=app.str2Array(o,"-");var r=game.ItemUtil.createVO(parseInt(s[0]));var l=parseInt(s[1]);i.skin=r.getIconUrl();i.scaleX=.4;i.scaleY=.4;var h=game.GridsModel.getIns().getItemCount(r.getItemId());n.text=h.toString()}};t.SINGLE_KEY="kaifuchongban.DuihuanshangdianView";return t}(ui.kaifuchongbang.duihuanshangdianviewUI);i.DuihuanshangdianView=t})(kaifuchongban||(kaifuchongban={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var kaifuchongban;(function(r){var t=function(n){__extends(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}t.prototype.initialize=function(){n.prototype.initialize.call(this);var t=this,e=t.listdaoju,i=t.btnlingqu;e.itemRender=grids.GridView;e.renderHandler=new Laya.Handler(this,this.onCellHandler);e.repeatY=6;i.clickHandler=new Laya.Handler(this,this.onClickHander)};t.prototype.onCellHandler=function(t,e){var i=this.cfg.receive_effect.split(";")[e];t.setData(t.dataSource,"",1,undefined,i)};t.prototype.getCurFuncid=function(){return csv.FunctionsProxy.getIns().convertCanOpenfuncid(csv.MainIconProxy.getIns().mainDigMap(csv.MainIconProxy.TYPE_ICON_KAIFU_CHONGBAN))};t.prototype.onClickHander=function(){this.oldFuncid=this.getCurFuncid();activitytaren.ActivityTaRenModel.getIns().lingQu(this.cfg.id,1,new Laya.Handler(this,this.onRefreshHandler))};t.prototype.onRefreshHandler=function(){this.setData(this.cfg,this.index);var t=this.getCurFuncid();if(t!=this.oldFuncid){game.ClosureManager.callFunction(t)}};t.prototype.setRankBg=function(t){this.imgbg.skin=rank.RankModel.getRankBgUrl(t)};t.prototype.setData=function(t,e){this.index=e;if(!t){return}this.cfg=t;this.setRankBg(e+1);var i=r.KaiFuChongBanModel.getIns().getRankType(t);this.onUpdateHander();var n=this,a=n.imgyilingqu,o=n.btnlingqu;var s=activitytaren.ActivityTaRenModel.getIns().getSubInfo(t.id);if(s){switch(s.status){case activitytaren.ActivityTaRenLingQuStatus.IS_ALREADY_LING_QU:a.visible=true;o.visible=false;break;case activitytaren.ActivityTaRenLingQuStatus.YOU_CAN_LING_QU:a.visible=false;o.visible=true;break;case activitytaren.ActivityTaRenLingQuStatus.CAN_T_LINGQU:a.visible=false;o.visible=false;break}}else{console.error("%d没有领取信息",t.id)}};t.prototype.onUpdateHander=function(){var t=this.cfg;var e=this,i=e.labelpaiming,n=e.listdaoju;var a=game.ItemUtil.parserList(t.award);n.array=a;var o=parseInt(t.p3);switch(o){case r.E_Reward_Type.RankReward:i.text=app.getLang("kaifuchongban_text_07",t.p1,t.p2);break;case r.E_Reward_Type.TargetReward:i.text=r.KaiFuChongBanModel.getIns().getLabel(t);break}};return t}(ui.kaifuchongbang.jinjiepaihangitemUI);r.Jinjiepaihangitem=t})(kaifuchongban||(kaifuchongban={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var kaifuchongban;(function(h){var t=function(a){__extends(t,a);function t(){var t=a!==null&&a.apply(this,arguments)||this;t.itemHeight=100;return t}t.prototype.initialize=function(){a.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);var t=this,e=t.listpaihang,i=t.btnchakanpaihang,n=t.btntishengdengji;e.itemRender=h.Jinjiepaihangitem;e.renderHandler=new Laya.Handler(this,this.renderHandler);this.timec=new activitytaren.ActivityTimeView(this.labeltishi,new Laya.Handler(this,this.hideSubTime),app.getLang("kaifuchongban_text_04"));i.clickHandler=new Laya.Handler(this,this.onPaiHangHander);n.clickHandler=new Laya.Handler(this,this.onTishengdengji)};t.prototype.onTishengdengji=function(){if(this.actVo){h.KaiFuChongBanModel.getIns().openTips(this.cfg.p8)}};t.prototype.onPaiHangHander=function(){var t=this.actVo;if(t){var e=h.KaiFuChongBanModel.getIns().getActivityTimeStatus(this.actVo);switch(e){case h.E_KF_ACTIVITY_STATUS.NORMAL:case h.E_KF_ACTIVITY_STATUS.IS_FINISH:app.ViewManager.toggleDialog(h.Dengjipaihangview,1,0,t);break;case h.E_KF_ACTIVITY_STATUS.IS_NOT_START:manager.FlowManager.instance.flowByStyle1(app.getLang("kaifuchongban_text_10"));break}}};t.prototype.hideSubTime=function(){this.timec.stop();this.labeltishi.text=app.getLang("kaifuchongban_text_04",app.getLang("kaifuchongban_text_06"))};t.prototype.renderHandler=function(t,e){this.itemHeight=t.height;t.setData(t.dataSource,e)};t.prototype.onDisplay=function(){this.callLater(this.onInit)};t.prototype.onInit=function(){var t=this.actVo;if(t){this.cfg=this.actVo.curCfg;var e=h.KaiFuChongBanModel.getIns().getActivityTimeStatus(this.actVo);switch(e){case h.E_KF_ACTIVITY_STATUS.NORMAL:case h.E_KF_ACTIVITY_STATUS.IS_FINISH:h.KaiFuChongBanModel.getIns().getRankList(this.actVo.actid,new Laya.Handler(this,this.onRankCallBack));break;case h.E_KF_ACTIVITY_STATUS.IS_NOT_START:this.refreshAll();break}}};t.prototype.onRankCallBack=function(){this.refreshAll()};Object.defineProperty(t.prototype,"myRank",{get:function(){this.rankData=h.KaiFuChongBanModel.getIns().curRankList(this.actVo.actid);if(!this.rankData){return 0}return this.rankData.rank},enumerable:true,configurable:true});t.prototype.onUnDisplay=function(){this.hideSubTime()};t.prototype.getCanLingquScrollBarValue=function(){var t=this.itemHeight;var e=t+this.listpaihang.spaceY;var i=this.listpaihang.height/e;var n={start:-1,end:-1};var a=this.actVo.cfgList;for(var o=0;o<a.length;o++){var s=a[o];var r=activitytaren.ActivityTaRenModel.getIns().getSubInfo(s.id);if(r&&r.status==activitytaren.ActivityTaRenLingQuStatus.YOU_CAN_LING_QU){if(n.start==-1){n.start=o}n.end=o}}var l=0;if(n.start==-1){}else{if(n.end>0){l=(n.end-i+1)*e}if(l<0){l=0}}return l};t.prototype.refreshAll=function(){var t=h.KaiFuChongBanModel.getIns().getActivityTimeStatus(this.actVo);switch(t){case h.E_KF_ACTIVITY_STATUS.NORMAL:var e=h.KaiFuChongBanModel.getIns().getEndTime(this.actVo);this.timec.start(e);break;case h.E_KF_ACTIVITY_STATUS.IS_FINISH:this.hideSubTime();break;case h.E_KF_ACTIVITY_STATUS.IS_NOT_START:this.timec.stop();this.labeltishi.text=app.getLang("kaifuchongban_text_04",app.getLang("kaifuchongban_text_12"));break}if(ent.DebugConfig.isDebugger){}var i=this,n=i.listpaihang,a=i.labelwodepaimingnum,o=i.btntishi,s=i.labellevelnum;n.array=this.actVo.cfgList;if(this.actVo.cfgList.length>0){var r=this.getCanLingquScrollBarValue();this.listpaihang.scrollBar.value=r}this.cfg=this.actVo.curCfg;this.imgbanner.skin="res/static/kaifuchongbang/"+this.cfg.cp2+".jpg";if(this.myRank>0){a.text=this.myRank.toString()}else{a.text=app.getLang("kaifuchongban_text_09")}if(t==h.E_KF_ACTIVITY_STATUS.IS_NOT_START){this.labellevel.text="";s.text=""}else{this.labellevel.text=app.getLang("kaifuchongban_text_label_"+h.KaiFuChongBanModel.getIns().getRankType(this.cfg))+" ";s.text=h.KaiFuChongBanModel.getIns().getStrByActRank(this.rankData,this.cfg)}this.labellevel.x=this.labellevelnum.x-this.labellevel.textField.textWidth;var l=h.KaiFuChongBanModel.getIns().getRankType(this.cfg);this.btntishengdengji.label=app.getLang("kaifuchongban_text_button_"+l)};return t}(ui.kaifuchongbang.jinjiepaihangviewUI);h.Jinjiepaihangview=t})(kaifuchongban||(kaifuchongban={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var kaifuchongban;(function(i){var t=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.initialize=function(){e.prototype.initialize.call(this);var t=this.btnrukou;t.clickHandler=new Laya.Handler(this,this.onClickHandler)};t.prototype.onClickHandler=function(){if(this.funcid){game.ClosureManager.callFunction(this.funcid)}app.ViewManager.toggleDialog(i.Tishengfangshitip,-1,0)};t.prototype.setData=function(t){var e=parseInt(t);this.funcid=e;var i=csv.FunctionsProxy.getIns().getCfg(e);if(i){this.btnrukou.skin=csv.FunctionsProxy.getIns().getUrl(i.bigicon,i.resident)}};return t}(ui.kaifuchongbang.tishengfangshiitemUI);i.Tishengfangshiitem=t})(kaifuchongban||(kaifuchongban={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var kaifuchongban;(function(i){var t=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);var t=this.listrukou;t.itemRender=i.Tishengfangshiitem;t.renderHandler=new Laya.Handler(this,this.onRenderHandler)};t.prototype.onRenderHandler=function(t,e){t.setData(t.dataSource)};t.prototype.onDisplay=function(){this.callLater(this.onInit)};t.prototype.onInit=function(){this.refreshAll()};t.prototype.onUnDisplay=function(){};t.prototype.refreshAll=function(){this.listrukou.array=this.dataSource};t.SINGLE_KEY="kaifuchongban.Tishengfangshitip";return t}(ui.kaifuchongbang.tishengfangshitipUI);i.Tishengfangshitip=t})(kaifuchongban||(kaifuchongban={}));var kaifuchongban;(function(t){var n=activitytaren.ActivityTaRenModel;var e=function(){function i(){}Object.defineProperty(i.prototype,"isKilled",{get:function(){var t=this.cfg;if(!t){return false}var e=n.getIns().getSubInfo(t.id);if(!e){return false}return e.status==i.STATUS_IS_KILLED},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"monsterCfgId",{get:function(){if(this.cfg){return parseInt(this.cfg.p3)}return 1},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"bossId",{get:function(){if(this.cfg){return parseInt(this.cfg.p1)}return 0},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"hasRed",{get:function(){var t=csv.BossProxy.getIns().getCfg(this.bossId);if(!this.isKilled&&game.Context.isTeamLvReach(t.teamlv,false)){return true}else{return false}},enumerable:true,configurable:true});i.STATUS_IS_KILLED=2;i.STATUS_WITHOUT_KILLED=0;return i}();t.BossItemVo=e})(kaifuchongban||(kaifuchongban={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var leijichongzhi;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){app.ViewManager.regist(i.LeichongjiangliView,"public.atlas");game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.LEI_JI_CHONG_ZHI,i.LeichongjiangliView,null,5)};e.prototype.initCommands=function(){};return e}(app.ModuleBase);i.LeijichongzhiModule=t})(leijichongzhi||(leijichongzhi={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var leijichongzhi;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){};e.SINGLE_KEY="leijichongzhi.LeichongjiangliModel";e.EVENT_INIT="EVENT_INIT";return e}(app.ModelBase);t.LeichongjiangliModel=e})(leijichongzhi||(leijichongzhi={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var leijichongzhi;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.gezilist.itemRender=grids.GridView;this.gezilist.renderHandler=new Laya.Handler(this,this.onItemRender);this.btnlingqu.clickHandler=new Laya.Handler(this,this.onLingquHandler);this.btnchongzhi.clickHandler=new Laya.Handler(this,this.onChongZhiHandler);game.RedDotView.addTo(this.btnlingqu)};e.prototype.onItemRender=function(t){t.setData(t.dataSource);t.setCntScale(this.gezilist.scaleX)};e.prototype.onChongZhiHandler=function(){shop.ShopModel.getIns().chongzhi()};e.prototype.onLingquHandler=function(){activitytaren.ActivityTaRenModel.getIns().lingQu(this.cfg.id,1,new Laya.Handler(this,this.onRefreshHandler))};e.prototype.onRefreshHandler=function(){i.LeichongjiangliModel.getIns().event(i.LeichongjiangliModel.EVENT_INIT)};e.prototype.onDisplay=function(){};e.prototype.onUnDisplay=function(){};e.prototype.setData=function(t,e){this.actVo=t;this.cfg=e;var i=game.ItemUtil.parserList(e.award);this.gezilist.array=i;this.gezilist.width=i.length*(this.gezilist.spaceX+98);this.clipnum.value=e.p1;var n=t.getSubInfo(e.id);if(n){this.wenben.text=n.option+"/"+e.p1;switch(n.status){case activitytaren.ActivityTaRenLingQuStatus.CAN_T_LINGQU:this.imgyilingqu.visible=false;this.btnlingqu.visible=false;this.btnchongzhi.visible=true;break;case activitytaren.ActivityTaRenLingQuStatus.IS_ALREADY_LING_QU:this.imgyilingqu.visible=true;this.btnlingqu.visible=false;this.btnchongzhi.visible=false;break;case activitytaren.ActivityTaRenLingQuStatus.YOU_CAN_LING_QU:this.imgyilingqu.visible=false;this.btnchongzhi.visible=false;this.btnlingqu.visible=true;break;default:break}}else{this.imgyilingqu.visible=false;this.btnlingqu.visible=false;this.btnchongzhi.visible=true}this.imgleiji.on(Laya.Event.LOADED,this,this.onChange);this.onChange()};e.prototype.onChange=function(){};return e}(ui.xinshangcheng2.leichongjiangliitemUI);i.LeichongjiangliItemView=t})(leijichongzhi||(leijichongzhi={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var leijichongzhi;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.liebiao.repeatX=0;this.liebiao.repeatY=0;this.liebiao.itemRender=i.LeichongjiangliItemView;this.liebiao.renderHandler=new Laya.Handler(this,this.onRenderHandler);this.activityTimeView=new activitytaren.ActivityTimeView(this.daojishi,new Laya.Handler(this,this.endTimeCallBack),app.getLang("huodong_text05"))};e.prototype.onRenderHandler=function(t,e){t.setData(this.actVo,t.dataSource)};e.prototype.onDisplay=function(){game.MoneyModel.getIns().on(game.MoneyModel.EVENTS.MONEY_CHANGE,this,this.onMoneyChange);i.LeichongjiangliModel.getIns().on(i.LeichongjiangliModel.EVENT_INIT,this,this.onInitHandler);this.callLater(this.onInitHandler)};e.prototype.endTimeCallBack=function(){this.activityTimeView.stop();this.daojishi.text=""};e.prototype.onUnDisplay=function(){game.MoneyModel.getIns().off(game.MoneyModel.EVENTS.MONEY_CHANGE,this,this.onMoneyChange);i.LeichongjiangliModel.getIns().off(i.LeichongjiangliModel.EVENT_INIT,this,this.onInitHandler);this.activityTimeView.stop()};e.prototype.onInitHandler=function(){this.onMoneyChange();this.activityTimeView.start(this.actVo.timeVo.endTime);this.liebiao.array=shouchonghaoli.ShouChongModel.getIns().sortlist(this.actVo,this.actVo.cfgList);var t=game.ItemUtil.parserList(this.actVo.cfgList[0].p7)[0];this.daojuimg.skin=t?t.getIconUrl():""};e.prototype.onMoneyChange=function(){};return e}(ui.xinshangcheng2.leichongjiangliviewUI);i.LeichongjiangliView=t})(leijichongzhi||(leijichongzhi={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var leijixiaofei;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){app.ViewManager.regist(i.Leijixiaofeiview,"public.atlas");game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.LEI_JI_XIAOFEI,i.Leijixiaofeiview,null,5)};e.prototype.initCommands=function(){};return e}(app.ModuleBase);i.LeijiXiaoFeiModule=t})(leijixiaofei||(leijixiaofei={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var leijixiaofei;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.gezilist.itemRender=grids.GridView;this.gezilist.renderHandler=grids.GridView.CommonItemRender;this.btnlingqu.clickHandler=new Laya.Handler(this,this.onLingquHandler);this.btnchongzhi.clickHandler=new Laya.Handler(this,this.onShangChengHandler);game.RedDotView.addTo(this.btnlingqu)};e.prototype.onShangChengHandler=function(){var t=csv.FunctionsProxy.getIns().convertCanOpenfuncid(csv.MainIconProxy.getIns().getCfg(csv.MainIconProxy.TYPE_ICON_SHANG_CHENG));game.ClosureManager.callFunction(t)};e.prototype.onLingquHandler=function(){activitytaren.ActivityTaRenModel.getIns().lingQu(this.cfg.id,1,new Laya.Handler(this,this.onRefreshHandler))};e.prototype.onRefreshHandler=function(){i.Leijixiaofeiview.getIns().onInitHandler()};e.prototype.onDisplay=function(){};e.prototype.onUnDisplay=function(){};e.prototype.setData=function(t,e){this.actVo=t;this.cfg=e;this.gezilist.array=game.ItemUtil.parserList(e.award);this.clipnum.value=e.p1;var i=t.getSubInfo(e.id);if(i){switch(i.status){case activitytaren.ActivityTaRenLingQuStatus.CAN_T_LINGQU:this.imgyilingqu.visible=false;this.btnlingqu.visible=false;this.btnchongzhi.visible=true;this.btnchongzhi.label=app.getLang("qianwang");break;case activitytaren.ActivityTaRenLingQuStatus.IS_ALREADY_LING_QU:this.imgyilingqu.visible=true;this.btnlingqu.visible=false;this.btnchongzhi.visible=false;break;case activitytaren.ActivityTaRenLingQuStatus.YOU_CAN_LING_QU:this.imgyilingqu.visible=false;this.btnchongzhi.visible=false;this.btnlingqu.visible=true;break;default:break}}else{this.imgyilingqu.visible=false;this.btnlingqu.visible=false;this.btnchongzhi.visible=true}};return e}(ui.yunyinghuodong.leijixiaofeiitemUI);i.LeijixiaofeiitemView=t})(leijixiaofei||(leijixiaofei={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var leijixiaofei;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.baglist.repeatX=0;this.baglist.repeatY=0;this.baglist.itemRender=i.LeijixiaofeiitemView;this.baglist.renderHandler=new Laya.Handler(this,this.onRenderHandler);this.activityTimeView=new activitytaren.ActivityTimeView(this.labeldaojishi,new Laya.Handler(this,this.endTimeCallBack),app.getLang("huodong_text05"));tip.TipManager.bindMoneyTips(this.imghuobi,game.MoneyModel.MONEY_ENUM.GOLD)};e.prototype.endTimeCallBack=function(){this.activityTimeView.stop();this.labeldaojishi.text=""};e.prototype.onRenderHandler=function(t,e){t.setData(this.actVo,t.dataSource)};e.prototype.onDisplay=function(){game.MoneyModel.getIns().on(game.MoneyModel.EVENTS.MONEY_CHANGE,this,this.onMoneyChange);this.callLater(this.onInitHandler)};e.prototype.onInitHandler=function(){game.HelperViewHandler.register(this.functionid,[this.btnwenhao]);this.clipchongzhishu.value=activitytaren.ActivityTaRenModel.getIns().getAllRecharge(this.actVo).toString();this.onMoneyChange();this.activityTimeView.start(this.actVo.timeVo.endTime);this.baglist.array=shouchonghaoli.ShouChongModel.getIns().sortlist(this.actVo,this.actVo.cfgList)};e.prototype.onMoneyChange=function(){this.labelshuzi.text=game.MoneyModel.format(game.MoneyModel.getIns().getMoney(game.MoneyModel.MONEY_ENUM.GOLD))};e.prototype.onUnDisplay=function(){game.MoneyModel.getIns().off(game.MoneyModel.EVENTS.MONEY_CHANGE,this,this.onMoneyChange);this.activityTimeView.stop()};return e}(ui.yunyinghuodong.leijixiaofeiviewUI);i.Leijixiaofeiview=t})(leijixiaofei||(leijixiaofei={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var levelpackage;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.LEVEL_UP_PACKAGE,i.LevelPackageView);game.WindowsResigter.registFunctionOpenCheck(csv.FunctionsProxy.ENUMS.LEVEL_UP_PACKAGE,new Laya.Handler(this,this.openCheck,[csv.FunctionsProxy.ENUMS.LEVEL_UP_PACKAGE]))};e.prototype.initCommands=function(){};e.prototype.onRoleLevelChange=function(){};e.prototype.openCheck=function(t){if(!activitytaren.ActivityTaRenModel.getIns().iconMan.isCanShowByFuncID(t)){manager.FlowManager.instance.flowByStyle1(app.getLang("huodong_text06"));return false}else{game.ClosureManager.callFunction(t,true,true);return true}};return e}(app.ModuleBase);i.LevelPackageModule=t})(levelpackage||(levelpackage={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var levelpackage;(function(t){var e=function(t){__extends(n,t);function n(){return t!==null&&t.apply(this,arguments)||this}n.getIns=function(){return app.Singleton.getInstance(n)};n.prototype.init=function(){};n.prototype.sortByID=function(t,e){if(t.id>e.id){return-1}else if(t.id<e.id){return 1}return 0};n.prototype.pushByState=function(t,e,i){for(var n=0;n<t.length;n++){var a=t[n];if(this.getLingQuState(a)==i){e.push(a)}}};n.prototype.sortList=function(t){var e={};var i=[];this.pushByState(t,i,n.LINGQU_ENUM.CAN_LINGQU);e.index=i.length;this.pushByState(t,i,n.LINGQU_ENUM.CANT_NOT_LINGQU);this.pushByState(t,i,n.LINGQU_ENUM.IS_WITHOUT_LINGQU);this.pushByState(t,i,n.LINGQU_ENUM.IS_LINGQU);e.list=i;if(e.index>0){e.index--}return e};n.prototype.getLingQuState=function(t){var e=t.id;var i=activitytaren.ActivityTaRenModel.getIns().getSubInfo(e);if(i){if(i.num==0&&i.status!=n.LINGQU_ENUM.IS_LINGQU){return n.LINGQU_ENUM.IS_WITHOUT_LINGQU}return i.status}};n.prototype.isShowSubCnt=function(t){if(t.p3==""||parseInt(t.p3)==0){return false}return true};n.prototype.getSubCnt=function(t){var e=t.id;var i=activitytaren.ActivityTaRenModel.getIns().getSubInfo(e);if(i){return i.num}return parseInt(t.p3)};n.SINGLE_KEY="levelpackage.LevelPackageModel";n.LINGQU_ENUM={CAN_LINGQU:1,CANT_NOT_LINGQU:0,IS_LINGQU:2,IS_WITHOUT_LINGQU:3};return n}(app.ModelBase);t.LevelPackageModel=e})(levelpackage||(levelpackage={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var levelpackage;(function(n){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listdaoju.itemRender=grids.GridView;this.listdaoju.renderHandler=new Laya.Handler(this,this.onCellHandler);this.btnlingqu.clickHandler=new Laya.Handler(this,this.onOkHandle)};e.prototype.onCellHandler=function(t,e){var i=this.cfg.receive_effect.split(";")[e];t.setData(t.dataSource,"",1,undefined,i)};e.prototype.onOkHandle=function(){var t=this.cfg;n.LevelPackageView.getIns().listAni.setLeftAni(this,"id");activitytaren.ActivityTaRenModel.getIns().once(activitytaren.ActivityTaRenModel.ACTIVIT_TAREN_EVENT.UPDATE_ACTIVIT_DATA,this,this.updateActivitData);app.ProtocolRequest.RecvActPrizeReq(t.id,1)};e.prototype.updateActivitData=function(){activitytaren.ActivityTaRenModel.getIns().getInfoByActID(this.cfg.activityid,new Laya.Handler(this,this.onUpdateHander))};e.prototype.onUpdateHander=function(){this.setData(this.cfg)};e.prototype.onDisplay=function(){};e.prototype.onUnDisplay=function(){};e.prototype.setData=function(t){this.cfg=t;var e=app.getLang("level_reward_txt_01",t.p1);this.labeltitle.text=e;this.listdaoju.array=game.ItemUtil.parserList(t.award);var i=n.LevelPackageModel.getIns().getLingQuState(t);this.refreshByStat(i)};e.prototype.showRedPoint=function(t){if(t){game.RedDotView.addTo(this.btnlingqu)}else{game.RedDotView.removeFrom(this.btnlingqu)}};e.prototype.refreshSubCnt=function(){};e.prototype.refreshByStat=function(t){switch(t){case n.LevelPackageModel.LINGQU_ENUM.CAN_LINGQU:this.imgyilingqu.visible=false;this.btnlingqu.visible=true;this.btnlingqu.gray=false;this.btnlingqu.mouseEnabled=true;this.btnlingqu.label=app.getLang("huodong_text03");this.refreshSubCnt();this.showRedPoint(true);break;case n.LevelPackageModel.LINGQU_ENUM.CANT_NOT_LINGQU:this.imgyilingqu.visible=false;this.btnlingqu.visible=true;this.btnlingqu.gray=true;this.btnlingqu.label=app.getLang("huodong_text03");this.btnlingqu.mouseEnabled=false;this.refreshSubCnt();this.showRedPoint(false);break;case n.LevelPackageModel.LINGQU_ENUM.IS_LINGQU:this.imgyilingqu.visible=true;this.imgyilingqu.skin="public/bg_yilingqu.png";this.btnlingqu.visible=false;this.btnlingqu.gray=true;this.btnlingqu.label=app.getLang("huodong_text04");this.btnlingqu.mouseEnabled=false;break;case n.LevelPackageModel.LINGQU_ENUM.IS_WITHOUT_LINGQU:this.imgyilingqu.visible=true;this.imgyilingqu.skin="public/bg_yilingwan.png";this.btnlingqu.visible=false;break}};return e}(ui.fulidaing.dengjijiangliitemUI);n.LevelPackageItemView=t})(levelpackage||(levelpackage={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var levelpackage;(function(a){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.actIDs=[];return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listAni=new common.SimpleListAni(this.panelshouhu,a.LevelPackageItemView,new Laya.Handler(this,this.renderHandle));this.timec=new activitytaren.ActivityTimeView(this.labeltishi,new Laya.Handler(this,this.onEndHandler),app.getLang("kaifuchongban_text_04"));guide.GuideModel.getIns().register(csv.GuideProxy.ENUM_VIEW.DENGJI_JIANGLI,this,this.getGuideItemBtn,500)};t.prototype.getGuideItemBtn=function(){return this.panelshouhu.cells[0].btnlingqu};t.prototype.onEndHandler=function(){this.hideSubTime()};t.prototype.hideSubTime=function(){this.timec.stop();this.labeltishi.text=""};t.prototype.renderHandle=function(t,e){t.setData(t.dataSource)};t.prototype.onDisplay=function(){activitytaren.ActivityTaRenModel.getIns().on(activitytaren.ActivityTaRenModel.ACTIVIT_TAREN_EVENT.GET_MAIN_PANEL_INFO,this,this.onGetMainPanel);game.RoleModel.getIns().on(game.RoleModel.EVENTS.LEVEL_CHANGE,this,this.onRoleLevelChange);this.callLater(this.onInit)};t.prototype.onGetMainPanel=function(){this.refreshAll()};t.prototype.onInit=function(){this.refreshAll(true)};t.prototype.onUnDisplay=function(){activitytaren.ActivityTaRenModel.getIns().off(activitytaren.ActivityTaRenModel.ACTIVIT_TAREN_EVENT.GET_MAIN_PANEL_INFO,this,this.onGetMainPanel);game.RoleModel.getIns().off(game.RoleModel.EVENTS.LEVEL_CHANGE,this,this.onRoleLevelChange)};t.prototype.onRoleLevelChange=function(){this.refreshAll()};t.prototype.getIndex=function(t){var e=0;var i=Math.floor(this.panelshouhu.height/168);if(t.index+1>=i){e=t.index+1-i}else{e=0}return e};t.prototype.refreshAll=function(t){if(t===void 0){t=false}var e=csv.ActivityTarenProxy.getIns().activityidMap[this.actVo.actid];var i=a.LevelPackageModel.getIns().sortList(e);this.listAni.array=i.list;if(t){var n=0;this.listAni.scrollTo(n)}this.timec.start(this.actVo.timeVo.endTime)};t.SINGLE_KEY="levelpackage.LevelPackageView";return t}(ui.fulidaing.dengjijiangliviewUI);a.LevelPackageView=t})(levelpackage||(levelpackage={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var lianpenglianziCode;(function(o){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){this._model=o.LianPengLianZiModel.getIns();app.ViewManager.regist(o.LianPengView,"lianpenglianzi.atlas");app.ViewManager.regist(o.LianZiView,"lianpenglianzi.atlas");game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.LIANPENG,o.LianPengView);game.FuncDotAdapter.registRedFunc(csv.FunctionsProxy.ENUMS.LIANPENG,this._model,this._model.showLianPengRedTip);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.LIANZI,o.LianZiView);game.FuncDotAdapter.registRedFunc(csv.FunctionsProxy.ENUMS.LIANZI,this._model,this._model.showLianZiRedTip)};e.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.LotusDataAck,this,this.onLotusDataAck);this.addMsgListener(app.ProtocolResponse.LotusCultivateAck,this,this.onLotusCultivateAck);this.addMsgListener(app.ProtocolResponse.LotusSeedUseAck,this,this.onLotusSeedUseAck)};e.prototype.onLotusDataAck=function(t,e){this._model.arrLianPengData=e.vecLotus;this._model.arrLianZiData=e.vecLotusSeed};e.prototype.onLotusCultivateAck=function(t,e){if(e.success==1){var i=this._model.arrLianPengData;for(var n=0;n<i.length;n++){if(i[n].type==e.vecItem[0].type){i[n]=e.vecItem[0];break}}this._model.showLianPengRedTip();this._model.event(o.LianPengLianZiEvent.EVENT.LAINPENG_CHANGE,e.lvUp)}};e.prototype.onLotusSeedUseAck=function(t,e){if(e.success==1){var i=this._model.arrLianZiData;if(i.length==0){i.push(e.vecLotusSeed[0])}else{var n=true;for(var a=0;a<i.length;a++){if(parseInt(i[a].id)==e.vecLotusSeed[0].id){i[a]=e.vecLotusSeed[0];n=false;break}}if(n){i.push(e.vecLotusSeed[0])}}this._model.event(o.LianPengLianZiEvent.EVENT.LAINZI_CHANGE)}};e.SINGLE_KEY="LianPengLianZiModule";return e}(app.ModuleBase);o.LianPengLianZiModule=t})(lianpenglianziCode||(lianpenglianziCode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var lianpenglianziCode;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.updateLayout)};e.prototype.onUnDisplay=function(){};e.prototype.updateLayout=function(){};e.prototype.setData=function(t){if(!t){return}var e=csv.LotusProxy.getIns().getJieCfg(t.type,t.lv);this.labelname.text=app.getLang(e.name);this.labeljieshu.text=app.getLang("lotus_1",e.level);if(i.LianPengLianZiModel.getIns().isShowLianPengRedByType(t.type)){game.RedDotView.addTo(this)}else{game.RedDotView.removeFrom(this)}};e.SINGLE_KEY="lianpenglianziCode.LianPengCell01";return e}(ui.lianpenglianzi.lianpengitem01UI);i.LianPengCell01=t})(lianpenglianziCode||(lianpenglianziCode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var lianpenglianziCode;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.txtNext.color=game.STYLES.GREEN_COLOR_S};e.prototype.onDisplay=function(){this.callLater(this.updateLayout)};e.prototype.onUnDisplay=function(){};e.prototype.updateLayout=function(){};e.prototype.setData=function(t){var e=t.curAttr;var i=t.nexAttr;var n=" +0";if(e){n=" +"+Attributes.getPropValue(e.propId,e.value,e.formula)}this.txtName.text=Attributes.getPropName(i.propId)+n;this.txtNext.text="+"+Attributes.getPropValue(i.propId,i.value,i.formula)};e.SINGLE_KEY="lianpenglianziCode.LianPengCell02";return e}(ui.lianpenglianzi.lianpenAtttItemUI);t.LianPengCell02=e})(lianpenglianziCode||(lianpenglianziCode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var lianpenglianziCode;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.itemdaoju.showBagCount(1);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.setSelect(false)};e.prototype.onDisplay=function(){this.callLater(this.updateLayout)};e.prototype.onUnDisplay=function(){};e.prototype.updateLayout=function(){};e.prototype.setData=function(t){this.itemData=t;this.imgxuanzhong.visible=false;this.refresh()};e.prototype.refresh=function(){if(this.itemData){var t=game.GridsModel.getIns().getItemCount(this.itemData.getItemId());if(t<this.itemData.count){this.itemdaoju.shuzi.color=game.STYLES.RED_COLOR_S}else{this.itemdaoju.shuzi.color=game.STYLES.GREEN_COLOR_S}this.itemdaoju.shuzi.text=t+"/"+this.itemData.count;this.itemdaoju.gezibg.skin=tip.TipManager.getQualityIcon(this.itemData.getQuality());this.itemdaoju.img.skin=this.itemData.getIconUrl()}};e.prototype.setSelect=function(t){this.imgxuanzhong.visible=t;this.itemdaoju.mouseEnabled=t};e.SINGLE_KEY="lianpenglianziCode.LianPengCell04";return e}(ui.lianpenglianzi.lianpengitem04UI);t.LianPengCell04=e})(lianpenglianziCode||(lianpenglianziCode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var lianpenglianziCode;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.updateLayout)};e.prototype.onUnDisplay=function(){};e.prototype.updateLayout=function(){};e.prototype.setData=function(t){if(!t){return}var e=t.attr.value*t.useCount;this.jinengname.text=Attributes.getPropName(t.attr.propId)+"+"+Attributes.getPropValue(t.attr.propId,e,t.attr.formula)+"(+"+t.attr.value+")"};e.SINGLE_KEY="lianpenglianziCode.LianPengCell05";return e}(ui.lianpenglianzi.lianpengitem05UI);t.LianPengCell05=e})(lianpenglianziCode||(lianpenglianziCode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var lianpenglianziCode;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){var e=t.curAttr;var i=t.nextAttr;var n=app.getLang("title_tips1")+Attributes.getPropName(i.propId);var a="+0";if(e){a="+"+Attributes.getPropValue(e.propId,e.value,e.formula)}this.txtvalue.text=n+"  "+a+"<span color='"+game.STYLES.GREEN_COLOR_S+"'>&nbsp;(+"+Attributes.getPropValue(i.propId,i.value,i.formula)+")</span>"};e.prototype.getWidth=function(){return this.txtvalue.width};e.SINGLE_KEY="lianpenglianziCode.LianPengCell06";return e}(game.ComAttrItem6);t.LianPengCell06=e})(lianpenglianziCode||(lianpenglianziCode={}));var lianpenglianziCode;(function(t){var e=function(){function t(){}t.EVENT={LAINPENG_CHANGE:"LAINPENG_CHANGE",LAINZI_CHANGE:"LAINZI_CHANGE"};return t}();t.LianPengLianZiEvent=e})(lianpenglianziCode||(lianpenglianziCode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var lianpenglianziCode;(function(o){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){this.arrLianPengData=[];this.arrLianZiData=[]};e.prototype.showLianPengRedTip=function(){if(this.isShowLianPengRed()){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.LIANPENG)}else{game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.LIANPENG)}};e.prototype.isShowLianPengRed=function(){for(var t=0;t<this.arrLianPengData.length;t++){if(!csv.LotusProxy.getIns().isMax(this.arrLianPengData[t].type,this.arrLianPengData[t].lv)){var e=csv.LotusProxy.getIns().getJieCfg(this.arrLianPengData[t].type,this.arrLianPengData[t].lv);var i=game.ItemUtil.parserList(e.costitem);for(var n=0;n<i.length;n++){var a=i[n];a.setCount(1);if(game.GridsModel.getIns().hasEnoughItems(a)){return true}}}}return false};e.prototype.isShowLianPengRedByType=function(t){for(var e=0;e<this.arrLianPengData.length;e++){if(this.arrLianPengData[e].type==t){if(!csv.LotusProxy.getIns().isMax(this.arrLianPengData[e].type,this.arrLianPengData[e].lv)){var i=csv.LotusProxy.getIns().getJieCfg(this.arrLianPengData[e].type,this.arrLianPengData[e].lv);var n=game.ItemUtil.parserList(i.costitem);for(var a=0;a<n.length;a++){var o=n[a];o.setCount(1);if(game.GridsModel.getIns().hasEnoughItems(o)){return true}}}}}return false};e.prototype.showLianZiRedTip=function(){if(this.showLianZiRed()){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.LIANZI)}else{game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.LIANZI)}};e.prototype.showLianZiRed=function(){var t=csv.LotusseedProxy.getIns().getCfgArr();for(var e=0;e<t.length;e++){var i=game.ItemUtil.createVO(t[e].id);i.setCount(1);if(this.hasUseTime(t[e])&&game.GridsModel.getIns().hasEnoughItems(i)){return true}}return false};e.prototype.hasUseTime=function(t){var e=this.getUseCountLimit(false,t);var i=o.LianPengLianZiModel.getIns().getUseCount(parseInt(t.id));var n=false;if(e==-1){var a=this.getMax(t);if(a-i>0){n=true}}else{if(e-i>0){n=true}}return n};e.prototype.getUseCountLimit=function(t,e){var i=-1;if(e){var n=0;for(var a in game.Context.roleList){if(game.Context.roleList[a].transf>n){n=game.Context.roleList[a].transf}}if(t){n+=1}var o=app.str2Array(e.limit,";","-");if(o[n]){i=parseInt(o[n][1])}}return i};e.prototype.getMax=function(t){if(t){var e=app.str2Array(t.limit,";","-");if(e&&e.length>0){return parseInt(e[e.length-1][1])}}return 0};e.prototype.getUseCount=function(t){var e=0;for(var i=0;i<this.arrLianZiData.length;i++){if(t==this.arrLianZiData[i].id){e=this.arrLianZiData[i].useCount;break}}return e};e.SINGLE_KEY="lianpenglianziCode.LianPengLianZiModel";return e}(app.ModelBase);o.LianPengLianZiModel=t})(lianpenglianziCode||(lianpenglianziCode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("lotus.csv");this.cfgMap=t.getMap("id");this.cfgJieMap=t.getMap("type","level")};e.prototype.getCfg=function(t){return this.cfgMap[t]};e.prototype.getJieCfg=function(t,e){var i=Object.keys(this.cfgJieMap[t]).length;if(e>=i)e=i-1;return this.cfgJieMap[t][e]};e.prototype.isMax=function(t,e){var i=Object.keys(this.cfgJieMap[t]).length-1;return e>=i};e.SINGLE_KEY="csv.LotusProxy";return e}(app.ModelBase);t.LotusProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("lotusseed.csv");this.cfgMap=t.getMap("id");this._cfgArr=t.getArray()};e.prototype.getCfg=function(t){return this.cfgMap[t]};e.prototype.getCfgArr=function(){return this._cfgArr};e.SINGLE_KEY="csv.LotusseedProxy";return e}(app.ModelBase);t.LotusseedProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("lotusskill.csv");this.cfgMapArr=t.getMapList("type")};e.prototype.getCfgSkill=function(t,e){var i=this.cfgMapArr[t];var n=parseInt(i[i.length-1].level);if(e>n){e=n}for(var a=0;a<i.length;a++){if(e==parseInt(i[a].level)){return i[a]}else{var o=parseInt(i[a].level);var s=parseInt(i[a+1].level);if(e>o&&e<s){return i[a]}}}};e.prototype.getSkillLevel=function(t,e){var i=[];var n=this.getCfgSkill(t,e);var a=n.skillid.split(";");var o=this.cfgMapArr[t];for(var s=0;s<a.length;s++){var r=true;for(var l=0;l<o.length;l++){var h=o[l].skillid.split(";");if(parseInt(h[s].split("-")[0])==parseInt(a[s].split("-")[0])){if(parseInt(h[s].split("-")[1])>parseInt(a[s].split("-")[1])){var p={};p.jie=o[l].level;p.lv=h[s].split("-")[1];p.skillid=h[s].split("-")[0];i.push(p);r=false;break}}}if(r){i.push(null)}}return i};e.prototype.getNextSkillLevel=function(t,e){var i=this.getCfgSkill(t,e);var n=this.cfgMapArr[t];var a;for(var o=0;o<n.length;o++){if(parseInt(i.id)==parseInt(n[o].id)){if(!n[o+1]){return null}else{a=n[o+1];break}}}var s=i.skillid.split(";");var r=a.skillid.split(";");var l={};for(var h=0;h<s.length;h++){if(parseInt(s[h].split("-")[0])==parseInt(r[h].split("-")[0])){if(parseInt(s[h].split("-")[1])<parseInt(r[h].split("-")[1])){l.jie=a.level;l.lv=r[h].split("-")[1];l.skillid=r[h].split("-")[0];break}}}return l};e.SINGLE_KEY="csv.LotusskillProxy";return e}(app.ModelBase);t.LotusskillProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var lianpenglianziCode;(function(d){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t._mouseDown=false;t.intervalTime=0;t._timeOut=-1;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.lianpenglist.itemRender=d.LianPengCell01;this.lianpenglist.renderHandler=new Laya.Handler(this,this.onLianPengHandler);this.lianpenglist.selectHandler=new Laya.Handler(this,this.onLianPengSelectHandler);this.lianpenglist.selectEnable=true;this.materials=[];this.materials.push(this.item0,this.item1,this.item2);for(var t=0;t<this.materials.length;t++){this.materials[t].on(Laya.Event.CLICK,this,this.onMaterialClick,[this.materials[t]])}this.btnjinglian.on(Laya.Event.MOUSE_DOWN,this,this.onMouseDown);this.btnjinglian.on(Laya.Event.MOUSE_UP,this,this.onMouseUp);this.btnjinglian.on(Laya.Event.MOUSE_OUT,this,this.onMouseOut);this.listshengjiyulan.itemRender=d.LianPengCell02;this.listshengjiyulan.renderHandler=new Laya.Handler(this,this.onRenderHandler);this.listshengjiyulan.scrollRectOffX=10;this.listshengjiyulan.scrollRectOffY=10;this.listshengjiyulan.vScrollBarSkin=" ";this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.itemSkillViews=[this.itemjineng01,this.itemjineng02,this.itemjineng03,this.itemjineng04];for(var t=0;t<4;t++){this.itemSkillViews[t].on(Laya.Event.CLICK,this,this.onShowSkill,[this.itemSkillViews[t]])}this.imgyimanji.visible=false;this.stopAll()};t.prototype.onShowSkill=function(t){tip.TipManager.showSkill(t.itemjineng.getData())};t.prototype.onRenderHandler=function(t){t.setData(t.dataSource)};t.prototype.onDisplay=function(){this.callLater(this.updateLayout);d.LianPengLianZiModel.getIns().on(d.LianPengLianZiEvent.EVENT.LAINPENG_CHANGE,this,this.onLianPengChange);game.GridsModel.getIns().on(game.GridsModel.EVENTS.UPDATE,this,this.onRedDotChange)};t.prototype.onUnDisplay=function(){d.LianPengLianZiModel.getIns().off(d.LianPengLianZiEvent.EVENT.LAINPENG_CHANGE,this,this.onLianPengChange);game.GridsModel.getIns().off(game.GridsModel.EVENTS.UPDATE,this,this.onRedDotChange);this.lianpenglist.selectedIndex=-1;this._mouseDown=false;this.clean();this.stopAll()};t.prototype.onMaterialClick=function(t){var e=this.materials.indexOf(t);if(this._materidlIndex==e){tip.TipManager.show(t.itemData)}else{for(var i=0;i<this.materials.length;i++){this.materials[i].setSelect(false)}t.setSelect(true);this._materidlIndex=e}this.onRedDotChange(false)};t.prototype.onRedDotChange=function(t){if(t===void 0){t=true}if(this._materidlIndex>=0){var e=this.materials[this._materidlIndex];if(t){e.refresh()}var i=game.GridsModel.getIns().getItemCount(e.itemData.getItemId());var n=d.LianPengLianZiModel.getIns().arrLianPengData[this.lianpenglist.selectedIndex];var a=i>=e.itemData.count&&!csv.LotusProxy.getIns().isMax(n.type,n.lv);this.showBtnRedDot(a)}};t.prototype.onLianPengChange=function(){this.callLater(this.showView);this.lianpenglist.refresh();this.count++;if(this.isPlay==false){this.onPlayAni()}if(this._mouseDown){this.onBtnjinglianClick()}};t.prototype.onPlayAni=function(){var t=d.LianPengLianZiModel.getIns().arrLianPengData[this.lianpenglist.selectedIndex];if(t&&this.lastdata&&t.lv>this.lastdata.lv){var e=csv.LotusskillProxy.getIns().getCfgSkill(t.type,t.lv);var i=-1;if(e.level==t.lv){for(var n=3;n>=0;n--){var a=csv.SkillProxy.getIns().getSkillByKey(e.skillid.split(";")[n]);if(a&&a.level>0){i=n;break}}if(i>=0){if(this.count>0){var o=this.itemSkillViews[i];this.isPlay=true;o.animationsshengjie.on(Laya.Event.COMPLETE,this,this.onAniComplete,[o]);o.animationsshengjie.visible=true;o.animationsshengjie.play(0,false)}}}}};t.prototype.onAniComplete=function(t){this.count--;this.isPlay=false;t.animationsshengjie.off(Laya.Event.COMPLETE,this,this.onAniComplete);t.animationsshengjie.visible=false;t.animationsshengjie.stop();this.onPlayAni()};t.prototype.stopAll=function(){for(var t=3;t>=0;t--){var e=this.itemSkillViews[t];e.animationsshengjie.visible=false;e.animationsshengjie.stop()}this.count=0;this.isPlay=false};t.prototype.onBtnjinglianClick=function(){var t=d.LianPengLianZiModel.getIns().arrLianPengData[this.lianpenglist.selectedIndex];if(!t){return}if(csv.LotusProxy.getIns().isMax(t.type,t.lv)){manager.FlowManager.instance.flowByStyle1(app.getLang("lotus_8"));return}if(this._materidlIndex>=0){var e=this.materials[this._materidlIndex].itemData;if(e){if(game.GridsModel.getIns().hasEnoughItems(e,false,true)){this.lastdata=t;app.ProtocolRequest.LotusCultivateReq(t.type,parseInt(e.itemCfg.id))}}}};t.prototype.clean=function(){if(this._timeOut>=0){clearTimeout(this._timeOut);this._timeOut=-1}};t.prototype.onMouseDown=function(){var t=this;this._mouseDown=true;this.intervalTime=(new Date).getTime();this._timeOut=setTimeout(function(){t.clean();t.onBtnjinglianClick()},1e3)};t.prototype.onMouseOut=function(){this.clean();this._mouseDown=false};t.prototype.onMouseUp=function(){this._mouseDown=false;this.clean();if((new Date).getTime()-this.intervalTime<800){this.onBtnjinglianClick()}};t.prototype.onLianPengHandler=function(t,e){if(e==this.lianpenglist.selectedIndex){t.btnlianpeng.selected=true}else{t.btnlianpeng.selected=false}t.setData(t.dataSource)};t.prototype.onLianPengSelectHandler=function(){if(this.lianpenglist.selectedIndex==-1){return}this._mouseDown=false;this.showView();var t=d.LianPengLianZiModel.getIns().arrLianPengData[this.lianpenglist.selectedIndex];var e=csv.LotusProxy.getIns().getJieCfg(t.type,t.lv);var i=game.ItemUtil.parserList(e.costitem);this._materidlIndex=0;for(var n=0;n<i.length;n++){this.onItemRender(this.materials[n],i[n]);if(game.GridsModel.getIns().hasEnoughItems(i[n],false,false)){this._materidlIndex=n}}this.materials[this._materidlIndex].setSelect(true);this.onRedDotChange(false)};t.prototype.showView=function(){if(this.lianpenglist.selectedIndex==-1){return}var t=d.LianPengLianZiModel.getIns().arrLianPengData[this.lianpenglist.selectedIndex];var e=csv.LotusProxy.getIns().getJieCfg(t.type,t.lv);var i=csv.LotusProxy.getIns().getJieCfg(t.type,t.lv+1);var n=Attributes.decode(e.attr);var a=Attributes.decode(i.attr);this.imglianpeng.skin="res/static/lianpenglianzi/"+e.horseres+".png";this.imgname.skin="lianpenglianzi/"+e.nameres+".png";this.imgyimanji.visible=false;this.btnjinglian.visible=true;if(e.id==i.id){this.labeljingyannum.text="";this.barjingyan.value=1;this.imgyimanji.visible=true;this.btnjinglian.visible=false}else{this.labeljingyannum.text=t.exp.toNumber()+"/"+e.cost;this.barjingyan.value=t.exp.toNumber()/parseInt(e.cost)}var o=[];for(var s=0;s<a.baseList.length;s++){var r={};if(n.baseList&&n.baseList.length>0){Attributes.getPropValue(n.baseList[s].propId,n.baseList[s].value,n.baseList[s].formula);r.curAttr=n.baseList[s]}r.nexAttr=a.baseList[s];r.showArrow=!(e.id==i.id);o.push(r)}this.listshengjiyulan.array=o;var l=csv.LotusskillProxy.getIns().getCfgSkill(t.type,t.lv);var h=csv.LotusskillProxy.getIns().getSkillLevel(t.type,t.lv);for(var s=0;s<4;s++){var p=this.itemSkillViews[s];p.imgxuanzhong.visible=false;var u=csv.SkillProxy.getIns().getSkillByKey(l.skillid.split(";")[s],true);csv.SkillProxy.getIns().setSkillInfo(p.itemjineng,u,false);var c=new SkillData;c.id=parseInt(u.skillid);c.lv=parseInt(u.level);p.itemjineng.setData(c);p.itemjineng.img.gray=false;if(h[s]==null){p.labeljineng.text=app.getLang("lotus_8")}else{if(parseInt(h[s].lv)==1){p.labeljineng.text=app.getLang("lotus_4",h[s].jie);p.itemjineng.img.gray=true}else{p.labeljineng.text=app.getLang("lotus_5",h[s].jie,h[s].lv)}}}var g=csv.LotusskillProxy.getIns().getNextSkillLevel(t.type,t.lv);if(!g){this.labelshengjie.text=""}else{var f=csv.SkillProxy.getIns().getCfg(g.skillid,g.lv);if(parseInt(g.lv)==1){this.labelshengjie.text=app.getLang("lotus_6",g.jie,f.name)}else{this.labelshengjie.text=app.getLang("lotus_7",g.jie,f.name,g.lv)}}if(t.lv==0&&Uint64.equal(Uint64.fromNumber(0),t.exp)){this.btnjinglian.label=app.getLang("lotus_2")}else{this.btnjinglian.label=app.getLang("lotus_3")}};t.prototype.showBtnRedDot=function(t){if(t){game.RedDotView.addTo(this.btnjinglian)}else{game.RedDotView.removeFrom(this.btnjinglian)}};t.prototype.onItemRender=function(t,e){e.setCount(1);t.setData(e)};t.prototype.updateLayout=function(){var t=d.LianPengLianZiModel.getIns().arrLianPengData;this.lianpenglist.array=t;var e=0;for(var i=0;i<t.length;i++){if(d.LianPengLianZiModel.getIns().isShowLianPengRedByType(t[i].type)){e=i;break}}this.lianpenglist.selectedIndex=e};t.SINGLE_KEY="lianpenglianziCode.LianPengView";return t}(ui.lianpenglianzi.lianpengviewUI);d.LianPengView=t})(lianpenglianziCode||(lianpenglianziCode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var lianpenglianziCode;(function(d){var i=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.CLICK,this,this.onClick);this.itemdaoju.locktip=true};e.prototype.setData=function(t,e){this.index=e;this.itemId=t.id;var i=game.ItemUtil.parserList(t.id)[0];this.itemData=i;this.itemdaoju.setData(i);game.RedDotView.removeFrom(this);if(this.itemData){var n=game.GridsModel.getIns().getItemCount(this.itemData.getItemId());if(n<this.itemData.count){this.itemdaoju.shuzi.color=game.STYLES.RED_COLOR_S}else{this.itemdaoju.shuzi.color=game.STYLES.GREEN_COLOR_S}this.itemdaoju.shuzi.text=n+"/"+this.itemData.count;this.itemdaoju.gezibg.skin=tip.TipManager.getQualityIcon(this.itemData.getQuality());this.itemdaoju.img.skin=this.itemData.getIconUrl()}if(d.LianPengLianZiModel.getIns().hasUseTime(t)&&game.GridsModel.getIns().hasEnoughItems(i)){game.RedDotView.addTo(this)}};e.prototype.onClick=function(){n.getIns().onCellClick(this.itemId,this.index)};return e}(ui.lianpenglianzi.lianpengitem04UI);d.LianPengItem=i;var n=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.maxWidth=0;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.listdaoju.scrollRectOffY=10;this.listdaoju.hScrollBarSkin=" ";this.listdaoju.itemRender=i;this.listdaoju.renderHandler=new Laya.Handler(this,this.onListRendler);this.listshuxing.itemRender=d.LianPengCell06;this.listshuxing.renderHandler=new Laya.Handler(this,this.onListShuXingRendler);this.itemdaoju.mouseEnabled=false;this.btnshiyong.clickHandler=new Laya.Handler(this,this.onBtnshiyongClick);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};t.prototype.onDisplay=function(){this.callLater(this.updateLayout);d.LianPengLianZiModel.getIns().on(d.LianPengLianZiEvent.EVENT.LAINZI_CHANGE,this,this.LianZiChange);game.GridsModel.getIns().on(game.GridsModel.EVENTS.UPDATE,this,this.onRedDotChange)};t.prototype.onUnDisplay=function(){this.listdaoju.selectedIndex=-1;d.LianPengLianZiModel.getIns().off(d.LianPengLianZiEvent.EVENT.LAINZI_CHANGE,this,this.LianZiChange);game.GridsModel.getIns().off(game.GridsModel.EVENTS.UPDATE,this,this.onRedDotChange)};t.prototype.onRedDotChange=function(){this.listdaoju.refresh();d.LianPengLianZiModel.getIns().showLianZiRedTip();this.onListSelect()};t.prototype.LianZiChange=function(){this.callLater(this.onListSelect)};t.prototype.onBtnshiyongClick=function(){if(this.listdaoju.selectedItem){if(d.LianPengLianZiModel.getIns().hasUseTime(this.listdaoju.selectedItem)){app.ProtocolRequest.LotusSeedUseReq(parseInt(this.listdaoju.selectedItem.id))}else{manager.FlowManager.instance.flowByStyle1(app.getLang("没有使用次数"))}}};t.prototype.onListShuXingRendler=function(t,e){t.setData(t.dataSource);var i=t.getWidth();if(i>this.maxWidth){this.maxWidth=i}};t.prototype.onListRendler=function(t,e){if(this.listdaoju.selectedIndex==e){t.imgxuanzhong.visible=true}else{t.imgxuanzhong.visible=false}t.setData(t.dataSource,e)};t.prototype.onCellClick=function(t,e){if(this.listdaoju.selectedIndex==e){tip.TipManager.show(game.ItemUtil.createVO(t))}this.listdaoju.selectedIndex=e;this.onListSelect()};t.prototype.onListSelect=function(){var t=this.listdaoju.selectedItem;if(t){var e=game.ItemUtil.parserList(t.id)[0];this.labelname.text=e.getName();this.itemdaoju.setData(e);var i=d.LianPengLianZiModel.getIns().getUseCount(parseInt(t.id));var n=Attributes.decode(t.attr);var a=[];var o=void 0;for(o=0;o<n.baseList.length;o++){var s={};var r=new PropValue;r.propId=n.baseList[o].propId;r.value=n.baseList[o].value*i;r.formula=n.baseList[o].formula;s.curAttr=r;s.nextAttr=n.baseList[o];a.push(s)}this.listshuxing.array=a;var l=d.LianPengLianZiModel.getIns().getUseCountLimit(false,this.listdaoju.selectedItem);var h=d.LianPengLianZiModel.getIns().getUseCountLimit(true,this.listdaoju.selectedItem);var p=false;var u=game.STYLES.RED_COLOR_S;if(l==-1){var c=d.LianPengLianZiModel.getIns().getMax(this.listdaoju.selectedItem);if(c-i>0){u=game.STYLES.GREEN_COLOR_S;p=true}this.labeldaoju01.text=app.getLang("lotus_9",u,i,c)}else{if(l-i>0){u=game.STYLES.GREEN_COLOR_S;p=true}this.labeldaoju01.text=app.getLang("lotus_9",u,i,l)}game.RedDotView.removeFrom(this.btnshiyong);if(p&&game.GridsModel.getIns().hasEnoughItems(e)){game.RedDotView.addTo(this.btnshiyong)}var g=0;for(var f in game.Context.roleList){if(game.Context.roleList[f].transf>g){g=game.Context.roleList[f].transf}}if(csv.ReBirthProxy.getIns().isMax(g)||h<0){this.labeldaoju02.visible=false;this.imgtouxian.visible=false;this.labeldaoju03.visible=false}else{this.labeldaoju03.text=app.getLang("lotus_10",h);this.imgtouxian.skin=csv.ReBirthProxy.getIns().getTransIcon(g+1);this.labeldaoju02.visible=true;this.imgtouxian.visible=true;this.labeldaoju03.visible=true}}};t.prototype.getIndex=function(t,e){var i=0;for(var n=t.length-1;n>=0;n--){if(e>=parseInt(t[n].split("-")[0])){e=parseInt(t[n].split("-")[0]);i=n}}return i};t.prototype.updateLayout=function(){var t=csv.LotusseedProxy.getIns().getCfgArr();var e=0;for(var i=0;i<t.length;i++){if(game.GridsModel.getIns().getItemCount(parseInt(t[i].id))>0){e=i;break}}this.listdaoju.array=t;this.listdaoju.selectedIndex=e;this.listdaoju.scrollTo(e);this.onListSelect()};t.SINGLE_KEY="lianpenglianziCode.LianZiView";return t}(ui.lianpenglianzi.lianziviewUI);d.LianZiView=n})(lianpenglianziCode||(lianpenglianziCode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var achievement;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){app.ViewManager.regist(i.AchievementView,"lilian.atlas");app.ViewManager.regist(i.AchievementAwardView,"lilian.atlas");game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.LILIAN,i.AchievementView);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.LILIAN_POINTS,i.AchievementAwardView)};e.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.AchieveInfNtf,this,this.onAchieveInfNtf);this.addMsgListener(app.ProtocolResponse.AwardAchieveAck,this,this.onAwardAchieveAck)};e.prototype.onAchieveInfNtf=function(t,e){i.AchievementModel.getIns().onAchieveInfNtf(e)};e.prototype.onAwardAchieveAck=function(t,e){if(e.result==1){game.TaskModel.getIns().event(game.TaskModel.EVENTS.TASK_LIAN_REFRESH)}};e.SINGLE_KEY="achievement.AchievementModule";return e}(app.ModuleBase);i.AchievementModule=t})(achievement||(achievement={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var achievement;(function(i){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.spoint=0;t.stage=0;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.init=function(){};t.prototype.onAchieveInfNtf=function(t){this.spoint=t.spoint;this.stage=t.stage;this.event(i.AchievementView.UPDATE_ACHIEVE_INFO)};t.prototype.canGet=function(){var t=csv.AchievementProxy.getIns().getList().length;if(this.stage<t){var e=csv.AchievementProxy.getIns().getCfg(this.stage+1);if(this.spoint/e.points>=1)return true}return false};t.SINGLE_KEY="achievement.AchievementModel";return t}(app.ModelBase);i.AchievementModel=t})(achievement||(achievement={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("achievement.csv");this.cfgMap=t.getMap("stage");this.array=t.getArray()};e.prototype.getCfg=function(t){return this.cfgMap[t]};e.prototype.getAchievementByPoint=function(t){var e;for(var i in this.array){if(t<parseInt(this.array[i].points)){e=this.array[i];break}}return e};e.prototype.getTotalPoints=function(t){var e=this.getAchievementByPoint(t).stage;var i=0;for(var n=1;n<=e;n++){i+=this.getCfg(n).points}return i};e.prototype.getList=function(){return this.array};e.SINGLE_KEY="csv.AchievementProxy";return e}(app.ModelBase);t.AchievementProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var achievement;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t,e){this.txtPoint.text=t.points;this.txtName.text=app.getLang(t.name);this.yijiesuoimg.visible=e};e.SINGLE_KEY="achievement.AchieveAwardItem";return e}(ui.lilian.lilianjiangliitemUI);t.AchieveAwardItem=e})(achievement||(achievement={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var achievement;(function(n){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.list.itemRender=n.AchieveAwardItem;this.list.renderHandler=new Laya.Handler(this,this.onItemRender);this.list.vScrollBarSkin=" ";this.list.scrollBar.touchScrollEnable=true;this.list.scrollBar.elasticDistance=100;this.list.scrollBar.elasticBackTime=100};e.prototype.onItemRender=function(t,e){var i=n.AchievementModel.getIns().stage;t.setData(t.dataSource,i>e)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){var t=n.AchievementModel.getIns().spoint;this.list.array=csv.AchievementProxy.getIns().getList();this.txtPoint.text=t+""};e.SINGLE_KEY="achievement.AchievementAwardView";return e}(ui.lilian.lilianjiangviewUI);n.AchievementAwardView=t})(achievement||(achievement={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var achievement;(function(t){var e=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t._funId=0;t._nextId=0;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.btnGoto.on(Laya.Event.CLICK,this,this.callFunction);this.btnSubmit.clickHandler=new Laya.Handler(this,this.onSubmit)};t.prototype.onSubmit=function(){if(this.isPlaying||!util.TimeUtil.checkIntervalTime(true)){return}var t=game.TaskModel.getIns().getTaskData(this._questIndex);if(t){if(t.data.questSate==2){app.ProtocolRequest.TaskSubmit(this._questIndex)}else{manager.FlowManager.instance.flowByStyle1(app.getLang("questSate is "+t.data.questSate))}}else{manager.FlowManager.instance.flowByStyle1(app.getLang("questIndex {0} no find",this._questIndex))}};t.prototype.callFunction=function(t){t.stopPropagation();if(this.task){app.ViewManager.toggleDialog(common.CommonWindow,-1,0);task.TaskManager.doTask(this.task)}};t.prototype.onDisplay=function(){this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){};t.prototype.refreshAll=function(){};t.prototype.getQuestIndex=function(){return this._questIndex};t.prototype.getQuestNextIndex=function(){return this._nextId};t.prototype.setData=function(t,e){this._questIndex=t;this._funId=e.client_params;this.txtName.text=app.getLang(e.name);this._nextId=parseInt(e.next_id);var i=parseInt(e.sign);if(i==1){this.imgFlag.skin="lilian/bg_jiaobiao_bianqiang.png"}else if(i==3){this.imgFlag.skin="lilian/bg_jiaobiao_richang.png"}else if(i==2){this.imgFlag.skin="lilian/bg_jiaobiao_tuijian.png"}this.imgFlag.visible=i>0;var n=game.ItemUtil.parserList(e.item);var a=n[0].count;this.txtPoint.value=a+"";this.txtState.text=n[1]?app.getLang("garden_tips_6",n[1].getName(),game.MoneyModel.format(n[1].count)):"";this.imgBg.skin="lilian/bg_lilian_yuan_1.png";if(a>=10){this.imgBg.skin="lilian/bg_lilian_yuan_2.png"}var o=csv.TaskProxy.getIns().getShowOneSubType().indexOf(e.subtype+"")>=0;var s=game.TaskModel.getIns().getTaskData(t);this.setBySubType(this.getTotal(o,e.param),s?s.data.questSate:0,s?s.getNum():0);this.task=s;if(s&&s.data.questSate==2){this.btnGoto.visible=false;this.btnSubmit.visible=true;this.aniuguang.play(0,true);this.aniuguang.visible=true}else{this.btnGoto.visible=false;if(this._funId&&this._funId>0){this.btnGoto.visible=true}this.btnSubmit.visible=false;this.aniuguang.stop();this.aniuguang.visible=false}};t.prototype.getTotal=function(t,e){var i=1;if(!t){var n=app.str2Array(e,"-");if(n.length==1){i=parseInt(n[0])}else{i=parseInt(n[1])}}return i};t.prototype.setBySubType=function(t,e,i){if(t==1){if(e==2||e==3)i=1;else i=0}this.txtProgress.text=i+"/"+t;this.progressbar.value=i/t};t.prototype.clean=function(){this._questIndex=0;this.isPlaying=false};t.SINGLE_KEY="achievement.AchievementItem";return t}(ui.lilian.lilianitemUI);t.AchievementItem=e})(achievement||(achievement={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var achievement;(function(r){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.itemList=[];this.imgAward.on(Laya.Event.CLICK,this,this.getAward);this.guangxiao1.stop();this.guangxiao1.visible=false;this.guangxiao2.stop();this.guangxiao2.visible=false;this.guangxiao2.interval=2e3/16;this.guangxiao2.on(Laya.Event.COMPLETE,this,this.onAniEnd)};e.prototype.onAniEnd=function(){this.guangxiao2.visible=false;this.guangxiao2.stop()};e.prototype.getAward=function(){var t=r.AchievementModel.getIns().stage;var e=csv.AchievementProxy.getIns().getCfg(t+1);var i=e?e.role:0;if(i>0){game.RoleModel.getIns().onShowRoleUnlockView()}else{var n=r.AchievementModel.getIns().canGet();if(n){app.ProtocolRequest.AwardAchieveReq()}else{if(this.jindutiao.value<1){manager.FlowManager.instance.flowByStyle1(app.getLang("历练点不足"))}}}};e.prototype.cleanItems=function(){while(this.itemList.length>0){var t=this.itemList.pop();if(t){t.clean();t.removeSelf();Laya.Pool.recover("achievement.AchievementItem",t)}}};e.prototype.updateItem=function(t){if(t&&t.length>0){var e=void 0;var i=0;for(var n=0;n<t.length;n++){e=Laya.Pool.getItemByClass("achievement.AchievementItem",r.AchievementItem);e.setData(t[n].data.questIndex,t[n].cfg);e.x=0;e.y=i;i+=e.height+tip.TipManager.GAPS.GAP_ARROW;this.addItem(e)}}};e.prototype.addItem=function(t){this.list.addChild(t);this.itemList.push(t)};e.prototype.onDisplay=function(){r.AchievementModel.getIns().on(e.UPDATE_ACHIEVE_INFO,this,this.updateAchievementInfo);this.callLater(this.refreshAll);this.list.vScrollBar.value=0};e.prototype.onUnDisplay=function(){r.AchievementModel.getIns().off(e.UPDATE_ACHIEVE_INFO,this,this.updateAchievementInfo);this.guangxiao2.visible=false;this.guangxiao2.stop()};e.prototype.onTaskRefresh=function(t){if(t>0){var e=void 0;for(var i in this.itemList){if(t==this.itemList[i].getQuestIndex()){e=this.itemList[i];break}}if(e){this.playPointAni(e.txtPoint.value,e.imgBg.skin,this.list.x+e.x+e.imgBg.x,this.list.y+e.y+e.imgBg.y);this.playAni(e)}else{this.updateTasksInfo()}}};e.prototype.playPointAni=function(t,e,i,n){var a=Laya.Pool.getItemByClass("achievement.FlyIconItem",r.FlyIconItem);a.scaleX=1;a.scaleY=1;var o=this.jindutiao.x+this.jindutiao.width*.5;var s=this.jindutiao.y;a.setData(t,e);a.x=i;a.y=n;this.addChild(a);Laya.Tween.to(a,{x:o,y:s,scaleX:.3,scaleY:.3},1e3,Laya.Ease.quartOut,new Laya.Handler(this,this.onFlyEnd,[a]))};e.prototype.onFlyEnd=function(t){t.removeSelf();Laya.Tween.clearAll(t);Laya.Pool.recover("achievement.FlyIconItem",t)};e.prototype.updateTasksInfo=function(){this.cleanItems();var t=game.TaskModel.getIns().getLilianTask();this.updateItem(t)};e.prototype.updateAchievementInfo=function(){var t=r.AchievementModel.getIns().spoint;var e=r.AchievementModel.getIns().stage;var i=csv.AchievementProxy.getIns().getList().length;this.txtPoint.text=app.getLang("{0}/{1}",t,t);this.jindutiao.value=1;if(e<i){var n=csv.AchievementProxy.getIns().getCfg(e+1);this.txtPoint.text=app.getLang("{0}/{1}",t,n.points);this.txtAward.text=app.getLang(n.name);this.jindutiao.value=t/n.points;this.lingwanimg.visible=false;if(n.rewards&&n.rewards.length>0){var a=game.ItemUtil.parserList(n.rewards)[0];this.imgAward.skin=a.getIconUrl()}else{this.imgAward.skin="lilian/bg_+2.png"}}else{var n=csv.AchievementProxy.getIns().getCfg(i);this.txtAward.text=app.getLang(n.name);this.lingwanimg.visible=true}if(r.AchievementModel.getIns().canGet()){this.guangxiao1.play(0,true);this.guangxiao1.visible=true}else{this.guangxiao1.stop();this.guangxiao1.visible=false}};e.prototype.refreshAll=function(){this.updateTasksInfo();this.updateAchievementInfo()};e.prototype.playAni=function(t){var e=t.x;var i=t.y;var n=true;var a=t.getQuestNextIndex();if(a>0){var o=Laya.Pool.getItemByClass("achievement.AchievementItem",r.AchievementItem);o.x=e+o.width;o.y=i;o.setData(a,csv.TaskProxy.getIns().getCfg(a));this.addItem(o);n=false;t.isPlaying=true;o.isPlaying=true;Laya.Tween.to(t,{x:e-t.width},300,Laya.Ease.quartOut,new Laya.Handler(this,this.onComplete,[t,n]));Laya.Tween.to(o,{x:e},300,Laya.Ease.quartOut,new Laya.Handler(this,this.onComplete2,[o]))}else{Laya.Tween.to(t,{x:e-t.width},300,Laya.Ease.quartOut,new Laya.Handler(this,this.onComplete,[t,n]))}};e.prototype.onComplete2=function(t){Laya.Tween.clearAll(t);t.isPlaying=false};e.prototype.onComplete=function(t,e){t.removeSelf();t.clean();Laya.Tween.clearAll(t);Laya.Pool.recover("achievement.AchievementItem",t);if(e){this.updateTasksInfo()}};e.prototype.onAwardAchieveAck=function(t){this.guangxiao2.play(0,false);this.guangxiao2.visible=true;this.onTaskRefresh(t)};e.SINGLE_KEY="achievement.AchievementView";e.UPDATE_ACHIEVE_INFO="UPDATE_ACHIEVE_INFO";return e}(ui.lilian.lilianviewUI);r.AchievementView=t})(achievement||(achievement={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var achievement;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t,e){this.txtPoint.value=t;this.bg_dikuang.skin=e};e.SINGLE_KEY="achievement.FlyIconItem";return e}(ui.lilian.lilianitem01UI);t.FlyIconItem=e})(achievement||(achievement={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var limitgiftbag;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){app.ViewManager.regist(i.LimitGiftBagView,"shangcheng.atlas");game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.QI_RI_XIAN_SHI_SHOP,i.LimitGiftBagView)};e.prototype.initCommands=function(){};return e}(app.ModuleBase);i.LimitGiftBagModule=t})(limitgiftbag||(limitgiftbag={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var limitgiftbag;(function(t){var e=function(){function t(){}t.ONLINE_ACT_REFRESH="ONLINE_ACT_REFRESH";t.ONLINE_ACT_CHANGE="ONLINE_ACT_CHANGE";t.ONLINE_ACT_ICON_TIME="ONLINE_ACT_ICON_TIME";return t}();t.JinJieRiEvent=e;var i;(function(t){t[t["DENG_JI_AWARD"]=1]="DENG_JI_AWARD";t[t["ZAI_XIAN_AWARD"]=2]="ZAI_XIAN_AWARD"})(i=t.JinJieRi_Client_Type||(t.JinJieRi_Client_Type={}));var n=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t._lock=false;return t}Object.defineProperty(t.prototype,"lock",{get:function(){return this._lock},set:function(t){this._lock=t},enumerable:true,configurable:true});t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.init=function(){};t.prototype.getTabActData=function(){var t=[];var e=this.actVo.cfgList;for(var i=0;i<e.length;i++){t.push({id:e[i].id,skin:e[i].cp3,index:i})}return t};t.prototype.actIsOpen=function(t){var e=this.actVo.info.prize;for(var i=0;i<e.length;i++){if(t==e[i].listID){return true}}return false};t.prototype.getSelNowActIndex=function(){var t=this.actVo.info.prize;for(var e=0;e<t.length;e++){if(t[e].status==0){return e}}return t.length-1};t.prototype.getCellActData=function(t){var e=this.actVo.cfgList;for(var i=0;i<e.length;i++){if(t==e[i].id){return e[i]}}return null};t.prototype.getCellActInfoVo=function(t){var e=this.actVo.info.prize;for(var i=0;i<e.length;i++){if(t==e[i].listID){return e[i]}}return null};t.SINGLE_KEY="limitgiftbag.LimitGiftBagModel";return t}(app.ModelBase);t.LimitGiftBagModel=n})(limitgiftbag||(limitgiftbag={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var limitgiftbag;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=i.LimitGiftBagModel.getIns()};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t,e,i){this._id=t.id;this._index=e;this.clipdaoshu.value=util.TimeUtil.getChineseNum(e+1);this.wa.skin="res/static/xiangoulihe/"+t.skin+".png";this.gray=!this._model.actIsOpen(this._id);if(e==i){this.imgxuanzhong.visible=true}else{this.imgxuanzhong.visible=false}};e.SINGLE_KEY="limitgiftbag.LimitGiftBagTabItem";return e}(ui.shangcheng.xiangouliheitemUI);i.LimitGiftBagTabItem=t})(limitgiftbag||(limitgiftbag={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var limitgiftbag;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=i.LimitGiftBagModel.getIns();this.listwa.selectEnable=true;this.listwa.itemRender=i.LimitGiftBagTabItem;this.listwa.renderHandler=new Laya.Handler(this,this._onTabHandler);this.listwa.selectHandler=new Laya.Handler(this,this._onSelectHandler);this.laitjiangli.itemRender=grids.GridView;this.laitjiangli.renderHandler=new Laya.Handler(this,this._onCellHandler);this.imghuobi.on(Laya.Event.CLICK,this,this._onTipShow,[game.MoneyModel.MONEY_ENUM.GOLD]);this.labelshuzi.on(Laya.Event.CLICK,this,this._onTipShow,[game.MoneyModel.MONEY_ENUM.GOLD]);this.btnaniu.clickHandler=new Laya.Handler(this,this._buyClickHandler);this.activityTimeView=new activitytaren.ActivityTimeView(this.labeldaojishi2,new Laya.Handler(this,this.endTimeCallBack),"剩余时间：{0}");this.activityTimeView2=new activitytaren.ActivityTimeView(this.labeldaojishi,new Laya.Handler(this,this.endTimeCallBack2),"下次礼包开启时间：{0}");game.HelperViewHandler.register(csv.FunctionsProxy.ENUMS.QI_RI_XIAN_SHI_SHOP,[this.btnwenhao]);this.labelshuzhi.align="center"};e.prototype.onDisplay=function(){this.callLater(this._onGetInfo);activitytaren.ActivityTaRenModel.getIns().on(activitytaren.ActivityTaRenModel.ACTIVIT_TAREN_EVENT.UPDATE_ACTIVIT_DATA,this,this._updateAckView)};e.prototype._onGetInfo=function(){this._model.actVo=this.actVo;this.refreshAll()};e.prototype.onUnDisplay=function(){activitytaren.ActivityTaRenModel.getIns().off(activitytaren.ActivityTaRenModel.ACTIVIT_TAREN_EVENT.UPDATE_ACTIVIT_DATA,this,this._updateAckView)};e.prototype.refreshAll=function(){this.labeldaojishi2.visible=true;var t=this.actVo.timeVo;this.activityTimeView.start(t.endTime);this._setTopView();this.laitjiangli.x=this.width/2-this.laitjiangli.array.length*98/2-5};e.prototype._setTopView=function(){this.labeldaojishi2.text="";this.labelshuzi.text=game.MoneyModel.format(game.MoneyModel.getIns().getMoney(game.MoneyModel.MONEY_ENUM.GOLD));this._setTabList()};e.prototype._setTabList=function(){this.listwa.array=this._model.getTabActData();this.listwa.selectedIndex=this._model.getSelNowActIndex();this.listwa.scrollTo(this.listwa.selectedIndex)};e.prototype._onSelectHandler=function(t){var e=this.listwa.getItem(t);if(this._model.actIsOpen(e.id)){this._selItem=this.listwa.getItem(t);this._setMidView(e);this._setBottomView(e);this._setNextOpenTime(t)}else{this.listwa.selectedIndex=this._selItem.index;manager.FlowManager.instance.flowByStyle1(app.getLang("ttshop_01"))}};e.prototype._setMidView=function(t){this._setCellList(t);var e=this._model.getCellActData(t.id);this.imgzhekou.skin="res/static/zhekou/bg_huolangtehui_jiaobiao"+ +e.p6+".png";this.imglibao.skin="res/static/xiangoulihe/"+e.cp2+".png"};e.prototype._setBottomView=function(t){var e=this._model.getCellActData(t.id);var i=csv.ItemProxy.getItemSmallIcon(parseInt(e.p5.split("-")[0]));var n=e.p5.split("-")[1];this.labelshuzi2.text=n;this.imghuobi2.skin=i;this.yuanbao.icon.skin=i;this.labelshuzhi.text=e.cost.split("-")[1];if(this._model.getCellActInfoVo(t.id).status==0){this.btnaniu.disabled=false;this.btnaniu.label=app.getLang("购买");game.RedDotView.addTo(this.btnaniu)}else{this.btnaniu.disabled=true;this.btnaniu.label=app.getLang("已购买");game.RedDotView.removeFrom(this.btnaniu)}};e.prototype._setCellList=function(t){var e=[];var i=this._model.getCellActData(t.id).award.split(";");for(var n=0;n<i.length;n++){e.push(game.ItemUtil.parserList(i[n])[0])}this.laitjiangli.array=e};e.prototype._onTabHandler=function(t,e){t.setData(t.dataSource,e,this.listwa.selectedIndex)};e.prototype._onCellHandler=function(t,e){t.setData(t.dataSource)};e.prototype._buyClickHandler=function(){app.ProtocolRequest.RecvActPrizeReq(this._selItem.id,1)};e.prototype._updateAckView=function(){var e=this;activitytaren.ActivityTaRenModel.getIns().getInfoByActID(this._model.actVo.actid,new Laya.Handler(this,function(t){e._model.actVo.info=t;e._setMidView(e._selItem);e._setBottomView(e._selItem);e.labelshuzi.text=game.MoneyModel.format(game.MoneyModel.getIns().getMoney(game.MoneyModel.MONEY_ENUM.GOLD))}))};e.prototype._onTipShow=function(t){var e;if(game.MoneyModel.MONEY_ENUM.GOLD==t){shop.ShopModel.getIns().openChongZhiShop()}if(e){tip.TipManager.show(e,true)}};e.prototype._setNextOpenTime=function(t){var e=this.actVo.timeVo;var i=+this.actVo.timeVo.cfgData.date_juti.split(";")[1];var n=e.endTime-(7-(t+1+7-i))*86400;if(n-game.Context.getServerTime()>0&&t!=this.listwa.array.length-1){this.labeldaojishi.visible=true;this.activityTimeView2.start(n)}else{this.endTimeCallBack2()}};e.prototype.endTimeCallBack=function(){this.hideSubTime()};e.prototype.endTimeCallBack2=function(){this.activityTimeView2.stop();this.labeldaojishi.visible=false};e.prototype.hideSubTime=function(){this.activityTimeView.stop();this.labeldaojishi2.visible=false};e.SINGLE_KEY="limitgiftbag.LimitGiftBagView";return e}(ui.shangcheng.xiangouliheUI);i.LimitGiftBagView=t})(limitgiftbag||(limitgiftbag={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var limitshop;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){app.ViewManager.regist(i.XiangoushangchengView,"shangcheng.atlas");game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.LIMIT_SHOP,i.XiangoushangchengView,null,5)};e.prototype.initCommands=function(){};return e}(app.ModuleBase);i.LimitShopModule=t})(limitshop||(limitshop={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var limitshop;(function(i){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.delayTime=1e3;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.baglist.itemRender=i.XiangouShangDianItemView;this.baglist.renderHandler=new Laya.Handler(this,this.onItemRenderHandler);this.baglist.repeatX=0;this.baglist.vScrollBarSkin=" ";this.activityTimeView=new activitytaren.ActivityTimeView(this.labeldaojishi,new Laya.Handler(this,this.endTimeCallBack),"{0}",new Laya.Handler(this,this.updateHandler));tip.TipManager.bindMoneyTips(this.imghuobi,game.MoneyModel.MONEY_ENUM.GOLD)};t.prototype.updateActivityView=function(){this.refreshAll()};t.prototype.updateHandler=function(t){var e=activitytaren.ActivityTaRenModel.getIns().time2str(t);this.labeldaojishi.color=e.color;if(t>0){this.labeldaojishi.text=app.getLang("huodong_text05",e.timestr)}else{this.labeldaojishi.text=app.getLang("huodong_text07")}};t.prototype.endTimeCallBack=function(){this.labeldaojishi.text=app.getLang("huodong_text07")};t.prototype.onItemRenderHandler=function(t,e){t.setData(t.dataSource,this.actVo.actid)};t.prototype.onMoneyChange=function(){this.labelshuzi.text=game.MoneyModel.format(game.MoneyModel.getIns().getMoney(game.MoneyModel.MONEY_ENUM.GOLD))};t.prototype.onDisplay=function(){game.HelperViewHandler.register(this.functionid,[this.btnwenhao]);activitytaren.ActivityTaRenModel.getIns().on(activitytaren.ActivityTaRenModel.ACTIVIT_TAREN_EVENT.UPDATE_ACTIVIT_DATA,this,this.refrshNetData);this.callLater(this.refreshAll);this.subTicket=game.Context.getServerZeroTime()+util.TimeUtil.secOneDay-game.Context.getServerTime()+60;Laya.timer.once(this.delayTime,this,this.checkPost)};t.prototype.checkPost=function(){if(this.displayedInStage){this.subTicket--;if(this.subTicket>0){Laya.timer.once(this.delayTime,this,this.checkPost)}else{this.subTicket=game.Context.getServerZeroTime()+util.TimeUtil.secOneDay-game.Context.getServerTime();this.refrshNetData()}}};t.prototype.refrshNetData=function(){activitytaren.ActivityTaRenModel.getIns().getInfoByActID(this.actVo.actid,new Laya.Handler(this,this.refreshAll))};t.prototype.onUnDisplay=function(){activitytaren.ActivityTaRenModel.getIns().off(activitytaren.ActivityTaRenModel.ACTIVIT_TAREN_EVENT.UPDATE_ACTIVIT_DATA,this,this.refrshNetData);this.activityTimeView.stop()};t.prototype.refreshAll=function(){this.onMoneyChange();this.activityTimeView.start(this.actVo.timeVo.endTime);var t=xsqg.XianShiQiangGouModel.getIns().getList(csv.ActivityTarenProxy.getIns().activityidMap[this.actVo.actid]);this.baglist.array=t;this.baglist.refresh()};t.SINGLE_KEY="limitshop.XiangoushangchengView";return t}(ui.yunyinghuodong.xiangoushangchengviewUI);i.XiangoushangchengView=t})(limitshop||(limitshop={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var limitshop;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.imgkuang.mouseEnabled=false;this.qiangoubtn.clickHandler=new Laya.Handler(this,this.onQianGouHandler)};e.prototype.onQianGouHandler=function(){var t=-1;var e=xsqg.XianShiQiangGouModel.getIns().getSubCnt(this.cfg);var i=parseInt(this.cfg.p4)==1;if(e<=0){manager.FlowManager.instance.flowByStyle1(app.getLang("xianshiqianggou_text_4"));return}var n=this.cfg.cost;if(i){t=tip.TipManager.getCanBuyCount(n);if(t>e){t=e}}tip.TipManager.normalShop(this.itemVO,n,new Laya.Handler(this,this.buyCallBack,[this.cfg,this.moneyItemVO]),t)};e.prototype.buyCallBack=function(t,e,i){app.ProtocolRequest.RecvActPrizeReq(t.id,i)};e.prototype.updateActivitData=function(){activitytaren.ActivityTaRenModel.getIns().getInfoByActID(this.actid,new Laya.Handler(this,this.onRefreshHandle))};e.prototype.onDisplay=function(){};e.prototype.onUnDisplay=function(){};e.prototype.onRefreshHandle=function(){this.setData(this.cfg,this.actid)};e.prototype.setData=function(t,e){if(!t){return}this.cfg=t;this.actid=e;var i=game.ItemUtil.parserList(t.award)[0];if(!i){manager.FlowManager.instance.flowByStyle1("不存在道具:"+t.award);this.itemdaoju.setData(game.GridsModel.EMPTY);this.labelname.text=t.award;return}this.itemVO=i;this.labelname.color=game.STYLES.ITEM_QUALITY_S[i.getQuality()];this.labelname.text=i.getName();this.itemdaoju.setData(i);this.zhekouimg.skin="res/static/zhekou/bg_huolangtehui_jiaobiao"+t.p6+".png";this.imgmoney2.parserIcon(t.p5,this.labelmoneynum1);this.moneyItemVO=game.ItemUtil.parserList(t.cost)[0];this.imgmoney1.parserIcon(t.cost,this.labelmoneynum2,undefined,true,[game.STYLES.GREEN_COLOR_S,game.STYLES.RED_COLOR_S]);var n=xsqg.XianShiQiangGouModel.getIns().getSubCnt(this.cfg);this.qiangoubtn.label=app.getLang("goumai",n,t.p3);if(n==0){this.qiangoubtn.visible=false;this.yishouwanimg.visible=true}else{this.qiangoubtn.visible=true;this.yishouwanimg.visible=false}};return e}(ui.yunyinghuodong.xiangoushangdianitemUI);t.XiangouShangDianItemView=e})(limitshop||(limitshop={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var limittimegift;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.XIANSHILIBAO,i.LimitTimeGiftView)};e.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.TimeGiftNtf,this,this.onTimeGiftNtf);this.addMsgListener(app.ProtocolResponse.BuyGiftResp,this,this.onBuyGiftResp)};e.prototype.onTimeGiftNtf=function(t,e){i.LimitTimeGiftModel.getIns().updateData(e);newshangcheng.NewShangChengModel.getIns().ybPop.timeGiftData=e.data;newshangcheng.NewShangChengModel.getIns().checkHuoDong();i.LimitTimeGiftModel.getIns().OpenTipView(true);activitytaren.ActivityTaRenModel.getIns().event(activitytaren.ActivityIconStatuManager.EVENET_ACTIVITY_STATUS_CHANGED)};e.prototype.onBuyGiftResp=function(t,e){if(e.result==1){}};e.SINGLE_KEY="limittimegift.LimitTimeModule";return e}(app.ModuleBase);i.LimitTimeModule=t})(limittimegift||(limittimegift={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("gold_timegift.csv");this.cfgMap=t.getMap("id");this.actidMap=t.getMap("actid")};e.prototype.getCfg=function(t){return this.cfgMap[t]};e.SINGLE_KEY="csv.GoldTimeGiftProxy";return e}(app.ModelBase);t.GoldTimeGiftProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var limittimegift;(function(a){var t=function(t){__extends(n,t);function n(){return t!==null&&t.apply(this,arguments)||this}n.getIns=function(){return app.Singleton.getInstance(n)};n.prototype.init=function(){};n.prototype.isOpen=function(){if(this.openDataArr&&this.openDataArr.length>0){return true}return false};n.prototype.updateData=function(t){this.openDataArr=[];for(var e=0;e<t.data.length;e++){var i=new a.LimitTimeGiftVo;i.cfg=csv.GoldTimeGiftProxy.getIns().getCfg(t.data[e].cfgId);i.cfgId=t.data[e].cfgId;i.stime=t.data[e].stime;i.isnew=t.data[e].isnew;i.buynum=t.data[e].buynum;i.endTime=this.getEndTime(i.cfg,i.stime);this.openDataArr.push(i)}this.openDataArr.sort(function(t,e){if(t.endTime>e.endTime){return 1}else if(t.endTime<e.endTime){return-1}else{return 0}});this.event(n.EVENTS.UPDATE_LIST_DATA)};n.prototype.getEndTime=function(t,e){var i=0;if(t.type==3){i=e+t.times*util.TimeUtil.secOneDay}else{i=e+t.times*60}return i};n.prototype.OpenTipView=function(t){if(!newshangcheng.ActivityTipModel.getIns().shownTips){return}if(this.openDataArr){var e=void 0;for(var i in this.openDataArr){var n=this.openDataArr[i];newshangcheng.ActivityTipModel.getIns().setDayArray(n.stime);if(newshangcheng.ActivityTipModel.getIns().shownTips.indexOf(n.cfg.actid)>=0){continue}if(t&&game.Context.getServerTime()-n.stime>60){continue}if(n.cfg.buynum-n.buynum<=0){continue}if(!e){e=n}else if(e.stime<n.stime){e=n}else if(e.stime==n.stime&&e.cfgId<n.cfgId){e=n}}return e}};n.SINGLE_KEY="limittimegift.LimitTimeGiftModel";n.EVENTS={UPDATE_LIST_DATA:"UPDATE_LIST_DATA"};return n}(app.ModelBase);a.LimitTimeGiftModel=t})(limittimegift||(limittimegift={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var limittimegift;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.quxiaobtn.clickHandler=new Laya.Handler(this,this.onClickCancelBtn);this.quedingbtn.clickHandler=new Laya.Handler(this,this.onClickOKBtn);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){var t=this.dataSource;var e=game.ItemUtil.parserList(t.cost)[0];this.label1.text=app.getLang("yuanbaotehui_xianshi2",e.count)};e.prototype.onClickOKBtn=function(){var t=this.dataSource;if(!game.GridsModel.getIns().hasEnoughItems(t.cost,false,true)){return}app.ProtocolRequest.BuyGiftReq(t.id);this.closeView()};e.prototype.onClickCancelBtn=function(){this.closeView()};e.prototype.closeView=function(){app.ViewManager.toggleDialog(e,-1)};e.SINGLE_KEY="limittimegift.LimitTimeGiftBuyAlert";return e}(ui.yuanbaotehui.yuanbaotehuitipUI);t.LimitTimeGiftBuyAlert=e})(limittimegift||(limittimegift={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var limittimegift;(function(a){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.noCloseAll="noCloseAll";return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.yeqian.renderHandler=new Laya.Handler(this,this.onRenderHandler);this.yeqian.selectHandler=new Laya.Handler(this,this.onSelectedHandler);this.yeqian.selectEnable=true;this.buybtn.clickHandler=new Laya.Handler(this,this.onClickBuyBtn);this.daojulist.itemRender=grids.GridView;this.daojulist.renderHandler=grids.GridView.CommonItemRender;this.centerLayout=new game.CenterLayoutMediator(this.daojulist,this.daojubox,98,this.daojulist.spaceX);this.activityTimeView=new activitytaren.ActivityTimeView(this.labeltip,new Laya.Handler(this,this.endTimeCallBack),app.getLang("yuanbaotehui_xianshi1"));this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.model=newshangcheng.NewShangChengModel.getIns()};t.prototype.onDisplay=function(){this.model.on(newshangcheng.NewShangChengEvent.EVENT_UPDATE_XIN,this,this.onUpdateXin);a.LimitTimeGiftModel.getIns().on(a.LimitTimeGiftModel.EVENTS.UPDATE_LIST_DATA,this,this.onUpdateData);this.leaveId=-1;this.callLater(this.refreshAll);this.ani1.play(0,true);guide.GuideModel.getIns().boOpen=false};t.prototype.onUnDisplay=function(){this.model.off(newshangcheng.NewShangChengEvent.EVENT_UPDATE_XIN,this,this.onUpdateXin);a.LimitTimeGiftModel.getIns().off(a.LimitTimeGiftModel.EVENTS.UPDATE_LIST_DATA,this,this.onUpdateData);this.onLeave();this.leaveId=-1;this.activityTimeView.stop();this.ani1.stop();this.yeqian.selectedIndex=-1;if(this.dataSource&&this.dataSource instanceof Array&&this.dataSource.length>1){if(this.dataSource[1]){if(a.LimitTimeGiftModel.getIns().isOpen()){game.WindowsResigter.call(csv.FunctionsProxy.ENUMS.XIANSHILIBAO)}}}guide.GuideModel.getIns().boOpen=true};t.prototype.onUpdateXin=function(){this.yeqian.refresh()};t.prototype.isFromFace=function(){if(this.dataSource&&this.dataSource instanceof Array&&this.dataSource.length>1){if(this.dataSource[1]==false){return true}}return false};t.prototype.onUpdateData=function(){this.updateYeqianData();var t=this.yeqian.array[this.yeqian.selectedIndex];if(t){this.zhanshiimg.skin="res/static/yuanbaotehui/"+t.cfg.banner_2+".png";this.jiagelab.text=t.cfg.giftvalue;if(t.cfg.times>365){this.labeltip.text=app.getLang("yuanbaotehui_xianshi3")}else{this.activityTimeView.start(t.endTime)}this.centerLayout.array=game.ItemUtil.parserList(t.cfg.reward);var e=t.cfg.buynum-t.buynum;if(e>0){this.shouqingimg.visible=false;this.goumaibox.visible=true;this.cishulab.text=app.getLang("huodong_text_02",e,t.cfg.buynum);var i=game.ItemUtil.parserList(t.cfg.cost)[0];this.yuanbaolab.text=i.count+""}else{this.shouqingimg.visible=true;this.goumaibox.visible=false}if(t.cfg.batteryshow&&t.cfg.batteryshow>0){this.zhanlibox.visible=true;this.num.value=t.cfg.batteryshow}else{this.zhanlibox.visible=false}}};t.prototype.refreshAll=function(){this.updateYeqianData();this.yeqian.selectedIndex=this.getSelectedIndex()};t.prototype.updateYeqianData=function(){if(this.yeqian.selectedIndex!=-1){var t=this.yeqian.array[this.yeqian.selectedIndex];if(t&&game.Context.getServerTime()>=t.endTime){return}}var e=a.LimitTimeGiftModel.getIns();this.yeqian.array=e.openDataArr};t.prototype.onRenderHandler=function(t,e){var i=t.dataSource;t.qiehuanbtn.label=app.getLang(i.cfg.name);var n=this.model.isXinCanShow(i.cfg.actid);if(n){game.RedDotView.addTo(t,t.width,0,1,1,game.RedDotView.ENUM_TYPE.XIN)}else{game.RedDotView.removeFrom(t)}if(e==this.yeqian.selectedIndex){t.qiehuanbtn.selected=true}else{t.qiehuanbtn.selected=false}};t.prototype.onSelectedHandler=function(t){if(t==-1){return}this.activityTimeView.stop();var e=a.LimitTimeGiftModel.getIns();var i=this.getCfgId();var n=this.yeqian.array[t];e.selectitemId=n.cfgId;if(this.leaveId==-1){this.leaveId=e.selectitemId}else{if(e.selectitemId!=this.leaveId){this.onLeave()}}app.ProtocolRequest.ClickGiftSyn(i)};t.prototype.onLeave=function(){var t=csv.GoldTimeGiftProxy.getIns().getCfg(this.leaveId);if(t&&this.isFromFace()==false){this.model.delXin(t.actid);this.leaveId=a.LimitTimeGiftModel.getIns().selectitemId}};t.prototype.endTimeCallBack=function(){this.activityTimeView.stop();this.labeltip.text=app.getLang("yuanbaotehui_xianshi4")};t.prototype.onClickBuyBtn=function(){var t=this.yeqian.array[this.yeqian.selectedIndex];if(!t){return}if(game.Context.getServerTime()>=t.endTime){manager.FlowManager.instance.flowByStyle1(app.getLang("yuanbaotehui_xianshi4"));return}app.ViewManager.toggleDialog(a.LimitTimeGiftBuyAlert,1,0,t.cfg)};t.prototype.getSelectedIndex=function(){var t=this.getCfgId();for(var e=0;e<this.yeqian.array.length;e++){if(this.yeqian.array[e].cfgId==t){return e}}return 0};t.prototype.getCfgId=function(){var t=0;if(this.dataSource){if(this.dataSource instanceof Array){t=this.dataSource[0]}else{t=this.dataSource}}return t};t.prototype.onClosed=function(){newshangcheng.ActivityTipModel.getIns().tryOpenView()};t.SINGLE_KEY="limittimegift.LimitTimeGiftBuyView";return t}(ui.yuanbaotehui.yuanbaotehui_xianshilibao_zsUI);a.LimitTimeGiftBuyView=t})(limittimegift||(limittimegift={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var limittimegift;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.model=newshangcheng.NewShangChengModel.getIns();this.activityTimeView=new activitytaren.ActivityTimeView(this.timelab,new Laya.Handler(this,this.endTimeCallBack),app.getLang("yuanbaotehui_xianshi1"));this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.model.on(newshangcheng.NewShangChengEvent.EVENT_UPDATE_XIN,this,this.onUpdateCellView);this.on(Laya.Event.CLICK,this,this.onClickHandler);this.callLater(this.refreshAll)};e.prototype.onUpdateCellView=function(){if(this._data){this.setData(this._data)}};e.prototype.onUnDisplay=function(){this.activityTimeView.stop();this.model.off(newshangcheng.NewShangChengEvent.EVENT_UPDATE_XIN,this,this.onUpdateCellView)};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){this.activityTimeView.stop();this._data=t;var e=t.cfg;this.bannerimg.skin="res/static/yuanbaotehui/"+e.banner_1+".png";var i=false;var n=this.model.isXinCanShow(e.actid);if(n){game.RedDotView.addTo(this,this.width-10,10,1,1,game.RedDotView.ENUM_TYPE.XIN);i=true}else{game.RedDotView.removeFrom(this)}if(e.times>365){this.timelab.text=app.getLang("yuanbaotehui_xianshi3")}else{this.activityTimeView.start(this._data.endTime)}};e.prototype.endTimeCallBack=function(){this.activityTimeView.stop();this.timelab.text=""};e.prototype.onClickHandler=function(){app.ViewManager.toggleDialog(i.LimitTimeGiftBuyView,1,1,[this._data.cfgId,true])};e.SINGLE_KEY="yuanbaotehui.LimitTimeGiftCell";return e}(ui.yuanbaotehui.yuanbaotehui_xianshilibaoitemUI);i.LimitTimeGiftCell=t})(limittimegift||(limittimegift={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var limittimegift;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.bannerlist.itemRender=i.LimitTimeGiftCell;this.bannerlist.renderHandler=new Laya.Handler(this,this.onRenderHandler);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){i.LimitTimeGiftModel.getIns().on(i.LimitTimeGiftModel.EVENTS.UPDATE_LIST_DATA,this,this.onUpdateData);app.ViewManager.toggleView(main.MoneyView,this,1);this.refreshAll()};e.prototype.onUnDisplay=function(){app.ViewManager.toggleView(main.MoneyView,app.AppContainer.uiLayer,1);i.LimitTimeGiftModel.getIns().off(i.LimitTimeGiftModel.EVENTS.UPDATE_LIST_DATA,this,this.onUpdateData)};e.prototype.refreshAll=function(){main.MoneyView.getIns().setPos(200,0);var t=i.LimitTimeGiftModel.getIns();if(t.openDataArr.length){this.tishiimg.visible=false;this.bannerlist.array=t.openDataArr}else{this.tishiimg.visible=true;this.bannerlist.array=[]}};e.prototype.onUpdateData=function(){this.callLater(this.refreshAll)};e.prototype.onRenderHandler=function(t,e){t.setData(t.dataSource)};e.SINGLE_KEY="yuanbaotehui.LimitTimeGiftView";return e}(ui.yuanbaotehui.yuanbaotehui_xianshilibaoUI);i.LimitTimeGiftView=t})(limittimegift||(limittimegift={}));var limittimegift;(function(t){var e=function(){function t(){}return t}();t.LimitTimeGiftVo=e})(limittimegift||(limittimegift={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var login;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){app.ViewManager.regist(i.LoginMainView,"denglu.atlas");app.ViewManager.regist(i.SystemNoticeView,"public.atlas");app.ViewManager.regist(i.Shilingtishitips,"public.atlas");app.ViewManager.regist(game.Alert,"public.atlas")};e.prototype.initCommands=function(){};e.SINGLE_KEY="login.LoginModule";return e}(app.ModuleBase);i.LoginModule=t})(login||(login={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var login;(function(t){var n;(function(t){t[t["HALF"]=1]="HALF";t[t["SKIP"]=2]="SKIP";t[t["END"]=3]="END"})(n=t.EAnimStatus||(t.EAnimStatus={}));var e=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t._isRandomName=false;t._createRoleSucceed=false;t.type="post";t.responeType="text";return t}t.getIns=function(){return app.Singleton.getInstance(t)};Object.defineProperty(t.prototype,"channel_id",{get:function(){return 0},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"suffix",{get:function(){if(window["appConfig"]&&window["appConfig"]["report_url_suffix"]){return window["appConfig"]["report_url_suffix"]||""}return""},enumerable:true,configurable:true});t.prototype.init=function(){if(window["appConfig"]&&window["appConfig"]["report_url"]){this.url=window["appConfig"]["report_url"]}};t.prototype.report_task=function(t){if(this.url){var e="uid="+game.AccountModel.accountId+"&channel="+this.channel_id+"&server="+game.Context.serverId+"&task="+t;app.Http.request(this.url+"/report_task"+this.suffix,null,null,e,this.type,this.responeType)}};t.prototype.newData=function(){var t="uid="+game.AccountModel.accountId+"&channel="+this.channel_id+"&server="+game.Context.serverId;var e=game.Context.mainRole?game.Context.mainRole.playername:"";if(e!=""){t+="&name="+e}return t};t.prototype.jubao=function(t,e,i,n,a,o){var s="server="+game.Context.serverId+"&uid="+game.AccountModel.accountId+"&rid="+game.Context.mainRole.insId.toString()+"&rname="+game.Context.mainRole.playername+"&ip="+(game.Context.ip||"")+"&type="+t+"&report_uid="+e+"&report_rid="+i+"&report_rname="+n+"&report_ip="+a;if(o&&o!=""){s+="&reason="+o}var r=game.JuBaoModel.getIns().url;if(r){app.Http.request(this.url+("/"+r)+this.suffix,this,this.onResponse,s,this.type,this.responeType)}};t.prototype.onResponse=function(t){app.ViewManager.toggleDialog(game.JubaoView,-1);manager.FlowManager.instance.flowByStyle1(app.getLang("report5"))};t.prototype.start_game=function(){if(this.url){var t=this.newData();this.report_create_role(t+"&step=1&status=0")}};t.prototype.create_role=function(t){if(this.url){this._isRandomName=t;var e=this.newData();this.report_create_role(e+"&step=2&status="+(t?1:2))}};t.prototype.create_succeed=function(){if(this.url){this._createRoleSucceed=true;var t=this.newData();this.report_create_role(t+"&step=3&status=0")}};t.prototype.refresh_game=function(t,e){if(this.url){var i=this.newData();this.report_create_role(i+"&step=6",t,e)}else{e()}};t.prototype.enter_game=function(){if(this.url){if(this._createRoleSucceed&&!this._isRandomName){this.create_role(false)}var t=this.newData();this.report_create_role(t+"&step=4&status=0")}};t.prototype.playAnim=function(t,e){if(this.url){var i=this.newData();if(t==n.HALF){i+="&play="+e}this.report_create_role(i+"&step=5&status="+t)}};t.prototype.report_create_role=function(t,e,i){app.Http.request(this.url+"/report_create_role"+this.suffix,e,i,t,this.type,this.responeType)};t.SINGLE_KEY="login.CoverModel";return t}(app.ModelBase);t.CoverModel=e})(login||(login={}));if(window["sclick"]){window["sclick"]=function(){login.CoverModel.getIns().refresh_game(this,function(){setTimeout(function(){window.location.href=""},0)})}}var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var login;(function(i){var t=function(e){__extends(o,e);function o(){var t=e!==null&&e.apply(this,arguments)||this;t.sysNotice=new i.SystemNoticeModel;return t}o.getIns=function(){return app.Singleton.getInstance(o)};o.prototype.getSerById=function(t){for(var e=0,i=this.allSers.length;e<i;e++){if(this.allSers[e].id==t){return this.allSers[e]}}return null};o.prototype.checkHasRole=function(t){for(var e=0,i=this.roleSers.length;e<i;e++){if(this.roleSers[e].serverid==t){return true}}return false};o.prototype.getZhuantai=function(t){switch(t){case i.EServerStatus.Normal:return"denglu/bg_fuwuqi_2.png";case i.EServerStatus.IsNewServer:return"denglu/bg_fuwuqi_2.png";case i.EServerStatus.Hot:return"denglu/bg_fuwuqi_1.png";case i.EServerStatus.WeiHu:return"denglu/bg_fuwuqi_3.png"}};o.prototype.getStatus=function(t){if(t.status==0){return i.EServerStatus.WeiHu}else if(t.status==1){if(t.recommend==1){return i.EServerStatus.IsNewServer}else if(t.recommend==0){if(t.ishot==1){return i.EServerStatus.Hot}}}return i.EServerStatus.Normal};o.prototype.init=function(){};o.prototype.requestInfo=function(){if(!game.Context.nativeDebug){var t=void 0;if(window["appConfig"]){t=window["appConfig"]["ver"]||0}else{t=0}var e="version="+t+"&user_id="+game.AccountModel.accountId;if(window["appConfig"]&&window["appConfig"]["review"]){e+="&review="+window["appConfig"]["review"]}console.log("param:"+e);app.Http.request(game.Context.gsUrl,this,this.onResponse,e,"post","text",1)}};o.prototype.getRealSerlist=function(t){var e=window["appConfig"];if(e){var i=e["hide_sid"];if(i){var n=[];var a=i.split(";");for(var o=0;o<t.length;o++){var s=t[o];var r=false;for(var l=0;l<a.length;l++){if(s.id==a[l]){r=true}}if(r){n.push(s)}}return n}}return t};o.prototype.onResponse=function(t){var e=JSON.parse(t);if(window["gsjson"]){e=JSON.parse(window["gsjson"])}if(e.resultCode!=0){game.Alert.show("code:"+e.resultCode);return}this.allSers=this.getRealSerlist(e.data.rows);this.roleSers=[];if(e.data.roles){for(var i=0,n=e.data.roles.length;i<n;i++){var a=e.data.roles[i];if(this.getSerById(a.serverid)){this.roleSers.push(a)}}}if(e.data.lastlogin){this.ser=this.getSerById(e.data.lastlogin)}else{this.ser=this.allSers[this.allSers.length-1]}if(!this.ser&&this.allSers&&this.allSers.length>0){this.ser=this.allSers[this.allSers.length-1]}if(!game.Context.nativeDebug&&!this.ser){game.Alert.show(app.getLang("error1"));return}this.selectList=[{name:"最近",info:this.roleSers,type:1},{name:"服务器",info:this.allSers,type:2}];game.Context.serverId=this.ser.id.toString();game.Context.serverName=this.ser.name;o.getIns().event(o.EVENTS.SERVER_DEFAULT,this.ser)};o.prototype.subPackageEnd=function(){console.log("subPackageEnd...");game.Context.isSubLoaded=true};o.SINGLE_KEY="login.LoginModel";o.EVENTS={SERVER_INFO:"SERVER_INFO",SERVER_DEFAULT:"SERVER_DEFAULT",TOMATO_SEND_REPORT:"TOMATO_SEND_REPORT"};return o}(app.ModelBase);i.LoginModel=t})(login||(login={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var login;(function(i){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.boxInitY=0;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.ageXY=new Laya.Point(this.box.width-this.age12.x,this.box.height-this.age12.y);this.btnchuangjian.clickHandler=new Laya.Handler(this,this.onEnterGame);this.dianjibtn.clickHandler=new Laya.Handler(this,this.onLoginServer);this.width=Laya.stage.width;this.height=Laya.stage.height;this.box.centerX=0;this.box.height=Laya.stage.height;this.boxEffect.scaleX=this.boxEffect.scaleY=app.AppContainer.getScale();this.wenben.text="";this.wenben.prompt=app.getLang("请输入用户名");this.shuoming1.bottom=ScreenAdapter.OFFSET_BOTTOM+10;this.shuoming1.centerX=this.shuoming2.centerX=0;if(window["appConfig"]&&window["appConfig"]["rzurl"]){this.shuoming1.skin="res/static/"+window["appConfig"]["rzurl"]+".png"}else{this.shuoming1.skin=""}if(window["appConfig"]&&window["appConfig"]["yxmzurl"]){this.imghuluwa.skin="res/static/"+window["appConfig"]["yxmzurl"]+".png"}else{this.imghuluwa.skin=""}this.initY=this.btngonggao.y;this.shuoming2Y=this.shuoming2.y;this.btngonggao.clickHandler=new Laya.Handler(this,this.onClickNoticeHandler);this.btngonggao.visible=false;if(gamesdk.UrlCfg.pf){if(game.Context.nativeDebug){this.zhanghao.visible=true}else{this.zhanghao.visible=false}}if(window["loadMain"]){window["loadMain"]("main2.min")}else{i.LoginModel.getIns().subPackageEnd()}this.age12.clickHandler=new Laya.Handler(this,this.onAgeHandler)};t.prototype.onAgeHandler=function(){app.ViewManager.toggleDialog(i.Shilingtishitips,1)};t.prototype.setRed=function(t){if(!this.redPoint){this.redPoint=new Laya.Image;this.redPoint.skin="denglu/bg_redpoint.png"}if(t){this.btngonggao.addChild(this.redPoint);this.redPoint.x=42}else{this.redPoint.removeSelf()}};t.prototype.hide=function(){this.box.visible=false;this.btngonggao.visible=false};t.prototype.onClickNoticeHandler=function(){app.ViewManager.toggleView(i.SystemNoticeView,app.AppContainer.flowLayer,1)};t.prototype.onBgLoadend=function(){manager.LoadingManager.instance.setJsLoading(false);if(window["loadingView"]){window["loadingView"].hideLoadingView()}};t.prototype.onRisizeHandler=function(){this.btngonggao.x=Laya.stage.width-86;this.btngonggao.y=this.initY+ScreenAdapter.OFFSET_Y;if(this.ageXY){this.age12.x=this.box.x+this.box.width-this.ageXY.x;this.age12.y=this.box.y+this.box.height-ScreenAdapter.OFFSET_BOTTOM-this.ageXY.y}};t.prototype.onDisplay=function(){this.bgbeijing.on(Laya.Event.LOADED,this,this.onBgLoadend);this.bgbeijing.skin="res/static/bg_Loadingnew.jpg";this.on(Laya.Event.RESIZE,this,this.onRisizeHandler);this.onRisizeHandler();this.shuoming2.y=this.shuoming2Y+ScreenAdapter.OFFSET_Y;if(!this.imghuluwaTop){this.imghuluwaTop=this.imghuluwa.top}this.imghuluwa.top=this.imghuluwaTop+ScreenAdapter.OFFSET_Y;this.getNotice();i.LoginModel.getIns().on(i.LoginModel.EVENTS.SERVER_INFO,this,this.onServerDefault);i.LoginModel.getIns().on(i.LoginModel.EVENTS.SERVER_DEFAULT,this,this.onServerDefault);this.callLater(this.updateLayout);this.setAvatar("res/sks/dengrujiemian.sk");this.onCheckOpenNotice()};t.prototype.onCheckOpenNotice=function(){if(app.ViewManager.DisplayedInStage(i.LoginMainView.SINGLE_KEY)){if(game.Context.isSubLoaded&&this.box.visible){this.btngonggao.visible=true;this.onClickNoticeHandler()}else{Laya.timer.once(1e3,this,this.onCheckOpenNotice)}}};t.prototype.setAvatar=function(t){if(this.skt&&this.skt.parent){this.skt.removeSelf()}else{this.skt=new common.CSkt}this.skt.init(t);this.roleShow.addChild(this.skt)};t.prototype.getNotice=function(){if(game.Context.noticeUrl){app.Http.request(game.Context.noticeUrl,this,this.onNoticeResponse,undefined,"post","json")}};t.prototype.onNoticeResponse=function(t){if(t.code==1){i.LoginModel.getIns().sysNotice.noticeList=t.data;i.LoginModel.getIns().sysNotice.init()}else{console.log("game.Context.noticeUrl:"+t.code)}};t.prototype.onUnDisplay=function(){i.LoginModel.getIns().off(i.LoginModel.EVENTS.SERVER_INFO,this,this.onServerDefault);i.LoginModel.getIns().off(i.LoginModel.EVENTS.SERVER_DEFAULT,this,this.onServerDefault);game.Context.removeVersion();this.off(Laya.Event.RESIZE,this,this.onRisizeHandler);this.skt&&this.skt.stop();manager.LoadingManager.instance.setJsLoading(false)};t.prototype.updateLayout=function(){if(this.boxInitY==0){this.boxInitY=this.box.y}this.box.y=this.boxInitY-ScreenAdapter.OFFSET_BOTTOM;var t=i.EServerStatus.Normal;if(game.Context.nativeDebug){if(window["appConfig"]){this.fuwuqixinxi.text=window["appConfig"]["host"]+":"+window["appConfig"]["port"];this.wenben.text=game.Context.HtmlParams.uid||Laya.LocalStorage.getItem("user")||"T"+(new Date).getTime();if(game.Context.HtmlParams["port"]){this.fuwuqixinxi.text=window["appConfig"]["host"]+":"+game.Context.HtmlParams["port"]}}else{this.wenben.text=ent.DebugConfig.user;this.fuwuqixinxi.text=ent.DebugConfig.host+":"+ent.DebugConfig.port}}else{if(i.LoginModel.getIns().ser){this.fuwuqixinxi.text=i.LoginModel.getIns().ser.name;t=i.LoginModel.getIns().getStatus(i.LoginModel.getIns().ser)}else{this.fuwuqixinxi.text=""}if(!game.AccountModel.accountId){this.wenben.text=Laya.LocalStorage.getItem("user")?Laya.LocalStorage.getItem("user"):"test"+Math.floor(Math.random()*1e3);game.AccountModel.accountId=this.wenben.text}else{this.wenben.text=game.Context.HtmlParams["user"]?game.Context.HtmlParams["user"]:ent.DebugConfig.user?ent.DebugConfig.user:Laya.LocalStorage.getItem("user")?Laya.LocalStorage.getItem("user"):""}}this.zhuangtaiimg.skin=i.LoginModel.getIns().getZhuantai(t)};t.prototype.onServerDefault=function(){this.callLater(this.updateLayout)};t.prototype.onEnterGame=function(){if(!game.Context.nativeDebug&&!i.LoginModel.getIns().ser){game.Alert.show(app.getLang("error1"));return}if(i.LoginModel.getIns().ser&&i.LoginModel.getIns().getStatus(i.LoginModel.getIns().ser)==i.EServerStatus.WeiHu){game.Alert.show(app.getLang("server_err_1"));return}Laya.AtlasResourceManager.instance.freeAll();if(game.Context.nativeDebug){this._checkLoginAccountId();if(window["appConfig"]){if(game.Context.HtmlParams["port"]){app.Protocol.connect(window["appConfig"]["host"],game.Context.HtmlParams["port"])}else{app.Protocol.connect(window["appConfig"]["host"],window["appConfig"]["port"])}}else{app.Protocol.connect(ent.DebugConfig.host,ent.DebugConfig.port)}this.hide();return}else{this._checkLoginAccountId()}game.AccountModel.serverName=i.LoginModel.getIns().ser.name;app.Protocol.connect(i.LoginModel.getIns().ser.ip,i.LoginModel.getIns().ser.port);this.hide()};t.prototype._checkLoginAccountId=function(){if(game.Context.nativeDebug||!gamesdk.UrlCfg.pf){var t;if(this.wenben.text==""){t=""}else{t=this.wenben.text.replace(/\s*/g,"")}if(!t){manager.FlowManager.instance.flowByStyle1("请输入用户名!");return}Laya.LocalStorage.setItem("user",t);game.AccountModel.accountId=t}};t.prototype.onLoginServer=function(){if(!game.Context.nativeDebug&&!i.LoginModel.getIns().ser){game.Alert.show(app.getLang("error1"));return}if(game.Context.nativeDebug){console.log("native debug is true");return}app.ViewManager.toggleDialog(i.LoginServerView,1,0)};t.SINGLE_KEY="login.LoginMainView";return t}(ui.denglu.denglunewUI);i.LoginMainView=t;var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.tishi01.text=app.getLang("agelimit")};e.SINGLE_KEY="login.Shilingtishitips";return e}(ui.shilingtishi.shilingtishitipsUI);i.Shilingtishitips=e})(login||(login={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var login;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.SINGLE_KEY="mall.LoginServerPageCell";return e}(ui.denglu.fuwuqixuanzeitemUI);t.LoginServerPageCell=e})(login||(login={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var login;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.SINGLE_KEY="mall.LoginServerPageCell2";return e}(ui.denglu.fuwyqixuanzeitem2UI);t.LoginServerPageCell2=e})(login||(login={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var login;(function(r){var n;(function(t){t[t["Normal"]=0]="Normal";t[t["IsNewServer"]=1]="IsNewServer";t[t["Hot"]=2]="Hot";t[t["WeiHu"]=3]="WeiHu"})(n=r.EServerStatus||(r.EServerStatus={}));var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.paihangbanglist01.itemRender=r.LoginServerPageCell;this.paihangbanglist01.renderHandler=new Laya.Handler(this,this.onSubPageRender);this.paihangbanglist01.selectHandler=new Laya.Handler(this,this.onSubTypeChange);this.paihangbanglist01.selectEnable=true;this.paihangbanglist01.selectedIndex=0;this.paihangbanglist01.array=r.LoginModel.getIns().selectList;this.fuwuqilist.selectEnable=true;this.fuwuqilist.renderHandler=new Laya.Handler(this,this.onCellRender)};e.prototype.onDisplay=function(){this.callLater(this.updateLayout)};e.prototype.onUnDisplay=function(){};e.prototype.updateLayout=function(){};e.prototype.onSubPageRender=function(t,e){t.paihangbangbtm.label=t.dataSource.name;t.paihangbangbtm.selected=this.paihangbanglist01.selectedIndex==e};e.prototype.getLevelstr=function(t){if(t.combats){for(var e=0;e<t.combats.length;e++){var i=t.combats[e];if(i){var n=i.level;if(n){return csv.ReBirthProxy.getIns().getLvlDes(n)+app.getLang("lv")}}}}return""};e.prototype.onCellRender=function(t,e){var i;if(this.paihangbanglist01.selectedItem.type==1){var n=t.dataSource;var a=r.LoginModel.getIns().getSerById(n.serverid);i=r.LoginModel.getIns().getStatus(a);var o=a!=null;if(o){t.gray=false;t.on(Laya.Event.CLICK,this,this.onCellCharge,[n.serverid,a.createlimit])}else{t.gray=true;t.off(Laya.Event.CLICK,this,this.onCellCharge)}t.xinxilab.x=68;t.xinxilab.text=n.servername;t.juesename.text=n.name;if(n.level){t.dengjilab.text="Lv."+n.level}else{t.dengjilab.text=this.getLevelstr(n)}}else{var s=t.dataSource;var o=r.LoginModel.getIns().getSerById(s.id)!=null;if(o){t.gray=false;t.on(Laya.Event.CLICK,this,this.onCellCharge,[s.id,s.createlimit])}else{t.gray=true;t.off(Laya.Event.CLICK,this,this.onCellCharge)}t.xinxilab.text=s.name;t.xinxilab.x=118;t.juesename.text="";t.dengjilab.text="";i=r.LoginModel.getIns().getStatus(s)}t.huobaoimg.skin=this.getStatusImg(i);t.zhuangtaiimg.skin=r.LoginModel.getIns().getZhuantai(i)};e.prototype.getStatusImg=function(t){switch(t){case n.Normal:return null;case n.IsNewServer:return"denglu/bg_xinfu.png";case n.Hot:return"denglu/bg_huobao.png";case n.WeiHu:return"denglu/bg_weihuzhong.png"}};e.prototype.onSubTypeChange=function(){this.callLater(this.doSlSubTypeChange)};e.prototype.onCellCharge=function(t,e){if(e&&!r.LoginModel.getIns().checkHasRole(t)){game.Alert.show(app.getLang("createrole_error_6"));return}var i=r.LoginModel.getIns().getSerById(t);if(i&&r.LoginModel.getIns().getStatus(i)==n.WeiHu){game.Alert.show(app.getLang("server_err_1"));return}r.LoginModel.getIns().ser=r.LoginModel.getIns().getSerById(t);game.Context.serverId=r.LoginModel.getIns().ser.id.toString();game.Context.serverName=r.LoginModel.getIns().ser.name;r.LoginModel.getIns().event(r.LoginModel.EVENTS.SERVER_INFO);this.close()};e.prototype.doSlSubTypeChange=function(){if(!this.paihangbanglist01.selectedItem){return}this.fuwuqilist.array=this.paihangbanglist01.selectedItem.info;this.fuwuqilist.scrollTo(0)};e.SINGLE_KEY="login.LoginServerView";return e}(ui.denglu.fuwuqixuanzeUI);r.LoginServerView=t})(login||(login={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var login;(function(o){var t=function(){function t(){}return t}();o.INoticeVo=t;var n=function(){function t(t){t=this.regCenter(t);this._html=this.regLine(t)}t.prototype.reg_str=function(t,e){var i=t.indexOf("<"+e+">");var n="</"+e+">";var a=t.indexOf(n);if(i!=-1&&a!=-1){var o=t.substr(i,a+n.length-i);var s=t.replace(o,"");return[s,o]}};t.prototype.regCenter=function(t){var e=this.reg_str(t,"center");if(e){this.centerHtml=app.checkStr(e[1]);return e[0]}return t};t.prototype.regLine=function(t){var e=this.reg_str(t,"line");if(e){this._line=e[1];return e[0]}return t};t.prototype.draw=function(t){t.graphics.clear();if(this._line){var e=this._line.split(";");for(var i=0;i<e.length;i++){var n=e[i];var a=n.split(",");t.graphics.drawRect(parseInt(a[0]),parseInt(a[1]),parseInt(a[2]),parseInt(a[3]),a[4]||"#000000")}}};Object.defineProperty(t.prototype,"html",{get:function(){return this._html},enumerable:true,configurable:true});return t}();var e=function(){function t(){this.closeUIList=[]}t.prototype.onSortHandler=function(t,e){if(parseInt(t.time)<parseInt(e.time)){return 1}else if(parseInt(t.time)>parseInt(e.time)){return-1}return 0};t.prototype.init=function(){this.noticeList.sort(this.onSortHandler)};t.prototype.isRead=function(t){if(this.readList){for(var e=0;e<this.readList.length;e++){if(this.readList[e].id==t){return true}}}return false};t.prototype.updateRedPoint=function(){var t=false;if(this.noticeList){for(var e=0;e<this.noticeList.length;e++){var i=this.noticeList[e];if(!this.isRead(parseInt(i.time))){t=true}}}if(t){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.PublicNotice)}else{game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.PublicNotice)}};t.prototype.setRead=function(t){var e=false;if(this.readList){for(var i=0;i<this.readList.length;i++){var n=this.readList[i];if(n.id==t){e=true}}}if(!e){var a=new CltUseDataInfo;a.id=t;if(!this.readList){this.readList=[]}this.readList.push(a)}var o=[];var s=new CltUseDataInfo;s.id=t;o.push(s);app.ProtocolRequest.CltUseDataRpt(0,game.settingFuncType.systenNotice,o);this.updateRedPoint()};t.prototype.hasRedSubTime=function(){if(this.noticeList&&this.noticeList.length>0){var t=this.noticeList[0];var e=void 0;var i=app.SDK.userData;if(!i){e=game.Context.getServerTime()}else{e=i.time}var n=parseInt(t.time)-e+util.TimeUtil.secOneDay;if(n>0){var a=n/util.TimeUtil.secOneDay;if(a>1){return-1}}return n}return-1};return t}();o.SystemNoticeModel=e;var a=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this)};e.prototype.setData=function(t,e,i){this.btnyeqian.label=t.title;this.selected=t.selected;if(i!="login"){if(o.LoginModel.getIns().sysNotice.isRead(parseInt(t.time))){game.RedDotView.removeFrom(this)}else{game.RedDotView.addTo(this,this.width-20)}}};Object.defineProperty(e.prototype,"selected",{set:function(t){this.btnyeqian.selected=t},enumerable:true,configurable:true});return e}(ui.xitonggonggao.xitonggonggaoitemUI);var i=function(){function t(){this.source=""}t.prototype.init=function(t,e,i,n){this.source=n;this.model=o.LoginModel.getIns().sysNotice;this.imgguanggao=i;this.panelgonggao=e;this.listyeqian=t;this.listyeqian.renderHandler=new Laya.Handler(this,this.onRenderHandelr);this.listyeqian.selectEnable=true;this.listyeqian.selectHandler=new Laya.Handler(this,this.onSelectHandler);this.listyeqian.itemRender=a;this._lblDes=game.MenuHelper.initDesc("",this.panelgonggao.width);this._lblDes.color="#9e905f";this._lblDes.mouseEnabled=true;this._lblDes.bold=false;this._lineSprite=new Laya.Sprite;this._centerDes=game.MenuHelper.initDesc("",this.panelgonggao.width);this._centerDes.color="#9e905f";this._centerDes.style.align="center";this._centerDes.mouseEnabled=true;this._centerDes.valign="center";this._lblDes.on(Laya.Event.LINK,this,this.onLinkHandler);this.panelgonggao.addChild(this._lblDes);this.panelgonggao.addChild(this._lineSprite);this.imgguanggao.on(Laya.Event.MOUSE_UP,this,this.onCloseHandler)};t.prototype.onCloseHandler=function(){};t.prototype.onLinkHandler=function(t){if(t!=""){app.SDK.openLink(t)}};t.prototype.onRenderHandelr=function(t,e){t.setData(t.dataSource,e,this.source)};t.prototype.onSelectHandler=function(t){if(o.LoginModel.getIns().sysNotice.noticeList&&o.LoginModel.getIns().sysNotice.noticeList.length>0){var e=o.LoginModel.getIns().sysNotice.noticeList.length;for(var i=0;i<e;i++){o.LoginModel.getIns().sysNotice.noticeList[i].selected=t==i}this.listyeqian.array=o.LoginModel.getIns().sysNotice.noticeList;var n=o.LoginModel.getIns().sysNotice.noticeList[t];if(this.source!="login"){if(this.model.closeUIList.indexOf(parseInt(n.time))==-1){this.model.closeUIList.push(parseInt(n.time))}if(this.oldTime!=undefined){this.model.setRead(this.oldTime)}this.oldTime=parseInt(n.time)}var a=n.url.split("?");if(window["appConfig"]&&window["appConfig"]["placard_content"]){a[0]=window["appConfig"]["placard_content"]}if(a.length>=2){app.Http.request(a[0],this,this.onContentHandler,a[1],"post","json")}}};t.prototype.refreshScrollBar=function(){this.panelgonggao.vScrollBar.stopScroll();this.panelgonggao.vScrollBar.value=0};t.prototype.convertStr=function(t){t=t.replace(/<center>/g,"");t=t.replace(/<\/center>/g,"");return t};t.prototype.onContentHandler=function(t){if(t.code==1){var e=t.data;var i=new n(e.content);if(i.centerHtml){this._centerDes.innerHTML=this.convertStr(i.centerHtml);this._centerDes.y=this._centerDes.contextHeight;this.panelgonggao.addChild(this._centerDes);this._lblDes.y=this._centerDes.y+this._centerDes.height}else{this._lblDes.y=20;this._centerDes.removeSelf()}this._lblDes.innerHTML=this.convertStr(i.html);i.draw(this._lineSprite);this.panelgonggao.refresh();this.imgguanggao.skin="res/static/xitonggonggao/"+e.banner+".png";this.refreshScrollBar()}else{}};return t}();var s=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.system=new i;this.system.init(this.listyeqian,this.panelgonggao,this.imgguanggao,"");this.model=o.LoginModel.getIns().sysNotice;this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){guide.GuideModel.getIns().boOpen=false;this.callLater(this.onCallLater)};e.prototype.onUnDisplay=function(){guide.GuideModel.getIns().boOpen=true;if(this.model.closeUIList){while(this.model.closeUIList.length){var t=this.model.closeUIList.pop();this.model.setRead(t)}this.model.updateRedPoint()}};e.prototype.onCallLater=function(){this.listyeqian.array=o.LoginModel.getIns().sysNotice.noticeList||[];this.listyeqian.selectedIndex=0};e.SINGLE_KEY="login.SystemNoticeNewView";return e}(ui.xitonggonggao.xitonggonggaoviewnewUI);o.SystemNoticeNewView=s;var r=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.system=new i;this.system.init(this.listyeqian,this.panelgonggao,this.imgguanggao,"login");this.bg=new Laya.Sprite;this.bg.mouseEnabled=true;this.bg.on(Laya.Event.CLICK,this,this.closeView);this.btnclose01.mouseEnabled=false;this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.btnshouqi.clickHandler=new Laya.Handler(this,this.closeView);this.gou.visible=false;this.tanchu.visible=false};e.prototype.closeView=function(){this.removeSelf();this.bg.removeSelf()};e.prototype.onDisplay=function(){if(app.ViewManager.DisplayedInStage(o.LoginMainView.SINGLE_KEY)){this.oldName=o.LoginMainView.getIns().wenben.text;o.LoginMainView.getIns().wenben.focus=null}guide.GuideModel.getIns().boOpen=false;app.SoundManager.getIns().playSound("functionopen");this.callLater(this.onCallLater)};e.prototype.onCallLater=function(){this.x=(Laya.stage.width-this.width)/2;this.y=(Laya.stage.height-this.height)/2;this.bg.graphics.clear();this.bg.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000000");this.bg.alpha=.6;this.bg.hitArea=new Laya.Rectangle(0,0,Laya.stage.width,Laya.stage.height);this.parent.addChildAt(this.bg,0);this.listyeqian.array=o.LoginModel.getIns().sysNotice.noticeList||[];this.listyeqian.selectedIndex=0};e.prototype.onUnDisplay=function(){guide.GuideModel.getIns().boOpen=true;app.SoundManager.getIns().playSound("functionclose");if(app.ViewManager.DisplayedInStage(o.LoginMainView.SINGLE_KEY)){o.LoginMainView.getIns().wenben.text=this.oldName||""}};e.SINGLE_KEY="login.SystemNoticeView";return e}(ui.xitonggonggao.xitonggonggaoviewUI);o.SystemNoticeView=r})(login||(login={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(l){var t=function(e){__extends(r,e);function r(){var t=e!==null&&e.apply(this,arguments)||this;t._BlessonBuffTips=false;return t}r.prototype.init=function(){game.Context.on(game.ContextEvent.CHANGE_MAP,this,this.onMapChange);game.RoleModel.getIns().on(game.RoleModel.EVENTS.PLAYER_BUFF_CHANGE,this,this.onPlayerBuffChange);game.RoleModel.getIns().on(game.RoleModel.EVENTS.TEAM_LEVEL_CHANGE,this,this.onLevelChange);game.RoleModel.getIns().on(game.RoleModel.EVENTS.PLAYER_NUM_MODIFY,this,this.onLevelChange);csv.FunctionsProxy.getIns().on(csv.FunctionsProxy.EVENTS.ADD,this,this.onFuncOpen);app.ViewManager.regist(l.MainBottomView);app.ViewManager.regist(l.RightIconList,"bosszhandou.atlas","jijiangkaiqi.atlas");app.ViewManager.regist(l.TaskMainEnterView,"zhuxianrenwu.atlas");app.ViewManager.regist(l.FuncOpenView,"main.atlas");app.ViewManager.regist(l.FunctionGuideMainView,"youjian.atlas","jijiangkaiqi.atlas");app.ViewManager.regist(l.FunctionGuideView,"jijiangkaiqi.atlas");app.ViewManager.regist(l.GuajiEnterView);app.ViewManager.regist(l.BlessonBuffTips,"zengyi.atlas");app.ViewManager.regist(l.MapLoadView,"guochangdonghua.atlas");app.ViewManager.regist(l.ModuleLoadView,"guochangdonghua.atlas");app.ViewManager.regist(l.RoleInfoView);app.ViewManager.regist(l.ScoreFlowView,"zhanli.atlas","effect/skill_zhanlizhihuoyan01.atlas");app.ViewManager.regist(l.RoleUnlockBarView,"main.atlas");app.ViewManager.regist(upgrade.UpgradeGuildeView,"woyaobianqiang.atlas");app.ViewManager.regist(l.FunProgressView,"jindu.atlas");game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.BROTHER,role.RoleChooseView,null,6);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.ROLE_BUFF_VIEW,l.RoleBuffView);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.LEAD_STRONGER,upgrade.UpgradeGuildeView,null,0,"",[]);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.LEAD_UPGRADE,upgrade.UpgradeGuildeView,null,0,"",[]);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.HINT_VIEW,l.HintUIView,new Laya.Handler(this,this.onShowHintView));game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.SETTING_VIEW,game.SettingView);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.PublicNotice,login.SystemNoticeNewView);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.REDPACK_GET_GUILD,guild.GuildRedPackGetView,new Laya.Handler(this,this.onShowRedPackGetView,[1]));game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.REDPACK_GET_ROLE,guild.GuildRedPackGetView,new Laya.Handler(this,this.onShowRedPackGetView,[3]));game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.REDPACK_GET_SYS,guild.GuildRedPackGetView,new Laya.Handler(this,this.onShowRedPackGetView,[2]));game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.JI_JIANG_KAI_QI,l.FunctionGuideMainView,new Laya.Handler(this,this.onOpenJijiangkaiqiView));game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.FUNPROGRESS,l.FunProgressTips,null,4);l.MainUIIcon.iconClassMap[csv.MainIconProxy.TYPE_ICON_HULUWA]=l.HuLuXiongDiIcon;l.MainUIIcon.iconClassMap[csv.MainIconProxy.TYPE_ICON_REDPACK_GUILD]=l.RedPackIcon;l.MainUIIcon.iconClassMap[csv.MainIconProxy.TYPE_ICON_REDPACK_ROLE]=l.RedPackIcon;l.MainUIIcon.iconClassMap[csv.MainIconProxy.TYPE_ICON_REDPACK_SYS]=l.RedPackIcon;l.MainUIIcon.iconClassMap[csv.MainIconProxy.TYPE_ICON_BOSS]=l.BossWorldIcon;l.MainUIIcon.iconClassMap[csv.MainIconProxy.GUILD_PK]=l.GuildPkUIIcon;l.MainUIIcon.iconClassMap[csv.MainIconProxy.HAOYOU]=l.HaoYouIcon;l.MainUIIcon.iconClassMap[csv.MainIconProxy.SETTING]=l.SettingIcon;l.MainUIIcon.iconClassMap[csv.MainIconProxy.FUNPROGRESS]=l.FunProgressIcon;this.mapControls=[l.MapHomeControl.getIns(),l.MapGuajiControl.getIns(),l.MapBossWorldControl.getIns(),l.MapBossWorldOutControl.getIns(),l.MapSsslControl.getIns(),l.MapZhuxianControl.getIns(),l.MapMountainControl.getIns(),l.MapArenaControl.getIns(),l.MapPvpControl.getIns(),l.MapJjcControl.getIns(),l.MapPvpHomeControl.getIns(),l.MapHuluDefendControl.getIns(),l.MapHideControl.getIns(),l.MapYaoDongControl.getIns(),l.MapSzjdControl.getIns(),l.MapBossKuafuOutControl.getIns(),l.MapBossKuafuControl.getIns(),l.MapPvpGuildControl.getIns(),l.MapGuankaControl.getIns(),l.MapBossCaveDiscoveControl.getIns(),l.MapFuYuanControl.getIns(),l.MapYaowangControl.getIns(),l.MapGuildBossControl.getIns(),l.MapMjLockControl.getIns(),l.MapKfxlPveControl.getIns(),l.MapKfxlPvpControl.getIns()]};r.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.SysMsgStringNtf,this,this.onSysMsgStringNtf);this.addMsgListener(app.ProtocolResponse.FuncOpenNtf,this,this.onFuncOpenNtf);this.addMsgListener(app.ProtocolResponse.AwardFuncOpenAck,this,this.onAwardFuncOpenAck);this.addMsgListener(app.ProtocolResponse.UseExpAck,this,this.onUseExpAck);this.addMsgListener(app.ProtocolResponse.SaveSettingsNoti,this,this.onSaveSettingsNoti);this.addMsgListener(app.ProtocolResponse.SaveSettingsAck,this,this.onSaveSettingsAck);this.addMsgListener(app.ProtocolResponse.CltUseDataNtf,this,this.onCltUseDataNtf)};r.prototype.onCltUseDataNtf=function(t,e){if(e.type==game.settingFuncType.systenNotice){login.LoginModel.getIns().sysNotice.readList=e.data;login.LoginModel.getIns().sysNotice.updateRedPoint()}game.SystemSetModel.getInstance().updateFuncSaveData(e)};r.prototype.onSaveSettingsAck=function(t,e){};r.prototype.onSaveSettingsNoti=function(t,e){game.SystemSetModel.getInstance().settingListUpdate(e.settingList,e.actList,e.actList2);newshangcheng.NewShangChengModel.getIns().checkHuoDong();newshangcheng.ActivityTipModel.getIns().onSaveSettingsNoti(e.actList2);dailytask.DailyTaskModel.getIns().addDailyShowRed()};r.prototype.onSysMsgStringNtf=function(t,e){manager.FlowManager.instance.flowByStyle1(e.msgString,null,game.STYLES.RED_COLOR);game.Context.event(game.SceneModel.EVENT_ERROR_TIP,e.msg)};r.prototype.onUseExpAck=function(t,e){if(e.ret==1){game.RoleModel.getIns().event(game.RoleModel.EVENTS.USEEXP_RESULT_UPDATE)}};r.prototype.onMapChange=function(){game.Context.event(game.ContextEvent.MAP_CHANGE_END_FOR_DIALOG_SHOW);var t=csv.MapProxy.getIns().getMapType(game.Context.mainRole.mapId);var e;for(var i=0,n=this.mapControls.length;i<n;i++){var a=this.mapControls[i];if(a.maptype==t){if(a.battletype){var o=battle.BattleModel.getIns().battleType;if(a.battletype==o){e=a;break}}else{e=a;break}}}if(this.currControl){if(this.currControl==e){return}else{this.currControl.hideUi()}}Laya.SoundManager.stopAll();var s=this.currControl;this.currControl=e;this.currControl.showUi();this.currControl.playBgm();battle.BattleManager.getIns().currControl=this.currControl;if(s){s.onCallFunc()}this.checkStateBuff();Laya.loader.load(r.ENTER_LOAD_URLS);l.FuncOpenView.onshowFuncOpenView()};r.prototype.onPlayerBuffChange=function(){this.checkStateBuff()};r.prototype.onLevelChange=function(){l.FunctionGuideModel.getInstance().onFunctionOpen()};r.prototype.checkStateBuff=function(){if(game.Context.mainRole&&game.Context.mainRole.mapId>0){var t=csv.MapProxy.getIns().getMapBlesson(game.Context.mainRole.mapId);var e=csv.MapProxy.getIns().getQuickbattlebuff(game.Context.mainRole.mapId);var i=false;for(var n=0,a=game.RoleModel.getIns().bless;n<a.length;n++){var o=a[n];for(var s in o.sid){if(o.sid[s]){i=true;break}}if(i){break}}if(i&&!this._BlessonBuffTips){app.ViewManager.toggleDialog(l.BlessonBuffTips,1,0);this._BlessonBuffTips=true}var r=game.RoleModel.getIns().hasQuickbattlebuff()?true:false;if(t&&i||e&&r){if(app.ViewManager.DisplayedInStage(l.StatusBuffView.SINGLE_KEY)){l.StatusBuffView.getIns().onBuffChange()}else{app.ViewManager.toggleView(l.StatusBuffView,app.AppContainer.uiLayer,1)}}else{app.ViewManager.toggleView(l.StatusBuffView,app.AppContainer.uiLayer,-1)}}};r.prototype.onFuncOpenNtf=function(t,e){l.FunctionGuideModel.getInstance().onSetStateComplete(e.fopen)};r.prototype.onAwardFuncOpenAck=function(t,e){};r.prototype.onFuncOpen=function(t){if(parseInt(t.maindlg)){if(t.id==csv.FunctionsProxy.ENUMS.HLXD_JINGYING){return}if(t.id==csv.FunctionsProxy.ENUMS.ZAIXIAN_JIANGLI){app.ProtocolRequest.GetActMainPanelReq(2)}}};r.prototype.onShowHintView=function(){l.HintUIView.getIns().callFunction()};r.prototype.onOpenJijiangkaiqiView=function(){app.ViewManager.toggleDialog(l.FunctionGuideMainView,1,0)};r.prototype.onShowRedPackGetView=function(t){app.ViewManager.toggleDialog(guild.RedPackView,1,0)};r.SINGLE_KEY="mainui.MainUIModule";r.ENTER_LOAD_URLS=["res/atlas/guochangdonghua.atlas"];return r}(app.ModuleBase);l.MainUIModule=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(a){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.on(Laya.Event.CLICK,this,this.onShowView);this.flag=false};e.prototype.onResize=function(){this.x=app.AppContainer.UI_LAYER_GAP.LEFT_ICON;this.y=Laya.stage.height-a.MainBottomView.HEIGHT-chat.ChatMiniView.HEIGHT-this.height-ScreenAdapter.OFFSET_BOTTOM};e.prototype.onShowView=function(){var t=game.Context.roleList.length+1;var e=csv.DefclassProxy.getIns().getCfgCreate(t);var i=csv.DefclassProxy.getIns().gethlxdCfg(dailytask.DailyTaskModel.getIns().aid+1);if(e){if(dailytask.DailyTaskModel.getIns().taskMainId<e.value){game.RedDotView.removeFrom(this)}}else if(i){if(dailytask.DailyTaskModel.getIns().taskMainId<i.need){game.RedDotView.removeFrom(this)}}game.RoleModel.getIns().onShowRoleUnlockView()};e.prototype.onDisplay=function(){game.RoleModel.getIns().on(game.RoleModel.EVENTS.PLAYER_NUM_MODIFY,this,this.refreshAll);dailytask.DailyTaskModel.getIns().on(dailytask.DailyTaskModel.TASK_MAIN_ID_CHANGE,this,this.refreshAll);dailytask.DailyTaskModel.getIns().on(dailytask.DailyTaskModel.DAILY_ACT_TOWER_AWARD_UPDATE,this,this.refreshAll);this.animationtishi03.visible=true;this.animationtishi03.play();this.onResize();this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){game.RoleModel.getIns().off(game.RoleModel.EVENTS.PLAYER_NUM_MODIFY,this,this.refreshAll);dailytask.DailyTaskModel.getIns().off(dailytask.DailyTaskModel.TASK_MAIN_ID_CHANGE,this,this.refreshAll);dailytask.DailyTaskModel.getIns().off(dailytask.DailyTaskModel.DAILY_ACT_TOWER_AWARD_UPDATE,this,this.refreshAll)};e.prototype.refreshAll=function(){var t=game.Context.roleList.length+1;var e=csv.DefclassProxy.getIns().getCfgCreate(t);var i=csv.FunctionsProxy.getIns().isOpen(csv.FunctionsProxy.ENUMS.HuluBrother);if(this.flag){game.RedDotView.removeFrom(this)}else{game.RedDotView.addTo(this)}if(i){if(e){this.imgbiaoyu.skin="res/static/main/bg_jiesuo_miaoshu0"+t+".png";if(this.flag&&dailytask.DailyTaskModel.getIns().taskMainId>=e.value){game.RedDotView.addTo(this)}}else{var n=csv.DefclassProxy.getIns().gethlxdCfg(dailytask.DailyTaskModel.getIns().aid+1);if(n){this.imgbiaoyu.skin="res/static/main/"+n.word+".png";if(this.flag&&dailytask.DailyTaskModel.getIns().taskMainId>=n.need){game.RedDotView.addTo(this)}}else{app.ViewManager.toggleView(a.RoleUnlockBarView,app.AppContainer.uiBottomLayer,-1);app.ViewManager.toggleView(a.TaskMainEnterView,app.AppContainer.uiLayer,1)}}}else{app.ViewManager.toggleView(a.RoleUnlockBarView,app.AppContainer.uiBottomLayer,-1)}this.flag=true};e.SINGLE_KEY="main.RoleUnlockBarView";return e}(ui.main.mainjiesuoUI);a.RoleUnlockBarView=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.beishubtn.on(Laya.Event.CLICK,this,this.onClick);this.okHandler=new Laya.Handler(this,this.onOk);this.x=Laya.stage.width-this.width-10;this.y=Laya.stage.height-i.MainBottomView.HEIGHT-chat.ChatMiniView.HEIGHT-ScreenAdapter.OFFSET_BOTTOM-260;this.beishubtn.skin="bosszhandou/btn_tiaoguo.png";this.effect=new Laya.Animation;this.effect.interval=100;this.effect.x=-7;this.effect.y=-12;this.effect.loadAtlas("res/atlas/effect/main/skill_UI_kuang2.atlas");this.effect.scale(.8,.8);this.beishubtn.addChild(this.effect)};e.prototype.onOk=function(){game.ClosureManager.callFunction(csv.FunctionsProxy.ENUMS.VIP)};e.prototype.onClick=function(){var t=csv.VipProxy.getIns().getVipPri(csv.PRI_TYPE.BATTLE_PASS,vipcode.VipModel.getIns().vipLvl);var e=game.Context.teamLv>=game.Config.getIntParams(2017);if(t||e){battle.BattleManager.getIns().currControl.stopGame();return}game.Alert.show(app.getLang("fight_speed4"),this.okHandler,null,0,"","fullScreen","center","center",0,"","button_name8")};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){this.effect.stop()};e.prototype.refreshAll=function(){if(game.Context.disableIosRecharge()){this.visible=false}else if(dailytask.DailyTaskModel.getIns().taskMainId<game.SystemSetModel.battlePassOpenId){this.visible=false}else{this.visible=true;this.effect.play()}};e.SINGLE_KEY="main.BattlePassView";return e}(ui.bosszhandou.beishubtnUI);i.BattlePassView=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(i){var t=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.beishubtn.on(Laya.Event.CLICK,this,this.onClick);this.okHandler=new Laya.Handler(this,this.onOk);this.x=Laya.stage.width-this.width-10;this.y=Laya.stage.height-i.MainBottomView.HEIGHT-chat.ChatMiniView.HEIGHT-ScreenAdapter.OFFSET_BOTTOM-340;var t=app.str2Array(game.Config.getParams(1265),"-");game.SystemSetModel.battleSpeedOpenId=parseInt(t[0]);game.SystemSetModel.battlePassOpenId=parseInt(t[1])};t.prototype.onOk=function(){game.ClosureManager.callFunction(csv.FunctionsProxy.ENUMS.VIP)};t.prototype.onClick=function(){var t=csv.VipProxy.getIns().getVipPri(csv.PRI_TYPE.BATTLE_SPEED,vipcode.VipModel.getIns().vipLvl);if(!t){game.Alert.show(app.getLang("fight_speed1"),this.okHandler,null,0,"","fullScreen","center","center",0,"","button_name8");return}var e=game.SystemSetModel.getInstance().settingData.getValueByType(game.SettingType.battleSpeed);var i;if(e.value==1){e.value=2;i=1.5}else{e.value=1;i=1}this.beishubtn.skin="bosszhandou/btn_beishu_"+e.value+".png";game.SystemSetModel.getInstance().setValueByType(e.value,game.SettingType.battleSpeed);app.TimerRewriter.battleScale=i};t.prototype.showGuide=function(t,e){var i=this;var n=this.beishubtn.parent.localToGlobal(new Laya.Point(this.beishubtn.x,this.beishubtn.y));guide.GuideBubbleItem2.getIns().jumpHandler=e;guide.GuideBubbleItem2.getIns().add(app.getLang("yindao_text5"),n.x,n.y,this.width,this.height,1,Laya.Handler.create(this,function(){i.onClick();t.run()}))};t.prototype.onDisplay=function(){this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){app.TimerRewriter.battleScale=1};t.prototype.refreshAll=function(){if(game.Context.disableIosRecharge()){this.visible=false}else if(dailytask.DailyTaskModel.getIns().taskMainId<game.SystemSetModel.battleSpeedOpenId){this.visible=false}else{this.visible=true;var t=game.SystemSetModel.getInstance().settingData.getValueByType(game.SettingType.battleSpeed);var e=void 0;if(t.value==1){t.value=1;e=1}else{t.value=2;e=1.5}this.beishubtn.skin="bosszhandou/btn_beishu_"+t.value+".png";app.TimerRewriter.battleScale=e}};t.SINGLE_KEY="main.BattleSpeedView";return t}(ui.bosszhandou.beishubtnUI);i.BattleSpeedView=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.tuichubtn.on(Laya.Event.CLICK,this,this.onClick)};e.prototype.onClick=function(){role.LeadingRoleView.getIns().cancelAI();switch(battle.BattleModel.getIns().battleType){case battle.BattleConst.BATTLE_TYPE.DUNGEON_MJG:case battle.BattleConst.BATTLE_TYPE.ZHUXIAN:case battle.BattleConst.BATTLE_TYPE.DUNGEON_MOUNTAIN:case battle.BattleConst.BATTLE_TYPE.DUNGEON_NINE_TOWER:case battle.BattleConst.BATTLE_TYPE.PET_DUNGEON:case battle.BattleConst.BATTLE_TYPE.BOSS_CAVE:case battle.BattleConst.BATTLE_TYPE.GUANKA_PASS:case battle.BattleConst.BATTLE_TYPE.MJ_LOCK:app.ProtocolRequest.LeaveDailyDgnReq();break;case battle.BattleConst.BATTLE_TYPE.DUNGEON_SSSL:game.Alert.show(app.getLang("shanshen_tips4"),Laya.Handler.create(this,this.onOk),new Laya.Handler);break;case battle.BattleConst.BATTLE_TYPE.DUNGEON_SZJD:game.Alert.show(app.getLang("shanzhong_tips4"),Laya.Handler.create(this,this.onOk),new Laya.Handler);break;case battle.BattleConst.BATTLE_TYPE.BRAVE_CHALLENGE:battle.BattleAutoKey.clearAuto(battle.BattleAutoKey.AUTO.BRAVE_CHALLENGE_BATTLE);app.ProtocolRequest.LeaveDailyDgnReq();break;case battle.BattleConst.BATTLE_TYPE.ELITE_CHALLENGE:battle.BattleAutoKey.clearAuto(battle.BattleAutoKey.AUTO.ELITE_CHALLENGE_BATTLE);app.ProtocolRequest.LeaveDailyDgnReq();break;case battle.BattleConst.BATTLE_TYPE.TRANS:app.ProtocolRequest.LeaveTeamDgnReq();break;case battle.BattleConst.BATTLE_TYPE.YAODONG:game.Alert.show(app.getLang("endless_2"),Laya.Handler.create(this,this.onOk));break;case battle.BattleConst.BATTLE_TYPE.DUNGEON_ZJQW:game.Alert.show(app.getLang("zjqw_exit"),Laya.Handler.create(this,this.onOk),new Laya.Handler);break;case battle.BattleConst.BATTLE_TYPE.BOSS_YEWAI:case battle.BattleConst.BATTLE_TYPE.BOSS_WORLD:game.Alert.show(app.getLang("bosskingtips_1"),Laya.Handler.create(this,this.onOk),new Laya.Handler);break;case battle.BattleConst.BATTLE_TYPE.KFXL_PVE:case battle.BattleConst.BATTLE_TYPE.KFXL_PVP:yuanshencode.KuafuXiulianModel.getIns().selfExit=1;app.ProtocolRequest.BattleEscapeRpt(battle.BattleModel.getIns().battleid);break;default:app.ProtocolRequest.LeaveBossReq()}};e.prototype.onOk=function(){switch(battle.BattleModel.getIns().battleType){case battle.BattleConst.BATTLE_TYPE.DUNGEON_SSSL:case battle.BattleConst.BATTLE_TYPE.DUNGEON_SZJD:case battle.BattleConst.BATTLE_TYPE.DUNGEON_ZJQW:app.ProtocolRequest.LeaveDailyDgnReq();break;case battle.BattleConst.BATTLE_TYPE.YAODONG:app.ProtocolRequest.LeaveTeamDgnReq();break;default:app.ProtocolRequest.LeaveBossReq()}};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){var t=ScreenAdapter.OFFSET_Y;switch(battle.BattleModel.getIns().battleType){case battle.BattleConst.BATTLE_TYPE.BOSS_WORLD:case battle.BattleConst.BATTLE_TYPE.DEFEND_HULU:case battle.BattleConst.BATTLE_TYPE.YAODONG:case battle.BattleConst.BATTLE_TYPE.BOSS_YEWAI:case battle.BattleConst.BATTLE_TYPE.GUILD_BOSS:case battle.BattleConst.BATTLE_TYPE.DUNGEON_SSSL:case battle.BattleConst.BATTLE_TYPE.DUNGEON_SZJD:this.x=Laya.stage.width-this.width-240;this.y=60+t;break;default:this.x=Laya.stage.width-this.width-10;this.y=60+t}};e.SINGLE_KEY="main.BossExitView";return e}(ui.bosszhandou.tuichubtnUI);t.BossExitView=e})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.img=new Laya.Button;this.img.skin="res/static/jingjichang/btn_tiaoguo.png";this.img.clickHandler=new Laya.Handler(this,this.onClickHandler);this.addChild(this.img);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onClickHandler=function(){battle.BattleManager.getIns().currControl.stopGame()};e.prototype.onDisplay=function(){this.onResize()};e.prototype.onUnDisplay=function(){};e.prototype.onResize=function(){var t=10;this.x=Laya.stage.width-144;this.y=Laya.stage.height-133-t-ScreenAdapter.OFFSET_BOTTOM};e.SINGLE_KEY="main.ExitBottomView";return e}(View);t.ExitBottomView=e})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.funIds=[]};e.prototype.callFunction=function(){if(this.funIds.length>0){var t=this.funIds.pop();game.ClosureManager.callFunction(t,true,true)}if(this.funIds.length==0){i.HintIconList.getIns().updateView()}};e.prototype.addHintMsg=function(t){if(this.funIds.indexOf(t)==-1){this.funIds.push(t)}i.HintIconList.getIns().updateView()};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.SINGLE_KEY="main.HintUIView";return e}(ui.main.maintishiUI);i.HintUIView=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(i){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.cd=0;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.zOrder=app.AppContainer.UI_LAYER_NUME.BOTTOMAIN;this.width=Laya.stage.width;this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.boxTips.visible=false;this.btnjiayuan.on(Laya.Event.CLICK,this,this.onJiayuanClick);this.zhandoubox.on(Laya.Event.CLICK,this,this.onGuajiClick);guide.GuideModel.getIns().register(csv.GuideProxy.ENUM_VIEW.GUAJI_BATTLE,this.zhandoubox);guide.GuideModel.getIns().register(csv.GuideProxy.ENUM_VIEW.HOME,this.btnjiayuan)};t.prototype.checkClickTime=function(){if(Laya.timer.currTimer-this.cd>1e3){this.cd=Laya.timer.currTimer;return true}return false};t.prototype.onJiayuanClick=function(t){t.stopPropagation();if(this.checkClickTime()){if(battle.BattleModel.getIns().checkBattleState(true)){return}app.ProtocolRequest.TeleportReq(1)}};t.prototype.onGuajiClick=function(t){t.stopPropagation();if(this.checkClickTime()){if(battle.BattleModel.getIns().checkBattleState(true)){return}var e=csv.MapProxy.getIns().getMapType(game.Context.mainRole.mapId);if(e==csv.MapProxy.MAP_TYPE.HOME){if(csv.FunctionsProxy.getIns().isOpen(csv.FunctionsProxy.ENUMS.PASS,true)){guaji.GuajiModel.getIns().changeMap()}}}};t.prototype.checkTipsGuaji=function(){var t=csv.MapProxy.getIns().getMapType(game.Context.mainRole.mapId);if(t==csv.MapProxy.MAP_TYPE.HOME&&guajiexp.GuajiExpModel.getIns().state==4){this.boxTips.visible=true;this.animationshouyi.play(0,true)}else{this.boxTips.visible=false;this.animationshouyi.stop()}};t.prototype.onDisplay=function(){game.Context.on(game.ContextEvent.CHANGE_MAP,this,this.updateLayout);this.callLater(this.updateLayout);this.onStageResize();Laya.stage.on(Laya.Event.RESIZE,this,this.onStageResize);app.ViewManager.toggleView(i.MainLeftIconList,this,1);app.ViewManager.toggleView(i.MainRightIconList,this,1)};t.prototype.onUnDisplay=function(){game.Context.off(game.ContextEvent.CHANGE_MAP,this,this.updateLayout);Laya.stage.off(Laya.Event.RESIZE,this,this.onStageResize);app.ViewManager.toggleView(i.MainLeftIconList,this,-1);app.ViewManager.toggleView(i.MainRightIconList,this,-1);this.animationshouyi.stop()};t.prototype.updateLayout=function(){var t=csv.MapProxy.getIns().getMapType(game.Context.mainRole.mapId);if(t==csv.MapProxy.MAP_TYPE.GUAJI){this.btnjiayuan.visible=true;this.zhandoubox.visible=false;this.zhandouani.stop()}else{this.btnjiayuan.visible=false;this.zhandoubox.visible=true;this.zhandouani.play(0,true)}if(!csv.FunctionsProxy.getIns().isOpen(csv.FunctionsProxy.ENUMS.PASS)){this.zhandouani.visible=false;i.LockIcon.addTo(this.zhandoubox)}else{this.zhandouani.visible=true}this.checkTipsGuaji()};t.prototype.onStageResize=function(){this.y=Laya.stage.height-this.height-ScreenAdapter.OFFSET_BOTTOM};t.getZhandou=function(){if(app.ViewManager.DisplayedInStage(i.MainBottomView.SINGLE_KEY)){return i.MainBottomView.getIns().zhandoubox}return null};t.getZhandouPoint=function(){if(app.ViewManager.DisplayedInStage(i.MainBottomView.SINGLE_KEY)){var t=i.MainBottomView.getIns().zhandoubox;return t.parent.localToGlobal(new Laya.Point(t.x+t.width/2,t.y+t.height/2))}return new Laya.Point(Laya.stage.width,Laya.stage.height)};t.SINGLE_KEY="main.MainBottomView";t.HEIGHT=146;t.HEIGHT2=136;t.KONGBAI_H=30;t.CENTER_ICON=125;return t}(ui.main.maingongnengUI);i.MainBottomView=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.onClick=function(){var t=+game.Config.getParams(551).split("-")[1];if(boss.BossModelIce.getIns().iceValueNum&&boss.BossModelIce.getIns().iceValueNum>=+t){role.LeadingRoleView.getIns().cancelAI();app.ProtocolRequest.LeaveBossMapReq()}else{app.ViewManager.toggleDialog(boss.BossWorldIceExitTipView,1,0,new Laya.Handler(this,this.leaveBossHandler))}};e.prototype.leaveBossHandler=function(){role.LeadingRoleView.getIns().cancelAI();app.ProtocolRequest.LeaveBossMapReq()};e.SINGLE_KEY="main.MapExitBossIceView";return e}(t.MapExitView);t.MapExitBossIceView=e})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(n){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.items=[];this.btnshiyong.clickHandler=new Laya.Handler(this,this.onUseItem);this.btnclose.clickHandler=new Laya.Handler(this,this.onClose)};e.prototype.onResize=function(){this.x=(Laya.stage.width-this.width)/2;this.y=Laya.stage.height-this.height-e.OFFSET_Y};e.prototype.onClose=function(){this.items.shift();if(this.items.length==0){app.ViewManager.toggleView(n.NewItemView,app.AppContainer.uiLayer,-1)}else{this.refreshAll()}};e.prototype.onChangeItem=function(t,e){if(e&&this.items.length>0){for(var i=0;i<this.items.length;i++){var n=this.items[i].data.getInstId();if(Uint64.equal(e.getInstId(),n)){var a=game.GridsModel.getIns().getVOByInsId(n);if(a&&a.count>0){this.refreshAll()}else{this.items.splice(i,1);this.refreshAll()}break}}}};e.prototype.onUseItem=function(){var t=this.items.shift();if(t){var e=game.GridsModel.getIns().getVOByInsId(t.data.getInstId());var i=t.count<e.count?t.count:e.count;if(i>1){if(e.getBatchuse()){if(parseInt(e.itemCfg.type)==csv.ItemProxy.TYPES.LIBAO&&parseInt(e.itemCfg.subtype)==2){app.ViewManager.toggleDialog(items.ItemChooseView,1,0,[e,i])}else{game.ItemUtil.use(e,Uint64.ZERO,i)}}else{manager.FlowManager.instance.flowByStyle1(app.getLang("不支持批量使用"))}}else{game.ItemUtil.use(e)}manager.ItemFlyManager.playExpFly(e,this.itemdaoju)}if(this.items.length==0){app.ViewManager.toggleView(n.NewItemView,app.AppContainer.uiLayer,-1)}else{this.refreshAll()}};e.prototype.addNewItemListView=function(t,e){var i=[];if(t.length>0&&e.length>0){t.sort(this.sortByQua);i=i.concat(t);i=i.concat(e)}else if(t.length>0){t.sort(this.sortByQua);i=t}else if(e.length>0){i=e}app.ViewManager.toggleDialog(items.ItemGettedView,1,0,i)};e.prototype.sortByQua=function(t,e){var i=csv.ItemProxy.getIns().getItemCfgById(t.itemId).qua;var n=csv.ItemProxy.getIns().getItemCfgById(e.itemId).qua;if(i>n)return-1;if(i<n)return 1;return 0};e.prototype.addNewItemView=function(t,e,i){if(i===void 0){i=false}if(i){this.mergeItem(t,e,i);this.merge(t)}else{this.items.push({data:t,count:e,merge:i});this.show()}};e.prototype.merge=function(t){if(this.canShow()){if(!app.ViewManager.DisplayedInStage(n.NewItemView.SINGLE_KEY)){app.ViewManager.toggleView(n.NewItemView,app.AppContainer.uiLayer,1)}else{this.onChangeItem(game.GridsModel.BAG_ITEM,t)}}else{game.Context.on(game.ContextEvent.CHANGE_MAP,this,this.onMapChange);app.ViewManager.toggleView(n.NewItemView,app.AppContainer.uiLayer,-1)}};e.prototype.mergeItem=function(t,e,i){var n=0;var a=0;for(var o=0;o<this.items.length;o++){var s=this.items[o].data.itemCfg.stack;var r=this.items[o].count;if(this.items[o].data.getItemId()==t.getItemId()){if(s>0&&r<s){if(e+r>s){a=s;n=a-s;this.items[o].count=a}else{a=e+r;this.items[o].count=a}break}}}if(n>0){this.mergeItem(t,n,i)}else if(a==0){this.items.push({data:t,count:e,merge:i})}};e.prototype.onMapChange=function(){game.Context.off(game.ContextEvent.CHANGE_MAP,this,this.onMapChange);this.show()};e.prototype.show=function(){if(this.canShow()){if(!app.ViewManager.DisplayedInStage(n.NewItemView.SINGLE_KEY)){app.ViewManager.toggleView(n.NewItemView,app.AppContainer.uiLayer,1)}}else{game.Context.on(game.ContextEvent.CHANGE_MAP,this,this.onMapChange);app.ViewManager.toggleView(n.NewItemView,app.AppContainer.uiLayer,-1)}};e.prototype.canShow=function(){if(game.Context.mainRole){if(csv.MapProxy.isFuncMap()){return true}}return false};e.prototype.onDisplay=function(){this.onResize();game.Context.on(game.ContextEvent.CHANGE_MAP,this,this.show);game.GridsModel.getIns().on(game.GridsModel.EVENTS.ITEM_UPDATE,this,this.onChangeItem);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){game.Context.off(game.ContextEvent.CHANGE_MAP,this,this.show);game.GridsModel.getIns().off(game.GridsModel.EVENTS.ITEM_UPDATE,this,this.onChangeItem)};e.prototype.refreshAll=function(){var t=this.items[0]?this.items[0].data.getInstId():Uint64.ZERO;var e=game.GridsModel.getIns().getVOByInsId(t);if(e&&e.count>0){var i=this.items[0].count;this.itemdaoju.setData(e);this.labelname.text=e.getName();this.labelname.color=game.STYLES.ITEM_QUALITY[e.getQuality()];if(this.items[0].merge){this.itemdaoju.shuzi.text=game.MoneyModel.format(i)}}else{this.onClose()}};e.OFFSET_Y=432;e.SINGLE_KEY="main.NewItemView";return e}(ui.main.daojutixingUI);n.NewItemView=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(i){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.cd=0;t.autoCompleteHandler=new Laya.Handler(t,t.onAutoComplete);t.autoCompleteAndGetHandler=new Laya.Handler(t,t.onAutoGetAndComplete);t._boTween=false;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.on(Laya.Event.CLICK,this,this.onClick);this._model=game.TaskModel.getIns();guide.GuideModel.getIns().register(csv.GuideProxy.ENUM_VIEW.TASK_MAIN_ENTER,this,null,300);this.box.scrollRect=new Laya.Rectangle(0,0,this.box.width,this.box.height);this.animationtishi02.mouseEnabled=false;this.initY=this.labelrenwu01.y;this.zOrder=app.AppContainer.UI_LAYER_NUME.TASK_TIP;var t=app.str2Array(game.Config.getParams(1231),"-");this.miniLv=parseInt(t[0]);this.maxLv=parseInt(t[1])};t.prototype.startGuide=function(){if(!this.currTask){return}if(game.Context.teamLv<this.miniLv||game.Context.teamLv>this.maxLv){return}if(this.currTask.data.questIndex==this.doId&&this.currTask.data.questSate==this.doState){return}if(this.currTask.data.questSate==1&&this.currTask.cfg.wait){Laya.timer.once(this.currTask.cfg.wait*1e3,this,this.addGuide)}else if(this.currTask.data.questSate==2&&this.currTask.cfg.endwait){Laya.timer.once(this.currTask.cfg.endwait*1e3,this,this.addGuide)}};t.prototype.addGuide=function(){if(guide.GuideModel.getIns().hasGuide){this.removeGuide();this.startGuide();return}var t=guide.GuideSz.getIns();if(t.parent){return}t.x=this.width/2;t.y=this.height/2;this.addChild(t)};t.prototype.removeGuide=function(){guide.GuideSz.getIns().removeSelf()};t.prototype.onClick=function(){if(Laya.timer.currTimer-this.cd<500){return}this.cd=Laya.timer.currTimer;if(game.Context.birthing){return}if(!this.currTask){return}this.doId=this.currTask.data.questIndex;this.doState=this.currTask.data.questSate;this.removeGuide();if(this.currTask.data.questSate==4){manager.FlowManager.instance.flowByStyle1(app.getLang("zhuxianrenwu_tishi"));return}if(this.currTask.data.questSate==2){app.ProtocolRequest.TaskSubmit(this.currTask.data.questIndex);return}task.TaskManager.doTask(this.currTask);guide.GuideModel.getIns().event(guide.GuideModel.GUIDE_RESET)};t.prototype.onResize=function(){this.x=app.AppContainer.UI_LAYER_GAP.LEFT_ICON;this.y=Laya.stage.height-i.MainBottomView.HEIGHT-chat.ChatMiniView.HEIGHT-this.height-ScreenAdapter.OFFSET_BOTTOM};t.prototype.onDisplay=function(){this.onResize();game.TaskModel.getIns().on(game.TaskModel.EVENTS.TASK_MAIN_REFRESH,this,this.refreshAll);dailytask.DailyTaskModel.getIns().on(dailytask.DailyTaskModel.TASK_MAIN_ID_CHANGE,this,this.refreshAll);guide.GuideModel.getIns().on(guide.GuideModel.GUIDE_HAS,this,this.startGuide);this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){game.TaskModel.getIns().off(game.TaskModel.EVENTS.TASK_MAIN_REFRESH,this,this.refreshAll);dailytask.DailyTaskModel.getIns().off(dailytask.DailyTaskModel.TASK_MAIN_ID_CHANGE,this,this.refreshAll);guide.GuideModel.getIns().off(guide.GuideModel.GUIDE_HAS,this,this.startGuide);Laya.timer.clear(this,this.addGuide)};t.prototype.refreshAll=function(){var t=this._model.currMainTask;if(t){this.doTalk(t);if(t.data.questSate==2){this.animationtishi02.visible=true;this.animationtishi02.play()}else if(t.data.questSate==4){this.animationtishi02.visible=false;this.animationtishi02.stop()}else{this.animationtishi02.visible=false;this.animationtishi02.stop()}if(!this.currTask){this.currTask=t;this.tweenComplete()}else{if(this.currTask.cfg==t.cfg){this.currTask=t;this.labelrenwu01.text=this.currTask.getMainViewText();if(t.data.questSate==4){this.labelrenwu01.y=9}else{this.labelrenwu01.y=this.initY}}else{if(t.data.questSate==4){this.labelrenwu01.y=9}else{this.labelrenwu01.y=this.initY}this.labelrenwu02.text=t.getMainViewText();this.playTween();this.currTask=t}}if(t.data.questSate==1&&t.cfg.wait){this.startGuide()}else if(t.data.questSate==2&&t.cfg.endwait){this.startGuide()}else{Laya.timer.clear(this,this.addGuide);this.removeGuide()}}else{app.ViewManager.toggleView(i.TaskMainEnterView,app.AppContainer.uiLayer,-1)}};t.prototype.doTalk=function(t){if(t.cfg.story!="0"){talk.TalkModel.getIns().createPlotid(t.cfg.story)}if(t.cfg.done=="4"){game.Context.on(game.ContextEvent.FUNCTION_OPEN,this,this.onFuncOpen)}if(t.data.questSate==1){if(t.cfg.done=="1"){talk.TalkModel.getIns().callBack=task.TaskManager.taskGetHandler}else if(t.cfg.done=="3"){talk.TalkModel.getIns().callBack=this.autoCompleteAndGetHandler}talk.TalkModel.getIns().callData=t;talk.TalkModel.getIns().event(talk.TalkModel.STORY_TIGGER,csv.StoriesProxy.ENUM_TIGGER.TASK_GET)}else if(t.data.questSate==2){if(t.cfg.done=="2"){talk.TalkModel.getIns().callBack=this.autoCompleteHandler}talk.TalkModel.getIns().callData=t;talk.TalkModel.getIns().event(talk.TalkModel.STORY_TIGGER,csv.StoriesProxy.ENUM_TIGGER.TASK_COMPELTE)}};t.prototype.onFuncOpen=function(t){if(parseInt(this._model.currMainTask.cfg.client_params)==t){game.Context.off(game.ContextEvent.FUNCTION_OPEN,this,this.onFuncOpen);app.ProtocolRequest.GuideTaskReq(this._model.currMainTask.data.questIndex)}};t.prototype.onAutoComplete=function(t){app.ProtocolRequest.TaskSubmit(t.data.questIndex)};t.prototype.onAutoGetAndComplete=function(t){task.TaskManager.doTask(t);if(t.subType!=csv.TaskProxy.SUBTYPE.TALK){app.ProtocolRequest.TaskSubmit(t.data.questIndex)}};t.prototype.playTween=function(){this._boTween=true;this.ani1.on(Laya.Event.COMPLETE,this,this.tweenComplete);this.ani1.play(0)};t.prototype.tweenComplete=function(){this._boTween=false;this.ani1.gotoAndStop(0);this.labelrenwu01.text=this.currTask.getMainViewText();if(this.currTask.data.questSate==4){this.labelrenwu01.y=9}else{this.labelrenwu01.y=this.initY}};t.SINGLE_KEY="main.TaskMainEnterView";t.WIDTH=316;t.HEIGHT=75;return t}(ui.main.mainrenwuUI);i.TaskMainEnterView=t;var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.x=(Laya.stage.width-this.width)/2;this.y=50};e.prototype.onDisplay=function(){this.mouseEnabled=true;this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){Laya.timer.clear(this,this.loopFreshTime)};e.prototype.refreshAll=function(){this.tishi.text=this.dataSource;this.startLoop()};e.prototype.startLoop=function(){this._hideTime=game.Config.getIntParams(2018);Laya.timer.loop(1e3,this,this.loopFreshTime);this.loopFreshTime()};e.prototype.loopFreshTime=function(){this._hideTime--;if(this._hideTime<=0){app.ViewManager.toggleView(e,app.AppContainer.zhezhaoLayer,-1)}};e.SINGLE_KEY="main.TaskMainCompleteView";return e}(ui.main.renwutankuangtishiUI);i.TaskMainCompleteView=e})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(i){var t=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t.maptype=csv.MapProxy.MAP_TYPE.PVP;t.battletype=battle.BattleConst.BATTLE_TYPE.PVP_ARENA;t.wuxingHandler=new Laya.Handler(t,t.startBattle);t.closeCd=game.Config.getIntParams(602);return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.showUi=function(){e.prototype.showUi.call(this);app.ViewManager.toggleView(i.MoneyView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(i.RoleInfoView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(i.MainBottomView,app.AppContainer.uiBottomLayer,-1);this.funcId=csv.FunctionsProxy.ENUMS.ARENA};t.prototype.hideUi=function(){e.prototype.hideUi.call(this);app.ViewManager.toggleView(battle.BattlePvpTimeView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattlePvpMineRoleView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattlePvpEnemyRoleView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,-1)};t.prototype.startGame=function(){e.prototype.startGame.call(this);app.ViewManager.toggleView(battle.BattlePvpTimeView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(battle.BattlePvpMineRoleView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(battle.BattlePvpEnemyRoleView,app.AppContainer.uiLayer,1);this.wuxingPk();this.setRolePetShow()};t.prototype.stopGame=function(){e.prototype.stopGame.call(this);app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,-1)};t.prototype.setBattleResult=function(t){this.resultData=t};t.prototype.wuxingPk=function(){app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,1,[this.wuxingHandler])};t.prototype.startBattle=function(){this.setPvpActMove();battle.BattlePvpTimeView.getIns().startLoopTime();this.model.battleval[1]+=game.Context.getServerTime()-this.manager.battleStartTime;scene.SceneMediator.getInstance().useCameraCenter(true);this.manager.boSceneEnd=true};t.SINGLE_KEY="MapArenaControl";return t}(i.MapBaseControl);i.MapArenaControl=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(i){var t=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t.maptype=csv.MapProxy.MAP_TYPE.PATA;t.battletype=battle.BattleConst.BATTLE_TYPE.BOSS_CAVE;t.stepHandler=new Laya.Handler(t,t.showStep);return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.showUi=function(){e.prototype.showUi.call(this);app.ViewManager.toggleView(i.LeftIconList,app.AppContainer.uiIconLayer,1);app.ViewManager.toggleView(i.BattleIconList,app.AppContainer.uiIconLayer,1);app.ViewManager.toggleView(i.BossExitView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(i.BattleSpeedView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(chat.ChatMiniView,app.AppContainer.uiLayer,1);this.funcId=csv.FunctionsProxy.ENUMS.BOSS_CAVE};t.prototype.hideUi=function(){e.prototype.hideUi.call(this);app.ViewManager.toggleView(i.LeftIconList,app.AppContainer.uiIconLayer,-1);app.ViewManager.toggleView(i.BattleIconList,app.AppContainer.uiIconLayer,-1);app.ViewManager.toggleView(i.BossExitView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BossHpView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleLevelView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleStartTimeView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleLimitTimeView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,-1);app.ViewManager.toggleView(i.BattleSpeedView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(chat.ChatMiniView,app.AppContainer.uiLayer,-1)};t.prototype.startGame=function(){scene.SceneMediator.getInstance().setCameraInit();e.prototype.startGame.call(this);app.ViewManager.toggleView(battle.BossHpView,app.AppContainer.uiLayer,1);this.showStep();this.setMonsterEnterMove();app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,1)};t.prototype.stopGame=function(){e.prototype.stopGame.call(this);app.ProtocolRequest.BattleShowEndReq(this.model.battleid);app.ViewManager.toggleView(battle.BossHpView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,-1)};t.prototype.setBattleResult=function(t){if(t.result==battle.BattleConst.BATTLE_RESULT_TYPE.WIN){this.showResult(t,battle.BattleBossCaveWin,battle.SbattleBossCaveWin)}else{this.showResult(t,battle.BattleBossCaveLoseView,battle.SbattleBossCaveLoseView)}};t.prototype.showStep=function(){app.ViewManager.toggleView(battle.BattleLimitTimeView,app.AppContainer.uiLayer,1);this.model.battleval[1]+=game.Context.getServerTime()-this.manager.battleStartTime;scene.SceneMediator.getInstance().useCameraCenter(true);this.manager.boSceneEnd=true};t.SINGLE_KEY="MapBossCaveDiscoveControl";return t}(i.MapBaseControl);i.MapBossCaveDiscoveControl=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(i){var t=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t.maptype=csv.MapProxy.MAP_TYPE.KUAFU_BOSS_IN;t.battletype=battle.BattleConst.BATTLE_TYPE.BOSS_WORLD;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.showUi=function(){e.prototype.showUi.call(this);app.ViewManager.toggleView(i.LeftIconList,app.AppContainer.uiIconLayer,1);app.ViewManager.toggleView(i.BossExitView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(battle.BossKuaFuBattleEnemyView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(battle.BossKuafuRankView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(chat.ChatMiniView,app.AppContainer.uiLayer,1)};t.prototype.hideUi=function(){e.prototype.hideUi.call(this);app.ViewManager.toggleView(i.LeftIconList,app.AppContainer.uiIconLayer,-1);app.ViewManager.toggleView(battle.BossHpView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(i.BossExitView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BossKuaFuBattleEnemyView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BossKuafuRankView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(chat.ChatMiniView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,-1);app.ViewManager.toggleView(battle.MapLimitTimeView,app.AppContainer.uiLayer,-1);this.model.clearSeverRobots();boss.BossModel.getIns().clearBelongInfo()};t.prototype.startGame=function(){e.prototype.startGame.call(this);app.ViewManager.toggleView(battle.BossHpView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,1);app.ViewManager.toggleView(battle.MapLimitTimeView,app.AppContainer.uiLayer,1);this.model.createSeverRobots();this.manager.boSceneEnd=true};t.prototype.stopGame=function(){e.prototype.stopGame.call(this);app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,-1)};t.prototype.setBattleResult=function(t,e){if(e===void 0){e=1e3}if(e){Laya.timer.once(e,this,this.setBattleResult,[t,0]);return}if(t.result==2){battle.BossBattleResultView.open(t,app.getLang(csv.FunctionsProxy.getIns().getCfg(csv.FunctionsProxy.ENUMS.BOSS_KUAFU).buttonname))}else{battle.BossBattleResultView.closeAll();battle.BossPkLoseView.closeAll();app.ViewManager.toggleView(battle.BossHpView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.MapLimitTimeView,app.AppContainer.uiLayer,-1);if(t.result==3){this.showResult(t,battle.BattleKuafuLoseView,battle.SbattleKuafuLoseView)}else{if(t.battleval[1].toNumber()){this.showResult(t,battle.BattleKuafuWinView,battle.SbattleKuafuWinView)}else if(t.battleval[2].toNumber()){this.showResult(t,battle.BattleKuafuWinView,battle.SbattleKuafuWinView)}else{this.showResult(t,battle.BattleKuafuLoseView,battle.SbattleKuafuWinView)}}}};t.prototype.setPkResult=function(t,e){if(e===void 0){e=1e3}if(e){Laya.timer.once(e,this,this.setPkResult,[t,0]);return}if(t.flag){manager.FlowManager.instance.flowByStyle1(app.getLang("boss_defeated_tips3",t.uname))}else{battle.BossPkLoseView.open(t,app.getLang(csv.FunctionsProxy.getIns().getCfg(csv.FunctionsProxy.ENUMS.BOSS_KUAFU).buttonname))}};t.SINGLE_KEY="MapBossKuafuControl";return t}(i.MapBaseControl);i.MapBossKuafuControl=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(i){var t=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t.maptype=csv.MapProxy.MAP_TYPE.KUAFU_BOSS_OUT;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.showUi=function(){e.prototype.showUi.call(this);app.ViewManager.toggleView(i.LeftIconList,app.AppContainer.uiIconLayer,1);app.ViewManager.toggleView(i.MapExitView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(i.MiniMap,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(chat.ChatMiniView,app.AppContainer.uiLayer,1);boss.BossModel.getIns().startUpdateBossInfo(csv.BossProxy.getIns().getBossArrByType(csv.BossProxy.ENUM.BOSS_KUAFU),1);app.ViewManager.toggleView(battle.MapLimitTimeView,app.AppContainer.uiLayer,1)};t.prototype.hideUi=function(){e.prototype.hideUi.call(this);app.ViewManager.toggleView(i.LeftIconList,app.AppContainer.uiIconLayer,-1);app.ViewManager.toggleView(i.MapExitView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(i.MiniMap,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(chat.ChatMiniView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.MapLimitTimeView,app.AppContainer.uiLayer,-1);boss.BossModel.getIns().stopUpdateBossInfo();role.LeadingRoleView.getIns().cancelAI()};t.SINGLE_KEY="MapBossKuafuOutControl";return t}(i.MapBaseControl);i.MapBossKuafuOutControl=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(i){var t=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t.maptype=csv.MapProxy.MAP_TYPE.BOSS;t.battletype=battle.BattleConst.BATTLE_TYPE.BOSS_VIP;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.showUi=function(){e.prototype.showUi.call(this);app.ViewManager.toggleView(i.LeftIconList,app.AppContainer.uiIconLayer,1)};t.prototype.hideUi=function(){e.prototype.hideUi.call(this);app.ViewManager.toggleView(battle.BossHpView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(i.LeftIconList,app.AppContainer.uiIconLayer,-1)};t.prototype.startGame=function(){e.prototype.startGame.call(this);app.ViewManager.toggleView(battle.BossHpView,app.AppContainer.uiLayer,1);this.manager.boSceneEnd=true};t.prototype.stopGame=function(){e.prototype.stopGame.call(this);app.ViewManager.toggleView(battle.BossHpView,app.AppContainer.uiLayer,-1)};t.prototype.setBattleResult=function(t,e){if(e===void 0){e=1e3}if(e){Laya.timer.once(e,this,this.setBattleResult,[t,0]);return}if(t.result==battle.BattleConst.BATTLE_RESULT_TYPE.WIN){app.ViewManager.toggleDialog(battle.BattleWinView,1,0,t)}else{app.ViewManager.toggleDialog(battle.BattleLoseView,1,0,t)}};t.SINGLE_KEY="MapBossVipControl";return t}(i.MapBaseControl);i.MapBossVipControl=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(i){var t=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t.maptype=csv.MapProxy.MAP_TYPE.WORLD_BOSS_IN;t.battletype=battle.BattleConst.BATTLE_TYPE.BOSS_WORLD;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.showUi=function(){e.prototype.showUi.call(this);app.ViewManager.toggleView(i.LeftIconList,app.AppContainer.uiIconLayer,1);app.ViewManager.toggleView(i.BossExitView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(battle.BossBelongView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(battle.BossRobView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(battle.BossWorldRankView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(battle.BossRunTimeView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(chat.ChatMiniView,app.AppContainer.uiLayer,1);this.funcId=csv.FunctionsProxy.ENUMS.BOSS_WOLRD};t.prototype.hideUi=function(){e.prototype.hideUi.call(this);app.ViewManager.toggleView(i.LeftIconList,app.AppContainer.uiIconLayer,-1);app.ViewManager.toggleView(battle.BossHpView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(i.BossExitView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BossBelongView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BossRobView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BossWorldRankView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BossRunTimeView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,-1);app.ViewManager.toggleView(chat.ChatMiniView,app.AppContainer.uiLayer,-1);this.model.clearSeverRobots();boss.BossModel.getIns().clearBelongInfo();battle.BossBattleResultView.close();battle.BossPkLoseView.close()};t.prototype.startGame=function(){e.prototype.startGame.call(this);app.ViewManager.toggleView(battle.BossHpView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,1);this.model.createSeverRobots();this.manager.boSceneEnd=true};t.prototype.stopGame=function(){e.prototype.stopGame.call(this);app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,-1)};t.prototype.setBattleResult=function(t,e){if(e===void 0){e=1e3}if(e){Laya.timer.once(e,this,this.setBattleResult,[t,0]);return}if(t.result==2){battle.BossBattleResultView.open(t,app.getLang(csv.FunctionsProxy.getIns().getCfg(csv.FunctionsProxy.ENUMS.BOSS_WOLRD).buttonname))}else{battle.BossBattleResultView.closeAll();battle.BossPkLoseView.closeAll();app.ViewManager.toggleView(battle.BossHpView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BossRunTimeView,app.AppContainer.uiLayer,-1);if(t.result==3){this.showResult(t,battle.BattleWorldLoseView,battle.SbattleWorldLoseView)}else{if(t.battleval[1].toNumber()){this.showResult(t,battle.BattleWorldWinView,battle.SbattleWorldWinView)}else if(t.battleval[2].toNumber()){this.showResult(t,battle.BattleWorldWinView,battle.SbattleWorldWinView)}else if(t.battleval[3].toNumber()){this.showResult(t,battle.BattleWorldWinView,battle.SbattleWorldWinView)}else{this.showResult(t,battle.BattleWorldLoseView,battle.SbattleWorldLoseView)}}}};t.prototype.setPkResult=function(t,e){if(e===void 0){e=1e3}if(e){Laya.timer.once(e,this,this.setPkResult,[t,0]);return}if(t.flag){manager.FlowManager.instance.flowByStyle1(app.getLang("boss_defeated_tips3",t.uname))}else{battle.BossPkLoseView.open(t,app.getLang(csv.FunctionsProxy.getIns().getCfg(csv.FunctionsProxy.ENUMS.BOSS_WOLRD).buttonname))}};t.SINGLE_KEY="MapBossWorldControl";return t}(i.MapBaseControl);i.MapBossWorldControl=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(i){var t=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t.maptype=csv.MapProxy.MAP_TYPE.WORLD_BOSS_ICE_FIGHT;t.battletype=battle.BattleConst.BATTLE_TYPE.BOSS_WORLD;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.showUi=function(){e.prototype.showUi.call(this);app.ViewManager.toggleView(i.LeftIconList,app.AppContainer.uiIconLayer,1);app.ViewManager.toggleView(i.BossExitView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(battle.BossKuaFuBattleEnemyView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(battle.BossBelongView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(battle.BossRobView,app.AppContainer.uiLayer,1)};t.prototype.hideUi=function(){e.prototype.hideUi.call(this);app.ViewManager.toggleView(i.LeftIconList,app.AppContainer.uiIconLayer,-1);app.ViewManager.toggleView(battle.BossHpView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(i.BossExitView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BossKuaFuBattleEnemyView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BossBelongView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BossRobView,app.AppContainer.uiLayer,-1);this.model.clearSeverRobots();boss.BossModel.getIns().clearBelongInfo()};t.prototype.startGame=function(){e.prototype.startGame.call(this);app.ViewManager.toggleView(battle.BossHpView,app.AppContainer.uiLayer,1);this.model.createSeverRobots()};t.prototype.stopGame=function(){e.prototype.stopGame.call(this);app.ViewManager.toggleView(battle.BossHpView,app.AppContainer.uiLayer,-1)};t.SINGLE_KEY="MapBossWorldIceControl";return t}(i.MapBaseControl);i.MapBossWorldIceControl=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(i){var t=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t.maptype=csv.MapProxy.MAP_TYPE.WORLD_BOSS_OUT;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.showUi=function(){e.prototype.showUi.call(this);app.ViewManager.toggleView(i.LeftIconList,app.AppContainer.uiIconLayer,1);app.ViewManager.toggleView(i.MapExitView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(i.MiniMap,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(boss.BossWorldIceHurtView,app.AppContainer.uiLayer,1);boss.BossModel.getIns().startUpdateBossInfo(csv.BossProxy.getIns().getBossArrByType(csv.BossProxy.ENUM.BOSS_WORLD_ICE))};t.prototype.hideUi=function(){e.prototype.hideUi.call(this);app.ViewManager.toggleView(i.LeftIconList,app.AppContainer.uiIconLayer,-1);app.ViewManager.toggleView(i.MapExitView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(i.MiniMap,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(boss.BossWorldIceHurtView,app.AppContainer.uiLayer,-1);boss.BossModel.getIns().stopUpdateBossInfo();role.LeadingRoleView.getIns().cancelAI()};t.SINGLE_KEY="MapBossWorldOutControl";return t}(i.MapBaseControl);i.MapBossWorldOutControl=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(i){var t=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t.maptype=csv.MapProxy.MAP_TYPE.WORLD_BOSS_ICE;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.showUi=function(){e.prototype.showUi.call(this);app.ViewManager.toggleView(i.LeftIconList,app.AppContainer.uiIconLayer,1);app.ViewManager.toggleView(i.MapExitBossIceView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(i.MiniMap,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(boss.BossWorldIceleftView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(boss.BossWorldIceHurtView,app.AppContainer.uiLayer,1);boss.BossModel.getIns().startUpdateBossInfo(csv.BossProxy.getIns().getBossArrByType(csv.BossProxy.ENUM.BOSS_WORLD_ICE))};t.prototype.hideUi=function(){e.prototype.hideUi.call(this);app.ViewManager.toggleView(i.LeftIconList,app.AppContainer.uiIconLayer,-1);app.ViewManager.toggleView(i.MapExitBossIceView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(i.MiniMap,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(boss.BossWorldIceleftView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(boss.BossWorldIceHurtView,app.AppContainer.uiLayer,-1);boss.BossModel.getIns().stopUpdateBossInfo();role.LeadingRoleView.getIns().cancelAI()};t.SINGLE_KEY="MapBossWorldOutIceControl";return t}(i.MapBaseControl);i.MapBossWorldOutIceControl=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(e){var t=function(s){__extends(t,s);function t(){var t=s.call(this)||this;t.maptype=csv.MapProxy.MAP_TYPE.DUNGEON;t.battletype=battle.BattleConst.BATTLE_TYPE.BRAVE_CHALLENGE;t.stepHandler=new Laya.Handler(t,t.showStep);return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.showUi=function(){s.prototype.showUi.call(this);app.ViewManager.toggleView(e.LeftIconList,app.AppContainer.uiIconLayer,1);app.ViewManager.toggleView(e.BossExitView,app.AppContainer.uiLayer,1);this.funcId=csv.FunctionsProxy.ENUMS.BRAVE_CHALLENGE};t.prototype.hideUi=function(){s.prototype.hideUi.call(this);app.ViewManager.toggleView(e.LeftIconList,app.AppContainer.uiIconLayer,-1);app.ViewManager.toggleView(battle.BattleLevelView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleStartTimeView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleLimitTimeView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(e.BossExitView,app.AppContainer.uiLayer,-1)};t.prototype.startGame=function(){scene.SceneMediator.getInstance().setCameraInit();s.prototype.startGame.call(this);app.ViewManager.toggleView(battle.BattleLevelView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(battle.BattleStartTimeView,app.AppContainer.uiLayer,1,[battle.BattleConst.BATTLE_START_TIME,this.stepHandler]);var t=game.Context.roleMaxLvl;var e=csv.DungeonProxy.getIns().getBraveCfg(this.model.battleval[0]);var i=this.model.battleInfo.monster;for(var n=0,a=i.length;n<a;n++){var o=scene.SceneMediator.getInstance().getViewById(i[n].objId);if(o){o.setRedHeadName(t<e.levelup)}}this.setMonsterEnterMove();this.setRolePetShow()};t.prototype.stopGame=function(){this.battleTime=this.manager.battleEndTime;s.prototype.stopGame.call(this);app.ProtocolRequest.BattleShowEndReq(this.model.battleid);app.ViewManager.toggleView(battle.BattleLimitTimeView,app.AppContainer.uiLayer,-1)};t.prototype.setBattleResult=function(t){};t.prototype.showStep=function(){app.ViewManager.toggleView(battle.BattleLimitTimeView,app.AppContainer.uiLayer,1);this.model.battleval[1]+=game.Context.getServerTime()-this.manager.battleStartTime;scene.SceneMediator.getInstance().useCameraCenter(true);this.manager.boSceneEnd=true};t.SINGLE_KEY="MapBraveChallengeControl";return t}(e.MapBaseControl);e.MapBraveChallengeControl=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(i){var t=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t.maptype=csv.MapProxy.MAP_TYPE.DUNGEON;t.battletype=battle.BattleConst.BATTLE_TYPE.TRANS;t.talkHandler=new Laya.Handler(t,t.hideStory);t.stepHandler=new Laya.Handler(t,t.showStep);return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.showUi=function(){e.prototype.showUi.call(this);app.ViewManager.toggleView(i.LeftIconList,app.AppContainer.uiIconLayer,1);this.funcId=csv.FunctionsProxy.ENUMS.REBIRTH};t.prototype.hideUi=function(){e.prototype.hideUi.call(this);app.ViewManager.toggleView(i.LeftIconList,app.AppContainer.uiIconLayer,-1);app.ViewManager.toggleView(battle.BattleLimitTimeView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BossHpView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleStartTimeView,app.AppContainer.uiLayer,-1)};t.prototype.startGame=function(){e.prototype.startGame.call(this);this.model.createSeverRobots();var t=this.model.battleval[2]-game.Context.getServerTime();if(t>0){app.ViewManager.toggleView(battle.BattleStartTimeView,app.AppContainer.uiLayer,1,[t,this.stepHandler])}else{this.showStep()}};t.prototype.stopGame=function(){e.prototype.stopGame.call(this);talk.TalkModel.getIns().callBack=this.talkHandler;talk.TalkModel.getIns().event(talk.TalkModel.STORY_TIGGER,csv.StoriesProxy.ENUM_TIGGER.BATTLE_END)};t.prototype.setBattleResult=function(t,e){if(e===void 0){e=1e3}if(e){Laya.timer.once(e,this,this.setBattleResult,[t,0]);return}app.ProtocolRequest.LeaveTeamDgnReq()};t.prototype.showStep=function(){app.ViewManager.toggleView(battle.BossHpView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(battle.BattleStartTimeView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleLimitTimeView,app.AppContainer.uiLayer,1)};t.prototype.hideStory=function(){app.ProtocolRequest.BattleShowEndReq(this.model.battleid)};t.SINGLE_KEY="MapDujieControl";return t}(i.MapBaseControl);i.MapDujieControl=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(i){var t=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t.maptype=csv.MapProxy.MAP_TYPE.DUJIE_OUT;app.Protocol.addListener(app.ProtocolResponse.StartDujieResp,t,t.onStartDujieResp);t._model=copy.CopyModel.getIns();t.stepHandler=new Laya.Handler(t,t.showRuleBack);return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.onStartDujieResp=function(t,e){this._model.endTime=e.endtime;this.startCopyTime()};t.prototype.showUi=function(){e.prototype.showUi.call(this);app.ViewManager.toggleView(i.MapExitView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(i.MainBottomView,app.AppContainer.uiBottomLayer,-1);this._model.on(copy.CopyModel.COPY_WIN,this,this.success);this._model.on(copy.CopyModel.COPY_LOSE,this,this.lose)};t.prototype.hideUi=function(){e.prototype.hideUi.call(this);app.ViewManager.toggleView(rebirth.DuJieRightTopView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(i.MapExitView,app.AppContainer.uiLayer,-1);this.clearAll()};t.prototype.startGame=function(){this._model.createCopy();app.ViewManager.toggleView(rebirth.DuJieRightTopView,app.AppContainer.uiLayer,1);app.ViewManager.toggleDialog(copy.CopyRuleView,1,0,[this.stepHandler])};t.prototype.showRuleBack=function(){app.ProtocolRequest.StartDujieReq(game.Context.mainRole.mapId)};t.prototype.clearAll=function(){this._model.clearAll();this._model.off(copy.CopyModel.COPY_WIN,this,this.success);this._model.off(copy.CopyModel.COPY_LOSE,this,this.lose)};t.prototype.startCopyTime=function(){this._model.startCopyTime()};t.prototype.success=function(){var t=rebirth.ReBirthModel.getIns();app.ViewManager.toggleView(rebirth.ReBirthSuccessView,app.AppContainer.uiLayer,1,[t.selectedIndex+1,t.selectedRoleVo.prof]);var e=game.TaskModel.getIns().getTaskData(t.quest);if(e&&e.subType==csv.TaskProxy.SUBTYPE.CLIENT){app.ProtocolRequest.GuideTaskReq(t.quest)}};t.prototype.lose=function(){};t.SINGLE_KEY="MapDujieOutControl";return t}(i.MapBaseControl);i.MapDujieOutControl=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(i){var t=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t.maptype=csv.MapProxy.MAP_TYPE.DUNGEON;t.battletype=battle.BattleConst.BATTLE_TYPE.ELITE_CHALLENGE;t.stepHandler=new Laya.Handler(t,t.showStep);return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.showUi=function(){e.prototype.showUi.call(this);app.ViewManager.toggleView(i.LeftIconList,app.AppContainer.uiIconLayer,1);app.ViewManager.toggleView(i.BossExitView,app.AppContainer.uiLayer,1);this.funcId=csv.FunctionsProxy.ENUMS.ELITE_CHALLENGE};t.prototype.hideUi=function(){e.prototype.hideUi.call(this);app.ViewManager.toggleView(i.LeftIconList,app.AppContainer.uiIconLayer,-1);app.ViewManager.toggleView(battle.BattleStartTimeView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleLimitTimeView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleLevelView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(i.BossExitView,app.AppContainer.uiLayer,-1)};t.prototype.startGame=function(){e.prototype.startGame.call(this);app.ViewManager.toggleView(battle.BattleLevelView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(battle.BattleStartTimeView,app.AppContainer.uiLayer,1,[battle.BattleConst.BATTLE_START_TIME,this.stepHandler]);this.setMonsterEnterMove();this.setRolePetShow()};t.prototype.stopGame=function(){e.prototype.stopGame.call(this);app.ProtocolRequest.BattleShowEndReq(this.model.battleid);app.ViewManager.toggleView(battle.BattleLimitTimeView,app.AppContainer.uiLayer,-1)};t.prototype.setBattleResult=function(t){};t.prototype.showStep=function(){app.ViewManager.toggleView(battle.BattleLimitTimeView,app.AppContainer.uiLayer,1);this.model.battleval[1]+=game.Context.getServerTime()-this.manager.battleStartTime;scene.SceneMediator.getInstance().useCameraCenter(true);this.manager.boSceneEnd=true};t.SINGLE_KEY="MapEliteChallengeControl";return t}(i.MapBaseControl);i.MapEliteChallengeControl=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(i){var t=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t.maptype=csv.MapProxy.MAP_TYPE.DUNGEON;t.battletype=battle.BattleConst.BATTLE_TYPE.FU_YUAN;t.stepHandler=new Laya.Handler(t,t.showStep);return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.showUi=function(){e.prototype.showUi.call(this);app.ViewManager.toggleView(i.BattleSpeedView,app.AppContainer.uiLayer,1)};t.prototype.hideUi=function(){e.prototype.hideUi.call(this);app.ViewManager.toggleView(battle.BattleLevelView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleStartTimeView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleLimitTimeView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(i.BattleSpeedView,app.AppContainer.uiLayer,-1)};t.prototype.startGame=function(){scene.SceneMediator.getInstance().setCameraInit();e.prototype.startGame.call(this);app.ViewManager.toggleView(battle.BattleStartTimeView,app.AppContainer.uiLayer,1,[battle.BattleConst.BATTLE_START_TIME,this.stepHandler]);this.setMonsterEnterMove()};t.prototype.stopGame=function(){e.prototype.stopGame.call(this)};t.prototype.setBattleResult=function(t){this.resultData=t};t.prototype.showStep=function(){app.ViewManager.toggleView(battle.BattleLimitTimeView,app.AppContainer.uiLayer,1);this.model.battleval[1]+=game.Context.getServerTime()-this.manager.battleStartTime;scene.SceneMediator.getInstance().useCameraCenter(true);this.manager.boSceneEnd=true};t.SINGLE_KEY="MapFuYuanControl";return t}(i.MapBaseControl);i.MapFuYuanControl=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(i){var t=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t.maptype=csv.MapProxy.MAP_TYPE.DUNGEON;t.battletype=battle.BattleConst.BATTLE_TYPE.GOD_DUNGEON;t.stepHandler=new Laya.Handler(t,t.showStep);return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.showUi=function(){e.prototype.showUi.call(this);app.ViewManager.toggleView(i.LeftIconList,app.AppContainer.uiIconLayer,1);this.funcId=csv.FunctionsProxy.ENUMS.GOD_MOUNTAIN_DUNGEON};t.prototype.hideUi=function(){e.prototype.hideUi.call(this);app.ViewManager.toggleView(i.LeftIconList,app.AppContainer.uiIconLayer,-1);app.ViewManager.toggleView(battle.BattleLevelView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleStartTimeView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleLimitTimeView,app.AppContainer.uiLayer,-1)};t.prototype.startGame=function(){scene.SceneMediator.getInstance().setCameraInit();e.prototype.startGame.call(this);app.ViewManager.toggleView(battle.BattleLevelView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(battle.BattleStartTimeView,app.AppContainer.uiLayer,1,[battle.BattleConst.BATTLE_START_TIME,this.stepHandler]);this.setMonsterEnterMove()};t.prototype.stopGame=function(){e.prototype.stopGame.call(this)};t.prototype.setBattleResult=function(t){this.resultData=t};t.prototype.showStep=function(){app.ViewManager.toggleView(battle.BattleLimitTimeView,app.AppContainer.uiLayer,1);this.model.battleval[1]+=game.Context.getServerTime()-this.manager.battleStartTime;scene.SceneMediator.getInstance().useCameraCenter(true);this.manager.boSceneEnd=true};t.SINGLE_KEY="MapGodDuneonBossControl";return t}(i.MapBaseControl);i.MapGodDuneonBossControl=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(p){var t=function(o){__extends(t,o);function t(){var t=o.call(this)||this;t.monDexDic={};t.pathDic={};t.maptype=csv.MapProxy.MAP_TYPE.GUAJI;t.battletype=battle.BattleConst.BATTLE_TYPE.GUAJI;var e=app.str2Array(game.Config.getParams(1174),";","-");t.flyQuas=[];t.flyPris=[];t.maxPris=0;for(var i=0,n=e.length;i<n;i++){var a=e[i];t.flyQuas.push(parseInt(a[0]));t.maxPris+=parseInt(a[1]);t.flyPris.push(t.maxPris)}t.showClose=false;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.clear=function(){};t.prototype.showUi=function(){o.prototype.showUi.call(this);app.ViewManager.toggleView(p.RightIconList,app.AppContainer.uiIconLayer,1);app.ViewManager.toggleView(p.LeftIconList,app.AppContainer.uiIconLayer,1);app.ViewManager.toggleView(p.LeftBottomIconList,app.AppContainer.uiIconLayer,1);app.ViewManager.toggleView(p.RedPackageList,app.AppContainer.uiIconLayer,1);app.ViewManager.toggleView(p.HintIconList,app.AppContainer.uiIconLayer,1);app.ViewManager.toggleView(p.GuajiEnterView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(p.RightTopIconList,app.AppContainer.uiIconLayer,1);app.ViewManager.toggleView(p.GuajiExpView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(p.GuajiChallengeView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(p.TaskMainEnterView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(p.BigRightTopList,app.AppContainer.uiIconLayer,1);app.ViewManager.toggleView(p.BigLeftTopList,app.AppContainer.uiIconLayer,1);this.model.on(battle.BattleModel.MONSTER_DIE_COUNT,this,this.dellAward);this.boFirst=true;this.showedMap={};this.startBubble()};t.prototype.hideUi=function(){o.prototype.hideUi.call(this);app.ViewManager.toggleView(p.RightIconList,app.AppContainer.uiIconLayer,-1);app.ViewManager.toggleView(p.LeftIconList,app.AppContainer.uiIconLayer,-1);app.ViewManager.toggleView(p.LeftBottomIconList,app.AppContainer.uiIconLayer,-1);app.ViewManager.toggleView(p.RedPackageList,app.AppContainer.uiIconLayer,-1);app.ViewManager.toggleView(p.HintIconList,app.AppContainer.uiIconLayer,-1);app.ViewManager.toggleView(p.GuajiEnterView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(p.RightTopIconList,app.AppContainer.uiIconLayer,-1);app.ViewManager.toggleView(battle.GuajiBossHpView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BossComingView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(p.GuajiExpView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(p.GuajiChallengeView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(p.PassCompleteView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(p.DaYaoComingView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(p.TaskMainEnterView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(p.BigRightTopList,app.AppContainer.uiIconLayer,-1);app.ViewManager.toggleView(p.BigLeftTopList,app.AppContainer.uiIconLayer,-1);this.model.off(battle.BattleModel.MONSTER_DIE_COUNT,this,this.dellAward);Laya.timer.clearAll(this);this.boMoveEnd=false;this.boInfo=false;this.clearBubble()};t.prototype.reset=function(){app.ViewManager.toggleView(battle.BossComingView,app.AppContainer.uiLayer,-1);this.manager.boMapLoadEnd=false;app.ViewManager.toggleView(p.MapLoadView,app.AppContainer.zhezhaoLayer,1);this.boFirst=true;Laya.timer.clearAll(this);this.boMoveEnd=false;this.boInfo=false;var t=game.Context.battleRoleList.length;for(var e=0;e<t;e++){var i=scene.SceneMediator.getInstance().getViewById(game.Context.battleRoleList[e].insId);if(i){i.roleVO.hp=i.roleVO.maxhp;i.clearAll();i.roleVO.pathDex=0}}};t.prototype.startGame=function(){this.manager.boSceneEnd=false;o.prototype.startGame.call(this);var t=this.model.battleInfo;this.guajiMonCount=t.monster.length;if(this.boFirst){this.mDex=0;this.dellPath();this.setMonsterPos();this.boFirst=false;this.boMoveEnd=true;scene.SceneMediator.getInstance().changeCamera(role.LeadingRoleView.getIns());this.setRole(true);Laya.timer.once(1e3,this,this.delayStart)}else{this.setRole(false);this.setMons();this.boInfo=true;this.startReport()}};t.prototype.delayStart=function(){this.setMons();this.boInfo=true;Laya.timer.once(500,this,this.startReport)};t.prototype.stopGame=function(t){this.boGame=false;this.manager.stopLoopBattle();if(!t){for(var e=0,i=game.Context.battleRoleList.length;e<i;e++){var n=scene.SceneMediator.getInstance().getViewById(game.Context.battleRoleList[e].insId);if(n){n.guajiClearAll()}}var a=this.model.battleInfo.role.length;for(var e=0;e<a;e++){game.Context.battleRoleList[e].pathDex=this.monPos.dex}this.callNextBattle()}};t.prototype.setBattleResult=function(t){};t.prototype.callNextBattle=function(){this.boMoveEnd=false;this.boInfo=false;this.mDex++;this.setMonsterPos();this.gotoNext();var t=(this.manager.battleEndSeverTime-game.Context.getServerTime())*1e3;if(t<=0){this.askForEnd()}else{Laya.timer.once1(t,this,this.askForEnd)}};t.prototype.askForEnd=function(){app.ProtocolRequest.BattleShowEndReq(this.model.battleid);if(this.manager.boBattleLog){console.log("通知战斗结束",this.model.battleid)}};t.prototype.gotoNext=function(){var t=game.Context.battleRoleList.length;for(var e=0;e<t;e++){var i=scene.SceneMediator.getInstance().getViewById(game.Context.battleRoleList[e].insId);if(i){i.guajiClearAll();i.roleState=role.RoleStateConst.IDLE;this.doMove(i)}}};t.prototype.setRole=function(t){var e=this.model.battleInfo;var i=e.role.length;var n=[];var a=0;for(var o=0;o<i;o++){var s=e.role[o];var r=role.RoleVO.parserShowInfo(s,game.Context.roleMap[s.roleId.toString()]);r.setShowInfo(s);r.boShowHp=true;r.boShowMp=true;r.zuoqiId=0;r.boMainRole=o==0;r.wxBuff=this.model.dbuff;if(r.boRemoteHero){n.push(r);a++}else{n.unshift(r)}if(s.camp==1){r.setSerInfo(e.acursvrid,e.asvrid,e.asvrname)}}var l=game.SceneModel.getRolePosList(this.monPos.posX,this.monPos.posY);l=game.SceneModel.lineUpTeam(i,a,l);for(var o=0;o<i;o++){var r=n[o];var h=scene.SceneMediator.getInstance().getViewById(r.insId);if(t){var p=l[o];r.pos=p.pos;r.pathDex=this.monPos.dex;h=this.manager.createRole(r,p.pX,p.pY,p.pDir)}else if(!h){if(game.Context.mainRole.pathDex==this.monPos.dex){r.pathDex=game.Context.mainRole.pathDex;var p=this.getNextPos(r.pathDex);h=this.manager.createRole(r,p.posX,p.posY,game.Context.mainRole.dir)}else{r.pathDex=game.Context.mainRole.pathDex-1;var p=this.getNextPos(r.pathDex);h=this.manager.createRole(r,p.posX,p.posY,game.Context.mainRole.dir);this.doMove(h)}}h.initHeadHpMp();h.refreshView();game.Context.setRoleHp(r.insId)}};t.prototype.setMons=function(){var t=this.model.battleInfo;if(this.guajiMonCount==1){var e=role.MonsterVO.recode(t.monster[0]);e.boShowHp=false;e.boShowMp=false;e.monsterType=role.MonsterVO.ENUM_MONSTER_TYPE.GUAJI_BOSS;e.hittype=1;e.wxBuff=this.model.abuff;var i=this.manager.createMonster(e,this.monPos.posX,this.monPos.posY,t.pDir);i.showInStage();app.ViewManager.toggleView(battle.BossComingView,app.AppContainer.uiLayer,1,t.monster[0].monsterId)}else{var n=game.SceneModel.randomMonsterPosArr(this.monPos.posX,this.monPos.posY,this.guajiMonCount,4);for(var a=0;a<this.guajiMonCount;a++){var o=n[a];var e=role.MonsterVO.recode(t.monster[a]);e.boShowMp=e.boEnergy;e.hittype=0;e.wxBuff=this.model.abuff;var i=this.manager.createMonster(e,o.pX,o.pY,o.pDir);i.showInStage();i.startRandomMove()}}};t.prototype.doMove=function(t){var e=this;t.roleVO.pathDex++;if(t.roleVO.pathDex>=this.currPath.length){t.roleVO.pathDex=0}var i=this.getNextPos(t.roleVO.pathDex);if(i.type==1){t.roleVO.jumpId=null;this.moveToMonsterPos(t,i)}else{if(i.type==2){t.roleVO.jumpId=null;var n=i.posX+game.SceneModel.random(-1,2);var a=i.posY+game.SceneModel.random(-1,2);var o=new role.PosMoveAction;o.char=t;o.target=isometric.IsoUtils.isoToScreen(new isometric.Point3D(n*32,0,a*32));t.vo.dir=game.SceneModel.getDirByTowPos(t.vo.posX,t.vo.posY,n,a);o.completeHandler=Laya.Handler.create(this,function(){e.doMove(t)});t.setMoveAction(o)}else{t.roleVO.jumpId=role.JumpAction.getJumpId();var s=isometric.IsoUtils.isoToScreen(new isometric.Point3D(i.posX*32,0,i.posY*32));var o=new role.JumpAction;o.char=t;o.target=s;o.init();t.vo.dir=game.SceneModel.getJumpDirByTowPos(t.vo.posX,t.vo.posY,i.posX,i.posY);t.startShade();o.completeHandler=Laya.Handler.create(this,function(){t.stopShade();e.doMove(t)});t.setMoveAction(o)}}};t.prototype.moveToMonsterPos=function(t,r){var e=this;var i=game.SceneModel.getDisByTowPos(t.vo.posX,t.vo.posY,r.posX,r.posY);var n=false;if(i>300){n=true}var a=game.SceneModel.getDirByTowPos(t.vo.posX,t.vo.posY,r.posX,r.posY);if(n){scene.SceneMediator.getInstance().setStandPos(t.vo.insId,r.posX,r.posY);var o=this.mediator.findPath(t.vo.posX,t.vo.posY,r.posX,r.posY);if(o.length>3){o=o.splice(0,3)}t.movePath(o,Laya.Handler.create(this,s,[t,r.posX,r.posY,a]))}else{var o=this.mediator.findPath(t.vo.posX,t.vo.posY,r.posX,r.posY);t.movePath(o,Laya.Handler.create(this,function(){t.vo.dir=a;e.fensan(t,r)}))}function s(t,e,i,n){var a=this;var o=isometric.IsoUtils.isoToScreen(new isometric.Point3D(e*32,0,i*32));var s=new role.PosMoveAction;s.char=t;s.target=o;s.speed=role.PosMoveAction.ADD_SPEED;t.vo.dir=game.SceneModel.getJumpDirByTowPos(t.vo.posX,t.vo.posY,e,i);t.startShade();s.completeHandler=Laya.Handler.create(this,function(){t.vo.dir=n;t.stopShade();a.fensan(t,r)});t.setMoveAction(s);s.recordStandPos(t.vo.insId,e,i)}};t.prototype.fensan=function(t,e){var i=this;var n=this.manager.getFirstAttackView(t.roleVO.insId);var a=e.posX;var o=e.posY;var s;if(n){a=n.vo.posX;o=n.vo.posY;n.stopMove();n.stopRandomMove()}else{a=e.posX;o=e.posY}if(this.guajiMonCount==1){s=this.mediator.getEmptyStandPos(t,a,o,t.charactorVO.boRemoteHero?6:4,true)}else{s=this.mediator.getEmptyStandPos(t,a,o,3)}if(!s){s=new Laya.Point(a,o)}var r=new role.PosMoveAction;r.char=t;r.target=isometric.IsoUtils.isoToScreen(new isometric.Point3D(s.x*32,0,s.y*32));t.vo.dir=game.SceneModel.getDirByTowPos(t.vo.posX,t.vo.posY,s.x,s.y);r.completeHandler=Laya.Handler.create(this,function(){i.boMoveEnd=true;i.startReport()});t.setMoveAction(r);scene.SceneMediator.getInstance().setStandPos(t.vo.insId,s.x,s.y)};t.prototype.startReport=function(){if(this.boGame&&this.boInfo&&this.boMoveEnd&&!this.manager.boSceneEnd){var t=this.model.battleInfo;if(this.guajiMonCount==1){var e=scene.SceneMediator.getInstance().getViewById(t.monster[0].objId);if(e){app.ViewManager.toggleView(battle.BossComingView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.GuajiBossHpView,app.AppContainer.uiLayer,1,e.roleVO)}}else{for(var i=0;i<this.guajiMonCount;i++){var e=scene.SceneMediator.getInstance().getViewById(t.monster[i].objId);if(e){e.stopRandomMove()}}}this.manager.boSceneEnd=true}};t.prototype.dellPath=function(){var t=this.model.battleval[0];if(!this.pathDic[t]){var e=csv.GuajiProxy.getIns().getCfg(t);var i=app.str2Array(e.looppath,";","-");this.pathDic[t]=[];this.monDexDic[t]=[];for(var n=0,a=i.length;n<a;n++){var o=i[n];var s=new r;s.dex=n;s.type=parseInt(o[0]);s.posX=parseInt(o[1]);s.posY=parseInt(o[2]);this.pathDic[t].push(s);if(s.type==1){this.monDexDic[t].push(n)}}}this.currPath=this.pathDic[t];this.currMonDexs=this.monDexDic[t]};t.prototype.getNextPos=function(t){return this.currPath[t]};t.prototype.setMonsterPos=function(){var t=this.mDex%this.currMonDexs.length;var e=this.currMonDexs[t];this.monPos=this.currPath[e]};t.prototype.dellAward=function(t){if(scene.SceneMediator.getInstance().stopRender){return}var e=manager.TailUiFlyItem.changePos(t);var i=p.GuajiExpView.getIns();var n=manager.TailUiFlyItem.changePos(i);var a=Laya.Pool.getItemByClass(manager.TailUiFlyItem.SINGLE_KEY,manager.TailUiFlyItem);a.init(2,e.x,e.y,n.x+i.width/2,n.y+i.height/2);var o=guaji.SecretAreaModel.getIns().getBuffTime();if(o>0){var s=Laya.Pool.getItemByClass(manager.TailUiFlyItem.SINGLE_KEY,manager.TailUiFlyItem);s.init(2,e.x,e.y,n.x+i.width/2,n.y+i.height/2)}if(this.guajiMonCount==1){for(var r=1,l=this.flyQuas.length;r<l;r++){a=Laya.Pool.getItemByClass(manager.TailUiFlyItem.SINGLE_KEY,manager.TailUiFlyItem);a.init(this.flyQuas[r],e.x,e.y,n.x+i.width/2,n.y+i.height/2,app.AppContainer.flyLayer,r*100)}}else{var h=this.getQua();if(h){a=Laya.Pool.getItemByClass(manager.TailUiFlyItem.SINGLE_KEY,manager.TailUiFlyItem);a.init(h,e.x,e.y,n.x+i.width/2,n.y+i.height/2)}}};t.prototype.getQua=function(){var t=game.SceneModel.random(0,this.maxPris);for(var e=0,i=this.flyPris.length;e<i;e++){if(t<this.flyPris[e]){return this.flyQuas[e]}}return 0};t.prototype.startBubble=function(){var t=csv.BubbleTipProxy.getIns().cfgArr;var e=[];for(var i=0,n=t.length;i<n;i++){var a=t[i];if(game.Context.teamLv>=a.teamlvmin&&game.Context.teamLv<=a.teamlvmax){if(this.showedMap[a.id]){this.showedMap[a.id]--;continue}e.push(a)}}if(e.length){var o=game.SceneModel.random(0,e.length);var s=e[o];this.showedMap[s.id]=s.repeat;var r=scene.SceneMediator.getInstance().getViewById(game.Context.battleRoleList[0].insId);if(r){r.addBubble(s.des,s.last*1e3)}Laya.timer.once(game.Config.getIntParams(1220)*1e3,this,this.startBubble)}};t.prototype.clearBubble=function(){Laya.timer.clear(this,this.startBubble)};t.SINGLE_KEY="MapGuajiControl";return t}(p.MapBaseControl);p.MapGuajiControl=t;var r=function(){function t(){}return t}();p.GuajiPath=r})(main||(main={}));var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){this.initActivityTaRen()};e.prototype.initActivityTaRen=function(){var t=app.Config.getResById("bubble_tips.csv");this.cfgArr=t?t.getArray():[]};e.SINGLE_KEY="csv.BubbleTipProxy";return e}(app.ModelBase);t.BubbleTipProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(e){var t=function(r){__extends(t,r);function t(){var t=r.call(this)||this;t.maptype=csv.MapProxy.MAP_TYPE.PATA;t.battletype=battle.BattleConst.BATTLE_TYPE.GUANKA_PASS;t.step1Handler=new Laya.Handler(t,t.showStep1);t.step2Handler=new Laya.Handler(t,t.showStep2);t.step3Handler=new Laya.Handler(t,t.flyBack);t.closeCd=battle.BattleConst.BATTLE_CLOSE_TIME_ZHUXIAN;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.showUi=function(){r.prototype.showUi.call(this);app.ViewManager.toggleView(e.LeftIconList,app.AppContainer.uiIconLayer,1);app.ViewManager.toggleView(e.BattleIconList,app.AppContainer.uiIconLayer,1);app.ViewManager.toggleView(e.BossExitView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(chat.ChatMiniView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(e.BattleSpeedView,app.AppContainer.uiLayer,1);this.model.on(battle.BattleModel.MONSTER_DIE_COUNT,this,this.dellAward);this.addPass()};t.prototype.hideUi=function(){r.prototype.hideUi.call(this);app.ViewManager.toggleView(guaji.GuanKaTips,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(e.LeftIconList,app.AppContainer.uiIconLayer,-1);app.ViewManager.toggleView(e.BattleIconList,app.AppContainer.uiIconLayer,-1);app.ViewManager.toggleView(battle.BattleZhuxianLevelView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleLimitTimeView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(e.BossExitView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(chat.ChatMiniView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(e.BattleSpeedView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.LevelHurtBuffView,app.AppContainer.uiLayer,-1);this.model.off(battle.BattleModel.MONSTER_DIE_COUNT,this,this.dellAward);this.dropPosMap=null;this.award=null;Laya.timer.clear(this,this.onShowEnd);this.removePass()};t.prototype.startGame=function(){r.prototype.startGame.call(this);scene.SceneMediator.getInstance().boInit=true;this.setRoleEnterMove();this.dropPosMap={};var t=csv.GuajiProxy.getIns().getCfgGuanqia(this.model.battleval[0]);if(t.rewarddrop!=""){var e=app.str2Array(t.rewarddrop,";","-");for(var i=0,n=e.length;i<n;i++){var a=e[i];this.dropPosMap[a[1]]=parseInt(a[0])}}var o=guaji.GuajiModel.getIns().getFunction();if(o){if(app.ViewManager.DisplayedInStage(guaji.GuanKaTips.SINGLE_KEY)){guaji.GuanKaTips.getIns().updateView(o)}else{app.ViewManager.toggleView(guaji.GuanKaTips,app.AppContainer.uiLayer,1,[o])}}app.ViewManager.toggleView(battle.BattleZhuxianLevelView,app.AppContainer.uiLayer,1,this.step1Handler);var s=this.model.battleval[0].toString();if(app.str2Array(game.Config.getParams(1208),";").indexOf(s.toString())==-1){if(app.str2Array(game.Config.getParams(1209),";").indexOf(s.toString())!=-1){this.funcId=null}}};t.prototype.stopGame=function(){r.prototype.stopGame.call(this);app.ViewManager.toggleView(battle.BattleLimitTimeView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,-1);app.ViewManager.toggleView(battle.BattleZhuxianLevelView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(e.BattlePassView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.LevelHurtBuffView,app.AppContainer.uiLayer,-1);app.ProtocolRequest.BattleShowEndReq(this.model.battleid)};t.prototype.setBattleResult=function(t){if(t.result==battle.BattleConst.BATTLE_RESULT_TYPE.WIN){this.resultData=t;this.killAllMonster();if(this.award){this.award.createGet()}else{this.showResult(t,battle.BattleGuanKaWinView,battle.SbattleGuanKaWinView)}}else{Laya.Dialog.closeAll();app.ViewManager.toggleView(battle.BattleLoseFullView,app.AppContainer.zhezhaoLayer,1,this.model.battleInfo.defendbuff);app.ProtocolRequest.LeaveDailyDgnReq()}};t.prototype.showStep1=function(){var t=0;var e=battle.BattleModel.getIns().battleInfo.monster;for(var i=0,n=e.length;i<n;i++){var a=e[i];var o=csv.MonsterProxy.getIns().getCfg(a.monsterId);if(o.monlevel>t){t=o.monlevel}}var s=game.Context.teamLv-t;if(s>0){app.ViewManager.toggleView(battle.LevelHurtBuffView,app.AppContainer.uiLayer,1,[s])}app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,1,[this.step2Handler])};t.prototype.showStep2=function(){app.ViewManager.toggleView(battle.BattleLimitTimeView,app.AppContainer.uiLayer,1);this.model.battleval[1]+=game.Context.getServerTime()-this.manager.battleStartTime;scene.SceneMediator.getInstance().useCameraCenter(true);this.manager.boSceneEnd=true};t.prototype.flyBack=function(){if(this.award.boFabao){var t=void 0;if(!t){t=new DailyDrawResp;t.gachaid=1;t.reward=[]}var e=new DailyDrawData;e.itemid=this.award.itemId;e.itemnum=1;e.status=1;t.reward.push(e);if(t){chouka.ChouKaModel.getIns().on(chouka.ChouKaModel.SHOW_TIP_END,this,this.onShowEnd);chouka.ChouKaModel.getIns().showTips(t,"flyBack",false)}Laya.timer.once(5e3,this,this.onShowEnd)}else{this.showResult(this.resultData,battle.BattleGuanKaWinView,battle.SbattleGuanKaWinView)}this.award=null};t.prototype.onShowEnd=function(){Laya.timer.clear(this,this.onShowEnd);app.ViewManager.toggleView(chouka.Huodefabaoview,app.AppContainer.flowLayer,-1);chouka.ChouKaModel.getIns().off(chouka.ChouKaModel.SHOW_TIP_END,this,this.onShowEnd);this.showResult(this.resultData,battle.BattleGuanKaWinView,battle.SbattleGuanKaWinView)};t.prototype.dellAward=function(t){var e=this.dropPosMap[t.charactorVO.pos];if(e){var i=Laya.Pool.getItemByClass(battle.SceneAward.SINGLE_KEY,battle.SceneAward);i.x=t.x;i.y=t.y-t.charactorVO.getModelHeight()/2;i.createItem(e,t.y);scene.SceneMediator.getInstance().addIsoObj(i);var n=csv.ItemProxy.getIns().itemCfgMap[e];i.boFabao=Boolean(n.type==csv.ItemProxy.TYPES.FA_BAO);i.handler=this.step3Handler;this.award=i}};t.SINGLE_KEY="MapGuankaControl";return t}(e.MapBaseControl);e.MapGuankaControl=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(i){var t=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t.maptype=csv.MapProxy.MAP_TYPE.GUILD_BOSS;t.battletype=battle.BattleConst.BATTLE_TYPE.GUILD_BOSS;t.buffImg=new Laya.Image;t.buffImg.skin="res/icon/buff/pkdaren.png";t.buffImg.x=20;t.buffImg.y=220;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.showUi=function(){e.prototype.showUi.call(this);this.buffImg.on(Laya.Event.CLICK,this,this.onClickBuffIcon);app.ViewManager.toggleView(i.LeftIconList,app.AppContainer.uiIconLayer,1);app.ViewManager.toggleView(i.BossExitView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(battle.GuildBossWorldRankView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(battle.GuildBossRunTimeView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(chat.ChatMiniView,app.AppContainer.uiLayer,1);this.funcId=csv.FunctionsProxy.ENUMS.GUILDBOSS};t.prototype.hideUi=function(){e.prototype.hideUi.call(this);this.buffImg.off(Laya.Event.CLICK,this,this.onClickBuffIcon);app.ViewManager.toggleView(i.LeftIconList,app.AppContainer.uiIconLayer,-1);app.ViewManager.toggleView(battle.GuildBossHurtView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(i.BossExitView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.GuildBossWorldRankView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.GuildBossRunTimeView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,-1);app.ViewManager.toggleView(chat.ChatMiniView,app.AppContainer.uiLayer,-1);this.hideBuffIcon();this.model.clearSeverRobots();boss.BossModel.getIns().clearBelongInfo();battle.BossBattleResultView.close()};t.prototype.startGame=function(){e.prototype.startGame.call(this);guildboss.GuildBossModel.getIns().on(guildboss.GuildBossModel.UPDATE_ROLENUM_HURT,this,this.showBuffIcon);app.ViewManager.toggleView(battle.GuildBossHurtView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,1);this.showBuffIcon();this.model.createSeverRobots();this.manager.boSceneEnd=true};t.prototype.stopGame=function(){e.prototype.stopGame.call(this);guildboss.GuildBossModel.getIns().off(guildboss.GuildBossModel.UPDATE_ROLENUM_HURT,this,this.showBuffIcon);app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,-1);app.ViewManager.toggleView(battle.GuildBossHurtView,app.AppContainer.uiLayer,-1)};t.prototype.setBattleResult=function(t,e){if(e===void 0){e=1e3}if(t.result==2){battle.BossBattleResultView.open(t,app.getLang(csv.FunctionsProxy.getIns().getCfg(csv.FunctionsProxy.ENUMS.GUILDBOSS).buttonname))}else{battle.BossBattleResultView.closeAll();app.ViewManager.toggleView(battle.GuildBossRunTimeView,app.AppContainer.uiLayer,-1);if(e){Laya.timer.once(e,this,this.setBattleResult,[t,0]);return}this.showResult(t,battle.BattleGuildBossResultView,battle.SbattleGuildBossResultView)}};t.prototype.showBuffIcon=function(){var t=guildboss.GuildBossModel.getIns().role_size;var e=dailytask.DailyTaskModel.getIns().getOpenActivityByType(csv.ActivityFunction.ENUM.GUILD_BOSS);if(e){var i=e.param3.split(";");var n=parseInt(i[0].split("-")[0]);if(t>=n){if(!this.buffImg.parent){app.AppContainer.uiLayer.addChild(this.buffImg)}}else{this.hideBuffIcon()}}};t.prototype.hideBuffIcon=function(){if(this.buffImg.parent){app.AppContainer.uiLayer.removeChild(this.buffImg)}};t.prototype.onClickBuffIcon=function(){app.ViewManager.toggleDialog(tip.TipSimpleMeiator,1,0,[battle.GuildBossBuffTips])};t.SINGLE_KEY="MapGuildBossControl";return t}(i.MapBaseControl);i.MapGuildBossControl=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(t){var e=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t.maptype=csv.MapProxy.MAP_TYPE.PATA;t.battletype=battle.BattleConst.BATTLE_TYPE.TASK;t.step1Handler=new Laya.Handler(t,t.showStep1);t.step2Handler=new Laya.Handler(t,t.showStep2);t.step3Handler=new Laya.Handler(t,t.showStep3);t.step4Handler=new Laya.Handler(t,t.showStep4);t.talkHandler=new Laya.Handler(t,t.hideStory);return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.showUi=function(){e.prototype.showUi.call(this)};t.prototype.hideUi=function(){e.prototype.hideUi.call(this);app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,-1)};t.prototype.startGame=function(){e.prototype.startGame.call(this);this.setMonsterEnterMove();Laya.timer.once(1e3,this,this.delayTalk)};t.prototype.stopGame=function(){e.prototype.stopGame.call(this);talk.TalkModel.getIns().callBack=this.talkHandler;talk.TalkModel.getIns().event(talk.TalkModel.STORY_TIGGER,csv.StoriesProxy.ENUM_TIGGER.BATTLE_END);app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,-1)};t.prototype.delayTalk=function(){var t=this.model.battleval[0];var e=csv.TaskProxy.getIns().getCfg(t);talk.TalkModel.getIns().createPlotid(e.story);talk.TalkModel.getIns().callBack=this.step1Handler;talk.TalkModel.getIns().event(talk.TalkModel.STORY_TIGGER,csv.StoriesProxy.ENUM_TIGGER.BATTLE_START)};t.prototype.hideStory=function(){app.ProtocolRequest.BattleShowEndReq(this.model.battleid)};t.prototype.showStep1=function(){talk.TalkModel.getIns().callBack=this.step2Handler;talk.TalkModel.getIns().event(talk.TalkModel.STORY_TIGGER,csv.StoriesProxy.ENUM_TIGGER.BATTLE_START)};t.prototype.showStep2=function(){app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,1,[this.step3Handler])};t.prototype.showStep3=function(){talk.TalkModel.getIns().callBack=this.step4Handler;talk.TalkModel.getIns().event(talk.TalkModel.STORY_TIGGER,csv.StoriesProxy.ENUM_TIGGER.WUXING_END)};t.prototype.showStep4=function(){scene.SceneMediator.getInstance().useCameraCenter(true);this.manager.boSceneEnd=true};t.SINGLE_KEY="MapHideControl";return t}(t.MapBaseControl);t.MapHideControl=e})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(i){var t=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t.maptype=csv.MapProxy.MAP_TYPE.HOME;t.showClose=false;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.showUi=function(){e.prototype.showUi.call(this);app.ViewManager.toggleView(i.RightIconList,app.AppContainer.uiIconLayer,1);app.ViewManager.toggleView(i.LeftIconList,app.AppContainer.uiIconLayer,1);app.ViewManager.toggleView(i.HintIconList,app.AppContainer.uiIconLayer,1);app.ViewManager.toggleView(i.RedPackageList,app.AppContainer.uiIconLayer,1);app.ViewManager.toggleView(i.RightTopIconList,app.AppContainer.uiIconLayer,1);app.ViewManager.toggleView(i.TaskMainEnterView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(chat.ChatMiniView,app.AppContainer.uiLayer,1,null,null,null,0);app.ViewManager.toggleView(i.BigRightTopList,app.AppContainer.uiIconLayer,1);app.ViewManager.toggleView(i.BigLeftTopList,app.AppContainer.uiIconLayer,1);dailytask.DailyTaskModel.getIns().on(dailytask.DailyTaskModel.OPEN_ACTIVITY_CHANGE,this,this.playBgm)};t.prototype.hideUi=function(){e.prototype.hideUi.call(this);app.ViewManager.toggleView(i.RightIconList,app.AppContainer.uiIconLayer,-1);app.ViewManager.toggleView(i.LeftIconList,app.AppContainer.uiIconLayer,-1);app.ViewManager.toggleView(i.RedPackageList,app.AppContainer.uiIconLayer,-1);app.ViewManager.toggleView(i.HintIconList,app.AppContainer.uiIconLayer,-1);app.ViewManager.toggleView(i.RightTopIconList,app.AppContainer.uiIconLayer,-1);app.ViewManager.toggleView(i.TaskMainEnterView,app.AppContainer.uiLayer,-1);dailytask.DailyTaskModel.getIns().off(dailytask.DailyTaskModel.OPEN_ACTIVITY_CHANGE,this,this.playBgm);app.ViewManager.toggleView(chat.ChatMiniView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(i.BigRightTopList,app.AppContainer.uiIconLayer,-1);app.ViewManager.toggleView(i.BigLeftTopList,app.AppContainer.uiIconLayer,-1);if(app.ViewManager.DisplayedInStage(rebirth.ShangXiangTeXiaoView.SINGLE_KEY)){app.ViewManager.toggleView(rebirth.ShangXiangTeXiaoView,app.AppContainer.uiLayer,-1);game.SceneModel.clearAllScreenSp()}};t.SINGLE_KEY="MapHomeControl";return t}(i.MapBaseControl);i.MapHomeControl=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(n){var i=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t.skin="bosszhandou/bg_jiaobiao_yijisha.png";t.on(Laya.Event.DISPLAY,t,t.onDisplay);t.on(Laya.Event.UNDISPLAY,t,t.onUnDisplay);return t}t.prototype.onDisplay=function(){this.visible=false;this.y=app.AppContainer.UI_LAYER_Y.LEFT_ICON;guardisland.GuardIslandsModel.getIns().on(guardisland.GuardIslandsModel.EVENT_UPDATE_BOSS_ICON,this,this.updateBossIcon);guardisland.GuardIslandsModel.getIns().once(guardisland.GuardIslandsModel.EVENT_UPDATE_BOSS_FLAG,this,this.onGetBossFlag);app.ProtocolRequest.GuardBossReq()};t.prototype.onGetBossFlag=function(t){this.visible=t==0};t.prototype.onUnDisplay=function(){guardisland.GuardIslandsModel.getIns().off(guardisland.GuardIslandsModel.EVENT_UPDATE_BOSS_ICON,this,this.updateBossIcon)};t.prototype.updateBossIcon=function(){var t=guardisland.GuardIslandsModel.getIns().isBossDead();this.visible=t};return t}(Laya.Button);var t=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t.maptype=csv.MapProxy.MAP_TYPE.HULU_DAO;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.onTouchRock=function(t){if(t==1){this.onClickSceneHandler()}};t.prototype.showUi=function(){e.prototype.showUi.call(this);guardisland.GuardIslandsModel.getIns().on(guardisland.GuardIslandsModel.EVENT_UPDATA_MAP_ITEMS,this,this.updateItemHandler);this.updateItemHandler();app.ViewManager.toggleView(n.HuLuDaoMiniMap,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(n.LeftIconList,app.AppContainer.uiIconLayer,1);app.ViewManager.toggleView(guardisland.GuardRightBottomView,app.AppContainer.uiLayer,1);var t=guardisland.GuardIslandsModel.getIns().vo.getCutDownSec();if(t>0){app.ViewManager.toggleView(guardisland.ShouhuhulutimestartView,app.AppContainer.uiLayer,1,[t])}app.ViewManager.toggleView(guardisland.ShouhuHuluDaoCutDownView,app.AppContainer.uiLayer,1);game.SceneModel.getInstance().on(game.SceneModel.EVENT_TOUCH_ROCKET,this,this.onTouchRock);game.SceneModel.getInstance().on(game.SceneModel.EVENT_CLICK,this,this.onClickSceneHandler);game.Context.on(game.SceneModel.EVENT_ERROR_TIP,this,this.errorTipHandler);if(!this.bossIcon){this.bossIcon=new i}app.AppContainer.flyLayer.addChild(this.bossIcon);guardisland.GuardIslandsModel.getIns().startCold()};t.prototype.errorTipHandler=function(t){if(t==game.ERROR_TIP_CODE.CollectFail||t==game.ERROR_TIP_CODE.OtherPlayerCollect||t==game.ERROR_TIP_CODE.CollectFar){guardisland.GuardIslandsModel.getIns().stopCold()}};t.prototype.onClickSceneHandler=function(){guardisland.GuardIslandsModel.getIns().stopAutoFight()};t.prototype.updateItemHandler=function(){var t=guardisland.GuardIslandsModel.getIns().isMonsterInMap();var e=app.ViewManager.DisplayedInStage(guardisland.GuardleftView.SINGLE_KEY);if(t){if(!e){app.ViewManager.toggleView(guardisland.GuardleftView,app.AppContainer.uiLayer,1)}}else{if(e){app.ViewManager.toggleView(guardisland.GuardleftView,app.AppContainer.uiLayer,-1)}}};t.prototype.hideUi=function(){e.prototype.hideUi.call(this);guardisland.GuardIslandsModel.getIns().off(guardisland.GuardIslandsModel.EVENT_UPDATA_MAP_ITEMS,this,this.updateItemHandler);app.ViewManager.toggleView(n.HuLuDaoMiniMap,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(guardisland.GuardleftView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(n.LeftIconList,app.AppContainer.uiIconLayer,-1);app.ViewManager.toggleView(guardisland.GuardRightBottomView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(guardisland.ShouhuhulutimestartView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(guardisland.ShouhuHuluDaoCutDownView,app.AppContainer.uiLayer,-1);game.SceneModel.getInstance().off(game.SceneModel.EVENT_TOUCH_ROCKET,this,this.onTouchRock);game.SceneModel.getInstance().off(game.SceneModel.EVENT_CLICK,this,this.onClickSceneHandler);game.Context.off(game.SceneModel.EVENT_ERROR_TIP,this,this.errorTipHandler);role.LeadingRoleView.getIns().cancelAI();if(this.bossIcon){this.bossIcon.removeSelf()}};t.SINGLE_KEY="MapHuluDaoWorldControl";return t}(n.MapBaseControl);n.MapHuluDaoWorldControl=t;var e=function(i){__extends(t,i);function t(){var t=i.call(this)||this;var e=new Laya.Button;e.skin="res/static/common/btn_tuichu.png";t.existBtn=e;e.clickHandler=new Laya.Handler(t,t.onExitHanlder);t.maptype=csv.MapProxy.MAP_TYPE.HULU_DAO_MONSTER;t.battletype=battle.BattleConst.BATTLE_TYPE.HULU_DAO_MONSTER_FIGHT;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.updateLayout=function(){this.existBtn.x=Laya.stage.width-this.existBtn.width;this.existBtn.y=ScreenAdapter.OFFSET_Y+47};t.prototype.onExitHanlder=function(){app.ProtocolRequest.LeaveGuardIslandReq()};t.prototype.showUi=function(){i.prototype.showUi.call(this);app.AppContainer.uiLayer.on(Laya.Event.RESIZE,this,this.updateLayout);app.AppContainer.uiLayer.addChild(this.existBtn);this.updateLayout();app.ViewManager.toggleView(n.LeftIconList,app.AppContainer.uiIconLayer,1);app.ViewManager.toggleView(battle.BossHpView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(guardisland.GuardRightBottomView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(guardisland.ShouhuHuluDaoCutDownView,app.AppContainer.uiLayer,1)};t.prototype.hideUi=function(){i.prototype.hideUi.call(this);this.existBtn.removeSelf();app.AppContainer.uiLayer.off(Laya.Event.RESIZE,this,this.updateLayout);app.ViewManager.toggleView(n.LeftIconList,app.AppContainer.uiIconLayer,-1);app.ViewManager.toggleView(battle.BossHpView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(guardisland.GuardRightBottomView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(guardisland.ShouhuHuluDaoCutDownView,app.AppContainer.uiLayer,-1);this.model.clearSeverRobots()};t.prototype.startGame=function(){i.prototype.startGame.call(this);this.model.createSeverRobots()};t.prototype.stopGame=function(){i.prototype.stopGame.call(this)};t.prototype.setBattleResult=function(t,e){if(e===void 0){e=1e3}if(e){Laya.timer.once(e,this,this.setBattleResult,[t,0]);return}if(t.result==battle.BattleConst.BATTLE_RESULT_TYPE.WIN){guardisland.GuardIslandsModel.getIns().startCold();if(t.battletype==battle.BattleConst.BATTLE_TYPE.HULU_DAO_MONSTER_FIGHT){guardisland.GuardIslandsModel.getIns().showSucceed(t)}else{guardisland.GuardIslandsModel.getIns().showBossSucceed(t)}}else{guardisland.GuardIslandsModel.getIns().stopCold();guardisland.GuardIslandsModel.getIns().showFail(t)}};t.SINGLE_KEY="MapHuluDaoMonsterWorldControl";return t}(n.MapBaseControl);n.MapHuluDaoMonsterWorldControl=e;var a=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t.maptype=csv.MapProxy.MAP_TYPE.HULU_DAO_BOSS;t.battletype=battle.BattleConst.BATTLE_TYPE.HULU_DAO_BOSS_FIGHT;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.showUi=function(){e.prototype.showUi.call(this);app.ViewManager.toggleView(guardisland.ShouhuhuludaofubenjinduView,app.AppContainer.uiLayer,1)};t.prototype.hideUi=function(){e.prototype.hideUi.call(this);app.ViewManager.toggleView(guardisland.ShouhuhuludaofubenjinduView,app.AppContainer.uiLayer,-1)};t.prototype.setBattleResult=function(t,e){if(e===void 0){e=1e3}if(e){Laya.timer.once(e,this,this.setBattleResult,[t,0]);return}if(t.result==battle.BattleConst.BATTLE_RESULT_TYPE.WIN){guardisland.GuardIslandsModel.getIns().startCold();if(t.battletype==battle.BattleConst.BATTLE_TYPE.HULU_DAO_MONSTER_FIGHT){guardisland.GuardIslandsModel.getIns().showSucceed(t)}else{guardisland.GuardIslandsModel.getIns().showBossSucceed(t)}}else{guardisland.GuardIslandsModel.getIns().stopCold();guardisland.GuardIslandsModel.getIns().showFail(t)}};t.SINGLE_KEY="MapHuluDaoBossWorldControl";return t}(e);n.MapHuluDaoBossWorldControl=a})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(i){var t=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t.maptype=csv.MapProxy.MAP_TYPE.BOSS;t.battletype=battle.BattleConst.BATTLE_TYPE.DEFEND_HULU;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.showUi=function(){e.prototype.showUi.call(this);app.ViewManager.toggleView(i.LeftIconList,app.AppContainer.uiIconLayer,1);app.ViewManager.toggleView(battle.HuluDefendHurtRankView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(i.BossExitView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(chat.ChatMiniView,app.AppContainer.uiLayer,1)};t.prototype.hideUi=function(){e.prototype.hideUi.call(this);app.ViewManager.toggleView(battle.BossHpView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(i.LeftIconList,app.AppContainer.uiIconLayer,-1);app.ViewManager.toggleView(battle.HuluDefendHurtRankView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(i.BossExitView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(chat.ChatMiniView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleLimitTimeView,app.AppContainer.uiLayer,-1);this.model.clearSeverRobots()};t.prototype.startGame=function(){e.prototype.startGame.call(this);app.ViewManager.toggleView(battle.BossHpView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(battle.BattleLimitTimeView,app.AppContainer.uiLayer,1);this.model.createSeverRobots();this.manager.boSceneEnd=true};t.prototype.stopGame=function(){e.prototype.stopGame.call(this);app.ViewManager.toggleView(battle.BattleLimitTimeView,app.AppContainer.uiLayer,-1)};t.prototype.setBattleResult=function(t,e){if(e===void 0){e=1e3}if(e){Laya.timer.once(e,this,this.setBattleResult,[t,0]);return}Laya.Dialog.closeAll();app.ViewManager.toggleDialog(battle.BattleHuluDefendResultView,1,0,t)};t.SINGLE_KEY="MapHuluDefendControl";return t}(i.MapBaseControl);i.MapHuluDefendControl=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(t){var e=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t.maptype=csv.MapProxy.MAP_TYPE.DUNGEON;t.battletype=battle.BattleConst.BATTLE_TYPE.HUNT_RICH;t.stepHandler=new Laya.Handler(t,t.showStep);return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.showUi=function(){e.prototype.showUi.call(this);this.funcId=csv.FunctionsProxy.ENUMS.ACT_HUNT_RICH};t.prototype.hideUi=function(){e.prototype.hideUi.call(this);app.ViewManager.toggleView(battle.BattleLevelView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleStartTimeView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleLimitTimeView,app.AppContainer.uiLayer,-1)};t.prototype.startGame=function(){scene.SceneMediator.getInstance().setCameraInit();e.prototype.startGame.call(this);app.ViewManager.toggleView(battle.BattleStartTimeView,app.AppContainer.uiLayer,1,[battle.BattleConst.BATTLE_START_TIME,this.stepHandler]);this.setMonsterEnterMove()};t.prototype.stopGame=function(){e.prototype.stopGame.call(this)};t.prototype.setBattleResult=function(t){this.resultData=t};t.prototype.showStep=function(){app.ViewManager.toggleView(battle.BattleLimitTimeView,app.AppContainer.uiLayer,1);this.model.battleval[1]+=game.Context.getServerTime()-this.manager.battleStartTime;scene.SceneMediator.getInstance().useCameraCenter(true);this.manager.boSceneEnd=true};t.SINGLE_KEY="MapHuntRichControl";return t}(t.MapBaseControl);t.MapHuntRichControl=e})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(i){var t=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t.maptype=csv.MapProxy.MAP_TYPE.PVP;t.battletype=battle.BattleConst.BATTLE_TYPE.PVP_JJC;t.wuxingHandler=new Laya.Handler(t,t.startBattle);t.closeCd=game.Config.getIntParams(604);return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.showUi=function(){e.prototype.showUi.call(this);app.ViewManager.toggleView(i.BattleSpeedView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(i.MoneyView,Laya.stage,-1);app.ViewManager.toggleView(i.RoleInfoView,Laya.stage,-1);this.funcId=csv.FunctionsProxy.ENUMS.NEW_JJC;this.addPass()};t.prototype.hideUi=function(){e.prototype.hideUi.call(this);app.ViewManager.toggleView(i.BattleSpeedView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattlePvpTimeView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattlePvpMineRoleView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattlePvpEnemyRoleView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,-1);this.removePass()};t.prototype.startGame=function(){e.prototype.startGame.call(this);app.ViewManager.toggleView(battle.BattlePvpTimeView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(battle.BattlePvpMineRoleView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(battle.BattlePvpEnemyRoleView,app.AppContainer.uiLayer,1);this.wuxingPk();this.setRolePetShow()};t.prototype.stopGame=function(){e.prototype.stopGame.call(this);if(this.resultData){if(game.Context.battleCamp==this.resultData.result){this.showResult(this.resultData,battle.BattleJjcResultView,battle.SbattleJjcWinView)}else{this.showResult(this.resultData,battle.BattleJjcResultView,battle.SbattleJjcLoseView)}}else{app.ProtocolRequest.BattleShowEndReq(battle.BattleModel.getIns().battleid)}app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,-1)};t.prototype.setBattleResult=function(t){this.resultData=t};t.prototype.wuxingPk=function(){app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,1,[this.wuxingHandler])};t.prototype.startBattle=function(){this.setPvpActMove();battle.BattlePvpTimeView.getIns().startLoopTime();this.model.battleval[1]+=game.Context.getServerTime()-this.manager.battleStartTime;scene.SceneMediator.getInstance().useCameraCenter(true);this.manager.boSceneEnd=true};t.SINGLE_KEY="MapJjcControl";return t}(i.MapBaseControl);i.MapJjcControl=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(i){var t=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t.maptype=csv.MapProxy.MAP_TYPE.DUNGEON;t.battletype=battle.BattleConst.BATTLE_TYPE.KFXL_PVE;t.step1Handler=new Laya.Handler(t,t.showStep1);return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.showUi=function(){e.prototype.showUi.call(this);battle.BattleManager.getIns().on(battle.BattleManager.REPORT_END,this,this.onBattleEnd);app.ViewManager.toggleView(i.LeftIconList,app.AppContainer.uiIconLayer,1);app.ViewManager.toggleView(chat.ChatMiniView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(i.BattleSpeedView,app.AppContainer.uiLayer,1);this.funcId=csv.FunctionsProxy.ENUMS.KUAFU_XIULIAN};t.prototype.hideUi=function(){e.prototype.hideUi.call(this);app.ViewManager.toggleView(i.LeftIconList,app.AppContainer.uiIconLayer,-1);app.ViewManager.toggleView(i.BossExitView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(chat.ChatMiniView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(i.BattleSpeedView,app.AppContainer.uiLayer,-1);battle.BattleManager.getIns().off(battle.BattleManager.REPORT_END,this,this.onBattleEnd)};t.prototype.onBattleEnd=function(){if(battle.BattleManager.getIns().boReportEnd){app.ViewManager.toggleView(i.BossExitView,app.AppContainer.uiLayer,1)}};t.prototype.startGame=function(){e.prototype.startGame.call(this);scene.SceneMediator.getInstance().boInit=true;this.setRoleEnterMove();app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,1,[this.step1Handler])};t.prototype.stopGame=function(){e.prototype.stopGame.call(this);app.ViewManager.toggleView(battle.BattleLimitTimeView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,-1);app.ViewManager.toggleView(battle.BattleZhuxianLevelView,app.AppContainer.uiLayer,-1);var t=yuanshencode.KuafuXiulianModel.getIns();if(t.selfExit){t.selfExit=0;return}if(this.resultData.result==1){this.showResult(this.resultData,battle.BattleKfxlPveResultView,battle.SbattleKfxlPveWinView)}else{this.showResult(this.resultData,battle.BattleKfxlPveResultView,battle.SbattleKfxlPveLoseView)}if(this.resultData.result==1){t.isBattleEnd=1;t.myId=this.resultData.battleval[0].toNumber()}};t.prototype.setBattleResult=function(t){this.resultData=t};t.prototype.showStep1=function(){app.ViewManager.toggleView(battle.BattleLimitTimeView,app.AppContainer.uiLayer,1);scene.SceneMediator.getInstance().useCameraCenter(true);this.manager.boSceneEnd=true};t.SINGLE_KEY="MapKfxlPveControl";return t}(i.MapBaseControl);i.MapKfxlPveControl=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(e){var t=function(i){__extends(t,i);function t(){var t=i.call(this)||this;t.maptype=csv.MapProxy.MAP_TYPE.PVP;t.battletype=battle.BattleConst.BATTLE_TYPE.KFXL_PVP;t.wuxingHandler=new Laya.Handler(t,t.startBattle);return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.showUi=function(){i.prototype.showUi.call(this);battle.BattleManager.getIns().on(battle.BattleManager.REPORT_END,this,this.onBattleEnd);app.ViewManager.toggleView(e.MoneyView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(e.RoleInfoView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(e.MainBottomView,app.AppContainer.uiBottomLayer,-1);this.funcId=csv.FunctionsProxy.ENUMS.KUAFU_XIULIAN};t.prototype.hideUi=function(){i.prototype.hideUi.call(this);battle.BattleManager.getIns().off(battle.BattleManager.REPORT_END,this,this.onBattleEnd);app.ViewManager.toggleView(e.ExitBottomView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattlePvpTimeView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattlePvpMineRoleView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattlePvpEnemyRoleView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,-1)};t.prototype.onBattleEnd=function(){if(battle.BattleManager.getIns().boReportEnd){app.ViewManager.toggleView(e.ExitBottomView,app.AppContainer.uiLayer,1)}};t.prototype.startGame=function(){i.prototype.startGame.call(this);app.ViewManager.toggleView(battle.BattlePvpTimeView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(battle.BattlePvpMineRoleView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(battle.BattlePvpEnemyRoleView,app.AppContainer.uiLayer,1);this.wuxingPk();this.setRolePetShow()};t.prototype.stopGame=function(){var t=game.Context.battleCamp==this.resultData.result;i.prototype.stopGame.call(this);app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,-1);var e=yuanshencode.KuafuXiulianModel.getIns();if(e.selfExit){e.selfExit=0;return}if(t){this.showResult(this.resultData,battle.BattleKfxlPvpResultView,battle.SbattleKfxlPvpWinView,[t])}else{this.showResult(this.resultData,battle.BattleKfxlPvpResultView,battle.SbattleKfxlPvpLoseView,[t])}if(e.boCheckRecord){e.boCheckRecord=false;return}if(t){e.isBattleEnd=1;e.myId=this.resultData.battleval[0].toNumber()}};t.prototype.setBattleResult=function(t){this.resultData=t};t.prototype.wuxingPk=function(){app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,1,[this.wuxingHandler])};t.prototype.startBattle=function(){this.setPvpActMove();battle.BattlePvpTimeView.getIns().startLoopTime();this.model.battleval[1]+=game.Context.getServerTime()-this.manager.battleStartTime;scene.SceneMediator.getInstance().useCameraCenter(true);this.manager.boSceneEnd=true};t.SINGLE_KEY="MapKfxlPvpControl";return t}(e.MapBaseControl);e.MapKfxlPvpControl=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(i){var t=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t.maxLvl=0;t.startLvl=1;t.exp=0;t.maptype=csv.MapProxy.MAP_TYPE.DUNGEON;t.battletype=battle.BattleConst.BATTLE_TYPE.DUNGEON_MJG;t.stepHandler=new Laya.Handler(t,t.showStep);t.shenweiHandler=new Laya.Handler(t,t.delayStopGame);return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.showUi=function(){e.prototype.showUi.call(this);app.ViewManager.toggleView(i.LeftIconList,app.AppContainer.uiIconLayer,1);app.ViewManager.toggleView(battle.BattleRoundView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(battle.BattleLevelInfoView,app.AppContainer.uiLayer,1)};t.prototype.hideUi=function(){e.prototype.hideUi.call(this);app.ViewManager.toggleView(i.LeftIconList,app.AppContainer.uiIconLayer,-1);app.ViewManager.toggleView(battle.BattleLimitTimeView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleRoundView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleLevelInfoView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleLevelView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleStartTimeView,app.AppContainer.uiLayer,-1);this.model.off(battle.BattleModel.MONSTER_DIE_COUNT,this,this.dellAward);this.exp=0};t.prototype.startGame=function(){e.prototype.startGame.call(this);scene.SceneMediator.getInstance().boInit=true;app.ViewManager.toggleView(battle.BattleLevelView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(battle.BattleStartTimeView,app.AppContainer.uiLayer,1,[battle.BattleConst.BATTLE_START_TIME,this.stepHandler]);this.setMonsterEnterMove();this.setRolePetShow();this.model.on(battle.BattleModel.MONSTER_DIE_COUNT,this,this.dellAward)};t.prototype.stopGame=function(){if(skill.ShenWeiSkillEffect.getIns().boShenWei()){skill.ShenWeiSkillEffect.getIns().play(this.shenweiHandler)}else{Laya.timer.once1(1500,this,this.delayStopGame)}};t.prototype.setBattleResult=function(t){};t.prototype.delayStopGame=function(){e.prototype.stopGame.call(this);app.ProtocolRequest.BattleShowEndReq(this.model.battleid);app.ViewManager.toggleView(battle.BattleLimitTimeView,app.AppContainer.uiLayer,-1);i.RoundPassView.getIns().show();this.model.off(battle.BattleModel.MONSTER_DIE_COUNT,this,this.dellAward)};t.prototype.showStep=function(){app.ViewManager.toggleView(battle.BattleLimitTimeView,app.AppContainer.uiLayer,1);this.model.battleval[1]+=game.Context.getServerTime()-this.manager.battleStartTime;scene.SceneMediator.getInstance().useCameraCenter(true);this.manager.boSceneEnd=true};t.prototype.dellAward=function(t){if(!t.parent){return}var e=Laya.Pool.getItemByClass(manager.TailUiFlyItem.SINGLE_KEY,manager.TailUiFlyItem);var i=manager.TailUiFlyItem.changePos(t);var n=battle.BattleLevelInfoView.getIns();var a=manager.TailUiFlyItem.changePos(n);e.init(2,i.x,i.y,a.x+n.width/2,a.y+n.height/2)};t.SINGLE_KEY="MapMjgControl";return t}(i.MapBaseControl);i.MapMjgControl=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(i){var t=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t.maptype=csv.MapProxy.MAP_TYPE.PATA;t.battletype=battle.BattleConst.BATTLE_TYPE.MJ_LOCK;t.step1Handler=new Laya.Handler(t,t.showStep1);return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.showUi=function(){e.prototype.showUi.call(this);app.ViewManager.toggleView(i.LeftIconList,app.AppContainer.uiIconLayer,1);app.ViewManager.toggleView(i.BattleIconList,app.AppContainer.uiIconLayer,1);app.ViewManager.toggleView(i.BossExitView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(i.BattleSpeedView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(chat.ChatMiniView,app.AppContainer.uiLayer,1);this.addPass()};t.prototype.hideUi=function(){e.prototype.hideUi.call(this);app.ViewManager.toggleView(i.LeftIconList,app.AppContainer.uiIconLayer,-1);app.ViewManager.toggleView(i.BattleIconList,app.AppContainer.uiIconLayer,-1);app.ViewManager.toggleView(battle.BattleLimitTimeView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(i.BossExitView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(i.BattleSpeedView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(chat.ChatMiniView,app.AppContainer.uiLayer,-1);if(!this.boWin){mjhole.MjHoleModel.getIns().dellReback()}if(!this.model.isJump){app.ViewManager.toggleDialog(mjhole.MjHoleMainView,1,0,[mjhole.MjHoleModel.getIns().clientMjId,false])}app.ViewManager.toggleDialog(battle.BattleMjLockWinView,-1,0);app.ViewManager.toggleDialog(battle.BattleLoseView,-1,0);this.removePass()};t.prototype.startGame=function(){this.boWin=false;e.prototype.startGame.call(this);scene.SceneMediator.getInstance().boInit=true;this.setRoleEnterMove();app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,1,[this.step1Handler])};t.prototype.stopGame=function(){e.prototype.stopGame.call(this);app.ViewManager.toggleView(battle.BattleLimitTimeView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,-1);app.ViewManager.toggleView(i.BattlePassView,app.AppContainer.uiLayer,-1);app.ProtocolRequest.BattleShowEndReq(this.model.battleid)};t.prototype.showStep1=function(){app.ViewManager.toggleView(battle.BattleLimitTimeView,app.AppContainer.uiLayer,1);this.model.battleval[1]+=game.Context.getServerTime()-this.manager.battleStartTime;scene.SceneMediator.getInstance().useCameraCenter(true);this.manager.boSceneEnd=true};t.prototype.setBattleResult=function(t){if(t.result==battle.BattleConst.BATTLE_RESULT_TYPE.WIN){this.boWin=true;this.showResult(t,battle.BattleMjLockWinView,battle.SbattleMjLockWinView)}else{Laya.Dialog.closeAll();app.ViewManager.toggleView(battle.BattleLoseFullView,app.AppContainer.zhezhaoLayer,1,this.model.battleInfo.defendbuff);app.ProtocolRequest.LeaveDailyDgnReq()}};t.SINGLE_KEY="MapMjLockControl";return t}(i.MapBaseControl);i.MapMjLockControl=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(i){var t=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t.maptype=csv.MapProxy.MAP_TYPE.DUNGEON;t.battletype=battle.BattleConst.BATTLE_TYPE.DUNGEON_MOUNTAIN;t.stepHandler=new Laya.Handler(t,t.showStep);t.closeCd=battle.BattleConst.BATTLE_CLOSE_TIME_ZHUXIAN;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.showUi=function(){e.prototype.showUi.call(this);app.ViewManager.toggleView(i.LeftIconList,app.AppContainer.uiIconLayer,1);app.ViewManager.toggleView(i.BattleIconList,app.AppContainer.uiIconLayer,1);app.ViewManager.toggleView(i.BossExitView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(i.BattleSpeedView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(chat.ChatMiniView,app.AppContainer.uiLayer,1);this.funcId=csv.FunctionsProxy.ENUMS.MOUNTAIN_NEW;this.addPass()};t.prototype.hideUi=function(){e.prototype.hideUi.call(this);app.ViewManager.toggleView(i.LeftIconList,app.AppContainer.uiIconLayer,-1);app.ViewManager.toggleView(i.BattleIconList,app.AppContainer.uiIconLayer,-1);app.ViewManager.toggleView(battle.BattleLimitTimeView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(i.BossExitView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,-1);app.ViewManager.toggleView(i.BattleSpeedView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(chat.ChatMiniView,app.AppContainer.uiLayer,-1);this.removePass()};t.prototype.startGame=function(){e.prototype.startGame.call(this);scene.SceneMediator.getInstance().boInit=true;app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,1,[this.stepHandler]);this.setMonsterEnterMove();this.setRolePetShow()};t.prototype.stopGame=function(){e.prototype.stopGame.call(this);app.ViewManager.toggleView(battle.BattleLimitTimeView,app.AppContainer.uiLayer,-1);app.ProtocolRequest.BattleShowEndReq(this.model.battleid);app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,-1);app.ViewManager.toggleView(i.BattlePassView,app.AppContainer.uiLayer,-1)};t.prototype.setBattleResult=function(t){if(t.result==battle.BattleConst.BATTLE_RESULT_TYPE.WIN){this.showResult(t,battle.BattleMountainWinView,battle.SbattleMountainWinView)}else{this.showResult(t,battle.BattleMountainLoseView,battle.SbattleMountainLoseView)}};t.prototype.showStep=function(){app.ViewManager.toggleView(battle.BattleLimitTimeView,app.AppContainer.uiLayer,1);this.model.battleval[1]+=game.Context.getServerTime()-this.manager.battleStartTime;scene.SceneMediator.getInstance().useCameraCenter(true);this.manager.boSceneEnd=true};t.SINGLE_KEY="MapMountainControl";return t}(i.MapBaseControl);i.MapMountainControl=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(i){var t=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t._stage=1;t.maptype=csv.MapProxy.MAP_TYPE.DUNGEON;t.battletype=battle.BattleConst.BATTLE_TYPE.DUNGEON_NINE_TOWER;t.stepHandler=new Laya.Handler(t,t.showStep);return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.showUi=function(){e.prototype.showUi.call(this);app.ViewManager.toggleView(i.LeftIconList,app.AppContainer.uiIconLayer,1);app.ViewManager.toggleView(i.BossExitView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(tower.AmuletGettedNotice,app.AppContainer.uiLayer,1);game.Context.on(tower.TowerMonsterModel.NINE_BUFF_BUY_Ack,this,this.onNineBuffBuyAck)};t.prototype.hideUi=function(){e.prototype.hideUi.call(this);app.ViewManager.toggleView(i.LeftIconList,app.AppContainer.uiIconLayer,-1);app.ViewManager.toggleView(battle.BattleLimitTimeView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(i.BossExitView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(tower.NineTowerBattleTitle,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(tower.AmuletGettedNotice,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(tower.AmuletView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleStartTimeView,app.AppContainer.uiLayer,-1);game.Context.off(tower.TowerMonsterModel.NINE_BUFF_BUY_Ack,this,this.onNineBuffBuyAck);this._stage=1};t.prototype.onNineBuffBuyAck=function(t){tower.AmuletGettedNotice.getIns().play(t)};t.prototype.startGame=function(){e.prototype.startGame.call(this);this.setMonsterEnterMove();this.setRolePetShow();app.ViewManager.toggleView(battle.BattleStartTimeView,app.AppContainer.uiLayer,1,[game.Config.getIntParams(386),this.stepHandler]);app.ViewManager.toggleView(tower.NineTowerBattleTitle,app.AppContainer.uiLayer,1,this.model.battleval);this._stage=this.model.battleval[0]};t.prototype.stopGame=function(){e.prototype.stopGame.call(this);app.ProtocolRequest.BattleShowEndReq(this.model.battleid);app.ViewManager.toggleView(battle.BattleLimitTimeView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(tower.NineTowerBattleTitle,app.AppContainer.uiLayer,-1)};t.prototype.setBattleResult=function(t){};t.prototype.showStep=function(){app.ViewManager.toggleView(battle.BattleLimitTimeView,app.AppContainer.uiLayer,1);scene.SceneMediator.getInstance().useCameraCenter(true);this.manager.boSceneEnd=true};t.SINGLE_KEY="main.MapNineTowerControl";return t}(i.MapBaseControl);i.MapNineTowerControl=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(t){var e=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t.maptype=csv.MapProxy.MAP_TYPE.DUNGEON;t.battletype=battle.BattleConst.BATTLE_TYPE.PET_DUNGEON;t.stepHandler=new Laya.Handler(t,t.showStep);return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.showUi=function(){e.prototype.showUi.call(this);this.funcId=csv.FunctionsProxy.ENUMS.PET_GEM};t.prototype.onCallFunc=function(){e.prototype.onCallFunc.call(this)};t.prototype.hideUi=function(){e.prototype.hideUi.call(this);app.ViewManager.toggleView(battle.BattleLevelView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleStartTimeView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleLimitTimeView,app.AppContainer.uiLayer,-1)};t.prototype.startGame=function(){scene.SceneMediator.getInstance().setCameraInit();e.prototype.startGame.call(this);app.ViewManager.toggleView(battle.BattleStartTimeView,app.AppContainer.uiLayer,1,[battle.BattleConst.BATTLE_START_TIME,this.stepHandler]);this.setRolePetShow();this.setRoleEnterMove()};t.prototype.stopGame=function(){this.battleTime=this.manager.battleEndTime;e.prototype.stopGame.call(this);app.ProtocolRequest.BattleShowEndReq(this.model.battleid);app.ViewManager.toggleView(battle.BattleLimitTimeView,app.AppContainer.uiLayer,-1)};t.prototype.showStep=function(){app.ViewManager.toggleView(battle.BattleLimitTimeView,app.AppContainer.uiLayer,1);this.model.battleval[1]+=game.Context.getServerTime()-this.manager.battleStartTime;scene.SceneMediator.getInstance().useCameraCenter(true);this.manager.boSceneEnd=true};t.SINGLE_KEY="MapPetControl";return t}(t.MapBaseControl);t.MapPetControl=e})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(i){var t=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t.maptype=csv.MapProxy.MAP_TYPE.PVP;t.battletype=battle.BattleConst.BATTLE_TYPE.PVP_BOSS;t.wuxingHandler=new Laya.Handler(t,t.startBattle);t.closeCd=game.Config.getIntParams(601);return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.showUi=function(){e.prototype.showUi.call(this);app.ViewManager.toggleView(i.MoneyView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(i.RoleInfoView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(i.MainBottomView,app.AppContainer.uiBottomLayer,-1)};t.prototype.hideUi=function(){e.prototype.hideUi.call(this);app.ViewManager.toggleView(battle.BattlePvpTimeView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattlePvpMineRoleView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattlePvpEnemyRoleView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,-1)};t.prototype.startGame=function(){e.prototype.startGame.call(this);app.ViewManager.toggleView(battle.BattlePvpTimeView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(battle.BattlePvpMineRoleView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(battle.BattlePvpEnemyRoleView,app.AppContainer.uiLayer,1);this.wuxingPk();this.setRolePetShow()};t.prototype.stopGame=function(){var t=game.Context.battleCamp==this.resultData.result;e.prototype.stopGame.call(this);app.ViewManager.toggleDialog(battle.BattlePvpResultView,1,0,[this.resultData,t]);app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,-1)};t.prototype.setBattleResult=function(t){this.resultData=t};t.prototype.wuxingPk=function(){app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,1,[this.wuxingHandler])};t.prototype.startBattle=function(){this.setPvpActMove();battle.BattlePvpTimeView.getIns().startLoopTime();this.model.battleval[1]+=game.Context.getServerTime()-this.manager.battleStartTime;scene.SceneMediator.getInstance().useCameraCenter(true);this.manager.boSceneEnd=true};t.SINGLE_KEY="MapPvpControl";return t}(i.MapBaseControl);i.MapPvpControl=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(i){var t=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t.maptype=csv.MapProxy.MAP_TYPE.PVP;t.battletype=battle.BattleConst.BATTLE_TYPE.PVP_GUILD;t.wuxingHandler=new Laya.Handler(t,t.startBattle);t.closeCd=game.Config.getIntParams(604);return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.showUi=function(){e.prototype.showUi.call(this);app.ViewManager.toggleView(i.ExitBottomView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(i.MoneyView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(i.RoleInfoView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(i.MainBottomView,app.AppContainer.uiBottomLayer,-1);this.funcId=csv.FunctionsProxy.ENUMS.GUILD_PK};t.prototype.hideUi=function(){e.prototype.hideUi.call(this);app.ViewManager.toggleView(i.ExitBottomView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattlePvpTimeView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattlePvpMineRoleView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattlePvpEnemyRoleView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,-1)};t.prototype.startGame=function(){e.prototype.startGame.call(this);app.ViewManager.toggleView(battle.BattlePvpTimeView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(battle.BattlePvpMineRoleView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(battle.BattlePvpEnemyRoleView,app.AppContainer.uiLayer,1);this.setRolePetShow();this.wuxingPk()};t.prototype.stopGame=function(){e.prototype.stopGame.call(this);this.resultTime=Laya.timer.currTimer;app.ViewManager.toggleDialog(battle.BattleGuildPvpResultView,1,0,this.resultData);app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,-1)};t.prototype.setBattleResult=function(t){this.resultData=t};t.prototype.wuxingPk=function(){app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,1,[this.wuxingHandler])};t.prototype.startBattle=function(){this.setPvpActMove();battle.BattlePvpTimeView.getIns().startLoopTime();this.model.battleval[1]+=game.Context.getServerTime()-this.manager.battleStartTime;scene.SceneMediator.getInstance().useCameraCenter(true);this.manager.boSceneEnd=true};t.SINGLE_KEY="MapPvpGuildControl";return t}(i.MapBaseControl);i.MapPvpGuildControl=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(i){var t=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t.maptype=csv.MapProxy.MAP_TYPE.PVP;t.battletype=battle.BattleConst.BATTLE_TYPE.PVP_HOME;t.wuxingHandler=new Laya.Handler(t,t.startBattle);t.closeCd=game.Config.getIntParams(601);return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.showUi=function(){e.prototype.showUi.call(this);app.ViewManager.toggleView(i.BattleSpeedView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(i.MoneyView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(i.RoleInfoView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(i.MainBottomView,app.AppContainer.uiBottomLayer,-1);this.addPass()};t.prototype.hideUi=function(){e.prototype.hideUi.call(this);app.ViewManager.toggleView(i.BattleSpeedView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattlePvpTimeView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattlePvpMineRoleView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattlePvpEnemyRoleView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,-1);this.removePass()};t.prototype.startGame=function(){e.prototype.startGame.call(this);app.ViewManager.toggleView(battle.BattlePvpTimeView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(battle.BattlePvpMineRoleView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(battle.BattlePvpEnemyRoleView,app.AppContainer.uiLayer,1);this.wuxingPk();this.setRolePetShow()};t.prototype.stopGame=function(){var t=game.Context.battleCamp==this.resultData.result;e.prototype.stopGame.call(this);this.resultTime=Laya.timer.currTimer;app.ViewManager.toggleDialog(battle.BattlePvpResultView,1,0,[this.resultData,t]);app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,-1)};t.prototype.setBattleResult=function(t){this.resultData=t};t.prototype.wuxingPk=function(){app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,1,[this.wuxingHandler])};t.prototype.startBattle=function(){this.setPvpActMove();battle.BattlePvpTimeView.getIns().startLoopTime();this.model.battleval[1]+=game.Context.getServerTime()-this.manager.battleStartTime;scene.SceneMediator.getInstance().useCameraCenter(true);this.manager.boSceneEnd=true};t.SINGLE_KEY="MapPvpHomeControl";return t}(i.MapBaseControl);i.MapPvpHomeControl=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(i){var t=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t.maptype=csv.MapProxy.MAP_TYPE.PATA;t.battletype=battle.BattleConst.BATTLE_TYPE.BOSS_SecreArea;t.stepHandler=new Laya.Handler(t,t.showStep);return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.showUi=function(){e.prototype.showUi.call(this);app.ViewManager.toggleView(i.LeftIconList,app.AppContainer.uiIconLayer,1);app.ViewManager.toggleView(i.BattleIconList,app.AppContainer.uiIconLayer,1);app.ViewManager.toggleView(chat.ChatMiniView,app.AppContainer.uiLayer,1);this.callback=csv.FunctionsProxy.ENUMS.PASS+"-"+guaji.SecretAreaModel.getIns().activeGuanqia};t.prototype.hideUi=function(){e.prototype.hideUi.call(this);app.ViewManager.toggleView(i.LeftIconList,app.AppContainer.uiIconLayer,-1);app.ViewManager.toggleView(i.BattleIconList,app.AppContainer.uiIconLayer,-1);app.ViewManager.toggleView(battle.BattleLevelView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleStartTimeView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleLimitTimeView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,-1);app.ViewManager.toggleView(chat.ChatMiniView,app.AppContainer.uiLayer,-1)};t.prototype.onCallFunc=function(){if(this.callback&&this.callback.length>0){var t=parseInt(app.str2Array(this.callback,"-")[0]);game.ClosureManager.callFunction(t,true,false,app.str2Array(this.callback,"-")[1])}guaji.SecretAreaModel.getIns().activeGuanqia=0;this.callback=""};t.prototype.startGame=function(){scene.SceneMediator.getInstance().setCameraInit();e.prototype.startGame.call(this);this.setMonsterEnterMove();app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,1,[this.stepHandler])};t.prototype.stopGame=function(){e.prototype.stopGame.call(this);app.ProtocolRequest.BattleShowEndReq(this.model.battleid);app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,-1)};t.prototype.showStep=function(){app.ViewManager.toggleView(battle.BattleLimitTimeView,app.AppContainer.uiLayer,1);scene.SceneMediator.getInstance().useCameraCenter(true);this.manager.boSceneEnd=true};t.SINGLE_KEY="MapSecretAreaControl";return t}(i.MapBaseControl);i.MapSecretAreaControl=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(i){var t=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t.step=1;t.killNum=0;t.maptype=csv.MapProxy.MAP_TYPE.DUNGEON;t.battletype=battle.BattleConst.BATTLE_TYPE.DUNGEON_SSSL;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.showUi=function(){e.prototype.showUi.call(this);app.ViewManager.toggleView(i.LeftIconList,app.AppContainer.uiIconLayer,1);app.ViewManager.toggleView(i.BattleIconList,app.AppContainer.uiIconLayer,1);app.ViewManager.toggleView(battle.BattleLimitTimeView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(battle.BattleScoreView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(i.BossExitView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(battle.BattleLevelInfoView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(chat.ChatMiniView,app.AppContainer.uiLayer,1);this.step=1;this.killNum=0;this.funcId=csv.FunctionsProxy.ENUMS.SHANSHEN_SHILIAN};t.prototype.hideUi=function(){e.prototype.hideUi.call(this);app.ViewManager.toggleView(i.LeftIconList,app.AppContainer.uiIconLayer,-1);app.ViewManager.toggleView(i.BattleIconList,app.AppContainer.uiIconLayer,-1);app.ViewManager.toggleView(battle.BattleLimitTimeView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleScoreView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleLevelInfoView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(i.BossExitView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,-1);app.ViewManager.toggleView(chat.ChatMiniView,app.AppContainer.uiLayer,-1)};t.prototype.startGame=function(){e.prototype.startGame.call(this);app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,1);this.manager.boSceneEnd=true};t.prototype.stopGame=function(){e.prototype.stopGame.call(this);app.ProtocolRequest.BattleShowEndReq(this.model.battleid);app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,-1)};t.prototype.setBattleResult=function(t){app.ViewManager.toggleView(battle.BattleLimitTimeView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleScoreView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleLevelInfoView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,-1);if(t.result==battle.BattleConst.BATTLE_RESULT_TYPE.WIN){this.showResult(t,battle.BattleSsslWinView,battle.SbattleSsslWinView)}else{this.showResult(t,battle.BattleSsslLoseView,battle.SbattleSsslLoseView)}};t.SINGLE_KEY="MapSsslControl";return t}(i.MapBaseControl);i.MapSsslControl=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(i){var t=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t.maptype=csv.MapProxy.MAP_TYPE.DUNGEON;t.battletype=battle.BattleConst.BATTLE_TYPE.DUNGEON_SZJD;t.stepHandler=new Laya.Handler(t,t.showStep);return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.showUi=function(){e.prototype.showUi.call(this);app.ViewManager.toggleView(i.LeftIconList,app.AppContainer.uiIconLayer,1);app.ViewManager.toggleView(i.BattleIconList,app.AppContainer.uiIconLayer,1);app.ViewManager.toggleView(i.BossExitView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(battle.ShanzhongJiudieScoreView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(battle.ShanzhongJiudieStepView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(chat.ChatMiniView,app.AppContainer.uiLayer,1);var t=game.Context.getServerTime()-dailytask.ShanzhongJiudieModel.getIns().szjdStartTime-game.Config.getIntParams(380);if(t<0){app.ViewManager.toggleView(battle.BattleStartTimeView,app.AppContainer.uiLayer,1,[game.Config.getIntParams(380),this.stepHandler])}else{this.showStep()}this.funcId=csv.FunctionsProxy.ENUMS.SHANZHONG_JIUDIE};t.prototype.hideUi=function(){e.prototype.hideUi.call(this);app.ViewManager.toggleView(i.LeftIconList,app.AppContainer.uiIconLayer,-1);app.ViewManager.toggleView(i.BattleIconList,app.AppContainer.uiIconLayer,-1);app.ViewManager.toggleView(i.BossExitView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.ShanzhongJiudieScoreView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.ShanzhongJiudieStepView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleStartTimeView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,-1);app.ViewManager.toggleView(chat.ChatMiniView,app.AppContainer.uiLayer,-1)};t.prototype.startGame=function(){e.prototype.startGame.call(this);app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,1);talk.TalkModel.getIns().event(talk.TalkModel.STORY_TIGGER,csv.StoriesProxy.ENUM_TIGGER.BATTLE_LOOP);this.manager.boSceneEnd=true};t.prototype.stopGame=function(){e.prototype.stopGame.call(this);app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,-1);dailytask.ShanzhongJiudieModel.getIns().playStep()};t.prototype.setBattleResult=function(t,e){app.ViewManager.toggleView(battle.ShanzhongJiudieScoreView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.ShanzhongJiudieStepView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,-1);if(t.result==battle.BattleConst.BATTLE_RESULT_TYPE.WIN){this.showResult(t,battle.BattleSzjdWinView,battle.SbattleSzjdWinView)}else{this.showResult(t,battle.BattleSzjdLoseView,battle.SbattleSzjdLoseView)}};t.prototype.showStep=function(){battle.ShanzhongJiudieScoreView.getIns().startLoopTime();dailytask.ShanzhongJiudieModel.getIns().playStep()};t.SINGLE_KEY="MapSzjdControl";return t}(i.MapBaseControl);i.MapSzjdControl=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(i){var t=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t.maptype=csv.MapProxy.MAP_TYPE.DUNGEON;t.battletype=battle.BattleConst.BATTLE_TYPE.YAODONG;t.stepHandler=new Laya.Handler(t,t.showStep);return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.showUi=function(){e.prototype.showUi.call(this);app.ViewManager.toggleView(i.LeftIconList,app.AppContainer.uiIconLayer,1);app.ViewManager.toggleView(i.BossExitView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(battle.BossHurtRankView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(battle.BattleYaodongInfoView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(battle.BattleYaodongRwdView,app.AppContainer.uiLayer,1)};t.prototype.hideUi=function(){e.prototype.hideUi.call(this);app.ViewManager.toggleView(i.LeftIconList,app.AppContainer.uiIconLayer,-1);app.ViewManager.toggleView(battle.BossHpView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(i.BossExitView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BossHurtRankView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleYdRoundView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleYdJumpView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleYaodongInfoView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleYdLotteryView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleStartTimeView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleYaodongRwdView,app.AppContainer.uiLayer,-1);dailytask.YaoDongModel.getIns().rwdInfo=[];this.model.clearSeverRobots()};t.prototype.startGame=function(){e.prototype.startGame.call(this);var t=game.Context.getServerTime()-this.model.battleval[1];if(t>0){this.showStep()}else{app.ViewManager.toggleView(battle.BattleStartTimeView,app.AppContainer.uiLayer,1,[-t,this.stepHandler]);this.model.createSeverRobots()}this.setBossEnterMove();if(csv.YaoDongProxy.getIns().checkIfJump(this.model.battleval[0])){app.ViewManager.toggleView(battle.BattleYdJumpView,app.AppContainer.uiLayer,1)}};t.prototype.stopGame=function(){e.prototype.stopGame.call(this);app.ViewManager.toggleView(battle.BattleYdJumpView,app.AppContainer.uiLayer,-1)};t.prototype.setBattleResult=function(t){};t.prototype.showStep=function(){if(app.ViewManager.DisplayedInStage(battle.BattleYdRoundView.SINGLE_KEY)){battle.BattleYdRoundView.getIns().showRound()}else{app.ViewManager.toggleView(battle.BattleYdRoundView,app.AppContainer.uiLayer,1)}app.ViewManager.toggleView(battle.BossHpView,app.AppContainer.uiLayer,1)};t.SINGLE_KEY="MapYaoDongControl";return t}(i.MapBaseControl);i.MapYaoDongControl=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(i){var t=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t.maptype=csv.MapProxy.MAP_TYPE.WORLD_BOSS_IN;t.battletype=battle.BattleConst.BATTLE_TYPE.BOSS_YEWAI;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.showUi=function(){e.prototype.showUi.call(this);app.ViewManager.toggleView(i.LeftIconList,app.AppContainer.uiIconLayer,1);app.ViewManager.toggleView(i.BossExitView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(battle.YaowangRankView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(battle.YaowangRunTimeView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(chat.ChatMiniView,app.AppContainer.uiLayer,1);this.funcId=csv.FunctionsProxy.ENUMS.YAO_WANG_BOSS};t.prototype.hideUi=function(){e.prototype.hideUi.call(this);app.ViewManager.toggleView(i.LeftIconList,app.AppContainer.uiIconLayer,-1);app.ViewManager.toggleView(battle.BossHpView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(i.BossExitView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.YaowangRankView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.YaowangRunTimeView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,-1);app.ViewManager.toggleView(chat.ChatMiniView,app.AppContainer.uiLayer,-1);this.model.clearSeverRobots();boss.BossModel.getIns().clearBelongInfo()};t.prototype.startGame=function(){e.prototype.startGame.call(this);app.ViewManager.toggleView(battle.BossHpView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,1);this.model.createSeverRobots();this.manager.boSceneEnd=true};t.prototype.stopGame=function(){e.prototype.stopGame.call(this);app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,-1);app.ViewManager.toggleView(battle.BossHpView,app.AppContainer.uiLayer,-1)};t.prototype.setBattleResult=function(t,e){if(e===void 0){e=1e3}if(t.result==2){var i=csv.BossProxy.getIns().getBossLvName(t.battleval[0].toNumber());battle.BossBattleResultView.open(t,app.getLang("jiesuan_yaowang_name",i))}else{battle.BossBattleResultView.closeAll();app.ViewManager.toggleView(battle.YaowangRunTimeView,app.AppContainer.uiLayer,-1);if(e){Laya.timer.once(e,this,this.setBattleResult,[t,0]);return}if(t.result==3){this.showResult(t,battle.BattleYaowangLoseView,battle.SbattleYaowangLoseView)}else{this.showResult(t,battle.BattleYaowangWinView,battle.SbattleYaowangWinView)}}};t.SINGLE_KEY="MapYaowangControl";return t}(i.MapBaseControl);i.MapYaowangControl=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(e){var t=function(i){__extends(t,i);function t(){var t=i.call(this)||this;t.maptype=csv.MapProxy.MAP_TYPE.PATA;t.battletype=battle.BattleConst.BATTLE_TYPE.ZHUXIAN;t.step1Handler=new Laya.Handler(t,t.showStep1);t.step2Handler=new Laya.Handler(t,t.showStep2);t.step3Handler=new Laya.Handler(t,t.showStep3);t.step4Handler=new Laya.Handler(t,t.showStep4);t.talkHandler=new Laya.Handler(t,t.hideStory);t.closeCd=battle.BattleConst.BATTLE_CLOSE_TIME_ZHUXIAN;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.showUi=function(){i.prototype.showUi.call(this);app.ViewManager.toggleView(e.LeftIconList,app.AppContainer.uiIconLayer,1);app.ViewManager.toggleView(e.BattleIconList,app.AppContainer.uiIconLayer,1);app.ViewManager.toggleView(e.BossExitView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(e.BattleSpeedView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(chat.ChatMiniView,app.AppContainer.uiLayer,1);this.addPass()};t.prototype.hideUi=function(){i.prototype.hideUi.call(this);app.ViewManager.toggleView(e.LeftIconList,app.AppContainer.uiIconLayer,-1);app.ViewManager.toggleView(e.BattleIconList,app.AppContainer.uiIconLayer,-1);app.ViewManager.toggleView(battle.BattleLimitTimeView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleZhuxianLevelView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,-1);app.ViewManager.toggleView(e.BossExitView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(e.BattleSpeedView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(chat.ChatMiniView,app.AppContainer.uiLayer,-1);this.removePass();this.resultData=null;talk.TalkModel.getIns().callBack=null};t.prototype.startGame=function(){i.prototype.startGame.call(this);scene.SceneMediator.getInstance().boInit=true;this.setRoleEnterMove();var t=this.model.battleval[0];var e=csv.DungeonProxy.getIns().getZxrwCfg(t);talk.TalkModel.getIns().createPlotid(e.stories);talk.TalkModel.getIns().event(talk.TalkModel.STORY_TIGGER,csv.StoriesProxy.ENUM_TIGGER.INIT_BATTLE);app.ViewManager.toggleView(battle.BattleZhuxianLevelView,app.AppContainer.uiLayer,1,this.step1Handler)};t.prototype.stopGame=function(){i.prototype.stopGame.call(this);app.ViewManager.toggleView(battle.BattleLimitTimeView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,-1);app.ViewManager.toggleView(battle.BattleZhuxianLevelView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(e.BattlePassView,app.AppContainer.uiLayer,-1);app.ProtocolRequest.BattleShowEndReq(this.model.battleid)};t.prototype.setBattleResult=function(t){if(t.result==battle.BattleConst.BATTLE_RESULT_TYPE.WIN){this.resultData=t;talk.TalkModel.getIns().callBack=this.talkHandler;talk.TalkModel.getIns().event(talk.TalkModel.STORY_TIGGER,csv.StoriesProxy.ENUM_TIGGER.BATTLE_END)}else{Laya.Dialog.closeAll();app.ViewManager.toggleView(battle.BattleLoseFullView,app.AppContainer.zhezhaoLayer,1,this.model.battleInfo.defendbuff);app.ProtocolRequest.LeaveDailyDgnReq()}};t.prototype.hideStory=function(){this.showResult(this.resultData,battle.BattleZhuxianWinView,battle.SbattleZhuxianWinView)};t.prototype.showStep=function(){talk.TalkModel.getIns().callBack=this.step2Handler;talk.TalkModel.getIns().event(talk.TalkModel.STORY_TIGGER,csv.StoriesProxy.ENUM_TIGGER.BATTLE_START)};t.prototype.showStep1=function(){talk.TalkModel.getIns().callBack=this.step2Handler;talk.TalkModel.getIns().event(talk.TalkModel.STORY_TIGGER,csv.StoriesProxy.ENUM_TIGGER.BATTLE_START)};t.prototype.showStep2=function(){app.ViewManager.toggleView(battle.BattleWuxingView,app.AppContainer.uiWuxingLayer,1,[this.step3Handler])};t.prototype.showStep3=function(){talk.TalkModel.getIns().callBack=this.step4Handler;talk.TalkModel.getIns().event(talk.TalkModel.STORY_TIGGER,csv.StoriesProxy.ENUM_TIGGER.WUXING_END)};t.prototype.showStep4=function(){app.ViewManager.toggleView(battle.BattleLimitTimeView,app.AppContainer.uiLayer,1);scene.SceneMediator.getInstance().useCameraCenter(true);this.manager.boSceneEnd=true};t.SINGLE_KEY="MapZhuxianControl";return t}(e.MapBaseControl);e.MapZhuxianControl=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(i){var t=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t.maptype=csv.MapProxy.MAP_TYPE.BOSS;t.battletype=battle.BattleConst.BATTLE_TYPE.DUNGEON_ZJQW;t.stepHandler=new Laya.Handler(t,t.showStep);return t}t.getIns=function(){return app.Singleton.getInstance(t)};Object.defineProperty(t.prototype,"passtime",{get:function(){var t=game.Context.getServerTime()-battle.BattleManager.getIns().battleStartTime;var e=battle.BattleModel.getIns().battleval[1];var i=game.Context.getServerTime()-(e+t);return i},enumerable:true,configurable:true});t.prototype.showUi=function(){e.prototype.showUi.call(this);app.ViewManager.toggleView(i.LeftIconList,app.AppContainer.uiIconLayer,1);app.ViewManager.toggleView(i.BossExitView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(zhenjiuqiwa.WodeshanghaiitemUIView,app.AppContainer.uiLayer,1);app.ViewManager.toggleView(zhenjiuqiwa.DiyijieduanView,app.AppContainer.uiLayer,1);zhenjiuqiwa.ZhenjiuQiWaModel.getIns().on(zhenjiuqiwa.EVENT_ZJQU.UPDDATA_BLOOD,this,this.onUpdateBloodHandler);if(this.passtime>battle.BattleConst.BATTLE_START_TIME-1){this.stepHandler.run()}else{app.ViewManager.toggleView(battle.BattleStartTimeView,app.AppContainer.uiLayer,1,[battle.BattleConst.BATTLE_START_TIME-1,this.stepHandler]);this.setRolePetShow()}app.ViewManager.toggleView(battle.ZjqwBossHpView,app.AppContainer.uiLayer,1);battle.ZjqwBossHpView.getIns().hpMediator.setLabel("×99")};t.prototype.showStep=function(){app.ViewManager.toggleView(battle.BattleShortLimitTimeView,app.AppContainer.uiLayer,1)};t.prototype.onUpdateBloodHandler=function(){var t=zhenjiuqiwa.ZhenjiuQiWaModel.getIns().bloodVO;if(t.changeCnt>=0){battle.ZjqwBossHpView.getIns().hpMediator.setPercentNum(t.percent,t.changeCnt)}};t.prototype.hideUi=function(){e.prototype.hideUi.call(this);app.ViewManager.toggleView(i.LeftIconList,app.AppContainer.uiIconLayer,-1);app.ViewManager.toggleView(i.BossExitView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(zhenjiuqiwa.WodeshanghaiitemUIView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.ZjqwBossHpView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(zhenjiuqiwa.DiyijieduanView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleLimitTimeView,app.AppContainer.uiLayer,-1);zhenjiuqiwa.ZhenjiuQiWaModel.getIns().off(zhenjiuqiwa.EVENT_ZJQU.UPDDATA_BLOOD,this,this.onUpdateBloodHandler);app.ViewManager.toggleView(battle.BattleStartTimeView,app.AppContainer.uiLayer,-1);app.ViewManager.toggleView(battle.BattleShortLimitTimeView,app.AppContainer.uiLayer,-1);battle.ZjqwBossHpView.getIns().hpMediator.setPercentNum(1,0)};t.prototype.startGame=function(){e.prototype.startGame.call(this)};t.prototype.stopGame=function(){e.prototype.stopGame.call(this)};t.prototype.setBattleResult=function(t,e){if(e===void 0){e=1e3}if(e){Laya.timer.once(e,this,this.setBattleResult,[t,0]);return}if(t.result==battle.BattleConst.BATTLE_RESULT_TYPE.WIN){app.ViewManager.toggleDialog(zhenjiuqiwa.ZhengjiuqiwashengliView,1,0,t)}else{app.ViewManager.toggleDialog(battle.BattleLoseView,1,0,t)}};t.prototype.checkIsMainMonster=function(t){if(!this._mainMonsterId){var e=app.Config.getResById("save.csv");var i=e.getArray();for(var n=0,a=i.length;n<a;n++){var o=i[n];if(o.type==1){var s=csv.MonsterProxy.getIns().getMonsterBase(o.monster);var r=app.str2Array(s.battleset,";","-")[0][2];var l=csv.BattleGroupProxy.getIns().getCfg(r);this._mainMonsterId=app.str2Array(l.monster,";","-")[0][1];break}}}return Boolean(t==this._mainMonsterId)};t.SINGLE_KEY="MapZJQWControl";return t}(i.MapBaseControl);i.MapZJQWControl=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(i){var n=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onUnDisplay=function(){this.clean()};e.prototype.setData=function(t){this.fid=t;var e=csv.FunctionsProxy.getIns().getCfg(t);this.label01.text=app.getLang(e.buttonname);this.label02.text=app.getLang("未开启");if(csv.FunctionsProxy.getIns().isOpen(t)){this.updateView()}};e.prototype.clean=function(){Laya.timer.clear(this,this.coolDown);this.endTime=0;this.startTime=0};e.prototype.updateView=function(){this.clean();var t=game.Context.getCurState(this.fid,this.label02);if(this.fid==csv.FunctionsProxy.ENUMS.GUAIJI_MAIN){if(t!=1&&t>0){this.coolDown();Laya.timer.loop(1e3,this,this.coolDown)}}else if(this.fid==csv.FunctionsProxy.ENUMS.MIJING_GUAJI){if(t!=1&&t>0){this.startTime=t;this.coolDown();Laya.timer.loop(1e3,this,this.coolDown)}}else{this.endTime=t;var e=this.endTime-game.Context.getServerTime();if(e>0){this.coolDown();Laya.timer.loop(1e3,this,this.coolDown)}}};e.prototype.coolDown=function(){if(this.endTime>0){var t=this.endTime-game.Context.getServerTime();if(t>=0){this.label02.text=util.TimeUtil.sec2Str(t,false,4,false,true)}else{this.updateView()}}else if(this.fid==csv.FunctionsProxy.ENUMS.GUAIJI_MAIN){this.label02.text=guajiexp.GuajiExpModel.getIns().getGuajiSec2Str()}else if(this.fid==csv.FunctionsProxy.ENUMS.MIJING_GUAJI){var e=guaji.GuajiModel.getIns().getMijingLimitTime();var i=game.Context.getServerTime()-this.startTime;if(i<e){this.label02.text=util.TimeUtil.sec2Str(i,false,4,false,true)}else{this.label02.text=util.TimeUtil.sec2Str(e,false,4,false,true);this.updateView()}}};return e}(ui.jindu.jinduzhanshiitemUI);i.FunProgressitemRender=n;var t=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.zOrder=app.AppContainer.UI_LAYER_NUME.TOP;this.listjindu.itemRender=n;this.listjindu.renderHandler=new Laya.Handler(this,this.onListRenderHandler);this.listjindu.scrollRectOffX=10;this.listjindu.scrollRectOffY=10;var t=app.str2Array(game.Config.getParams(game.ConfigID.FUNIDS),";");this.listjindu.array=t;this.listjindu.height=t.length*26;this.imgdiban01.height=this.listjindu.x+this.listjindu.height+20;this.on(Laya.Event.CLICK,this,this.openView)};t.prototype.openView=function(){app.ViewManager.toggleDialog(i.FunProgressView,1,0)};t.prototype.onResize=function(){this.y=app.AppContainer.UI_LAYER_Y.RIGHT_TOP_ICON+ScreenAdapter.OFFSET_Y+80;this.x=10};t.prototype.onListRenderHandler=function(t){t.setData(parseInt(t.dataSource))};t.prototype.onDisplay=function(){this.onResize();garden.GardenModel.getIns().on(garden.GardenModel.GARDEN_PLANTINFO_UPDATE,this,this.refreshAll);pet.PetModel.getIns().on(pet.PetEvent.PET_EGG_GRID_UPDATE,this,this.refreshAll);guaji.SecretAreaModel.getIns().on(guaji.SecretAreaModel.SECRETAREA_INFO_UPDATE,this,this.refreshAll);this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){garden.GardenModel.getIns().off(garden.GardenModel.GARDEN_PLANTINFO_UPDATE,this,this.refreshAll);pet.PetModel.getIns().off(pet.PetEvent.PET_EGG_GRID_UPDATE,this,this.refreshAll);guaji.SecretAreaModel.getIns().off(guaji.SecretAreaModel.SECRETAREA_INFO_UPDATE,this,this.refreshAll)};t.prototype.refreshAll=function(){this.listjindu.refresh()};t.SINGLE_KEY="main.FunProgressTips";return t}(ui.jindu.jinduzhanshitipUI);i.FunProgressTips=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(i){var n=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.btnjinru.clickHandler=new Laya.Handler(this,this.openView);this.on(Laya.Event.CLICK,this,this.openView);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.endTime=0;this.startTime=0;this.bar.value=0};e.prototype.openView=function(){game.ClosureManager.callFunction(this.fid);app.ViewManager.toggleDialog(i.FunProgressView,-1,0)};e.prototype.onUnDisplay=function(){this.clean()};e.prototype.setData=function(t){this.fid=t;this.imgshalou.visible=false;this.imgbaryellow.visible=true;this.imgbargreen.visible=false;this.labelzhuangtai.text=app.getLang("未开启");this.imgname.skin="jindu/jindu_name_"+t+".png";this.btnjinru.skin="jindu/jindu_icon_"+t+".png";game.RedDotView.removeFrom(this.btnjinru);if(csv.FunctionsProxy.getIns().isOpen(t)){this.updateView()}};e.prototype.clean=function(){Laya.timer.clear(this,this.coolDown);this.endTime=0;this.startTime=0;this.bar.value=0};e.prototype.updateView=function(){this.clean();var t=game.Context.getCurState(this.fid,this.labelzhuangtai,this.bar);if(t==1){game.RedDotView.addTo(this.btnjinru)}if(this.fid==csv.FunctionsProxy.ENUMS.GUAIJI_MAIN){if(guajiexp.GuajiExpModel.getIns().state==4){this.bar.value=1}else{this.bar.value=guajiexp.GuajiExpModel.getIns().getProgress();this.coolDown();Laya.timer.loop(1e3,this,this.coolDown)}}else if(this.fid==csv.FunctionsProxy.ENUMS.MIJING_GUAJI){if(t!=1&&t>0){this.startTime=t;this.coolDown();Laya.timer.loop(1e3,this,this.coolDown)}}else{this.endTime=t;this.imgbaryellow.visible=true;this.imgbargreen.visible=false;var e=0;if(this.fid==csv.FunctionsProxy.ENUMS.PET_EGGS){e=pet.PetModel.getIns().getCoolTime().total*1e3}else if(this.fid==csv.FunctionsProxy.ENUMS.GARDEN_ENTER){e=garden.GardenModel.getIns().getCoolTime().total}this.endTime=t;var i=this.endTime-game.Context.getServerTime();if(i>0){this.imgbaryellow.visible=false;this.imgbargreen.visible=true;this.labelzhuangtai.text=util.TimeUtil.sec2Str(i,false,4,false,true);this.bar.value=(e-i)/e;this.coolDown();Laya.timer.loop(1e3,this,this.coolDown)}}};e.prototype.coolDown=function(){if(this.endTime>0){var t=0;if(this.fid==csv.FunctionsProxy.ENUMS.PET_EGGS){t=pet.PetModel.getIns().getCoolTime().total}else if(this.fid==csv.FunctionsProxy.ENUMS.GARDEN_ENTER){t=garden.GardenModel.getIns().getCoolTime().total}var e=this.endTime-game.Context.getServerTime();if(e>=0){this.bar.value=(t-e)/t;this.labelzhuangtai.text=util.TimeUtil.sec2Str(e,false,4,false,true)}else{this.updateView()}}else if(this.fid==csv.FunctionsProxy.ENUMS.GUAIJI_MAIN){this.labelzhuangtai.text=guajiexp.GuajiExpModel.getIns().getGuajiSec2Str();this.bar.value=guajiexp.GuajiExpModel.getIns().getProgress()}else if(this.fid==csv.FunctionsProxy.ENUMS.MIJING_GUAJI){var i=guaji.GuajiModel.getIns().getMijingLimitTime();var n=game.Context.getServerTime()-this.startTime;if(n<i){this.labelzhuangtai.text=util.TimeUtil.sec2Str(n,false,4,false,true);this.bar.value=n/i}else{this.labelzhuangtai.text=util.TimeUtil.sec2Str(i,false,4,false,true);this.bar.value=1;this.updateView()}}};return e}(ui.jindu.jindukuaijierukouitemUI);i.FunProgressViewRender=n;var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.fullScreen="fullScreen";return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.width=Laya.stage.width;this.height=Laya.stage.height;this.listjindu.anchorX=.5;this.listjindu.itemRender=n;this.listjindu.renderHandler=new Laya.Handler(this,this.onListRenderHandler);this.listjindu.scrollRectOffX=10;this.listjindu.scrollRectOffY=10;var t=app.str2Array(game.Config.getParams(game.ConfigID.FUNIDS),";");this.listjindu.array=t;this.listjindu.height=t.length*100};t.prototype.onListRenderHandler=function(t){t.setData(parseInt(t.dataSource))};t.prototype.onDisplay=function(){this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){};t.prototype.refreshAll=function(){this.listjindu.refresh();this.onResize()};t.prototype.onResize=function(){this.listjindu.x=this.width*.5;this.listjindu.y=(this.height-this.listjindu.height)*.5};t.SINGLE_KEY="main.FunProgressView";return t}(ui.jindu.jindukuaijierukouviewUI);i.FunProgressView=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(a){var t=function(n){__extends(t,n);function t(t,e){if(e===void 0){e=a.IconListBase.SIZE}var i=n.call(this,t,e)||this;i.setTimeLabel();i.showTime=parseInt(app.str2Array(game.Config.getParams(1005),";")[0]);return i}t.prototype.onClick=function(t){t.stopPropagation();this._isClicked=true;this.funcAdapter.changeDot();var e=csv.FunctionsProxy.getIns().convertCanOpenfuncid(this.cfg);if(csv.FunctionsProxy.getIns().isOpen(csv.FunctionsProxy.ENUMS.BOSS_WOLRD)){if(boss.BossModel.getIns().getWRunTime()>0){game.ClosureManager.callFunctionByNpcOpen(csv.FunctionsProxy.ENUMS.BOSS_WOLRD)}else{var i=boss.BossModel.getIns().getNextWComingTime();if(i<=this.showTime){game.ClosureManager.callFunctionByNpcOpen(csv.FunctionsProxy.ENUMS.BOSS_WOLRD)}else{game.ClosureManager.callFunctionByNpcOpen(e)}}}else{game.ClosureManager.callFunctionByNpcOpen(e)}};t.prototype.onDisplay=function(){n.prototype.onDisplay.call(this);boss.BossModel.getIns().on(boss.BossEvent.BOSS_WORLD_TIME_START,this,this.refreshAll);this.callLater(this.refreshAll)};t.prototype.onUndisplay=function(){n.prototype.onUndisplay.call(this);csv.FunctionsProxy.getIns().off(csv.FunctionsProxy.EVENTS.CHANGE,this,this.checkOpen);boss.BossModel.getIns().off(boss.BossEvent.BOSS_WORLD_TIME_START,this,this.refreshAll);this.timeView&&this.timeView.stop()};t.prototype.refreshAll=function(){if(csv.FunctionsProxy.getIns().isOpen(csv.FunctionsProxy.ENUMS.BOSS_WOLRD)){csv.FunctionsProxy.getIns().off(csv.FunctionsProxy.EVENTS.ADD,this,this.checkOpen);var t=boss.BossModel.getIns().getNextWComingTime();if(t<=this.showTime){if(!this.timeView){this.timeView=new activitytaren.ActivityTimeView(this.lblTime,new Laya.Handler(this,this.onEnd),undefined,undefined,activitytaren.ActivityTimeView.TYPE_COLON_HIDE_HOUR)}this.lblTime.visible=true;this.timeView.timeStr="bosskingmaintime_1";this.lblTime.color=game.STYLES.RED_COLOR;this.timeView.start(t+game.Context.getServerTime())}else{this.onEnd();this.timeView&&this.timeView.stop()}}else{csv.FunctionsProxy.getIns().on(csv.FunctionsProxy.EVENTS.ADD,this,this.checkOpen)}};t.prototype.checkOpen=function(t){if(t.id==csv.FunctionsProxy.ENUMS.BOSS_WOLRD){this.refreshAll()}};t.prototype.onEnd=function(){this.lblTime&&(this.lblTime.text="");this.lblTime.visible=false};return t}(a.MainUIIcon);a.BossWorldIcon=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(a){var t=function(n){__extends(t,n);function t(t,e){if(e===void 0){e=a.MainUIIcon.SIZE}var i=n.call(this,t,e)||this;i._model=guild.GuildPkModel.getIns();i._model.on(guild.GuildPkModel.INIT,i,i.setIcon);i.setIcon();return i}t.prototype.setIcon=function(){var t=this._model.info;if(!t){return}var e=csv.CycleActivityFunction.getIns().getCfg(t.actid);if(!e){return}if(e.type==2){this.skin="res/static/mainicon/btn_sub_kuafuzhengba.png"}};return t}(a.MainUIIcon);a.GuildPkUIIcon=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(a){var t=function(n){__extends(t,n);function t(t,e){if(e===void 0){e=a.MainUIIcon.SIZE}var i=n.call(this,t,e)||this;friend.FriendModel.getIns().on(friend.FriendEvent.EVENT.SHENGQING_CHANGE,i,i.onFriendShengQian);chat.ChatModel.getIns().on(chat.ChatModel.CHAT_SILIAO_CHANGE,i,i.onPMChange);chat.ChatModel.getIns().on(chat.ChatModel.CHAT_UNREAD_MSG,i,i.onFriendShengQian);i.onFriendShengQian();return i}t.prototype.onFriendShengQian=function(){if(chat.ChatModel.getIns().hasNewPM){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.SILIAO)}else{game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.SILIAO)}if(friend.FriendModel.getIns().getApplyList().length>0){game.ClosureManager.addXin(csv.FunctionsProxy.ENUMS.FRIEND_APPLY_LIST)}else{game.ClosureManager.removeXin(csv.FunctionsProxy.ENUMS.FRIEND_APPLY_LIST)}};t.prototype.onPMChange=function(t){this.onFriendShengQian()};t.prototype.redChange=function(t){n.prototype.redChange.call(this,t);if(game.ClosureManager.hasDot(csv.FunctionsProxy.ENUMS.MAIL)){if(!this.mailIcon){this.mailIcon=new Laya.Image;this.mailIcon.skin="main/bg_main_xinyoujian.png";this.mailIcon.x=36;this.mailIcon.y=28}this.addChild(this.mailIcon)}else{this.mailIcon&&this.mailIcon.removeSelf()}};return t}(a.MainUIIcon);a.HaoYouIcon=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(u){var t=function(t){__extends(p,t);function p(){return t!==null&&t.apply(this,arguments)||this}p.getIns=function(){return app.Singleton.getInstance(p)};p.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.upLimitY=app.AppContainer.UI_LAYER_Y.RIGHT_ICON+u.LeftIconList.OFFY+u.LeftIconList.GAP+ScreenAdapter.OFFSET_Y+(u.LeftIconList.SIZE+u.LeftIconList.GAP)*app.AppContainer.LEFT_ROWS};p.prototype.onDisplay=function(){this.callLater(this.refreshAll)};p.prototype.onUnDisplay=function(){};p.prototype.refreshAll=function(){this.box.removeChildren();var t=this.dataSource[0];this.currId=t.id;var e=this.dataSource[1];if(t.arrang==csv.MainIconProxy.mainRightGroup){this.imgbg.scaleX=-1;this.x=e.x+10;this.y=e.y+20}else{this.imgbg.scaleX=1;this.x=e.x-10-this.width;this.y=e.y+20}this.imgjiantou.y=30;var i=csv.MainIconProxy.getIns().linkMaindlgs[t.id];var n=0;var a=[];for(var o=0;o<i.length;++o){var s=parseInt(i[o]);if(csv.FunctionsProxy.getIns().isCanAddMainIcon(s)){var r=csv.MainIconProxy.getIns().getCfg(s);var l=u.MainUIIcon.createButton(r,p.SIZE);l.x=0;l.y=n*(p.SIZE+p.GAP);n++;a.push(l)}}this.height=this.box.y+n*p.SIZE+(n-1)*p.GAP+22;this.imgbg.height=this.height+2;if(this.y+this.height>this.upLimitY){var h=this.upLimitY-this.height;this.imgjiantou.y+=this.y-h;this.y=h}for(var o=0;o<a.length;++o){this.box.addChild(a[o])}};p.SINGLE_KEY="main.MainUIIconList";p.SIZE=94;p.GAP=10;return p}(ui.main.mainiconzhankaiviewUI);u.MainUIIconList=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(h){var t=function(s){__extends(r,s);function r(t,e){if(e===void 0){e=r.SIZE}var i=s.call(this)||this;i.boShow=false;i._hasEffect=false;i.boLink=true;i.skin=t;var n=i.width;var a=i.height;var o=1;if(n>0&&a>0){o=a/n}i.width=e;i.height=e*o;i.on(Laya.Event.DISPLAY,i,i.onDisplay);i.on(Laya.Event.UNDISPLAY,i,i.onUndisplay);return i}r.prototype.onOtherFuncRed=function(){if(r.redList.indexOf(this.id)==-1){game.RedDotView.removeFrom(this)}else{game.RedDotView.addTo(this)}};r.prototype.onDisplay=function(){game.Context.on(game.ContextEvent.OTHER_FUNCTION_DOT_CHANGE,this,this.onOtherFuncRed);if(this.id==h.MainUIOtherIcon.Enum_OTHER_FUNC.PINGBI){battle.BattleModel.getIns().on(battle.BattleModel.SHIELD_CHANGE,this,this.onShieldHandler);this.onShieldHandler()}else if(this.id==h.MainUIOtherIcon.Enum_OTHER_FUNC.INSPIRE){this.addChild(h.BuffOnBattle.getIns())}else if(this.id==h.MainUIOtherIcon.Enum_OTHER_FUNC.JI_LI){this.addChild(h.BuffOnBattle.getIns())}this.boShow=true;this.callLater(this.onOtherFuncRed)};r.prototype.onUndisplay=function(){game.Context.off(game.ContextEvent.OTHER_FUNCTION_DOT_CHANGE,this,this.onOtherFuncRed);if(this.id==h.MainUIOtherIcon.Enum_OTHER_FUNC.PINGBI){battle.BattleModel.getIns().off(battle.BattleModel.SHIELD_CHANGE,this,this.onShieldHandler)}this.boShow=false;if(this.lblTime){this.gray=false;util.SpriteLinkUtil.removeLinkChild(this,this.lblTime);Laya.timer.clear(this,this.startLoop)}};r.prototype.setEffect=function(t,e){if(e===void 0){e=""}t=t||"";var i=t!="";if(this._hasEffect==i){if(!i&&this.effect){this.effect.visible=false;util.SpriteLinkUtil.removeLinkChild(this,this.effect)}return}this._hasEffect=i;if(t!=""){if(!this.effect){this.effect=Laya.Pool.getItemByClass(t,Laya.Animation);this.effect.interval=100}this.effect.loadAtlas("res/atlas/effect/main/"+t+".atlas");this.effect.play();this.effOffX=0;this.effOffY=0;util.SpriteLinkUtil.addLinkChild(this,this.effect,app.AppContainer.uiEffectLayer,this.effOffX,this.effOffY,true);this.effect.visible=true}else{if(this.effect){this.effect.visible=false;util.SpriteLinkUtil.removeLinkChild(this,this.effect)}}};r.prototype.onShieldHandler=function(){var t=battle.BattleModel.getIns().boShield==false?"btn_weipingbi":"btn_pingbi";t="res/static/mainicon/"+t+".png";this.skin=t};r.prototype.setTimeLabel=function(){if(!this.lblTime){this.lblTime=new Laya.Label;this.lblTime.width=200;this.lblTime.color=game.STYLES.RED_COLOR_S;this.lblTime.fontSize=18;this.lblTime.font="SimHei";this.lblTime.bold=true;this.lblTime.align="center"}util.SpriteLinkUtil.addLinkChild(this,this.lblTime,app.AppContainer.uiLayer,this.width/2-100,73,true);this.startLoop();Laya.timer.loop(1e3,this,this.startLoop)};r.prototype.startLoop=function(){var t=this.clickCd-game.Context.getServerTime();if(t<=0){util.SpriteLinkUtil.removeLinkChild(this,this.lblTime);Laya.timer.clear(this,this.startLoop);this.gray=false}else{this.lblTime.text=util.TimeUtil.formatTime(t,false);this.gray=true}};r.createButton=function(t,e,i){if(e===void 0){e=r.SIZE}if(i===void 0){i=true}if(i&&r.iconMap[t]){var n=r.iconMap[t];Laya.Tween.clearAll(n);n.clickCd=0;return n}var a;if(t==h.MainUIOtherIcon.Enum_OTHER_FUNC.AUTO_FIGHT){a=new h.AutoFightIcon(h.MainUIOtherIcon.Enum_OTHER_FUNC_URL[t])}else{a=new h.MainUIOtherIcon(h.MainUIOtherIcon.Enum_OTHER_FUNC_URL[t])}a.id=t;if(i){r.iconMap[t]=a}a.stateNum=1;a.on(Laya.Event.CLICK,this,this.onClickButton);return a};r.onClickButton=function(t){t.stopPropagation();var e=t.target;var i=e.id;switch(i){case h.MainUIOtherIcon.Enum_OTHER_FUNC.INSPIRE:if(app.ViewManager.DisplayedInStage(battle.InspireNormalView.SINGLE_KEY)){app.ViewManager.toggleDialog(battle.InspireNormalView,-1,0)}else{app.ViewManager.toggleDialog(battle.InspireNormalView,1,0);guide.OtherGuideItem.getIns().hide()}break;case h.MainUIOtherIcon.Enum_OTHER_FUNC.SHOUHU:if(app.ViewManager.DisplayedInStage(battle.ShouhuBuyView.SINGLE_KEY)){app.ViewManager.toggleDialog(battle.ShouhuBuyView,-1,0)}else{app.ViewManager.toggleDialog(battle.ShouhuBuyView,1,0)}break;case h.MainUIOtherIcon.Enum_OTHER_FUNC.PINGBI:battle.BattleModel.getIns().boShield=!battle.BattleModel.getIns().boShield;break;case h.MainUIOtherIcon.Enum_OTHER_FUNC.CHAT:app.ViewManager.toggleDialog(chat.ChatView,1,0);break;case h.MainUIOtherIcon.Enum_OTHER_FUNC.BOSSLIST:break;case h.MainUIOtherIcon.Enum_OTHER_FUNC.BOSSLIST_KUAFU:if(app.ViewManager.DisplayedInStage(boss.BossKuaFuSmallView.SINGLE_KEY)){app.ViewManager.toggleDialog(boss.BossKuaFuSmallView,-1,0)}else{app.ViewManager.toggleDialog(boss.BossKuaFuSmallView,1,0)}break;case h.MainUIOtherIcon.Enum_OTHER_FUNC.BOSS_KUAFU_HELP:boss.BossModel.getIns().bossKuaFuHelp(t.target);break;case h.MainUIOtherIcon.Enum_OTHER_FUNC.DATI:dailytask.BubbleModel.getIns().showAnswerView();break;case h.MainUIOtherIcon.Enum_OTHER_FUNC.KUNGFU:if(app.ViewManager.DisplayedInStage(dailytask.KungfuView.SINGLE_KEY)){app.ViewManager.toggleDialog(dailytask.KungfuView,-1,0)}else{app.ViewManager.toggleDialog(dailytask.KungfuView,1,0)}break;case h.MainUIOtherIcon.Enum_OTHER_FUNC.EXP:if(app.ViewManager.DisplayedInStage(battle.ExpUpView.SINGLE_KEY)){app.ViewManager.toggleDialog(battle.ExpUpView,-1,0)}else{app.ViewManager.toggleDialog(battle.ExpUpView,1,0)}break;case h.MainUIOtherIcon.Enum_OTHER_FUNC.RWD_YD:if(app.ViewManager.DisplayedInStage(dailytask.YaoDongRwdOwnerView.SINGLE_KEY)){app.ViewManager.toggleDialog(dailytask.YaoDongRwdOwnerView,-1,0)}else{app.ViewManager.toggleDialog(dailytask.YaoDongRwdOwnerView,1,0)}break;case h.MainUIOtherIcon.Enum_OTHER_FUNC.AMULET:if(app.ViewManager.DisplayedInStage(tower.AmuletView.SINGLE_KEY)){app.ViewManager.toggleView(tower.AmuletView,app.AppContainer.uiLayer,-1)}else{app.ViewManager.toggleView(tower.AmuletView,app.AppContainer.uiLayer,1)}break;case h.MainUIOtherIcon.Enum_OTHER_FUNC.MOBAI:var n=dailytask.DailyTaskModel.getIns().getOpenActivityByType(csv.ActivityFunction.ENUM.MO_BAI);if(n){role.LeadingRoleView.getIns().aiTalk(csv.NpcProxy.getIns().getNpcVO(n.npc),ai.NpcTalkAI.ENUM_TYPE.CALL,Laya.Handler.create(this,function(){app.ProtocolRequest.HomeWorshipStartReq()}))}break;case h.MainUIOtherIcon.Enum_OTHER_FUNC.ZONGMEN_MEMBER:app.ViewManager.toggleDialog(guardisland.BanghuichengyView,1,0);break;case h.MainUIOtherIcon.Enum_OTHER_FUNC.RULE_READ:tip.TipManager.showHelpInfoTip(app.getLang("shoufuisland_txt_20"),app.getLang("shoufuisland_txt_21"));break;case h.MainUIOtherIcon.Enum_OTHER_FUNC.AUTO_FIGHT:app.ViewManager.toggleDialog(guardisland.GuardautofightView,1,0);break;case h.MainUIOtherIcon.Enum_OTHER_FUNC.BOSS_ICE_BAG:if(app.ViewManager.DisplayedInStage(boss.BossWorldIceAwardView.SINGLE_KEY)){app.ViewManager.toggleDialog(boss.BossWorldIceAwardView,-1,0)}else{app.ViewManager.toggleDialog(boss.BossWorldIceAwardView,1,0)}break;case h.MainUIOtherIcon.Enum_OTHER_FUNC.SHEN_WEI:if(app.ViewManager.DisplayedInStage(dailytask.ShenweiTipView.SINGLE_KEY)){app.ViewManager.toggleDialog(dailytask.ShenweiTipView,-1,0)}else{app.ViewManager.toggleDialog(dailytask.ShenweiTipView,1,0)}break;case h.MainUIOtherIcon.Enum_OTHER_FUNC.JI_LI:if(app.ViewManager.DisplayedInStage(battle.InspireHuluDefendView.SINGLE_KEY)){app.ViewManager.toggleDialog(battle.InspireHuluDefendView,-1,0)}else{app.ViewManager.toggleDialog(battle.InspireHuluDefendView,1,0)}break;case h.MainUIOtherIcon.Enum_OTHER_FUNC.GOD_GUNGEON:if(app.ViewManager.DisplayedInStage(goddungeon.GodDungeonBuffView.SINGLE_KEY)){app.ViewManager.toggleDialog(goddungeon.GodDungeonBuffView,-1,0)}else{app.ViewManager.toggleDialog(goddungeon.GodDungeonBuffView,1,0)}break;case h.MainUIOtherIcon.Enum_OTHER_FUNC.BOSS_HELP:if(e.clickCd&&e.clickCd>game.Context.getServerTime()){manager.FlowManager.instance.flowByStyle1(app.getLang("helpcold"))}else{var a=battle.BattleModel.getIns().battleType;var o=game.Context.getMapType();var s=csv.HelpProxy.getIns().getHelpEle(o,a);if(s){var r=battle.BattleModel.getIns().battleval[0]|0;var l="";if(battle.BattleModel.getIns().bossInfo){l=csv.MonsterProxy.getMonsterName(battle.BattleModel.getIns().bossInfo.monsterId)}if(s.channel1){chat.ChatModel.getIns().setBossHelpMsg(chat.ChatModel.CHANNEL.WORLD,s.id,r,l)}if(s.channel2){if(guild.GuildModel.getIns().isGuild){chat.ChatModel.getIns().setBossHelpMsg(chat.ChatModel.CHANNEL.FAMILY,s.id,r,l)}}e.clickCd=game.Context.getServerTime()+game.Config.getIntParams(529)/1e3;manager.FlowManager.instance.flowByStyle1(app.getLang("invitation_tips1"),null,game.STYLES.GREEN_COLOR);e.setTimeLabel()}}break;default:console.log("id = %d",i);break}};r.getMainUIOtherIcon=function(t){return r.iconMap[t]};r.checkIfShowOtherFunc=function(t){var e=true;switch(t){case h.MainUIOtherIcon.Enum_OTHER_FUNC.DATI:e=dailytask.BubbleModel.getIns().checkIfOpenDati();break;case h.MainUIOtherIcon.Enum_OTHER_FUNC.KUNGFU:e=dailytask.BubbleModel.getIns().checkIfOpenKungfu();break;case h.MainUIOtherIcon.Enum_OTHER_FUNC.MOBAI:e=dailytask.BubbleModel.getIns().checkIfOpenMobai();break}return e};r.addRed=function(t){if(this.redList.indexOf(t)==-1){this.redList.push(t)}game.Context.event(game.ContextEvent.OTHER_FUNCTION_DOT_CHANGE,t)};r.removeRed=function(t){var e=this.redList.indexOf(t);if(e!=-1){this.redList.splice(e,1)}game.Context.event(game.ContextEvent.OTHER_FUNCTION_DOT_CHANGE,t)};r.iconMap={};r.SIZE=78;r.Enum_OTHER_FUNC={INSPIRE:1,SHOUHU:2,PINGBI:3,CHAT:4,BOSSLIST:5,DATI:6,KUNGFU:7,EXP:8,RWD_YD:9,AMULET:10,MOBAI:11,ZONGMEN_MEMBER:12,RULE_READ:13,AUTO_FIGHT:14,BOSS_KUAFU_HELP:15,BOSSLIST_KUAFU:16,BOSS_ICE_BAG:17,SHEN_WEI:18,JI_LI:19,GOD_GUNGEON:20,BOSS_HELP:21};r.Enum_OTHER_FUNC_URL={1:"res/static/mainicon/btn_guwu.png",2:"res/static/mainicon/btn_tigaoxiaolv.png",3:"res/static/mainicon/btn_pingbi.png",4:"res/static/mainicon/btn_liaotian.png",5:"res/static/mainicon/btn_bossliebiao.png",6:"res/static/mainicon/btn_sub_dati.png",7:"res/static/mainicon/btn_sub_chuangongyaoqing.png",8:"res/static/mainicon/btn_jingyanyaoshui.png",9:"res/static/mainicon/btn_dajiangjilu.png",10:"res/static/mainicon/btn_fuzhou.png",11:"res/static/mainicon/btn_sub_mobai.png",12:"res/static/mainicon/btn_zongmenchengyuan.png",13:"res/static/mainicon/btn_guizeshuoming.png",14:"res/static/mainicon/btn_zidongzhandou.png",15:"res/static/mainicon/btn_jiuyuan.png",16:"res/static/mainicon/btn_bossliebiao.png",17:"res/static/mainicon/btn_shengliguoshi.png",18:"res/static/mainicon/btn_hulujiuyuan.png",19:"res/static/mainicon/btn_jili.png",20:"res/static/mainicon/btn_shenshanyoufu.png",21:"res/static/mainicon/btn_danaotiangong_yaoqing.png"};r.redList=[];return r}(Laya.Button);h.MainUIOtherIcon=t;var e=function(e){__extends(t,e);function t(t){return e.call(this,t)||this}t.prototype.onUndisplay=function(){e.prototype.onUndisplay.call(this);guardisland.GuardIslandsModel.getIns().off(guardisland.GuardIslandsModel.EVENT_UPDATE_AUTO_SEARCH,this,this.onUpdateAutoSearch);this.setEffect(null)};t.prototype.onDisplay=function(){e.prototype.onDisplay.call(this);guardisland.GuardIslandsModel.getIns().on(guardisland.GuardIslandsModel.EVENT_UPDATE_AUTO_SEARCH,this,this.onUpdateAutoSearch);this.onUpdateAutoSearch()};t.prototype.onUpdateAutoSearch=function(){var t=guardisland.GuardIslandsModel.getIns().isAutoSearch;this.setEffect(t?"skill_UI_kuang2":null,"auto>>>>>>>>"+t)};return t}(t);h.AutoFightIcon=e})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var onlineActivity;(function(a){var t=function(n){__extends(t,n);function t(t,e){if(e===void 0){e=main.IconListBase.SIZE}var i=n.call(this,t,e)||this;i._modle=a.OnlineActivityModel.getIns();i._modle.on(a.OnlineActivityEvent.ONLINE_ACT_ICON_TIME,i,i.updateTime);i.clearData();i.init();return i}t.prototype.init=function(){var t=this;this.setTimeLabel();this.activityTimeView=new activitytaren.ActivityTimeView(this.lblTime,new Laya.Handler(this,function(){t.activityTimeView.stop()}),"{0}",null,2);this.activityTimeView.start(this._modle.iconTime)};t.prototype.updateTime=function(){this.activityTimeView.start(this._modle.iconTime)};t.prototype.clearData=function(){if(this.activityTimeView){this.activityTimeView.stop();this.activityTimeView.text=""}};return t}(main.MainUIIcon);a.OnlineIcon=t})(onlineActivity||(onlineActivity={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(a){var t=function(n){__extends(t,n);function t(t,e){if(e===void 0){e=a.IconListBase.SIZE}var i=n.call(this,t,100,10,10)||this;i.width=100;i.height=100;return i}Object.defineProperty(t.prototype,"setAni",{set:function(t){if(!this.uiAni){this.uiAni=new Laya.UiAnimation;this.uiAni.source="uieffect/ui_gongnengtubiao_saoguang.ani";this.uiAni.x=this.width/2;this.uiAni.y=this.height/2}if(t){this.uiAni.play(0,true);this.addChild(this.uiAni)}else{if(this.uiAni.parent){this.uiAni.removeSelf();this.uiAni.stop()}}},enumerable:true,configurable:true});t.prototype.canActtck=function(t){var e=dailytask.DailyTaskModel.getIns().taskMainId;var i=csv.DungeonProxy.getIns().getZxrwTypeCfg(t,e+1);var n;var a;if(!i){return false}else{n=parseInt(i.chapter);a=parseInt(i.round)}var o=csv.DungeonProxy.getIns().getZxrwTypeArr(t,n);var s;for(var r=0,l=o.length;r<l;r++){var h=o[r];var p=parseInt(h.round);if(a==p){s=h;break}}if(s){var u=true;var c=[];var g=game.ItemUtil.parserList(s.award_item);for(var r=0,l=g.length;r<l;r++){if(g[r].getItemId()==88001){continue}c.push(g[r])}if(game.Context.isTeamLvReach(s.teamlevel,false)){if(parseInt(s.taskid)){if(game.TaskModel.getIns().hasCompleteTask(s.taskid)){u=true}else{u=false}}}else{u=false}return u}return false};t.prototype.onDisplay=function(){n.prototype.onDisplay.call(this);game.RoleModel.getIns().on(game.RoleModel.EVENTS.PLAYER_NUM_MODIFY,this,this.onRoleAdd);dailytask.DailyTaskModel.getIns().on(dailytask.DailyTaskModel.TASK_MAIN_ID_CHANGE,this,this.onRoleAdd);game.RoleModel.getIns().on(game.RoleModel.EVENTS.TEAM_LEVEL_CHANGE,this,this.onRoleAdd);this.onRoleAdd()};t.prototype.onUndisplay=function(){n.prototype.onUndisplay.call(this);game.RoleModel.getIns().off(game.RoleModel.EVENTS.PLAYER_NUM_MODIFY,this,this.onRoleAdd);dailytask.DailyTaskModel.getIns().off(dailytask.DailyTaskModel.TASK_MAIN_ID_CHANGE,this,this.onRoleAdd);game.RoleModel.getIns().off(game.RoleModel.EVENTS.TEAM_LEVEL_CHANGE,this,this.onRoleAdd);if(this.lblDes){util.SpriteLinkUtil.removeLinkChild(this,this.lblDes)}this.setAni=false};t.prototype.onRoleAdd=function(){game.RedDotView.removeFrom(this);var t=game.Context.roleList.length;if(this.lblDes){this.lblDes.off(Laya.Event.CLICK,this,this.onGoto)}if(t<7){if(!this.imgDes){this.imgDes=new Laya.Image;this.imgDes.skin="public/bg_piaozidi.png";this.imgDes.width=200;this.imgDes.y=90;this.imgDes.x=(this.width-this.imgDes.width)/2}if(!this.lblDes){this.lblDes=new Laya.RichText;this.lblDes.width=200;this.lblDes.fontSize=18;this.lblDes.font="SimHei";this.lblDes.bold=true;this.lblDes.align="center";this.lblDes.color=game.STYLES.DESC_TXT_COLOR;this.lblDes.stroke=2;this.lblDes.strokeColor=game.STYLES.BLACK_COLOR}var e=t+1;this.skin="res/static/mainicon/btn_sub_huluxiongdi_"+e+".png";if(game.RoleModel.getIns().checkAddRoleCondiion(e)){game.RedDotView.addTo(this);this.lblDes.text=app.getLang("huluxiongdi_tishi_2");this.lblDes.on(Laya.Event.CLICK,this,this.onGoto)}else{var i=csv.DefclassProxy.getIns().getCfgCreate(e);if(i&&i.type==1){var n=csv.DungeonProxy.getIns().getZxrwCfg(i.value);this.lblDes.text=app.getLang("huluxiongdi_tishi_1",n.teamlevel,n.chapter)}}util.SpriteLinkUtil.addLinkChild(this,this.lblDes,app.AppContainer.uiLblLayer,(this.width-this.lblDes.width)/2,95,true);this.addChild(this.imgDes);this.imgDes.height=this.lblDes.contextHeight+8}else{if(this.lblDes){util.SpriteLinkUtil.removeLinkChild(this,this.lblDes)}if(this.imgDes){this.imgDes.removeSelf()}this.skin="res/static/mainicon/btn_sub_huluxiongdi_1.png"}this.playAni()};t.prototype.playAni=function(){this.setAni=true};t.prototype.onGoto=function(){game.ClosureManager.callFunctionByNpcOpen(csv.FunctionsProxy.ENUMS.TASK_MAIN)};return t}(a.MainUIIcon);a.HuLuXiongDiIcon=t;var e=function(s){__extends(t,s);function t(t,e){if(e===void 0){e=a.IconListBase.SIZE}return s.call(this,t,e)||this}t.prototype.onDisplay=function(){s.prototype.onDisplay.call(this);game.RoleModel.getIns().on(game.RoleModel.EVENTS.KUAI_TIAN,this,this.onKuaTianClear);this.onReddotChange();this.shakeScene()};t.prototype.onUndisplay=function(){s.prototype.onUndisplay.call(this);game.RoleModel.getIns().off(game.RoleModel.EVENTS.KUAI_TIAN,this,this.onKuaTianClear)};t.prototype.shakeScene=function(t,e,i){if(t===void 0){t=200}if(e===void 0){e=10}if(i===void 0){i=2}if(this._boShake){return}this._boShake=true;this._shakeDuration=t;this._shakeRange=e;this._shakeStart=Laya.timer.currTimer;Laya.timer.frameLoop(i,this,this.shake)};t.prototype.shake=function(){if(Laya.timer.currTimer-this._shakeStart>this._shakeDuration){Laya.timer.clear(this,this.shake);this._boShake=false;return}var t=game.SceneModel.random(0,Math.PI*2);this.rotation=t};t.prototype.onClick=function(t){s.prototype.onClick.call(this,t);var e=csv.VipProxy.getIns().getVipPri(csv.PRI_TYPE.REDPACK,vipcode.VipModel.getIns().vipLvl);if(guild.GuildModel.getIns().rptimes>=e){if(game.SystemSetModel.getInstance().settingData.data[game.SettingType.redpackIcon]==0){var i=csv.VipProxy.getIns().getArr();var n=i[i.length-1].level;var a=csv.VipProxy.getIns().getVipPri(csv.PRI_TYPE.REDPACK,vipcode.VipModel.getIns().vipLvl);var o=csv.VipProxy.getIns().getVipPri(csv.PRI_TYPE.REDPACK,n);if(a-o!=0){game.SystemSetModel.getInstance().setValueByType(1,game.SettingType.redpackIcon);game.ClosureManager.removeDot(this.cfg.functionid)}}}};t.prototype.onKuaTianClear=function(){game.SystemSetModel.getInstance().setValueByType(0,game.SettingType.redpackIcon);this.onReddotChange()};t.prototype.onReddotChange=function(){var t=0;if(this.cfg){var e=1;if(this.cfg.id==59){e=1}if(this.cfg.id==60){e=3}if(this.cfg.id==61){e=2}var i=guild.GuildModel.getIns().unGetedredPack;var n=void 0;for(var a=0,o=i;a<o.length;a++){var s=o[a];n=guild.GuildModel.getIns().getRedPacketGetDataById(s);var r=csv.GuildProxy.getIns().getRedPackCfg(n.rptype);if(r&&r.type==e){t++}}}game.ClosureManager.removeDot(this.cfg.functionid);var l=csv.VipProxy.getIns().getVipPri(csv.PRI_TYPE.REDPACK,vipcode.VipModel.getIns().vipLvl);if(guild.GuildModel.getIns().rptimes<l){if(t>1){game.ClosureManager.addDot(this.cfg.functionid,t)}}else{var i=csv.VipProxy.getIns().getArr();var h=i[i.length-1].level;var p=csv.VipProxy.getIns().getVipPri(csv.PRI_TYPE.REDPACK,vipcode.VipModel.getIns().vipLvl);var u=csv.VipProxy.getIns().getVipPri(csv.PRI_TYPE.REDPACK,h);if(p-u!=0&&game.SystemSetModel.getInstance().settingData.data[game.SettingType.redpackIcon]==0){game.ClosureManager.addDot(this.cfg.functionid,t)}}};return t}(a.MainUIIcon);a.RedPackIcon=e})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(a){var t=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.redChange=function(t){e.prototype.redChange.call(this,t);if(game.ClosureManager.hasDot(csv.FunctionsProxy.ENUMS.PublicNotice)){if(!this.noticeIcon){this.noticeIcon=new Laya.Image;this.noticeIcon.skin="main/bg_main_xintishi.png";this.noticeIcon.x=36;this.noticeIcon.y=28}this.addChild(this.noticeIcon)}else{this.noticeIcon&&this.noticeIcon.removeSelf()}};return t}(a.MainUIIcon);a.SettingIcon=t;var e=function(n){__extends(t,n);function t(t,e){if(e===void 0){e=a.MainUIIcon.SIZE}var i=n.call(this,t,e)||this;garden.GardenModel.getIns().on(garden.GardenModel.GARDEN_PLANTINFO_UPDATE,i,i.onEvent);pet.PetModel.getIns().on(pet.PetEvent.PET_EGG_GRID_UPDATE,i,i.onEvent);guaji.SecretAreaModel.getIns().on(guaji.SecretAreaModel.SECRETAREA_INFO_UPDATE,i,i.onEvent);return i}t.prototype.onDisplay=function(){n.prototype.onDisplay.call(this);this.stateNum=2;this.toggle=true;this.reddot()};t.prototype.onEvent=function(){if(!app.ViewManager.DisplayedInStage(a.FunProgressTips.SINGLE_KEY)){this.reddot()}};t.prototype.reddot=function(){game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.FUNPROGRESS);var t=app.str2Array(game.Config.getParams(game.ConfigID.FUNIDS),";");for(var e=0;e<t.length;e++){if(game.Context.getFidState(parseInt(t[e]))==1){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.FUNPROGRESS);break}}};t.prototype.onClickHandler=function(){if(app.ViewManager.DisplayedInStage(a.FunProgressTips.SINGLE_KEY)){this.reddot();app.ViewManager.toggleView(a.FunProgressTips,app.AppContainer.uiIconLayer,-1)}else{game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.FUNPROGRESS);game.ClosureManager.callFunctionByNpcOpen(csv.FunctionsProxy.ENUMS.FUNPROGRESS)}};return t}(a.MainUIIcon);a.FunProgressIcon=e})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var sevenday;(function(e){var t=function(n){__extends(t,n);function t(t,e){if(e===void 0){e=main.IconListBase.SIZE}var i=n.call(this,t,e)||this;i.setTimeLabel(73,game.STYLES.BLACK_COLOR);i.timeView=new activitytaren.ActivityTimeView(i.lblTime,new Laya.Handler(i,i.endHandler),undefined,new Laya.Handler(i,i.updateHandler));return i}t.prototype.onDisplay=function(){n.prototype.onDisplay.call(this);game.MoneyModel.getIns().on(game.MoneyModel.EVENTS.MONEY_CHANGE,this,this.onMoneyChange);this.timeView.start(e.SevenDayModel.getIns().endtime)};t.prototype.onMoneyChange=function(t){if(t==game.MoneyModel.MONEY_ENUM.RONGYU||t==game.MoneyModel.MONEY_ENUM.GOLD||t==game.MoneyModel.MONEY_ENUM.SILVER){e.SevenDayModel.getIns().update()}};t.prototype.onUndisplay=function(){n.prototype.onUndisplay.call(this);this.timeView.stop();game.MoneyModel.getIns().off(game.MoneyModel.EVENTS.MONEY_CHANGE,this,this.onMoneyChange)};t.prototype.updateHandler=function(t){if(t<util.TimeUtil.secOneDay){this.lblTime.text=util.TimeUtil.formatTime(t);this.lblTime.color=game.STYLES.RED_COLOR}else{var e=t/util.TimeUtil.secOneDay;var i=t%util.TimeUtil.secOneDay;this.lblTime.color=game.STYLES.GREEN_COLOR;this.lblTime.text=Math.ceil(e).toString()+app.getLang("day_tips")}};t.prototype.endHandler=function(){e.SevenDayModule.getIns().updateData()};return t}(main.MainUIIcon);e.SevenDaySmallIcon=t})(sevenday||(sevenday={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(o){var t=function(t){__extends(a,t);function a(){return t!==null&&t.apply(this,arguments)||this}a.getIns=function(){return app.Singleton.getInstance(a)};a.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.on(Laya.Event.CLICK,this,this.onClick);this.btn=new Laya.Button;this.addChild(this.btn);this.width=o.BattleIconList.ICON_W;this.height=o.BattleIconList.ICON_H};a.prototype.onClick=function(){game.ClosureManager.callFunctionByNpcOpen(this.id)};a.prototype.onDisplay=function(){this.callLater(this.refreshAll)};a.prototype.onUnDisplay=function(){};a.prototype.refreshAll=function(){};a.createButton=function(t,e){if(a.iconMap[t]){var i=a.iconMap[t];return i}var n=new o.BattleIcon;n.id=t;n.btn.skin="res/static/mainicon/"+e+".png";a.iconMap[t]=n;return n};a.SINGLE_KEY="main.BattleIcon";a.iconMap={};return a}(Laya.Box);o.BattleIcon=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(s){var t=function(e){__extends(o,e);function o(){var t=e!==null&&e.apply(this,arguments)||this;t.funcs=[csv.FunctionsProxy.ENUMS.BOSS_WOLRD,csv.FunctionsProxy.ENUMS.BOSS_KUAFU,csv.FunctionsProxy.ENUMS.YAO_WANG_BOSS];t.urls=["btn_shanhaiyishou","btn_danaotiangong","btn_yaowangzhengba"];return t}o.getIns=function(){return app.Singleton.getInstance(o)};o.prototype.initialize=function(){e.prototype.initialize.call(this);this.zOrder=app.AppContainer.UI_LAYER_NUME.CHAT;this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.x=app.AppContainer.UI_LAYER_GAP.LEFT_ICON;this.y=app.AppContainer.UI_LAYER_Y.LEFT_ICON+ScreenAdapter.OFFSET_Y};o.prototype.onDisplay=function(){boss.BossModel.getIns().on(boss.BossEvent.BOSS_KUAFU_OPEN_STATE,this,this.refreshAll);boss.BossModel.getIns().on(boss.BossEvent.BOSS_WORLD_CHANGE,this,this.refreshAll);dailytask.DailyTaskModel.getIns().on(dailytask.DailyTaskModel.OPEN_ACTIVITY_CHANGE,this,this.checkIfOpen);this.callLater(this.refreshAll)};o.prototype.onUnDisplay=function(){boss.BossModel.getIns().off(boss.BossEvent.BOSS_KUAFU_OPEN_STATE,this,this.refreshAll);boss.BossModel.getIns().off(boss.BossEvent.BOSS_WORLD_CHANGE,this,this.refreshAll);dailytask.DailyTaskModel.getIns().off(dailytask.DailyTaskModel.OPEN_ACTIVITY_CHANGE,this,this.checkIfOpen)};o.prototype.checkIfOpen=function(){var t=dailytask.DailyTaskModel.getIns().getOpenActivityByType(csv.ActivityFunction.ENUM.YAO_WANG_FIGHT);if(t){this.callLater(this.refreshAll)}};o.prototype.refreshAll=function(){this.removeChildren();this.buttonList=[];var t=0;for(var e=0,i=this.funcs.length;e<i;e++){var n=this.funcs[e];if(this.isShow(n)){var a=s.BattleIcon.createButton(n,this.urls[e]);a.x=0;a.y=t;t+=o.ICON_H+o.GAP;this.addChild(a);this.buttonList.push(a)}}};o.prototype.isShow=function(t){var e=false;if(!csv.FunctionsProxy.getIns().isOpen(t)){return false}switch(t){case csv.FunctionsProxy.ENUMS.YAO_WANG_BOSS:var i=dailytask.DailyTaskModel.getIns().getOpenActivityByType(csv.ActivityFunction.ENUM.YAO_WANG_FIGHT);if(i){e=true}break;case csv.FunctionsProxy.ENUMS.BOSS_KUAFU:e=boss.BossModel.getIns().boKuafuBoss;break;case csv.FunctionsProxy.ENUMS.BOSS_WOLRD:if(boss.BossModel.getIns().getIsQin()){e=true}break}return e};o.SINGLE_KEY="main.BattleIconList";o.ICON_W=82;o.ICON_H=82;o.GAP=10;return o}(Laya.Box);s.BattleIconList=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(r){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.ROWS=1;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.onDisplay=function(){r.FunctionGuideModel.getInstance().on(r.FunctionGuideModel.EVENTS.VIEW_OPEN_CLOSE,this,this.updateLayout);game.RoleModel.getIns().on(game.RoleModel.EVENTS.PLAYER_NUM_MODIFY,this,this.refreshAll);e.prototype.onDisplay.call(this)};t.prototype.onUnDisplay=function(){r.FunctionGuideModel.getInstance().off(r.FunctionGuideModel.EVENTS.VIEW_OPEN_CLOSE,this,this.updateLayout);game.RoleModel.getIns().off(game.RoleModel.EVENTS.PLAYER_NUM_MODIFY,this,this.refreshAll);e.prototype.onUnDisplay.call(this)};t.prototype.updateLayout=function(){this.x=app.AppContainer.UI_LAYER_GAP.LEFT_ICON;this.y=app.AppContainer.UI_LAYER_Y.FunGuideViewPos+ScreenAdapter.OFFSET_Y;this.zOrder=app.AppContainer.UI_LAYER_NUME.LEFT_RIGHT_ICON};t.prototype.refreshAll=function(){this.mouseThrough=true;this.removeChildren();this.buttonList=[];var t=csv.MainIconProxy.getIns().getListByType(csv.MainIconProxy.leftrightTopGroup);var e=0;for(var i=0;i<t.length;++i){var n=t[i];if(this.isCanAdd(n)){var a=r.RightIconList.SIZE;if(parseInt(n.autosize)!=0){a=parseInt(n.autosize)}var o=this.addChild(r.MainUIIcon.createButton(n,a));this.buttonList.push(o);var s=Math.floor(e/this.ROWS);o.x=s*a+s*r.LeftIconList.GAP;o.y=(e-s*this.ROWS)*(a+r.LeftIconList.GAP);e++}}};t.SINGLE_KEY="main.BigLeftTopList";return t}(r.IconListBase);r.BigLeftTopList=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(r){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.ROWS=1;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.updateLayout=function(){this.x=Laya.stage.width-app.AppContainer.UI_LAYER_GAP.RIGHT_ICON-15;this.y=app.AppContainer.UI_LAYER_Y.FunGuideViewPos+ScreenAdapter.OFFSET_Y;this.zOrder=app.AppContainer.UI_LAYER_NUME.LEFT_RIGHT_ICON};t.prototype.refreshAll=function(){this.removeChildren();this.buttonList=[];var t=csv.MainIconProxy.getIns().getListByType(csv.MainIconProxy.bigrightTopGroup);var e=0;for(var i=0;i<t.length;++i){var n=t[i];if(this.isCanAdd(n)){var a=this.addChild(r.MainUIIcon.createButton(n,r.RightIconList.SIZE));var o=a.width;this.buttonList.push(a);var s=Math.floor(e/this.ROWS);a.x=-((s+1)*o+s*r.RightIconList.GAP);a.y=(e-s*this.ROWS)*(o+r.LeftIconList.GAP);e++}}};t.SINGLE_KEY="main.BigRightTopList";return t}(r.IconListBase);r.BigRightTopList=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(s){var t=function(t){__extends(o,t);function o(){return t!==null&&t.apply(this,arguments)||this}o.getIns=function(){return app.Singleton.getInstance(o)};o.prototype.updateLayout=function(){this.zOrder=app.AppContainer.UI_LAYER_NUME.TOP;this.x=375;this.y=56+ScreenAdapter.OFFSET_Y};o.prototype.onDisplay=function(){t.prototype.onDisplay.call(this)};o.prototype.updateView=function(){this.removeChildren();this.buttonList=[];var t=csv.MainIconProxy.getIns().getListByType(csv.MainIconProxy.hintGroup);for(var e=0;e<t.length;++e){var i=t[e];if(this.isCanAdd(i)){var n=this.getAutosize(i,o.SIZE);var a=this.addChild(s.MainUIIcon.createButton(i,n));this.buttonList.push(a);a.x=0;a.y=0}}};o.prototype.refreshAll=function(){this.updateView()};o.SINGLE_KEY="main.HintIconList";o.SIZE=94;return o}(s.IconListBase);s.HintIconList=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(t){var e=function(i){__extends(t,i);function t(t){var e=i.call(this)||this;e.base=t;e.btn=new Laya.Image;e.btn.width=60;e.btn.height=33;e.btn.skin="main/btn_main_xialajiantou_up.png";e.btn.anchorX=e.btn.anchorY=.5;e.funcAdapter=new game.FuncDotAdapter(e.btn,25,-10);e.funcAdapter.ignoreLimit=true;e.btn.on(Laya.Event.CLICK,e,e.onClick);e.state=0;return e}t.prototype.setMlds=function(t){this.base.addChild(this.btn);var e=[];for(var i=0,n=t.length;i<n;i++){var a=t[i];if(a.linkmaindlgs!=""){var o=csv.MainIconProxy.getIns().linkMaindlgs[a.id];for(var s=0;s<o.length;++s){var r=csv.FunctionsProxy.getIns().getObfuncByMdlgId(o[s]);e=e.concat(r)}}else{var r=csv.FunctionsProxy.getIns().getObfuncByMdlgId(a.id);e=e.concat(r)}}this.fids=e;this.funcAdapter.obFunc(this.fids);this.setState()};t.prototype.onClick=function(){this.state=this.state==0?1:0;this.setState();this.base.doOpenClose()};t.prototype.doClick=function(){this.onClick()};t.prototype.setState=function(){if(this.state==1){this.btn.scaleY=-1}else{this.btn.scaleY=1}};return t}(Laya.EventDispatcher);t.IconListControl=e})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(s){var t=function(t){__extends(o,t);function o(){return t!==null&&t.apply(this,arguments)||this}o.getIns=function(){return app.Singleton.getInstance(o)};o.prototype.updateLayout=function(){this.x=app.AppContainer.UI_LAYER_GAP.RIGHT_ICON;this.y=Laya.stage.height-o.SIZE-s.MainBottomView.HEIGHT-10-ScreenAdapter.OFFSET_BOTTOM;this.zOrder=app.AppContainer.UI_LAYER_NUME.LEFT_RIGHT_ICON};Object.defineProperty(o.prototype,"iconSize",{get:function(){return o.SIZE},enumerable:true,configurable:true});o.prototype.updateView=function(){this.removeChildren();this.buttonList=[];var t=csv.MainIconProxy.getIns().getListByType(csv.MainIconProxy.guajiRightBottomGroup);var e=0;for(var i=0;i<t.length;++i){var n=t[i];if(csv.FunctionsProxy.getIns().isCanAddMainIcon(n.id)){var a=this.addChild(s.MainUIIcon.createButton(n,o.SIZE));this.buttonList.push(a);a.x=(this.iconSize+5)*e;a.y=0;this.addChild(a);e--}}};o.prototype.refreshAll=function(){this.updateView()};o.SINGLE_KEY="main.LeftBottomIconList";o.SIZE=94;return o}(s.IconListBase);s.LeftBottomIconList=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(s){var t=function(e){__extends(o,e);function o(){var t=e.call(this)||this;t.on(Laya.Event.DISPLAY,t,t.onDisplay);t.on(Laya.Event.UNDISPLAY,t,t.onUnDisplay);t.zOrder=app.AppContainer.UI_LAYER_NUME.BOTTOMAIN_ICON;return t}o.getIns=function(){return app.Singleton.getInstance(o)};o.prototype.updateLayout=function(){this.x=Laya.stage.width/2-87;this.y=s.MainBottomView.KONGBAI_H+(s.MainBottomView.HEIGHT-s.MainBottomView.KONGBAI_H-o.SIZE)/2;this.zOrder=app.AppContainer.UI_LAYER_NUME.LEFT_RIGHT_ICON};o.prototype.refreshAll=function(){this.removeChildren();this.buttonList=[];var t=csv.MainIconProxy.getIns().getListByType(csv.MainIconProxy.mainLeftGroup);var e=t.length;for(var i=0;i<e;++i){var n=t[e-1-i];var a=s.MainUIIcon.createButton(n,o.SIZE,10,10);a.x=-o.SIZE-(o.SIZE+o.GAP)*i;this.addChild(a);this.buttonList.push(a);if(!this.isCanAdd(n)){s.LockIcon.addTo(a,.7,.7)}}};o.SINGLE_KEY="main.MainLeftIconList";o.SIZE=94;o.GAP=0;return o}(s.IconListBase);s.MainLeftIconList=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(r){var t=function(e){__extends(s,e);function s(){var t=e.call(this)||this;t.on(Laya.Event.DISPLAY,t,t.onDisplay);t.on(Laya.Event.UNDISPLAY,t,t.onUnDisplay);t.zOrder=app.AppContainer.UI_LAYER_NUME.BOTTOMAIN_ICON;return t}s.getIns=function(){return app.Singleton.getInstance(s)};s.prototype.updateLayout=function(){this.x=s.LEFT_GAP;this.y=r.MainBottomView.KONGBAI_H+(r.MainBottomView.HEIGHT-r.MainBottomView.KONGBAI_H-s.SIZE)/2;this.zOrder=app.AppContainer.UI_LAYER_NUME.LEFT_RIGHT_ICON};s.prototype.refreshAll=function(){this.removeChildren();this.buttonList=[];var t=csv.MainIconProxy.getIns().getListByType(csv.MainIconProxy.mainRightGroup);var e=t.length;var i=(Laya.stage.width-s.LEFT_GAP-s.SIZE*e)/e;if(i>25){i=25}for(var n=0;n<e;++n){var a=t[n];var o=r.MainUIIcon.createButton(a,s.SIZE,10,10);o.x=(s.SIZE+i)*n;this.addChild(o);this.buttonList.push(o);if(!this.isCanAdd(a)){r.LockIcon.addTo(o,.7,.7)}}};s.SINGLE_KEY="main.MainRightIconList";s.LEFT_GAP=220;s.SIZE=108;return s}(r.IconListBase);r.MainRightIconList=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(s){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.updateLayout=function(){this.x=app.AppContainer.UI_LAYER_GAP.RIGHT_ICON+chat.ChatMiniView.WIDTH+Laya.stage.width-900;this.y=Laya.stage.height-s.RightIconList.SIZE-s.MainBottomView.HEIGHT-ScreenAdapter.OFFSET_BOTTOM;this.zOrder=app.AppContainer.UI_LAYER_NUME.LEFT_RIGHT_ICON};e.prototype.updateView=function(){this.removeChildren();this.buttonList=[];var t=csv.MainIconProxy.getIns().getListByType(csv.MainIconProxy.midBottomGroup);var e=0;for(var i=0;i<t.length;++i){var n=t[i];if(this.isCanAdd(n)){var a=this.getAutosize(n,s.LeftIconList.SIZE);var o=this.addChild(s.MainUIIcon.createButton(n,a));this.buttonList.push(o);o.x=(a+s.RightIconList.GAP)*e;e++}}};e.prototype.refreshAll=function(){this.updateView()};e.SINGLE_KEY="main.MidBottomIconList";e.SIZE=100;return e}(s.IconListBase);s.MidBottomIconList=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(o){var t=function(t){__extends(a,t);function a(){return t!==null&&t.apply(this,arguments)||this}a.getIns=function(){return app.Singleton.getInstance(a)};a.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.on(Laya.Event.CLICK,this,this.onClick);this.btn=new Laya.Button;this.addChild(this.btn);this.width=o.NoticeIconList.ICON_W;this.height=o.NoticeIconList.ICON_H};a.prototype.onClick=function(){switch(this.id){case o.NoticeIconList.ICON_TYPE.TEAM:app.ViewManager.toggleDialog(team.TeamMineView,1,0);break;case o.NoticeIconList.ICON_TYPE.TEAM_INVITE:app.ViewManager.toggleDialog(team.TeamInviteView,1,0);break;case o.NoticeIconList.ICON_TYPE.TEAM_APPLY:app.ViewManager.toggleDialog(team.TeamApplyView,1,0);break;case o.NoticeIconList.ICON_TYPE.KUNGFU_INVITE:app.ViewManager.toggleDialog(dailytask.KungfuView,1,0);break;case o.NoticeIconList.ICON_TYPE.HULU_DUOBAO:case o.NoticeIconList.ICON_TYPE.PAO_DIAN:case o.NoticeIconList.ICON_TYPE.SHOUHU_HULU:case o.NoticeIconList.ICON_TYPE.GUILD_BOSS:this.gotoAction(this.id);break}};a.prototype.gotoAction=function(t){var e;switch(t){case o.NoticeIconList.ICON_TYPE.HULU_DUOBAO:e=csv.ActivityFunction.ENUM.HU_LU_DAO;break;case o.NoticeIconList.ICON_TYPE.PAO_DIAN:e=csv.ActivityFunction.ENUM.PAO_DIAN;break;case o.NoticeIconList.ICON_TYPE.SHOUHU_HULU:e=csv.ActivityFunction.ENUM.SHOU_HU;break;case o.NoticeIconList.ICON_TYPE.GUILD_BOSS:e=csv.ActivityFunction.ENUM.GUILD_BOSS;break}dailytask.DailyTaskModel.getIns().gotoByType(e)};a.prototype.onDisplay=function(){if(o.NoticeIconList.NO_EFFECT.indexOf(this.id)==-1&&!this.boShine){this.playShine()}this.callLater(this.refreshAll)};a.prototype.onUnDisplay=function(){this.stopShine()};a.prototype.refreshAll=function(){switch(this.id){case o.NoticeIconList.ICON_TYPE.TEAM:if(team.TeamModel.getIns().myTeamInfo&&team.TeamModel.getIns().myTeamInfo.count){game.RedDotView.addTo(this,this.width-5,5,1,1,team.TeamModel.getIns().myTeamInfo.count)}else{game.RedDotView.removeFrom(this)}break}};a.prototype.playShine=function(){this.boShine=true;Laya.timer.loop(2e3,this,this.guodong)};a.prototype.stopShine=function(){this.boShine=false;Laya.Tween.clearAll(this);Laya.timer.clear(this,this.guodong)};a.prototype.guodong=function(){util.AniUtil.guodong(this.btn,0,0,this.width,this.height)};a.createButton=function(t,e){if(a.iconMap[t]){var i=a.iconMap[t];return i}var n=new o.NoticeIcon;n.id=t;n.btn.skin="res/static/mainicon/"+e+".png";a.iconMap[t]=n;return n};a.SINGLE_KEY="main.NoticeIcon";a.iconMap={};return a}(Laya.Box);o.NoticeIcon=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(s){var t=function(t){__extends(o,t);function o(){return t!==null&&t.apply(this,arguments)||this}o.getIns=function(){return app.Singleton.getInstance(o)};o.prototype.initialize=function(){t.prototype.initialize.call(this);this.zOrder=app.AppContainer.UI_LAYER_NUME.CHAT;this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};o.prototype.resize=function(){this.x=(Laya.stage.width-this.width)/2;this.y=Laya.stage.height-s.MainBottomView.HEIGHT-chat.ChatMiniView.HEIGHT-o.ICON_H-this.height-ScreenAdapter.OFFSET_BOTTOM};o.prototype.onDisplay=function(){team.TeamModel.getIns().on(team.TeamEvent.MY_TEAM_CHANGE,this,this.refreshAll);team.TeamModel.getIns().on(team.TeamEvent.APPLY_LIST_CHANGE,this,this.refreshAll);team.TeamModel.getIns().on(team.TeamEvent.INVITE_TEAM_CHANGE,this,this.refreshAll);dailytask.DailyTaskModel.getIns().on(dailytask.DailyTaskModel.OPEN_ACTIVITY_CHANGE,this,this.refreshAll);dailytask.BubbleModel.getIns().on(dailytask.BubbleModel.KUNGFU_LIST_CHANGE,this,this.refreshAll);guild.GuildModel.getIns().on(guild.GuildEvent.EVENT.GUILD_STATE_CHANGE,this,this.refreshAll);this.callLater(this.refreshAll)};o.prototype.onUnDisplay=function(){team.TeamModel.getIns().off(team.TeamEvent.MY_TEAM_CHANGE,this,this.refreshAll);team.TeamModel.getIns().off(team.TeamEvent.APPLY_LIST_CHANGE,this,this.refreshAll);team.TeamModel.getIns().off(team.TeamEvent.INVITE_TEAM_CHANGE,this,this.refreshAll);dailytask.DailyTaskModel.getIns().off(dailytask.DailyTaskModel.OPEN_ACTIVITY_CHANGE,this,this.refreshAll);dailytask.BubbleModel.getIns().off(dailytask.BubbleModel.KUNGFU_LIST_CHANGE,this,this.refreshAll);game.Context.off(game.ContextEvent.LEAD_ROLE_MOVE_END,this,this.refreshAll);guild.GuildModel.getIns().off(guild.GuildEvent.EVENT.GUILD_STATE_CHANGE,this,this.refreshAll)};o.prototype.refreshAll=function(){this.removeChildren();this.buttonList=[];var t=0;for(var e=0,i=o.ICONS.length;e<i;e++){var n=o.ICONS[e];if(this.isShow(n)){var a=s.NoticeIcon.createButton(n,o.ICON_URL[n]);a.x=t;a.y=0;t+=o.ICON_W+o.GAP;this.addChild(a);this.buttonList.push(a)}}if(t){this.width=t-o.GAP}else{this.width=0}this.resize()};o.prototype.isShow=function(t){var e=false;switch(t){case o.ICON_TYPE.TEAM:e=team.TeamModel.getIns().hasTeam;break;case o.ICON_TYPE.TEAM_INVITE:e=team.TeamModel.getIns().boInvite;break;case o.ICON_TYPE.TEAM_APPLY:e=team.TeamModel.getIns().hasTeam&&team.TeamModel.getIns().boApply;break;case o.ICON_TYPE.KUNGFU_INVITE:if(dailytask.DailyTaskModel.getIns().getOpenActivityByType(csv.ActivityFunction.ENUM.CHUAN_GONG)){game.Context.on(game.ContextEvent.LEAD_ROLE_MOVE_END,this,this.refreshAll)}else{game.Context.off(game.ContextEvent.LEAD_ROLE_MOVE_END,this,this.refreshAll)}e=dailytask.BubbleModel.getIns().checkIfOpenKungfu()&&dailytask.BubbleModel.getIns().boKungfu;break;case o.ICON_TYPE.HULU_DUOBAO:var i=dailytask.DailyTaskModel.getIns().getOpenActivityByType(csv.ActivityFunction.ENUM.HU_LU_DAO);e=i!=undefined;if(i){if(game.Context.teamLv<i.teamlevel){e=false}}break;case o.ICON_TYPE.PAO_DIAN:e=dailytask.DailyTaskModel.getIns().getOpenActivityByType(csv.ActivityFunction.ENUM.PAO_DIAN)!=undefined;break;case o.ICON_TYPE.SHOUHU_HULU:e=dailytask.DailyTaskModel.getIns().getOpenActivityByType(csv.ActivityFunction.ENUM.SHOU_HU)!=undefined;break;case o.ICON_TYPE.GUILD_BOSS:if(guildboss.GuildBossModel.getIns().isShowNoticeIcon()){e=dailytask.DailyTaskModel.getIns().getOpenActivityByType(csv.ActivityFunction.ENUM.GUILD_BOSS)!=undefined}break}return e};o.SINGLE_KEY="main.NoticeIconList";o.ICON_W=82;o.ICON_H=82;o.GAP=10;o.ICON_TYPE={TEAM:1,TEAM_INVITE:2,TEAM_APPLY:3,KUNGFU_INVITE:4,PAO_DIAN:5,SHOUHU_HULU:6,HULU_DUOBAO:7,GUILD_BOSS:8};o.ICON_URL={1:"btn_zudui",2:"btn_yaoqing",3:"btn_shenqing",4:"btn_chuangongyaoqing",5:"btn_paodian",6:"btn_shouhuhulu",7:"btn_huluduobao",8:"btn_fengmolingtan"};o.ICONS=[1,2,3,4,5,6,7,8];o.NO_EFFECT=[1,5,6,7,8];return o}(Laya.Box);s.NoticeIconList=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(o){var t=function(t){__extends(a,t);function a(){return t!==null&&t.apply(this,arguments)||this}a.getIns=function(){return app.Singleton.getInstance(a)};a.prototype.updateLayout=function(){this.x=Laya.stage.width-(o.LeftIconList.SIZE+app.AppContainer.UI_LAYER_GAP.RIGHT_ICON);this.y=Laya.stage.height-(o.RightBottomIconList.SIZE+o.RightBottomIconList.GAP)*2-o.MainBottomView.HEIGHT+10-a.SIZE-ScreenAdapter.OFFSET_BOTTOM;this.zOrder=app.AppContainer.UI_LAYER_NUME.LEFT_RIGHT_ICON};a.prototype.onDisplay=function(){t.prototype.onDisplay.call(this)};a.prototype.checkRecommendcombat=function(t){if(t==csv.MainIconProxy.TYPE_ICON_REDPACK_GUILD){var e=this.getCount(1);return e>0}if(t==csv.MainIconProxy.TYPE_ICON_REDPACK_ROLE){var e=this.getCount(3);return e>0}if(t==csv.MainIconProxy.TYPE_ICON_REDPACK_SYS){var e=this.getCount(2);return e>0}return true};a.prototype.getCount=function(t){var e=0;var i;var n=guild.GuildModel.getIns().unGetedredPack;for(var a=0,o=n;a<o.length;a++){var s=o[a];i=guild.GuildModel.getIns().getRedPacketGetDataById(s);var r=csv.GuildProxy.getIns().getRedPackCfg(i.rptype);if(r&&r.type==t){e++;break}}return e};a.prototype.refreshAll=function(){this.removeChildren();this.buttonList=[];var t=csv.MainIconProxy.getIns().getListByType(csv.MainIconProxy.redPackageGroup);for(var e=0;e<t.length;++e){var i=t[e];if(this.isCanAdd(i)&&this.checkRecommendcombat(i.id)){var n=this.addChild(o.MainUIIcon.createButton(i,a.SIZE));this.buttonList.push(n);n.x=-e*(a.SIZE+a.GAP)}}};a.prototype.updateRedPack=function(){this.refreshAll()};a.SINGLE_KEY="main.RedPackageList";a.SIZE=78;a.GAP=5;return a}(o.IconListBase);o.RedPackageList=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(s){var t=function(t){__extends(o,t);function o(){return t!==null&&t.apply(this,arguments)||this}o.getIns=function(){return app.Singleton.getInstance(o)};o.prototype.updateLayout=function(){this.x=Laya.stage.width-o.SIZE-app.AppContainer.UI_LAYER_GAP.RIGHT_BOTTOM;this.y=Laya.stage.height-o.SIZE-s.MainBottomView.HEIGHT+10-ScreenAdapter.OFFSET_BOTTOM;this.zOrder=app.AppContainer.UI_LAYER_NUME.LEFT_RIGHT_ICON};o.prototype.updateView=function(){this.removeChildren();this.buttonList=[];var t=csv.MainIconProxy.getIns().getListByType(csv.MainIconProxy.homeRightBottomGroup);var e=0;for(var i=0;i<t.length;++i){var n=t[i];if(csv.FunctionsProxy.getIns().isCanAddMainIcon(n.id)){var a=this.addChild(s.MainUIIcon.createButton(n,o.SIZE));this.buttonList.push(a);a.x=0;a.y=e*(o.SIZE+o.GAP);this.addChild(a);e--}}};o.prototype.refreshAll=function(){this.updateView()};o.SINGLE_KEY="main.RightBottomIconList";o.SIZE=94;o.GAP=5;return o}(s.IconListBase);s.RightBottomIconList=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(u){var t=function(t){__extends(p,t);function p(){return t!==null&&t.apply(this,arguments)||this}p.getIns=function(){return app.Singleton.getInstance(p)};p.prototype.initialize=function(){t.prototype.initialize.call(this);this.control=new u.IconListControl(this);this.control.btn.x=p.SIZE/2};p.prototype.onDisplay=function(){this.updateLayout();this.on(Laya.Event.RESIZE,this,this.updateLayout);csv.FunctionsProxy.getIns().on(csv.FunctionsProxy.EVENTS.ADD,this,this.onAddFunc);csv.FunctionsProxy.getIns().on(csv.FunctionsProxy.EVENTS.REMOVE,this,this.onRemoveFunc);app.ProtocolRequest.GuildChampionSessionReq();app.ProtocolRequest.GuildChampionBattleListReq();Laya.timer.callLater(this,this.refreshAll)};p.prototype.onUnDisplay=function(){this.off(Laya.Event.RESIZE,this,this.updateLayout);csv.FunctionsProxy.getIns().off(csv.FunctionsProxy.EVENTS.ADD,this,this.onAddFunc);csv.FunctionsProxy.getIns().off(csv.FunctionsProxy.EVENTS.REMOVE,this,this.onRemoveFunc);Laya.timer.clear(this,this.refreshAll);game.Context.event(game.ContextEvent.ICONLIST,{key:this.key,v:false})};p.prototype.updateLayout=function(){this.x=app.AppContainer.UI_LAYER_GAP.LEFT_ICON;this.y=app.AppContainer.UI_LAYER_Y.LEFT_ICON+ScreenAdapter.OFFSET_Y;this.zOrder=app.AppContainer.UI_LAYER_NUME.LEFT_RIGHT_ICON};p.prototype.getOffY=function(){var t=0;if(this.buttonList.length>=2){var e=this.buttonList[this.buttonList.length-2];if(e&&e.lblTime&&e.lblTime.parent){t=e.lblTime.fontSize-p.GAP+5;if(t<0){t=0}}}return t};p.prototype.refreshAll=function(){this.removeChildren();this.buttonList=[];var t=csv.MainIconProxy.getIns().getListByType(csv.MainIconProxy.rightGroup);var e=0;var i=[];var n=0;var a;for(var o=0;o<t.length;++o){var s=t[o];if(this.control.state&&e){i.push(s);continue}if(this.isCanAdd(s)){var r=this.addChild(u.MainUIIcon.createButton(s,p.SIZE));this.buttonList.push(r);var l=Math.floor(e/app.AppContainer.RIGHT_ROWS);r.x=l*p.SIZE+l*p.GAP;var h=e%app.AppContainer.RIGHT_ROWS;if(h==0){a=0}else{a+=r.height+this.getOffY()}r.y=a;e++;if(r.y>n){n=r.y}}}this.control.btn.y=n+u.LeftIconList.SIZE+this.control.btn.height/2+u.LeftIconList.GAP;this.control.setMlds(i)};p.prototype.doOpenClose=function(){Laya.timer.callLater(this,this.refreshAll)};p.SINGLE_KEY="main.RightIconList";p.OFFY=45;p.SIZE=94;p.GAP=5;return p}(u.IconListBase);u.RightIconList=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(s){var t=function(t){__extends(o,t);function o(){return t!==null&&t.apply(this,arguments)||this}o.getIns=function(){return app.Singleton.getInstance(o)};o.prototype.updateLayout=function(){this.x=app.AppContainer.UI_LAYER_GAP.RIGHT_ICON;this.y=app.AppContainer.UI_LAYER_Y.RIGHT_TOP_ICON+ScreenAdapter.OFFSET_Y;this.zOrder=app.AppContainer.UI_LAYER_NUME.LEFT_RIGHT_ICON};o.prototype.onDisplay=function(){t.prototype.onDisplay.call(this)};o.prototype.onUnDisplay=function(){t.prototype.onUnDisplay.call(this)};o.prototype.refreshAll=function(){this.removeChildren();this.buttonList=[];var t=0;var e=csv.MainIconProxy.getIns().getListByType(csv.MainIconProxy.rightTopGroup);for(var i=0;i<e.length;++i){var n=e[i];if(this.isCanAdd(n)){var a=this.addChild(s.MainUIIcon.createButton(n,o.WIDTH));a.width=o.WIDTH;a.height=o.HEIGHT;this.buttonList.push(a);a.x=t*(o.WIDTH+o.GAP);t++}}};o.SINGLE_KEY="main.RightTopIconList";o.WIDTH=66;o.HEIGHT=75;o.GAP=0;return o}(s.IconListBase);s.RightTopIconList=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(n){var t=function(e){__extends(a,e);function a(){var t=e!==null&&e.apply(this,arguments)||this;t._isAllComplete=false;return t}a.getInstance=function(){return app.Singleton.getInstance(a)};a.prototype.init=function(){this._allList=[];var t=csv.GongnengzhiyinCsvProxy.getIns().arrData;var e;for(var i=0;i<t.length;i++){e=new n.FunctionGuideVO;e.cfg=t[i];e.cfgId=Number(e.cfg.id);e.state=0;this._allList.push(e)}};a.prototype.changeCellState=function(){for(var t=0;t<this._allList.length;t++){var e=this._allList[t].cfg.function_id;if(this._allList[t].state==0){if(csv.FunctionsProxy.getIns().isOpen(e)){this._allList[t].state=1}else{this._allList[t].state=0}}}this.onCompSort()};a.prototype.getAllList=function(){return this._allList};a.prototype.getIsAllComplete=function(){return this._isAllComplete};a.prototype.onSetStateComplete=function(t){if(t){for(var e=0;e<t.length;e++){if(t[e]!=undefined){for(var i=0;i<this._allList.length;i++){if(t[e]==this._allList[i].cfgId){this._allList[i].state=2;break}}}}}this._isAllComplete=true;for(var i=0;i<this._allList.length;i++){if(this._allList[i].state!=2){this._isAllComplete=false;break}}game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.JI_JIANG_KAI_QI);if(this._isAllComplete){Laya.timer.callLater(this,this.onNotice,[a.EVENTS.COMPLETE_ALL]);game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.JI_JIANG_KAI_QI)}else{Laya.timer.callLater(this,this.onNotice,[a.EVENTS.STATE_CHANGE]);this._allList.map(function(t){if(t.state==0&&csv.FunctionsProxy.getIns().isOpen(t.cfg.function_id)||t.state==1){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.JI_JIANG_KAI_QI)}})}};a.prototype.onFunctionOpen=function(){var t;for(var e=0;e<this._allList.length;e++){t=this._allList[e];if(t.state==0){var i=t.cfg.function_id;var n=csv.FunctionsProxy.getIns().isOpen(i);if(n){t.state=1;game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.JI_JIANG_KAI_QI)}}}Laya.timer.callLater(this,this.onNotice,[a.EVENTS.STATE_CHANGE])};a.prototype.onNotice=function(t){this.onCompSort();this.event(t)};a.prototype.onCompSort=function(){var t=[];var e=[];var i=[];var n=[];var a;this._allList.sort(function(t,e){var i=csv.FunctionsProxy.getIns().getCfg(t.cfg.function_id);var n=csv.FunctionsProxy.getIns().getCfg(e.cfg.function_id);if(i.teamlevel<n.teamlevel){return-1}else{return 1}});for(var o=0;o<this._allList.length;o++){a=this._allList[o];if(a.state==0){e.push(a)}else if(a.state==1){t.push(a)}else{i.push(a)}}this._allList=[];this._allList=this._allList.concat(t);this._allList=this._allList.concat(e);this._allList=this._allList.concat(i)};a.SINGLE_KEY="main.FunctionGuideModel";a.EVENTS={STATE_CHANGE:"state_change",COMPLETE_ALL:"complete_all",VIEW_OPEN_CLOSE:"view_open_close"};return a}(app.ModelBase);n.FunctionGuideModel=t})(main||(main={}));var main;(function(t){var e=function(){function t(){}t.prototype.getPicSkin=function(){var t="";if(this.cfg!=undefined){t=this.cfg.icon+".png"}return t};t.prototype.getAwardItem=function(){var t;if(this.cfg!=undefined){t=game.ItemUtil.parserList(this.cfg.award)[0]}return t};return t}();t.FunctionGuideVO=e})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("functionopen.csv");this.cfgMap=t.getMap("id");this.arrData=t.getArray()};e.prototype.getCfg=function(t){return this.cfgMap[t]};e.SINGLE_KEY="csv.GongnengzhiyinCsvProxy";return e}(app.ModelBase);t.GongnengzhiyinCsvProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var game;(function(o){var s=function(){function t(){}return t}();var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){};e.prototype.startCD=function(){var t=o.Context.getServerTime()+o.Config.getIntParams(1241);o.SystemSetModel.getInstance().setValueByType(t,o.SettingType.jubaoCD)};e.prototype.onLoopFreshTime=function(){};Object.defineProperty(e.prototype,"CDTime",{get:function(){var t=o.SystemSetModel.getInstance().settingData.getValueByType(o.SettingType.jubaoCD);return t.value-o.Context.getServerTime()},enumerable:true,configurable:true});e.prototype.jubao=function(t,e,i,n){var a=new s;a.uid=t;a.type=i;a.txt=n;a.playerName=e;o.RoleModel.getIns().once(o.RoleModel.EVENTS.ROLE_GET_IP,this,this.onGetRoleIp,[a]);app.ProtocolRequest.GetTarPlayerIpReq(a.uid)};Object.defineProperty(e.prototype,"url",{get:function(){if(window["appConfig"]&&window["appConfig"]["jubaourl"]){return window["appConfig"]["jubaourl"]}var t=o.Context.HtmlParams=app.getHTMLParams();if(t["jubaourl"]){return t["jubaourl"]}},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"enableJuable",{get:function(){return this.url!=undefined},enumerable:true,configurable:true});e.prototype.onGetRoleIp=function(t,e){login.CoverModel.getIns().jubao(t.type,e.account,e.roleid.toString(),t.playerName,e.strip,t.txt)};e.SINGLE_KEY="game.JuBaoModel";return e}(app.ModelBase);o.JuBaoModel=t})(game||(game={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("grow_level.csv");this.cfgMap=t.getMap("id");this.arr=[];this.arr=t.getArray();var e=app.Config.getResById("grow_strong.csv");this.strongMap=e.getMap("id");this.strongArr=[];this.strongArr=e.getArray();var i=app.Config.getResById("grow_equip.csv");this.equipMap=i.getMap("id","equippart")};e.prototype.getCfg=function(t){return this.cfgMap[t]};e.prototype.getLevelGrow=function(){return this.getSection(this.arr)};e.prototype.getStrongGrow=function(){return this.getSection(this.strongArr)};e.prototype.getSection=function(t){var e;for(var i=0;i<t.length;i++){if(!game.Context.isTeamLvReach(t[i].teamlv,false)){e=t[i];break}}return e};e.prototype.getList=function(t){var e=[];if(t&&t.length>0){var i=app.str2Array(t,";","-");for(var n=0;n<i.length;n++){e.push({functionId:parseInt(i[n][0]),lv:parseInt(i[n][1]),dailyTimeId:parseInt(i[n][2])})}}return e};e.prototype.getEquip=function(t,e){return this.equipMap[t][e]};e.SINGLE_KEY="csv.LeadStrongerProxy";return e}(app.ModelBase);t.LeadStrongerProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("report.csv");this.cfgMap=t.getMap("id");this.cfgArr=t.getArray()};e.prototype.getCfg=function(t){return this.cfgMap[t]};e.SINGLE_KEY="csv.ReportProxy";return e}(app.ModelBase);t.ReportProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(a){var t=function(e){__extends(i,e);function i(){var t=e!==null&&e.apply(this,arguments)||this;t.cd=0;return t}i.getIns=function(){return app.Singleton.getInstance(i)};i.prototype.initialize=function(){e.prototype.initialize.call(this);this.maskSp=new Laya.Sprite;this.maskSp.graphics.drawRect((this.width-Laya.stage.width)/2,(this.height-Laya.stage.height)/2+150,Laya.stage.width,Laya.stage.height,game.STYLES.BLACK_COLOR);this.maskSp.mouseEnabled=true;this.maskSp.width=Laya.stage.width;this.maskSp.height=Laya.stage.height;this.hitArea=new Laya.Rectangle((this.width-Laya.stage.width)/2,(this.height-Laya.stage.height)/2+150,Laya.stage.width,Laya.stage.height);this.addChildAt(this.maskSp,0);this.imgIcon=new laya.ui.Image;this.maskSp.alpha=.7;this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.on(Laya.Event.CLICK,this,this.onClick)};i.prototype.onDisplay=function(){guide.GuideModel.getIns().boOpen=false;app.SoundManager.getIns().playSound("news");this.callLater(this.refreshAll);this.x=(Laya.stage.width-this.width)*.5;this.y=Laya.stage.height*.5-this.height;this.animationkaiqi.visible=true;this.imgxingongnengkaiqi.visible=true;this.labelmiaoshu.visible=true;this.animationkaiqi.play(0,true)};i.prototype.onUnDisplay=function(){guide.GuideModel.getIns().boOpen=true;this.imgIcon.visible=false;Laya.Tween.clearAll(this.imgIcon);Laya.timer.clear(this,this.removeSelf);app.ViewManager.dellToggleList()};i.prototype.refreshAll=function(){this.setViewIcon();if(this.dataSource.location!=1&&this.dataSource.location!=2){var t=csv.MainIconProxy.getIns().getCfg(this.dataSource.maindlg);if(t&&(t.arrang==csv.MainIconProxy.mainLeftGroup||t.arrang==csv.MainIconProxy.mainRightGroup)){}else{var e=a.MainUIIcon.getMainUIIcon(this.dataSource.maindlg);if(e){e.visible=false}}}};i.prototype.onClick=function(){if(Laya.timer.currTimer-this.cd>=1e3){this.cd=Laya.timer.currTimer;this.tryNext()}};i.prototype.tryNext=function(){this.setIcon();this.labelmiaoshu.visible=false;this.showTagEffect(this.dataSource)};i.prototype.setIcon=function(){this.imgicon.visible=false;this.imgIcon.visible=true;this.imgIcon.width=120;this.imgIcon.height=120;var t=this.imgicon.parent.localToGlobal(new Laya.Point(this.imgicon.x,this.imgicon.y));this.imgIcon.x=t.x;this.imgIcon.y=t.y;this.imgIcon.scale(1,1);this.imgIcon.skin=csv.FunctionsProxy.getIns().getUrl(this.dataSource.bigicon,this.dataSource.resident);this.imgIcon.zOrder=1399;Laya.stage.addChild(this.imgIcon)};i.prototype.setViewIcon=function(){this.imgicon.skin=csv.FunctionsProxy.getIns().getUrl(this.dataSource.bigicon,this.dataSource.resident);this.imgicon.visible=true};i.prototype.showTagEffect=function(t){var e;var i;if(t.location==1){e=a.MainUIIcon.getMainUIIconPoint(csv.MainIconProxy.TYPE_ICON_RICHANG)}else if(t.location==2){e=a.MainBottomView.getZhandouPoint();i=a.MainBottomView.getZhandou()}else if(t.location==3&&game.Context.getMapType()==csv.MapProxy.MAP_TYPE.HOME){e=a.MainBottomView.getZhandouPoint();i=a.MainBottomView.getZhandou()}else if(t.location==4){e=a.RoleInfoView.getRoleHeadPoint();i=a.RoleInfoView.getRoleHead()}else{var n=csv.MainIconProxy.getIns().linkMap[t.maindlg];if(n){e=a.MainUIIcon.getMainUIIconPoint(n);i=a.MainUIIcon.getMainUIIcon(n)}else{e=a.MainUIIcon.getMainUIIconPoint(t.maindlg);i=a.MainUIIcon.getMainUIIcon(t.maindlg)}}if(i){this.imgxingongnengkaiqi.visible=false;this.animationkaiqi.visible=false;Laya.Tween.to(this.imgIcon,{x:e.x-78/2,y:e.y-78/2,scaleX:.4,scaleY:.4},800,null,new Laya.Handler(this,this.onRemoveAni,[i]))}else{this.onRemoveAni(null)}};i.prototype.onRemoveAni=function(t){a.LockIcon.removeFrom(t);if(t){t.visible=true}if(i.needPop()){if(i.cfgList.length){this.dataSource=i.cfgList.shift();this.setViewIcon()}else{app.ViewManager.toggleView(a.FuncOpenView,app.AppContainer.flowLayer,-1)}}else{app.ViewManager.toggleView(a.FuncOpenView,app.AppContainer.flowLayer,-1)}};i.sortHandler=function(t,e){if(t.popout>e.popout){return 1}else if(t.popout==e.popout){return-1}return 0};i.add=function(t){i.cfgList=i.cfgList.concat(t);i.cfgList.sort(i.sortHandler);if(i.needPop()){if(!app.ViewManager.DisplayedInStage(a.FuncOpenView.SINGLE_KEY)){app.ViewManager.pushToggleList(a.FuncOpenView.SINGLE_KEY,Laya.Handler.create(this,function(){app.ViewManager.toggleView(a.FuncOpenView,app.AppContainer.flowLayer,1,i.cfgList.shift())}))}}};i.needPop=function(){if(i.cfgList.length==1){var t=i.cfgList[0];if(t.popout==2){i.cfgList.shift();return false}}return true};i.onshowFuncOpenView=function(){var t=game.Context.funcOpenIds;if(t&&t.length>0){if(csv.MapProxy.isFuncMap()){if(this.checkIfViewOpen()){return}var e=[];for(var i=0;i<t.length;i++){var n=csv.FunctionsProxy.getIns().getCfg(t[i]);if(n&&n.popout!=0){e.push(n)}}a.FuncOpenView.add(e);game.Context.funcOpenIds=[]}}};i.checkIfViewOpen=function(){for(var t=0,e=this.checkViewList.length;t<e;t++){var i=this.checkViewList[t];if(app.ViewManager.DisplayedInStage(i)){this.currView=app.Singleton.getInstance(i);this.currView.on(Laya.Event.UNDISPLAY,this,this.unDisplayView);return true}}return false};i.unDisplayView=function(){this.currView.off(Laya.Event.UNDISPLAY,this,this.unDisplayView);this.currView=null;this.onshowFuncOpenView()};i.SINGLE_KEY="main.FuncOpenView";i.cfgList=[];i.checkViewList=[guaji.GuajiPassView.SINGLE_KEY,chat.ChatView.SINGLE_KEY];return i}(ui.main.mainxingongnengkaiqiUI);a.FuncOpenView=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(i){var t=function(t){__extends(e,t);function e(){return t.call(this)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.unDisplay)};e.prototype.onDisplay=function(){this.on(Laya.Event.CLICK,this,this.onClick)};e.prototype.unDisplay=function(){this.off(Laya.Event.CLICK,this,this.onClick)};e.prototype.setData=function(t,e){this.mouseEnabled=true;this.index=e;this.x=0;this._vo=t;if(this._vo!=undefined){this.imgmubiaoicon.skin=this._vo.getPicSkin();this.labelrenwu01.text=app.getLang(this._vo.cfg.describe);this.labelrenwu02.text=csv.FunctionsProxy.getIns().getOpenNotice(this._vo.cfg.function_id);this.itemdaoju.setData(this._vo.getAwardItem());if(this._vo.state==0){this.labelrenwu02.color="#ff0000";this.imgyilingqu.visible=false;this.imgredpoint.visible=false;this.itemdaoju.visible=true;this.itemdaoju.mouseEnabled=true}else{if(this._vo.state==1){this.itemdaoju.mouseEnabled=false;this.imgyilingqu.visible=false;this.imgredpoint.visible=true;this.itemdaoju.visible=true;this.labelrenwu02.text=app.getLang("已开启")}else{this.imgyilingqu.visible=true;this.imgredpoint.visible=false;this.itemdaoju.visible=false}this.labelrenwu02.color="#2dd861"}}else{this.onDefault()}};e.prototype.onDefault=function(){this.imgmubiaoicon.skin="";this.labelrenwu01.text="";this.labelrenwu02.text="";this.imgyilingqu.visible=false;this.imgredpoint.visible=false};e.prototype.onClick=function(){if(this._vo.state==1){i.FunctionGuideMainView.getInstance().listAni.setLeftAni(this,"");app.ProtocolRequest.AwardFuncOpenReq(+this._vo.cfg.id)}else if(this._vo.state==0){var t=csv.FunctionsProxy.getIns().getOpenNotice(this._vo.cfg.function_id);if(t!=""){manager.FlowManager.instance.flowByStyle1(t)}}else{game.ClosureManager.callFunction(Number(this._vo.cfg.function_id))}};return e}(ui.main.jijiangkaiqiitemUI);i.FunctionGuideCellRender=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getInstance=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this._model=i.FunctionGuideModel.getInstance();this.listAni=new common.SimpleListAni(this.listjijiangkaiqi,i.FunctionGuideCellRender,new Laya.Handler(this,this.onRenderSetData),common.SimpleListAniType.ALL);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.closebtn.on(Laya.Event.CLICK,this,this.onClose)};e.prototype.onDisplay=function(){app.SoundManager.getIns().playSound("functionopen");guide.GuideModel.getIns().boOpen=false;app.ViewManager.showDialogMask();this._model.on(i.FunctionGuideModel.EVENTS.STATE_CHANGE,this,this.updateLayout);this._model.on(i.FunctionGuideModel.EVENTS.COMPLETE_ALL,this,this.onClose);this.callLater(this.updateLayout)};e.prototype.onUnDisplay=function(){app.SoundManager.getIns().playSound("functionclose");guide.GuideModel.getIns().boOpen=true;app.ViewManager.closeDialogMask();this._model.off(i.FunctionGuideModel.EVENTS.STATE_CHANGE,this,this.updateLayout);this._model.off(i.FunctionGuideModel.EVENTS.COMPLETE_ALL,this,this.onClose)};e.prototype.updateLayout=function(){this._model.changeCellState();this.listAni.array=this._model.getAllList()};e.prototype.onRenderSetData=function(t,e){t.setData(t.dataSource,e)};e.prototype.onClose=function(){app.ViewManager.toggleDialog(e,-1)};e.SINGLE_KEY="main.FunctionGuideMainView";return e}(ui.main.mainjijiangkaiqiviewUI);i.FunctionGuideMainView=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getInstance=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.zOrder=app.AppContainer.UI_LAYER_NUME.BOTTOMAIN_ICON;this.width=this.height=0;this.autoSize=true;this._model=i.FunctionGuideModel.getInstance();this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onResize=function(){this.x=app.AppContainer.UI_LAYER_GAP.FunGuideViewPos;this.y=app.AppContainer.UI_LAYER_Y.FunGuideViewPos+ScreenAdapter.OFFSET_Y};e.prototype.onDisplay=function(){this.onResize();this.on(Laya.Event.CLICK,this,this.onClick);game.RoleModel.getIns().on(game.RoleModel.EVENTS.LEVEL_CHANGE,this,this.onLevelChange);game.RoleModel.getIns().on(game.RoleModel.EVENTS.PLAYER_NUM_MODIFY,this,this.onLevelChange);this._model.on(i.FunctionGuideModel.EVENTS.STATE_CHANGE,this,this.updateLayout);this._model.on(i.FunctionGuideModel.EVENTS.COMPLETE_ALL,this,this.onClose);this.callLater(this.updateLayout);this._model.onSetStateComplete();this._model.event(i.FunctionGuideModel.EVENTS.VIEW_OPEN_CLOSE)};e.prototype.onUnDisplay=function(){this.off(Laya.Event.CLICK,this,this.onClick);game.RoleModel.getIns().off(game.RoleModel.EVENTS.LEVEL_CHANGE,this,this.onLevelChange);game.RoleModel.getIns().off(game.RoleModel.EVENTS.PLAYER_NUM_MODIFY,this,this.onLevelChange);this._model.off(i.FunctionGuideModel.EVENTS.STATE_CHANGE,this,this.updateLayout);this._model.off(i.FunctionGuideModel.EVENTS.COMPLETE_ALL,this,this.onClose);this._model.event(i.FunctionGuideModel.EVENTS.VIEW_OPEN_CLOSE)};e.prototype.updateLayout=function(){this._model.changeCellState();var t=this._model.getAllList();if(t.length>0){this._target=t[0];this.onRefresh()}else{this.removeSelf()}};e.prototype.onRefresh=function(){this.imgmubiaoicon.skin=this._target.getPicSkin();this.imgzhuangshi.visible=false;this.imgredpoint.visible=false;if(this._target.state==1){var t=20;this.yuanxingkuang.visible=true;game.RedDotView.addTo(this.imgmubiaoicon,this.imgmubiaoicon.x+this.imgmubiaoicon.width,0,.65,.65)}else{this.yuanxingkuang.visible=false;game.RedDotView.removeFrom(this.imgmubiaoicon)}};e.prototype.onClose=function(){this.removeSelf()};e.prototype.onLevelChange=function(){i.FunctionGuideModel.getInstance().onFunctionOpen()};e.prototype.onClick=function(t){app.ViewManager.toggleDialog(i.FunctionGuideMainView,1)};e.SINGLE_KEY="main.FunctionGuideView";return e}(ui.main.mainmubiaoyindaoUI);i.FunctionGuideView=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.zOrder=app.AppContainer.UI_LAYER_NUME.BOTTOMAIN_ICON;this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.boxguaji.on(Laya.Event.CLICK,this,this.onMissionClick);guide.GuideModel.getIns().register(csv.GuideProxy.ENUM_VIEW.GUANQIA_ENTER,this.boxguaji)};e.prototype.onResize=function(){this.x=Laya.stage.width-this.width;this.y=app.AppContainer.UI_LAYER_Y.GUAJI+ScreenAdapter.OFFSET_Y};e.prototype.onDisplay=function(){this.onResize();guaji.GuajiModel.getIns().on(guaji.GuajiModel.GUAJI_ID_CHANGE,this,this.mapChange);guaji.GuajiModel.getIns().on(guaji.GuajiModel.GUAJI_MINUTE_EXP_CHANGE,this,this.onExpChange);guaji.GuajiModel.getIns().on(guaji.GuajiModel.GUAJIPASS_DATA_UPDATE,this,this.refreshAll);book.MonsterBookModel.getIns().on(book.MonsterBookModel.BOOK_MONSTER_NTF_CHANGE,this,this.onReddotUpdqate);chart.ChartModel.getIns().on(chart.ChartEvent.EVENT_RED,this,this.onReddotUpdqate);guaji.GuajiModel.getIns().on(guaji.GuajiModel.GUAJI_REDDOT_CHANGE,this,this.onReddotUpdqate);game.GridsModel.getIns().on(game.GridsModel.EVENTS.UPDATE,this,this.onReddotUpdqate);this.on(Laya.Event.RESIZE,this,this.onResize);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){guaji.GuajiModel.getIns().off(guaji.GuajiModel.GUAJI_ID_CHANGE,this,this.mapChange);guaji.GuajiModel.getIns().off(guaji.GuajiModel.GUAJI_MINUTE_EXP_CHANGE,this,this.onExpChange);guaji.GuajiModel.getIns().off(guaji.GuajiModel.GUAJIPASS_DATA_UPDATE,this,this.refreshAll);book.MonsterBookModel.getIns().off(book.MonsterBookModel.BOOK_MONSTER_NTF_CHANGE,this,this.onReddotUpdqate);chart.ChartModel.getIns().off(chart.ChartEvent.EVENT_RED,this,this.onReddotUpdqate);guaji.GuajiModel.getIns().off(guaji.GuajiModel.GUAJI_REDDOT_CHANGE,this,this.onReddotUpdqate);game.GridsModel.getIns().off(game.GridsModel.EVENTS.UPDATE,this,this.onReddotUpdqate);this.off(Laya.Event.RESIZE,this,this.onResize);this.ani1.stop()};e.prototype.mapChange=function(){this.refreshAll()};e.prototype.refreshAll=function(){var t=guaji.GuajiModel.getIns().passId;var e=csv.GuajiProxy.getIns().getCfgGuanqia(t);var i=csv.GuajiProxy.getIns().getPart(e.id);this.dituname.text=app.getLang("guanqia_name_1",e.chapter,i.index);var n="";if(e){n=csv.GuajiProxy.getIns().getChaperCfg(t).entryicon}else{n=csv.GuajiProxy.getIns().getChaperCfg(1).entryicon}this.imgditu.skin="res/static/guajiditu/"+n+".png";this.onReddotUpdqate()};e.prototype.onReddotUpdqate=function(){game.RedDotView.removeFrom(this.boxguaji);var t=false;var e=csv.GuajiProxy.getIns().getAll();for(var i=0;i<e.length;i++){if(guaji.GuajiModel.getIns().reddotMijingItem(e[i])){t=true;break}}if(t){game.RedDotView.addTo(this.boxguaji)}};e.prototype.onExpChange=function(){var t=csv.MapProxy.getIns().getMapType(game.Context.mainRole.mapId);if(t==csv.MapProxy.MAP_TYPE.HOME){if(guajiexp.GuajiExpModel.getIns().state&&guajiexp.GuajiExpModel.getIns().state==3){this.ani1.play(0,true)}else{this.ani1.stop()}}};e.prototype.onMissionClick=function(t){t.stopPropagation();app.ViewManager.toggleDialog(guaji.GuajiPassView,1,0)};e.SINGLE_KEY="main.GuajiEnterView";return e}(ui.main.mainguajinewUI);t.GuajiEnterView=e})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(i){var a=isometric.Point3D;var u=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t.width=35;t.height=35;t.anchorX=.5;t.anchorY=1;t.skin="public/bg_map_boss.png";t.on(Laya.Event.CLICK,t,t.onBossClick);return t}t.prototype.onBossClick=function(t){var e=this.vo;t.stopPropagation();guardisland.GuardIslandsModel.getIns().stopAutoFight();game.SceneModel.getInstance().goto(e)};t.prototype.setData=function(t){var e=csv.MapProxy.getIns().getCfg(game.Context.mainRole.mapId);var i=Laya.loader.getRes("res/maps/"+e.mapfile+"/data.mapd");this.vo=t;this.curX=t.getPosX();this.curY=t.getPosY();var n=isometric.IsoUtils.isoToScreen(new a(this.curX*32,0,this.curY*32));this.x=Math.floor(n.x/20-i.bg.bgOffsetX/20);this.y=Math.floor(n.y/20-i.bg.bgOffsetY/20)};t.prototype.posEqual=function(t,e){return this.curX==t&&this.curY==e};return t}(Laya.Image);i.MiniIcon=u;var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t._isInit=false;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};t.prototype.init=function(){this.imgMap=new Laya.Image;this.addChild(this.imgMap);this.pd=new i.PathDraw(this,new Laya.Handler(this,this.onPathHandler));var t=new Laya.Button;t.skin="res/static/common/btn_tuichu.png";this.addChild(t);t.x=-t.width;t.clickHandler=new Laya.Handler(this,this.onExitHanlder);this.imgRole=new Laya.Image;this.imgRole.skin="public/bg_map_ziji.png";this.imgRole.anchorX=.5;this.imgRole.anchorY=1;this.imgRole.width=35;this.imgRole.height=35;this.imgSelect=new Laya.Image;this.imgSelect.skin="public/bg_map_biaoji.png";this.imgSelect.anchorX=.5;this.imgSelect.anchorY=1;this.imgSelect.width=35;this.imgSelect.height=35;this.imgSelect.visible=false};t.prototype.onPathHandler=function(t){var e=t.length;var i=undefined;if(e>0){var n=scene.SceneMediator.getInstance().mapGrid;if(n){var a=n.gridEndNode;for(var o=0;o<this.listMiniIcon.length;o++){var s=this.listMiniIcon[o];if(s.posEqual(a.x,a.y)){i=new Laya.Point(a.x,a.y);break}}}}this.clickName=i};Object.defineProperty(t.prototype,"clickName",{set:function(t){this._clickName=t;this.refreshClickHander()},enumerable:true,configurable:true});t.prototype.refreshClickHander=function(){this.setNpcs()};t.prototype.refreshRolePos=function(){var t=scene.SceneMediator.getInstance().getViewById(game.Context.mainRoleId);if(t){if(!this._rolePoint3D){this._rolePoint3D=new a}this._rolePoint3D.x=t.isoPosX;this._rolePoint3D.y=t.isoPosY;this._rolePoint3D.z=t.isoPosZ;this.setPlayerPos(this._rolePoint3D)}};t.prototype.setPlayerPos=function(t){if(this.vo){var e=isometric.IsoUtils.isoToScreen(t);this.imgRole.x=e.x/20-this.vo.bg.bgOffsetX/20;this.imgRole.y=e.y/20-this.vo.bg.bgOffsetY/20}};t.prototype.refreshAll=function(){while(this.listMiniIcon.length>0){var t=this.listMiniIcon.pop();t.removeSelf()}var e=csv.MapProxy.getIns().getCfg(game.Context.mainRole.mapId);if(e.pathpoint!=0){Laya.loader.load("res/maps/"+e.mapfile+"/data.mapd",Laya.Handler.create(this,this.loadEnd))}};t.prototype.loadEnd=function(){var t=csv.MapProxy.getIns().getCfg(game.Context.mainRole.mapId);this.vo=Laya.loader.getRes("res/maps/"+t.mapfile+"/data.mapd");this.pd.mapCfg=t;this.imgMap.skin="res/maps/"+t.mapfile+"/m.jpg";this.imgMap.width=this.vo.bgWidth/20;this.imgMap.height=this.vo.bgHeight/20;this.updateLayout();this.setNpcs();this.addChild(this.imgRole)};t.prototype.updateLayout=function(){this.x=Laya.stage.width-this.imgMap.width;this.y=ScreenAdapter.OFFSET_Y+50};t.prototype.onDisplay=function(){if(!this._isInit){this.init();this._isInit=true}this.pd.onDisplay();Laya.stage.on(Laya.Event.RESIZE,this,this.updateLayout);Laya.timer.frameLoop(1,this,this.refreshRolePos);this.listMiniIcon=[];guardisland.GuardIslandsModel.getIns().on(guardisland.GuardIslandsModel.EVENT_UPDATA_MAP_ITEMS,this,this.updateItemHandler);this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){this.pd.onUnDisplay();Laya.stage.off(Laya.Event.RESIZE,this,this.updateLayout);while(this.listMiniIcon.length>0){var t=this.listMiniIcon.pop();t.removeSelf()}Laya.timer.clear(this,this.refreshRolePos);guardisland.GuardIslandsModel.getIns().off(guardisland.GuardIslandsModel.EVENT_UPDATA_MAP_ITEMS,this,this.updateItemHandler)};t.prototype.updateItemHandler=function(){if(this.vo){this.setNpcs()}};t.prototype.onExitHanlder=function(){role.LeadingRoleView.getIns().cancelAI();app.ProtocolRequest.LeaveGuardIslandReq()};t.prototype.getIcon=function(t){for(var e=0;e<this.listMiniIcon.length;e++){var i=this.listMiniIcon[e];var n=i.vo;if(n.getPosX()==t.getPosX()&&n.getPosY()==t.getPosY()){return i}}};t.prototype.setNpcs=function(){var t=csv.NpcProxy.getIns().getMapNpcList(game.Context.mainRole.mapId);var e=guardisland.GuardIslandsModel.getIns().isMonsterInMap();var i=[];for(var n=0;n<t.length;n++){var a=t[n];if(a&&a instanceof scene.HuLuDaooRoleVo){if(a.isDead()){}else{if(a.monsterType==guardisland.EGuardIslandType.Collect){}else{if(e){i.push(a)}}}}else{i.push(a)}}var o=undefined;for(var n=0;n<i.length;n++){var s=i[n];if(s instanceof scene.HuLuDaooRoleVo){var r=this.getIcon(s);if(r){}else{r=new u;this.listMiniIcon.push(r)}r.setData(s);this.addChild(r);if(this._clickName&&r.posEqual(this._clickName.x,this._clickName.y)){o=r}}}for(var n=0;n<this.listMiniIcon.length;n++){var l=this.listMiniIcon[n];var h=false;for(var p=0;p<i.length;p++){if(l.vo==i[p]){h=true}}if(!h){this.listMiniIcon.splice(n,1);l.removeSelf();n--}}if(o){this.imgSelect.x=o.x;this.imgSelect.y=o.y;this.imgSelect.visible=true;this.addChild(this.imgSelect)}else{this.imgSelect.visible=false}};t.SINGLE_KEY="main.HuLuDaoMiniMap";return t}(Laya.Box);i.HuLuDaoMiniMap=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var battle;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.x=10;this.y=140+ScreenAdapter.OFFSET_Y;this.on(Laya.Event.CLICK,this,this.onClick)};e.prototype.onClick=function(){var t=this.parent.localToGlobal(new Laya.Point(this.x+32,this.y+32));tip.TipLevelBuffView.openEffect(this.buffId,this.lv,t)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){var t=this.dataSource[0];var e=csv.StatusProxy.getIns().getDjshBuff(t);var i=app.str2Array(e,"-");this.buffId=parseInt(i[0]);this.lv=parseInt(i[1]);var n=csv.StatusProxy.getIns().getCfg(this.buffId,this.lv);this.shuzhi.value=app.str2Array(n.elements,"-")[3]/100+"%";this.yazhilab.text=app.getLang("dengjiyazhi",t)};e.SINGLE_KEY="battle.LevelHurtBuffView";e.HEIGHT=64;return e}(ui.wuxingzhandou.dengjiyazhiUI);t.LevelHurtBuffView=e})(battle||(battle={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(i){var o=isometric.Point3D;var n=boss.BossModel;var a=boss.BossEvent;var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.imgMap=new Laya.Image;this.addChild(this.imgMap);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.pd=new i.PathDraw(this);this.imgRole=new Laya.Image;this.imgRole.skin="public/bg_map_ziji.png";this.imgRole.anchorX=.5;this.imgRole.anchorY=1;this.imgRole.width=35;this.imgRole.height=35;this.imgSelect=new Laya.Image;this.imgSelect.skin="public/bg_map_biaoji.png";this.imgSelect.anchorX=.5;this.imgSelect.anchorY=1;this.imgSelect.width=35;this.imgSelect.height=35;this.imgSelect.visible=false;this.bossModel=n.getIns()};e.prototype.onDisplay=function(){this.bossModel.on(a.WORLD_BOSS_NPC_ID_CHANGE,this,this.selectNpc);this.bossModel.on(a.BOSS_DETAIL_CHANGE,this,this.refreshBossIcon);this.pd.onDisplay();Laya.timer.frameLoop(1,this,this.refreshRolePos);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){this.pd.onUnDisplay();for(var t=0;t<this.imgNpcArr.length;t++){var e=this.imgNpcArr[t];if(e&&e.parent){e.parent.removeChild(e)}}Laya.timer.clear(this,this.refreshRolePos);this.bossModel.off(a.WORLD_BOSS_NPC_ID_CHANGE,this,this.selectNpc);this.bossModel.off(a.BOSS_DETAIL_CHANGE,this,this.refreshBossIcon)};e.prototype.refreshAll=function(){var t=this;var e=csv.MapProxy.getIns().getCfg(game.Context.mainRole.mapId);if(e.pathpoint==0){app.ViewManager.toggleView(i.MiniMap,app.AppContainer.uiLayer,-1);return}Laya.loader.load("res/maps/"+e.mapfile+"/data.mapd",Laya.Handler.create(this,function(){t.vo=Laya.loader.getRes("res/maps/"+e.mapfile+"/data.mapd");t.pd.mapCfg=e;t.imgMap.skin="res/maps/"+e.mapfile+"/m.jpg";t.imgMap.width=t.vo.bgWidth/20;t.imgMap.height=t.vo.bgHeight/20;t.x=Laya.stage.width-t.imgMap.width;t.y=50+ScreenAdapter.OFFSET_Y;t.setNpcs();t.addChild(t.imgRole);t.selectNpc()}))};e.prototype.refreshRolePos=function(){var t=scene.SceneMediator.getInstance().getViewById(game.Context.mainRoleId);if(t){if(!this._rolePoint3D){this._rolePoint3D=new o}this._rolePoint3D.x=t.isoPosX;this._rolePoint3D.y=t.isoPosY;this._rolePoint3D.z=t.isoPosZ;this.setPlayerPos(this._rolePoint3D)}};e.prototype.refreshBossIcon=function(){if(this.imgNpcArr&&this.imgNpcArr.length>0){for(var t=0;t<this.imgNpcArr.length;t++){var e=this.imgNpcArr[t];var i=+this.npcArr[t].getCfg().param1;var n=csv.BossProxy.getIns().getCfg(i);var a=this.bossModel.getBossDetail(n.id);if(a){if(!a.deadtime){e.disabled=false}else{e.disabled=true}}}}};e.prototype.setPlayerPos=function(t){if(this.vo){var e=isometric.IsoUtils.isoToScreen(t);this.imgRole.x=e.x/20-this.vo.bg.bgOffsetX/20;this.imgRole.y=e.y/20-this.vo.bg.bgOffsetY/20}};e.prototype.addItem=function(t){if(t){var e=new Laya.Image;e.width=35;e.height=35;e.anchorX=.5;e.anchorY=1;e.skin="public/bg_map_boss.png";this.addChild(e);this.imgNpcArr.push(e);var i=t.getPosX();var n=t.getPosY();var a=isometric.IsoUtils.isoToScreen(new o(i*32,0,n*32));e.x=a.x/20-this.vo.bg.bgOffsetX/20;e.y=a.y/20-this.vo.bg.bgOffsetY/20;e.on(Laya.Event.CLICK,this,this.onBossClick)}};e.prototype.setNpcs=function(){this.imgNpcArr=[];this.npcArr=[];this.lastNpcArr=[];this.npcArr=csv.NpcProxy.getIns().getMapNpcList(game.Context.mainRole.mapId);var t=csv.MapProxy.getIns().getCfg(game.Context.mainRole.mapId);if(t.pathpoint==0){app.ViewManager.toggleView(i.MiniMap,app.AppContainer.uiLayer,-1);return}for(var e=0;e<this.npcArr.length;e++){this.addItem(this.npcArr[e]);this.addChild(this.imgSelect);this.lastNpcArr.push(this.npcArr[e])}this.refreshBossIcon()};e.prototype.onBossClick=function(t){t.stopPropagation();var e=t.currentTarget;var i=this.imgNpcArr.indexOf(e);if(this.lastNpcArr[i]){var n=this.lastNpcArr[i];game.SceneModel.getInstance().goto(n)}};e.prototype.selectNpc=function(){if(!this.lastNpcArr){return}this._selectDex=-1;for(var t=0;t<this.lastNpcArr.length;t++){var e=this.lastNpcArr[t].getCfg();if(e.npcid==this.bossModel.worldBossNpcId){this._selectDex=t;break}}if(this._selectDex!=-1&&this.imgNpcArr&&this.imgNpcArr.length>0&&this.imgNpcArr[this._selectDex].visible==false){return}if(this.lastNpcArr[this._selectDex]){this.imgSelect.visible=true;this.imgSelect.x=this.imgNpcArr[this._selectDex].x;this.imgSelect.y=this.imgNpcArr[this._selectDex].y}else{this.imgSelect.visible=false}};return e}(Laya.Box);i.MiniMap=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.zOrder=app.AppContainer.UI_LAYER_NUME.BOTTOMAIN_ICON;this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.imgmoneyicon01.on(Laya.Event.CLICK,this,this.onTipShow,[game.MoneyModel.MONEY_ENUM.SILVER]);this.labelmoneynum01.on(Laya.Event.CLICK,this,this.onTipShow,[game.MoneyModel.MONEY_ENUM.SILVER]);this.imgmoneyicon02.on(Laya.Event.CLICK,this,this.onTipShow,[game.MoneyModel.MONEY_ENUM.GOLD]);this.labelmoneynum02.on(Laya.Event.CLICK,this,this.onTipShow,[game.MoneyModel.MONEY_ENUM.GOLD])};e.prototype.onTipShow=function(t){var e;if(game.MoneyModel.MONEY_ENUM.GOLD==t){shop.ShopModel.getIns().moneyTips()}else if(game.MoneyModel.MONEY_ENUM.SILVER==t){e=game.ItemUtil.createVO(game.ItemUtil.ENUMS.TONGBI)}if(e){tip.TipManager.show(e,true)}};e.prototype.onDisplay=function(){this.onResize();this.on(Laya.Event.RESIZE,this,this.onResize);game.MoneyModel.getIns().on(game.MoneyModel.EVENTS.MONEY_CHANGE,this,this.onMoneyChange);this.callLater(this.updateLayout)};e.prototype.onUnDisplay=function(){this.off(Laya.Event.RESIZE,this,this.onResize);game.MoneyModel.getIns().off(game.MoneyModel.EVENTS.MONEY_CHANGE,this,this.onMoneyChange)};e.prototype.onResize=function(){this.x=Laya.stage.width-this.width;this.y=ScreenAdapter.OFFSET_Y};e.prototype.setPos=function(t,e){this.x=t?t:Laya.stage.width-this.width;if(e!=undefined){this.y=e}};e.prototype.onMoneyChange=function(t){if(t==game.MoneyModel.MONEY_ENUM.GOLD||t==game.MoneyModel.MONEY_ENUM.SILVER){this.callLater(this.updateLayout)}};e.prototype.updateLayout=function(){this.labelmoneynum01.text=game.MoneyModel.format(game.MoneyModel.getIns().getMoney(game.MoneyModel.MONEY_ENUM.SILVER));this.labelmoneynum02.text=game.MoneyModel.format(game.MoneyModel.getIns().getMoney(game.MoneyModel.MONEY_ENUM.GOLD))};e.SINGLE_KEY="main.MoneyView";return e}(ui.main.mainmoneyUI);t.MoneyView=e})(main||(main={}));var main;(function(t){var e=function(){function t(t,e){this._SCALE=20;this.handler=e;this.spr=t;this.pathShape=new Laya.Sprite;t.addChild(this.pathShape)}t.prototype.onDisplay=function(){var t=this.pathShape.graphics;t.clear();game.SceneModel.getInstance().on(game.SceneModel.EVENT_DRAW_PATH,this,this.onPathHandler)};t.prototype.onUnDisplay=function(){game.SceneModel.getInstance().off(game.SceneModel.EVENT_DRAW_PATH,this,this.onPathHandler)};t.prototype.onPathHandler=function(t){this.drawPath(t)};Object.defineProperty(t.prototype,"mapCfg",{get:function(){return this._mapCfg},set:function(t){this._mapCfg=t;this.vo=Laya.loader.getRes("res/maps/"+this._mapCfg.mapfile+"/data.mapd")},enumerable:true,configurable:true});t.prototype.drawPath=function(t){if(!this.spr.parent){return}var e=this.pathShape.graphics;e.clear();if(this.mapCfg&&parseInt(this.mapCfg.pathpoint||0)==1){var i=6;var n=0;for(var a=t.length;a>0;a--){if(n>=i){n=0;var o=t[a].x;var s=t[a].y;var r=isometric.IsoUtils.isoToScreen(new isometric.Point3D(o*scene.SceneArea.CELL_SIZE,0,s*scene.SceneArea.CELL_SIZE));o=r.x/this._SCALE-this.vo.bg.bgOffsetX/this._SCALE;s=r.y/this._SCALE-this.vo.bg.bgOffsetY/this._SCALE;e.drawCircle(o,s,3,"#b30b22")}n++}if(this.handler){this.handler.runWith([t])}}};return t}();t.PathDraw=e})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(i){var t=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.zOrder=app.AppContainer.UI_LAYER_NUME.BOTTOMAIN;this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.btnvip.on(Laya.Event.CLICK,this,this.onVip);this.btnzengyi.clickHandler=new Laya.Handler(this,this.onShowRoleBuffView);this.imgtouxiang.on(Laya.Event.CLICK,this,this.onShowEquip);this.animationvip.visible=false;this.animationvip.stop();this.funcAdapter=new game.FuncDotAdapter(this.spXin,0,0,true);var t=app.str2Array(csv.WindowProxy.getIns().getCfg(78).functionid,";");this.funcAdapter.obFunc(t);this.clipzhandouli.on(Laya.Event.CLICK,this,this.showScore);this.imgzhandouliicon.on(Laya.Event.CLICK,this,this.showScore);this.yan.on(Laya.Event.CLICK,this,this.showScore);guide.GuideModel.getIns().register(csv.GuideProxy.ENUM_VIEW.ROLE_MAIN_HEAD,this.imgtouxiang)};t.getRoleHead=function(){if(app.ViewManager.DisplayedInStage(i.RoleInfoView.SINGLE_KEY)){return i.RoleInfoView.getIns().imgtouxiang}return null};t.getRoleHeadPoint=function(){if(app.ViewManager.DisplayedInStage(i.RoleInfoView.SINGLE_KEY)){var t=i.RoleInfoView.getIns().imgtouxiang;return t.parent.localToGlobal(new Laya.Point(t.x,t.y))}return new Laya.Point(0,0)};t.prototype.showScore=function(){game.ClosureManager.callFunction(csv.FunctionsProxy.ENUMS.CHAKAN_SCORE)};t.prototype.onShowEquip=function(){var t=csv.MainIconProxy.getIns().getCfg(88);var e=csv.FunctionsProxy.getIns().convertCanOpenfuncid(t);game.ClosureManager.callFunction(e)};t.prototype.onShowRoleBuffView=function(){game.ClosureManager.callFunction(csv.FunctionsProxy.ENUMS.ROLE_BUFF_VIEW)};t.prototype.onVip=function(){game.ClosureManager.callFunction(csv.FunctionsProxy.ENUMS.VIP)};t.prototype.onDisplay=function(){this.callLater(this.updateLayout);this.onResize();this.on(Laya.Event.RESIZE,this,this.onResize);game.RoleModel.getIns().on(game.RoleModel.EVENTS.SCORE_UPDATE,this,this.setSorce);game.RoleModel.getIns().on(game.RoleModel.EVENTS.HEADFRAMEID_CHANGE,this,this.setHeadFrame);game.RoleModel.getIns().on(game.RoleModel.EVENTS.TEAM_ICON_CHANGE,this,this.setTeamIcon);game.RoleModel.getIns().on(game.RoleModel.EVENTS.TEAM_INFO_CHANGE,this,this.setTeamInfo);vipcode.VipModel.getIns().on(vipcode.VipEvent.VIP_CHANGE,this,this.setVip);gaiming.GaiMingModel.getIns().on(gaiming.GaiMingEvent.MAIN_NAME_CHANGE,this,this.setRoleName);this.onFuncRed(csv.FunctionsProxy.ENUMS.VIP);game.Context.on(game.ContextEvent.FUNCTION_DOT_CHANGE,this,this.onFuncRed);this.playYan();if(game.Context.HtmlParams["time"]==1){addtime()}csv.FunctionsProxy.getIns().checkCfgFile()};t.prototype.onUnDisplay=function(){this.off(Laya.Event.RESIZE,this,this.onResize);game.RoleModel.getIns().off(game.RoleModel.EVENTS.SCORE_UPDATE,this,this.setSorce);game.RoleModel.getIns().off(game.RoleModel.EVENTS.HEADFRAMEID_CHANGE,this,this.setHeadFrame);game.RoleModel.getIns().off(game.RoleModel.EVENTS.TEAM_ICON_CHANGE,this,this.setTeamIcon);game.RoleModel.getIns().off(game.RoleModel.EVENTS.TEAM_INFO_CHANGE,this,this.setTeamInfo);game.Context.off(game.ContextEvent.FUNCTION_DOT_CHANGE,this,this.onFuncRed);gaiming.GaiMingModel.getIns().off(gaiming.GaiMingEvent.MAIN_NAME_CHANGE,this,this.setRoleName);vipcode.VipModel.getIns().off(vipcode.VipEvent.VIP_CHANGE,this,this.setVip);this.stopYan()};t.prototype.onResize=function(){this.imgmoneybg.width=Laya.stage.width-this.imgmoneybg.x;this.y=ScreenAdapter.OFFSET_Y;this.x=0};t.prototype.onFuncRed=function(t){if(t==csv.FunctionsProxy.ENUMS.VIP){if(game.ClosureManager.hasDot(t)){game.RedDotView.addTo(this.btnvip,this.btnvip.width,75)}else{game.RedDotView.removeFrom(this.btnvip)}}};t.prototype.setVip=function(){this.animationvip.visible=false;this.animationvip.stop();var t=vipcode.VipModel.getIns().vipLvl;if(game.Context.disableIosRecharge()){this.boxVip.visible=false}else{if(t==0){this.imgkaitongvip.visible=true;this.imgvip.visible=false;this.clipvipnum.visible=false;this.animationvip.visible=true;this.animationvip.play(0,true)}else{this.imgkaitongvip.visible=false;this.imgvip.visible=true;this.clipvipnum.visible=true;this.clipvipnum.value=t.toString()}}};t.prototype.updateLayout=function(){this.setTeamInfo();this.setTeamIcon();this.setHeadFrame();this.setRoleName();this.setSorce();this.setVip()};t.prototype.setTeamInfo=function(){this.labelnumlv.text=game.Context.teamLv.toString();var t=csv.MyTeamProxy.getIns().getTeamMaxExp(game.Context.teamLv);this.barhp.value=game.Context.teamExp/t;this.shuzhi.text=Math.floor(this.barhp.value*100)+"%"};t.prototype.setSorce=function(){this.clipzhandouli.value=game.Context.score.toString()};t.prototype.setRoleName=function(){this.labelname.text=game.Context.clearPlayerName(game.Context.mainRole.playername)};t.prototype.setTeamIcon=function(){this.imgtouxiang.skin=csv.MyTeamProxy.getIns().getTeamIcon(game.Context.teamAvatar)};t.prototype.setHeadFrame=function(){this.imgframe.skin=game.RoleModel.getIns().getHeadFrameIcon()};t.prototype.playYan=function(){this.ani1.on(Laya.Event.COMPLETE,this,this.waitYan);this.ani1.play(0,false)};t.prototype.waitYan=function(){this.ani1.off(Laya.Event.COMPLETE,this,this.waitYan);Laya.timer.once(3e3,this,this.playYan)};t.prototype.stopYan=function(){this.ani1.off(Laya.Event.COMPLETE,this,this.waitYan);Laya.timer.clear(this,this.playYan)};t.SINGLE_KEY="main.RoleInfoView";return t}(ui.main.mainroleInfonew01UI);i.RoleInfoView=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(i){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t._timeOut=-1;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.btn=new Laya.Button;this.btn.skin="public/btn_jiantou_left.png";this.isExpand=true;this.btn.clickHandler=new Laya.Handler(this,this.onExpand)};t.prototype.onExpand=function(){this.isExpand=!this.isExpand;if(this.isExpand){this.btn.skin="public/btn_jiantou_right.png";this.refreshAll()}else{this.btn.skin="public/btn_jiantou_left.png";var t=this.getids();this.updateView([t[0]],true)}};t.prototype.onDisplay=function(){game.RoleModel.getIns().on(game.RoleModel.EVENTS.PLAYER_BUFF_CHANGE,this,this.refreshAll);this.callLater(this.refreshAll)};t.prototype.onResize=function(){var t=csv.MapProxy.getIns().getMapType(game.Context.mainRole.mapId);var e=0;if(t==csv.MapProxy.MAP_TYPE.HULU_DAO_BOSS||t==csv.MapProxy.MAP_TYPE.HULU_DAO_MONSTER||t==csv.MapProxy.MAP_TYPE.HULU_DAO){e=-120}this.y=app.AppContainer.UI_LAYER_Y.RIGHT_ICON+i.RightIconList.OFFY+i.RightIconList.GAP+e-84+ScreenAdapter.OFFSET_Y};t.prototype.onUnDisplay=function(){this.clean();game.RoleModel.getIns().off(game.RoleModel.EVENTS.PLAYER_BUFF_CHANGE,this,this.onBuffChange)};t.prototype.refreshAll=function(){this.onResize();this.isExpand=true;this.btn.skin="public/btn_jiantou_right.png";var t=this.getids();this.updateView(t,t.length>1)};t.prototype.onBuffChange=function(){this.refreshAll()};t.prototype.getids=function(){var t=[];if(game.RoleModel.getIns().bless[0]){var e=csv.MapProxy.getIns().getMapBlesson(game.Context.mainRole.mapId);var i=csv.MapProxy.getIns().getQuickbattlebuff(game.Context.mainRole.mapId);if(e){for(var n in game.RoleModel.getIns().bless[0].sid){var a=game.RoleModel.getIns().bless[0].sid[n];t.push(a)}}if(game.RoleModel.getIns().hasQuickbattlebuff()&&i){t.push(1204)}}return t};t.prototype.updateView=function(s,t){var r=this;var l=0;this.clean();if(t){this.btn.y=12;this.addChild(this.btn)}var e=function(t){var e=Laya.Pool.getItemByClass("ui.main.shanshenzhufuitemUI",ui.main.shanshenzhufuitemUI);if(e){e=new ui.main.shanshenzhufuitemUI}e.labeldaojishi.text="";e.imgdaojishi.visible=false;e.labelmiaoshu.text=app.getLang("state_bless");var i=csv.StatusProxy.getIns().getStatusBlessById(s[t]);if(i){e.btnchongwu.skin=i.icon+".png"}else{i=csv.StatusProxy.getIns().getStatusItem(s[t]);e.btnchongwu.skin="res/static/mainicon/btn_sub_zhandoujiacheng.png";var n=game.RoleModel.getIns().hasQuickbattlebuff();if(n){var a=game.Context.getServerTime();var o=n.gtime+n.sitem[0].stime-a;if(o>0){h._timeOut=setInterval(function(){var t=n.gtime+n.sitem[0].stime-game.Context.getServerTime();if(t>0){e.labeldaojishi.text=app.getLang(util.TimeUtil.sec2Str(t));e.imgdaojishi.visible=true}else{e.labeldaojishi.text="";e.imgdaojishi.visible=false;if(r._timeOut>=0){clearInterval(r._timeOut);r._timeOut=-1}r.refreshAll()}},1e3)}}}h.addChild(e);l=e.width};var h=this;for(var i=0;i<s.length;i++){e(i)}if(t){this.x=Laya.stage.width-l*s.length-this.btn.width-app.AppContainer.UI_LAYER_GAP.RIGHT_ICON-78}else{this.x=Laya.stage.width-l*s.length-app.AppContainer.UI_LAYER_GAP.RIGHT_ICON-78}};t.prototype.clean=function(){var t;var e;while(this.numChildren>0){t=this.getChildAt(0);if(t){t.removeSelf();Laya.Pool.recover("ui.main.shanshenzhufuitemUI",t)}else{e=this.getChildAt(0);if(e){e.removeSelf()}}}if(this._timeOut>=0){clearInterval(this._timeOut);this._timeOut=-1}};t.SINGLE_KEY="main.StatusBuffView";return t}(Laya.HBox);i.StatusBuffView=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var upgrade;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listwoyaobianqiang.itemRender=i.BeStrongerItem;this.listwoyaobianqiang.renderHandler=new Laya.Handler(this,this.onRenderHandler);this.listwoyaobianqiang.vScrollBarSkin=" "};e.prototype.onRenderHandler=function(t){t.setData(t.dataSource)};e.prototype.onDisplay=function(){};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(t){if(t===void 0){t=[]}var e=[];for(var i=1;i<t.length;i++){e.push(parseInt(t[i]))}var n=csv.LeadStrongerProxy.getIns().getStrongGrow();var a=[];if(n){a=this.getList(n.recommend)}for(var i=0;i<e.length;i++){for(var o=0;o<a.length;o++){if(e[i]==a[i].functionId){a.splice(o,1);break}}}var s=[];for(var i=0;i<a.length;i++){if(boss.BossModel.getIns().checkFunction(a[i].functionId,0)){s.push(a[i])}}this.listwoyaobianqiang.array=s};e.prototype.sortItem=function(t,e){if(t.state<e.state)return-1;if(t.state>e.state)return 1;return 0};e.prototype.getList=function(t){var e=[];if(t&&t.length>0){var i=app.str2Array(t,";","-");for(var n=0;n<i.length;n++){var a=parseInt(i[n].shift());var o=this.getState(a,i[n]);e.push({functionId:a,state:o[0],describe:o[1]})}}return e};e.prototype.compareValue=function(t,e,i){var n=0;if(t>e){n=2}else if(t>i){n=1}return n};e.prototype.getState=function(t,e){var i=0,n="";switch(t){case csv.FunctionsProxy.ENUMS.BOSS_CAVE:var a=equip.EquipModel.getIns().getEquipStrenState(parseInt(e[0]));if(a==3){i=2}else if(a==1||a==2){i=1}else if(a==0){i=0}n=app.getLang("beStrong_"+t+"_"+a);break;case csv.FunctionsProxy.ENUMS.EQUIP_WEAR:i=equip.EquipModel.getIns().getEquipLvlState(parseInt(e[0]),parseInt(e[1]));break;case csv.FunctionsProxy.ENUMS.CHOU_KA:i=this.compareValue(fabaonew.FaBaoNewModel.getIns().totalActiveCnt,parseInt(e[0]),parseInt(e[1]));break;case csv.FunctionsProxy.ENUMS.FABAONEW:var o=0;if(fabaonew.FaBaoNewModel.getIns().totalActiveCnt>0){o=fabaonew.FaBaoNewModel.getIns().allLvStar/fabaonew.FaBaoNewModel.getIns().totalActiveCnt}i=this.compareValue(o,parseInt(e[0]),parseInt(e[1]));break;case csv.FunctionsProxy.ENUMS.YUANSHEN_DONGFU:var s=yuanshencode.YuanshenModel.getIns().getYuanshenAllLv();i=this.compareValue(s,parseInt(e[0]),parseInt(e[1]));if(i==1){n=app.getLang("beStrong_"+t+"_"+i,yuanshencode.YuanshenModel.getIns().getYuanshenLvLowWa())}break;case csv.FunctionsProxy.ENUMS.MOUNT:i=this.compareValue(mount.MountModel.getIns().rideid,parseInt(e[0]),parseInt(e[1]));break;case csv.FunctionsProxy.ENUMS.PET_MAIN:break;case csv.FunctionsProxy.ENUMS.ROLE_MAIN:var r=parseInt(e[0]),l=parseInt(e[1]);if(game.Context.roleList.length>=l){i=2;for(var h=0;h<l;h++){if(game.Context.roleList[h].level<r){i=1;break}}}break}if(n.length==0){n=app.getLang("beStrong_"+t+"_"+i)}return[i,n]};e.SINGLE_KEY="main.BeStrongerView";return e}(ui.woyaobianqiang.woyaobianqiangviewUI);i.BeStrongerView=t})(upgrade||(upgrade={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listshanghaijiacheng.renderHandler=new Laya.Handler(this,this.onItemRender);this.listshanghaijiacheng.array=[]};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.onItemRender=function(t){var e=t.dataSource;var i=csv.StatusProxy.getIns().getStatusBlessById(e);if(i){t.btnchongwu.skin=i.icon+".png";t.labelmiaoshu.text=app.getLang("state_bless")}};e.prototype.refreshAll=function(){var t=game.RoleModel.getIns().bless[0].sid;this.listshanghaijiacheng.array=t;if(t.length>1){this.box.width=this.listshanghaijiacheng.width}else{this.box.width=this.listshanghaijiacheng.width*.5}};e.SINGLE_KEY="main.BlessonBuffTips";return e}(ui.zengyi.shanshenzhufuviewUI);t.BlessonBuffTips=e})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.itemArr=[];this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){boss.BossModel.getIns().on(boss.BossEvent.INSPIRE_CHANGE,this,this.refreshAll);game.RoleModel.getIns().on(game.RoleModel.EVENTS.PLAYER_BUFF_CHANGE,this,this.refreshAll);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){boss.BossModel.getIns().off(boss.BossEvent.INSPIRE_CHANGE,this,this.refreshAll);game.RoleModel.getIns().off(game.RoleModel.EVENTS.PLAYER_BUFF_CHANGE,this,this.refreshAll);for(var t=0,e=this.itemArr.length;t<e;t++){this.itemArr[t].removeSelf()}};e.prototype.refreshAll=function(){for(var t=0,e=this.itemArr.length;t<e;t++){this.itemArr[t].removeSelf()}var i=csv.InspireProxy.getIns().getTypeByBattleType();var n;if(i==csv.InspireProxy.ENUM_TYPE.SHHL){n=dailytask.DailyTaskModel.getIns().getGuildInspire()}else{n=battle.InspireNormalView.getInspireArr(i)}var a=[];var o=[];for(var t=0,e=n.length;t<e;t++){var s=n[t];var r=csv.InspireProxy.getIns().getCfg(s.inspireid);var l=csv.StatusProxy.getIns().getCfg(r.buffid);var h=Attributes.decode(l.elements);o=o.concat(Attributes.multiplyAttributes(h,s.num))}o=Attributes.hebingAttributes(o);if(o.length){for(var t=0,e=o.length;t<e;t++){a.push(Attributes.getShowLabel(o[t],"{0}+{1}"))}var p=0;for(var t=0;t<a.length;t++){if(!this.itemArr[t]){this.itemArr[t]=new ui.bosszhandou.guwushuziitemUI}var u=this.itemArr[t];u.lbljindu.text=a[t];u.y=p;this.addChild(u);p+=u.height}this.x=-this.width;this.y=(78-this.height)/2}};e.SINGLE_KEY="main.BuffOnBattle";return e}(Laya.Box);t.BuffOnBattle=e})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.x=(Laya.stage.width-this.width)/2;this.y=200+ScreenAdapter.OFFSET_Y;this.zOrder=app.AppContainer.UI_LAYER_NUME.TOP};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){Laya.timer.clearAll(this);this.ani1.stop()};e.prototype.onTweenEnd=function(){app.ViewManager.toggleView(i.DaYaoComingView,app.AppContainer.uiLayer,-1)};e.prototype.refreshAll=function(){this.ani1.play(0,true);Laya.timer.once(5e3,this,this.onTweenEnd)};e.SINGLE_KEY="main.DaYaoComingView";return e}(ui.bosszhandou.dayaolaixiUI);i.DaYaoComingView=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.btnzhuodayao.clickHandler=new Laya.Handler(this,this.onClickHandler);this.btnkaiqixiayizhgang.clickHandler=new Laya.Handler(this,this.onGotoNextChaper);guide.GuideModel.getIns().register(csv.GuideProxy.ENUM_VIEW.ZHUA_XIAOYAO,this)};e.prototype.onDisplay=function(){game.Context.event(game.ContextEvent.FUNCTION_OPEN);this.onResize();guaji.GuajiModel.getIns().on(guaji.GuajiModel.GUAJIPASS_DATA_UPDATE,this,this.refreshAll);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){game.Context.event(game.ContextEvent.FUNCTION_CLOSE);guaji.GuajiModel.getIns().off(guaji.GuajiModel.GUAJIPASS_DATA_UPDATE,this,this.refreshAll)};e.prototype.refreshAll=function(){var t=guaji.GuajiModel.getIns().passId;var e=csv.GuajiProxy.getIns().getCfgGuanqia(t+1);this.btnkaiqixiayizhgang.visible=false;this.btnzhuodayao.visible=false;if(e&&guaji.GuajiModel.getIns().state==1){this.btnkaiqixiayizhgang.visible=true}else if(guaji.GuajiModel.getIns().state==0){this.btnzhuodayao.visible=true}};e.prototype.onResize=function(){this.x=(Laya.stage.width-this.width)/2;this.y=Laya.stage.height-i.MainBottomView.HEIGHT+10-this.height-ScreenAdapter.OFFSET_BOTTOM};e.prototype.onClickHandler=function(){guaji.GuajiModel.getIns().onCheckpointReq();this.playGuildEff(false)};e.prototype.onGotoNextChaper=function(){if(csv.FunctionsProxy.getIns().isOpen(csv.FunctionsProxy.ENUMS.PASS,true)){app.ProtocolRequest.CheckpointReq();guaji.GuajiModel.getIns().changeNextMap()}this.playGuildEff(false)};e.prototype.playGuildEff=function(t){if(!this.aniEff){this.aniEff=new game.AniView;this.aniEff.load("skill_xuanzhong01",game.AniView.FILE_NAME.UI)}if(t){var e=void 0;if(this.btnkaiqixiayizhgang.visible){e=this.btnkaiqixiayizhgang}else if(this.btnzhuodayao.visible){e=this.btnzhuodayao}if(e){this.aniEff.x=e.x;this.aniEff.y=e.y;this.aniEff.play();this.aniEff.visible=true;this.addChild(this.aniEff)}}else{this.aniEff.stop();this.aniEff.visible=false;this.aniEff.removeSelf()}};e.SINGLE_KEY="main.GuajiChallengeView";e.H=68;return e}(ui.guaji.tiaozhananniuUI);i.GuajiChallengeView=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=guajiexp.GuajiExpModel.getIns();this.btnget.on(Laya.Event.CLICK,this,this._openMainView);guide.GuideModel.getIns().register(csv.GuideProxy.ENUM_VIEW.GUAJI_BAOXIANG,this.btnget,null,500)};e.prototype.onDisplay=function(){this._onResize();this.callLater(this.refreshAll);Laya.timer.loop(1e3,this,this.updateTime);guaji.SecretAreaModel.getIns().on(guaji.SecretAreaModel.SECRETAREA_INFO_UPDATE,this,this.setUp);guaji.GuajiModel.getIns().on(guaji.GuajiModel.GUAJIPASS_DATA_UPDATE,this,this.refreshAll);this._model.on(guajiexp.GuajiExpModel.UPDATE_GUAIJI_VIEW,this,this.refreshAll);app.ProtocolRequest.HangUpInfoReq()};e.prototype.onUnDisplay=function(){Laya.timer.clearAll(this);this.skt&&this.skt.stop();this.juling.stop();guaji.SecretAreaModel.getIns().off(guaji.SecretAreaModel.SECRETAREA_INFO_UPDATE,this,this.setUp);guaji.GuajiModel.getIns().off(guaji.GuajiModel.GUAJIPASS_DATA_UPDATE,this,this.refreshAll);this._model.off(guajiexp.GuajiExpModel.UPDATE_GUAIJI_VIEW,this,this.refreshAll)};e.prototype.isGuild=function(){return this.aniEff&&this.aniEff.visible};e.prototype.playGuildEff=function(t){if(!this.aniEff){this.aniEff=new game.AniView;this.aniEff.x=this.width/2;this.aniEff.y=this.height/2;this.aniEff.load("skill_xuanzhong01",game.AniView.FILE_NAME.UI)}if(t){this.aniEff.play();this.aniEff.visible=true;this.addChild(this.aniEff)}else{this.aniEff.stop();this.aniEff.visible=false;this.aniEff.removeSelf()}};e.prototype.refreshAll=function(){var t=guaji.GuajiModel.getIns().passId;if(t>1){this.visible=true}else if(guaji.GuajiModel.getIns().state==1){this.visible=true}else{this.visible=false}this.setRichBoxAni();this.setUp()};e.prototype.setRichBoxAni=function(t){if(t===void 0){t=this._model.state}this.baoxiangimg.visible=true;this.spritelonggu.visible=false;if(t==4){var e="res/sks/xiangzi.sk";this.setAvatar(e);this.spritelonggu.visible=true;this.baoxiangimg.visible=false;this.animationtishi01.visible=true;this.animationtishi01.play(0,true)}else if(t==2){var e="res/sks/xiangzi.sk";this.setAvatar(e);this.spritelonggu.visible=true;this.baoxiangimg.visible=false;this.animationtishi01.visible=false;this.animationtishi01.stop()}else{this.animationtishi01.visible=false;this.animationtishi01.stop()}if(this._model.state==1){this.imgbaoxiang.skin=""}else{this.imgbaoxiang.skin="res/static/guajishouyi/bg_shangcheng_yuanbao"+this._model.state+".png"}};e.prototype.updateTime=function(){if(this._model.guajiData.lastRewardTime==0){return}if(game.Context.getServerTime()-this._model.guajiData.lastRewardTime>=this._model.limitMax){this.animationtishi01.visible=true;this.animationtishi01.play(0,true);return}this.setRichBoxAni()};e.prototype._openMainView=function(){guaji.GuajiModel.getIns().onShowGuajiView(0)};e.prototype.setAvatar=function(t){if(this.skt&&this.skt.parent){return}else{this.skt=new common.CSkt}this.skt.init(t);this.spritelonggu.addChild(this.skt)};e.prototype.setUp=function(){var t=guaji.SecretAreaModel.getIns().getBuffTime();if(t>0){this.juling.play();this.juling.visible=true}else{this.juling.stop();this.juling.visible=false}};e.prototype._onResize=function(){this.x=(Laya.stage.width-this.width)/2;this.y=Laya.stage.height-i.MainBottomView.HEIGHT+10-i.GuajiChallengeView.H-this.height-ScreenAdapter.OFFSET_BOTTOM};e.SINGLE_KEY="guaji.GuajiExpView";return e}(ui.main.mainguajishouyiUI);i.GuajiExpView=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(i){var t=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.imgdi.width=Laya.stage.width;this.imgdi.height=Laya.stage.height;this.wa.width=Laya.stage.width;this.boxdonghua.x=Laya.stage.width*.5;this.boxdonghua.y=Laya.stage.height*.5;this.boxbianfu.x=Laya.stage.width*.5;var t=app.AppContainer.getScale(750,1334);this.boxdonghua.scale(t,t);this.ani1.on(Laya.Event.COMPLETE,this,this.onAniEnd);this._stepHandler=new Laya.Handler(this,this.onQuick);this.bianfu1.stop();this.bianfu2.stop()};t.prototype.onQuick=function(){app.ViewManager.toggleView(i.GuildGuajiView,app.AppContainer.zhezhaoLayer,-1)};t.prototype.onAniEnd=function(){Laya.timer.once(2e3,this,this.playStory)};t.prototype.playStory=function(){this.bianfu1.stop();this.bianfu2.stop();talk.TalkModel.getIns().createPlotid(8102);talk.TalkModel.getIns().callBack=this._stepHandler;talk.TalkModel.getIns().event(talk.TalkModel.STORY_TIGGER,csv.StoriesProxy.ENUM_TIGGER.TASK_GET)};t.prototype.onDisplay=function(){this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){this.ani1.stop();this.bianfu1.stop();this.bianfu2.stop();app.MyTween.clearAll(this.wa);Laya.timer.clearAll(this)};t.prototype.refreshAll=function(){this.ani1.play(0,false);this.bianfu1.play(0,true);this.bianfu2.play(0,true);this.wa.y=Laya.stage.height;app.MyTween.to(this.wa,{y:Laya.stage.height-this.wa.height},500,Laya.Ease.linearNone)};t.SINGLE_KEY="main.GuildGuajiView";return t}(ui.guaji.xiangyaopiantouUI);i.GuildGuajiView=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var game;(function(n){var t=function(i){__extends(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){i.prototype.initialize.call(this);var t=csv.ReportProxy.getIns().cfgArr;for(var e=0;e<t.length;e++){this["jubao0"+(e+1)].label=app.getLang(t[e].type);this["jubao0"+(e+1)].on(Laya.Event.CHANGE,this,this.onCheckboxChange,[e])}this.selectedType=0;this.neirong.maxChars=n.Config.getIntParams(1240);this.btnqueding.clickHandler=new Laya.Handler(this,this.onClickBtn);this.neirong.on(Laya.Event.FOCUS,this,this.focusIn);this.neirong.on(Laya.Event.INPUT,this,this.onTxtChanged);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};t.prototype.onDisplay=function(){var t=n.Config.getIntParams(1240);this.neirong.text="";this.neirong.prompt=app.getLang("report2");this.neirong.promptColor=n.STYLES.GRAY_COLOR_S;this.jishu.text=app.getLang("report6",t);this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){};t.prototype.refreshAll=function(){this.mingzi.text=app.getLang(this.dataSource.menuRoleName)};t.prototype.focusIn=function(){};t.prototype.onTxtChanged=function(){var t=this.neirong.maxChars-this.neirong.text.length;this.jishu.text=app.getLang("report6",t)};t.prototype.onCheckboxChange=function(t){var e=csv.ReportProxy.getIns().cfgArr;if(this["jubao0"+(t+1)].selected){for(var i=0;i<e.length;i++){if(i!=t){this["jubao0"+(i+1)].selected=false}}this.selectedType=e[t].id}else{this.selectedType=0}};t.prototype.onClickBtn=function(){if(this.selectedType==0){manager.FlowManager.instance.flowByStyle1(app.getLang("report4"));return}var t=n.JuBaoModel.getIns().CDTime;if(t>0){manager.FlowManager.instance.flowByStyle1(app.getLang("report3"));return}var e=this.dataSource.menuRoleUid;n.JuBaoModel.getIns().jubao(e,this.dataSource.menuRoleName||"",this.selectedType,this.neirong.text);n.JuBaoModel.getIns().startCD()};t.SINGLE_KEY="game.JubaoView";return t}(ui.youxishezhi.jubaotipsUI);n.JubaoView=t})(game||(game={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var upgrade;(function(i){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t._functionId=0;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.btnqianwang.clickHandler=new Laya.Handler(this,this.onClickHandler)};t.prototype.onDisplay=function(){this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){};t.prototype.refreshAll=function(){};t.prototype.onClickHandler=function(){app.ViewManager.toggleDialog(i.BeStrongerItem,-1,0);game.ClosureManager.callFunction(this._functionId)};t.prototype.setData=function(t){this._functionId=t.functionId;var e=csv.FunctionsProxy.getIns().getCfg(this._functionId);var i=csv.FunctionsProxy.getIns().getUrl(e.growicon,0);this.imgmubiaoicon.skin=i;this.imgtupian.skin="woyaobianqiang/bg_"+t.state+".png";this.labelmiaoshu.text=t.describe};t.SINGLE_KEY="main.BeStrongerItem";return t}(ui.woyaobianqiang.woyaobianqinagitemUI);i.BeStrongerItem=t;var e=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t._functionId=0;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.btnqianwang.clickHandler=new Laya.Handler(this,this.onClickHandler)};t.prototype.onDisplay=function(){this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){Laya.timer.clear(this,this.updateTime)};t.prototype.refreshAll=function(){};t.prototype.onClickHandler=function(){app.ViewManager.toggleDialog(i.LeadUpgradeView,-1,0);if(this._functionId==csv.FunctionsProxy.ENUMS.TASK_MAIN){game.ClosureManager.callFunction(this._functionId,true,false,"levelup")}else if(this._functionId==csv.FunctionsProxy.ENUMS.GUAIJI_MAIN){guaji.GuajiModel.getIns().changeMap();main.GuajiExpView.getIns().playGuildEff(true)}else if(this._functionId==csv.FunctionsProxy.ENUMS.PASS){guaji.GuajiModel.getIns().changeMap();main.GuajiChallengeView.getIns().playGuildEff(true)}else if(this._functionId==csv.FunctionsProxy.ENUMS.QUICK_GUAJI){guaji.GuajiModel.getIns().changeMap();role.QuickGuajiView.boEffect=true;var t=main.MainUIIcon.getMainUIIcon(csv.MainIconProxy.TYPE_ICON_QUICKGUAJI);if(t){t.setEffect(true)}}else{game.ClosureManager.callFunction(this._functionId,true,false)}};t.prototype.getCondition=function(){var t="";var e;var i;var n,a=1;var o=dailytask.DailyTaskModel.getIns().taskMainId;n=csv.DungeonProxy.getIns().getZxrwTypeCfg(a,o+1);if(!n){a=2;n=csv.DungeonProxy.getIns().getZxrwTypeCfg(a,o+1);if(n){e=parseInt(n.chapter);i=parseInt(n.round)}}else{e=parseInt(n.chapter);i=parseInt(n.round)}var s=[];if(e>0){s=csv.DungeonProxy.getIns().getZxrwTypeArr(a,e)}var r;for(var l=0,h=s.length;l<h;l++){var p=s[l];var u=parseInt(p.round);if(i==u){r=p;break}}if(r){if(game.Context.isTeamLvReach(r.teamlevel,false)){if(parseInt(r.taskid)){if(game.TaskModel.getIns().hasCompleteTask(r.taskid)){}else{t=app.getLang("func_er_6",csv.TaskProxy.getTaskName(r.taskid))}}}else{t=app.getLang("huluxiongdi_needlevel2",r.teamlevel)}}else{t=app.getLang("已通关")}return t};t.prototype.updateTime=function(){if(guajiexp.GuajiExpModel.getIns().guajiData.lastRewardTime==0){return}if(game.Context.getServerTime()-guajiexp.GuajiExpModel.getIns().guajiData.lastRewardTime>=guajiexp.GuajiExpModel.getIns().limitMax){this.tiaojian.text=guajiexp.GuajiExpModel.getIns().limitMax+"";return}this.tiaojian.text=app.getLang("收益：{0}",guajiexp.GuajiExpModel.getIns().getGuajiTime())};t.prototype.setData=function(t){Laya.timer.clear(this,this.updateTime);this._functionId=t.functionId;var e=csv.FunctionsProxy.getIns().getCfg(this._functionId);var i=e.describe;var n=csv.FunctionsProxy.getIns().getUrl(e.growicon,0);this.labelmiaoshu.text=app.getLang(i);this.imgmubiaoicon.skin=n;this.btnqianwang.disabled=false;if(this._functionId==csv.FunctionsProxy.ENUMS.TASK_MAIN){var a=game.Context.roleList.length;if(a<7){this.imgmubiaoicon.skin="res/static/mainicon/btn_sub_huluxiongdi_"+(a+1)+".png"}else{this.imgmubiaoicon.skin="res/static/mainicon/btn_sub_huluxiongdi_1.png"}var o=this.getCondition();if(o.length>0){this.tiaojian.text=o;this.btnqianwang.disabled=true}else{var s=dailytask.DailyTaskModel.getIns().taskMainId;var r=csv.DungeonProxy.getIns().getZxrwTypeCfg(1,s+1),l=void 0,h=void 0;if(!r){r=csv.DungeonProxy.getIns().getZxrwTypeCfg(2,s+1);if(r){l=parseInt(r.chapter);h=parseInt(r.round);this.tiaojian.text=app.getLang("可挑战精英{0}",l+"-"+h)}}else{l=parseInt(r.chapter);h=parseInt(r.round);this.tiaojian.text=app.getLang("可挑战{0}",l+"-"+h)}}}else if(this._functionId==csv.FunctionsProxy.ENUMS.GUAIJI_MAIN){var p=!(guajiexp.GuajiExpModel.getIns().state==1);if(p){this.tiaojian.text=app.getLang("收益：{0}",guajiexp.GuajiExpModel.getIns().getGuajiTime());Laya.timer.loop(1e3,this,this.updateTime)}else{this.tiaojian.text=app.getLang("收益：00:00:00");this.btnqianwang.disabled=true}this.labelmiaoshu.text=app.getLang("functionopen_273",guajiexp.GuajiExpModel.getIns().get963MaxTime()/3600)}else if(this._functionId==csv.FunctionsProxy.ENUMS.PASS){var u=csv.GuajiProxy.getIns().getCfgGuanqia(guaji.GuajiModel.getIns().passId);var c=csv.GuajiProxy.getIns().getPart(u.id).index;this.tiaojian.text=app.getLang("可挑战{0}",u.chapter+"-"+c);if(u&&game.Context.teamLv<u.teamlevel){this.btnqianwang.disabled=true}}else if(this._functionId==csv.FunctionsProxy.ENUMS.QUICK_GUAJI){var g=game.RoleModel.getIns().getTrainTimes();this.tiaojian.text=app.getLang("剩余次数{0}",g);if(g==0){this.btnqianwang.disabled=true}}};t.SINGLE_KEY="main.LeadStrongerItem";return t}(ui.woyaobianqiang.xuanzeqianwangitem1UI);i.LeadStrongerItem=e})(upgrade||(upgrade={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var upgrade;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listwoyaobianqiang.itemRender=i.LeadStrongerItem;this.listwoyaobianqiang.renderHandler=new Laya.Handler(this,this.onRenderHandler);this.listwoyaobianqiang.vScrollBarSkin=" "};e.prototype.onDisplay=function(){};e.prototype.onUnDisplay=function(){};e.prototype.onRenderHandler=function(t){t.setData(t.dataSource)};e.prototype.refreshAll=function(t){if(t===void 0){t=[]}var e=[];for(var i=1;i<t.length;i++){e.push(parseInt(t[i]))}var n=t[0]==1?csv.LeadStrongerProxy.getIns().getLevelGrow():csv.LeadStrongerProxy.getIns().getStrongGrow();var a=[];if(n){a=csv.LeadStrongerProxy.getIns().getList(n.recommend)}for(var i=0;i<e.length;i++){for(var o=0;o<a.length;o++){if(e[i]==a[i].functionId){a.splice(o,1);break}}}a.sort(this.sortByLv);var s=[];for(var i=0;i<a.length;i++){if(boss.BossModel.getIns().checkFunction(a[i].functionId,a[i].dailyTimeId)){s.push(a[i])}}this.listwoyaobianqiang.array=s};e.prototype.sortByLv=function(t,e){if(t.lv>e.lv)return-1;if(t.lv<e.lv)return 1;if(csv.FunctionsProxy.getIns().isOpen(t.functionId)&&!csv.FunctionsProxy.getIns().isOpen(e.functionId))return-1;if(csv.FunctionsProxy.getIns().isOpen(e.functionId)&&!csv.FunctionsProxy.getIns().isOpen(t.functionId))return 1};e.SINGLE_KEY="main.LeadUpgradeView";return e}(ui.woyaobianqiang.kuaisushengjiviewUI);i.LeadUpgradeView=t})(upgrade||(upgrade={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(n){var t=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._mask=new Laya.Image;this._mask.width=Laya.stage.width;this._mask.height=Laya.stage.height;this._mask.sizeGrid="9,9,11,9";this._mask.skin="public/bg_jiugong_zhezhao2.png";this.addChildAt(this._mask,0);this.mouseEnabled=true;this.zOrder=200;this.minTime=100;this.maxTime=1e3;this.x=(Laya.stage.width-this.width)/2;this.y=(Laya.stage.height-this.height)/2;this._mask.x=-this.x;this._mask.y=-this.y;var t=app.AppContainer.getMaxScale(1e3,1500);this.box.scale(t,t);this.ani1.on(Laya.Event.COMPLETE,this,this.onAniEnd);this.ani1.on("p_s_complete",this,this.onShowEnd)};t.prototype.onDisplay=function(){guide.GuideModel.getIns().boOpen=false;this._mask.visible=true;this._boShowEnd=false;app.SoundManager.getIns().playSound("loading");battle.BattleManager.getIns().boMapLoadHide=false;this.showTime=Laya.timer.currTimer;game.Context.on(game.ContextEvent.MAP_LOAD_COMPLETE,this,this.mapComplete);this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){guide.GuideModel.getIns().boOpen=true;battle.BattleManager.getIns().boMapLoadHide=true;game.Context.off(game.ContextEvent.MAP_LOAD_COMPLETE,this,this.mapComplete);Laya.timer.clearAll(this)};t.prototype.open=function(){Laya.timer.clearAll(this);battle.BattleManager.getIns().boMapLoadHide=false;this.showTime=Laya.timer.currTimer;game.Context.on(game.ContextEvent.MAP_LOAD_COMPLETE,this,this.mapComplete);this.callLater(this.refreshAll)};t.prototype.onShowEnd=function(){this._boShowEnd=true;this.checkOpenDoor()};t.prototype.mapComplete=function(){this.checkOpenDoor()};t.prototype.refreshAll=function(){this.ani1.playToAndStop(10);this.playCircle()};t.prototype.playCircle=function(){this.imgzhongxin.rotation=0;this.imgzhongxinhuan.rotation=0;Laya.timer.frameLoop(1,this,this.loopCircle)};t.prototype.loopCircle=function(){this.imgzhongxin.rotation+=2;this.imgzhongxinhuan.rotation-=2};t.prototype.checkOpenDoor=function(){if(scene.SceneMediator.getInstance().isLoading||!this._boShowEnd){return}var t=Laya.timer.currTimer-this.showTime;Laya.timer.once(this.maxTime-t,this,this.openDoor)};t.prototype.openDoor=function(){this._mask.visible=false;battle.BattleManager.getIns().boMapLoadEnd=true;game.Context.off(game.ContextEvent.MAP_LOAD_COMPLETE,this,this.mapComplete);Laya.timer.clear(this,this.openDoor);this.ani1.play(10)};t.prototype.onAniEnd=function(){var t=game.TaskModel.getIns().getCompleteTask(1160);if(t){app.ViewManager.toggleView(n.MapLoadView,app.AppContainer.zhezhaoLayer,-1)}else{var e=csv.StoriesProxy.getIns().getGroupByPlotid(8102)[0].id;var i=Laya.LocalStorage.getItem(game.AccountModel.accountId+"_story_"+e);t=game.TaskModel.getIns().currMainTask.data.questIndex==1160;if(!t||i&&i=="1"){app.ViewManager.toggleView(n.MapLoadView,app.AppContainer.zhezhaoLayer,-1)}else{app.ViewManager.toggleView(n.GuildGuajiView,app.AppContainer.zhezhaoLayer,1);app.ViewManager.toggleView(n.MapLoadView,app.AppContainer.zhezhaoLayer,-1)}}};t.SINGLE_KEY="main.MapLoadView";t.FIRST_ENTER=true;t.MAP_LOAD_HIDE="map_load_hide";return t}(ui.guochangdonghua.guochangdonghuaview1UI);n.MapLoadView=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.x=(Laya.stage.width-this.width)/2;this.y=(Laya.stage.height-this.height)/2-300;this._tweenEndHandler=new Laya.Handler(this,this.onTweenEnd)};e.prototype.onDisplay=function(){battle.BattleManager.getIns().on(battle.BattleManager.MAP_LOAD_END,this,this.startTween);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){battle.BattleManager.getIns().off(battle.BattleManager.MAP_LOAD_END,this,this.startTween);Laya.Tween.clearAll(this);this.alpha=1;this.y=(Laya.stage.height-this.height)/2-300};e.prototype.refreshAll=function(){this.imgmijinggong.skin=this.dataSource[0];if(this.dataSource[1]<=0){this.labelmiaoshu.text=app.getLang("guanqia_tip_1")}else{this.labelmiaoshu.text=app.getLang("guaji_map_expup",this.dataSource[1])}};e.prototype.startTween=function(){Laya.Tween.to(this,{y:this.y-100,alpha:0},500,Laya.Ease.linearNone,this._tweenEndHandler,1e3)};e.prototype.onTweenEnd=function(){app.ViewManager.toggleView(i.MapNameView,app.AppContainer.uiLayer,-1)};e.SINGLE_KEY="main.MapNameView";return e}(ui.main.yemiantiaozhuantishiUI);i.MapNameView=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(i){var t=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._mask=new Laya.Image;this._mask.width=Laya.stage.width;this._mask.height=Laya.stage.height;this._mask.sizeGrid="9,9,11,9";this._mask.skin="public/bg_jiugong_zhezhao2.png";this.addChildAt(this._mask,0);this.mouseEnabled=true;this.zOrder=200;this.minTime=100;this.maxTime=1e3;this.x=(Laya.stage.width-this.width)/2;this.y=(Laya.stage.height-this.height)/2;this._mask.x=-this.x;this._mask.y=-this.y;var t=app.AppContainer.getMaxScale(1e3,1500);this.box.scale(t,t);this.ani1.on(Laya.Event.COMPLETE,this,this.onAniEnd);this.ani1.on("p_s_complete",this,this.openDoor)};t.prototype.onDisplay=function(){this._mask.visible=true;app.SoundManager.getIns().playSound("loading");this.showTime=Laya.timer.currTimer;this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){Laya.timer.clearAll(this)};t.prototype.open=function(){Laya.timer.clearAll(this);this.showTime=Laya.timer.currTimer;this.callLater(this.refreshAll)};t.prototype.refreshAll=function(){this.ani1.playToAndStop(10);this.playCircle()};t.prototype.playCircle=function(){this.imgzhongxin.rotation=0;this.imgzhongxinhuan.rotation=0;Laya.timer.frameLoop(1,this,this.loopCircle)};t.prototype.loopCircle=function(){this.imgzhongxin.rotation+=2;this.imgzhongxinhuan.rotation-=2};t.prototype.openDoor=function(){this._mask.visible=false;Laya.timer.clear(this,this.openDoor);this.ani1.play(10)};t.prototype.onAniEnd=function(){app.ViewManager.toggleView(i.ModuleLoadView,app.AppContainer.zhezhaoLayer,-1)};t.SINGLE_KEY="main.ModuleLoadView";return t}(ui.guochangdonghua.guochangdonghuaview1UI);i.ModuleLoadView=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.x=(Laya.stage.width-this.width)/2;this.y=200+ScreenAdapter.OFFSET_Y;this.zOrder=app.AppContainer.UI_LAYER_NUME.TOP;this._tweenEndHandler=new Laya.Handler(this,this.onTweenEnd)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){Laya.timer.clearAll(this);Laya.Tween.clearAll(this);this.alpha=1;this.y=200+ScreenAdapter.OFFSET_Y};e.prototype.refreshAll=function(){Laya.timer.once(3e3,this,this.startTween)};e.prototype.startTween=function(){Laya.Tween.to(this,{y:this.y-100,alpha:0},1e3,Laya.Ease.linearNone,this._tweenEndHandler,1e3)};e.prototype.onTweenEnd=function(){app.ViewManager.toggleView(i.PassCompleteView,app.AppContainer.uiLayer,-1)};e.SINGLE_KEY="guaji.PassCompleteView";return e}(ui.guaji.tongguantixingUI);i.PassCompleteView=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.itemdaoju01.shuzi.text="";this.lblDesc2.gray=true;this.lblTime2.gray=true;this.descArr=[];this.descArr.push(this.lblDesc1,this.lblDesc2);this.timeArr=[];this.timeArr.push(this.lblTime1,this.lblTime2)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){this.clean()};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){this.clean();if(t instanceof StatusItemGroup){this._data=t;var e=csv.StatusProxy.getIns().getStatusItem(t.sitem[0].sid);var i=util.TimeUtil.formatDate(t.gtime,true,false,true,true);this.itemdaoju01.gezibg.skin="res/icon/buff/"+e.iconid+".png";this.labelmiaoshu02.text=app.getLang(e.explain);var n=game.Context.getServerTime();for(var a=0;a<2;a++){this.descArr[a].visible=false;this.timeArr[a].visible=false;if(t.sitem[a]){this.descArr[a].text=app.getLang(csv.StatusProxy.getIns().getStatusItem(t.sitem[a].sid).name);if(a==0){var o=t.gtime+t.sitem[a].stime-game.Context.getServerTime();this.timeArr[a].text=app.getLang(util.TimeUtil.sec2Str(o))}else{this.timeArr[a].text=app.getLang(util.TimeUtil.sec2Str(t.sitem[a].stime))}this.descArr[a].visible=true;this.timeArr[a].visible=true}}var s=t.gtime+t.sitem[0].stime-n;if(s>0){this.timeArr[0].text=app.getLang(util.TimeUtil.sec2Str(s));Laya.timer.loop(1e3,this,this.coolDown,[t.gtime+t.sitem[0].stime])}}else{this.itemdaoju01.gezibg.skin="res/icon/buff/"+t.iconid+".png";this.labelmiaoshu02.text=t.name;for(var a=0;a<2;a++){this.descArr[a].visible=false;this.timeArr[a].visible=false}this.lblDesc1.text=t.explain;this.lblDesc1.visible=true}};e.prototype.clean=function(){Laya.timer.clear(this,this.coolDown)};e.prototype.coolDown=function(t){var e=t-game.Context.getServerTime();if(e>0){this.timeArr[0].text=app.getLang(util.TimeUtil.sec2Str(e))}else{this.timeArr[0].text="00:00:00";this.clean();i.RoleBuffView.getIns().coolDown()}};e.SINGLE_KEY="main.RoleBuffItem";return e}(ui.zengyi.zengyijiachengitemUI);i.RoleBuffItem=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listmiaoshu.itemRender=i.RoleBuffItem;this.listmiaoshu.renderHandler=new Laya.Handler(this,this.onItemRender);this.listmiaoshu.vScrollBarSkin=" ";this.roleMediator=new common.RoleListMediator(this.itemxuanze.xuanzelist,equip.RoleItem,new Laya.Handler(this,this.roleSelectChange));this.roleMediator.setData(0)};e.prototype.roleSelectChange=function(){};e.prototype.onItemRender=function(t){t.setData(t.dataSource)};e.prototype.onDisplay=function(){game.RoleModel.getIns().on(game.RoleModel.EVENTS.PLAYER_BUFF_CHANGE,this,this.refreshAll);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){game.RoleModel.getIns().off(game.RoleModel.EVENTS.PLAYER_BUFF_CHANGE,this,this.refreshAll)};e.prototype.coolDown=function(){if(app.ViewManager.DisplayedInStage(e.SINGLE_KEY)){this.refreshAll()}};e.prototype.refreshAll=function(){var t=game.RoleModel.getIns().buffGroup;if(t&&t.length>0){t.forEach(function(a,t,e){if(a.sitem){a.sitem.forEach(function(t,e,i){var n=a.gtime+t.stime-game.Context.getServerTime();if(n<=0){i.splice(e,1)}});if(a.sitem.length==0){e.splice(t,1)}}})}var e=[];if(guild.GuildModel.getIns().guildVO){var i=csv.GuildProxy.getIns().getLobbyCfg(guild.GuildModel.getIns().guildVO.guildInf.level);if(i){e.push({iconid:i.iconid,name:app.getLang(i.des),explain:app.getLang(i.name)})}}if(team.TeamZhanyouModel.getIns().bcid>0){var n=app.str2Array(game.Config.getParams(612),";");n=n.concat(app.str2Array(game.Config.getParams(613),";"));for(var a=0;a<n.length;a++){var i=csv.StatusProxy.getIns().getStatusItem(parseInt(n[a]));if(i){e.push({iconid:i.iconid,name:app.getLang(i.name),explain:app.getLang(i.explain)})}}}t=t.concat(e);this.listmiaoshu.array=t};e.SINGLE_KEY="main.RoleBuffView";return e}(ui.zengyi.zengyiviewUI);i.RoleBuffView=t})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.getProf=function(){return this._prof};e.prototype.setData=function(t){this._prof=t;this.imgRole.skin="res/static/jiesuohulu/role_"+t+".png";this.imgzhezhao.skin="res/static/jiesuohulu/role_bg_"+t+".png"};e.prototype.setImageHuluGary=function(){this.imgRole.visible=false;this.imgzhezhao.visible=false;this.ani1.gotoAndStop(0)};e.prototype.setImageGray=function(){this.ani1.stop();this.imgRole.visible=true;this.imgzhezhao.visible=false;this.gray=true};e.prototype.setImageRole=function(){this.gray=false;this.ani1.stop();this.imgRole.visible=true;this.imgzhezhao.visible=false};e.prototype.setImageMask=function(){this.gray=false;this.ani1.stop();this.imgRole.visible=true;this.imgzhezhao.visible=true};e.prototype.playAni=function(){this.imgRole.visible=false;this.imgzhezhao.visible=false;this.ani1.play(0,false)};e.SINGLE_KEY="main.RoleChooseItem";return e}(ui.huluwajiesuo.huluwaitemUI);i.RoleChooseItem=t;var e=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.offset=0;t.selectIndex=0;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.roleList=[this.boxr1,this.boxr2,this.boxr3,this.boxr4,this.boxr5,this.boxr6,this.boxr7];this.prof=[1,2,3,4,5,6,7];for(var t=1;t<=7;t++){this.getRoleHuluItem(this.roleList[this.prof.indexOf(t)]).setData(t)}this.posList=[new Laya.Point(this.boxr1.x,this.boxr1.y),new Laya.Point(this.boxr3.x,this.boxr3.y),new Laya.Point(this.boxr7.x,this.boxr7.y),new Laya.Point(this.boxr4.x,this.boxr4.y),new Laya.Point(this.boxr6.x,this.boxr6.y),new Laya.Point(this.boxr5.x,this.boxr5.y),new Laya.Point(this.boxr2.x,this.boxr2.y)];this.childIndex=[this.getChildIndex(this.boxr1),this.getChildIndex(this.boxr3),this.getChildIndex(this.boxr7),this.getChildIndex(this.boxr4),this.getChildIndex(this.boxr6),this.getChildIndex(this.boxr5),this.getChildIndex(this.boxr2)];this.btnzuo.visible=false;this.btnyou.visible=false;this.listjineng.itemRender=xiulian.SkillGridView;this.listjineng.renderHandler=new Laya.Handler(this,this.onItemRender);this.labelqianwangshengji.text=app.getLang("preshow3");this.labelshengji.text=app.getLang("preshow4");this.labelqianwangshengji.on(Laya.Event.LINK,this,this.onHandler);this.labelshengji.on(Laya.Event.LINK,this,this.onHandler);this.on(Laya.Event.MOUSE_DOWN,this,this.onClick)};t.prototype.onHandler=function(t){app.ViewManager.toggleDialog(i.RoleChooseView,-1,0);chat.ChatStatic.dellLink(t)};t.prototype.openView=function(){var t=game.Context.roleList.length+1;var e=csv.DefclassProxy.getIns().getCfgCreate(t);if(e){app.ViewManager.toggleView(i.RoleCreateView,app.AppContainer.talkLayer,1)}};t.prototype.onClick=function(t){var e;var i=0;for(var n=1;n<=game.Context.TOTAL_ROLE_NUM;n++){e=this.getRoleHuluItem(this.roleList[this.prof.indexOf(n)]);if(e&&e.imgzhezhao&&e.imgzhezhao.source){var a=e.globalToLocal(new Laya.Point(t.stageX,t.stageY));var o=e.imgzhezhao.source.getPixels(a.x,a.y,1,1);if(o){var s=o.join("");if(s=="0000"){continue}else{i=e.getProf()}}else{continue}}}if(i>0){this.onChoose(i)}};t.prototype.onChoose=function(t){this.selectIndex=t-1;for(var e=0;e<this.roleList.length;++e){this.roleList[e].scaleX=1;this.roleList[e].scaleY=1;this.getRoleHuluItem(this.roleList[e]).setImageGray();if(this.prof[e]<=game.Context.roleList.length){this.getRoleHuluItem(this.roleList[e]).setImageMask()}}this.roleList[this.selectIndex].scaleX=1.5;this.roleList[this.selectIndex].scaleY=1.5;this.getRoleHuluItem(this.roleList[this.selectIndex]).setImageRole();this.updateView(this.prof[this.selectIndex]);this.setChildIndex(this.roleList[this.selectIndex],this.numChildren-1)};t.prototype.onLeft=function(){this.onPrevClick()};t.prototype.onRight=function(){this.onNextClick()};t.prototype.onPrevClick=function(t){if(t===void 0){t=-1}if(this.isPlaying){return}this.updateRole(t)};t.prototype.onNextClick=function(t){if(t===void 0){t=1}if(this.isPlaying){return}this.updateRole(t)};t.prototype.onItemRender=function(t){t.setData(t.dataSource,false,false,true)};t.prototype.getRoleHuluItem=function(t){return t.getChildAt(0)};t.prototype.onDisplay=function(){guide.GuideModel.getIns().boOpen=false;this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){guide.GuideModel.getIns().boOpen=true};t.prototype.refreshAll=function(){var t=game.Context.roleList.length+1;if(t<=game.Context.TOTAL_ROLE_NUM){this.onChoose(t)}};t.prototype.updateView=function(t){this.imgwa.skin="res/static/jiesuohulu/bg_"+t+".png";this.imgjiesuo.skin="res/static/jiesuohulu/wa_"+t+".png";var e=csv.DefclassProxy.getIns().getCfg(t);this.listjineng.array=app.str2Array(e.skillshow,";");var i=0;var n=1;if(t>1){var a=csv.DefclassProxy.getIns().getCfgCreate(t);if(a&&a.type==1){var o=csv.DungeonProxy.getIns().getZxrwCfg(a.value);i=o.teamlevel;n=o.chapter}}if(t>game.Context.roleList.length){if(game.RoleModel.getIns().checkAddRoleCondiion(t)&&game.Context.isTeamLvReach(i)){this.ani1.gotoAndStop(0)}else{this.ani1.gotoAndStop(1);if(game.Context.isTeamLvReach(i)){this.labelyiwancheng.visible=true;this.labelshengji.visible=true}else{this.labelyiwancheng.visible=false;this.labelshengji.visible=false}this.labeldengji.text=app.getLang("preshow1",i);this.labelzhangjie.text=app.getLang("preshow2",n);this.labelqianwangshengji.visible=!this.labelyiwancheng.visible}}else{this.ani1.gotoAndStop(2)}};t.prototype.updateRole=function(t){this.offset=t;if(t>0){this.selectIndex++;if(this.selectIndex>=this.roleList.length){this.selectIndex=0}this.roleList.push(this.roleList.shift());this.offset-=1}else if(t<0){this.selectIndex--;if(this.selectIndex<0){this.selectIndex=this.roleList.length-1}this.roleList.unshift(this.roleList.pop());this.offset+=1}else{this.isPlaying=false;this.updateView(this.prof[this.selectIndex]);return}this.tweenStart()};t.prototype.tweenStart=function(){this.isPlaying=true;for(var t=0;t<this.roleList.length;++t){this.roleList[t].mouseEnabled=true;if(t==0||t==this.roleList.length-1){this.roleList[t].mouseEnabled=false}Laya.Tween.to(this.roleList[t],{x:this.posList[t].x,y:this.posList[t].y,scaleX:t==0?1.5:1,scaleY:t==0?1.5:1},400);if(t==0){this.getRoleHuluItem(this.roleList[t]).setImageRole()}else{this.getRoleHuluItem(this.roleList[t]).setImageMask()}this.roleList[t].parent.setChildIndex(this.roleList[t],this.childIndex[t])}Laya.timer.once(400,this,this.onComplete)};t.prototype.onComplete=function(){this.isPlaying=false;this.updateRole(this.offset)};t.SINGLE_KEY="main.RoleChooseView";return t}(ui.huluwajiesuo.hulujiesuotipsnewUI);i.RoleChooseView=e})(role||(role={}));var main;(function(t){var e=function(){function t(){this.imgMask=new Laya.Image;this.imgMask.x=Laya.stage.width/2;this.imgMask.y=Laya.stage.height/2;this.imgMask.pivot(35,55);this.imgMask.skin="guochangdonghua/hulu_zhezhao.png";this.hideHandler=new Laya.Handler(this,this.hideEnd)}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.show=function(){scene.SceneMediator.getInstance().clearBattleScene()};t.prototype.hideEnd=function(){Laya.Tween.clearAll(this.imgMask);app.AppContainer.sceneLayer.mask=null;if(!Laya.Dialog.manager.checkIfResultSmall()){app.AppContainer.uiLayer.visible=true}};t.SINGLE_KEY="main.RoundPassView";return t}();t.RoundPassView=e})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var game;(function(a){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.roleMediator=new common.RoleListMediator(this.itemxuanze.xuanzelist,equip.RoleItem,new Laya.Handler(this,this.roleSelectChange));this.roleMediator.setData(0);this.group1=[a.SettingType.specialOn,a.SettingType.musicValue,a.SettingType.audioValue];this.group2=[a.SettingType.friendly,a.SettingType.blooding,a.SettingType.skillEffect,a.SettingType.otherPlayer,a.SettingType.wuxingPass];this.huakuai1.value=50;this.huakua2.value=50;this.huakuai1.changeHandler=new Laya.Handler(this,this.onSliderChange,[this.huakuai1,a.SettingType.musicValue]);this.huakua2.changeHandler=new Laya.Handler(this,this.onSliderChange,[this.huakua2,a.SettingType.audioValue]);this.kaiguan1.clickHandler=new Laya.Handler(this,this.onChkChange,[this.kaiguan1,a.SettingType.soundSwitch]);this.kaiguan2.clickHandler=new Laya.Handler(this,this.onChkChange,[this.kaiguan2,a.SettingType.modelSwitch]);this.gouxuan1.clickHandler=new Laya.Handler(this,this.onChkChange,[this.gouxuan1,a.SettingType.specialOn]);this.gouxuan2.clickHandler=new Laya.Handler(this,this.onChkChange,[this.gouxuan2,a.SettingType.friendly]);this.gouxuan3.clickHandler=new Laya.Handler(this,this.onChkChange,[this.gouxuan3,a.SettingType.blooding]);this.gouxuan4.clickHandler=new Laya.Handler(this,this.onChkChange,[this.gouxuan4,a.SettingType.skillEffect]);this.gouxuan5.clickHandler=new Laya.Handler(this,this.onChkChange,[this.gouxuan5,a.SettingType.otherPlayer]);this.gouxuan6.clickHandler=new Laya.Handler(this,this.onChkChange,[this.gouxuan6,a.SettingType.realShadow]);this.gouxuan7.clickHandler=new Laya.Handler(this,this.onChkChange,[this.gouxuan7,a.SettingType.wuxingPass,new Laya.Handler(this,this.checkWuxingPass)]);this.gouxuan8.clickHandler=new Laya.Handler(this,this.onChkChange,[this.gouxuan8,a.SettingType.redPack])};e.prototype.checkWuxingPass=function(){if(a.Context.teamLv>=a.Config.getIntParams(1221)){return true}manager.FlowManager.instance.flowByStyle1(app.getLang("func_er_0",a.Config.getIntParams(1221)));return false};e.prototype.onChkChange=function(t,e,i){if(i&&!i.run()){t.selected=false;return}a.SystemSetModel.getInstance().setValueByType(t.selected?1:0,e)};e.prototype.onSliderChange=function(t,e){a.SystemSetModel.getInstance().setValueByType(t.value/t.max*100,e)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){a.SystemSetModel.getInstance().synSettingData();a.RoleModel.getIns().newUid=[]};e.prototype.refreshAll=function(){var t=a.SystemSetModel.getInstance().settingData.data;this.kaiguan1.selected=t[a.SettingType.soundSwitch]==1;this.kaiguan2.selected=t[a.SettingType.modelSwitch]==1;this.roleMediator.setData(t[a.SettingType.roleModel]);this.gouxuan1.selected=t[a.SettingType.specialOn]==1;this.huakuai1.value=t[a.SettingType.musicValue];this.huakua2.value=t[a.SettingType.audioValue];this.gouxuan2.selected=t[a.SettingType.friendly]==1;this.gouxuan3.selected=t[a.SettingType.blooding]==1;this.gouxuan4.selected=t[a.SettingType.skillEffect]==1;this.gouxuan5.selected=t[a.SettingType.otherPlayer]==1;this.gouxuan6.selected=t[a.SettingType.realShadow]==1;this.gouxuan7.selected=t[a.SettingType.wuxingPass]==1;this.gouxuan8.selected=t[a.SettingType.redPack]==1;this.labelmiaoshu6.text=a.AccountModel.serverName?a.AccountModel.serverName:app.getLang("set_error_1");this.labelmiaoshu7.text=a.Context.mainRole.playername;this.labelmiaoshu8.text=a.AccountModel.accountId;this.roleMediatorReddotUpdate()};e.prototype.roleSelectChange=function(){var t=a.SystemSetModel.getInstance().settingData.data;if(t[a.SettingType.roleModel]==this.roleMediator.selectedIndex){return}a.SystemSetModel.getInstance().setValueByType(this.roleMediator.selectedIndex,a.SettingType.roleModel)};e.prototype.roleMediatorReddotUpdate=function(){var t=[];for(var e=0;e<a.Context.TOTAL_ROLE_NUM;e++){if(a.Context.roleList[e]){var i=false;for(var n=0;n<a.RoleModel.getIns().newUid.length;n++){if(Uint64.equal(a.Context.roleList[e].insId,a.RoleModel.getIns().newUid[n])){i=true;break}}if(i){t.push(true)}else{t.push(false)}}else{t.push(false)}}this.roleMediator.setXinArr(t)};e.SINGLE_KEY="game.SettingView";return e}(ui.youxishezhi.youxishezhiviewUI);a.SettingView=t})(game||(game={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var upgrade;(function(t){var e=function(i){__extends(t,i);function t(){var t=i!==null&&i.apply(this,arguments)||this;t._selectIndex=-1;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){i.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.tabBtn.on(Laya.Event.CHANGE,this,this.onShow);var t=["grow_strong","grow_level"];for(var e in this.tabBtn.items){this.tabBtn.items[e].label=t[e]}};t.prototype.onShow=function(){if(this.tabBtn.selectedIndex==0){this.onShowBeStrong()}else if(this.tabBtn.selectedIndex==1){this.onShowLevelup()}};t.prototype.onShowBeStrong=function(){this.listwoyaobianqiang.visible=true;this.listwoyaoshengji.visible=false;this.listwoyaobianqiang.refreshAll([0]);this._selectIndex=0;this.labeljijiangkaiqi.text=app.getLang("grow_strong")};t.prototype.onShowLevelup=function(){this.listwoyaobianqiang.visible=false;this.listwoyaoshengji.visible=true;this.listwoyaoshengji.refreshAll([1]);this._selectIndex=1;this.labeljijiangkaiqi.text=app.getLang("grow_level")};t.prototype.onDisplay=function(){this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){};t.prototype.refreshAll=function(){this.tabBtn.selectedIndex=0;this.onShow()};t.SINGLE_KEY="main.UpgradeGuildeView";return t}(ui.woyaobianqiang.woyaobianqiangviewnewUI);t.UpgradeGuildeView=e})(upgrade||(upgrade={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var main;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.piaopinglabel.removeSelf();this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.scrollRect=new Laya.Rectangle(0,0,this.width,this.height);this._durationTime=game.Config.getIntParams(13);this._intervalTime=game.Config.getIntParams(14);this._broadcast=1;this.total=0;this.curCount=0};e.prototype.onDisplay=function(){};e.prototype.onUnDisplay=function(){this.tweenEnd()};e.prototype.refreshAll=function(){};e.prototype.getRichText=function(){var t=Laya.Pool.getItemByClass("chat.WorlCenterRichText",Laya.RichText);if(!t){t=new Laya.RichText}t.wordWrap=false;t.align="left";t.fontSize=this.piaopinglabel.fontSize;t.color=this.piaopinglabel.color;t.bold=this.piaopinglabel.bold;t.width=this.piaopinglabel.width;t.x=this.piaopinglabel.x;t.y=this.piaopinglabel.y;return t};e.prototype.tweenEnd=function(){Laya.timer.clearAll(this);this.total=0;this.curCount=0;this.curContentTxt="";this._broadcast=1;this.removeSelf()};e.prototype.tweenTo=function(){if(this.parent==null){app.AppContainer.notableLayer.addChild(this);this.x=.5*(Laya.stage.width-this.width);this.y=app.AppContainer.UI_LAYER_Y.WorldCenterPos+ScreenAdapter.OFFSET_Y}if(this.curCount==this._broadcast){this.curCount=0;this.curContentTxt=""}if(chat.ChatModel.getIns().centerArr.length>0){if(this.curContentTxt.length==0){var t=chat.ChatModel.getIns().centerArr.shift();this.curContentTxt=t.content;this._broadcast=t.broadcast}}if(this.curContentTxt&&this.curContentTxt.length>0){this.curCount++;var e=this.getRichText();e.text=this.curContentTxt;e.width+=4;e.x=this.width;this.addChild(e);app.MyTween.to(e,{x:-e.width},this._durationTime,Laya.Ease.linearNone,Laya.Handler.create(this,this.onTweenCompleted,[e]))}};e.prototype.onTweenCompleted=function(t){app.MyTween.clearTween(t);t.removeSelf();Laya.Pool.recover("chat.WorlCenterRichText",t);this.total--;if(this.total==0){this.tweenEnd()}};e.prototype.showView=function(t,e){var i=e>0?e:1;var n={content:t,broadcast:e};if(this.total==0){this.total+=i;this.curContentTxt="";Laya.timer.loop(this._intervalTime,this,this.tweenTo);chat.ChatModel.getIns().centerArr.push(n);this.tweenTo()}else{this.total+=i;chat.ChatModel.getIns().centerArr.push(n)}};e.SINGLE_KEY="main.WorldCenterView";return e}(ui.main.mianpiaopingUI);t.WorldCenterView=e})(main||(main={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var mall;(function(a){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){};e.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.MallBuyRecordAck,this,this.onMallBuyRecordAck);this.addMsgListener(app.ProtocolResponse.BuyMallWithNumberAck,this,this.onBuyMallWithNumberAck);this.addMsgListener(app.ProtocolResponse.BlackMallAck,this,this.onBlackListAddAckHandle);this.addMsgListener(app.ProtocolResponse.BuyBlackMallAck,this,this.onBuyBlackMallAckHandle);this.addMsgListener(app.ProtocolResponse.FreshBlackMallAck,this,this.onFreshBlackMallAckHandle);csv.FunctionsProxy.getIns().on(csv.FunctionsProxy.EVENTS.CHANGE,this,this.onFuncOpen)};e.prototype.onFuncOpen=function(t){if(csv.FunctionsProxy.getIns().isOpen(csv.FunctionsProxy.ENUMS.FRIENDS_SHOP)){this.model.addFriend()}};Object.defineProperty(e.prototype,"model",{get:function(){return shop.ShopModel.getIns()},enumerable:true,configurable:true});e.prototype.onFreshBlackMallAckHandle=function(t,e){if(e.result){a.MallModel.getIns().event(a.MallModel.REFRESH_BLACK_SHOP)}else{console.log("刷新失败!")}};e.prototype.onBuyBlackMallAckHandle=function(t,e){if(e.result){}else{}};e.prototype.onBlackListAddAckHandle=function(t,e){a.MallModel.getIns().blackmallList=e.data;for(var i=0;i<e.data.length;i++){var n=e.data[i];this.model.addTimeRed(n)}if(app.ViewManager.DisplayedInStage(tip.TipsShopBuyMediator.SINGLE_KEY)){app.ViewManager.toggleDialog(tip.TipsShopBuyMediator,-1)}a.MallModel.getIns().event(a.MallModel.UPDATE_BLACK_SHOP_DATA)};e.prototype.showMall=function(t,e){};e.prototype.onMallBuyRecordAck=function(t,e){a.MallModel.getIns().buyRecordList=e.recordList;a.MallModel.getIns().updateBuyRecord(e.recordList);shop.ShopModel.getIns().checkEveryDay()};e.prototype.onBuyMallWithNumberAck=function(t,e){if(e.result==1){a.MallModel.getIns().event(a.MallModel.UPDATE_MALL_BUY_RECORD_DATA);shop.ShopModel.getIns().checkEveryDay();app.SoundManager.getIns().playSound("cheer")}shop.ShopModel.getIns().event(shop.ShopEvent.BUY_WITH_ACK)};e.SINGLE_KEY="mall.MallModule";return e}(app.ModuleBase);a.MallModule=t})(mall||(mall={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){};e.prototype.getCfg=function(t){return this.cfgMap[t]};e.prototype.getPage=function(t){if(!this.pageMap[t]){this.pageMap[t]=new mall.MallPageVO;this.pageMap[t].name=app.getLang("mall_book"+t);this.pageMap[t].type=t}return this.pageMap[t]};e.SINGLE_KEY="csv.Mall";return e}(app.ModelBase);t.Mall=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var mall;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){};e.prototype.getBuyRecord=function(t){if(this.buyRecordList){for(var e=0;e<this.buyRecordList.length;e++){if(this.buyRecordList[e].mallID==t){return this.buyRecordList[e]}}}};e.prototype.updateBuyRecord=function(t){this.event(e.UPDATE_MALL_BUY_RECORD_DATA)};e.prototype.conditionCheck=function(t){return""};e.prototype.getCnt=function(t){return t.dailynum};e.SINGLE_KEY="mall.MallModel";e.UPDATE_MALL_BUY_RECORD_DATA="UPDATE_MALL_BUY_RECORD_DATA";e.UPDATE_BLACK_SHOP_DATA="UPDATE_BLACK_SHOP_DATA";e.REFRESH_BLACK_SHOP="REFRESH_BLACK_SHOP";return e}(app.ModelBase);t.MallModel=e})(mall||(mall={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("mallpage.csv");this.cfgMap=t.getMap("type","subtype")};e.prototype.getCfg=function(t,e){return this.cfgMap[t][e]};e.SINGLE_KEY="csv.MallPage";return e}(app.ModelBase);t.MallPage=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("shop.csv");this.cfgMap=t.getMap("type");this.cfgMapById=t.getMap("id");this.types={};var e=t.getArray();this.allList=e;for(var i=0;i<e.length;i++){var n=parseInt(e[i]["type"]);if(this.types[n]==undefined){this.types[n]=[]}this.types[n].push(e[i])}t=app.Config.getResById("kuafu_shop.csv");this.kuafu_shop=t.getMap("id");this.kuafu_class=t.getMapList("class");this.kuafu_shop_arr=t.getArray()};e.prototype.getCfg=function(t){return this.cfgMap[t]};e.prototype.getCfgById=function(t){return this.cfgMapById[t]};e.prototype.getArrayByType=function(t){return this.types[t]};e.prototype.getPriceByItemID=function(t,e){var i=this.getArrayByType(t);for(var n in i){if(parseInt(i[n].item)==e){return i[n].trueprice}}return""};e.prototype.getCfgByItemID=function(t,e){var i=this.getArrayByType(t);for(var n in i){if(parseInt(i[n].item)==e){return i[n]}}return null};e.prototype.getCfgByID=function(t,e){var i=this.getArrayByType(t);for(var n in i){if(parseInt(i[n].id)==e){return i[n]}}return null};e.prototype.getItemCfgById=function(t){for(var e in this.allList){if(parseInt(this.allList[e].id)==t){return this.allList[e]}}return null};e.prototype.getShowitemById=function(t){var e="";for(var i in this.allList){if(parseInt(this.allList[i].id)==t){e=this.allList[i].showitem;break}}return e};e.SINGLE_KEY="csv.MallProxy";e.ENUM_TYPE={FUBEN_EXP:4,FUBEN_SHOUHU:5,KAI_FU_CHONG_RANK_DUI_HUANG:8,GUARD:5,ACT_HUNT_RICH_SHOP:13,FRIENDS_SHOP:14,CHOU_KA:15,BaseBlackShop:16,HighBlackShop:17,XIANSHI_CHOU_KA:18};return e}(app.ModelBase);t.MallProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var mall;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(i)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.SINGLE_KEY="GrowUp.mall";return e}(ui.bag.bagdaojuviewUI);i.GrowUpView=t})(mall||(mall={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var mall;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.SINGLE_KEY="mall.MallView";return e}(ui.bag.bagdaojuviewUI);t.MallView=e})(mall||(mall={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var mall;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){this.labelname.text="";this.shijianlab.text="";this.labelmoneynum.text="";this.zhezhaobox.visible=false;this.shijianlab.text=""};e.SINGLE_KEY="mall.HonorCell";return e}(ui.shangcheng.shangchengitem3UI);t.HonorCell=e})(mall||(mall={}));var mall;(function(n){var t=function(){function t(){this.pages=[]}t.prototype.getListByPage=function(t){return this.pages[t].getItems().filter(this.filterItem)};t.prototype.addVO=function(t){if(!this.pages[t.subtype]){this.pages[t.subtype]=new n.MallSubTypeVO;this.pages[t.subtype].subtype=t.subtype;this.pages[t.subtype].name=app.getLang("mall_book"+t.type+"_"+t.subtype)}this.pages[t.subtype].addItem(t)};t.prototype.getShowPages=function(){return this.pages};t.prototype.filterItem=function(t){if(t.xgtype==1){var e=game.Context.getOpenServerDay();if(e!=Number(t.xggroup)){return false}}if(t.xgtype==2){var i=game.Context.getComBinedServerDay();if(i!=t.xggroup){return false}}if(t.shopshow==1&&n.MallModel.getIns().conditionCheck(t)!=""){return false}if(t.xgnum>0&&t.surpCount==undefined){t.surpCount=t.xgnum}return true};return t}();n.MallPageVO=t})(mall||(mall={}));var mall;(function(t){var e=function(){function t(){this.items=[]}t.prototype.getItems=function(){if(!this._isSorted){this.sort()}return this.items};t.prototype.addItem=function(t){this._isSorted=false;this.items.push(t)};t.prototype.sort=function(){this._isSorted=true;this.items.sort(this.sortFunc)};t.prototype.sortFunc=function(t,e){if(t.shopid===e.shopid){return 0}return t.shopid>e.shopid?1:-1};return t}();t.MallSubTypeVO=e})(mall||(mall={}));var mall;(function(t){var e=function(){function n(){}n.decode=function(t){if(t){var e=new n;e.id=parseInt(t["id"]);e.subtype=parseInt(t["subtype"]);e.type=parseInt(t["type"]);e.shopid=parseInt(t["shopid"]);e.item=parseInt(t["item"].split("-")[0]);e.itemCount=parseInt(t["item"].split("-")[1]);e.resouce=t["resouce"];e.xgtype=parseInt(t["xgtype"]);e.xggroup=parseInt(t["xggroup"]);e.xgnum=parseInt(t["xgnum"]);e.discount=t["discount"];e.label=t["label"];e.meffect=t["meffect"];e.mailitem=t["mailitem"];e.systemchat=parseInt(t["systemchat"]);e.brave=parseInt(t["brave"]);e.familyLevel=parseInt(t["familyLevel"]);e.gatherlv=parseInt(t["gatherlv"]);e.surpCount=e.xgnum;e.starlimit=parseInt(t["starlimit"]);e.battlewin=parseInt(t["battlewin"]);e.shilian=parseInt(t["shilian"]);e.jitan=parseInt(t["jitan"]);e.clfuben=parseInt(t["clfuben"]);e.mbfuben=parseInt(t["mbfuben"]);e.wenda=parseInt(t["wenda"]);e.gerenboss=parseInt(t["gerenboss"]);e.qmboss=parseInt(t["qmboss"]);e.mallType=1;if(t["yangcheng"]){var i=app.str2Array(t["yangcheng"]).map(app.parseStr2Int);e.yangchengType=i[0];e.yangchengAdv=i[1]}e.xunbao=parseInt(t["xunbao"]);e.shopshow=parseInt(t["shopshow"]);e.godlmall=parseInt(t["godlmall"]);return e}return undefined};n.prototype.conditionCheck=function(){return t.MallModel.getIns().conditionCheck(this)};return n}();t.MallVO=e})(mall||(mall={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var medal;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){app.ViewManager.regist(i.MedalMainView,"jiangzhang.atlas");app.ViewManager.regist(i.MedalHistoryView,"jiangzhang.atlas");app.ViewManager.regist(i.MedalShopView,"jiangzhang.atlas");game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.JIANG_ZHANG,i.MedalMainView);csv.FunctionsProxy.getIns().on(csv.FunctionsProxy.EVENTS.CHANGE,this,this.onRedDotChange)};e.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.MedalInfoAck,this,this.onMedalInfoAck);this.addMsgListener(app.ProtocolResponse.MedalHistoryInfoAck,this,this.onMedalHistoryInfoAck);this.addMsgListener(app.ProtocolResponse.MedalGetRewardAck,this,this.onMedalGetRewardAck);this.addMsgListener(app.ProtocolResponse.MedalMallRecordNtf,this,this.onMedalMallRecordNtf);this.addMsgListener(app.ProtocolResponse.BuyMedalMallNumAck,this,this.onBuyMedalMallNumAck)};e.prototype.onBuyMedalMallNumAck=function(t,e){if(e.result){}};e.prototype.onMedalMallRecordNtf=function(t,e){i.MedalModel.getIns().onMedalMallRecord(e.recordList)};e.prototype.onMedalGetRewardAck=function(t,e){if(e.result==1){}};e.prototype.onMedalHistoryInfoAck=function(t,e){i.MedalModel.getIns().historyInfoUpdate(e.medalList,e.totalCount,e.startIndex,e.pageSize)};e.prototype.onMedalInfoAck=function(t,e){i.MedalModel.getIns().medalInfoUpdate(e.medalList);this.onRedDotChange()};e.prototype.onRedDotChange=function(){Laya.timer.callLater(this,this.onUpdateRedDot)};e.prototype.onUpdateRedDot=function(){i.MedalModel.getIns().getRedDot()};e.SINGLE_KEY="medal.MedalModule";return e}(app.ModuleBase);i.MedalModule=t})(medal||(medal={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var medal;(function(t){var e=function(e){__extends(a,e);function a(){var t=e!==null&&e.apply(this,arguments)||this;t.totalCount=0;t.startIndex=0;t.pageSize=0;return t}a.getIns=function(){return app.Singleton.getInstance(a)};a.prototype.init=function(){this.medalList=[];this.historyList=[];this.recordList=[];this.historyDict={};this.totalCount=0;this.startIndex=0;this.pageSize=10};a.prototype.getRedDot=function(){var t=false;for(var e=0,i=this.medalList;e<i.length;e++){var n=i[e];t=this.checkMedalStatus(n.medalId,0);if(t){break}}if(t){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.JIANG_ZHANG)}else{game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.JIANG_ZHANG)}};a.prototype.onMedalMallRecord=function(t){this.recordList=t;this.event(a.MEDAL_SHOP_UPDATE)};a.prototype.medalInfoUpdate=function(t){this.medalList=t;this.updateHistoryInfo(t);this.event(a.MEDAL_INFO_UPDATE)};a.prototype.updateHistoryInfo=function(t){t.sort(this.sortByGetTime);for(var e=0,i=t;e<i.length;e++){var n=i[e];if(n.GetTime>0&&n.status!=0){var a=this.historyDict[n.GetTime];if(!a){a=[]}if(a.indexOf(n.medalId)==-1){a.push(n.medalId)}this.historyDict[n.GetTime]=a}}};a.prototype.sortByGetTime=function(t,e){if(t.GetTime>e.GetTime){return 1}if(t.GetTime<e.GetTime){return-1}return 0};a.prototype.getBuyCount=function(t){var e=0;for(var i=0,n=this.recordList;i<n.length;i++){var a=n[i];if(a.mallID==t){e=mall.MallModel.getIns().getCnt(a);break}}return e};a.prototype.historyInfoUpdate=function(t,e,i,n){this.historyList=t;this.totalCount=e;this.startIndex=i;this.pageSize=n;this.event(a.MEDAL_HISTORYINFO_UPDATE)};a.prototype.getMedalInfoById=function(t){var e;for(var i in this.medalList){if(this.medalList[i].medalId==t){e=this.medalList[i];break}}return e};a.prototype.onBuyMallNumReq=function(t,e,i,n){var a=game.GridsModel.getIns().hasEnoughItems(i,false,true);if(a){if(this.getBuyCount(t)>=n){manager.FlowManager.instance.flowByStyle1(app.getLang("购买数量已达上限"));return}app.ProtocolRequest.BuyMedalMallNumReq(t,e)}};a.prototype.getRedDotByType=function(t){var e=csv.MedalProxy.getIns().getMedalArr();for(var i=0,n=e;i<n.length;i++){var a=n[i];if(a.type===t){if(this.checkMedalStatus(a.id,0)){return true}}}return false};a.prototype.checkMedalStatus=function(t,e){var i;if(t>0){i=this.getMedalInfoById(t);if(i&&i.status==1){var n=csv.MedalProxy.getIns().getMedalFrontId(t);if(n>0){return this.checkMedalStatus(0,n)}return true}}else if(e>0){i=this.getMedalInfoById(e);if(i&&i.status==2){var n=csv.MedalProxy.getIns().getMedalFrontId(e);if(n>0){return this.checkMedalStatus(0,n)}return true}}return false};a.SINGLE_KEY="medal.MedalModel";a.MEDAL_INFO_UPDATE="medal.MedalInfoUpdate";a.MEDAL_HISTORYINFO_UPDATE="medal.MedalHistoryInfoUpdate";a.MEDAL_SHOP_UPDATE="medal.MedalShopInfoUpdate";return a}(app.ModelBase);t.MedalModel=e})(medal||(medal={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("medal.csv");this.medalMap=t.getMap("id");this.medaloArr=t.getArray();var e=app.Config.getResById("medalname.csv");this.medalTypes=e.getArray();var i=app.Config.getResById("medalshop.csv");this.medalshopMap=i.getMap("id");this.medalshopArray=i.getArray()};e.prototype.getMedalArr=function(){return this.medaloArr};e.prototype.getmedalTypes=function(){return this.medalTypes};e.prototype.getComment=function(t){var e=this.medalMap[t].taskid;return csv.TaskProxy.getIns().getCfg(e).name};e.prototype.getMedalFrontId=function(t){return this.medalMap[t].frontmedal};e.prototype.getMedalShopCfg=function(t){return this.medalshopMap[t]};e.prototype.getMedalShops=function(){return this.medalshopArray};e.SINGLE_KEY="csv.MedalProxy";return e}(app.ModelBase);t.MedalProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var medal;(function(a){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.panel.vScrollBarSkin=" ";this.panel.vScrollBar.elasticBackTime=600;this.panel.vScrollBar.elasticDistance=200;this._list=[]};e.prototype.onDisplay=function(){this.refreshAll()};e.prototype.onUnDisplay=function(){this.clean()};e.prototype.refreshAll=function(){var t=a.MedalModel.getIns().historyDict;if(Object.keys(t).length>0){this.createHistory(t);this.imgtishi.visible=false}else{this.imgtishi.visible=true}};e.prototype.createHistory=function(t){var e=20;for(var i in t){var n=Laya.Pool.getItemByClass("medal.MedalHistoryItem",a.MedalHistoryItem);if(!n){n=new a.MedalHistoryItem}n.setData(i,t[i]);n.y=e;e+=n.getHeiht()+50;n.setHeight(n.getHeiht()+50);this.panel.addChild(n);this._list.push(n);this.panel.vScrollBar.max=this.panel.contentHeight}this.panel.scrollTo(this.panel.x,this.panel.contentHeight)};e.prototype.clean=function(){var t;while(this._list.length>0){t=this._list.pop();t.removeSelf();Laya.Pool.recover("medal.MedalHistoryItem",t)}};e.SINGLE_KEY="medal.MedalHistoryView";return e}(ui.jiangzhang.shiguangzhouviewnewUI);a.MedalHistoryView=t})(medal||(medal={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var medal;(function(l){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t._getNum=0;t._totalNum=0;t._auto=false;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listjiangzhang.itemRender=l.MedalItem;this.listjiangzhang.renderHandler=new Laya.Handler(this,this.onMedalItemRender);this.listjiangzhang.vScrollBarSkin=" ";this.listjiangzhang.array=[];this.listwup.itemRender=l.MedalTabItem;this.listwup.renderHandler=new Laya.Handler(this,this.onMedalTabItemRender);this.listwup.selectHandler=new Laya.Handler(this,this.onTabSelect);this.listwup.selectEnable=true;var t=csv.MedalProxy.getIns().getmedalTypes();this.listwup.array=t;this.viewhuobi.parserIconByItemId(game.ItemUtil.ENUMS.MEDAL);this.listwup.selectedIndex=0;this.btnshiguangzhou.clickHandler=new Laya.Handler(this,this.onOpenView,[csv.FunctionsProxy.ENUMS.JIANG_ZHANG_ZHOU]);this.btnjiangzhangshangdian.clickHandler=new Laya.Handler(this,this.onOpenView,[csv.FunctionsProxy.ENUMS.JIANG_ZHANG_SHOP])};t.prototype.onOpenView=function(t){if(csv.FunctionsProxy.ENUMS.JIANG_ZHANG_ZHOU==t){app.ViewManager.toggleDialog(l.MedalHistoryView,1,0)}else if(csv.FunctionsProxy.ENUMS.JIANG_ZHANG_SHOP==t){app.ViewManager.toggleDialog(l.MedalShopView,1,0)}};t.prototype.onTabSelect=function(){this.updateView()};t.prototype.onMedalTabItemRender=function(t,e){t.setData(t.dataSource,e==this.listwup.selectedIndex)};t.prototype.onMedalItemRender=function(t){t.setData(t.dataSource)};t.prototype.onDisplay=function(){l.MedalModel.getIns().on(l.MedalModel.MEDAL_INFO_UPDATE,this,this.onMedalInfoUpdate);l.MedalModel.getIns().on(l.MedalModel.MEDAL_SHOP_UPDATE,this,this.onMoneyUpdate);app.ProtocolRequest.MedalInfoReq();this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){l.MedalModel.getIns().off(l.MedalModel.MEDAL_INFO_UPDATE,this,this.onMedalInfoUpdate);l.MedalModel.getIns().off(l.MedalModel.MEDAL_SHOP_UPDATE,this,this.onMoneyUpdate)};t.prototype.onMoneyUpdate=function(){this.labelshuzi01.text=""+game.GridsModel.getIns().getItemCount(game.ItemUtil.ENUMS.MEDAL)};t.prototype.onMedalInfoUpdate=function(){this.updateView();this.listwup.refresh()};t.prototype.refreshAll=function(){this._auto=true};t.prototype.updateView=function(){var t=this.getMedalArray();t.sort(this.sortBase);this.listjiangzhang.array=t;this.labelshuzi01.text=""+game.GridsModel.getIns().getItemCount(game.ItemUtil.ENUMS.MEDAL);this.labelshuzi02.text=this._getNum+"/"+this._totalNum;var e=0;for(var i=0;i<t.length;i++){if(t[i].data){if(t[i].data.status==1){e=i;break}}}this.listjiangzhang.scrollTo(e)};t.prototype.sortBase=function(t,e){if(t.data&&e.data){if(t.data.status==1&&e.data.status==2){return-1}if(t.data.status==2&&e.data.status==1){return 1}if(t.data.GetTime<e.data.GetTime){return-1}if(t.data.GetTime>e.data.GetTime){return 1}}else if(t.data&&!e.data){if(t.data.status==2){return 1}return-1}else if(!t.data&&e.data){if(e.data.status==2){return-1}return 1}else if(t.cfg.id<e.cfg.id){return-1}else if(t.cfg.id>e.cfg.id){return 1}return 0};t.prototype.getMedalArray=function(){this._getNum=0;this._totalNum=0;var t=csv.MedalProxy.getIns().getMedalArr();var e=parseInt(this.listwup.selectedItem.id);var i=[];var n;for(var a in t){if(e==0||parseInt(t[a].type)==e){n=l.MedalModel.getIns().getMedalInfoById(parseInt(t[a].id));if(e==0&&t[a].type==1){if(n&&n.status==0&&n.name.length>0){continue}}var o=parseInt(t[a].frontmedal);if(o>0){var s=l.MedalModel.getIns().getMedalInfoById(o);if(!s||s.status!=2){continue}}var r={cfg:null,data:null};r.cfg=t[a];r.data=n;if(n){this._getNum++}this._totalNum++;i.push(r)}}return i};t.SINGLE_KEY="medal.MedalMainView";return t}(ui.jiangzhang.jiangzhangviewnewUI);l.MedalMainView=t})(medal||(medal={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var medal;(function(i){var t=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listshengwang.itemRender=i.MedalShopItem;this.listshengwang.renderHandler=new Laya.Handler(this,this.onMedalShopItemRender);this.listshengwang.vScrollBarSkin=" ";this.imgtishi01.visible=false;this.imgtishi02.visible=false;this.imgshengwang.parserIconByItemId(game.ItemUtil.ENUMS.MEDAL);var t=csv.MedalProxy.getIns().getMedalShops();this.listshengwang.array=t};t.prototype.onMedalShopItemRender=function(t){t.setData(t.dataSource)};t.prototype.onDisplay=function(){i.MedalModel.getIns().on(i.MedalModel.MEDAL_SHOP_UPDATE,this,this.updateView);app.ProtocolRequest.MedalMallInfoReq();this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){i.MedalModel.getIns().off(i.MedalModel.MEDAL_SHOP_UPDATE,this,this.updateView)};t.prototype.refreshAll=function(){this.labelshuzi01.text=""+game.GridsModel.getIns().getItemCount(game.ItemUtil.ENUMS.MEDAL)};t.prototype.updateView=function(){this.labelshuzi01.text=""+game.GridsModel.getIns().getItemCount(game.ItemUtil.ENUMS.MEDAL);this.listshengwang.refresh()};t.SINGLE_KEY="medal.MedalShopView";return t}(ui.jiangzhang.shengwangviewnewUI);i.MedalShopView=t})(medal||(medal={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var medal;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listmiaoshu.renderHandler=new Laya.Handler(this,this.onItemRender);this.listmiaoshu.spaceY=10};e.prototype.onItemRender=function(t){t.text=csv.MedalProxy.getIns().getComment(parseInt(t.dataSource))};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t,e){this.labelshuoming01.text=util.TimeUtil.formatDate(parseInt(t),true,true,true,true,"-");this.listmiaoshu.array=e;this.listmiaoshu.repeatY=e.length};e.prototype.getHeiht=function(){return this.listmiaoshu.y+this.listmiaoshu.height};e.prototype.setHeight=function(t){this.imgzhuangshi02.height=t};e.SINGLE_KEY="medal.MedalHistoryItem";return e}(ui.jiangzhang.shiguangzhouitemUI);t.MedalHistoryItem=e})(medal||(medal={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var medal;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.btnlingqu.clickHandler=new Laya.Handler(this,this.onBtnClickHandler)};e.prototype.onBtnClickHandler=function(){if(this._medalId>0){app.ProtocolRequest.MedalGetRewardReq(this._medalId)}};e.prototype.onDisplay=function(){i.MedalModel.getIns().on(i.MedalModel.MEDAL_INFO_UPDATE,this,this.onMedalInfoUpdate);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){i.MedalModel.getIns().off(i.MedalModel.MEDAL_INFO_UPDATE,this,this.onMedalInfoUpdate)};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){this._medalId=parseInt(t.cfg.id);var e=parseInt(t.cfg.taskid);var i=csv.TaskProxy.getIns().getCfg(e);var n=game.TaskModel.getIns().getTaskData(e);var a=t.cfg.reward;this.labelmiaoshu03.visible=false;this.medalDataUpdate(t.data);this.imgtubiao.skin="res/icon/medal/"+t.cfg.res+".png";this.textmiaoshu.text=i?i.name:e+"";this.viewhuobi.parserIcon(t.cfg.reward);this.labelmoneynum.text=app.str2Array(t.cfg.reward,"-")[1]};e.prototype.onMedalInfoUpdate=function(){var t=i.MedalModel.getIns().getMedalInfoById(this._medalId);this.medalDataUpdate(t)};e.prototype.setGray=function(t){this.imgzhuangshi3.gray=t;this.imgtubiao.gray=t};e.prototype.medalDataUpdate=function(t){this.setGray(false);this.btnlingqu.disabled=false;if(!t){this.btnlingqu.visible=true;this.btnlingqu.disabled=true;this.setGray(true)}else if(t.status==0){if(t.name.length>0){this.labelmiaoshu03.text=app.getLang("{0}获得",t.name);this.labelmiaoshu03.visible=true;this.btnlingqu.visible=false}else{this.btnlingqu.visible=true;this.btnlingqu.disabled=true}this.setGray(true)}else if(t.status==1){this.btnlingqu.visible=true}else if(t.status==2){this.labelmiaoshu03.text=app.getLang("{0} 获得",util.TimeUtil.formatDate(t.GetTime,true,false,false,true,"-"));this.labelmiaoshu03.visible=true;this.btnlingqu.visible=false}};e.SINGLE_KEY="medal.MedalItem";return e}(ui.jiangzhang.jiangzhuangitem02UI);i.MedalItem=t})(medal||(medal={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var medal;(function(o){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.imgyiduihuan.visible=false};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){this.data=t;var e=csv.MedalProxy.getIns().getMedalShopCfg(t.id);this.labelname.text=csv.ItemProxy.getName(t.item);this.itemdaoju.setData(t.item);this.itemdaoju.clickHandler=new Laya.Handler(this,this.onClickHandler,[t]);this.imgyuanbao.parserIcon(t.trueprice);this.labelmoneynum.text=app.str2Array(t.trueprice,"-")[1];var i=parseInt(e.timesforever);var n=o.MedalModel.getIns().getBuyCount(parseInt(t.id));var a=i-n;this.itemdaoju.shuzi.text="";this.itemdaoju.gray=!(a>0);this.imgyiduihuan.visible=!(a>0);this.setCostMoney(t.trueprice);this.labelxiangou.text=app.getLang("限购{0}次",a)};e.prototype.setCostMoney=function(t){var e=app.str2Array(t,"-");var i=game.GridsModel.getIns().getItemCount(e[0]);if(i>=e[1]){this.labelmoneynum.color=game.STYLES.GREEN_COLOR_S}else{this.labelmoneynum.color=game.STYLES.RED_COLOR_S}this.labelmoneynum.text=e[1]+"";return parseInt(e[0])};e.prototype.onClickHandler=function(t){tip.TipManager.showNumChooseItemTip(this.itemdaoju.data,t,true,[tip.TipManager.TIP_BTN_TYPE.BUY_MEDAL_SHOP])};e.SINGLE_KEY="medal.MedalShopItem";return e}(ui.jiangzhang.jiangzhuangitem03UI);o.MedalShopItem=t})(medal||(medal={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var medal;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.qiehuanbtn.selected=false};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t,e){this.data=t;this.qiehuanbtn.label=app.getLang(t.name);if(this.data.id==0){this.qiehuanbtn.skin="public/btn_yeqian_jiangzhang_01.png"}this.qiehuanbtn.selected=e;game.RedDotView.removeFrom(this);if(i.MedalModel.getIns().getRedDotByType(t.id)){game.RedDotView.addTo(this)}};e.SINGLE_KEY="medal.MedalTabItem";return e}(ui.jiangzhang.jiangzhangitem05UI);i.MedalTabItem=t})(medal||(medal={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var meirichongzhi;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){app.ViewManager.regist(i.MeiRiChongZhiView,"meirichongzhi.atlas");game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.MEI_RI_CHONG_ZHI,i.MeiRiChongZhiView,null,3)};e.prototype.initCommands=function(){};return e}(app.ModuleBase);i.MeiRiChongZhiModule=t})(meirichongzhi||(meirichongzhi={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var meirichongzhi;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){};e.SINGLE_KEY="meirichongzhi.MeiRiChongZhiModel";return e}(app.ModelBase);t.MeiRiChongZhiModel=e})(meirichongzhi||(meirichongzhi={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var meirichongzhi;(function(t){var a=function(){function t(t){this.btn=t}t.prototype.setRed=function(t){if(t){game.RedDotView.addTo(this.btn)}else{game.RedDotView.removeFrom(this.btn)}};return t}();var e=function(n){__extends(t,n);function t(){var t=n!==null&&n.apply(this,arguments)||this;t.curIndex=0;t.effectArr=[];return t}t.prototype.initialize=function(){n.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.btnlist=[];for(var t=0;t<3;t++){var e=new a(this["yeqian"+(t+1).toString()]);this.btnlist.push(e);var i=e.btn;i.clickHandler=new Laya.Handler(this,this.onClickHandler,[e])}this.gezilist.itemRender=grids.GridView;this.gezilist.renderHandler=new Laya.Handler(this,this.onCellHandler);this.lingjiangbtn.clickHandler=new Laya.Handler(this,this.onClickLingQuHandler);this.chongzhibtn.clickHandler=new Laya.Handler(this,this.onClickQianWangHandler);this.activityTimeView=new activitytaren.ActivityTimeView(this.shijianlab,new Laya.Handler(this,this.endTimeCallBack),"{0}");this.showBtnEffect(false)};t.prototype.onCellHandler=function(t,e){t.setData(t.dataSource,"",1,undefined,this.effectArr[e])};t.prototype.hideSubTime=function(){this.activityTimeView.stop();this.shijianlab.text="";this.shengyulab.visible=false};t.prototype.endTimeCallBack=function(){this.hideSubTime()};t.prototype.onClickQianWangHandler=function(){shop.ShopModel.getIns().openChongZhiShop()};t.prototype.onClickLingQuHandler=function(){if(this.cfg){activitytaren.ActivityTaRenModel.getIns().once(activitytaren.ActivityTaRenModel.ACTIVIT_TAREN_EVENT.UPDATE_ACTIVIT_DATA,this,this.updateActivitData);app.ProtocolRequest.RecvActPrizeReq(this.cfg.id,1)}};t.prototype.updateActivitData=function(){activitytaren.ActivityTaRenModel.getIns().getInfoByActID(this.actVo.actid,new Laya.Handler(this,this.onUpdateHander))};t.prototype.onGetMainPanel=function(t){if(this.actVo&&t.actID==this.actVo.actid){this.onUpdateHander()}};t.prototype.onClickHandler=function(t){this.selectByIndex(this.btnlist.indexOf(t))};t.prototype.showBtnEffect=function(t){var e=this.anniuani;if(t){e.visible=true;e.play()}else{e.stop();e.visible=false}};t.prototype.getCanLingQu=function(){var t=this.btnlist.length;for(var e=0;e<t;e++){var i=this.actVo.getCfgByIndex(e);if(i){var n=this.actVo.getSubInfo(i.id);if(n&&n.status==activitytaren.ActivityTaRenLingQuStatus.YOU_CAN_LING_QU){return e}}}return 0};t.prototype.selectByIndex=function(t){this.curIndex=t;for(var e=0;e<this.btnlist.length;e++){var i=this.btnlist[e].btn;i.selected=e==t}var n=this.gezilist;var a=this.actVo.getCfgByIndex(t);this.cfg=a;var o=false;if(a){n.array=game.ItemUtil.parserList(a.award);this.effectArr=a.receive_effect.split(";");var s=this.actVo.getSubInfo(a.id);var r=0;var l=this,h=l.yilingqu,p=l.lingjiangbtn;if(s){r=app.convert_Yuan(s.option);switch(s.status){case activitytaren.ActivityTaRenLingQuStatus.CAN_T_LINGQU:h.visible=false;p.visible=true;p.gray=true;p.mouseEnabled=false;break;case activitytaren.ActivityTaRenLingQuStatus.YOU_CAN_LING_QU:h.visible=false;p.visible=true;p.gray=false;p.mouseEnabled=true;o=true;break;case activitytaren.ActivityTaRenLingQuStatus.IS_ALREADY_LING_QU:h.visible=true;p.visible=false;break}}this.chongzhilab2.text=app.getLang("chongzhi_text_01",r)}this.showBtnEffect(o)};t.prototype.setBtnReds=function(){for(var t=0;t<this.btnlist.length;t++){var e=this.btnlist[t];var i=this.actVo.getCfgByIndex(t);var n=this.actVo.getSubInfo(i.id);var a=false;if(n&&n.status==activitytaren.ActivityTaRenLingQuStatus.YOU_CAN_LING_QU){a=true}e.setRed(a)}};t.prototype.onUpdateHander=function(){this.setBtnReds();this.selectByIndex(this.curIndex)};t.prototype.onInitHandler=function(){if(this.functionid){this.onEndHandler()}};t.prototype.onEndHandler=function(){var t=this.actVo.timeVo;this.activityTimeView.start(t.endTime);this.shengyulab.visible=true;this.curIndex=this.getCanLingQu();this.onUpdateHander()};t.prototype.onDisplay=function(){activitytaren.ActivityTaRenModel.getIns().on(activitytaren.ActivityTaRenModel.ACTIVIT_TAREN_EVENT.GET_MAIN_PANEL_INFO,this,this.onGetMainPanel);this.callLater(this.onInitHandler)};t.prototype.onUnDisplay=function(){activitytaren.ActivityTaRenModel.getIns().off(activitytaren.ActivityTaRenModel.ACTIVIT_TAREN_EVENT.GET_MAIN_PANEL_INFO,this,this.onGetMainPanel)};return t}(ui.meirileichong.meirileichongUI);t.MeiRiChongZhiView=e})(meirichongzhi||(meirichongzhi={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var meiritehui;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){app.ViewManager.regist(i.MeiRiTeHuiView,"meiritehui.atlas","shangcheng.atlas");game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.MEI_RI_TE_HUI,i.MeiRiTeHuiView)};e.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.DailyRechargeDataNtf,this,this.onDailyRechargeDataNtfHandler);this.addMsgListener(app.ProtocolResponse.DailyRechargeAwardAck,this,this.onDailyRechargeAwardAckHandler)};e.prototype.onDailyRechargeDataNtfHandler=function(t,e){i.MeiRITeHuiModel.getIns().data=e;i.MeiRITeHuiModel.getIns().event(i.MeiRITeHuiModel.EVENT_UPDATE_INFO);huodong.HuoDongShangChengModel.getIns().event(huodong.HuoDongEvent.EVENT_RED_CHECK);newshangcheng.NewShangChengModel.getIns().checkRed()};e.prototype.onDailyRechargeAwardAckHandler=function(t,e){};return e}(app.ModuleBase);i.MeiRiTeHuiModule=t})(meiritehui||(meiritehui={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var meiritehui;(function(t){var o;(function(t){t[t["Free"]=1]="Free";t[t["CanChongZhi"]=2]="CanChongZhi";t[t["CanLingQu"]=3]="CanLingQu";t[t["IsLingQued"]=4]="IsLingQued"})(o=t.EMeiriLinQu||(t.EMeiriLinQu={}));var n;(function(t){t[t["IsChongZhi_NotLingQu"]=0]="IsChongZhi_NotLingQu";t[t["IsChongZhi_IsLingQu"]=1]="IsChongZhi_IsLingQu"})(n=t.EMeiChongZhi||(t.EMeiChongZhi={}));var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};Object.defineProperty(e.prototype,"endTime",{get:function(){if(this.data&&this.data.end_timestamp!=0){return this.data.end_timestamp}return game.Context.getServerZeroTime()+util.TimeUtil.secOneDay},enumerable:true,configurable:true});e.prototype.is136Chongzhi=function(){if(this.data){if(this.data.recharged_list){for(var t=0;t<this.data.recharged_list.length;t++){var e=this.data.recharged_list[t];if(csv.RechargeProxy.getIns().cfgMap[e.recharge_id]){if(e.recharge_id!=this.freeId){if(e.recharge_id==this.sevendayId){}else{if(e.state==n.IsChongZhi_IsLingQu||e.state==n.IsChongZhi_NotLingQu){return true}}}}}}}return false};e.prototype.init=function(){this.tehuiCfgList=[];var t=csv.RechargeProxy.getIns().cfgList;for(var e=0;e<t.length;e++){var i=t[e];if(i.type==csv.IRechargeType.Meiritehui){if(i.recharge==0){this.freeId=i.id}this.tehuiCfgList.push(i)}}};e.prototype.getList=function(){var t=[];for(var e=0;e<this.tehuiCfgList.length;e++){var i=this.tehuiCfgList[e];if(i.id!=this.sevendayId){t.push(i)}}var n=[];for(var e=0;e<t.length;e++){var i=this.tehuiCfgList[e];var a=this.getLingQuStatus(i.id);if(a!=o.IsLingQued){n.push(i)}}for(var e=0;e<t.length;e++){var i=this.tehuiCfgList[e];var a=this.getLingQuStatus(i.id);if(a==o.IsLingQued){n.push(i)}}return n};e.prototype.getLingQuStatus=function(t){if(this.data){if(this.data.recharged_list){for(var e=0;e<this.data.recharged_list.length;e++){var i=this.data.recharged_list[e];if(i.recharge_id==t){if(i.state==0){return o.CanLingQu}else if(i.state==1){return o.IsLingQued}}}}}if(csv.RechargeProxy.getIns().cfgMap[t].recharge==0){return o.Free}return o.CanChongZhi};Object.defineProperty(e.prototype,"sevendayId",{get:function(){return game.Config.getIntParams(967)},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"fiftyIsBuyed",{get:function(){var t=this.getLingQuStatus(this.sevendayId);if(t==o.CanLingQu||t==o.IsLingQued){return true}return false},enumerable:true,configurable:true});e.prototype.refreshReds=function(){var t=false;if(!this.data){}else{if(this.data.recharged_list){for(var e=0;e<this.data.recharged_list.length;e++){var i=this.data.recharged_list[e];if(i.state==n.IsChongZhi_NotLingQu){t=true}}}}return t};e.SINGLE_KEY="meiritehui.MeiRITeHuiModel";e.EVENT_UPDATE_INFO="EVENT_UPDATE_INFO";return e}(app.ModelBase);t.MeiRITeHuiModel=e})(meiritehui||(meiritehui={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var meiritehui;(function(n){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.gezilist.itemRender=grids.GridView;this.gezilist.renderHandler=new Laya.Handler(this,this.onItemRender);this.btnchongzhi.clickHandler=new Laya.Handler(this,this.onChongZhiHandler);this.btnlingqu.clickHandler=new Laya.Handler(this,this.onChongZhiHandler);this.btnchongzhi.label=app.getLang("meirithui12");this.playAnim(false)};e.prototype.onItemRender=function(t){t.setData(t.dataSource);t.setCntScale(this.gezilist.scaleX)};Object.defineProperty(e.prototype,"isNotFree",{get:function(){return this.cfg.id!=n.MeiRITeHuiModel.getIns().freeId},enumerable:true,configurable:true});e.prototype.playAnim=function(t){};e.prototype.onChongZhiHandler=function(){if(n.MeiRITeHuiModel.getIns().fiftyIsBuyed&&this.isNotFree){return}var t=n.MeiRITeHuiModel.getIns().getLingQuStatus(this.cfg.id);switch(t){case n.EMeiriLinQu.Free:break;case n.EMeiriLinQu.CanLingQu:app.ProtocolRequest.DailyRechargeAwardReq(this.cfg.id);break;case n.EMeiriLinQu.CanChongZhi:app.ViewManager.toggleDialog(n.MeiRiHuodonglibaoTip,1,0,[this.cfg,csv.FunctionsProxy.ENUMS.MEI_RI_TE_HUI]);break;case n.EMeiriLinQu.IsLingQued:break}};e.prototype.onDisplay=function(){n.MeiRITeHuiModel.getIns().on(n.MeiRITeHuiModel.EVENT_UPDATE_INFO,this,this.onRefresh)};e.prototype.onRefresh=function(){this.setData(this.cfg)};e.prototype.onUnDisplay=function(){n.MeiRITeHuiModel.getIns().off(n.MeiRITeHuiModel.EVENT_UPDATE_INFO,this,this.onRefresh);this.playAnim(false)};e.prototype.setData=function(t){if(!t){return}this.cfg=t;this.clear();var e=t.id.toString().substr(t.id.toString().length-1,1);this.imglibao.skin="meiritehui/bg_meiritehui_th0"+e+".png";this.gezilist.array=game.ItemUtil.parserList(t.reward);var i=n.MeiRITeHuiModel.getIns().getLingQuStatus(t.id);if(n.MeiRITeHuiModel.getIns().fiftyIsBuyed&&this.isNotFree){this.btnlingqu.visible=true;this.btnlingqu.label=app.getLang("meirithui10");this.btnlingqu.gray=true}else{switch(i){case n.EMeiriLinQu.Free:this.btnlingqu.visible=true;this.labtimes.visible=true;this.labtimes.text=app.getLang("meirithui04");break;case n.EMeiriLinQu.CanLingQu:this.btnlingqu.visible=true;this.labtimes.visible=true;game.RedDotView.addTo(this.btnlingqu);if(t.id==n.MeiRITeHuiModel.getIns().freeId){this.btnlingqu.label=app.getLang("meirithui11")}else{this.btnlingqu.label=app.getLang("meirithui08")}this.labtimes.text=app.getLang("meirithui04");this.playAnim(true);break;case n.EMeiriLinQu.IsLingQued:this.imgyilingqu.visible=true;break;case n.EMeiriLinQu.CanChongZhi:this.btnchongzhi.visible=true;this.labtimes.visible=true;this.labtimes.text=app.getLang("meirithui04");break}}};e.prototype.clear=function(){game.RedDotView.removeFrom(this.btnlingqu);this.btnlingqu.visible=false;this.imgyilingqu.visible=false;this.btnchongzhi.visible=false;this.btnlingqu.gray=false;this.btnlingqu.label=app.getLang("meirithui08");this.labtimes.visible=false};return e}(ui.xinshangcheng2.meiritehuiitemUI);n.MeiRiTeHuiItem1=t})(meiritehui||(meiritehui={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var meiritehui;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.listdaoju.itemRender=grids.GridView;this.listdaoju.renderHandler=grids.GridView.CommonItemRender;this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.quedingbtn.clickHandler=new Laya.Handler(this,this.onClickHandler)};e.prototype.onClickHandler=function(){shop.ShopModel.getIns().chongzhi(this.rechargeCfg.id);app.ViewManager.toggleDialog(i.MeiRiHuodonglibaoTip,-1)};e.prototype.onDisplay=function(){this.callLater(this.onCallter)};e.prototype.onCallter=function(){var t=this.dataSource[0];this.titleimg.text=app.getLang(csv.FunctionsProxy.getIns().getCfg(this.dataSource[1]).windowname);var e=t;this.rechargeCfg=e;newshangcheng.NewShangChengModel.getIns().setListVaule(this.listdaoju,e.reward);this.label01.text=app.getLang("xinshangcheng_01",1,e.limit<=0?1:e.limit);this.quedingbtn.label=app.getLang("xinshangcheng_02",app.convert_Yuan(e.recharge))};e.SINGLE_KEY="meiritehui.MeiRiHuodonglibaoTip";return e}(ui.xinshangcheng2.huodonglibaotipUI);i.MeiRiHuodonglibaoTip=t;var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};Object.defineProperty(e.prototype,"recharheId",{get:function(){return i.MeiRITeHuiModel.getIns().sevendayId},enumerable:true,configurable:true});e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listbaoxiang.itemRender=i.MeiRiTeHuiItem1;this.listbaoxiang.renderHandler=new Laya.Handler(this,this.onRenderHandler);this.time=new activitytaren.ActivityTimeView(this.goumaishijian,new Laya.Handler(this,this.hideSubTime),"{0}");this.btntehui.clickHandler=new Laya.Handler(this,this.onLingQuHandler);this.playAnim(false)};e.prototype.onLingQuHandler=function(){if(i.MeiRITeHuiModel.getIns().is136Chongzhi()){manager.FlowManager.instance.flowByStyle1(app.getLang("xinshangcheng_09"))}else{var t=i.MeiRITeHuiModel.getIns().getLingQuStatus(this.recharheId);switch(t){case i.EMeiriLinQu.CanChongZhi:app.ViewManager.toggleDialog(i.MeiRiHuodonglibaoTip,1,0,[csv.RechargeProxy.getIns().cfgMap[this.recharheId],csv.FunctionsProxy.ENUMS.MEI_RI_TE_HUI]);break;case i.EMeiriLinQu.CanLingQu:app.ProtocolRequest.DailyRechargeAwardReq(this.recharheId);break;case i.EMeiriLinQu.IsLingQued:break}}};e.prototype.hideSubTime=function(){this.time.stop();this.goumaishijian.visible=false};e.prototype.onRenderHandler=function(t){t.setData(t.dataSource)};e.prototype.playAnim=function(t){this.texiao01.visible=t;if(t){this.texiao01.play(0,true)}else{this.texiao01.stop()}};e.prototype.onRefresh=function(){this.clear();var t=i.MeiRITeHuiModel.getIns().getList();this.listbaoxiang.array=t;if(t.length>0){this.imgbanner.skin=t[0].res}if(i.MeiRITeHuiModel.getIns().is136Chongzhi()){this.goumaishijian.visible=true;this.time.start(game.Context.getServerZeroTime()+util.TimeUtil.secOneDay);this.imgzhe.visible=true;this.btntehui.visible=true;this.btntehui.gray=true;this.wenziimg.visible=true;this.wenziimg.gray=true;this.time.timeStr=app.getLang("meirithui13")}else{var e=i.MeiRITeHuiModel.getIns().getLingQuStatus(i.MeiRITeHuiModel.getIns().sevendayId);switch(e){case i.EMeiriLinQu.CanChongZhi:this.imgzhe.visible=true;this.btntehui.visible=true;this.wenziimg.visible=true;this.wenziimg.gray=false;this.playAnim(true);break;case i.EMeiriLinQu.CanLingQu:this.btntehui.visible=true;this.imgzhe.visible=true;this.wenziimg.visible=true;this.wenziimg.skin="meiritehui/bg_goumai2.png";this.playAnim(true);game.RedDotView.addTo(this.btntehui);this.goumaishijian.visible=true;this.time.start(i.MeiRITeHuiModel.getIns().endTime);this.time.timeStr=app.getLang("meirithui14");break;case i.EMeiriLinQu.IsLingQued:this.yilingqu.visible=true;this.goumaishijian.visible=true;this.time.start(i.MeiRITeHuiModel.getIns().endTime);this.time.timeStr=app.getLang("meirithui14");break}}};e.prototype.onDisplay=function(){this.on(Laya.Event.RESIZE,this,this.onResize);i.MeiRITeHuiModel.getIns().on(i.MeiRITeHuiModel.EVENT_UPDATE_INFO,this,this.onRefresh);this.callLater(this.onRefresh)};e.prototype.onResize=function(){};e.prototype.clear=function(){game.RedDotView.removeFrom(this.btntehui);this.time.stop();this.goumaishijian.text="";this.imgzhe.visible=false;this.btntehui.visible=false;this.btntehui.gray=false;this.wenziimg.visible=false;this.yilingqu.visible=false;this.wenziimg.skin="meiritehui/bg_goumai1.png";this.playAnim(false)};e.prototype.onUnDisplay=function(){i.MeiRITeHuiModel.getIns().off(i.MeiRITeHuiModel.EVENT_UPDATE_INFO,this,this.onRefresh);this.clear();this.playAnim(false);this.off(Laya.Event.RESIZE,this,this.onResize)};e.SINGLE_KEY="meiritehui.MeiRiTeHuiView";return e}(ui.xinshangcheng2.meiritehuiviewUI);i.MeiRiTeHuiView=e})(meiritehui||(meiritehui={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var mjhole;(function(a){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){this._model=a.MjHoleModel.getIns()};e.prototype.onOpenView=function(t){if(battle.BattleModel.getIns().checkBattleState(true)){return}game.ClosureManager.callFunction(t,true,true)};e.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.MijingUnLockNtf,this,this.onMijingUnLockNtf);this.addMsgListener(app.ProtocolResponse.ModifyMijingUnLockNtf,this,this.onModifyMijingUnLockNtf);this.addMsgListener(app.ProtocolResponse.MijingUnLockAck,this,this.onMijingUnLockAck)};e.prototype.onMijingUnLockNtf=function(t,e){this._model.netMapDataArr=e.data;for(var i=0,n=e.data.length;i<n;i++){this._model.dellUnlockInfo(e.data[i])}this._model.event(a.MjHoleModel.UPDATE_LAYER_VIEW)};e.prototype.onModifyMijingUnLockNtf=function(t,e){this._model.netMapDataArr=this._model.netMapDataArr.concat(e.adddata);for(var i=0,n=e.adddata.length;i<n;i++){this._model.dellUnlockInfo(e.adddata[i])}this._model.event(a.MjHoleModel.UPDATE_LAYER_VIEW)};e.prototype.onMijingUnLockAck=function(t,e){if(e.ret){}else{this._model.dellReback()}};e.SINGLE_KEY="mjhole.MjHoleModule";return e}(app.ModuleBase);a.MjHoleModule=t})(mjhole||(mjhole={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var mjhole;(function(s){var t=function(){function t(){}return t}();s.MJHoleVo=t;var u=function(){function t(){}return t}();s.MJHoleRoleVo=u;var a;(function(t){t[t["CAN_GO"]=1]="CAN_GO";t[t["GO_BY"]=2]="GO_BY"})(a=s.MapState||(s.MapState={}));var e=function(e){__extends(i,e);function i(){var t=e!==null&&e.apply(this,arguments)||this;t._clientRoleArr=[];return t}i.prototype.dellUnlockInfo=function(t){if(!this.mjUnlockMap){this.mjUnlockMap={}}if(!this.mjUnlockMap[t.unlocktype]){this.mjUnlockMap[t.unlocktype]={}}if(!this.mjUnlockMap[t.unlocktype][t.tid]){this.mjUnlockMap[t.unlocktype][t.tid]={}}this.mjUnlockMap[t.unlocktype][t.tid][t.viewid]=1};i.prototype.checkIfUnlock=function(t,e,i){if(!this.mjUnlockMap){return false}if(!this.mjUnlockMap[t]){return false}if(!this.mjUnlockMap[t][e]){return false}if(!this.mjUnlockMap[t][e][i]){return false}return true};i.getIns=function(){return app.Singleton.getInstance(i)};i.prototype.dellReback=function(){s.MjHoleMainView.getIns().stopAuto();this.event(s.MjHoleModel.RE_BACK)};Object.defineProperty(i.prototype,"clickVid",{get:function(){return this._clickVid},set:function(t){this._clickVid=t;this.event(i.ITEM_BTN_STATE_CHANGE)},enumerable:true,configurable:true});i.prototype.getMaxRow=function(t,e){var i=this.getViewIdMapArr(t,e);var n=i.length;var a=i[n-1];return Math.ceil(a/this.getMaxColumn())};i.prototype.getMaxColumn=function(){return 5};i.prototype.init=function(){};i.prototype.initMapArr=function(t,e){return csv.MjHoleProxy.getIns().getCfgItemByLayerViewId(t,e)};i.prototype.getViewIdMapArr=function(t,e){var i=[];var n=this.initMapArr(t,e);n.map(function(t){i.push(t.viewid)});return i};i.prototype.getNetMapDataArr=function(e,i){var n=[];if(this.netMapDataArr){this.netMapDataArr.map(function(t){if(t.tid==i&&t.unlocktype==e){n.push(t)}})}return n};i.prototype.getMapItemState=function(t,e,i,n){if(n==0){return a.CAN_GO}if(this.checkIfUnlock(t,e,i)){return a.GO_BY}return a.CAN_GO};i.prototype.getStartRoleArr=function(t){var e=game.Context.roleList;var i=[];var n=0;if(e){for(var a=0;a<game.Context.battleRoleList.length;a++){var o=game.Context.battleRoleList[a];var s=void 0;var r=csv.GuajiProxy.getIns().getMijingCfg(t);if(o.soulStar){var l=csv.YuanshenProxy.getIns().getXiulianRoleItem(o.soulStar);s=csv.YuanshenProxy.getIns().getXiulianCfgItem(l.xiulian).bigrealm}else{s=0}var h=new u;h.roleVo=o;h.bol=false;h.waBigReal=s;if(s>=r.bigrealm){h.bol=true;n++}i.push(h)}for(var a=0;a<game.Context.waitRoleList.length;a++){var p=game.Context.waitRoleList[a];var s=void 0;var r=csv.GuajiProxy.getIns().getMijingCfg(t);if(p.soulStar){var l=csv.YuanshenProxy.getIns().getXiulianRoleItem(p.soulStar);s=csv.YuanshenProxy.getIns().getXiulianCfgItem(l.xiulian).bigrealm}else{s=0}var h=new u;h.roleVo=p;h.bol=false;h.waBigReal=s;if(s>=r.bigrealm&&n<5){h.bol=true;n++}i.push(h)}}return i};i.prototype.initFightArr=function(t){var e=this;this._clientRoleArr=[];t.map(function(t){if(t.bol){e._clientRoleArr.push(t.roleVo.prof)}})};i.prototype.getFightWaArr=function(){return this._clientRoleArr};i.prototype.setFightWaArr=function(t,e){if(e){this._clientRoleArr.push(t)}else{var i=this._clientRoleArr.indexOf(t);this._clientRoleArr.splice(i,1)}};i.prototype.setBigEventArr=function(t){var e=this;var i=[];t.map(function(t){i=i.concat(t)});this.clientBigEventArr=[];i.pop();i.map(function(t){if(t.data.ccfg.things==1){e.clientBigEventArr.push(t.data)}});return this.clientBigEventArr};i.prototype.doorIsCanGo=function(t,e){var i;var n=csv.GuajiProxy.getIns().getMijingCfg(t);if(n.type==2){i=n.guanqia}else{i=n.id}var a=csv.MjHoleProxy.getIns().getCfgItemByLayerViewId(n.type,i);for(var o=0,s=a.length;o<s;o++){var r=a[o];if(r.leveltype==10&&this.checkIfUnlock(r.unlocktype,r.typeid,r.viewid)){if(r.paramshow.split("-")[1]==e){return true}}}return false};i.prototype.isCanOpenMjHoleView=function(t,e){var i=false;var n=this.getStartRoleArr(t);for(var a=0;a<n.length;a++){if(n[a].bol){i=true;break}}if(i){}else{manager.FlowManager.instance.flowByStyle1(app.getLang("mijingjiesuo_01"))}return i};i.prototype.getMjjingProgress=function(t){var e=0;var i;var n=csv.GuajiProxy.getIns().getMijingCfg(t);if(n.type==2){i=n.guanqia}else{i=n.id}var a=this.getNetMapDataArr(n.type,i);var o=0;var s=csv.MjHoleProxy.getIns().getCfgItemByLayerViewId(n.type,i);for(var r=0,l=s.length;r<l;r++){if(s[r].leveltype){o++}}e=Math.floor(a.length/o*100);return e};i.prototype.getMjjingUnlocks=function(t){var i=[];var e;var n=csv.GuajiProxy.getIns().getMijingCfg(t);if(n.type==2){e=n.guanqia}else{e=n.id}var a=this.getNetMapDataArr(n.type,e);a.map(function(t){var e=csv.MjHoleProxy.getIns().getCfgItemByLayerViewId2(t.unlocktype,t.tid,t.viewid);if(e.leveltype==5){i.push(8e3)}else if(e.leveltype==6){i.push(+e.paramshow)}});return i};i.prototype.openMjHoleItem=function(t,e,i,n){if(i===void 0){i=[]}if(n){app.ProtocolRequest.MijingUnLockReq(e,n)}else{app.ProtocolRequest.MijingUnLockReq(e,i)}};i.prototype.openDongfu=function(t){var e=csv.GuajiProxy.getIns().getMijingCfg(t);var i;if(e.type==2){i=e.guanqia}else{i=e.id}var n=csv.MjHoleProxy.getIns().getCfgItemByLayerViewId(e.type,i);var a=n[n.length-1];app.ProtocolRequest.MijingUnLockReq(a.id,[]);var o={viewId:a.viewid,ccfg:a,state:1};app.ViewManager.toggleDialog(s.MjHoleDongfuGetView,1,0,[o])};i.prototype.openLockDongfu=function(t){var e=csv.GuajiProxy.getIns().getMijingCfg(t);var i;if(e.type==2){i=e.guanqia}else{i=e.id}var n=csv.MjHoleProxy.getIns().getCfgItemByLayerViewId(e.type,i);var a=n[n.length-1];var o={viewId:a.viewid,ccfg:a,state:1};app.ViewManager.toggleDialog(s.MjHoleDongfuGetView,1,0,[o])};i.SINGLE_KEY="mjhole.MjHoleModel";i.UPDATE_LAYER_VIEW="UPDATE_LAYER_VIEW";i.POP_LOCK_VIEW="POP_LOCK_VIEW";i.PATH_SEARCH="PATH_SEARCH";i.ROLE_REACH="ROLE_REACH";i.RE_BACK="RE_BACK";i.ITEM_BTN_STATE_CHANGE="ITEM_BTN_STATE_CHANGE";return i}(app.ModelBase);s.MjHoleModel=e})(mjhole||(mjhole={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("mijingjiesuo.csv");this._cfgMapByLayerViewId=t.getMapList("unlocktype","typeid");this._cfgMapByLayerViewId2=t.getMap("unlocktype","typeid","viewid");this._cfgMap=t.getMap("id");this._cfgArr=t.getArray();this._nextMap={}};e.prototype.getBigLayerCfgArr=function(t){var e=[];var i=this._cfgMapByLayerViewId[t];for(var n in i){e.push.apply(e,i[n])}return e};e.prototype.getBigLayerCfg=function(t){return this._cfgMapByLayerViewId[t]};e.prototype.getCfgItemByLayerViewId=function(t,e){return this._cfgMapByLayerViewId[t][e]};e.prototype.getCfgItemByLayerViewId2=function(t,e,i){return this._cfgMapByLayerViewId2[t][e][i]};e.prototype.getCfgMap=function(){return this._cfgMap};e.prototype.getCfgMapItem=function(t){return this._cfgMap[t]};e.prototype.getCfgArr=function(){return this._cfgArr};e.prototype.getNextIds=function(t,e,i){var n=t+"_"+e;if(!this._nextMap[n]){var a={};var o=csv.MjHoleProxy.getIns().getCfgItemByLayerViewId(t,e);for(var s=0,r=o.length;s<r;s++){var l=o[s];var h=app.str2Array(l.nleveid,"-");for(var p=0,u=h.length;p<u;p++){if(!a[h[p]]){a[h[p]]=[]}a[h[p]].push(l.viewid)}}this._nextMap[n]=a}return this._nextMap[n][i]||[]};e.SINGLE_KEY="csv.MjHoleProxy";return e}(app.ModelBase);t.MjHoleProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var mjhole;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){if(t.ccfg.leveltype==6){var e=game.ItemUtil.parserList(t.ccfg.paramshow)[0];this.titlelabel.text=app.getLang("mijingjiesuo_dashijiyao_0"+t.ccfg.leveltype,e.itemCfg.namedispaly)}else{this.titlelabel.text=app.getLang("mijingjiesuo_dashijiyao_0"+t.ccfg.leveltype)}if(t.state==i.MapState.GO_BY){this.labeldacheng.text="达成";this.duigou.visible=true}else{this.labeldacheng.text="未达成";this.duigou.visible=false}};e.SINGLE_KEY="mjhole.MjHoleItem";return e}(ui.mijing.dashijiyaoitemUI);i.MjHoleBigEventItem=t})(mjhole||(mjhole={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var mjhole;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listdachengtiaojian.itemRender=i.MjHoleBigEventItem;this.listdachengtiaojian.renderHandler=new Laya.Handler(this,this.onRenderHandler);this._model=i.MjHoleModel.getIns()};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){this.listdachengtiaojian.array=this._model.clientBigEventArr;this.listdachengtiaojian.height=this._model.clientBigEventArr.length*25+10;this.listdachengtiaojian.centerY=0};e.prototype.onRenderHandler=function(t,e){t.setData(t.dataSource)};e.SINGLE_KEY="mjhole.MjHoleBigEventView";return e}(ui.mijing.dashijiyaotipsUI);i.MjHoleBigEventView=t})(mjhole||(mjhole={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var mjhole;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getInstance=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=i.MjHoleModel.getIns()};e.prototype.onDisplay=function(){this.callLater(this.updateLayout)};e.prototype.onUnDisplay=function(){};e.prototype.updateLayout=function(){};e.prototype.setData=function(t){var e=app.str2Array(t,"-");var i=Attributes.getWuxingEnumType(parseInt(e[0]));this.wuxingimg.skin="public/bg_wuxing_"+i+".png";this.shuzhi.text=e[e.length-1]};e.SINGLE_KEY="mjhole.MjHoleElementItem";return e}(ui.mijing.mijingwuxingshuxingUI);i.MjHoleElementItem=t})(mjhole||(mjhole={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var mjhole;(function(a){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this._model=a.MjHoleModel.getIns();this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.doAuto=function(){if(this._model.autoVid){a.MjHoleMainView.getIns().stopAuto(a.MjHoleMainView.getIns().currVid)}else{this._model.autoVid=this._vo.viewId;a.MjHoleMainView.getIns().startAuto()}this._model.event(a.MjHoleModel.ITEM_BTN_STATE_CHANGE)};e.prototype.onDisplay=function(){this.renwu.visible=false;this.on(Laya.Event.CLICK,this,this.onSelect);this._model.on(a.MjHoleModel.ROLE_REACH,this,this.reachEvent);this._model.on(a.MjHoleModel.PATH_SEARCH,this,this.playAni);this._model.on(a.MjHoleModel.ITEM_BTN_STATE_CHANGE,this,this.setClickState);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){this._model.off(a.MjHoleModel.ROLE_REACH,this,this.reachEvent);this._model.off(a.MjHoleModel.PATH_SEARCH,this,this.playAni);this._model.off(a.MjHoleModel.ITEM_BTN_STATE_CHANGE,this,this.setClickState);this.off(Laya.Event.CLICK,this,this.onSelect);Laya.timer.clearAll(this);Laya.Tween.clearAll(this.renwu);this.stopFudongAni();this._vo=null};e.prototype.playShowAni=function(t){this.box.alpha=0;this.boShow=true;Laya.timer.once(t,this,this.startShowAni)};e.prototype.startShowAni=function(){this.ani3.on(Laya.Event.COMPLETE,this,this.endShowAni);this.ani3.play(0,false)};e.prototype.endShowAni=function(){this.ani3.off(Laya.Event.COMPLETE,this,this.endShowAni);this.box.alpha=1;this.boShow=false;this._updateItemState()};e.prototype.playFudongAni=function(){this.isPlay=true;this.box.y=86;this.ani2.play(game.SceneModel.random(0,60))};e.prototype.stopFudongAni=function(){this.isPlay=false;this.box.y=110;this.ani2.stop()};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){this._vo=t;this.setClickState();this._updateFloor();this._setSkin();this._updateItemState();this.playAni()};e.prototype._updateItemState=function(){if(this.boShow){return}if(this._vo.ccfg.leveltype==0||this._vo.state==a.MapState.GO_BY){this.renwu.visible=false}else{this.renwu.visible=true}this.playFudongAni()};e.prototype._setSkin=function(){if(this._vo.state==a.MapState.GO_BY){return}this.renwu.alpha=1;this.renwu.imgfabao.scale(1,1);this.renwu.imgfabao.y=85;this.renwu.y=-52;this._setAniVisible(true,false);this.renwu.dizuo.skin="";if(this._vo.ccfg.leveltype==1||this._vo.ccfg.leveltype==8){var t=csv.MonsterProxy.getIns().getMidsByMset(this._vo.ccfg.paramshow)[0];var e=csv.MonsterProxy.getIns().getCfg(t);if(!this.roleAvatar){this.roleAvatar=new avatar.AvatarAnimation;this._roleAvatar=new avatar.AvatarData;this._roleAvatar.roleKey=e.res;this.renwu.guaiwu.addChild(this.roleAvatar)}this._roleAvatar.roleKey=e.res;this._roleAvatar.fileName=game.AniView.FILE_NAME.MONSTER;this.roleAvatar.scale(.5,.5);this.roleAvatar.setAniData(this._roleAvatar);this.roleAvatar.setAni(avatar.AvatarAnimation.ANI_ENUMS.IDLE,6);this.roleAvatar.play();this._setAniVisible(false,true)}else if(this._vo.ccfg.leveltype==2){this.renwu.imgfabao.skin="res/static/mijing/bg_baoxiang.png"}else if(this._vo.ccfg.leveltype==4){this.renwu.imgfabao.skin="res/static/mijing/bg_wuxing.png"}else if(this._vo.ccfg.leveltype==3){this.renwu.y=-78;this.renwu.dizuo.skin="res/static/mijing/bg_fabaodizuo.png";this.renwu.imgfabao.skin="res/icon/item/magicweapon_"+this._vo.ccfg.paramshow+".png"}else if(this._vo.ccfg.leveltype==6){this.renwu.imgfabao.skin="res/icon/item/item_"+this._vo.ccfg.paramshow+".png"}else if(this._vo.ccfg.leveltype==5||this._vo.ccfg.leveltype==7){this.renwu.imgfabao.y=75;var i=csv.GuajiProxy.getIns().getMijingCfg(this._model.clientMjId);this.renwu.imgfabao.scale(1.5,1.5);this.renwu.imgfabao.skin="res/static/guajiditu/"+i.smallicon+".png"}else if(this._vo.ccfg.leveltype==9){this.renwu.imgfabao.skin="res/static/mijing/bg_dati.png"}else if(this._vo.ccfg.leveltype==10){var n=this._vo.ccfg.paramshow.split("-");this.renwu.imgfabao.skin="res/static/mijing/bg_yaoshi0"+n[1]+".png"}else if(this._vo.ccfg.leveltype==11){this.renwu.imgfabao.skin="res/static/mijing/bg_men0"+this._vo.ccfg.paramshow+".png"}};e.prototype._updateFloor=function(){this.imgbukedianji.alpha=1;this.imgbukedianji.visible=true;this.imgbukedianji.skin="res/static/mijing/bg_dizuo_zhengcheng.png";Laya.timer.clear(this,this.shine)};e.prototype._setAniVisible=function(t,e){this.renwu.boxfabao.visible=t;this.renwu.boxguaiwu.visible=e;this.renwu.boxrenwu.visible=false};e.prototype.onSelect=function(t){if(this._model.autoVid){if(this._vo.viewId==this._model.autoVid){this.doAuto();return}manager.FlowManager.instance.flowByStyle1(app.getLang("请先中止寻路"));return}if(this._model.clickVid==this._vo.viewId){this.doAuto();return}if(this._vo.ccfg.leveltype&&!this._model.checkIfUnlock(this._vo.ccfg.unlocktype,this._vo.ccfg.typeid,this._vo.viewId)){this._clickTime++;if(this._clickTime==1){this._model.clickVid=this._vo.viewId;return}}this._model.clickVid=null;a.MjHoleMainView.getIns().setStartAndEnd(this._vo.viewId)};e.prototype.setClickState=function(){if(!this._vo){return}if(this._vo.viewId==this._model.clickVid){this._clickTime=1}else{this._clickTime=0}};e.prototype.reachEvent=function(t){if(!this._vo){return}this._updateFloor();if(t!=this._vo.viewId){return}if(!this._model.checkIfUnlock(this._vo.ccfg.unlocktype,this._vo.ccfg.typeid,this._vo.viewId)){if(this._vo.ccfg.leveltype==1||this._vo.ccfg.leveltype==8||this._vo.ccfg.leveltype==10){if(!app.ViewManager.DisplayedInStage(a.MjHoleMonsterView))app.ViewManager.toggleDialog(a.MjHoleMonsterView,1,0,this._vo)}else if(this._vo.ccfg.leveltype==2){if(!app.ViewManager.DisplayedInStage(a.MjHoleRichBoxView))app.ViewManager.toggleDialog(a.MjHoleRichBoxView,1,0,[this._vo,false])}else if(this._vo.ccfg.leveltype==3){if(!app.ViewManager.DisplayedInStage(a.MjHoleFabaoView))app.ViewManager.toggleDialog(a.MjHoleFabaoView,1,0,this._vo)}else if(this._vo.ccfg.leveltype==4){if(!app.ViewManager.DisplayedInStage(a.MjHoleFazhenView))app.ViewManager.toggleDialog(a.MjHoleFazhenView,1,0,this._vo)}else if(this._vo.ccfg.leveltype==5){if(!app.ViewManager.DisplayedInStage(a.MjHoleDongfuView))app.ViewManager.toggleDialog(a.MjHoleDongfuView,1,0,this._vo)}else if(this._vo.ccfg.leveltype==6){if(!app.ViewManager.DisplayedInStage(a.MjHoleChanchuView))app.ViewManager.toggleDialog(a.MjHoleChanchuView,1,0,this._vo)}else if(this._vo.ccfg.leveltype==7){if(!app.ViewManager.DisplayedInStage(a.MjHoleDongfuView))app.ViewManager.toggleDialog(a.MjHoleDongfuView,1,0,this._vo)}else if(this._vo.ccfg.leveltype==9){if(!app.ViewManager.DisplayedInStage(a.MjHoleDaTiView))app.ViewManager.toggleDialog(a.MjHoleDaTiView,1,0,this._vo)}else if(this._vo.ccfg.leveltype==11){if(this._model.doorIsCanGo(this._model.clientMjId,+this._vo.ccfg.paramshow)){this._model.openMjHoleItem(this._vo.viewId,this._vo.ccfg.id)}else{this._model.dellReback();manager.FlowManager.instance.flowByStyle1(app.getLang("tiangongshou_14"))}}}};e.prototype.playAni=function(){if(!this._vo){return}if(a.MjHoleMainView.getIns().pannel.moveVids.indexOf(this._vo.viewId)==-1){return}this.imgbukedianji.visible=true;this.imgbukedianji.skin="res/static/mijing/bg_dizuo_xuanzhong.png";Laya.timer.frameLoop(1,this,this.shine)};e.prototype.shine=function(){this.imgbukedianji.alpha=a.MjHoleMainView.getIns().pannel.shineAlpha};e.SINGLE_KEY="mjhole.MjHoleItem";return e}(ui.mijing.dizuoitemUI);a.MjHoleItem=t})(mjhole||(mjhole={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var mjhole;(function(h){var t=function(e){__extends(l,e);function l(){var t=e!==null&&e.apply(this,arguments)||this;t.col=-1;return t}l.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.itemArr=[]};l.prototype.onDisplay=function(){this.callLater(this.refreshAll)};l.prototype.onUnDisplay=function(){};l.prototype.refreshAll=function(){};l.prototype.setData=function(t){while(this.itemArr.length){var e=this.itemArr.shift();e.removeSelf();e=null}for(var i=0;i<5;i++){var e=new h.MjHoleItem;this.itemArr.push(e);e.x=l.POS[i*2];e.y=l.POS[i*2+1];if(i&1){this.addChildAt(e,0)}else{this.addChild(e)}}this.col=t[0].col;this.zOrder=1e3-this.col;var n={};for(var a=0;a<t.length;a++){var o=t[a];n[o.row]=o.data}var s=h.MjHoleMainView.getIns().aniCols.indexOf(this.col)!=-1;for(var r=1;r<=5;r++){var e=this.itemArr[r-1];if(!n[r]){e.visible=false}else{e.visible=true;if(s){if(r&1){e.playShowAni(this.col*60)}else{e.playShowAni(this.col*60+30)}}e.setData(n[r])}}};l.SINGLE_KEY="mjhole.MjHoleItem";l.POS=[1,108,119,61,239,108,358,61,478,108];return l}(ui.mijing.dizuoitemsUI);h.MjHoleItems=t})(mjhole||(mjhole={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var mjhole;(function(s){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.moveVids=[];return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.vScrollBarSkin="";this.mouseEnabled=false;this._model=s.MjHoleModel.getIns()};t.prototype.onDisplay=function(){this._model.on(s.MjHoleModel.ITEM_BTN_STATE_CHANGE,this,this.setClickState)};t.prototype.onUnDisplay=function(){this._model.off(s.MjHoleModel.ITEM_BTN_STATE_CHANGE,this,this.setClickState)};t.prototype.createBg=function(t,e){if(!this._panelBG){this._panelBG=new Laya.Sprite;this.addChild(this._panelBG);this.createRole();this.createAuto()}this._panelBG.graphics.clear();this._panelBG.graphics.drawRect(0,0,t,e,"#ff0000");this._panelBG.alpha=0;this._panelBG.width=t;this._panelBG.height=e;this.scrollRect=new Laya.Rectangle(0,0,this.width,this.height)};t.prototype.createRole=function(){this.imgHead=new Laya.Image;this.imgHead.width=this.imgHead.height=90;this.imgHead.anchorX=.5;this.imgHead.anchorY=.7;this.imgHead.skin=csv.MyTeamProxy.getIns().getTeamIcon(game.Context.teamAvatar);this.addChild(this.imgHead)};t.prototype.setRolePos=function(t,e){this.imgHead.visible=true;this.imgHead.x=t;this.imgHead.y=e};t.prototype.createAuto=function(){this.btnset=new ui.mijing.dizuozdUI};t.prototype.setClickState=function(){if(!this._model.clickVid){this.btnset.removeSelf()}else{var t=s.MjHoleMainView.getIns().getItemPos(this._model.clickVid);this.btnset.x=t.x-70;this.btnset.y=t.y-58;if(this._model.autoVid){this.btnset.btnset.label=app.getLang("中止寻路")}else{this.btnset.btnset.label=app.getLang("前往目标")}this.addChild(this.btnset)}};t.prototype.startMovePath=function(t){if(this.boMove){this.newPosArr=t;return}this.newPosArr=null;var e=[];for(var i=0,n=t.length;i<n;i++){var a=t[i];var o=a.col+1+a.row*5;e.push(o)}this.moveVids=e;this._model.event(s.MjHoleModel.PATH_SEARCH);t.shift();this.posArr=t;this.movePath();this.shineAlpha=1;this.shineSpeed=-.05;Laya.timer.frameLoop(1,this,this.shine)};t.prototype.movePath=function(t){if(this.newPosArr){this.stopMove();this.startMovePath(this.newPosArr);return}if(!this.posArr.length){this.stopMove();return}if(t&&s.MjHoleMainView.getIns().checkStop(t)){this.stopMove();return}var e=this.posArr.shift();var i=e.col+1+e.row*5;var n=s.MjHoleMainView.getIns().getItemPos(i);Laya.Tween.to(this.imgHead,{x:n.x,y:n.y},game.Config.getIntParams(2016),null,Laya.Handler.create(this,this.movePath,[i]));s.MjHoleMainView.getIns().lastVid=s.MjHoleMainView.getIns().currVid;s.MjHoleMainView.getIns().currVid=i;this.boMove=true};t.prototype.stopMove=function(){Laya.timer.clear(this,this.shine);this.moveVids=[];this.boMove=false;Laya.Tween.clearAll(this.imgHead);this._model.event(s.MjHoleModel.ROLE_REACH,s.MjHoleMainView.getIns().currVid)};t.prototype.shine=function(){if(this.shineSpeed<0&&this.shineAlpha<=0){this.shineSpeed=.05}else if(this.shineSpeed>0&&this.shineAlpha>=1){this.shineSpeed=-.05}this.shineAlpha+=this.shineSpeed};t.SINGLE_KEY="mjhole.MjHoleRolePanel";return t}(Laya.Panel);s.MjHoleRolePanel=t})(mjhole||(mjhole={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var mjhole;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){this._role=t;if(this._role){this.labelnum.visible=true;this.bgshuzi.visible=true;this.labelnum.text=csv.ReBirthProxy.getIns().getTransLvl(this._role.level).toString();this.imglock.visible=false;this.imgtouxiang.visible=true;this.imgtouxiang.skin=this._role.getHeadIconUrl();if(this._role.tupoLv){var e=csv.LevelProxy.getIns().getHuluStyle(this._role.tupoLv);this.hulu.hulu.skin=csv.LevelProxy.HULU_ICONS[e.grade];this.dengji.text=this._role.tupoLv.toString()}else{this.hulu.visible=false;this.dengji.visible=false}this.zhanzi.visible=true;this.zhanshuzhi.visible=true;this.zhanshuzhi.value=game.MoneyModel.format(this._role.score)}else{this.labelnum.visible=false;this.bgshuzi.visible=false;this.imgtouxiang.visible=false;this.imglock.visible=true;this.hulu.visible=false;this.dengji.visible=false;this.zhanzi.visible=false;this.zhanshuzhi.visible=false}this.imgxuanzhong.visible=false};e.SINGLE_KEY="mjhole.MjHoleShangZhenItem";return e}(ui.wuxing.wuxingduiwuitemUI);t.MjHoleShangZhenItem=e})(mjhole||(mjhole={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var mjhole;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.on(Laya.Event.CLICK,this,this.onClick);this._model=i.MjHoleModel.getIns();this.xuanze.mouseEnabled=false};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){this._vo=t;this.zhenrongitem.setData(t.roleVo);this.xuanze.selected=t.bol;this.labelwa.text=this._checkChinese(t.roleVo.prof);this.labeldfengji.text=yuanshencode.YuanshenModel.getIns().getBigRealm(t.waBigReal)};e.prototype.onClick=function(){if(this.xuanze.selected){if(this._model.getFightWaArr().length==1){manager.FlowManager.instance.flowByStyle1(app.getLang("mijingjiesuo_03"));return}else{this._model.setFightWaArr(this._vo.roleVo.prof,false);this.xuanze.selected=false}}else{if(this._vo.bol){this._model.setFightWaArr(this._vo.roleVo.prof,true);this.xuanze.selected=true}else{manager.FlowManager.instance.flowByStyle1(app.getLang("mijingjiesuo_02"))}}};e.prototype._checkChinese=function(t){if(t==1){return"大娃"}else{return util.TimeUtil.getChineseNum(t)+"娃"}};e.SINGLE_KEY="mjhole.MjHoleTeamItemView";return e}(ui.mijing.zhenrongitemUI);i.MjHoleTeamItemView=t})(mjhole||(mjhole={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var mjhole;(function(i){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.fullScreen="fullScreen";return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listchuzhan.itemRender=i.MjHoleTeamItemView;this.listchuzhan.renderHandler=new Laya.Handler(this,this.onRenderHandler);this._model=i.MjHoleModel.getIns();this.btnjinru.on(Laya.Event.CLICK,this,this.onClick);guide.GuideModel.getIns().register(csv.GuideProxy.ENUM_VIEW.MJHOLE_ENTER,this.btnjinru,null,500)};t.prototype.onClick=function(){app.ViewManager.toggleDialog(i.MjHoleTeamView,-1,0)};t.prototype.onDisplay=function(){this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){};t.prototype.refreshAll=function(){var t=this._model.getStartRoleArr(this.dataSource);this.listchuzhan.array=t;this._model.initFightArr(t);var e=csv.GuajiProxy.getIns().getMijingCfg(this.dataSource);if(e.bigrealm==0){this.tiaojian.visible=false}else{this.tiaojian.visible=true;var i=yuanshencode.YuanshenModel.getIns().getBigRealm(e.bigrealm);this.tiaojian.text=app.getLang("mijingjiesuo_jingjiexianzhi",i)}};t.prototype.onRenderHandler=function(t,e){t.setData(t.dataSource)};t.SINGLE_KEY="mjhole.MjHoleTeamView";return t}(ui.mijing.zhenrongviewUI);i.MjHoleTeamView=t})(mjhole||(mjhole={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var mjhole;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getInstance=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=i.MjHoleModel.getIns()};e.prototype.onDisplay=function(){this.callLater(this.updateLayout)};e.prototype.onUnDisplay=function(){};e.prototype.updateLayout=function(){};e.prototype.setData=function(t){var e=app.str2Array(t,"-");var i=Attributes.getWuxingEnumType(parseInt(e[0]));this.wuxingimg.skin="public/bg_wuxing_"+i+".png"};e.SINGLE_KEY="mjhole.MjHoleWuXingElementItem";return e}(ui.mijing.mijingwuxingUI);i.MjHoleWuXingElementItem=t})(mjhole||(mjhole={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var mjhole;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=i.MjHoleModel.getIns();this.btnjihuo.on(Laya.Event.CLICK,this,this.onClick)};e.prototype.onClosed=function(){if(this.boBack){this._model.dellReback()}};e.prototype.onClick=function(){this.boBack=false;this._model.openMjHoleItem(this._vo.viewId,this._vo.ccfg.id);app.ViewManager.toggleDialog(i.MjHoleChanchuView,-1,0)};e.prototype.onDisplay=function(){this.boBack=true;this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){Laya.timer.clear(this,this.loopFreshTime)};e.prototype.refreshAll=function(){this._vo=this.dataSource;var t=game.ItemUtil.parserList(this._vo.ccfg.paramshow)[0];this.labelmingzi.text=t.itemCfg.namedispaly;this.daoju.setData(t);if(this._model.autoVid){this.startLoop()}else{this.btnjihuo.label=app.getLang("解锁")}};e.prototype.startLoop=function(){this._startTime=Laya.timer.currTimer;this.loopFreshTime();Laya.timer.loop(1e3,this,this.loopFreshTime)};e.prototype.loopFreshTime=function(){var t=Math.floor((Laya.timer.currTimer-this._startTime)/1e3);if(t<=5){this.btnjihuo.label=app.getLang("解锁")+app.getLang("({0})",5-t)}else{Laya.timer.clear(this,this.loopFreshTime);this.onClick()}};e.SINGLE_KEY="mjhole.MjHoleChanchuView";return e}(ui.mijing.mijingchanchutipUI);i.MjHoleChanchuView=t})(mjhole||(mjhole={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var mjhole;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=i.MjHoleModel.getIns();this.datibtn.on(Laya.Event.CLICK,this,this.onClick2);this.anniu.renderHandler=new Laya.Handler(this,this.onRenderHandler);this.anniu.selectHandler=new Laya.Handler(this,this.onClick);this.anniu.selectEnable=true;this.jiangli.itemRender=grids.GridView;this.jiangli.renderHandler=grids.GridView.CommonItemRender};e.prototype.onClosed=function(){if(this.boBack){this._model.dellReback()}};e.prototype.onClick=function(t){if(t==-1){return}if(this._tempArr.length==0){this.boBack=false;this._answerArr.push(t+1);this._model.openMjHoleItem(this._vo.viewId,this._vo.ccfg.id,[],this._answerArr);app.ViewManager.toggleDialog(i.MjHoleDaTiView,-1,0)}else{var e=this._vo.ccfg.param.split("-");if(+e[this._answerArr.length]!=t+1){app.ViewManager.toggleDialog(i.MjHoleDaTiView,-1,0);manager.FlowManager.instance.flowByStyle1(app.getLang("答题错误"));return}this._answerArr.push(t+1);this.updateQuestionView()}};e.prototype.onClick2=function(){this.kaishidati.visible=false;this.datizhong.visible=true};e.prototype.onDisplay=function(){this.boBack=true;this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){Laya.timer.clear(this,this.loopFreshTime)};e.prototype.refreshAll=function(){this._answerArr=[];this._vo=this.dataSource;this.kaishidati.visible=true;this.datizhong.visible=false;this.jiangli.array=game.ItemUtil.parserList(this._vo.ccfg.slayeraward);this._tempArr=this._vo.ccfg.paramshow.split("|");this.updateQuestionView();if(this._model.autoVid){this.startLoop()}else{this.datibtn.label=app.getLang("开始答题")}};e.prototype.startLoop=function(){this._startTime=Laya.timer.currTimer;this.loopFreshTime();Laya.timer.loop(1e3,this,this.loopFreshTime)};e.prototype.loopFreshTime=function(){var t=Math.floor((Laya.timer.currTimer-this._startTime)/1e3);if(t<=5){this.datibtn.label=app.getLang("开始答题")+app.getLang("({0})",5-t)}else{Laya.timer.clear(this,this.loopFreshTime);this.onClick2()}};e.prototype.updateQuestionView=function(){var t=0;if(this._tempArr.length==3){t=1}else if(this._tempArr.length==2){t=2}else{t=3}this.labetaitou.text=app.getLang("第"+t+"题");var e=this._tempArr[0].split(";");this._tempArr.shift();this.labelwenju.text=app.getLang(e[0]);e.shift();this.anniu.array=e;this.anniu.selectedIndex=-1};e.prototype.onRenderHandler=function(t,e){t.label=app.getLang(t.dataSource)};e.SINGLE_KEY="mjhole.MjHoleDaTiView";return e}(ui.mijing.mijingdatitipsUI);i.MjHoleDaTiView=t})(mjhole||(mjhole={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var mjhole;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=i.MjHoleModel.getIns()};e.prototype.onClick=function(){};e.prototype.onDisplay=function(){guide.GuideModel.getIns().boOpen=false;this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){guide.GuideModel.getIns().boOpen=true;if(this._vo&&chart.ChartModel.getIns().hasIn(this._vo.ccfg.typeid)){i.MjHoleMainView.getIns().lockDog()}};e.prototype.refreshAll=function(){this.donghua.play(0,true);this._vo=this.dataSource[0];if(this._vo){if(this._vo.ccfg.leveltype==7){this.labelxinxi.text=app.getLang("bg_dongfu_name"+this._vo.ccfg.typeid);this.imgdongfu.skin="res/static/guajiditu/bg_guanqia_dongfu_0"+this._vo.ccfg.typeid+".png"}else{var t=csv.GuajiProxy.getIns().getMijingCfg(this._vo.ccfg.typeid);this.imgdongfu.skin="res/static/guajiditu/"+t.smallicon+".png";this.labelxinxi.text=app.getLang(t.name)}}else{this.labelxinxi.text=app.getLang("bg_dongfu_name5");this.imgdongfu.skin="res/static/guajiditu/bg_guanqia_dongfu_05.png"}app.SoundManager.getIns().playSound("ulock")};e.SINGLE_KEY="mjhole.MjHoleDongfuGetView";return e}(ui.mijing.gongxijiesuolvtipUI);i.MjHoleDongfuGetView=t})(mjhole||(mjhole={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var mjhole;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=i.MjHoleModel.getIns();this.btnjihuo.on(Laya.Event.CLICK,this,this.onClick)};e.prototype.onClosed=function(){if(this.boBack){this._model.dellReback()}};e.prototype.onClick=function(){this.boBack=false;this._model.openMjHoleItem(this._vo.viewId,this._vo.ccfg.id);app.ViewManager.toggleDialog(i.MjHoleDongfuView,-1,0);app.ViewManager.toggleDialog(i.MjHoleDongfuGetView,1,0,[this._vo])};e.prototype.onDisplay=function(){this.boBack=true;this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){Laya.timer.clear(this,this.loopFreshTime)};e.prototype.refreshAll=function(){this._vo=this.dataSource;if(this._vo.ccfg.leveltype==7){this.labelmijing.text=app.getLang("bg_dongfu_name"+this._vo.ccfg.typeid);var t=csv.YuanshenProxy.getIns().getHoleCfgMapItem(this._vo.ccfg.typeid).location;this.mijng.skin="res/static/guajiditu/bg_guanqia_dongfu_0"+t+".png"}else{var e=csv.GuajiProxy.getIns().getMijingCfg(this._vo.ccfg.typeid);this.mijng.skin="res/static/guajiditu/"+e.smallicon+".png";this.labelmijing.text=app.getLang(e.name)}if(i.MjHoleModel.getIns().autoVid){this.startLoop()}else{this.btnjihuo.label=app.getLang("解锁")}};e.prototype.startLoop=function(){this._startTime=Laya.timer.currTimer;this.loopFreshTime();Laya.timer.loop(1e3,this,this.loopFreshTime)};e.prototype.loopFreshTime=function(){var t=Math.floor((Laya.timer.currTimer-this._startTime)/1e3);if(t<=5){this.btnjihuo.label=app.getLang("解锁")+app.getLang("({0})",5-t)}else{Laya.timer.clear(this,this.loopFreshTime);this.onClick()}};e.SINGLE_KEY="mjhole.MjHoleDongfuView";return e}(ui.mijing.mijingjiesuotipUI);i.MjHoleDongfuView=t})(mjhole||(mjhole={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var mjhole;(function(a){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=a.MjHoleModel.getIns();this.daoju.on(Laya.Event.CLICK,this,this.onClick);this.tujing.itemRender=ui.common.commonattr11UI;this.tujing.renderHandler=new Laya.Handler(this,this.onTuiJianHandler)};e.prototype.onClick=function(){if(this._isHave){a.MjHoleFabaoView.getIns().setItemView(2);app.ViewManager.toggleDialog(a.MjHoleFabaoSelectView,-1,0);this.isFangru=true}else{var t=void 0;var e=new fabaonew.FaBaoNewVo;var i=game.ItemUtil.parserList(this._vo.ccfg.paramshow)[0];var n=csv.ChouKaProxy.getIns().getBaseCfg(this._vo.ccfg.paramshow);e.cfg=n;e.level=0;e.star=0;e.isActive=0;t=chouka.ChouKaModel.getIns().fabaoShowTips(e,[]);t.itemvo=i;tip.TipManager.showByBtnType(t.itemvo,t.btnList,t.reds)}};e.prototype.onDisplay=function(){this.callLater(this.refreshAll);this.tujing.on(Laya.Event.LINK,this,this.onHandler);this.isFangru=false};e.prototype.onUnDisplay=function(){this.tujing.off(Laya.Event.LINK,this,this.onHandler)};e.prototype.onHandler=function(t){chat.ChatStatic.dellLink(t)};e.prototype.onTuiJianHandler=function(t,e){t.attr.text=t.dataSource};e.prototype.refreshAll=function(){this._vo=this.dataSource;var t=fabaonew.FaBaoNewModel.getIns().getMagicCfgById(this._vo.ccfg.paramshow);if(t.isActive==0){var e=csv.ItemProxy.getIns().getBagTuiByID(game.Config.getIntParams(971));if(e){var i=app.getLang(e.access).split("\n");this.tujing.array=i;this.daoju.gray=true;this._isHave=false;this.fabaoBox.visible=true}}else{this.daoju.gray=false;this._isHave=true;this.fabaoBox.visible=false}var n=chouka.ChouKaModel.getIns().getFabaoByEquip(this._vo.ccfg.paramshow);var a=n.level;var o=n.star;var s=csv.ChouKaProxy.getIns().getBaseCfg(this._vo.ccfg.paramshow);this.daoju.updateStarLevel(o,a,s)};e.SINGLE_KEY="mjhole.MjHoleFabaoSelectView";return e}(ui.mijing.mijingdaojuxuanzeUI);a.MjHoleFabaoSelectView=t})(mjhole||(mjhole={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var mjhole;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=i.MjHoleModel.getIns();this.fabao.btnjia.on(Laya.Event.CLICK,this,this.onClick);this.btnfangru.on(Laya.Event.CLICK,this,this.onClickFangru)};e.prototype.onClosed=function(){if(this.boBack){this._model.dellReback()}};e.prototype.onClick=function(){app.ViewManager.toggleDialog(i.MjHoleFabaoSelectView,1,0,this._vo)};e.prototype.onClickFangru=function(){if(i.MjHoleFabaoSelectView.getIns().isFangru){this.boBack=false;this._model.openMjHoleItem(this._vo.viewId,this._vo.ccfg.id);manager.FlowManager.instance.flowByStyle1(app.getLang("mijingjiesuo_fabao"));i.MjHoleFabaoSelectView.getIns().isFangru=false;app.ViewManager.toggleDialog(i.MjHoleFabaoView,-1,0)}else{manager.FlowManager.instance.flowByStyle1(app.getLang("请放入法宝"))}};e.prototype.onDisplay=function(){this.boBack=true;this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){Laya.timer.clear(this,this.loopFreshTime)};e.prototype.refreshAll=function(){this._vo=this.dataSource;this.setItemView(1);this.guizelab.text=app.getLang("mijingjiesuo_09");if(this._model.autoVid){this.startLoop()}else{this.btnfangru.label=app.getLang("放入法宝")}};e.prototype.startLoop=function(){this._startTime=Laya.timer.currTimer;this.loopFreshTime();Laya.timer.loop(1e3,this,this.loopFreshTime)};e.prototype.loopFreshTime=function(){var t=Math.floor((Laya.timer.currTimer-this._startTime)/1e3);if(t<=5){this.btnfangru.label=app.getLang("放入法宝")+app.getLang("({0})",5-t)}else{Laya.timer.clear(this,this.loopFreshTime);var e=fabaonew.FaBaoNewModel.getIns().getMagicCfgById(this._vo.ccfg.paramshow);if(e.isActive){this.setItemView(2);i.MjHoleFabaoSelectView.getIns().isFangru=true;this.onClickFangru()}else{manager.FlowManager.instance.flowByStyle1(app.getLang("未获得法宝，中止寻路"))}}};e.prototype.setItemView=function(t){if(t==1){this.fabao.btnjia.visible=true;this.fabao.imgfabao.skin=""}else{this.fabao.btnjia.visible=false;this.fabao.imgfabao.skin="res/icon/item/magicweapon_"+this._vo.ccfg.paramshow+".png"}};e.SINGLE_KEY="mjhole.MjHoleFabaoView";return e}(ui.mijing.mijingfabaotipUI);i.MjHoleFabaoView=t})(mjhole||(mjhole={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var mjhole;(function(a){var t=function(n){__extends(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){n.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=a.MjHoleModel.getIns();this.btnjihuo.on(Laya.Event.CLICK,this,this.onClick);this.wuxingqueren.itemRender=a.MjHoleWuXingElementItem;this.wuxingqueren.renderHandler=new Laya.Handler(this,this.onRenderHandler);this.centerLayout=new game.CenterLayoutMediator(this.wuxingqueren,this.box,52,this.wuxingqueren.spaceX);this.itemList=[];var t=[1,3,2,4,5];for(var e=0;e<5;e++){var i=t[e];this.itemList.push(new tip.WuxiAttrItem(this["shuxing"+i]))}};t.prototype.onClosed=function(){if(this.boBack){this._model.dellReback()}};t.prototype.onClick=function(){if(this._isCan){this.boBack=false;this._model.openMjHoleItem(this._vo.viewId,this._vo.ccfg.id);app.ViewManager.toggleDialog(a.MjHoleFazhenView,-1,0)}else{manager.FlowManager.instance.flowByStyle1(app.getLang("五行属性不满足"))}};t.prototype.onDisplay=function(){this.boBack=true;this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){Laya.timer.clear(this,this.loopFreshTime)};t.prototype.refreshAll=function(){this._vo=this.dataSource;if(!this._fiveStar){this._fiveStar=new chouka.FiveStar;this._fiveStar.x=this.imgdizuo.x;this._fiveStar.y=this.imgdizuo.y}var t=game.Context.wuxingAttributes[game.Context.WUXING_ORIGIN.TOTAL];var e=["122-0-0-"+t[0],"123-0-0-"+t[1],"124-0-0-"+t[2],"125-0-0-"+t[3],"126-0-0-"+t[4]];var i=this._vo.ccfg.paramshow.split(";");i.sort(function(t,e){return+t.split("-")[0]-+e.split("-")[0]});var n=chouka.ChouKaModel.getIns().getWuXinAttr2(this.itemList,e,i);this._isCan=this.isCanClick(n);var a=app.getLang("magic_color_in").split(":");this._fiveStar.draw(n,csv.ChouKaProxy.getIns().getLen*this.imgdizuo.scaleX,a[0],parseFloat(a[1]));this.wuxingbox.addChild(this._fiveStar);var o=chouka.ChouKaModel.getIns().getNoReachWuxing(e,i);this.guizelab.text=app.getLang("mijingjiesuo_10");if(o.length>0){this.centerLayout.array=o;this.box.visible=true;this.labelyimanzu.visible=false}else{this.box.visible=false;this.labelyimanzu.visible=true}if(this._model.autoVid){this.startLoop()}else{this.btnjihuo.label=app.getLang("激活法阵")}};t.prototype.startLoop=function(){this._startTime=Laya.timer.currTimer;this.loopFreshTime();Laya.timer.loop(1e3,this,this.loopFreshTime)};t.prototype.loopFreshTime=function(){var t=Math.floor((Laya.timer.currTimer-this._startTime)/1e3);if(t<=5){this.btnjihuo.label=app.getLang("激活法阵({0})",5-t)}else{Laya.timer.clear(this,this.loopFreshTime);this.onClick()}};t.prototype.onRenderHandler=function(t,e){t.setData(t.dataSource)};t.prototype._checkStr=function(t){var e=t.split("-");return e[e.length-1]};t.prototype.isCanClick=function(t){for(var e=0;e<t.length;e++){if(t[e]!=1){return false}}return true};t.SINGLE_KEY="mjhole.MjHoleFazhenView";return t}(ui.mijing.mijingwuxingtipUI);a.MjHoleFazhenView=t})(mjhole||(mjhole={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var mjhole;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listwuxing.itemRender=i.MjHoleElementItem;this.listwuxing.renderHandler=new Laya.Handler(this,this.onRenderHandler);this._model=i.MjHoleModel.getIns();this.btnjihuo.on(Laya.Event.CLICK,this,this.onClick);guide.GuideModel.getIns().register(csv.GuideProxy.ENUM_VIEW.MJHOLE_BATTLE,this.btnjihuo,null,500)};e.prototype.onClosed=function(){if(this.boBack){this._model.dellReback()}};e.prototype.onClick=function(){this.boBack=false;this._model.openMjHoleItem(this._vo.viewId,this._vo.ccfg.id,this._model.getFightWaArr())};e.prototype.onDisplay=function(){this.boBack=true;this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){Laya.timer.clear(this,this.loopFreshTime)};e.prototype.refreshAll=function(){this._vo=this.dataSource;this.guizelab.text=app.getLang("mijingjiesuo_07");var t="";if(this._vo.ccfg.leveltype==10){t=this._vo.ccfg.paramshow.split("-")[0]}else{t=this._vo.ccfg.paramshow}var e=csv.MonsterProxy.getIns().getMidsByMset(+t)[0];var i=csv.MonsterProxy.getIns().getCfg(e);if(!this.roleAvatar){this.roleAvatar=new avatar.AvatarAnimation;this._roleAvatar=new avatar.AvatarData;this._roleAvatar.roleKey=i.res;this.weizhi.addChild(this.roleAvatar)}this._roleAvatar.roleKey=i.res;this._roleAvatar.fileName=game.AniView.FILE_NAME.MONSTER;this.roleAvatar.setAniData(this._roleAvatar);this.roleAvatar.setAni(avatar.AvatarAnimation.ANI_ENUMS.IDLE,6);this.roleAvatar.play();var n=csv.MonsterProxy.getIns().getMonsterBase(+t);var a=csv.BossProxy.getIns().getMonsterId(+t);var o=csv.MonsterProxy.getIns().getCfg(a);this.labelmingzi.text=app.getLang(o.monname);var s=n.element.split(";");s.sort(function(t,e){return+t.split("-")[0]-+e.split("-")[0]});this.listwuxing.array=s;this.listwuxing.width=s.length*120;this.listwuxing.centerX=0;if(this._model.autoVid){this.startLoop()}else{this.btnjihuo.label=app.getLang("开始战斗")}};e.prototype.startLoop=function(){this._startTime=Laya.timer.currTimer;this.loopFreshTime();Laya.timer.loop(1e3,this,this.loopFreshTime)};e.prototype.loopFreshTime=function(){var t=Math.floor((Laya.timer.currTimer-this._startTime)/1e3);if(t<=5){this.btnjihuo.label=app.getLang("开始战斗({0})",5-t)}else{Laya.timer.clear(this,this.loopFreshTime);this.onClick()}};e.prototype.onRenderHandler=function(t,e){t.setData(t.dataSource)};e.SINGLE_KEY="mjhole.MjHoleMonsterView";return e}(ui.mijing.mijingzhandoutipUI);i.MjHoleMonsterView=t})(mjhole||(mjhole={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var mjhole;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=i.MjHoleModel.getIns();this.btndakai.on(Laya.Event.CLICK,this,this.onClick);this.listyulan.itemRender=grids.GridView;this.listyulan.renderHandler=grids.GridView.CommonItemRender;this.jiangli.width=320;this.centerLayout=new game.CenterLayoutMediator(this.listyulan,this.jiangli,98,10)};e.prototype.onClosed=function(){if(this.boBack){this._model.dellReback()}};e.prototype.onClick=function(){this.boBack=false;this._model.openMjHoleItem(this._vo.viewId,this._vo.ccfg.id);app.ViewManager.toggleDialog(i.MjHoleRichBoxView,-1,0);var t=game.ItemUtil.parserList(this._vo.ccfg.paramshow);app.ViewManager.toggleDialog(n,1,0,t)};e.prototype.onDisplay=function(){this.boBack=true;this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){Laya.timer.clear(this,this.loopFreshTime)};e.prototype.refreshAll=function(){this._vo=this.dataSource[0];if(this.dataSource[1]){this.btndakai.disabled=true}else{this.btndakai.disabled=false}this.centerLayout.array=game.ItemUtil.parserList(this._vo.ccfg.paramshow);this.guizelab.text=app.getLang("mijingjiesuo_08");if(this._model.autoVid){this.startLoop()}else{this.btndakai.label=app.getLang("打开宝箱")}};e.prototype.startLoop=function(){this._startTime=Laya.timer.currTimer;this.loopFreshTime();Laya.timer.loop(1e3,this,this.loopFreshTime)};e.prototype.loopFreshTime=function(){var t=Math.floor((Laya.timer.currTimer-this._startTime)/1e3);if(t<=5){this.btndakai.label=app.getLang("打开宝箱")+app.getLang("({0})",5-t)}else{Laya.timer.clear(this,this.loopFreshTime);this.onClick()}};e.SINGLE_KEY="mjhole.MjHoleRichBoxView";return e}(ui.mijing.mijingbaoxiangtipUI);i.MjHoleRichBoxView=t;var n=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.onUnDisplay=function(){t.prototype.onUnDisplay.call(this);Laya.timer.clear(this,this.loopFreshTime);if(this.boStartAuto){i.MjHoleMainView.getIns().startAuto()}};e.prototype.refreshAll=function(){t.prototype.refreshAll.call(this);if(i.MjHoleModel.getIns().autoVid){this.boStartAuto=true;this.startLoop()}else{this.boStartAuto=false;this.guanbilab.text=app.getLang("functionopen_39")}};e.prototype.startLoop=function(){this._startTime=Laya.timer.currTimer;this.loopFreshTime();Laya.timer.loop(1e3,this,this.loopFreshTime)};e.prototype.loopFreshTime=function(){var t=Math.floor((Laya.timer.currTimer-this._startTime)/1e3);if(t<=5){this.guanbilab.text=app.getLang("functionopen_39")+app.getLang("({0})",5-t)}else{Laya.timer.clear(this,this.loopFreshTime);app.ViewManager.toggleDialog(e,-1,0)}};return e}(bag.AwardView);i.MjAwardView=n})(mjhole||(mjhole={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var book;(function(n){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){app.ViewManager.regist(n.MonsterBookMapView,"shanhaixiangyaolu.atlas")};e.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.MonsterbookNtf,this,this.onMonsterbookNtf);this.addMsgListener(app.ProtocolResponse.AwardMonsterbookAck,this,this.onAwardMonsterbookAck);this.addMsgListener(app.ProtocolResponse.SweepMonsterbookAck,this,this.onSweepMonsterbookAck)};e.prototype.onSweepMonsterbookAck=function(t,e){if(e.result){var i=e.mid;app.ViewManager.toggleDialog(boss.BossSweepView,1,0,[i,1,e.award,csv.DailyTimeProxy.ENUM_TYPE.BOSS_MONSTERBOOK]);n.MonsterBookModel.getIns().checkBookReddot()}};e.prototype.onAwardMonsterbookAck=function(t,e){if(e.result){n.MonsterBookModel.getIns().mid.push(e.mid);n.MonsterBookModel.getIns().checkBookReddot();n.MonsterBookModel.getIns().event(n.MonsterBookModel.BOOKMONSTER_AWARD_GETTED)}};e.prototype.onMonsterbookNtf=function(t,e){n.MonsterBookModel.getIns().mid=e.mid;n.MonsterBookModel.getIns().checkBookReddot()};e.SINGLE_KEY="book.MonsterBookModule";return e}(app.ModuleBase);n.MonsterBookModule=t})(book||(book={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var book;(function(h){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.reddots=[];return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.init=function(){this.mid=[];this.midnew=[];this.inited=false};t.prototype.unlockBoss=function(t){if(!this.inited){this.passId=t;this.inited=true}else{if(t>this.passId){this.passId=t;if(guaji.GuajiModel.getIns().isActive(t-1)){var e=csv.MonsterBookProxy.getIns().getCfgByCondition(t-1);if(e){h.MonsterBookModel.getIns().checkBookReddot();for(var i=0;i<e.length;i++){this.midnew.push(e[i].monid)}}}}}};t.prototype.isGetted=function(t){return this.mid.indexOf(t)>=0};t.prototype.updateReddot=function(){var t=this.reddots.length>0;return t};t.prototype.checkBookReddot=function(){var t=csv.MonsterBookProxy.getIns().getMons();this.reddots.length=0;for(var e=0;e<t.length;e++){if(guaji.GuajiModel.getIns().isActive(t[e].condition)){var i=this.isGetted(t[e].monid);if(!i){this.reddots.push(t[e].monid)}}}game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.MONSTER_BOOK);if(this.reddots.length>0){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.MONSTER_BOOK)}else if(csv.FunctionsProxy.getIns().isOpen(csv.FunctionsProxy.ENUMS.BOOK_MONSTER_BOSS)){var n=csv.MonsterBookProxy.getIns().getChapter(1);var a=app.str2Array(n.mondesc,";");var o=parseInt(a[a.length-1]);var s=csv.MonsterBookProxy.getIns().getCfg(o);if(guaji.GuajiModel.getIns().isActive(s.condition)){var r=boss.BossModel.getIns().getDailyTime(csv.DailyTimeProxy.ENUM_TYPE.BOSS_MONSTERBOOK);var l=0;l-=r.extnum;if(l<0)l=0;if(r.fnum+r.gnum+l>0){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.MONSTER_BOOK)}}}h.MonsterBookModel.getIns().event(h.MonsterBookModel.BOOK_MONSTER_NTF_CHANGE)};t.prototype.checkBookReddotByMonid=function(t){return this.reddots.indexOf(t)};t.prototype.getCurChapter=function(){var t=csv.MonsterBookProxy.getIns().getMons();var e={chapterid:1,sheetid:1};for(var i=t.length-1;i>=0;i--){if(guaji.GuajiModel.getIns().isActive(t[i].condition)){e={chapterid:t[i].chapterid,sheetid:t[i].sheetid};break}}return e};t.prototype.checkBookReddotByMondesc=function(t){var e=app.str2Array(t,";");var i=false;for(var n=0;n<e.length;n++){var a=parseInt(e[n]);if(this.checkBookReddotByMonid(a)>=0){i=true;break}}return i};t.SINGLE_KEY="book.MonsterBookModel";t.BOOKMONSTER_AWARD_GETTED="BOOK_MONSTER_AWARD_GETTED";t.BOOK_MONSTER_NTF_CHANGE="BOOK_MONSTER_NTF_CHANGE";return t}(app.ModelBase);h.MonsterBookModel=t})(book||(book={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("monsterbook.csv");this.cfgMap=t.getMap("monid");this.cfgCondition=t.getMapList("condition");this.cfgArr=t.getArray();var e=app.Config.getResById("monsterbook_sheet.csv");this.sheetMap=e.getArray();var i=app.Config.getResById("monsterbook_chapter.csv");this.listMap=i.getMapList("sheetid");this.chapterMap=i.getMap("chapterid")};e.prototype.getMons=function(){return this.cfgArr};e.prototype.getCfg=function(t){return this.cfgMap[t]};e.prototype.getSheetMap=function(){return this.sheetMap};e.prototype.getListBySheetId=function(t){return this.listMap[t]};e.prototype.getCfgByCondition=function(t){return this.cfgCondition[t]};e.prototype.getChapter=function(t){return this.chapterMap[t]};e.SINGLE_KEY="csv.MonsterBookProxy";return e}(app.ModelBase);t.MonsterBookProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var book;(function(t){var e=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.eleImgs=[this.imgEle0,this.imgEle1,this.imgEle2,this.imgEle3,this.imgEle4];for(var t=0;t<this.eleImgs.length;t++){this.eleImgs[t].shuxing.skin="public/bg_wuxing_"+(t+1)+".png";this.eleImgs[t].xinxi.text="0"}this.listMonster.itemRender=guaji.MonsterItem;this.listMonster.renderHandler=new Laya.Handler(this,this.onRenderHandler);this.listMonster.scrollRectOffY=20;this.listdaoju1.itemRender=grids.GridView;this.listdaoju1.renderHandler=grids.GridView.CommonItemRender;this.btnsaodang.clickHandler=new Laya.Handler(this,this.onGeneralBattleReq);this.ani1.gotoAndStop(0)};t.prototype.onRenderHandler=function(t){t.setData(t.dataSource)};t.prototype.onDisplay=function(){boss.BossModel.getIns().on(boss.BossEvent.BOSS_DAILY_TIME_CHANGE,this,this.setDailyTime);this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){boss.BossModel.getIns().off(boss.BossEvent.BOSS_DAILY_TIME_CHANGE,this,this.setDailyTime)};t.prototype.setDailyTime=function(){var t=boss.BossModel.getIns().getDailyTime(csv.DailyTimeProxy.ENUM_TYPE.BOSS_MONSTERBOOK);var e=0;e-=t.extnum;if(e<0)e=0;if(t.fnum+t.gnum+e>0){this.labelxiaohao.visible=false;this.huobi.visible=false;this.labelshuliang.visible=false;this.btnsaodang.gray=false}else{var i=csv.DailyTimeProxy.getIns().buytime(csv.DailyTimeProxy.ENUM_TYPE.BOSS_MONSTERBOOK);if(t.bnum>=i){this.btnsaodang.gray=true}var n=csv.VipProxy.getIns().getVipPri(csv.PRI_TYPE.BOSSMONSTERBOOK,vipcode.VipModel.getIns().vipLvl);var a=csv.DailyTimeProxy.getIns().buycost(csv.DailyTimeProxy.ENUM_TYPE.BOSS_MONSTERBOOK,t.bnum+1);var o=app.getLang("mountain_tips20",n-t.bnum,n);this.labelxiaohao.visible=true;this.huobi.visible=true;this.labelshuliang.visible=true;this.labelshuliang.text=a[1]+""}};t.prototype.refreshAll=function(){for(var t=0;t<this.eleImgs.length;t++){this.eleImgs[t].removeSelf()}var e=app.str2Array(this.dataSource[0].mondesc,";");var i=parseInt(e[e.length-1]);this._monid=i;var n=csv.MonsterBookProxy.getIns().getCfg(i);var a=[],o;if(n.groupid>0){a=csv.MonsterProxy.getIns().getMidsByMset(n.groupid);o=csv.MonsterProxy.getIns().getMonsterBase(n.groupid).element}var s=csv.GuajiProxy.getIns().getCfgGuanqia(n.condition);var r=csv.GuajiProxy.getIns().getPart(s.id);this.labeltitle.text=app.getLang("{0}{1}",app.getLang(this.dataSource[0].chaptername),s.chapter+"-"+r.index);this.listMonster.array=a;if(o&&o.length>0){var l=app.str2Array(o,";","-");for(var t=0;t<l.length;t++){var h=Attributes.getWuxingEnumType(parseInt(l[t][0]));this.eleImgs[h-1].xinxi.text=l[t][l[t].length-1];this.eleBox.addChild(this.eleImgs[h-1])}}if(n.bossreward1.length>0){this.listdaoju1.array=game.ItemUtil.parserList(n.bossreward1)}else{this.listdaoju1.array=[]}this.setDailyTime()};t.prototype.onGeneralBattleReq=function(){boss.BossModel.getIns().onBossMonsterBookBattleReq(this._monid,1)};t.SINGLE_KEY="book.BossInfoView";return t}(ui.guaji.huluguanqiaviewUI);t.BossInfoView=e})(book||(book={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var book;(function(r){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}Object.defineProperty(e.prototype,"ui",{get:function(){return this._ui},enumerable:true,configurable:true});e.prototype.getHeight=function(){return this._ui.y+this._ui.height};e.prototype.init=function(t,e){this._ui=t;this.index=e;this._ui.on(Laya.Event.CLICK,this,this.onOpenView);this._ui.rongjietexiao.on(Laya.Event.COMPLETE,this,this.aniEnd);this._ui.visible=false;this._played=false;this._ui.btnsaodang.visible=false;this.avatar=new avatar.AvatarAnimation;this._ui.zuobiao.addChild(this.avatar);this.avatarData=new avatar.AvatarData;this.avatarData.fileName=game.AniView.FILE_NAME.MONSTER;this.avatar.visible=false;this._ui.btnsaodang.on(Laya.Event.CLICK,this,this.onBattleBoss);this._ui.listdaoju.renderHandler=new Laya.Handler(this,this.onRenderHander)};e.prototype.onRenderHander=function(t){var e=t.dataSource;t.skin=e.getIconUrl()};e.prototype.onBattleBoss=function(t){t.stopPropagation();app.ViewManager.toggleDialog(r.BossInfoView,1,0,[this._cfg])};e.prototype.aniEnd=function(){this.stopAni()};e.prototype.playAni=function(){this._ui.rongjietexiao.play(0,false);this._ui.rongjietexiao.visible=true;app.SoundManager.getIns().playSound("xiangyaojihuo")};e.prototype.stopAni=function(){this._ui.rongjietexiao.stop();this._ui.rongjietexiao.visible=false;this.avatar.stop();this.avatar.visible=false};e.prototype.showView=function(t){this._ui.visible=t};e.prototype.onOpenView=function(){if(this._cfg.mondesc&&this._cfg.mondesc.length>0){app.ViewManager.toggleDialog(r.MonsterInfoView,1,0,[this._cfg,this.index])}};e.prototype.setData=function(t){this._cfg=t;var e=app.str2Array(t.mondesc,";");var i=parseInt(e[0]);var n=csv.MonsterBookProxy.getIns().getCfg(i);var a=guaji.GuajiModel.getIns().isActive(n.condition);if(a){this._ui.gray=false;if(!this._played&&r.MonsterBookModel.getIns().midnew.indexOf(i)>=0){this.playAni();this._played=true}}else{this._ui.gray=true}i=parseInt(e[e.length-1]);n=csv.MonsterBookProxy.getIns().getCfg(i);a=guaji.GuajiModel.getIns().isActive(n.condition);this._ui.imgPassed.visible=a;this._ui.imgtmijingditu1.skin="res/static/shanhaixiangyaolu/"+t.chapterpic+".png";this._ui.mijingming2.skin="res/static/shanhaixiangyaolu/"+t.chaptername+".png";this.updateReddot();this._ui.di.visible=false;this._ui.listdaoju.array=[];this._ui.btnsaodang.visible=false;this.avatar.stop();this.avatar.visible=false;if(csv.FunctionsProxy.getIns().isOpen(csv.FunctionsProxy.ENUMS.BOOK_MONSTER_BOSS,false)&&a){var o=csv.MonsterProxy.getIns().getCfg(i);this.avatarData.roleKey=o.res;this.avatar.setAniData(this.avatarData);var s=n.bonetimes2?n.bonetimes2/100:1;this.avatar.scale(s,s);this.avatar.setAni(avatar.AvatarAnimation.ANI_ENUMS.IDLE,0);this.avatar.play();this.avatar.visible=true;this._ui.btnsaodang.visible=true;if(n.rewardshow.length>0){this._ui.listdaoju.array=game.ItemUtil.parserList(n.rewardshow);this._ui.di.visible=true}}};e.prototype.updateReddot=function(){game.RedDotView.removeFrom(this._ui.hongdian);if(r.MonsterBookModel.getIns().checkBookReddotByMondesc(this._cfg.mondesc)){game.RedDotView.addTo(this._ui.hongdian)}};return e}(Laya.EventDispatcher);r.MapItemClass=t})(book||(book={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var book;(function(h){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.anniu[app.SoundManager.NO_BUTTON_MUSIC]=1};e.prototype.setData=function(t){this.data=t;this.anniu.label=app.getLang(t.sheetesc);this.showcirle(false);this.updateReddot()};e.prototype.updateReddot=function(){game.RedDotView.removeFrom(this.anniu);var t=csv.MonsterBookProxy.getIns().getListBySheetId(this.data.sheetid);var e=false;for(var i=0;i<t.length;i++){e=h.MonsterBookModel.getIns().checkBookReddotByMondesc(t[i].mondesc);if(e){break}}if(e){game.RedDotView.addTo(this.anniu)}};e.prototype.setSelected=function(t){if(t){this.anniu.selected=true}else{this.anniu.selected=false}};e.prototype.showcirle=function(t){};return e}(ui.shanhaixiangyaolu.yeqiantemUI);h.TabButtonItem=t;var e=function(n){__extends(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){n.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);var t=new Laya.Sprite;t.graphics.drawRect(0,0,this.out.width,this.out.height,"#ff0000");this.out.mask=t;this.listyeqian.itemRender=h.TabButtonItem;this.listyeqian.renderHandler=new Laya.Handler(this,this.onItemRenderHandler);this.listyeqian.selectEnable=true;this.listyeqian.selectHandler=new Laya.Handler(this,this.onTabButtonItemSelected);this.listyeqian.scrollRectOffY=20;this.listyeqian.hScrollBarSkin=" ";var e=csv.MonsterBookProxy.getIns().getSheetMap();this.listyeqian.array=e;this.mapItems=[];for(var i=1;i<=9;i++){this.mapItems.push(new h.MapItemClass);this.mapItems[i-1].init(this["guanqia"+i],i-1)}game.HelperViewHandler.registerStr([this.btnwenhao],"xiangyaolu_title01","xiangyaolu_help01");this.ditu.vScrollBar.on(Laya.Event.CHANGE,this,this.onScrollBarChange);guide.GuideModel.getIns().register(csv.GuideProxy.ENUM_VIEW.MB_SELECT,this,this.getGuideItemBtn,2e3);this.mouseThrough=true};t.prototype.getGuideItemBtn=function(){return this.mapItems[0].ui};t.prototype.onScrollBarChange=function(){this.yun.y=-this.ditu.vScrollBar.value/10};t.prototype.onItemRenderHandler=function(t,e){t.setData(t.dataSource);t.setSelected(e==this.listyeqian.selectedIndex)};t.prototype.onDisplay=function(){boss.BossModel.getIns().on(boss.BossEvent.BOSS_DAILY_TIME_CHANGE,this,this.setDailyTime);app.SoundManager.getIns().playSound("functionopen");this.ani3.play();this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){boss.BossModel.getIns().off(boss.BossEvent.BOSS_DAILY_TIME_CHANGE,this,this.setDailyTime);app.SoundManager.getIns().playSound("functionclose");this.ani3.stop();for(var t=0;t<this.mapItems.length;t++){this.mapItems[t].stopAni()}};t.prototype.onAwardGetted=function(t){this.mapItems[t].updateReddot();this.listyeqian.refresh()};t.prototype.refreshAll=function(){this.listyeqian.refresh();var t=h.MonsterBookModel.getIns().getCurChapter();this.listyeqian.selectedIndex=t.sheetid-1;this.onTabButtonItemSelected(t.sheetid-1);var e=csv.MonsterBookProxy.getIns().getListBySheetId(t.sheetid);var i=0;for(var n=0;n<e.length;n++){if(e[n].chapterid==t.chapterid){i=n;break}}if(i>3){this.ditu.vScrollBar.value=this.ditu.vScrollBar.max}else{this.ditu.vScrollBar.value=0}this.setDailyTime()};t.prototype.setDailyTime=function(){h.MonsterBookModel.getIns().checkBookReddot();var t=csv.DailyTimeProxy.ENUM_TYPE.BOSS_MONSTERBOOK;var e=boss.BossModel.getIns().getDailyTime(t);var i=csv.DailyTimeProxy.getIns().getCfg(t);var n=0;var a=parseInt(i.time)+n;n-=e.extnum;if(n<0)n=0;this.labelsaodangcishu.text=app.getLang("mountain_tips13")+(e.fnum+e.gnum+n+"/"+a);this.labelsaodangcishu.visible=false;this.imgdikuang.visible=false;if(csv.FunctionsProxy.getIns().isOpen(csv.FunctionsProxy.ENUMS.BOOK_MONSTER_BOSS,false)){var o=csv.MonsterBookProxy.getIns().getChapter(1);var s=app.str2Array(o.mondesc,";");var r=parseInt(s[s.length-1]);var l=csv.MonsterBookProxy.getIns().getCfg(r);if(guaji.GuajiModel.getIns().isActive(l.condition)){this.labelsaodangcishu.visible=true;this.imgdikuang.visible=true}}};t.prototype.onTabButtonItemSelected=function(t){var e=this.listyeqian.getCell(t);if(this.selectedItem){this.selectedItem.setSelected(false)}this.ditu.vScrollBar.value=0;this.selectedItem=e;this.selectedItem.setSelected(true);var i=csv.MonsterBookProxy.getIns().getListBySheetId(this.selectedItem.data.sheetid);for(var n=0;n<this.mapItems.length;n++){this.mapItems[n].showView(false)}if(i&&i.length>0){for(var n=0;n<i.length;n++){this.mapItems[n].showView(true);this.mapItems[n].setData(i[n])}}this.boxItems.height=this.mapItems[i.length-1].getHeight()};t.SINGLE_KEY="book.MonsterBookMapView";return t}(ui.shanhaixiangyaolu.shanhaixiangyaoluviewgaiUI);h.MonsterBookMapView=e})(book||(book={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var book;(function(f){var i=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.CLICK,this,this.onItemSelected)};e.prototype.onItemSelected=function(){f.MonsterInfoView.getIns().onItemSelected(this,this._data)};e.prototype.setData=function(t,e){this._data=t;this.viewjineng.setData(t+"-1",false,false,false,false);this.xuanzhong.visible=e;if(e){this.onItemSelected()}};return e}(ui.shanhaixiangyaolu.yaoguaitujianjinengitemUI);f.MonsterSkillItem=i;var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.monIndex=0;t.monids=[];return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.btnLeft.clickHandler=new Laya.Handler(this,this.onLeft);this.btnRight.clickHandler=new Laya.Handler(this,this.onRight);this.centerLayout=new game.CenterLayoutMediator(this.listfanye,this.box,32,8);this.listfanye.renderHandler=new Laya.Handler(this,this.onPageRenderHandler);this.listjinneg.itemRender=i;this.listjinneg.renderHandler=new Laya.Handler(this,this.onSkillRenderHandler);this.daoju.on(Laya.Event.CLICK,this,this.onCheckpointAwardReq);this.avatar=new avatar.AvatarAnimation;this.guaiwu.addChild(this.avatar);this.avatarData=new avatar.AvatarData;this.avatarData.fileName=game.AniView.FILE_NAME.MONSTER;this.avatar.visible=false;this.imgyilingqu.visible=false;this.stopAni(this.bossjiesuo);this.stopAni(this.huanrao);this.bossjiesuo.on(Laya.Event.COMPLETE,this,this.stopAni,[this.bossjiesuo]);guide.GuideModel.getIns().register(csv.GuideProxy.ENUM_VIEW.MB_AWARD,this.daoju)};t.prototype.onCheckpointAwardReq=function(){var t=this.monids[this.monIndex];var e=csv.MonsterBookProxy.getIns().getCfg(t);var i=guaji.GuajiModel.getIns().isActive(e.condition);if(i){var n=f.MonsterBookModel.getIns().isGetted(t);if(!n){app.ProtocolRequest.AwardMonsterbookReq(t)}}else{var a=csv.GuajiProxy.getIns().getCfgGuanqia(e.condition);var o=csv.GuajiProxy.getIns().getPart(a.id);manager.FlowManager.instance.flowByStyle1(app.getLang("xiangyaolu_desc01",a.chapter,o.index))}};t.prototype.onSkillRenderHandler=function(t,e){t.setData(t.dataSource,this.listjinneg.selectedIndex==e)};t.prototype.onPageRenderHandler=function(t){if(t.dataSource==this.monids[this.monIndex]){t.skin="shanhaixiangyaolu/btn_create_fanye01.png"}else{t.skin="shanhaixiangyaolu/btn_create_fanye02.png"}};t.prototype.onLeft=function(){if(this.monIndex>0){this.monIndex-=1;this.btnRight.visible=true;if(this.monIndex==0){this.btnLeft.visible=false}else{this.btnLeft.visible=true}this.updateView()}};t.prototype.onRight=function(){var t=this.monids.length-1;if(this.monIndex<t){this.monIndex+=1;this.btnLeft.visible=true;if(this.monIndex==t){this.btnRight.visible=false}else{this.btnRight.visible=true}this.updateView()}};t.prototype.updateView=function(){game.RedDotView.removeFrom(this.btnRight);game.RedDotView.removeFrom(this.btnLeft);if(this.btnRight.visible){for(var t=this.monIndex+1;t<this.monids.length;t++){if(f.MonsterBookModel.getIns().checkBookReddotByMonid(this.monids[t])>=0){game.RedDotView.addTo(this.btnRight);break}}}if(this.btnLeft.visible){for(var t=this.monIndex-1;t>=0;t--){if(f.MonsterBookModel.getIns().checkBookReddotByMonid(this.monids[t])>=0){game.RedDotView.addTo(this.btnLeft);break}}}this.listfanye.refresh();var e=this.monids[this.monIndex];var i=csv.MonsterBookProxy.getIns().getCfg(e);var n=game.ItemUtil.parserList(i.reward)[0];this.daoju.img.skin=n.getIconUrl();this.daoju.shuzi.text=n.count+"";this.labelmiaoshu.text=app.getLang(i.mondesc);this.imgmingzi.skin="res/static/shanhaixiangyaolu/name_"+e+".png";this.imgdituming.text=app.getLang(this.dataSource[0].chaptername);var a=csv.MonsterProxy.getIns().getCfg(e);var o=guaji.GuajiModel.getIns().isActive(i.condition);this.imgyilingqu.visible=false;this.stopAni(this.bossjiesuo);this.stopAni(this.huanrao);this.jiesuolab.text="";this.jiesuodi.visible=false;if(o){var s=f.MonsterBookModel.getIns().isGetted(e);if(s){this.imgyilingqu.visible=true}else{this.playAni(this.huanrao,true)}var r=f.MonsterBookModel.getIns().midnew.indexOf(e);if(r>=0){this.playAni(this.bossjiesuo,false);f.MonsterBookModel.getIns().midnew.splice(r,1);app.SoundManager.getIns().playSound("xiangyaojihuo")}this.avatarData.roleKey=a.res;this.avatar.setAniData(this.avatarData);var l=i.bonetimes?i.bonetimes/100:1;this.avatar.scale(l,l);this.avatar.setAni(avatar.AvatarAnimation.ANI_ENUMS.IDLE,0);this.avatar.play();this.avatar.visible=true;this.imgboss.visible=false}else{var h=csv.GuajiProxy.getIns().getCfgGuanqia(i.condition);var p=csv.GuajiProxy.getIns().getPart(h.id);this.jiesuolab.text=app.getLang("xiangyaolu_desc02",h.chapter,p.index);this.jiesuodi.visible=true;this.imgboss.skin="res/static/shanhaixiangyaolu/bg_"+e+".png";var l=i.cardtimes?i.cardtimes/100:1;this.imgboss.scale(l,l);this.avatar.stop();this.avatar.visible=false;this.imgboss.visible=true}var u=app.str2Array(a.skillid,";");var c=[];if(a.attackid>0){c.push(a.attackid)}for(var t=0;t<u.length;t++){var g=parseInt(u[t]);if(g>0){c.push(g)}}this.listjinneg.selectedIndex=0;this.listjinneg.array=c};t.prototype.onDisplay=function(){game.Context.event(game.ContextEvent.FUNCTION_OPEN);f.MonsterBookModel.getIns().on(f.MonsterBookModel.BOOKMONSTER_AWARD_GETTED,this,this.onAwardGetted);this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){game.Context.event(game.ContextEvent.FUNCTION_CLOSE);f.MonsterBookModel.getIns().off(f.MonsterBookModel.BOOKMONSTER_AWARD_GETTED,this,this.onAwardGetted);this.avatar.stop();this.stopAni(this.huanrao);this.stopAni(this.bossjiesuo)};t.prototype.onAwardGetted=function(){this.imgyilingqu.visible=true;this.stopAni(this.huanrao);f.MonsterBookMapView.getIns().onAwardGetted(this.dataSource[1])};t.prototype.playAni=function(t,e){t.play(0,e);t.visible=true};t.prototype.stopAni=function(t){t.stop();t.visible=false};t.prototype.refreshAll=function(){this.monids=[];this.monIndex=0;var t=app.str2Array(this.dataSource[0].mondesc,";");for(var e=0;e<t.length;e++){this.monids.push(parseInt(t[e]))}for(var e=0;e<this.monids.length;e++){if(f.MonsterBookModel.getIns().checkBookReddotByMonid(this.monids[e])>=0){this.monIndex=e;break}}this.centerLayout.array=this.monids;this.btnLeft.visible=true;this.btnRight.visible=true;if(this.monIndex==0){this.btnLeft.visible=false}else if(this.monIndex==this.monids.length-1){this.btnRight.visible=false}this.updateView()};t.prototype.onItemSelected=function(t,e){if(this.selectedItem){this.selectedItem.xuanzhong.visible=false}this.selectedItem=t;this.selectedItem.xuanzhong.visible=true;var i=csv.SkillProxy.getIns().getSkillByKey(e+"-1");if(i){this.labeljinengmingzi.text=i.name}this.labeljinnegmiaoshu.text=csv.SkillProxy.getSkillDes(e,1)};t.SINGLE_KEY="book.MonsterInfoView";return t}(ui.shanhaixiangyaolu.yaoguaitujianiviewgaiUI);f.MonsterInfoView=t})(book||(book={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var monthCard;(function(a){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){app.ViewManager.regist(a.MonthCardMainViewNew,"yuekazhouka.atlas");this._model=a.MonthCardModel.getIns()};e.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.MonthCardInfoAck,this,this.MonthCardInfoAck);this.addMsgListener(app.ProtocolResponse.MonthCardGetRewardAck,this,this.MonthCardGetRewardAck);this._model.on(a.MonthCardModel.MONTH_CARD_CHANGE,this,this.onRedDotChange)};e.prototype.MonthCardInfoAck=function(t,e){if(e.monthCardList&&e.monthCardList.length>0){for(var i=0;i<e.monthCardList.length;i++){var n=e.monthCardList[i];if(n.monthcard_id==this._model.topCardData.monthcard_id){this._model.topCardData=n}else if(n.monthcard_id==this._model.lowCardData.monthcard_id){this._model.lowCardData=n}}}this._model.event(a.MonthCardModel.MONTH_CARD_CHANGE);huodong.WeekMonthForeverModel.getIns().updateRedActs()};e.prototype.MonthCardGetRewardAck=function(t,e){if(e.result==0){}else{}};e.prototype.onRedDotChange=function(){Laya.timer.callLater(this,this.onUpdateRedDot)};e.prototype.onUpdateRedDot=function(){huodong.HuoDongShangChengModel.getIns().event(huodong.HuoDongEvent.EVENT_RED_CHECK)};e.SINGLE_KEY="monthCard.MonthCardModule";return e}(app.ModuleBase);a.MonthCardModule=t})(monthCard||(monthCard={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var monthCard;(function(t){var s;(function(t){t[t["NOT_TO_BUY"]=1]="NOT_TO_BUY";t[t["BUYED"]=2]="BUYED";t[t["GETTED"]=3]="GETTED"})(s=t.CardState||(t.CardState={}));var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){this.topCardData={monthcard_id:1,availbleCount:0,rechare_point:Uint64.fromNumber(0),active_time:Uint64.fromNumber(0),special_reward:0};this.lowCardData={monthcard_id:2,availbleCount:0,rechare_point:Uint64.fromNumber(0),active_time:Uint64.fromNumber(0),special_reward:0}};e.prototype.getCardState=function(t){if(t.active_time.toNumber()==0){return s.NOT_TO_BUY}else{if(t.availbleCount==1){return s.BUYED}else{return s.GETTED}}};e.prototype.checkRedDot=function(){var t=this.getCardState(this.topCardData);var e=this.getCardState(this.lowCardData);var i=csv.MonthCardProxy.getIns().getMonthCardCell(1);var n=csv.MonthCardProxy.getIns().getMonthCardCell(2);var a=this.topCardData.rechare_point.toNumber();var o=this.lowCardData.rechare_point.toNumber();if(t==s.NOT_TO_BUY||e==s.NOT_TO_BUY){if(i.total_recharge<=a||n.total_recharge<=o){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.MONTH_CARD);return true}}if(t==s.BUYED||e==s.BUYED){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.MONTH_CARD);return true}else{game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.MONTH_CARD);return false}};e.SINGLE_KEY="monthCard.MonthCardModel";e.MONTH_CARD_CHANGE="MONTH_CARD_CHANGE";return e}(app.ModelBase);t.MonthCardModel=e})(monthCard||(monthCard={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){this.initMonthCard()};e.prototype.initMonthCard=function(){var t=app.Config.getResById("monthcard.csv");this.monthCardMap=t.getMap("id");this.monthCardArr=t.getArray()};e.prototype.getMonthCardCell=function(t){return this.monthCardMap[t]};e.prototype.getMonthCardArr=function(){return this.monthCardArr};e.SINGLE_KEY="csv.MonthCardProxy";return e}(app.ModelBase);t.MonthCardProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var monthCard;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=i.MonthCardModel.getIns()};e.prototype.onDisplay=function(){};e.prototype.onUnDisplay=function(){};e.prototype.setData=function(t,e){this.daoju.setData(t.vo);this.jiaobiao.visible=t.type};return e}(ui.xinshangcheng2.yuekaitemUI);i.MonthCardItem=t})(monthCard||(monthCard={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var monthCard;(function(o){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listdaoju.itemRender=o.MonthCardItem;this.listdaoju.renderHandler=new Laya.Handler(this,this.onCellHandler);this.listdaoju.scrollRectOffX=15;this.listdaoju.scrollRectOffY=15;this.listdaoju1.itemRender=o.MonthCardItem;this.listdaoju1.renderHandler=new Laya.Handler(this,this.onCellHandler);this.listdaoju1.scrollRectOffX=15;this.listdaoju1.scrollRectOffY=15;this._model=o.MonthCardModel.getIns();this.btntianmingchi.clickHandler=new Laya.Handler(this,this.openFateView)};e.prototype.onDisplay=function(){this.callLater(this.onGetInfo);this._model.on(o.MonthCardModel.MONTH_CARD_CHANGE,this,this.refreshAll);this.btnmonth.on(Laya.Event.CLICK,this,this.onClick);this.btnweek.on(Laya.Event.CLICK,this,this.onClick2)};e.prototype.onUnDisplay=function(){this._model.off(o.MonthCardModel.MONTH_CARD_CHANGE,this,this.refreshAll);this.btnmonth.off(Laya.Event.CLICK,this,this.onClick);this.btnweek.off(Laya.Event.CLICK,this,this.onClick2);this.setBtnEffect(this.anniutexiao,false);this.setBtnEffect(this.anniutexiao1,false)};e.prototype.onGetInfo=function(){app.ProtocolRequest.MonthCardInfoReq()};e.prototype.refreshAll=function(){game.RedDotView.removeFrom(this.btnmonth);game.RedDotView.removeFrom(this.btnweek);this.anniutexiao.visible=false;this.anniutexiao1.visible=false;this.setBtnEffect(this.anniutexiao,false);this.setBtnEffect(this.anniutexiao1,false);this._updateTopCard();this._updateLowCard()};e.prototype.onCellHandler=function(t,e){t.setData(t.dataSource,e)};e.prototype.setBtnEffect=function(t,e){if(e){t.visible=true;t.play(0,true)}else{t.visible=false;t.stop()}};e.prototype._creatArr=function(t){var e=[];var i=t.firstward.split(";");for(var n=0;n<i.length;n++){var a={vo:game.ItemUtil.parserList(i[n])[0],type:false};if(n==0){a.type=true}e.push(a)}return e};e.prototype._updateTopCard=function(){var t=this._topCost=csv.MonthCardProxy.getIns().getMonthCardCell(1);this.monthRechargeId=t.rechargeid;var e=+t.sycee;this.lingqu2.text=e+"";var i=this._model.getCardState(this._model.topCardData);var n=this._model.topCardData.rechare_point.toNumber();this.chongzhijindu2.text="当前充值："+n/100+"/"+t.total_recharge/100;this.jindu1.value=n/t.total_recharge>1?1:n/t.total_recharge;this.jindu1.visible=false;this.imgyijihuo2.visible=true;this.jindudi2.visible=false;this.chongzhijindu2.visible=false;this.boxsanshi.visible=false;this.labelhaohua.visible=true;this.btnmonth.mouseEnabled=true;this.btnmonth.gray=false;this.btnmonth.visible=true;this.imgyilingqu1.visible=false;this.labelhaohua.text="剩余有效期："+this._getLastTime(this._model.topCardData.active_time.toNumber())+"天";if(this._model.topCardData.special_reward==0||game.Context.getServerZeroTime(this._model.topCardData.special_reward)+86400>game.Context.getServerTime()){this.imgtishi2.skin="res/static/xinshangcheng2/bg_tishi2.png";this.listdaoju.array=this._creatArr(t);this.listdaoju.x=10}else{this.listdaoju.x=50;this.imgtishi2.skin="res/static/xinshangcheng2/bg_tishi3.png";var a=t.reward.split(";");this.listdaoju.array=[{vo:game.ItemUtil.parserList(a[0])[0],type:false},{vo:game.ItemUtil.parserList(a[1])[0],type:false}]}if(i==o.CardState.NOT_TO_BUY){this.boxsanshi.visible=true;this.labelhaohua.visible=false;this.jindu1.visible=true;this.imgyijihuo2.visible=false;this.jindudi2.visible=true;this.chongzhijindu2.visible=true;if(n>=t.total_recharge){this.btnmonth.label="激活";this.anniutexiao.visible=true;this.anniutexiao.play();game.RedDotView.addTo(this.btnmonth)}else{this.btnmonth.label=app.getLang("qianwangchongzhi");this.setBtnEffect(this.anniutexiao,true)}}else if(i==o.CardState.BUYED){game.RedDotView.addTo(this.btnmonth);this.btnmonth.label="领取"}else{this.btnmonth.visible=false;this.imgyilingqu1.visible=true}};e.prototype._updateLowCard=function(){var t=this._lowCost=csv.MonthCardProxy.getIns().getMonthCardCell(2);this.weekRechargeId=t.rechargeid;var e=+t.sycee;this.lingqu4.text=e+"";var i=this._model.getCardState(this._model.lowCardData);var n=this._model.lowCardData.rechare_point.toNumber();this.chongzhijindu1.text="当前充值："+n/100+"/"+t.total_recharge/100;this.jindu2.value=n/t.total_recharge>1?1:n/t.total_recharge;this.jindu2.visible=false;this.imgyijihuo.visible=true;this.jindudi1.visible=false;this.chongzhijindu1.visible=false;this.boxjiushiba.visible=false;this.labelzhizun.visible=true;this.btnweek.mouseEnabled=true;this.btnweek.gray=false;this.btnweek.visible=true;this.imgyilingqu2.visible=false;this.labelzhizun.text="剩余有效期："+this._getLastTime(this._model.lowCardData.active_time.toNumber())+"天";if(this._model.lowCardData.special_reward==0||game.Context.getServerZeroTime(this._model.lowCardData.special_reward)+86400>game.Context.getServerTime()){this.imgtishi1.skin="res/static/xinshangcheng2/bg_tishi2.png";this.listdaoju1.array=this._creatArr(t);this.listdaoju1.x=0}else{this.listdaoju1.x=50;this.imgtishi1.skin="res/static/xinshangcheng2/bg_tishi3.png";var a=t.reward.split(";");this.listdaoju1.array=[{vo:game.ItemUtil.parserList(a[0])[0],type:false},{vo:game.ItemUtil.parserList(a[1])[0],type:false}]}if(i==o.CardState.NOT_TO_BUY){this.boxjiushiba.visible=true;this.labelzhizun.visible=false;this.jindu2.visible=true;this.jindudi1.visible=true;this.chongzhijindu1.visible=true;this.imgyijihuo.visible=false;if(n>=t.total_recharge){this.btnweek.label="激活";this.anniutexiao1.visible=true;this.anniutexiao1.play();game.RedDotView.addTo(this.btnweek)}else{this.btnweek.label=app.getLang("qianwangchongzhi");this.setBtnEffect(this.anniutexiao1,true)}}else if(i==o.CardState.BUYED){game.RedDotView.addTo(this.btnweek);this.btnweek.label="领取"}else{this.btnweek.visible=false;this.imgyilingqu2.visible=true}};e.prototype._getLastTime=function(t){var e=game.Context.getServerZeroTime(t);var i=30-Math.floor((game.Context.getServerTime()-e)/3600/24)-1;return i<0?0:i};e.prototype.openFateView=function(){game.ClosureManager.callFunction(csv.FunctionsProxy.ENUMS.FATE_POOL)};e.prototype.onClick=function(){var t=this._model.getCardState(this._model.topCardData);if(t==o.CardState.BUYED){app.ProtocolRequest.MonthCardGetRewardReq(2,this._topCost.id)}else if(t==o.CardState.NOT_TO_BUY){var e=this._model.topCardData.rechare_point.toNumber();if(e>=this._topCost.total_recharge){app.ProtocolRequest.MonthCardGetRewardReq(1,this._topCost.id)}else{game.ClosureManager.callFunction(csv.FunctionsProxy.ENUMS.CHONGZHI_SHOP)}}};e.prototype.onClick2=function(){var t=this._model.getCardState(this._model.lowCardData);if(t==o.CardState.BUYED){app.ProtocolRequest.MonthCardGetRewardReq(2,this._lowCost.id)}else if(t==o.CardState.NOT_TO_BUY){var e=this._model.lowCardData.rechare_point.toNumber();if(e>=this._lowCost.total_recharge){app.ProtocolRequest.MonthCardGetRewardReq(1,this._lowCost.id)}else{game.ClosureManager.callFunction(csv.FunctionsProxy.ENUMS.CHONGZHI_SHOP)}}};e.SINGLE_KEY="monthCard.MonthCardMainViewNew";return e}(ui.xinshangcheng2.yuekaviewUI);o.MonthCardMainViewNew=t})(monthCard||(monthCard={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var mount;(function(o){var t=function(t){__extends(e,t);function e(){return t.call(this)||this}e.prototype.init=function(){app.ViewManager.regist(o.MountTabView,"zuoqi.atlas");game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.MOUNT,o.MountTabView,new Laya.Handler(this,this.goMountView,[csv.FunctionsProxy.ENUMS.MOUNT]));game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.MOUNT_HORSE,o.MountTabView,new Laya.Handler(this,this.goMountView,[csv.FunctionsProxy.ENUMS.MOUNT_HORSE]));game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.HORSE_HAND_BOOK,o.MountTabView,new Laya.Handler(this,this.goMountView,[csv.FunctionsProxy.ENUMS.HORSE_HAND_BOOK]));game.FuncDotAdapter.registRedFunc(csv.FunctionsProxy.ENUMS.MOUNT,o.MountModel.getIns(),o.MountModel.getIns().showRedTip);game.FuncDotAdapter.registRedFunc(csv.FunctionsProxy.ENUMS.MOUNT_HORSE,o.MountModel.getIns(),o.MountModel.getIns().showRedTip);csv.FunctionsProxy.getIns().on(csv.FunctionsProxy.EVENTS.ADD,this,this.checkOpen)};e.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.HorseListNtf,this,this.onHorseListNtf);this.addMsgListener(app.ProtocolResponse.ActHorseAck,this,this.onActHorseAck);this.addMsgListener(app.ProtocolResponse.RideHorseAck,this,this.onRideHorseAck);this.addMsgListener(app.ProtocolResponse.RideLvAck,this,this.onRideLvAck);this.addMsgListener(app.ProtocolResponse.HorseLvAck,this,this.onHorseLvAck);this.addMsgListener(app.ProtocolResponse.HorseComNtf,this,this.onHorseComNtf);this.addMsgListener(app.ProtocolResponse.AddHorseComNtf,this,this.onAddHorseComNtf);this.addMsgListener(app.ProtocolResponse.ActNewHorseComNtf,this,this.onActNewHorseComNtf);this.addMsgListener(app.ProtocolResponse.UseHorseSkillAck,this,this.onUseHorseSkillAck)};e.prototype.checkOpen=function(t){if(t.id==csv.FunctionsProxy.ENUMS.MOUNT){app.ProtocolRequest.ActLimitedBuyTriggerRpt(xianshimiaosha.LimitedBuytEventType.kLimitedBuytEventTypeHorse)}};e.prototype.onUseHorseSkillAck=function(t,e){if(e.result){o.MountModel.getIns().usehorseskill=e.usehorseskill;o.MountModel.getIns().event(o.MountEvent.EVENT.SKLL_MOUNT_CHANGE)}};e.prototype.onActNewHorseComNtf=function(t,e){o.MountModel.getIns().acom=e.acom;o.MountModel.getIns().reddotDict[e.acom]=true;o.MountModel.getIns().showRedTip()};e.prototype.onAddHorseComNtf=function(t,e){o.MountModel.getIns().onAddHorseComNtf(e.ahorse[0]);o.MountModel.getIns().event(o.MountEvent.EVENT.AHORSE_MOUNT_CHANGE)};e.prototype.onHorseComNtf=function(t,e){o.MountModel.getIns().ahorse=e.ahorse;o.MountModel.getIns().event(o.MountEvent.EVENT.AHORSE_MOUNT_CHANGE)};e.prototype.onHorseLvAck=function(t,e){if(e.result){var i=o.MountModel.getIns().getHorseData(e.horseid);if(i){i.horselv=e.horselv}o.MountModel.getIns().event(o.MountEvent.EVENT.LEVEL_MOUNT_CHANGE)}};e.prototype.onHorseListNtf=function(t,e){o.MountModel.getIns().acthorseArr=e.acthorse;o.MountModel.getIns().usehorse=e.usehorse;game.Context.mainRole.zuoqiId=e.usehorse;o.MountModel.getIns().rideid=e.rideid;o.MountModel.getIns().usehorseskill=e.usehorseskill;o.MountModel.getIns().event(o.MountEvent.EVENT.USE_MOUNT_CHANGE);o.MountModel.getIns().event(o.MountEvent.EVENT.QISHU_ID_CHANGE)};e.prototype.onActHorseAck=function(t,e){if(e.result==1){var i=o.MountModel.getIns().getHorseData(e.horseid);if(i){i.horselv=e.horselv}else{i=new ActHorse;i.acthorse=e.horseid;i.horselv=e.horselv;o.MountModel.getIns().acthorseArr.push(i)}o.MountModel.getIns().event(o.MountEvent.EVENT.ACTIVITY_MOUNT_CHANGE);app.ProtocolRequest.RideHorseReq(e.horseid);var n={x:Laya.stage.width*.5,y:Laya.stage.height*.5};var a=new avatar.AvatarData;a.mountKey=csv.HorseattrProxy.getIns().getCfg(e.horseid).horseres;app.ViewManager.toggleDialog(game.JiHuoSuccessView,1,0,[game.Config.ENUM_TYPE.AVATAR,a,n.x,n.y-200,null,null,null,null,new Laya.Handler(this,this.showTujian,[e.horseid])])}};e.prototype.showTujian=function(t){if(o.MountModel.getIns().acom>0){app.ViewManager.toggleDialog(o.MountTujianActiveView,1,0)}};e.prototype.onRideHorseAck=function(t,e){if(e.result==1){o.MountModel.getIns().usehorse=e.horseid;game.Context.mainRole.zuoqiId=e.horseid;o.MountModel.getIns().event(o.MountEvent.EVENT.USE_MOUNT_CHANGE)}};e.prototype.onRideLvAck=function(t,e){if(e.result==1){o.MountModel.getIns().rideid=e.rideid;o.MountModel.getIns().event(o.MountEvent.EVENT.QISHU_ID_CHANGE)}};e.prototype.goMountView=function(t){game.ClosureManager.callFunction(t,true,true)};e.SINGLE_KEY="mount.MountModule";return e}(app.ModuleBase);o.MountModule=t})(mount||(mount={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var mount;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.animationshengxing.stop();this.animationshengxing.visible=false;this.animationshengxing.on(Laya.Event.COMPLETE,this,this.onAniComplete);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.updateLayout)};e.prototype.onUnDisplay=function(){this.animationshengxing.stop();this.animationshengxing.visible=false};e.prototype.onAniComplete=function(){this.animationshengxing.stop();this.animationshengxing.visible=false};e.prototype.playAni=function(){this.animationshengxing.visible=true;this.animationshengxing.play()};e.prototype.updateLayout=function(){};e.SINGLE_KEY="mount.MountHorseCell";return e}(ui.zuoqi.qishujingtongitemUI);t.MountHorseCell=e})(mount||(mount={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var mount;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.updateLayout)};e.prototype.onUnDisplay=function(){};e.prototype.updateLayout=function(){};e.prototype.setData=function(t){if(!t){return}this.txtName.text=app.getLang("title_tips1")+Attributes.getPropName(t.data.propId);this.txtValue.text="+"+Attributes.getPropValue(t.data.propId,t.data.value,t.data.formula);if(t.nextData&&parseInt(t.nextData.value)-parseInt(t.data.value)>0){this.imgArrow.visible=true;this.txtNext.text="+"+Attributes.getPropValue(t.nextData.propId,t.nextData.value,t.nextData.formula)}else{this.imgArrow.visible=false;this.txtNext.text=""}this.reSetSize();this.cellWidth=this.txtNext.x+this.txtNext.textField.textWidth};e.SINGLE_KEY="mount.MountHorseCell01";return e}(game.ComAttrItem0);t.MountHorseCell01=e})(mount||(mount={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var mount;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.updateLayout)};e.prototype.onUnDisplay=function(){};e.prototype.updateLayout=function(){};e.prototype.setData=function(t){if(!t){return}this.jinengname.text=app.getLang("title_tips1")+Attributes.getPropName(t.propId);this.lblNext.text="+"+Attributes.getPropValue(t.propId,t.value,t.formula)};e.SINGLE_KEY="mount.MountHorseCell02";return e}(ui.zuoqi.qishujingtongitem03UI);t.MountHorseCell02=e})(mount||(mount={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var mount;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.updateLayout)};e.prototype.onUnDisplay=function(){};e.prototype.updateLayout=function(){};e.prototype.setData=function(t){if(!t){return}this.txtName.text=app.getLang("zuoqi_13")+Attributes.getPropName(t.data.propId);this.txtValue.text="+"+Attributes.getPropValue(t.data.propId,t.data.value,t.data.formula);if(t.nextData&&parseInt(t.nextData.value)-parseInt(t.data.value)>0){this.imgArrow.visible=true;this.txtNext.text="+"+Attributes.getPropValue(t.nextData.propId,t.nextData.value,t.nextData.formula)}else{this.imgArrow.visible=false;this.txtNext.text=""}this.reSetSize();this.cellWidth=this.txtNext.x+this.txtNext.textField.textWidth};e.SINGLE_KEY="mount.MountHorseCell03";return e}(game.ComAttrItem0);t.MountHorseCell03=e})(mount||(mount={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var mount;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.xuanzhong.visible=false;this.beidongimg.visible=false;this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.updateLayout)};e.prototype.onUnDisplay=function(){};e.prototype.updateLayout=function(){};e.prototype.setData=function(t,e){if(!t){return}this._data=t;this.labelname.text=t.skillObj.name;this.setSkillInfo(this.viewjineng,t.skillObj,t.skillObj.level);this.viewjineng.gray=!t.isAct;this.beidongimg.gray=this.viewjineng.gray;this.beidongimg.visible=false;this.setSelect(e)};e.prototype.setSelect=function(t){this.xuanzhong.visible=t;this._data.boSelect=t};e.prototype.setSkillInfo=function(t,e,i){t.shuzi.text=i>0?app.getLang("zuoqi_11")+i:"";t.img.skin=csv.SkillProxy.getIns().getSkillIcon(e.icon);if(e.typeicon){t.jiaobiao.skin="public/bg_jinengbiaoqian_"+e.typeicon+".png"}else{t.jiaobiao.skin=""}t.starMediator.value=0};e.SINGLE_KEY="mount.MountSkillCell";return e}(ui.zuoqi.zuoqijinengitemUI);t.MountSkillCell=e})(mount||(mount={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var mount;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.on(Laya.Event.CLICK,this,this.onClick)};e.prototype.onClick=function(){var t=new SkillData;t.id=parseInt(this.dataSource.skillid);t.lv=1;tip.TipManager.showSkill(t)};e.prototype.onDisplay=function(){this.callLater(this.updateLayout)};e.prototype.onUnDisplay=function(){};e.prototype.updateLayout=function(){};e.prototype.setData=function(t){if(!t){return}csv.SkillProxy.getIns().setSkillInfo(this,t,false)};e.SINGLE_KEY="mount.MountSkillCell01";return e}(ui.jineng.jinengitem2UI);t.MountSkillCell01=e})(mount||(mount={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var mount;(function(n){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.imglock.visible=false;this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.updateLayout)};e.prototype.onUnDisplay=function(){};e.prototype.updateLayout=function(){};e.prototype.setData=function(t){if(!t){return}this.labelname.text=app.getLang(t.name);if(n.MountModel.getIns().isQiChen(parseInt(t.id))){this.imgqichengzhong.visible=true}else{this.imgqichengzhong.visible=false}this.imgtouxiang.skin="zuoqi/"+t.horseicon+".png";game.RedDotView.removeFrom(this);if(n.MountModel.getIns().isAct(parseInt(t.id))){this.box.gray=false;var e=n.MountModel.getIns().getHorseData(t.id);var i=csv.HorseattrProxy.getIns().getSkillByLevel(t.id,e.horselv+1);if(i){if(game.GridsModel.getIns().hasEnoughItems(i.cost)){game.RedDotView.addTo(this,121,7)}}}else{this.box.gray=true;if(game.GridsModel.getIns().hasEnoughItems(t.cost)){game.RedDotView.addTo(this,121,7)}}};e.SINGLE_KEY="mount.MountViewCell";return e}(ui.zuoqi.zuoqiitem01UI);n.MountViewCell=t})(mount||(mount={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){this.cfgAllSkillArr=[];var t=app.Config.getResById("horseattr.csv");this.cfgMap=t.getMap("id");this._cfgArr=t.getArray();this._cfgTuJianArr=app.Config.getResById("horsecombination.csv").getArray();var e=app.Config.getResById("horse_update.csv");this._cfgSkillMap=e.getMapList("horseid");this._skillOwner={};for(var i=0;i<this._cfgArr.length;i++){var n=this._cfgArr[i];var a=app.str2Array(n.horseskill,"-")[0];this._skillOwner[a]=n;this.cfgAllSkillArr.push(this._cfgSkillMap[n.id][0])}};e.prototype.getSkillOwner=function(t){return this._skillOwner[t]};e.prototype.getTujian=function(){return this._cfgTuJianArr};e.prototype.getTujianById=function(t){for(var e=0;e<this._cfgTuJianArr.length;e++){if(this._cfgTuJianArr[e].id==t){return this._cfgTuJianArr[e]}}return null};e.prototype.getCfg=function(t){return this.cfgMap[t]};e.prototype.getCfgArr=function(){return this._cfgArr};e.prototype.getSkill=function(t){return this._cfgSkillMap[t][0].horseskill};e.prototype.getSkillByLevel=function(t,e){return this._cfgSkillMap[t][e-1]};e.prototype.getSkillMaxLevel=function(t){return this._cfgSkillMap[t].length};e.prototype.getHorseIdByCost=function(t){for(var e=0,i=this._cfgArr.length;e<i;e++){var n=this._cfgArr[e];if(parseInt(app.str2Array(n.cost,"-")[0])==t){return n.id}}return 0};e.SINGLE_KEY="csv.HorseattrProxy";return e}(app.ModelBase);t.HorseattrProxy=e})(csv||(csv={}));var mount;(function(t){var e=function(){function t(){}t.EVENT={ACTIVITY_MOUNT_CHANGE:"ACTIVITY_MOUNT_CHANGE",USE_MOUNT_CHANGE:"USE_MOUNT_CHANGE",QISHU_ID_CHANGE:"QISHU_ID_CHANGE",LEVEL_MOUNT_CHANGE:"LEVEL_MOUNT_CHANGE",SKLL_MOUNT_CHANGE:"SKLL_MOUNT_CHANGE",AHORSE_MOUNT_CHANGE:"AHORSE_MOUNT_CHANGE"};return t}();t.MountEvent=e})(mount||(mount={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var mount;(function(f){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.acom=0;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.init=function(){this.acthorseArr=[];this.usehorseskill=[];this.reddotDict={}};t.prototype.cleanTujianReddot=function(){var t=Object.keys(this.reddotDict);for(var e=0;e<t.length;e++){this.reddotDict[parseInt(t[e])]=false}};t.prototype.showRedTip=function(t){if(t===void 0){t=true}var e=[false,false,false,false];game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.MOUNT);if(csv.FunctionsProxy.getIns().isOpen(csv.FunctionsProxy.ENUMS.MOUNT)){e[0]=this.showZuoqiUprape();e[1]=this.showSkillRedTip()}if(csv.FunctionsProxy.getIns().isOpen(csv.FunctionsProxy.ENUMS.MOUNT_HORSE)){e[2]=this.showQiShuRedTip()}if(t){var i=Object.keys(this.reddotDict);for(var n=0;n<i.length;n++){if(this.reddotDict[parseInt(i[n])]){e[3]=true;break}}}for(var n=0;n<e.length;n++){if(e[n]){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.MOUNT);break}}return e};t.prototype.showSkillRedTip=function(){var t=false;var e=[];for(var i=0;i<csv.HorseattrProxy.getIns().cfgAllSkillArr.length;i++){var n=csv.HorseattrProxy.getIns().cfgAllSkillArr[i].horseid;var a=void 0;var o=f.MountModel.getIns().getHorseData(n);if(o&&o.horselv>0){var s=csv.HorseattrProxy.getIns().getSkillByLevel(n,o.horselv).horseskill;a=csv.SkillProxy.getIns().getSkillByKey(s)}else if(o){var s=csv.HorseattrProxy.getIns().getCfg(n).horseskill;a=csv.SkillProxy.getIns().getSkillByKey(s)}var r=false;if(a){for(var l=0,h=this.usehorseskill;l<h.length;l++){var p=h[l];if(p.skillid===a.skillid){r=true;break}}if(!r){e.push(a.skillid)}}}if(e.length>0){var u=0;for(var i=0;i<4;i++){var c=parseInt(game.Config.getParams(i+901));var g=csv.RideattrProxy.getIns().getCfg(f.MountModel.getIns().rideid);if(g.order>=c){u++}}t=u-this.usehorseskill.length>0}return t};t.prototype.showZuoqiUprape=function(){var t=false;var e=csv.HorseattrProxy.getIns().getCfgArr();for(var i=0;i<e.length;i++){if(!this.isAct(parseInt(e[i].id))){if(game.GridsModel.getIns().hasEnoughItems(e[i].cost)){t=true;break}}else{var n=this.getHorseData(e[i].id);var a=csv.HorseattrProxy.getIns().getSkillByLevel(e[i].id,n.horselv+1);if(a){if(game.GridsModel.getIns().hasEnoughItems(a.cost)){t=true;break}}}}return t};t.prototype.showQiShuRedTip=function(){var t=false;var e=csv.RideattrProxy.getIns().getCfg(this.rideid);if(e){var i=csv.RideattrProxy.getIns().getNextCfg(f.MountModel.getIns().rideid);if(i&&game.GridsModel.getIns().hasEnoughItems(e.cost)){t=true}}return t};t.prototype.onAddHorseComNtf=function(t){var e=false;for(var i=0,n=this.ahorse;i<n.length;i++){var a=n[i];if(a.actId==t.actId){a.cond=t.cond;e=true;break}}if(!e){this.ahorse.push(t)}};t.prototype.getUseSkillByPos=function(t){for(var e=0,i=this.usehorseskill;e<i.length;e++){var n=i[e];if(n.skillpos==t){return n}}return null};t.prototype.isAct=function(t){for(var e=0,i=f.MountModel.getIns().acthorseArr;e<i.length;e++){var n=i[e];if(n.acthorse==t){return true}}return false};t.prototype.getHorseData=function(t){for(var e=0,i=f.MountModel.getIns().acthorseArr;e<i.length;e++){var n=i[e];if(n.acthorse==t){return n}}return null};t.prototype.getAhoresData=function(t){for(var e=0,i=this.ahorse;e<i.length;e++){var n=i[e];if(n.actId==t){return n.cond}}return[]};t.prototype.isQiChen=function(t){if(t==this.usehorse){return true}else{return false}};t.SINGLE_KEY="mount.MountModel";return t}(app.ModelBase);f.MountModel=t})(mount||(mount={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("rideattr.csv");this.cfgMap=t.getMap("id")};e.prototype.getCfg=function(t){return this.cfgMap[t]};e.prototype.getNextCfg=function(t){return this.cfgMap[parseInt(t)+1]};e.prototype.getPropValue=function(t){var e=[];if(t!=""){var i=app.str2Array(t,";","-");for(var n=0,a=i.length;n<a;n++){var o=i[n];var s=new PropValue;s.propId=parseInt(o[0]);s.value=parseInt(o[1]);s.formula=1;s.flag=0;e.push(s)}}return e};e.SINGLE_KEY="csv.RideattrProxy";return e}(app.ModelBase);t.RideattrProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var mount;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.lbls=[]};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){for(var t=0;t<this.lbls.length;t++){Laya.Pool.recover("TipRichText",this.lbls[t]);this.lbls[t].removeSelf()}};e.prototype.refreshAll=function(){var t=game.Config.getIntParams(900);var e={};for(var i=0;i<t;i++){e[game.Config.getIntParams(i+901)]=[app.getLang("mijing_explain8",i+1)]}var n=csv.GuajiProxy.getIns().getMijingArray();var a=[];for(var i=0;i<n.length;i++){var o=this.getCfg(n[i].increase);if(o){a=e[o.increase];if(!a){a=[];e[o.increase]=a}a.push(app.getLang("mijing_explain7",app.getLang(n[i].name),o.value*.01))}}var s=Object.keys(e),r=5;for(var i=0;i<s.length;i++){var o=csv.RideattrProxy.getIns().getCfg(s[i]);if(o){var l=void 0;if(o.level>1){l=tip.TipManager.createRichDescLabel(app.getLang("mijing_explain20",o.order,o.level),game.STYLES.DESC_TXT_COLOR,20,"left",false,this.listshuxing.width)}else{l=tip.TipManager.createRichDescLabel(app.getLang("mijing_explain6",o.order),game.STYLES.DESC_TXT_COLOR,20,"left",false,this.listshuxing.width)}l.x=0;l.y=r;this.listshuxing.addChild(l);r+=l.height+5;var h=e[s[i]];for(var p=0;p<h.length;p++){l=tip.TipManager.createRichDescLabel(h[p],game.STYLES.DESC_TXT_COLOR,20,"left",false,this.listshuxing.width);l.x=20;l.y=r;this.listshuxing.addChild(l);r+=l.height+5}}}};e.prototype.getCfg=function(t){var e;if(t&&t.length>0){var i=app.str2Array(t,"-");for(var n=0;n<i.length;n++){if(csv.GuajiProxy.getIns().getcreaseCfgMap(parseInt(i[n])).type==6){e=csv.GuajiProxy.getIns().getcreaseCfgMap(parseInt(i[n]));break}}}return e};e.SINGLE_KEY="mount.MountAddEffectTipsView";return e}(ui.zuoqi.shengjiexiaoguotipsUI);t.MountAddEffectTipsView=e})(mount||(mount={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var mount;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.list.itemRender=i.TujianItem;this.list.renderHandler=new Laya.Handler(this,this.onRenderHandler)};e.prototype.onRenderHandler=function(t){t.setData(t.dataSource)};e.prototype.onDisplay=function(){i.MountModel.getIns().on(i.MountEvent.EVENT.AHORSE_MOUNT_CHANGE,this,this.refreshAll);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){i.MountModel.getIns().off(i.MountEvent.EVENT.AHORSE_MOUNT_CHANGE,this,this.refreshAll);i.MountModel.getIns().cleanTujianReddot()};e.prototype.refreshAll=function(){var t=csv.HorseattrProxy.getIns().getTujian();this.list.array=t};e.SINGLE_KEY="mount.MountGuideView";return e}(ui.zuoqi.zuoqitujianUI);i.MountGuideView=t})(mount||(mount={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var mount;(function(m){var t=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.yimanji.visible=false;this.listqishu.itemRender=m.MountHorseCell01;this.listqishu.renderHandler=new Laya.Handler(this,this.onQiShuRender);this.listpinjie.itemRender=m.MountHorseCell03;this.listpinjie.renderHandler=new Laya.Handler(this,this.onPinJieRender);this.btnshengxing.clickHandler=new Laya.Handler(this,this.onBtnshengxingClick);this.animationshengxing.stop();this.animationshengxing.visible=false;this.animationshengxing.on(Laya.Event.COMPLETE,this,this.onAniComplete);this._starArr=[];for(var t=1;t<11;t++){this._starArr.push(this["animationshengxing"+t])}this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);guide.GuideModel.getIns().register(csv.GuideProxy.ENUM_VIEW.RIDE,this.btnshengxing);this.btnTips.clickHandler=new Laya.Handler(this,this.onShowtips)};t.prototype.onShowtips=function(){app.ViewManager.toggleDialog(m.MountAddEffectTipsView,1,0)};t.prototype.onDisplay=function(){m.MountModel.getIns().on(m.MountEvent.EVENT.QISHU_ID_CHANGE,this,this.onQiShuChange);this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){m.MountModel.getIns().off(m.MountEvent.EVENT.QISHU_ID_CHANGE,this,this.onQiShuChange);this.animationshengxing.stop();this.animationshengxing.visible=false;Laya.Tween.clearAll(this.imgzuoqiqishu)};t.prototype.onBtnshengxingClick=function(){if(this._data){var t=game.ItemUtil.parserList(this._data.cost);for(var e=0;e<t.length;e++){if(!game.GridsModel.getIns().hasEnoughItems(t[e],false,true,true)){return}}app.ProtocolRequest.RideLvReq()}};t.prototype.onQiShuChange=function(){this.animationshengxing.visible=true;this.animationshengxing.play();var t=csv.RideattrProxy.getIns().getCfg(m.MountModel.getIns().rideid);if(parseInt(t.level)>0){this._starArr[parseInt(t.level)-1].playAni()}Laya.Tween.clearAll(this.imgzuoqiqishu);this.callLater(this.refreshAll)};t.prototype.onAniComplete=function(){this.animationshengxing.stop();this.animationshengxing.visible=false};t.prototype.onQiShuRender=function(t){t.setData(t.dataSource);this.qishuListW=t.getWidth()};t.prototype.onPinJieRender=function(t){t.setData(t.dataSource);this.pinJieListW=t.getWidth()};t.prototype.setMax=function(t){this.boxshengxingxiaohao.visible=!t;this.yimanji.visible=t};t.prototype.refreshAll=function(){this.imgzuoqiqishu.y=146;this.imgTween1();this._data=csv.RideattrProxy.getIns().getCfg(m.MountModel.getIns().rideid);if(!this._data){return}var t=csv.RideattrProxy.getIns().getNextCfg(m.MountModel.getIns().rideid);game.RedDotView.removeFrom(this.btnshengxing);game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.MOUNT_HORSE);this.imgzuoqiqishu.skin="res/static/zuoqi/"+this._data.rideres+".png";this.imgjieshu.skin="zuoqi/bg_zuoqi_jieshu"+this._data.order+".png";var e=[];var i=Attributes.decode(this._data.levelattr);var n;for(n=0;n<i.baseList.length;n++){var a={};a.data=i.baseList[n];if(t){var o=Attributes.decode(t.levelattr);a.nextData=o.baseList[n]}else{a.nextData=null}e.push(a)}this.listqishu.array=e;this.listqishu.x=(this.boxqishu.width-this.qishuListW)*.5;var s=csv.RideattrProxy.getIns().getPropValue(this._data.orderattr);var r=csv.RideattrProxy.getIns().getPropValue(this._data.horseorderattr);var l=s.concat(r);l=Attributes.hebingAttributes(l);var h=[];for(var p=0,u=l.length;p<u;p++){var a={};a.data=l[p];h.push(a)}this.setMax(false);if(t){var c=game.ItemUtil.parserList(this._data.cost);this.itemdaoju.gezi.setData(c[0]);this.icommoney.parserIconByItemId(c[1].getItemId());game.ItemShowUtil.showType5(c[0],this.itemdaoju.gezi,this.itemdaoju.shuzhi);game.ItemShowUtil.showType4(this.shuliangtxt,c[1].count,game.GridsModel.getIns().getItemCount(c[1].getItemId()));var g=(this.hbox.width-(this.shuliangtxt.contextWidth+36+20))*.5;this.icommoney.x=g;this.shuliangtxt.x=this.icommoney.x+56;if(parseInt(this._data.order)!=parseInt(t.order)){this.btnshengxing.label=app.getLang("zuoqi_9");var f=csv.RideattrProxy.getIns().getPropValue(t.orderattr);var d=csv.RideattrProxy.getIns().getPropValue(t.horseorderattr);var y=f.concat(d);y=Attributes.hebingAttributes(y);for(var v=0,u=y.length;v<u;v++){var a=h[v];a.nextData=y[v]}}else{this.btnshengxing.label=app.getLang("tip_btn_33")}if(this._data){if(game.GridsModel.getIns().hasEnoughItems(this._data.cost)){game.RedDotView.addTo(this.btnshengxing);game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.MOUNT_HORSE)}}}else{this.setMax(true)}this.listpinjie.array=h;this.listpinjie.x=(this.boxpinjie.width-this.pinJieListW)*.5;var _=parseInt(this._data.level);for(n=0;n<this._starArr.length;n++){if(n<_){this._starArr[n].imgshengxing01.visible=false;this._starArr[n].imgshengxing02.visible=true}else{this._starArr[n].imgshengxing01.visible=true;this._starArr[n].imgshengxing02.visible=false}}};t.prototype.imgTween1=function(){Laya.Tween.to(this.imgzuoqiqishu,{y:146},800,null,new Laya.Handler(this,this.imgTween2))};t.prototype.imgTween2=function(){Laya.Tween.to(this.imgzuoqiqishu,{y:138},800,null,new Laya.Handler(this,this.imgTween1))};t.SINGLE_KEY="mount.MountHorseView";return t}(ui.zuoqi.zuoqiqishujingtongviewnewUI);m.MountHorseView=t})(mount||(mount={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var mount;(function(s){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.on(Laya.Event.CLICK,this,this.selectSkillHandler);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){this.off(Laya.Event.CLICK,this,this.selectSkillHandler)};e.prototype.refreshAll=function(){};e.prototype.selectSkillHandler=function(){var t=game.Config.getParams(this.skillpos+901);var e=csv.RideattrProxy.getIns().getCfg(s.MountModel.getIns().rideid);if(e.order<t){manager.FlowManager.instance.flowByStyle1(app.getLang("zuoqi_16",t));return}var i=s.MountSkillView.getIns().listjineng.selectedItem.skillObj;var n=s.MountSkillView.getIns().listjineng.selectedItem.mountId;var a=s.MountModel.getIns().isAct(n);if(!a){manager.FlowManager.instance.flowByStyle1(app.getLang("zuoqi_14"));return}app.ProtocolRequest.UseHorseSkillReq(this.skillpos+1,n,i.skillid)};e.prototype.setData=function(t,e,i,n){this.equipSkillId=n;this.skillpos=e;this.mountId=i;if(t){this.jineng.shuzi.text=app.getLang("zuoqi_11")+t.skillObj.level;this.jineng.shuzi.visible=true;this.jineng.img.skin=csv.SkillProxy.getIns().getSkillIcon(t.skillObj.icon);if(t.skillObj.typeicon){this.jineng.jiaobiao.skin="public/bg_jinengbiaoqian_"+t.skillObj.typeicon+".png"}else{this.jineng.jiaobiao.skin=""}this.jineng.starMediator.value=0;this.kaiqilab.text="";this.jinengname.text=t.skillObj.name;this.jiahaobtn.visible=false;this.on(Laya.Event.CLICK,this,this.selectSkillHandler,[e])}else{this.jineng.jiaobiao.skin="";this.jineng.gray=false;this.jineng.shuzi.visible=false;this.jineng.starMediator.value=0;this.jinengname.text="";var a=parseInt(game.Config.getParams(e+901));var o=csv.RideattrProxy.getIns().getCfg(s.MountModel.getIns().rideid);if(o.order>=a){this.kaiqilab.color=game.STYLES.DESC_TXT_COLOR_S;this.jiahaobtn.visible=true;this.jineng.img.skin="public/gridbg01.png"}else{this.kaiqilab.color=game.STYLES.RED_COLOR_S;this.jiahaobtn.visible=false;this.jineng.img.skin="public/bg_lock01.png"}this.kaiqilab.text=app.getLang("zuoqi_16",a)}};e.SINGLE_KEY="mount.MountSkillItem";return e}(ui.zuoqi.zuoqijinengxuanzeitemUI);s.MountSkillItem=t})(mount||(mount={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var mount;(function(n){var t=function(i){__extends(t,i);function t(){var t=i!==null&&i.apply(this,arguments)||this;t._selectIndex=-1;t.lastIndex=-1;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){i.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.tab.on(Laya.Event.CHANGE,this,this.onShow);var t=["buttonname_23","buttonname_24","buttonname_194"];for(var e in this.tab.items){this.tab.items[e].label=t[e]}guide.GuideModel.getIns().register(csv.GuideProxy.ENUM_VIEW.MOUNT_TAB_SELECT,this,this.getGuideItemBtn)};t.prototype.getGuideItemBtn=function(t){return this.tab.items[t-1]};t.prototype.onDisplay=function(){n.MountModel.getIns().on(n.MountEvent.EVENT.QISHU_ID_CHANGE,this,this.redDot);n.MountModel.getIns().on(n.MountEvent.EVENT.USE_MOUNT_CHANGE,this,this.redDot);n.MountModel.getIns().on(n.MountEvent.EVENT.ACTIVITY_MOUNT_CHANGE,this,this.redDot);n.MountModel.getIns().on(n.MountEvent.EVENT.LEVEL_MOUNT_CHANGE,this,this.redDot);n.MountModel.getIns().on(n.MountEvent.EVENT.SKLL_MOUNT_CHANGE,this,this.redDot);this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){n.MountModel.getIns().off(n.MountEvent.EVENT.QISHU_ID_CHANGE,this,this.redDot);n.MountModel.getIns().off(n.MountEvent.EVENT.USE_MOUNT_CHANGE,this,this.redDot);n.MountModel.getIns().off(n.MountEvent.EVENT.ACTIVITY_MOUNT_CHANGE,this,this.redDot);n.MountModel.getIns().off(n.MountEvent.EVENT.LEVEL_MOUNT_CHANGE,this,this.redDot);n.MountModel.getIns().off(n.MountEvent.EVENT.SKLL_MOUNT_CHANGE,this,this.redDot);this._selectIndex=-1;this.tab.selectedIndex=-1};t.prototype.refreshAll=function(){this.tab.selectedIndex=this.redDot()};t.prototype.onShow=function(){if(this.tab.selectedIndex==0){this.onShowZuoQiView();this.lastIndex=this.tab.selectedIndex}else if(this.tab.selectedIndex==1){if(csv.FunctionsProxy.getIns().isOpen(csv.FunctionsProxy.ENUMS.MOUNT_HORSE,true)){this.onShowJingTongView();this.lastIndex=this.tab.selectedIndex}else{this.tab.selectedIndex=this.lastIndex}}else if(this.tab.selectedIndex==2){this.onShowTuJanView();this.lastIndex=this.tab.selectedIndex}};t.prototype.onShowZuoQiView=function(){if(this._selectIndex==0){return}this.zuoqi.visible=true;this.qishujingtong.visible=false;this.tujian.visible=false;this.zuoqi.event(Laya.Event.DISPLAY);this.qishujingtong.event(Laya.Event.UNDISPLAY);if(this._selectIndex==2){this.tujian.event(Laya.Event.UNDISPLAY)}this._selectIndex=0;common.CommonWindow.getIns().common.setTitle(app.getLang("name_rider1"))};t.prototype.onShowJingTongView=function(){if(this._selectIndex==1){return}this.zuoqi.visible=false;this.qishujingtong.visible=true;this.tujian.visible=false;this.zuoqi.event(Laya.Event.UNDISPLAY);this.qishujingtong.event(Laya.Event.DISPLAY);if(this._selectIndex==2){this.tujian.event(Laya.Event.UNDISPLAY)}this._selectIndex=1;common.CommonWindow.getIns().common.setTitle(app.getLang("name_rider2"))};t.prototype.onShowTuJanView=function(){if(this._selectIndex==2){return}this.zuoqi.visible=false;this.qishujingtong.visible=false;this.tujian.visible=true;this.zuoqi.event(Laya.Event.UNDISPLAY);this.qishujingtong.event(Laya.Event.UNDISPLAY);this.tujian.event(Laya.Event.DISPLAY);this._selectIndex=2;common.CommonWindow.getIns().common.setTitle(app.getLang("name_rider3"));game.RedDotView.removeFrom(n.MountTabView.getIns().tab.items[2]);n.MountModel.getIns().showRedTip(false)};t.prototype.redDot=function(){var t=n.MountModel.getIns().showRedTip();var e=1;game.RedDotView.removeFrom(this.tab.items[0]);game.RedDotView.removeFrom(this.tab.items[1]);game.RedDotView.removeFrom(this.tab.items[2]);if(t[0]||t[1]){game.RedDotView.addTo(this.tab.items[0]);e=0}if(t[2]){game.RedDotView.addTo(this.tab.items[1])}else{e=0}if(t[3]){game.RedDotView.addTo(this.tab.items[2])}return e};t.SINGLE_KEY="mount.MountTabView";return t}(ui.zuoqi.zuoqiqishuviewUI);n.MountTabView=t})(mount||(mount={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var mount;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listchongwujibanjihuo.itemRender=ui.zuoqi.zuoqitujianjihuoitemUI;this.listchongwujibanjihuo.renderHandler=new Laya.Handler(this,this.onItemRenderHandler);this.listchongwujibanjihuo.vScrollBarSkin=" "};e.prototype.onItemRenderHandler=function(t){t.labelshuxing.text=Attributes.getPropName(t.dataSource.propId);t.labelshuxingnum.text="+"+Attributes.getPropValue(t.dataSource.propId,t.dataSource.value,t.dataSource.formula)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){var t=csv.HorseattrProxy.getIns().getTujianById(i.MountModel.getIns().acom);this.imgname.visible=false;this.imgjihuo.visible=false;this.box.visible=false;if(t){this.imgjihuo.skin="res/static/zuoqitujianjihuo/"+t.des+".png";var e=Attributes.decode(t.effect).baseList;this.listchongwujibanjihuo.array=e;this.imgname.visible=true;this.imgjihuo.visible=true;this.box.visible=true}i.MountModel.getIns().acom=0};e.SINGLE_KEY="mount.MountTujianActiveView";return e}(ui.zuoqi.zuoqitujianjihuoUI);i.MountTujianActiveView=t})(mount||(mount={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var mount;(function(d){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.listzuoqi.itemRender=d.MountViewCell;this.listzuoqi.renderHandler=new Laya.Handler(this,this.onMountRenderHandler);this.listzuoqi.selectHandler=new Laya.Handler(this,this.onSelectHandler);this.listzuoqi.selectEnable=true;this.listzuoqi.hScrollBarSkin=" ";this.listshuxing.itemRender=d.MountHorseCell02;this.listshuxing.renderHandler=new Laya.Handler(this,this.onAttatRenderHandler);this.listAttrNext.itemRender=d.MountHorseCell02;this.listAttrNext.renderHandler=new Laya.Handler(this,this.onAttatRenderHandler);this.btnjinengzonglan.clickHandler=new Laya.Handler(this,this.onBtnjinengzonglanClick);this._mountAvatar=new avatar.AvatarAnimation;this.weizhi.addChild(this._mountAvatar);this._avatarData=new avatar.AvatarData;this.btnjihuo.clickHandler=new Laya.Handler(this,this.onBtnJihuoClick);this.btnzuoqi.clickHandler=new Laya.Handler(this,this.onBtnzuoqiClick);this.btnCancel.clickHandler=new Laya.Handler(this,this.onBtnzuoqiClick);this.btnzuoqi.label=this.btnCancel.label=" ";this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.shengjiani.visible=false;this.dipanani.visible=false;this.shengjiani.on(Laya.Event.COMPLETE,this,this.onShengjiAniEnd);guide.GuideModel.getIns().register(csv.GuideProxy.ENUM_VIEW.MOUNT_ALIVE,this.btnjihuo);guide.GuideModel.getIns().register(csv.GuideProxy.ENUM_VIEW.MOUNT_UP,this.btnjihuo);guide.GuideModel.getIns().register(csv.GuideProxy.ENUM_VIEW.MOUNT_SKILL_ENTER,this.btnjinengzonglan);guide.GuideModel.getIns().register(csv.GuideProxy.ENUM_VIEW.MOUNT_RIDE,this.btnzuoqi);this.daoju.showBagCount(1)};e.prototype.showView=function(){var t=this.listzuoqi.selectedItem;if(t){var e=csv.HorseattrProxy.getIns().getCfg(t.id);var i=parseInt(e.window);if(i>0){game.ClosureManager.callFunction(parseInt(e.window),true,true)}}};e.prototype.onShengjiAniEnd=function(){this.shengjiani.visible=false;this.shengjiani.stop()};e.prototype.onDisplay=function(){d.MountModel.getIns().on(d.MountEvent.EVENT.USE_MOUNT_CHANGE,this,this.onUseMountChange);d.MountModel.getIns().on(d.MountEvent.EVENT.ACTIVITY_MOUNT_CHANGE,this,this.onActMountChange);d.MountModel.getIns().on(d.MountEvent.EVENT.LEVEL_MOUNT_CHANGE,this,this.onMountLvChange);d.MountModel.getIns().on(d.MountEvent.EVENT.SKLL_MOUNT_CHANGE,this,this.mountSkillRedTip);this._mountAvatar.on(avatar.AvatarAnimation.EVENTS.LOADED,this,this.onLoaded);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){d.MountModel.getIns().off(d.MountEvent.EVENT.USE_MOUNT_CHANGE,this,this.onUseMountChange);d.MountModel.getIns().off(d.MountEvent.EVENT.ACTIVITY_MOUNT_CHANGE,this,this.onActMountChange);d.MountModel.getIns().off(d.MountEvent.EVENT.LEVEL_MOUNT_CHANGE,this,this.onMountLvChange);d.MountModel.getIns().off(d.MountEvent.EVENT.SKLL_MOUNT_CHANGE,this,this.mountSkillRedTip);this._mountAvatar.off(avatar.AvatarAnimation.EVENTS.LOADED,this,this.onLoaded);this.listzuoqi.selectedIndex=-1;this.dipanani.visible=false;this.dipanani.stop()};e.prototype.onBtnJihuoClick=function(){var t=this.listzuoqi.selectedItem;if(t){if(!d.MountModel.getIns().isAct(t.id)){app.ProtocolRequest.ActHorseReq(t.id)}else{app.ProtocolRequest.HorseLvReq(t.id)}}};e.prototype.onBtnzuoqiClick=function(){var t=this.listzuoqi.selectedItem;if(t){if(d.MountModel.getIns().isQiChen(parseInt(t.id))){app.ProtocolRequest.RideHorseReq(0)}else{app.ProtocolRequest.RideHorseReq(parseInt(t.id))}}};e.prototype.onUseMountChange=function(){this.listzuoqi.refresh();role.LeadingRoleView.getIns().setRoleMountAni();if(d.MountModel.getIns().isQiChen(this.listzuoqi.selectedItem.id)){this.btnzuoqi.visible=false}else{this.btnzuoqi.visible=true}this.btnCancel.visible=!this.btnzuoqi.visible};e.prototype.onMountLvChange=function(){this.listzuoqi.refresh();this.actBack()};e.prototype.onActMountChange=function(){this.mountSkillRedTip();this.actBack()};e.prototype.actBack=function(){this.shengjiani.visible=true;this.shengjiani.play(0,false);this.updateSelectMount()};e.prototype.setAvatar=function(){var t=this.listzuoqi.selectedItem;this._mountAvatar.visible=false;this._avatarData.mountKey=t.horseres;this._mountAvatar.setAniData(this._avatarData);this._mountAvatar.setAni(avatar.AvatarAnimation.ANI_ENUMS.IDLE,0);this._mountAvatar.play()};e.prototype.onLoaded=function(){this._mountAvatar.visible=true;var t=this.listzuoqi.selectedItem;if(t.offsets!=""){var e=app.str2Array(t.offsets,";");this._mountAvatar.x=parseInt(e[0]);this._mountAvatar.y=parseInt(e[1])}else{this._mountAvatar.x=0;this._mountAvatar.y=0}};e.prototype.onBtnjinengzonglanClick=function(){app.ViewManager.toggleDialog(d.MountSkillView,1,0,this.listzuoqi.selectedItem.id)};e.prototype.onMountRenderHandler=function(t,e){if(e==this.listzuoqi.selectedIndex){t.imgxuanzhong.visible=true}else{t.imgxuanzhong.visible=false}t.setData(t.dataSource)};e.prototype.onSelectHandler=function(){var t=this.listzuoqi.selectedItem;if(!t)return;this.imgname.skin="zuoqi/"+t.horsenameres+".png";var e=game.ItemUtil.parserList(t.cost)[0];this.pingjieimg.skin="zuoqi/bg_zuoqi_lv_"+e.itemCfg.qua+".png";this.setAvatar();this.updateSelectMount()};e.prototype.updateSelectMount=function(){var t=this.listzuoqi.selectedItem;var e=false;var i=d.MountModel.getIns().getHorseData(t.id);var n=csv.HorseattrProxy.getIns().getSkillMaxLevel(t.id);this.onSkillRenderHandler(t.id,i&&i.horselv>=n);var a=d.MountModel.getIns().isAct(t.id);var o;if(a){this.btnjihuo.label=app.getLang("zuoqi_8");this.dipanani.visible=true;this.dipanani.play(0);if(d.MountModel.getIns().isQiChen(t.id)){this.btnzuoqi.visible=false}else{this.btnzuoqi.visible=true}this.btnCancel.visible=!this.btnzuoqi.visible;this.boxzhanli.visible=false;this.levellab1.text=app.getLang("zuoqi_11")+this.skillObj.level;this.levellab2.text=app.getLang("zuoqi_11")+(this.skillObj.level+1);if(i.horselv<n){this.ani1.gotoAndStop(0);this.levellab2.visible=true}else{this.ani1.gotoAndStop(1);this.levellab2.visible=false}var s=csv.HorseattrProxy.getIns().getSkillByLevel(t.id,i.horselv);var r=csv.HorseattrProxy.getIns().getSkillByLevel(t.id,i.horselv+1);var l="";if(s){l=s.attributes}else{l=csv.HorseattrProxy.getIns().getCfg(t.id).attr}this.wujiaoxing.value=i.horselv;this.wujiaoxing.visible=true;if(r){o=game.ItemUtil.parserList(r.cost)[0];this.daoju.setData(o)}var h=Attributes.decode(l);var p=Attributes.decode(r?r.attributes:"");if(!h){for(var u=0;u<p.baseList.length;u++){h.baseList[u]=new PropValue;h.baseList[u].propId=p.baseList[u].propId;h.baseList[u].flag=p.baseList[u].flag;h.baseList[u].formula=p.baseList[u].formula;h.baseList[u].value=0}}this.listshuxing.array=h.baseList;this.listAttrNext.array=p.baseList;e=o?game.GridsModel.getIns().hasEnoughItems(o):false;if(e){this.btnjihuo.disabled=false}else{this.btnjihuo.disabled=true}this.zhanlishuzhi.value=s?s.addbattery:t.addbattery+""}else{this.ani1.gotoAndStop(0);this.levellab1.text=app.getLang("equipmaster05");this.levellab2.text="";this.jiantou.visible=false;this.wujiaoxing.visible=false;this.btnjihuo.label=app.getLang("zuoqi_6");this.dipanani.visible=false;this.dipanani.stop();o=game.ItemUtil.parserList(t.cost)[0];e=game.GridsModel.getIns().hasEnoughItems(o);if(e){this.btnjihuo.disabled=false;this.btnzuoqi.visible=false;this.btnCancel.visible=false}else{this.btnjihuo.disabled=true;this.btnzuoqi.visible=false;this.btnCancel.visible=false}this.boxzhanli.visible=true;var r=csv.HorseattrProxy.getIns().getCfg(t.id);var c=Attributes.decode(r.attr);var g=Attributes.decode("");for(var u=0;u<c.baseList.length;u++){g.baseList[u]=new PropValue;g.baseList[u].propId=c.baseList[u].propId;g.baseList[u].flag=c.baseList[u].flag;g.baseList[u].formula=c.baseList[u].formula;g.baseList[u].value=0}this.listshuxing.array=g.baseList;this.listAttrNext.array=c.baseList;this.clipzhanli.value=t.addbattery+""}this.zhanlibox.visible=!this.boxzhanli.visible;if(o){var f=game.GridsModel.getIns().getItemCount(o.getItemId())}this.daoju.setData(o);if(e){game.RedDotView.addTo(this.btnjihuo)}else{game.RedDotView.removeFrom(this.btnjihuo)}};e.prototype.onSkillRenderHandler=function(t,e){var i=d.MountModel.getIns().getHorseData(t);var n=csv.HorseattrProxy.getIns().getCfg(t).horseskill;if(i){if(i.horselv>0){n=csv.HorseattrProxy.getIns().getSkillByLevel(t,i.horselv).horseskill}this.skillObj=csv.SkillProxy.getIns().getSkillByKey(n);if(e){this.shuoming.text=csv.SkillProxy.getSkillDes(this.skillObj.skillid,this.skillObj.level)}else{this.shuoming.text=csv.SkillProxy.getSkillDes(this.skillObj.skillid,this.skillObj.level,1)}}else{this.skillObj=csv.SkillProxy.getIns().getSkillByKey(n);this.shuoming.text=csv.SkillProxy.getSkillDes(this.skillObj.skillid,this.skillObj.level)}this.jinenggezi.setData(this.skillObj,false,false,false);this.jinenggezi.starMediator.value=0;this.jinengname.text=this.skillObj.name};e.prototype.onAttatRenderHandler=function(t){t.setData(t.dataSource)};e.prototype.mountSkillRedTip=function(){game.RedDotView.removeFrom(this.btnjinengzonglan);if(d.MountModel.getIns().showSkillRedTip()){game.RedDotView.addTo(this.btnjinengzonglan)}};e.prototype.refreshAll=function(){this.mountSkillRedTip();var t=[];var e=[];var i=[];for(var n=0;n<csv.HorseattrProxy.getIns().getCfgArr().length;n++){var a=csv.HorseattrProxy.getIns().getCfgArr()[n];if(d.MountModel.getIns().isQiChen(parseInt(a.id))){t.push(a);continue}if(d.MountModel.getIns().isAct(parseInt(a.id))){e.push(a)}else{i.push(a)}}SortUtil.sortOnArr(e,["id"],[SortUtil.NUMERIC]);SortUtil.sortOnArr(i,["id"],[SortUtil.NUMERIC]);t=t.concat(e);var o=0;t=t.concat(i);if(this.dataSource&&this.dataSource.length>0){for(var n=0,s=t.length;n<s;n++){if(this.dataSource[0]==t[n].id){o=n;break}}this.dataSource.length=0}else{for(var n=0;n<t.length;n++){if(!d.MountModel.getIns().isAct(t[n].id)){if(game.GridsModel.getIns().hasEnoughItems(t[n].cost)){o=n;break}}else{var a=d.MountModel.getIns().getHorseData(t[n].id);var r=csv.HorseattrProxy.getIns().getSkillByLevel(t[n].id,a.horselv+1);if(r){if(game.GridsModel.getIns().hasEnoughItems(r.cost)){o=n;break}}}}}this.listzuoqi.array=t;this.listzuoqi.selectedIndex=o;if(o>=this.listzuoqi.repeatX-1){this.listzuoqi.scrollTo(o)}};e.SINGLE_KEY="mount.MountView";return e}(ui.zuoqi.zuoqiviewnewUI);d.MountView=t})(mount||(mount={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var mount;(function(a){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.arr=[[this.img1,this.img2],[this.img3,this.img4,this.img5],[this.img6,this.img7,this.img8,this.img9,this.img10]];this.libiao.renderHandler=new Laya.Handler(this,this.onRenderHandler)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.onRenderHandler=function(t){var e=t.dataSource;t.gray=!(this.needhorse.length==this.num.length);t.txtName.text=Attributes.getPropName(e.propId)+"+"+Attributes.getPropValue(e.propId,e.value,e.formula)};e.prototype.setImg=function(t,e){if(this.num.indexOf(e)>=0){t.skin="res/static/zuoqi/zuoqi_"+e+"_1.png"}else{t.skin="res/static/zuoqi/zuoqi_"+e+"_0.png"}};e.prototype.setData=function(t){this.needhorse=app.str2Array(t.needhorse,"-");this.bg.skin="res/static/zuoqi/"+t.des+".png";var e=Attributes.decode(t.effect).baseList;this.num=a.MountModel.getIns().getAhoresData(t.id);game.RedDotView.removeFrom(this);if(a.MountModel.getIns().reddotDict[t.id]){game.RedDotView.addTo(this)}this.libiao.array=e;var i=0;if(this.needhorse.length>3){this.ani1.gotoAndStop(2);i=2}else if(this.needhorse.length==3){this.ani1.gotoAndStop(1);i=1}else{this.ani1.gotoAndStop(0)}for(var n=0;n<this.needhorse.length;n++){this.setImg(this.arr[i][n],parseInt(this.needhorse[n]))}};e.SINGLE_KEY="mount.TujianItem";return e}(ui.zuoqi.zuoqitujianitem5UI);a.TujianItem=t})(mount||(mount={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var mountain;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){app.ViewManager.regist(i.MountainView,"qiseshan.atlas");game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.MOUNTAIN_NEW,i.MountainView);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.MOUNTAIN_RANK,i.MountainRankView);csv.FunctionsProxy.getIns().on(csv.FunctionsProxy.EVENTS.CHANGE,this,this.onRedDotChange);vipcode.VipModel.getIns().on(vipcode.VipEvent.VIP_CHANGE,this,this.onRedDotChange)};e.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.MountainInfoAck,this,this.onMountainInfoAck);this.addMsgListener(app.ProtocolResponse.MountainChallengeAck,this,this.onMountainChallengeAck);this.addMsgListener(app.ProtocolResponse.MountainSweepAck,this,this.onMountainSweepAck);this.addMsgListener(app.ProtocolResponse.AwardMountainAck,this,this.onAwardMountainAck)};e.prototype.onAwardMountainAck=function(t,e){if(e.result){i.MountainModel.getIns().onUpdateRedDot()}else{i.MountainModel.getIns().event(i.MountainModel.MOUNTAIN_AWARD_FAIL)}};e.prototype.onMountainInfoAck=function(t,e){i.MountainModel.getIns().awardList=e.awardid;i.MountainModel.getIns().mountainId=e.mountainId};e.prototype.onMountainChallengeAck=function(t,e){if(e.success==1){i.MountainModel.getIns().onUpdateRedDot()}};e.prototype.onMountainSweepAck=function(t,e){if(e.success){var i=e.mountainId;var n=e.num;var a=game.ItemUtil.parserList(csv.MountainProxy.getIns().getCfg(i).clear_item);for(var o=0;o<a.length;o++){a[o].setCount(a[o].count*n)}app.ViewManager.toggleDialog(boss.BossSweepView,1,0,[i,n,a,csv.DailyTimeProxy.ENUM_TYPE.MOUNTAIN])}};e.prototype.onRedDotChange=function(){Laya.timer.callLater(this,this.onUpdateRedDot)};e.prototype.onUpdateRedDot=function(){i.MountainModel.getIns().onUpdateRedDot()};e.SINGLE_KEY="mountain.MountainModule";return e}(app.ModuleBase);i.MountainModule=t})(mountain||(mountain={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var mountain;(function(n){var t=function(e){__extends(i,e);function i(){var t=e!==null&&e.apply(this,arguments)||this;t._mountainId=0;return t}Object.defineProperty(i.prototype,"awardList",{set:function(t){this._awardList=t;this.event(n.MountainModel.MOUNTAIN_AWARD_UPDATE)},enumerable:true,configurable:true});i.getIns=function(){return app.Singleton.getInstance(i)};i.prototype.init=function(){this._awardList=[]};Object.defineProperty(i.prototype,"mountainId",{get:function(){return this._mountainId},set:function(t){this._mountainId=t;this.event(i.ID_CHANGE)},enumerable:true,configurable:true});i.prototype.sweepOpen=function(){var t=game.Config.getIntParams(1155);return this._mountainId>=t};i.prototype.isGetted=function(t){return this._awardList.indexOf(t)>=0};i.prototype.onUpdateRedDot=function(){var t=boss.BossModel.getIns().getDailyTime(csv.DailyTimeProxy.ENUM_TYPE.MOUNTAIN);game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.MOUNTAIN_NEW);if(this.sweepOpen()){if(this.checkAward()||t&&t.fnum+t.gnum>0){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.MOUNTAIN_NEW)}}};i.prototype.checkAward=function(){var t=false;return t};i.SINGLE_KEY="mountain.MountainModel";i.ID_CHANGE="id_change";i.MOUNTAIN_AWARD_UPDATE="mountain_award_update";i.MOUNTAIN_AWARD_FAIL="mountain_award_fail";return i}(app.ModelBase);n.MountainModel=t})(mountain||(mountain={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("dungeon_mountain.csv");this.cfgMap=t.getMap("id");this.cfgArr=t.getArray();var e=app.Config.getResById("dungeon_mountainaward.csv");this.cfgAwardArr=e.getArray()};e.prototype.getCfg=function(t){return this.cfgMap[t]};e.prototype.getArr=function(){return this.cfgArr};e.prototype.getAwardList=function(){return this.cfgAwardArr};e.SINGLE_KEY="csv.MountainProxy";return e}(app.ModelBase);t.MountainProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var mountain;(function(s){var i=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.yiwancheng.visible=false;this.items=[]};e.prototype.onDisplay=function(){s.MountainModel.getIns().on(s.MountainModel.MOUNTAIN_AWARD_UPDATE,this,this.showTween);s.MountainModel.getIns().on(s.MountainModel.MOUNTAIN_AWARD_FAIL,this,this.awardFail);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){s.MountainModel.getIns().off(s.MountainModel.MOUNTAIN_AWARD_UPDATE,this,this.showTween);s.MountainModel.getIns().off(s.MountainModel.MOUNTAIN_AWARD_FAIL,this,this.awardFail);for(var t=0;t<this.items.length;t++){Laya.Tween.clearAll(this.items[t])}this.ids=[];if(this._tween){Laya.Tween.clear(this._tween);this._tween=null}};e.prototype.refreshAll=function(){var t=csv.MountainProxy.getIns().getAwardList();this.clean();var e=[];for(var i=0;i<t.length;i++){var n=s.MountainModel.getIns().isGetted(t[i].id);if(n){continue}e.push(t[i])}this.yiwancheng.visible=e.length==0;var a=0;for(var i=0;i<e.length;i++){var o=Laya.Pool.getItemByClass("MountainAwardItem",r);o.alpha=1;o.x=0;o.y=a;a+=o.height;o.setData(e[i]);this.items.push(o);this.listdaoju.addChild(o)}};e.prototype.clean=function(){while(this.items.length>0){var t=this.items.pop();Laya.Pool.recover("MountainAwardItem",t);t.removeSelf()}this.ids=[]};e.prototype.awardFail=function(){this.ids.shift()};e.prototype.showTween=function(){var t=this.ids.shift();if(t>0){for(var e=0;e<this.items.length;e++){if(this.items[e].id==t){this._tween=Laya.Tween.to(this.items[e],{alpha:.1,x:-this.items[e].width},300,null,new Laya.Handler(this,this.onEnd,[e]));break}}}};e.prototype.onEnd=function(t){var e=this.items[t];Laya.Pool.recover("MountainAwardItem",e);e.removeSelf();this.items.splice(t,1);for(var i=t,n=this.items.length;i<n;i++){var a=this.items[i].y-e.height;if(i>t+5){this.items[i].y=a}else{Laya.Tween.to(this.items[i],{y:a},300)}}};e.prototype.onAwardMountainReq=function(t){if(this.ids.indexOf(t)<0){this.ids.push(t);app.ProtocolRequest.AwardMountainReq(t)}};e.SINGLE_KEY="mountain.MountainAwardView";return e}(ui.qiseshan.qiseshanjiangliiviewUI);s.MountainAwardView=i;var r=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.btnlingqu.clickHandler=new Laya.Handler(this,this.onAwardMountainReq)};e.prototype.onAwardMountainReq=function(){i.getIns().onAwardMountainReq(this.id)};e.prototype.setData=function(t){this.id=t.id;var e=s.MountainModel.getIns().mountainId;var i=game.ItemUtil.parserList(t.rewards)[0];this.gird.setData(i);var n=t.class;if(e>=n){this.bar.value=1}else{this.bar.value=e/n}this.label.text=app.getLang(t.name,n);this.txtValue.text=e+"/"+n;this.yilingqu.visible=false;this.btnweiwancheng.visible=false;this.btnlingqu.visible=false;var a=s.MountainModel.getIns().isGetted(this.id);if(a){this.yilingqu.visible=true}else if(n>e){this.btnweiwancheng.visible=true}else{this.btnlingqu.visible=true}};return e}(ui.qiseshan.qiseshanjiangliitemUI);s.MountainAwardItem=r})(mountain||(mountain={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var mountain;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.on(Laya.Event.CLICK,this,this.showMenu)};e.prototype.showMenu=function(t){t.stopPropagation();if(this._vo.uid&&!Uint64.equal(this._vo.uid,game.Context.mainRoleId)){rank.RankModel.showRankBtnList(this._vo.uid,this._vo.name,this._vo.teamlv,this._vo.classskin,this._vo.headframeId)}else{if(app.ViewManager.DisplayedInStage(friend.HaoYouCaiDanView.SINGLE_KEY)){app.ViewManager.toggleView(friend.HaoYouCaiDanView,app.AppContainer.flowLayer,-1)}}};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t,e){this._vo=t;this.ditu2.visible=false;if(t.uid){this.imgtouxiang.skin=csv.MyTeamProxy.getIns().getTeamIcon(t.simpleteamavatar);this.imgframe.skin=csv.HeadFrameProxy.getIns().getIcon(t.headframeId);this.labelname.text=game.Context.clearPlayerName(t.name);this.labeljifen.text=t.value.toNumber()+"";if(Uint64.equal(game.Context.mainRoleId,t.uid)){this.ditu2.visible=true}}else{this.imgtouxiang.skin=csv.MyTeamProxy.getIns().getDefaultTeamIcon();this.imgframe.skin="";this.labelname.text=app.getLang("rank_empty");this.labeljifen.text=""}this.lapelpaiming.text=e+4+""};e.SINGLE_KEY="mountain.MountainRankItem";return e}(ui.qiseshan.qiseshanpaihangitemUI);t.MountainRankItem=e})(mountain||(mountain={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var mountain;(function(i){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.roleAvatarDatas=[];t.roleAvatars=[];t.waitRoles=[];t.shadows=[];return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listpaiming02.itemRender=i.MountainRankItem;this.listpaiming02.renderHandler=new Laya.Handler(this,this.onItemRenderHandler);this.weizhis=[this.pos2,this.pos1,this.pos3];this.mountainids=[this.txtNum2,this.txtNum1,this.txtNum3];this.names=[this.txtName2,this.txtName1,this.txtName3];this.rankList=[];this.wodepaihang.ditu2.visible=true};t.prototype.showMenu=function(t,e){e.stopPropagation();var i=this.rankList[t];if(i.uid&&!Uint64.equal(i.uid,game.Context.mainRoleId)){rank.RankModel.showRankBtnList(i.uid,i.name,i.teamlv,i.classskin,i.headframeId)}else{if(app.ViewManager.DisplayedInStage(friend.HaoYouCaiDanView.SINGLE_KEY)){app.ViewManager.toggleView(friend.HaoYouCaiDanView,app.AppContainer.flowLayer,-1)}}};t.prototype.onItemRenderHandler=function(t,e){t.setData(t.dataSource,e)};t.prototype.onDisplay=function(){rank.RankModel.getIns().on(rank.RankModel.RANK_DATA_CHANGE,this,this.rankChange);rank.RankModel.getIns().on(rank.RankModel.RANK_FIRST_CHANGE,this,this.showModels);app.ProtocolRequest.GetRankListReq(rank.RankModel.TYPE_ENUM.ENMRANKTYPE_MOUNTAIN)};t.prototype.onUnDisplay=function(){rank.RankModel.getIns().off(rank.RankModel.RANK_DATA_CHANGE,this,this.rankChange);rank.RankModel.getIns().off(rank.RankModel.RANK_FIRST_CHANGE,this,this.showModels)};t.prototype.rankChange=function(t){if(t==rank.RankModel.TYPE_ENUM.ENMRANKTYPE_MOUNTAIN){var e=rank.RankModel.getIns().getRankInfo(rank.RankModel.TYPE_ENUM.ENMRANKTYPE_MOUNTAIN);this.rankList=[];for(var i=0;i<3;i++){this.rankList.push(e.rankList.shift())}var n=[];var a=97-e.rankList.length;if(a>0){for(var i=0;i<a;i++){n.push(new RankData)}}this.listpaiming02.array=e.rankList.concat(n);this.updateRank(e.rank);this.refreshAll()}};t.prototype.updateRank=function(t){if(t>0){this.wodepaihang.lapelpaiming.text=t+""}else{this.wodepaihang.lapelpaiming.text=app.getLang("family_4")}};t.prototype.refreshAll=function(){this.showModels();this.wodepaihang.imgtouxiang.skin=csv.MyTeamProxy.getIns().getTeamIcon(game.Context.teamAvatar);this.wodepaihang.imgframe.skin=game.RoleModel.getIns().getHeadFrameIcon();this.wodepaihang.labelname.text=game.Context.clearPlayerName(game.Context.mainRole.playername);var t=i.MountainModel.getIns().mountainId;if(t>0){this.wodepaihang.labeljifen.text=app.getLang("mountain_tips2",t)}else{this.wodepaihang.labeljifen.text=app.getLang("未挑战")}};t.prototype.showModels=function(){var t=rank.RankModel.getIns().getRankShowPlayerData(rank.RankModel.TYPE_ENUM.ENMRANKTYPE_MOUNTAIN);for(var e=0;e<3;e++){if(!this.shadows[e]){this.shadows[e]=new Laya.Image("res/assist/circle.png");this.shadows[e].anchorX=this.shadows[e].anchorY=.5}this.names[e].text=app.getLang("rank_empty");this.mountainids[e].text="";this.weizhis[e].addChild(this.shadows[e]);if(this.rankList[e]){var i=this.rankList[e];this.names[e].text=game.Context.clearPlayerName(i.name);this.mountainids[e].text=app.getLang("mountain_tips2",i.value.toNumber())}if(t&&t[e]){if(!this.roleAvatarDatas[e]){this.roleAvatarDatas[e]=new avatar.AvatarData;this.roleAvatars[e]=new avatar.AvatarAnimation;this.roleAvatars[e].scaleX=1.5;this.roleAvatars[e].scaleY=1.5;this.roleAvatars[e].on(Laya.Event.CLICK,this,this.showMenu,[e]);this.weizhis[e].addChild(this.roleAvatars[e])}var n="";var a=t[e];var o=csv.SkinProxy.getIns().getCfg(a.fashion);if(o){n=o.modelres}else{if(a.setskin>0){n=csv.DefclassProxy.getIns().getCfg(a.setskin).model}else{var s=rank.RankModel.getIns().getRankShowPlayerProf(rank.RankModel.TYPE_ENUM.ENMRANKTYPE_MOUNTAIN,a.uid);n=csv.DefclassProxy.getIns().getCfg(s).model}}this.roleAvatarDatas[e].roleKey=n;this.roleAvatars[e].setAniData(this.roleAvatarDatas[e]);this.roleAvatars[e].setAni(avatar.AvatarAnimation.ANI_ENUMS.IDLE,0);this.roleAvatars[e].play();if(this.waitRoles[e]){this.waitRoles[e].removeSelf();this.waitRoles[e]=null}}else{if(!this.waitRoles[e]){this.waitRoles[e]=new Laya.Image("res/static/wuxing/bg_wuxing_jianying.png");this.waitRoles[e].anchorX=.5;this.waitRoles[e].anchorY=1}this.weizhis[e].addChild(this.waitRoles[e])}}};t.SINGLE_KEY="mountain.MountainRankView";return t}(ui.qiseshan.qiseshanpaihangUI);i.MountainRankView=t})(mountain||(mountain={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var mountain;(function(l){var t=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.xiala.itemRender=i;this.xiala.renderHandler=new Laya.Handler(this,this.onRender);this.jiahaobtn.on(Laya.Event.CLICK,this,this.onAddTime);this.btnAward.on(Laya.Event.CLICK,this,this.onShowView);var t=app.str2Array(game.Config.getParams(1011),";");this._upCount=parseInt(t[0]);this._downCount=parseInt(t[1]);guide.GuideModel.getIns().register(csv.GuideProxy.ENUM_VIEW.MOUTAIN_BATTLE,this,this.getGuideItem,300);guide.GuideModel.getIns().register(csv.GuideProxy.ENUM_VIEW.MOUTAIN_BATTLE_OR_SWEEP,this,this.getGuideItem2,300);this.txtVip.text=app.getLang("mountain_tips19");this.txtVip.visible=false;this.tanhao.visible=false};t.prototype.getGuideItem=function(t){for(var e=0,i=this.xiala.cells.length;e<i;e++){var n=this.xiala.cells[e];if(n&&n.dataSource&&n.dataSource.id==t){return n.btnChallenge}}return null};t.prototype.getGuideItem2=function(){var t;var e=guide.GuideModel.getIns().specialGuideParams[1];for(var i=0,n=e.length;i<n;i++){if(!game.GridsModel.getIns().hasEnoughItems(e[i])){t=e[i].getItemId();break}}if(!t){return"complete"}var a=0;for(var i=0,n=this.xiala.array.length;i<n;i++){var o=this.xiala.array[i];if(parseInt(app.str2Array(o.award_item,"-")[0])==t){a=i;break}}this.xiala.scrollTo(a);for(var i=0,n=this.xiala.cells.length;i<n;i++){var s=this.xiala.cells[i];if(s&&s.dataSource){if(parseInt(app.str2Array(s.dataSource.award_item,"-")[0])==t){return s.getStateBtn()}}}return null};t.prototype.onShowView=function(){app.ViewManager.toggleDialog(l.MountainAwardView,1,0)};t.prototype.onAddTime=function(){app.ViewManager.toggleDialog(boss.BossBuyTimeTips,1,0,[csv.DailyTimeProxy.ENUM_TYPE.MOUNTAIN,"shandong_tips9","mountain_tips9"])};t.prototype.onRender=function(t,e){t.setData(t.dataSource,parseInt(this.dataSource[0]))};t.prototype.onDisplay=function(){boss.BossModel.getIns().on(boss.BossEvent.BOSS_DAILY_TIME_CHANGE,this,this.setDailyTime);l.MountainModel.getIns().on(l.MountainModel.ID_CHANGE,this,this.refreshAll);l.MountainModel.getIns().on(l.MountainModel.MOUNTAIN_AWARD_UPDATE,this,this.checkAward);this.callLater(this.refreshAll);this.checkAward()};t.prototype.onUnDisplay=function(){boss.BossModel.getIns().off(boss.BossEvent.BOSS_DAILY_TIME_CHANGE,this,this.setDailyTime);l.MountainModel.getIns().off(l.MountainModel.ID_CHANGE,this,this.refreshAll);l.MountainModel.getIns().off(l.MountainModel.MOUNTAIN_AWARD_UPDATE,this,this.checkAward);dailytask.FubenModel.getIns().setBoNew(csv.FunctionsProxy.ENUMS.MOUNTAIN_NEW,false)};t.prototype.checkAward=function(){if(l.MountainModel.getIns().checkAward()){game.RedDotView.addTo(this.btnAward)}else{game.RedDotView.removeFrom(this.btnAward)}};t.prototype.updateView=function(){var t=[];var e=l.MountainModel.getIns().mountainId;var i=csv.MountainProxy.getIns().getArr().length;var n=e-this._upCount;var a=e+1+this._downCount;n=n<0?0:n;a=a>i?i:a;for(var o=n;o<a;o++){t.push(csv.MountainProxy.getIns().getCfg(o+1))}this.xiala.array=t;var s=0;if(this.dataSource[0]&&this.dataSource[0].length>0){e=parseInt(this.dataSource[0])}if(t.length>0){for(var o=0,r=t.length;o<r;o++){if(e==t[o].id){s=o;break}}}if(parseInt(this.dataSource[0])>0){this.xiala.scrollTo(s-1<0?0:s-1)}else{this.xiala.scrollTo(s)}this.setDailyTime()};t.prototype.refreshAll=function(){var t=l.MountainModel.getIns().sweepOpen();this.cishulab.visible=t;this.cishu.visible=t;this.xuanzhogndi.visible=t;this.jiahaobtn.visible=t;this.txtVip.visible=t;this.tanhao.visible=t;this.updateView()};t.prototype.setDailyTime=function(){var t=csv.DailyTimeProxy.ENUM_TYPE.MOUNTAIN;var e=boss.BossModel.getIns().getDailyTime(t);var i=csv.DailyTimeProxy.getIns().getCfg(t);var n=fabaonew.FaBaoNewModel.getIns().getPlayMode(fabaonew.Etask_type.SevenColorMountainCount);var a=parseInt(i.time)+n;n-=e.extnum;if(n<0)n=0;this.cishu.text=e.fnum+e.gnum+n+"/"+a;this.xiala.refresh()};t.SINGLE_KEY="mountain.MountainView";return t}(ui.qiseshan.qiseshanviewnewUI);l.MountainView=t;var i=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.ani1.gotoAndStop(0);this.ani2.gotoAndStop(0);this.btnFast.clickHandler=new Laya.Handler(this,this.onClick,[5]);this.btnQuick.clickHandler=new Laya.Handler(this,this.onClick,[1]);this.btnChallenge.clickHandler=new Laya.Handler(this,this.onClick,[0]);this.btnQuick.label=app.getLang("shandong_btn2",1);this.btnFast.label=app.getLang("shandong_btn2",5);this.btnChallenge.label=app.getLang("iceworld_des1")};e.prototype.getStateBtn=function(){if(this.ani2.index==0){return this.btnChallenge}else{return this.btnQuick}};e.prototype.onClick=function(t){if(t>0){boss.BossModel.getIns().onGeneralBattleReq(this.id,t,csv.DailyTimeProxy.ENUM_TYPE.MOUNTAIN)}else{app.ProtocolRequest.MountainChallengeReq()}};e.prototype.setData=function(t,e){this.id=t.id;this.txtNum.value=t.id+"";this.txtLev.text=app.getLang("mountain_tips3",t.reconmmend);if(t.id>=l.MountainModel.getIns().mountainId&&dailytask.FubenModel.getIns().checkIfNewId(csv.FunctionsProxy.ENUMS.MOUNTAIN_NEW,t.id)){game.RedDotView.addTo(this.imgjiaobiaoxin,22,10,1,1,game.RedDotView.ENUM_TYPE.XIN)}else{game.RedDotView.removeFrom(this.imgjiaobiaoxin)}this.dituxuanzhong.visible=false;if(e>0){if(t.id==e){this.dituxuanzhong.visible=true}}else if(t.id==l.MountainModel.getIns().mountainId+1){this.dituxuanzhong.visible=true}this.grid0.setData(game.ItemUtil.parserList(t.award_item)[0]);this.grid1.setData(game.ItemUtil.parserList(t.clear_item)[0]);var i=csv.MonsterProxy.getIns().getMonsterBase(t.monstersetbase);var n=app.str2Array(i.element,"-");this.txtVaule.text=n[n.length-1];var a=Attributes.getWuxingEnumType(parseInt(n[0]));this.imgWuxing.skin="public/bg_wuxing_"+a+".png";this.setBtnState(t.id,t.teamlevel,fabaonew.FaBaoNewModel.getIns().getPlayMode(fabaonew.Etask_type.SevenColorMountain))};e.prototype.setBtnState=function(t,e,i){var n=l.MountainModel.getIns().mountainId;var a=game.Config.getIntParams(1155);if(n>=t){if(t>=a){this.ani2.gotoAndStop(1)}else{this.ani2.gotoAndStop(2)}}else{if(t>=a){this.ani2.gotoAndStop(0)}else{this.ani2.gotoAndStop(2)}}this.txtbuff.visible=false;this.txtbuff.text=app.getLang("mountain_tips16",i);if(n>=t){if(t>=a){this.ani1.gotoAndStop(2)}else{this.ani1.gotoAndStop(4)}}else{e=e-i;if(game.Context.teamLv>=e){if(this.id==n+1){this.ani1.gotoAndStop(0)}else{this.txtTips.text=app.getLang("mountain_tips11");this.ani1.gotoAndStop(3)}}else{this.ani1.gotoAndStop(3);if(i>0){this.txtbuff.visible=true;this.txtTips.text=app.getLang("mountain_tips4",game.STYLES.GREEN_COLOR_S,e)}else{this.txtTips.text=app.getLang("mountain_tips4",game.STYLES.DESC_TXT_COLOR_S,e)}}}this.btnFast.visible=false};return e}(ui.qiseshan.qiseshanitemnewUI);l.MountainItem=i})(mountain||(mountain={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var newshangcheng;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.NewTouziNtf,this,this.onNewTouziNtf)};Object.defineProperty(e.prototype,"model",{get:function(){return i.NewShangChengModel.getIns()},enumerable:true,configurable:true});e.prototype.init=function(){game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.NEW_SHANG_CHENG,i.NewShangChengView,null,game.ECommonType.DIALOG_TYPE);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.HUO_DONG_GIFT,i.Huodonglibaoview);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.HUO_DONG_GIFT_BZG_UP,i.Huodonglibaoview);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.HUO_DONG_GIFT_DFXXR,i.Huodonglibaoview);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.HUO_DONG_GIFT_YYJS,i.Huodonglibaoview);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.HUO_DONG_GIFT_ZYCMR,i.Huodonglibaoview);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.XIANSHI_TEHUI_LIBAO,i.XianshitehuilibaoView);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.XIANSHI_TEHUI_LIBAO_2,i.XianshitehuilibaoView);if(this.model.cztcStyle==1){game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.CHENG_ZHAN_JIJING,chengzhanjijing.ChengZhanJiJingView);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.TOUZI_LICAI,touzilic.TouZiLiCaiView)}else{game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.CHAO_ZHI_JI_JING,i.ChengZhangJingJinNewView);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.CHAO_ZHI_LI_CAI,i.TouZiLiCaiNewView)}app.ViewManager.regist(i.TouZiLiCaiNewView,"zhanling.atlas");app.ViewManager.regist(i.ChengZhangJingJinNewView,"zhanling.atlas");app.ViewManager.regist(i.ChengZhangJingJinNewView,"zhanling.atlas");game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.ZHU_TI_HUODONG,i.ZhutihuodongView,null,game.ECommonType.COMMON_SHANG_CHENG_WITHOUT_BTN);game.RoleModel.getIns().on(game.RoleModel.EVENTS.TEAM_LEVEL_CHANGE,this,this.onTeamLvChange);main.MainUIIcon.iconClassMap[csv.MainIconProxy.TYPE_ICON_SHANGCHNEG]=i.NewShangChengIcon;main.MainUIIcon.iconClassMap[csv.MainIconProxy.TYPE_ICON_YUANBAO_SHANGCHNEG]=i.YuanBaoShopIcon;this.ticket=86400+game.Context.getServerZeroTime()-game.Context.getServerTime();Laya.timer.once(1e3,this,this.checkKuaitian);this.model.init()};e.prototype.onTeamLvChange=function(){this.model.checkRed()};e.prototype.checkKuaitian=function(){this.ticket--;if(this.ticket<=0){this.model.checkRed();this.model.event(i.NewShangChengEvent.EVENT_TOU_ZI_CHENGZHANG);this.ticket=86400+game.Context.getServerZeroTime()-game.Context.getServerTime()}else{Laya.timer.once(1e3,this,this.checkKuaitian)}};e.prototype.onNewTouziNtf=function(t,e){this.model.investFunddata=e.data;this.model.checkRed();this.model.event(i.NewShangChengEvent.EVENT_TOU_ZI_CHENGZHANG)};return e}(app.ModuleBase);i.NewShangChengModule=t})(newshangcheng||(newshangcheng={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var newshangcheng;(function(h){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.tipUIStack=[];t.tipDataSources=[];t.timeUIStacks=[];t.timeDataSources=[];return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.init=function(){};t.prototype.onSaveSettingsNoti=function(t){this.shownTips=t;this.TryOpen(false)};t.prototype.onActShowIconNoti=function(){if(!this.shownTips)return;this.TryOpen(true)};t.prototype.getActInfo=function(){var t=activitytaren.ActivityTaRenModel.getIns().iconMan.getActVOlist_by_client_type(activitytaren.ActivityTaRenType.XIAN_SHI_TEHUI_LIBAO);for(var e in t){var i=t[e];activitytaren.ActivityTaRenModel.getIns().getInfoByActID(i.actid)}};t.prototype.TryOpen=function(t){Laya.timer.clear(this,this.DoFilter);this.getActInfo();Laya.timer.once(1500,this,this.DoFilter,[t])};t.prototype.DoFilter=function(t){var e=activitytaren.ActivityTaRenModel.getIns().iconMan.getActVOlist_by_client_type(activitytaren.ActivityTaRenType.INVESTMENT);var i;for(var n in e){var a=e[n];this.setDayArray(a.timeVo.startTime);if(this.shownTips.indexOf(e[n].curCfg.tipsid)>=0){continue}if(h.NewShangChengModel.getIns().getTzCzIsBuy(a.actid)){continue}if(a.timeVo.endTime-game.Context.getServerTime()<20){continue}if(t&&game.Context.getServerTime()-a.timeVo.startTime>30){continue}if(!i){i=a}else if(i.timeVo.startTime<a.timeVo.startTime){i=a}else if(i.timeVo.startTime==a.timeVo.startTime&&i.actid<a.actid){i=a}}if(i){if(this.tipUIStack.indexOf(h.ActivityTipView5)==-1){this.tipUIStack.push(h.ActivityTipView5);this.tipDataSources.push([i])}this.pushTimeStack(i.timeVo.startTime,h.ActivityTipView5,[i]);this.shownTips.push(i.curCfg.tipsid)}e=activitytaren.ActivityTaRenModel.getIns().iconMan.getActVOlist_by_client_type(activitytaren.ActivityTaRenType.XIANG_YAO_DING_ZHI);var o;for(var n in e){var a=e[n];this.setDayArray(a.timeVo.startTime);if(this.shownTips.indexOf(e[n].curCfg.tipsid)>=0){continue}if(xianyaodingzhi.XiangyaoDingZhiModel.getIns().isSellOut(a.actid)){continue}if(a.timeVo.endTime-game.Context.getServerTime()<20){continue}if(t&&game.Context.getServerTime()-a.timeVo.startTime>30){continue}if(!o){o=a}else if(o.timeVo.startTime<a.timeVo.startTime){o=a}else if(o.timeVo.startTime==a.timeVo.startTime&&o.actid<a.actid){o=a}}if(o){if(this.tipUIStack.indexOf(h.ActivityTipView6)==-1){this.tipUIStack.push(h.ActivityTipView6);this.tipDataSources.push([o])}this.pushTimeStack(o.timeVo.startTime,h.ActivityTipView6,[o]);this.shownTips.push(o.curCfg.tipsid)}var s=limittimegift.LimitTimeGiftModel.getIns().OpenTipView(t);if(s){this.shownTips.push(s.cfgId);if(this.tipUIStack.indexOf(limittimegift.LimitTimeGiftBuyView)==-1){this.tipUIStack.push(limittimegift.LimitTimeGiftBuyView);this.tipDataSources.push([s.cfgId,false])}this.pushTimeStack(s.stime,limittimegift.LimitTimeGiftBuyView,[s.cfgId,false])}var r;e=activitytaren.ActivityTaRenModel.getIns().iconMan.getActVOlist_by_client_type(activitytaren.ActivityTaRenType.XIAN_SHI_TEHUI_LIBAO);for(var n in e){var a=e[n];this.setDayArray(a.timeVo.startTime);if(this.shownTips.indexOf(e[n].curCfg.tipsid)>=0){continue}if(h.NewShangChengModel.getIns().isLingQuEnd(a.actid)){continue}if(a.timeVo.endTime-game.Context.getServerTime()<20){continue}if(t&&game.Context.getServerTime()-a.timeVo.startTime>30){continue}if(!r){r=a}else if(r.timeVo.startTime<a.timeVo.startTime){r=a}else if(r.timeVo.startTime==a.timeVo.startTime&&r.actid<a.actid){r=a}}if(r){if(this.tipUIStack.indexOf(h.ActivityTipView1)==-1){this.tipUIStack.push(h.ActivityTipView1);this.tipDataSources.push([r])}this.pushTimeStack(r.timeVo.startTime,h.ActivityTipView1,[r]);this.shownTips.push(r.curCfg.tipsid)}var l;e=activitytaren.ActivityTaRenModel.getIns().iconMan.getActVOlist_by_client_type(activitytaren.ActivityTaRenType.MOTIVE_HUO_DONG);for(var n in e){var a=e[n];this.setDayArray(a.timeVo.startTime);if(this.shownTips.indexOf(e[n].curCfg.tipsid)>=0){continue}if(h.NewShangChengModel.getIns().isLingQuEnd(a.actid)){continue}if(a.timeVo.endTime-game.Context.getServerTime()<20){continue}if(t&&game.Context.getServerTime()-a.timeVo.startTime>30){continue}if(!l){l=a}else if(l.timeVo.startTime<a.timeVo.startTime){l=a}else if(l.timeVo.startTime==a.timeVo.startTime&&l.actid<a.actid){l=a}}if(l){switch(l.curCfg.functionid){case csv.FunctionsProxy.ENUMS.HUO_DONG_GIFT_BZG_UP:if(this.tipUIStack.indexOf(h.ActivityTipView)==-1){this.tipUIStack.push(h.ActivityTipView);this.tipDataSources.push([l])}this.pushTimeStack(l.timeVo.startTime,h.ActivityTipView,[l]);break;case csv.FunctionsProxy.ENUMS.HUO_DONG_GIFT_DFXXR:if(this.tipUIStack.indexOf(h.ActivityTipView2)==-1){this.tipUIStack.push(h.ActivityTipView2);this.tipDataSources.push([l])}this.pushTimeStack(l.timeVo.startTime,h.ActivityTipView2,[l]);break;case csv.FunctionsProxy.ENUMS.HUO_DONG_GIFT_YYJS:if(this.tipUIStack.indexOf(h.ActivityTipView3)==-1){this.tipUIStack.push(h.ActivityTipView3);this.tipDataSources.push([l])}this.pushTimeStack(l.timeVo.startTime,h.ActivityTipView3,[l]);break;case csv.FunctionsProxy.ENUMS.HUO_DONG_GIFT_ZYCMR:if(this.tipUIStack.indexOf(h.ActivityTipView4)==-1){this.tipUIStack.push(h.ActivityTipView4);this.tipDataSources.push([l])}this.pushTimeStack(l.timeVo.startTime,h.ActivityTipView4,[l]);break}this.shownTips.push(l.curCfg.tipsid)}this.tryOpenView();game.SystemSetModel.getInstance().synSettingData()};t.prototype.tryOpenView=function(){var t=game.Config.getIntParams(game.ConfigID.ACT_TIP_TYPE);if(t==1){var e=this.timeUIStacks[this.timeUIStacks.length-1];if(e){var i=this.timeUIStacks[this.timeUIStacks.length-1].pop();var n=this.timeDataSources[this.timeDataSources.length-1].pop();if(i){app.ViewManager.toggleDialog(i,1,0,n)}return!!i}else{return false}}else if(t==0){var i=this.tipUIStack.pop();var n=this.tipDataSources.pop();if(i){app.ViewManager.toggleDialog(i,1,0,n)}return!!i}};t.prototype.resetArray=function(){this.shownTips=[];game.SystemSetModel.getInstance().synSettingData()};t.prototype.test=function(t){var e=new activitytaren.ActivityTaRenVO(t);switch(e.curCfg.functionid){case csv.FunctionsProxy.ENUMS.HUO_DONG_GIFT_BZG_UP:app.ViewManager.toggleDialog(h.ActivityTipView,1,0,[e]);break;case csv.FunctionsProxy.ENUMS.HUO_DONG_GIFT_DFXXR:app.ViewManager.toggleDialog(h.ActivityTipView2,1,0,[e]);break;case csv.FunctionsProxy.ENUMS.HUO_DONG_GIFT_YYJS:app.ViewManager.toggleDialog(h.ActivityTipView3,1,0,[e]);break;case csv.FunctionsProxy.ENUMS.HUO_DONG_GIFT_ZYCMR:app.ViewManager.toggleDialog(h.ActivityTipView4,1,0,[e]);break}};t.prototype.setDayArray=function(t){var e=Math.floor((t-8*3600)/86400);if(!this.timeUIStacks[e]){this.timeUIStacks[e]=[];this.timeDataSources[e]=[]}};t.prototype.pushTimeStack=function(t,e,i){var n=Math.floor((t-8*3600)/86400);if(this.timeUIStacks[n].indexOf(e)==-1){this.timeUIStacks[n].push(e);this.timeDataSources[n].push(i)}};t.SINGLE_KEY="newshangcheng.ActivityTipModel";return t}(app.ModelBase);h.ActivityTipModel=t})(newshangcheng||(newshangcheng={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var newshangcheng;(function(h){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.scPop=new h.PopTipsVo([activitytaren.ActivityTaRenType.MOTIVE_HUO_DONG,activitytaren.ActivityTaRenType.QI_RI_LEI_CHONG,activitytaren.ActivityTaRenType.XIAN_SHI_TEHUI_LIBAO]);t.ybPop=new h.PopTipsVo([activitytaren.ActivityTaRenType.ZERO]);return t}t.getIns=function(){return app.Singleton.getInstance(t)};Object.defineProperty(t.prototype,"cztcStyle",{get:function(){return parseInt(app.getLang("touzichengzhang"))},enumerable:true,configurable:true});t.prototype.init=function(){var t=game.Config.getParams(1255).split("-");this.longTime=parseInt(t[0]);this.closeTipsTime=parseInt(t[1]);this.popList=[];this.popList.push(this.scPop,this.ybPop)};t.prototype.getInvestFundData=function(t){if(this.investFunddata){for(var e=0;e<this.investFunddata.length;e++){if(this.investFunddata[e].cfgId==t){return this.investFunddata[e]}}}};t.prototype.touziCheckRed=function(){if(this.investFunddata){for(var t=0;t<this.investFunddata.length;t++){var e=csv.TouZiLiCaiProxy.getIns().getAllCfgid(this.investFunddata[t].cfgId);for(var i=0;i<e.length;i++){var n=this.getTouStatus(e[i].id);if(n==o.CanLingQu){return true}}}}return false};t.prototype.sortHandler=function(t,e){var i=csv.RechargeProxy.getIns().cfgMap[parseInt(t.p1)];var n=csv.RechargeProxy.getIns().cfgMap[parseInt(e.p1)];if(!i){console.warn("activitytaren id:"+t.id+"p1 recharge :"+t.p1);return 0}if(!n){console.warn("activitytaren id:"+e.id+"p1 recharge :"+e.p1);return 0}if(i.recharge>n.recharge){return 1}else if(i.recharge<n.recharge){return-1}return 0};t.prototype.sortList=function(t){var e=t.cfgList;var i=[];for(var n=0;n<e.length;n++){if(!this.isSellout(t,e[n].id)){i.push(e[n])}}i.sort(this.sortHandler);for(var n=0;n<e.length;n++){if(this.isSellout(t,e[n].id)){i.push(e[n])}}return i};t.prototype.getTzCzIsBuy=function(t){if(this.investFunddata){for(var e=0;e<this.investFunddata.length;e++){var i=this.investFunddata[e];var n=csv.ActivityTarenProxy.getIns().cfgMap[i.cfgId];if(n&&n.activityid==t&&i.buyTime!=0){return true}}}};t.prototype.onLiBaoAction=function(t,e){if(!t.isopen){manager.FlowManager.instance.flowByStyle1(app.getLang("huodong_text_14"))}else{var i=t.getSubInfo(e.id);if(!i){return}if(i.status==activitytaren.ActivityTaRenLingQuStatus.IS_ALREADY_LING_QU){}else{var n=csv.RechargeProxy.getIns().cfgMap[parseInt(e.p1)];if(!n){game.Alert.show("recharge.csv id"+e.p1+"不存在!activity_taren id = "+e.id+" p1")}else{if(n.recharge==0){app.ProtocolRequest.RecvActPrizeReq(e.id,1)}else{app.ViewManager.toggleDialog(h.HuodonglibaoTip,1,0,[e,t])}}}}};t.prototype.isChengZhangJijingFinish=function(){if(this.investFunddata){for(var t=0;t<this.investFunddata.length;t++){var e=csv.ChengZhanJiJingProxy.getIns().getCfgList(this.investFunddata[t].cfgId);if(e.length>0){var i=0;for(var n=0;n<e.length;n++){var a=this.getChengZhangStatus(e[n].id);if(a==s.IsLingQued){i++}}if(i>=e.length){return true}}}}return false};t.prototype.isTouZiLiCaiFinish=function(){if(this.investFunddata){for(var t=0;t<this.investFunddata.length;t++){var e=csv.TouZiLiCaiProxy.getIns().getAllCfgid(this.investFunddata[t].cfgId);if(e.length>0){var i=0;for(var n=0;n<e.length;n++){var a=this.getTouStatus(e[n].id);if(a==o.IsLingQued){i++}}if(i>=e.length){return true}}}}return false};t.prototype.chengZhangCheckRed=function(){if(this.investFunddata){for(var t=0;t<this.investFunddata.length;t++){var e=csv.ChengZhanJiJingProxy.getIns().getCfgList(this.investFunddata[t].cfgId);for(var i=0;i<e.length;i++){var n=this.getChengZhangStatus(e[i].id);if(n==s.CanLingQu){return true}}}}return false};t.prototype.doRedCheck=function(t){if(huodong.HuoDongShangChengProxy.getIns().funcidlist.indexOf(t)!=-1){this.checkRed()}};t.prototype.checkRed=function(){if(this.touziCheckRed()){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.CHAO_ZHI_LI_CAI)}else{game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.CHAO_ZHI_LI_CAI)}if(this.chengZhangCheckRed()){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.CHAO_ZHI_JI_JING)}else{game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.CHAO_ZHI_JI_JING)}if(meiritehui.MeiRITeHuiModel.getIns().refreshReds()){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.MEI_RI_TE_HUI)}else{game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.MEI_RI_TE_HUI)}huodong.WeekMonthForeverModel.getIns().updateRedActs()};t.prototype.getTouStatus=function(t){var e=csv.TouZiLiCaiProxy.getIns().map[t];var i=this.getInvestFundData(e.cfgid);if(i){if(i.vecReward){if(i.vecReward.indexOf(t)>=0){return o.IsLingQued}}var n=(game.Context.getServerZeroTime()-i.buyTime)/86400+1;if(e.day>n){return o.NotLingTime}return o.CanLingQu}return o.NotChongZhi};t.prototype.getChengZhangStatus=function(t){var e=csv.ChengZhanJiJingProxy.getIns().cfgMap[t];var i=this.getInvestFundData(e.cfgid);if(i){if(i.vecReward){if(i.vecReward.indexOf(t)>=0){return s.IsLingQued}}if(game.Context.teamLv>=e.limit){return s.CanLingQu}return s.BuKeLingQu}return s.NotChongZhiBuKeLingQu};t.prototype.getIconList=function(){var t=huodong.HuoDongShangChengProxy.getIns().shangchengiconList;var e=[];for(var i=0;i<t.length;i++){var n=t[i];if(n.functionid!=""){var a=n.functionid.split(";");var o=[];for(var s=0;s<a.length;s++){var r=parseInt(a[s]);if(csv.FunctionsProxy.getIns().isOpen(r)){o.push(r)}}if(o.length>0){var l=new h.NewShangChangFuncVo;l.cfg=n;l.funids=o;e.push(l)}}}return e};t.prototype.hasOpen=function(){var t=huodong.HuoDongShangChengProxy.getIns().shangchengiconList;for(var e=0;e<t.length;e++){var i=t[e];if(i.functionid!=""){var n=i.functionid.split(";");for(var a=0;a<n.length;a++){var o=parseInt(n[a]);if(csv.FunctionsProxy.getIns().isOpen(o)){return true}}}}return false};t.prototype.setListVaule=function(t,e){var i=game.ItemUtil.parserList(e);t.array=i;t.width=(t.spaceX+100)*i.length};t.prototype.checkHuoDong=function(){for(var t=0;t<this.popList.length;t++){this.popList[t].checkHuoDong()}this.event(i.EVENT_UPDATE_XIN)};t.prototype.delXin=function(t){for(var e=0;e<this.popList.length;e++){this.popList[e].delXin(t)}};t.prototype.isLingQuEnd=function(t){var e=activitytaren.ActivityTaRenModel.getIns().iconMan.getActVoByActid(t);if(e){var i=e.cfgList;var n=0;for(var a=0;a<i.length;a++){var o=i[a];var s=e.getSubInfo(o.id);if(s){if(s.num==0||s.status==activitytaren.ActivityTaRenLingQuStatus.IS_ALREADY_LING_QU){n++}}}if(n>=i.length){return true}}return false};t.prototype.isXinCanShow=function(t){for(var e=0;e<this.popList.length;e++){if(this.popList[e].find(t)){return true}}return false};t.prototype.updateView=function(){if(app.ViewManager.DisplayedInStage(h.NewShangChengView.SINGLE_KEY)){h.NewShangChengView.getIns().onUpdateShangCheng()}};t.prototype.isSubjectOpen=function(){var t=csv.SubjectProxy.getIns().arr;for(var e=0;e<t.length;e++){var i=t[e];if(activitytaren.ActivityTaRenModel.getIns().iconMan.getActVoByActid(i.activityid)){return true}}return false};t.prototype.onSort=function(t,e){if(t.starttime>e.starttime){return-1}else if(t.starttime<e.starttime){return 1}return 0};t.prototype.getSubOpenList=function(){var t=[];var e=[];var i=csv.SubjectProxy.getIns().arr;for(var n=0;n<i.length;n++){var a=i[n];var o=activitytaren.ActivityTaRenModel.getIns().iconMan.getActVoByActid(a.activityid);if(o){var s=new r;s.cfgid=a.id;s.starttime=o.timeVo.startTime;e.push(s)}}e.sort(this.onSort);for(var n=0;n<e.length;n++){t.push(csv.SubjectProxy.getIns().cfgMap[e[n].cfgid])}return t};t.prototype.checkSubjectRed=function(){var t=false;var e=csv.SubjectProxy.getIns().arr;for(var i=0;i<e.length;i++){var n=e[i];var a=activitytaren.ActivityTaRenModel.getIns().iconMan.getActVoByActid(n.activityid);if(a){var o=activitytaren.ActivityTaRenModel.getIns().hasRedByFuncid(a.funid);if(o){t=true;break}}}var s=csv.FunctionsProxy.ENUMS.ZHU_TI_HUODONG;if(t){game.ClosureManager.addDot(s)}else{game.ClosureManager.removeDot(s)}};t.prototype.isSellout=function(t,e){var i=t.getSubInfo(e);if(i){if(i.num==0||i.status==activitytaren.ActivityTaRenLingQuStatus.IS_ALREADY_LING_QU){return true}}return false};t.prototype.chengZhangJiJingsortHandler=function(t){var e=[];for(var i=0;i<t.length;i++){if(this.getChengZhangStatus(t[i].id)!=s.IsLingQued){e.push(t[i])}}for(var i=0;i<t.length;i++){if(this.getChengZhangStatus(t[i].id)==s.IsLingQued){e.push(t[i])}}return e};t.prototype.touzi=function(t){game.Alert.show(app.getLang("xinshangcheng_06",app.convert_Yuan(t.recharge)),new Laya.Handler(this,this.onTouziOkHandler,[t]))};t.prototype.onTouziOkHandler=function(t){shop.ShopModel.getIns().chongzhi(t.id)};t.SINGLE_KEY="newshangcheng.NewShangChengModel";return t}(app.ModelBase);h.NewShangChengModel=t;var r=function(){function t(){}return t}();var i=function(){function t(){}t.EVENT_TOU_ZI_CHENGZHANG="EVENT_TOU_ZI_CHENGZHANG";t.EVENT_UPDATE_ICON="EVENT_UPDATE_ICON";t.EVENT_UPDATE_XIN="EVENT_UPDATE_XIN";return t}();h.NewShangChengEvent=i;var o;(function(t){t[t["NotChongZhi"]=1]="NotChongZhi";t[t["IsLingQued"]=2]="IsLingQued";t[t["NotLingTime"]=3]="NotLingTime";t[t["CanLingQu"]=4]="CanLingQu"})(o=h.ETouZiLingQu||(h.ETouZiLingQu={}));var s;(function(t){t[t["CanLingQu"]=1]="CanLingQu";t[t["IsLingQued"]=2]="IsLingQued";t[t["BuKeLingQu"]=3]="BuKeLingQu";t[t["NotChongZhiBuKeLingQu"]=4]="NotChongZhiBuKeLingQu"})(s=h.EChengZhangJinjing||(h.EChengZhangJinjing={}))})(newshangcheng||(newshangcheng={}));var newshangcheng;(function(m){var l=function(){function t(){this.actidMap={}}t.prototype.hasRed=function(){for(var t in this.actidMap){if(this.actidMap[t]==true){return true}}return false};return t}();var I=function(){function t(t,e){this.actid=t;this.handler=e}return t}();var t=function(){function r(t){this.funcids=[];this.xinList=[];this.types=t}r.prototype.isNeedPop=function(){return this.needShowTicket>0};r.prototype.isNewSecKill=function(t){var e=xianshimiaosha.XianShiMiaoShaModle.getIns().getStartTime(t);if(!activitytaren.ActivityTaRenModel.getIns().isCheckTime(e)){return false}return true};r.prototype.find=function(t){for(var e=0;e<this.xinList.length;e++){var i=this.xinList[e];if(i.actid==t&&i.canShow()){return true}}return false};r.prototype.checkHuoDong=function(){var t=this.types;var e=[];for(var i=0;i<t.length;i++){var n=t[i];var a=this.actmodel.iconMan.getActVOlist_by_client_type(n);if(a){for(var o=0;o<a.length;o++){var s=a[o];if(n==activitytaren.ActivityTaRenType.ZERO){for(var r=0;r<s.curCfgList.length;r++){var l=s.curCfgList[r];var h=new Laya.Handler(s,s.isNewHuoDong);if(h.run()){e.push(new I(l.tipsid,h))}}}else{var h=new Laya.Handler(s,s.isNewHuoDong);if(h.run()){e.push(new I(s.actid,h))}}}}}if(this.xianshiMiaoShalist){if(this.xianshiMiaoShalist){var p=this.xianshiMiaoShalist;for(var o=0;o<p.length;o++){var u=p[o].cfg_id;var h=new Laya.Handler(this,this.isNewSecKill,[u]);if(h.run()){var c=csv.XianShiMiaoShaProxy.getIns().getCfg(u);if(!c){game.Alert.show("seckill.csv id:"+u+" 不存在,检查seckill,recharge关联的数据")}e.push(new I(c.actid,h))}}}}if(this.timeGiftData){for(var o=0;o<this.timeGiftData.length;o++){var s=this.timeGiftData[o];var g=csv.GoldTimeGiftProxy.getIns().getCfg(s.cfgId);if(!g){game.Alert.show("gold_timegift.csv id:"+s.cfgId+" 不存在")}var f=activitytaren.ActivityTaRenModel.getIns();var h=new Laya.Handler(f,f.isCheckTime,[s.stime]);if(h.run()){e.push(new I(g.actid,h))}}}while(e.length){var d=e.shift();var y=d.actid;if(game.SystemSetModel.getInstance().hasActid(y)){var v=this.getFuncid(y);for(var o=0;o<v.length;o++){var _=v[o];if(_){this.startRemoveXin(y,_)}}}else{this.refreshXin(d.actid,d.handler)}}if(this.isNeedShowTips()){if(!this.tipsOpened){this.tipsOpened=true;this.needShowTicket=this.model.closeTipsTime;this.onTimeShowCheck()}}else{Laya.timer.clear(this,this.onTimeShowCheck);Laya.timer.clear(this,this.onCheckLongime);this.needShowTicket=0}this.model.event(m.NewShangChengEvent.EVENT_UPDATE_ICON)};r.prototype.delXin=function(t){for(var e=0;e<this.xinList.length;e++){var i=this.xinList[e];if(i.actid==t){i.isWatch=true}}var n=this.getFuncid(t);var a=false;var o=false;for(var e=0;e<n.length;e++){var s=n[e];if(s){this.startRemoveXin(t,s);game.SystemSetModel.getInstance().saveAct(t);a=true;if(s==csv.FunctionsProxy.ENUMS.XIANSHIMIAOSHA_SHOP){o=true}}}if(a){this.checkHuoDong()}if(o){xianshimiaosha.XianShiMiaoShaModle.getIns().event(xianshimiaosha.XianShiMiaoShaModle.EVENTS.UPDATE_MAIN_VIEW)}};Object.defineProperty(r.prototype,"model",{get:function(){return m.NewShangChengModel.getIns()},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"actmodel",{get:function(){return activitytaren.ActivityTaRenModel.getIns()},enumerable:true,configurable:true});r.prototype.onTimeShowCheck=function(){this.needShowTicket--;if(this.needShowTicket>0){Laya.timer.once(1e3,this,this.onTimeShowCheck)}else{this.model.event(m.NewShangChengEvent.EVENT_UPDATE_ICON);this.nextTimeTicket=this.model.longTime;this.onCheckLongime()}};r.prototype.isNeedShowTips=function(){for(var t=0;t<this.xinList.length;t++){var e=this.xinList[t];if(e.canShow()){return true}}};r.prototype.onCheckLongime=function(){this.nextTimeTicket--;if(this.nextTimeTicket<0){this.tipsOpened=false;this.checkHuoDong()}else{Laya.timer.once(1e3,this,this.onCheckLongime)}};r.prototype.startRemoveXin=function(t,e){var i=true;var n=r.redKeyList;for(var a=0;a<n.length;a++){var o=n[a];if(o.funcid==e){if(o.actidMap[t]==true){o.actidMap[t]=false}if(o.hasRed()){i=false}break}}if(i){game.ClosureManager.removeXin(e);var s=this.funcids.indexOf(e);if(s!=-1){this.funcids.splice(s,1)}}if(window["DEBUG"]){}};r.prototype.startAddXin=function(t,e){var i=r.redKeyList;var n=false;for(var a=0;a<i.length;a++){var o=i[a];if(o.funcid==e){o.actidMap[t]=true;n=true;break}}if(!n){var s=new l;s.actidMap[t]=true;s.funcid=e;r.redKeyList.push(s)}game.ClosureManager.addXin(e);if(this.funcids.indexOf(e)==-1){this.funcids.push(e)}if(window["DEBUG"]){}};r.prototype.refreshXin=function(t,e){var i=false;var n=false;for(var a=0;a<this.xinList.length;a++){var o=this.xinList[a];if(o.actid==t){i=true;o.checkHander=e;if(o.canShow()){n=true}}}if(!i){var s=new h;s.actid=t;s.checkHander=e;this.xinList.push(s);n=true}if(n){var r=this.getFuncid(t);for(var a=0;a<r.length;a++){var l=r[a];if(l){if(game.SystemSetModel.getInstance().hasActid(t)){this.startRemoveXin(t,l)}else{this.startAddXin(t,l)}}}}};r.prototype.getFuncid=function(t){var e=csv.ActivityTarenProxy.getIns().getCfgByActivityid(t);if(e){return[e.functionid]}else{var i=csv.GoldTimeGiftProxy.getIns().actidMap[t];if(i){return[csv.FunctionsProxy.ENUMS.XIANSHILIBAO]}else{var n=csv.XianShiMiaoShaProxy.getIns().actidMap[t];if(n){return[csv.FunctionsProxy.ENUMS.XIANSHIMIAOSHA_SHOP]}else{for(var a=0;a<csv.ActivityTarenProxy.getIns().allList.length;a++){var o=csv.ActivityTarenProxy.getIns().allList[a];if(o.tipsid==t&&o.client_type==activitytaren.ActivityTaRenType.ZERO){return[csv.FunctionsProxy.ENUMS.LING_YUAN_GOU_LIST,csv.FunctionsProxy.ENUMS.LING_YUAN_GOU_MONEY]}}}}}};r.redKeyList=[];return r}();m.PopTipsVo=t;var h=function(){function t(){}t.prototype.canShow=function(){if(!this.checkHander.run()){return false}if(this.hasAct(this.actid)){return false}if(this.isWatch){return false}return true};t.prototype.hasAct=function(t){return game.SystemSetModel.getInstance().hasActid(t)};return t}()})(newshangcheng||(newshangcheng={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("subject_shouna.csv");this.arr=t.getArray();this.cfgMap=t.getMap("id");this.actidList=[];for(var e=0;e<this.arr.length;e++){if(this.actidList.indexOf(this.arr[e].activityid)==-1){this.actidList.push(this.arr[e].activityid)}}t=app.Config.getResById("subject_eject.csv");this.ejectArr=t.getArray();this.ejectActIds=[];this.ejectActidArr=t.getMap("activityid");for(var e=0;e<this.ejectArr.length;e++){if(this.ejectArr[e].type==4){if(this.ejectActIds.indexOf(this.ejectArr[e].activityid)==-1){this.ejectActIds.push(this.ejectArr[e].activityid)}}}};e.SINGLE_KEY="csv.SubjectProxy";return e}(app.ModelBase);t.SubjectProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var newshangcheng;(function(i){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.label="";return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.daoju.itemRender=grids.GridView;this.daoju.renderHandler=grids.GridView.CommonItemRender;this.btngoumai.clickHandler=new Laya.Handler(this,this.onBtngoumaiClick);this.activityTimeView=new activitytaren.ActivityTimeView(this.labelmiaoshu5,new Laya.Handler(this,this.endTimeCallBack),app.getLang("huodong_text05"))};t.prototype.endTimeCallBack=function(){this.activityTimeView.stop();this.activityTimeView.text=app.getLang("huodong_text06")};t.prototype.onDisplay=function(){this.callLater(this.refreshAll);guide.GuideModel.getIns().boOpen=false;this.callLater(this.startTimer)};t.prototype.startTimer=function(){this.activityTimeView.start(this.dataSource[0].timeVo.endTime)};t.prototype.onUnDisplay=function(){guide.GuideModel.getIns().boOpen=true;this.activityTimeView.stop()};t.prototype.onClosed=function(){i.ActivityTipModel.getIns().tryOpenView()};t.prototype.refreshAll=function(){var t=this.dataSource[0];var e=csv.SubjectProxy.getIns().ejectActidArr[t.actid];if(e){this.daoju.array=game.ItemUtil.parserList(e.reveal);this.imgdi.skin=e.title;this.imgtishi.skin=e.p1;this.imgwa.skin=e.p2;this.imgzhuangshi2.skin=e.cp1}};t.prototype.onBtngoumaiClick=function(){var t=this.dataSource[0];this.callLater(game.ClosureManager.callFunctionDontCloseAll,[t.funid]);this.close()};t.SINGLE_KEY="newshangcheng.ActivityTipView";return t}(ui.xinshangcheng2.baozanggeviewUI);i.ActivityTipView=t})(newshangcheng||(newshangcheng={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var newshangcheng;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.daojubox.itemRender=n;this.daojubox.renderHandler=new Laya.Handler(this,this.onRenderHander);this.btnqianwang.clickHandler=new Laya.Handler(this,this.onBtnClick)};e.prototype.onBtnClick=function(){var t=this.dataSource[0];this.callLater(game.ClosureManager.callFunctionDontCloseAll,[t.funid]);this.close()};e.prototype.onDisplay=function(){this.callLater(this.refreshAll);guide.GuideModel.getIns().boOpen=false};e.prototype.onUnDisplay=function(){guide.GuideModel.getIns().boOpen=true};e.prototype.onClosed=function(){i.ActivityTipModel.getIns().tryOpenView()};e.prototype.refreshAll=function(){var t=this.dataSource[0];var e=csv.SubjectProxy.getIns().ejectActidArr[t.actid];if(e){this.daojubox.array=game.ItemUtil.parserList(e.reveal);this.labelwenan.text=app.getLang(e.p1);this.imgtishi.skin=e.title}};e.prototype.onRenderHander=function(t,e){t.setData(t.dataSource)};e.SINGLE_KEY="newshangcheng.ActivityTipView1";return e}(ui.xinshangcheng2.xianshitehuilibaotipUI);i.ActivityTipView1=t;var n=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this)};e.prototype.setData=function(t){this.gezi.setData(t);this.labelmiaoshu.text=app.getLang("xianshilibaoTip_"+t.itemCfg.id);this.labelmingzi.text=t.getName()};return e}(ui.xinshangcheng2.xianshitehuilibaogeziitemUI)})(newshangcheng||(newshangcheng={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var newshangcheng;(function(i){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.ChenghaoImgs=[];t.ChenghaoAnis=[];t.ChenghaoLoading=[];t.label="";return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.qianwangbtn.clickHandler=new Laya.Handler(this,this.onBtnClick);this.activityTimeView=new activitytaren.ActivityTimeView(this.shijian,new Laya.Handler(this,this.endTimeCallBack),app.getLang("huodong_text05"))};t.prototype.endTimeCallBack=function(){this.activityTimeView.stop();this.activityTimeView.text=app.getLang("huodong_text06")};t.prototype.onBtnClick=function(){var t=this.dataSource[0];this.callLater(game.ClosureManager.callFunctionDontCloseAll,[t.funid]);this.close()};t.prototype.onDisplay=function(){this.callLater(this.refreshAll);this.ChenghaoImgs=[this.chenghao1,this.chenghao2,this.chenghao3,this.chenghao4];this.ChenghaoPos=[this.texiao1,this.texiao2,this.texiao3,this.texiao4];guide.GuideModel.getIns().boOpen=false;this.callLater(this.startTimer)};t.prototype.startTimer=function(){this.activityTimeView.start(this.dataSource[0].timeVo.endTime)};t.prototype.onUnDisplay=function(){guide.GuideModel.getIns().boOpen=true;this.activityTimeView.stop()};t.prototype.onClosed=function(){i.ActivityTipModel.getIns().tryOpenView()};t.prototype.refreshAll=function(){var t=this.dataSource[0];var e=csv.SubjectProxy.getIns().ejectActidArr[t.actid];if(e){this.titlebg.skin=e.title;this.wenanimg.skin=e.p1;var i=e.p2.split(";");for(var n in i){var a=i[n];if(a.indexOf(".png")!=-1){var o=this.ChenghaoImgs[n];o.skin=a;o.visible=true;this.ChenghaoPos[n].visible=false}else if(a.indexOf(".ani")!=-1){this.ChenghaoPos[n].visible=true;this.ChenghaoImgs[n].visible=false;var s=this.ChenghaoAnis[n];if(!s){this.ChenghaoAnis[n]=new Laya.Animation;s=this.ChenghaoAnis[n];Laya.loader.load(a.replace(".ani",".atlas"),Laya.Handler.create(this,this.onLoadPicDone,[s,a]),null,Laya.Loader.ATLAS)}else{Laya.loader.load(a.replace(".ani",".atlas"),Laya.Handler.create(this,this.onLoadPicDone,[s,a]),null,Laya.Loader.ATLAS)}this.ChenghaoPos[n].removeChildren();this.ChenghaoPos[n].addChild(s)}}this.waimg.skin=e.cp1}};t.prototype.onLoadPicDone=function(t,e){t.source=e;t.play()};t.SINGLE_KEY="newshangcheng.ActivityTipView2";return t}(ui.xinshangcheng2.dianfengxiuxianriUI);i.ActivityTipView2=t})(newshangcheng||(newshangcheng={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var newshangcheng;(function(i){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.label="";return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.daoju.itemRender=grids.GridView;this.daoju.renderHandler=grids.GridView.CommonItemRender;this.btngoumai.clickHandler=new Laya.Handler(this,this.onBtnClick);this.activityTimeView=new activitytaren.ActivityTimeView(this.labeltime,new Laya.Handler(this,this.endTimeCallBack),app.getLang("huodong_text05"))};t.prototype.endTimeCallBack=function(){this.activityTimeView.stop();this.activityTimeView.text=app.getLang("huodong_text06")};t.prototype.onBtnClick=function(){var t=this.dataSource[0];this.callLater(game.ClosureManager.callFunctionDontCloseAll,[t.funid]);this.close()};t.prototype.onDisplay=function(){this.callLater(this.refreshAll);guide.GuideModel.getIns().boOpen=false;this.boxdaoju.width=217;this.daoju.centerX=0;this.daoju.anchorX=.5;this.daoju.repeatX=NaN;this.daoju.repeatY=1;this.callLater(this.startTimer)};t.prototype.startTimer=function(){this.activityTimeView.start(this.dataSource[0].timeVo.endTime)};t.prototype.onUnDisplay=function(){guide.GuideModel.getIns().boOpen=true;this.activityTimeView.stop()};t.prototype.onClosed=function(){i.ActivityTipModel.getIns().tryOpenView()};t.prototype.refreshAll=function(){var t=this.dataSource[0];var e=csv.SubjectProxy.getIns().ejectActidArr[t.actid];if(e){var i=game.ItemUtil.parserList(e.reveal);this.daoju.array=i;this.imgdiban.skin=e.title;this.imgbiaoyu01.skin=e.p1;this.imgbiaoyu02.skin=e.p2}};t.SINGLE_KEY="newshangcheng.ActivityTipView3";return t}(ui.xinshangcheng2.yaoqianjinshuviewUI);i.ActivityTipView3=t})(newshangcheng||(newshangcheng={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var newshangcheng;(function(i){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.label="";return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.daojulist.itemRender=grids.GridView;this.daojulist.renderHandler=grids.GridView.CommonItemRender;this.buybtn.clickHandler=new Laya.Handler(this,this.onBtnClick);this.activityTimeView=new activitytaren.ActivityTimeView(this.shijian,new Laya.Handler(this,this.endTimeCallBack),app.getLang("huodong_text05"))};t.prototype.endTimeCallBack=function(){this.activityTimeView.stop();this.activityTimeView.text=app.getLang("huodong_text06")};t.prototype.onBtnClick=function(){var t=this.dataSource[0];this.callLater(game.ClosureManager.callFunctionDontCloseAll,[t.funid]);this.close()};t.prototype.onDisplay=function(){this.callLater(this.refreshAll);guide.GuideModel.getIns().boOpen=false;this.callLater(this.startTimer)};t.prototype.startTimer=function(){this.activityTimeView.start(this.dataSource[0].timeVo.endTime)};t.prototype.onUnDisplay=function(){guide.GuideModel.getIns().boOpen=true;this.activityTimeView.stop()};t.prototype.onClosed=function(){i.ActivityTipModel.getIns().tryOpenView()};t.prototype.refreshAll=function(){var t=this.dataSource[0];var e=csv.SubjectProxy.getIns().ejectActidArr[t.actid];if(e){this.daojulist.array=game.ItemUtil.parserList(e.reveal);this.ditu.skin=e.title;this.wenzi.skin=e.cp2;this.zhanshiimg.skin=e.cp1}};t.SINGLE_KEY="newshangcheng.ActivityTipView4";return t}(ui.xinshangcheng2.zhanyaochumoriUI);i.ActivityTipView4=t})(newshangcheng||(newshangcheng={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var newshangcheng;(function(i){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.label="";return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.touzibtn.clickHandler=new Laya.Handler(this,this.onBtnClick)};t.prototype.onBtnClick=function(){var t=this.dataSource[0];this.callLater(game.ClosureManager.callFunctionDontCloseAll,[t.funid]);this.close()};t.prototype.onDisplay=function(){this.callLater(this.refreshAll);guide.GuideModel.getIns().boOpen=false};t.prototype.onUnDisplay=function(){guide.GuideModel.getIns().boOpen=true};t.prototype.onClosed=function(){i.ActivityTipModel.getIns().tryOpenView()};t.prototype.refreshAll=function(){var t=this.dataSource[0];var e=csv.SubjectProxy.getIns().ejectActidArr[t.actid];if(e){this.imgdi.skin=e.title;this.zi2.skin=e.p1;this.fanlishuzhi.value=e.p3;this.zibox.visible=!!e.cp2;this.zi2.visible=!e.cp2;if(e.cp2){this.yuanbaoclip.value=e.cp2}else{this.zi2.skin=e.cp1}}};t.SINGLE_KEY="newshangcheng.ActivityTipView5";return t}(ui.xinshangcheng2.touzilicaidalianUI);i.ActivityTipView5=t})(newshangcheng||(newshangcheng={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var newshangcheng;(function(i){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.label="";return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.btnlijiqianwang.clickHandler=new Laya.Handler(this,this.onBtnClick);this.activityTimeView=new activitytaren.ActivityTimeView(this.txttime,new Laya.Handler(this,this.endTimeCallBack),app.getLang("huodong_text05"))};t.prototype.endTimeCallBack=function(){this.activityTimeView.stop();this.activityTimeView.text=app.getLang("huodong_text06")};t.prototype.onBtnClick=function(){var t=this.dataSource[0];this.callLater(game.ClosureManager.callFunctionDontCloseAll,[t.funid]);this.close()};t.prototype.onDisplay=function(){this.callLater(this.refreshAll);guide.GuideModel.getIns().boOpen=false;this.callLater(this.startTimer)};t.prototype.startTimer=function(){this.activityTimeView.start(this.dataSource[0].timeVo.endTime)};t.prototype.onUnDisplay=function(){guide.GuideModel.getIns().boOpen=true;this.activityTimeView.stop()};t.prototype.onClosed=function(){i.ActivityTipModel.getIns().tryOpenView()};t.prototype.refreshAll=function(){var t=this.dataSource[0];var e=csv.SubjectProxy.getIns().ejectActidArr[t.actid];if(e){this.imgguanggao.skin=e.p1}};t.SINGLE_KEY="newshangcheng.ActivityTipView6";return t}(ui.xiangyaodingzhi.xiangyaodingzhidaliantipUI);i.ActivityTipView6=t})(newshangcheng||(newshangcheng={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var newshangcheng;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.timec=new activitytaren.ActivityTimeView(this.labeldaojishi,new Laya.Handler(this,this.endHandler),app.getLang("huodong_text09"));this.timec.stopHadnler=new Laya.Handler(this,this.endHandler);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.xiala.scrollRectOffY=20;this.xiala.itemRender=n;this.xiala.renderHandler=new Laya.Handler(this,this.onRenderHandler);this.touzibtn.clickHandler=new Laya.Handler(this,this.onClickHandler)};e.prototype.onClickHandler=function(){this.model.touzi(this.rechargeCfg)};e.prototype.setBtnEffect=function(t){if(t){this.guangxiao.visible=true;this.guangxiao.play(0,true)}else{this.guangxiao.visible=false;this.guangxiao.stop()}};e.prototype.onRenderHandler=function(t,e){t.setData(t.dataSource)};e.prototype.endHandler=function(){this.labeldaojishi.text=""};e.prototype.onDisplay=function(){this.model.on(i.NewShangChengEvent.EVENT_TOU_ZI_CHENGZHANG,this,this.refreshAll);game.RoleModel.getIns().on(game.RoleModel.EVENTS.TEAM_LEVEL_CHANGE,this,this.refreshAll);this.callLater(this.refreshAll)};Object.defineProperty(e.prototype,"model",{get:function(){return i.NewShangChengModel.getIns()},enumerable:true,configurable:true});e.prototype.onUnDisplay=function(){this.setBtnEffect(false);this.timec.stop();this.model.off(i.NewShangChengEvent.EVENT_TOU_ZI_CHENGZHANG,this,this.refreshAll);game.RoleModel.getIns().off(game.RoleModel.EVENTS.TEAM_LEVEL_CHANGE,this,this.refreshAll)};Object.defineProperty(e.prototype,"rechargeCfg",{get:function(){return csv.RechargeProxy.getIns().cfgMap[parseInt(this.actVo.curCfg.p2)]},enumerable:true,configurable:true});e.prototype.refreshAll=function(){if(!csv.FunctionsProxy.getIns().isOpen(this.actVo.funid)){this.model.updateView();return}this.setBtnEffect(false);this.yigoumaiimg.visible=false;this.imgbanner.skin=this.actVo.curCfg.p1;var t=csv.ChengZhanJiJingProxy.getIns().getCfgList(this.actVo.curCfg.id);t=this.model.chengZhangJiJingsortHandler(t);this.xiala.array=t;this.beishu.visible=false;if(t.length>0){var e=t[0];if(e.inversionrate!=0){this.beishu.value=(e.inversionrate/100).toString();this.beishu.visible=true}}this.inverData=this.model.getInvestFundData(this.actVo.curCfg.id);if(this.inverData){this.yigoumaiimg.visible=true;this.touzibtn.mouseEnabled=false;this.touzibtn.gray=true;this.timec.stop()}else{this.timec.start(this.actVo.timeVo.endTime);this.yigoumaiimg.visible=false;this.touzibtn.mouseEnabled=true;this.touzibtn.gray=false;this.setBtnEffect(true)}this.touzibtn.visible=true;this.touzibtn.label=app.getLang("xinshangcheng_05",app.convert_Yuan(this.rechargeCfg.recharge))};return e}(ui.xinshangcheng2.chengzhangjijinUI);i.ChengZhangJingJinNewView=t;var n=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.gezilist.itemRender=grids.GridView;this.gezilist.renderHandler=new Laya.Handler(this,this.onItemRender);this.btnchongzhi.clickHandler=new Laya.Handler(this,this.onLingQuHandler)};e.prototype.onItemRender=function(t){t.setData(t.dataSource);t.setCntScale(this.gezilist.scaleX)};e.prototype.onLingQuHandler=function(){app.ProtocolRequest.AwardTouziReq(this.cfg.id)};Object.defineProperty(e.prototype,"model",{get:function(){return i.NewShangChengModel.getIns()},enumerable:true,configurable:true});e.prototype.setData=function(t){this.cfg=t;this.imgyilingqu.visible=false;this.btnchongzhi.visible=false;game.RedDotView.removeFrom(this.btnchongzhi);this.tishi.text="";var e=this.model.getChengZhangStatus(t.id);this.shuzhi.value=t.limit.toString();this.gezilist.array=game.ItemUtil.parserList(t.reward);switch(e){case i.EChengZhangJinjing.BuKeLingQu:this.tishi.text=app.getLang("xinshangcheng_07",t.limit);break;case i.EChengZhangJinjing.CanLingQu:this.btnchongzhi.visible=true;this.btnchongzhi.mouseEnabled=true;this.btnchongzhi.gray=false;game.RedDotView.addTo(this.btnchongzhi);break;case i.EChengZhangJinjing.IsLingQued:this.imgyilingqu.visible=true;break;case i.EChengZhangJinjing.NotChongZhiBuKeLingQu:this.tishi.text=app.getLang("xinshangcheng_07",t.limit);break}};return e}(ui.xinshangcheng2.chengzhangjijinitemUI)})(newshangcheng||(newshangcheng={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var newshangcheng;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.skinFull=function(t,e){if(e){t.guanggao1.skin=e.cp3;t.guanggao2.skin=e.cp4;if(e.cp5!=""){t.itemdaoju.visible=true;t.itemdaoju.setData(game.ItemUtil.parserList(e.cp5)[0])}else{t.itemdaoju.visible=false}}else{t.guanggao1.skin="";t.guanggao2.skin="";t.itemdaoju.visible=false}};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.listbaoxiang.itemRender=n;this.listbaoxiang.renderHandler=new Laya.Handler(this,this.onRenderHander);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.timec=new activitytaren.ActivityTimeView(this.labeldaojishi,new Laya.Handler(this,this.endHandler),app.getLang("huodong_text05"));this.newscModel=i.NewShangChengModel.getIns()};e.prototype.updateActivityView=function(){};e.prototype.endHandler=function(){this.labeldaojishi.text=""};e.prototype.onUnDisplay=function(){activitytaren.ActivityTaRenModel.getIns().off(activitytaren.ActivityTaRenModel.ACTIVIT_TAREN_EVENT.GET_MAIN_PANEL_INFO,this,this.onGetMainPanel);activitytaren.ActivityTaRenModel.getIns().off(activitytaren.ActivityTaRenModel.ACTIVIT_TAREN_EVENT.UPDATE_ACTIVIT_DATA,this,this.onGetMainPanel);this.timec.stop()};e.prototype.onDisplay=function(){activitytaren.ActivityTaRenModel.getIns().on(activitytaren.ActivityTaRenModel.ACTIVIT_TAREN_EVENT.GET_MAIN_PANEL_INFO,this,this.onGetMainPanel);activitytaren.ActivityTaRenModel.getIns().on(activitytaren.ActivityTaRenModel.ACTIVIT_TAREN_EVENT.UPDATE_ACTIVIT_DATA,this,this.onGetMainPanel);this.callLater(this.onCallLater)};e.prototype.onGetMainPanel=function(){this.onCallLater()};e.prototype.onCallLater=function(){this.timec.start(this.actVo.timeVo.endTime);var t=this.actVo.curCfg;this.imgbanner.skin=t.cp1;i.Huodonglibaoview.skinFull(this,t);this.listbaoxiang.array=this.newscModel.sortList(this.actVo)};e.prototype.onRenderHander=function(t,e){t.setData(t.dataSource,this.actVo)};return e}(ui.xinshangcheng2.huodonglibaoviewUI);i.Huodonglibaoview=t;var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.listdaoju.itemRender=grids.GridView;this.listdaoju.renderHandler=grids.GridView.CommonItemRender;this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.quedingbtn.clickHandler=new Laya.Handler(this,this.onClickHandler);this.model=i.NewShangChengModel.getIns()};e.prototype.onClickHandler=function(){shop.ShopModel.getIns().chongzhi(this.rechargeCfg.id);app.ViewManager.toggleDialog(i.HuodonglibaoTip,-1)};e.prototype.onDisplay=function(){this.callLater(this.onCallter)};e.prototype.onCallter=function(){var t=this.dataSource[0];var e=this.dataSource[1];if(t.p2!=""){this.titleimg.text=app.getLang(t.p2)}else{this.titleimg.text=app.getLang(csv.FunctionsProxy.getIns().getCfg(t.functionid).windowname)}var i=csv.RechargeProxy.getIns().cfgMap[parseInt(t.p1)];this.rechargeCfg=i;this.model.setListVaule(this.listdaoju,i.reward);var n=e.getSubInfo(t.id);this.label01.text=app.getLang("xinshangcheng_01",n.num,i.limit);this.quedingbtn.label=app.getLang("xinshangcheng_02",app.convert_Yuan(i.recharge))};e.SINGLE_KEY="newshangcheng.HuodonglibaoTip";return e}(ui.xinshangcheng2.huodonglibaotipUI);i.HuodonglibaoTip=e;var n=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.listdaoju.itemRender=grids.GridView;this.listdaoju.renderHandler=new Laya.Handler(this,this.onItemRender);this.on(Laya.Event.CLICK,this,this.onClickHandler);this.imgxuanzhong.removeSelf();this.newscModel=i.NewShangChengModel.getIns()};e.prototype.onItemRender=function(t){t.locktip=true;t.setData(t.dataSource);t.setCntScale(this.listdaoju.scaleX)};e.prototype.onClickHandler=function(){this.newscModel.onLiBaoAction(this.actVo,this.cfg)};e.prototype.onWidthChange=function(){var t=this.clipmoney.width;this.clipmoney.x=(this.boxmoney.width-t-this.imgmoney.width)/2;this.imgmoney.x=this.clipmoney.x+t+10};e.prototype.setData=function(t,e){this.cfg=t;var i=e.getSubInfo(t.id);if(i){this.info=i;this.actVo=e;var n=csv.RechargeProxy.getIns().cfgMap[parseInt(t.p1)];if(n){if(n.showicon!=""){this.imgdaoju.skin=csv.ItemProxy.getUrl(n.showicon)}else{this.imgdaoju.skin=""}this.rechargeCfg=n;this.zhekou.skin="";this.imgjiaobiao.skin=n.subscript;this.imgshouqin.visible=false;this.imgbaoxiang.skin=this.rechargeCfg.res;if(this.rechargeCfg.recharge==0){this.imgmianfei.visible=true;this.boxmoney.visible=false}else{this.imgmianfei.visible=false;this.boxmoney.visible=true;this.clipmoney.value=app.convert_Yuan(this.rechargeCfg.recharge).toString();this.clipmoney.on(Laya.Event.RESIZE,this,this.onWidthChange)}game.RedDotView.removeFrom(this);if(this.newscModel.isSellout(this.actVo,t.id)){this.imgshouqin.visible=true}else{if(this.rechargeCfg.recharge==0){game.RedDotView.addTo(this)}}this.labelnum.text=app.getLang("xinshangcheng_01",i.num,n.limit);this.newscModel.setListVaule(this.listdaoju,n.reward)}else{game.Alert.show("recharge id "+t.p1+" 未找到")}}};return e}(ui.xinshangcheng2.huodonglibaoitem01UI);i.HuoDongLiBaoItem=n})(newshangcheng||(newshangcheng={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var newshangcheng;(function(t){var s;(function(t){t[t["Left"]=1]="Left";t[t["Right"]=2]="Right"})(s=t.EIconBubbleType||(t.EIconBubbleType={}));var e=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.posType=s.Right;t.label="";return t}t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};t.prototype.onDisplay=function(){this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){};t.prototype.refreshAll=function(){this.setData(this.label)};t.prototype.setData=function(t){var e=10;this.wenbtn.width=200;this.wenbtn.text=t;var i=this.wenbtn.contextWidth;var n=this.wenbtn.contextHeight;this.ditu.width=i+e*2;this.ditu.height=n+50+e;this.width=this.ditu.width;var a=0;var o=0;if(this.posType==s.Right){this.ditu.scaleX=-1}else{this.ditu.scaleX=1;this.ditu.x=0;o=this.width+main.IconListBase.SIZE;a=-this.ditu.width}this.ditu.x=o+a;this.ditu.y=-this.height;this.height=this.ditu.height;this.wenbtn.x=e-this.width+o;this.wenbtn.y=this.ditu.y+e};return t}(ui.duihua.duihuaqipao2UI);t.IconBubbleView=e})(newshangcheng||(newshangcheng={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var newshangcheng;(function(e){var t=function(n){__extends(t,n);function t(t,e){if(e===void 0){e=main.IconListBase.SIZE}var i=n.call(this,t,e)||this;i.USETIME=800;return i}Object.defineProperty(t.prototype,"isPlayAni",{get:function(){return false},enumerable:true,configurable:true});t.prototype.imgTween1=function(){this.tween=Laya.Tween.to(this,{y:this.y+5},this.USETIME,null,new Laya.Handler(this,this.imgTween2))};t.prototype.imgTween2=function(){this.tween=Laya.Tween.to(this,{y:this.y-5},this.USETIME,null,new Laya.Handler(this,this.imgTween1))};t.prototype.initAni=function(){this.inity=this.y;this.clearAni();if(this.isPlayAni){this.imgTween1()}};t.prototype.clearAni=function(){Laya.Tween.clearAll(this);this.y=this.inity};return t}(main.MainUIIcon);var i=function(i){__extends(t,i);function t(t,e){if(e===void 0){e=main.IconListBase.SIZE}return i.call(this,t,e)||this}t.prototype.onDisplay=function(){i.prototype.onDisplay.call(this);this.initAni()};t.prototype.onUndisplay=function(){i.prototype.onUndisplay.call(this);this.clearAni()};return t}(t);e.ShouChongSkIcon=i;var n=function(i){__extends(t,i);function t(t,e){if(e===void 0){e=main.IconListBase.SIZE}return i.call(this,t,e)||this}Object.defineProperty(t.prototype,"model",{get:function(){return e.NewShangChengModel.getIns()},enumerable:true,configurable:true});t.prototype.onDisplay=function(){i.prototype.onDisplay.call(this);this.model.on(e.NewShangChengEvent.EVENT_UPDATE_ICON,this,this.showTips);this.showTips();this.initAni()};Object.defineProperty(t.prototype,"curlabel",{get:function(){return app.getLang("shop_bubble1")},enumerable:true,configurable:true});t.prototype.showTips=function(){if(!this.iconBubble){this.iconBubble=new e.IconBubbleView;this.iconBubble.posType=e.EIconBubbleType.Left;this.iconBubble.label=this.curlabel}if(this.isHasTips()){util.SpriteLinkUtil.addLinkChild(this,this.iconBubble,app.AppContainer.flyLayer,0,this.height/2,true)}else{this.closeTips()}};t.prototype.isHasTips=function(){return this.model.scPop.isNeedPop()};t.prototype.closeTips=function(){if(this.iconBubble){util.SpriteLinkUtil.removeLinkChild(this,this.iconBubble)}};t.prototype.onUndisplay=function(){i.prototype.onUndisplay.call(this);this.model.off(e.NewShangChengEvent.EVENT_UPDATE_ICON,this,this.showTips);this.closeTips();this.clearAni()};t.prototype.isNeedEffect=function(){if(this.cfg.id==csv.MainIconProxy.TYPE_ICON_SHANGCHNEG){if(shouchonghaoli.ShouChongModel.getIns().isAlreadyChongZhi){return true}return false}else if(this.cfg.id==csv.MainIconProxy.TYPE_ICON_SHOUCHONG){if(shouchonghaoli.ShouChongModel.getIns().isAlreadyChongZhi){return false}return true}};return t}(t);e.NewShangChengIcon=n;var a=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}Object.defineProperty(e.prototype,"curlabel",{get:function(){return app.getLang("shop_bubble2")},enumerable:true,configurable:true});e.prototype.isHasTips=function(){return this.model.ybPop.isNeedPop()};return e}(n);e.YuanBaoShopIcon=a})(newshangcheng||(newshangcheng={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var newshangcheng;(function(i){var n=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){this.funcAdapter=new game.FuncDotAdapter(this,134,5,true)};e.prototype.getIcon=function(t,e){var i=t.indexOf(".png");var n=t.substr(0,i);if(e){return n+"_xuanzhong.png"}else{return n+".png"}};e.prototype.setData=function(t,e){this.imgname.skin=this.getIcon(t.cfg.icon,e);this.btnlingyuanlibao.selected=e;this.funcAdapter.obFunc(t.funids)};return e}(ui.xinshangcheng2.xinshangcheng2yeqianitem01UI);var a=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){this.funcAdapter=new game.FuncDotAdapter(this,100,5,true)};e.prototype.setData=function(t,e){var i=csv.FunctionsProxy.getIns().getCfg(t);this.cfg=i;this.btnneibuyeqian.label="";this.btnneibuyeqian.skin="res/static/xinshangcheng2/"+i.buttonicon+".png";this.btnneibuyeqian.selected=e;this.funcAdapter.clear();this.funcAdapter.obFunc([t])};e.cWidth=126;return e}(ui.xinshangcheng2.xinshangcheng2yeqianitemUI);var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.noCloseAll="noCloseAll";t.topIndex=-1;return t}t.getIns=function(){return app.Singleton.getInstance(t)};Object.defineProperty(t.prototype,"toplist",{get:function(){return this.listneibuyeqian},enumerable:true,configurable:true});t.prototype.initialize=function(){e.prototype.initialize.call(this);this.boSmallResult=true;var t=this.yeqianlist;t.itemRender=n;t.renderHandler=new Laya.Handler(this,this.onYeQianHandler);t.selectHandler=new Laya.Handler(this,this.onSelectHandler);t.selectEnable=true;this.backbtn.clickHandler=new Laya.Handler(this,this.onCloseHandler);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.toplist.itemRender=a;this.toplist.selectHandler=new Laya.Handler(this,this.onTopListSelectHander);this.toplist.renderHandler=new Laya.Handler(this,this.onSmallYeqian);this.toplist.selectEnable=true;guide.GuideModel.getIns().register(csv.GuideProxy.ENUM_VIEW.COMMON_SHANGCHENG_CLOSE,this.backbtn);this.imgmoney01.on(Laya.Event.CLICK,this,this.onTipShow,[game.MoneyModel.MONEY_ENUM.SILVER]);this.labelmoney01.on(Laya.Event.CLICK,this,this.onTipShow,[game.MoneyModel.MONEY_ENUM.SILVER]);this.imgmoney02.on(Laya.Event.CLICK,this,this.onTipShow,[game.MoneyModel.MONEY_ENUM.GOLD]);this.labelmoney02.on(Laya.Event.CLICK,this,this.onTipShow,[game.MoneyModel.MONEY_ENUM.GOLD]);this.boxmoney.x=(this.width-this.boxmoney.width)/2};t.prototype.onTipShow=function(t){var e;if(game.MoneyModel.MONEY_ENUM.GOLD==t){shop.ShopModel.getIns().moneyTips()}else if(game.MoneyModel.MONEY_ENUM.SILVER==t){e=game.ItemUtil.createVO(game.ItemUtil.ENUMS.TONGBI)}if(e){tip.TipManager.show(e,true)}};t.prototype.clearContent=function(){while(this.neibuview.numChildren>0){var t=this.neibuview.getChildAt(0);if(t&&t.actVo){this.model.delXin(t.actVo.actid)}this.neibuview.removeChildAt(0)}};t.prototype.onTopListSelectHander=function(t){if(t!=-1){this.clearContent();var e=parseInt(this.toplist.getItem(t));var i=game.WindowsResigter.getFunctionView(e);if(i){Laya.timer.clear(this,this.onOpenLater);Laya.timer.callLater(this,this.onOpenLater,[i.closure,e])}else{console.error("funcid:"+e+" WindowsResigter未定义")}}};t.prototype.onOpenLater=function(t,e){app.ViewManager.toggleView(t,this.neibuview,1,null,null,null,-1,e,false)};t.prototype.onSmallYeqian=function(t,e){t.setData(t.dataSource,this.toplist.selectedIndex==e)};t.prototype.onDisplay=function(){Laya.stage.on(Laya.Event.RESIZE,this,this.onResize);this.onResize();game.MoneyModel.getIns().on(game.MoneyModel.EVENTS.MONEY_CHANGE,this,this.onMoneyChange);this.updateMoney();app.ViewManager.showCommoneMask();Laya.timer.callLater(this,this.onCallHandler);guide.GuideModel.getIns().boOpen=false};t.prototype.onUpdateShangCheng=function(){this.yeqianlist.selectedIndex=-1;this.onCallHandler()};t.prototype.onSelectHandler=function(t){var e=this.yeqianlist.getItem(t);this.clearContent();if(e){var i=e.funids;this.toplist.array=i;if(i.length>=5){this.toplist.width=608}else{this.toplist.width=i.length*(118+this.toplist.spaceX)}this.toplist.selectedIndex=-1;if(i.length>0){if(this.topIndex!=-1){this.toplist.selectedIndex=this.topIndex;this.topIndex=-1}else{this.toplist.selectedIndex=0}}}};Object.defineProperty(t.prototype,"model",{get:function(){return i.NewShangChengModel.getIns()},enumerable:true,configurable:true});t.prototype.onCallHandler=function(){this.dataList=this.model.getIconList();this.yeqianlist.array=this.dataList;this.yeqianlist.refresh();var t=0;this.topIndex=-1;if(this.dataSource){var e=this.dataSource[0];if(e){for(var i=0;i<this.dataList.length;i++){var n=this.dataList[i];var a=n.funids.indexOf(e[0]);if(n.funids&&a!=-1){t=i;this.topIndex=a;break}}}else{for(var i=0;i<this.dataList.length;i++){var n=this.dataList[i];if(this.topIndex!=-1){break}for(var o=0;o<n.funids.length;o++){var s=n.funids[o];if(game.ClosureManager.hasXin(s)){t=i;this.topIndex=o;break}}}if(this.topIndex==-1){for(var i=0;i<this.dataList.length;i++){var n=this.dataList[i];if(this.topIndex!=-1){break}for(var o=0;o<n.funids.length;o++){var s=n.funids[o];if(game.ClosureManager.hasDot(s)){t=i;this.topIndex=o;break}}}}}}this.yeqianlist.selectedIndex=t};t.prototype.onMoneyChange=function(t){if(t==game.MoneyModel.MONEY_ENUM.GOLD||t==game.MoneyModel.MONEY_ENUM.SILVER){this.callLater(this.updateMoney)}};t.prototype.updateMoney=function(){this.labelmoney01.text=game.MoneyModel.format(game.MoneyModel.getIns().getMoney(game.MoneyModel.MONEY_ENUM.SILVER));this.labelmoney02.text=game.MoneyModel.format(game.MoneyModel.getIns().getMoney(game.MoneyModel.MONEY_ENUM.GOLD))};t.prototype.onUnDisplay=function(){this.toplist.selectedIndex=-1;this.yeqianlist.selectedIndex=-1;Laya.stage.off(Laya.Event.RESIZE,this,this.onResize);game.MoneyModel.getIns().off(game.MoneyModel.EVENTS.MONEY_CHANGE,this,this.onMoneyChange);app.ViewManager.hideCommoneMask();if(t.callBackFunc){Laya.timer.callLater(this,this.callBack)}guide.GuideModel.getIns().boOpen=true};t.prototype.callBack=function(){game.ClosureManager.callFunction(t.callBackFunc);t.callBackFunc=null};t.prototype.onYeQianHandler=function(t,e){t.setData(t.dataSource,e==this.yeqianlist.selectedIndex)};t.prototype.onCloseHandler=function(){app.ViewManager.toggleDialog(t,-1);this.isModal&&Laya.Dialog.manager._checkMask()};t.SINGLE_KEY="newshangcheng.NewShangChengView";return t}(common.ShangChengBaseSkin);i.NewShangChengView=t;var e=function(){function t(){}return t}();i.NewShangChangFuncVo=e})(newshangcheng||(newshangcheng={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var newshangcheng;(function(s){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.timec=new activitytaren.ActivityTimeView(this.labeldaojishi,new Laya.Handler(this,this.endHandler),app.getLang("huodong_text05"));this.xiala.itemRender=i;this.xiala.renderHandler=new Laya.Handler(this,this.onItemHandler);this.touzibtn.clickHandler=new Laya.Handler(this,this.onTouZiHandler);this.touzibtn.label=app.getLang("touzilc_text6")};e.prototype.onItemHandler=function(t,e){t.setData(t.dataSource,this.functionid)};e.prototype.setBtnEffect=function(t){if(t){this.guangxiao.visible=true;this.guangxiao.play(0,true)}else{this.guangxiao.visible=false;this.guangxiao.stop()}};Object.defineProperty(e.prototype,"rechargeCfg",{get:function(){return csv.RechargeProxy.getIns().cfgMap[parseInt(this.actVo.curCfg.p2)]},enumerable:true,configurable:true});e.prototype.onTouZiHandler=function(){if(!csv.FunctionsProxy.getIns().isOpen(this.functionid,true)){return}var t=this.rechargeCfg;var e=t.reward.split("-")[1];if(!e){game.Alert.show(app.getLang("xinshangcheng_15",app.convert_Yuan(t.recharge)),new Laya.Handler(this,this.onOkHandler))}else{game.Alert.show(app.getLang("xinshangcheng_04",app.convert_Yuan(t.recharge),e),new Laya.Handler(this,this.onOkHandler))}};e.prototype.onOkHandler=function(){var t=this.rechargeCfg;if(t){shop.ShopModel.getIns().chongzhi(t.id)}};e.prototype.endHandler=function(){this.labeldaojishi.text=""};e.prototype.onDisplay=function(){this.model.on(s.NewShangChengEvent.EVENT_TOU_ZI_CHENGZHANG,this,this.refreshAll);this.callLater(this.refreshAll)};Object.defineProperty(e.prototype,"model",{get:function(){return s.NewShangChengModel.getIns()},enumerable:true,configurable:true});e.prototype.sortHandler=function(t){var e=[];for(var i=0;i<t.length;i++){if(this.model.getTouStatus(t[i].id)!=s.ETouZiLingQu.IsLingQued){e.push(t[i])}}for(var i=0;i<t.length;i++){if(this.model.getTouStatus(t[i].id)==s.ETouZiLingQu.IsLingQued){e.push(t[i])}}return e};e.prototype.refreshAll=function(){if(!csv.FunctionsProxy.getIns().isOpen(this.actVo.funid)){this.model.updateView();return}this.setBtnEffect(false);this.imgbanner.skin=this.actVo.curCfg.p1;if(this.rechargeCfg.reward!=""){var t=this.rechargeCfg.reward.split("-")[1];this.wenzi2.text=t}var e=csv.TouZiLiCaiProxy.getIns().getAllCfgid(this.actVo.curCfg.id);e=this.sortHandler(e);this.xiala.array=e;this.beishu.visible=false;if(e.length>0){var i=e[0];if(i.inversionrate!=0){this.beishu.value=(i.inversionrate/100).toString();this.beishu.visible=true}}this.inverData=this.model.getInvestFundData(this.actVo.curCfg.id);if(this.inverData){this.touzibtn.gray=true;this.touzibtn.mouseEnabled=false;this.yigoumaiimg.visible=true;this.qipaobox.visible=false;this.timec.stop();this.labeldaojishi.text=""}else{if(this.rechargeCfg.reward==""){this.qipaobox.visible=false}else{this.qipaobox.visible=true}this.touzibtn.gray=false;this.touzibtn.mouseEnabled=true;this.setBtnEffect(true);this.yigoumaiimg.visible=false;this.timec.start(this.actVo.timeVo.endTime)}var n=app.convert_Yuan(this.rechargeCfg.recharge);this.touzibtn.label=app.getLang("touzilc_text10",n)};e.prototype.onUnDisplay=function(){this.timec.stop();this.model.off(s.NewShangChengEvent.EVENT_TOU_ZI_CHENGZHANG,this,this.refreshAll);this.setBtnEffect(false)};return e}(ui.xinshangcheng2.touzilicaiUI);s.TouZiLiCaiNewView=t;var i=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){this.gezilist.itemRender=grids.GridView;this.gezilist.renderHandler=new Laya.Handler(this,this.onItemRender);this.btnchongzhi.clickHandler=new Laya.Handler(this,this.onClickHandler)};e.prototype.onItemRender=function(t){t.setData(t.dataSource);t.setCntScale(this.gezilist.scaleX)};e.prototype.onClickHandler=function(){switch(this._status){case s.ETouZiLingQu.NotChongZhi:break;case s.ETouZiLingQu.IsLingQued:break;case s.ETouZiLingQu.CanLingQu:app.ProtocolRequest.DayAwardTouziReq(this.cfg.id);break}};Object.defineProperty(e.prototype,"model",{get:function(){return s.NewShangChengModel.getIns()},enumerable:true,configurable:true});e.prototype.clear=function(){this.tishi.text="";this.btnchongzhi.visible=false;this.imgyilingqu.visible=false;game.RedDotView.removeFrom(this.btnchongzhi)};e.prototype.setData=function(t,e){this.funcid=e;this.clear();this.cfg=t;this.shuzhi.value=t.value.toString();this.gezilist.array=game.ItemUtil.parserList(t.reward);var i=this.model.getTouStatus(t.id);this._status=i;switch(i){case s.ETouZiLingQu.NotChongZhi:this.btnchongzhi.visible=true;this.btnchongzhi.mouseEnabled=false;this.btnchongzhi.gray=true;this.btnchongzhi.label=app.getLang("touzilc_text4");break;case s.ETouZiLingQu.IsLingQued:this.imgyilingqu.visible=true;break;case s.ETouZiLingQu.CanLingQu:this.btnchongzhi.visible=true;this.btnchongzhi.mouseEnabled=true;this.btnchongzhi.gray=false;this.btnchongzhi.label=app.getLang("touzilc_text4");game.RedDotView.addTo(this.btnchongzhi);break;case s.ETouZiLingQu.NotLingTime:var n=this.model.getInvestFundData(t.cfgid);if(n){var a=(game.Context.getServerZeroTime()-n.buyTime)/86400+1;var o=t.day-a;if(o<=1){this.tishi.text=app.getLang("touzilc_text11")}else{this.tishi.text=app.getLang("touzilc_text1",o)}}break}};return e}(ui.xinshangcheng2.touzilicaiitemUI)})(newshangcheng||(newshangcheng={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var newshangcheng;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.listbaoxiang.itemRender=i.HuoDongLiBaoItem;this.listbaoxiang.renderHandler=new Laya.Handler(this,this.onRenderHander);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.timec=new activitytaren.ActivityTimeView(this.labeldaojishi,null,app.getLang("huodong_text05"));this.newscModel=i.NewShangChengModel.getIns()};e.prototype.onRenderHander=function(t,e){t.setData(t.dataSource,this.actVo)};e.prototype.onDisplay=function(){activitytaren.ActivityTaRenModel.getIns().on(activitytaren.ActivityTaRenModel.ACTIVIT_TAREN_EVENT.GET_MAIN_PANEL_INFO,this,this.onGetMainPanel);activitytaren.ActivityTaRenModel.getIns().on(activitytaren.ActivityTaRenModel.ACTIVIT_TAREN_EVENT.UPDATE_ACTIVIT_DATA,this,this.onGetMainPanel);this.callLater(this.onCallLater)};e.prototype.onUnDisplay=function(){activitytaren.ActivityTaRenModel.getIns().on(activitytaren.ActivityTaRenModel.ACTIVIT_TAREN_EVENT.GET_MAIN_PANEL_INFO,this,this.onGetMainPanel);activitytaren.ActivityTaRenModel.getIns().on(activitytaren.ActivityTaRenModel.ACTIVIT_TAREN_EVENT.UPDATE_ACTIVIT_DATA,this,this.onGetMainPanel);this.callLater(this.onCallLater)};e.prototype.onGetMainPanel=function(){this.onCallLater()};e.prototype.onCallLater=function(){this.timec.start(this.actVo.timeVo.endTime);this.imgbanner.skin=this.actVo.curCfg.cp1;this.listbaoxiang.array=this.newscModel.sortList(this.actVo)};return e}(ui.xinshangcheng2.xianshitehuilibaoviewUI);i.XianshitehuilibaoView=t})(newshangcheng||(newshangcheng={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var newshangcheng;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listbaoxiang.itemRender=n;this.listbaoxiang.renderHandler=new Laya.Handler(this,this.onRendlerHandler)};e.prototype.onRendlerHandler=function(t,e){t.setData(t.dataSource)};e.prototype.onDisplay=function(){activitytaren.ActivityTaRenModel.getIns().on(activitytaren.ActivityIconStatuManager.EVENT_ACRIVITY_SINGLE_VISIBLE,this,this.onActShowHide);this.callLater(this.onCallLater)};e.prototype.onCallLater=function(){this.refreshAll()};Object.defineProperty(e.prototype,"model",{get:function(){return i.NewShangChengModel.getIns()},enumerable:true,configurable:true});e.prototype.refreshAll=function(){this.listbaoxiang.array=this.model.getSubOpenList()};e.prototype.onUnDisplay=function(){activitytaren.ActivityTaRenModel.getIns().off(activitytaren.ActivityIconStatuManager.EVENT_ACRIVITY_SINGLE_VISIBLE,this,this.onActShowHide)};e.prototype.isHas=function(t){var e=csv.SubjectProxy.getIns().arr;for(var i=0;i<e.length;i++){if(e[i].activityid==t){return true}}return false};e.prototype.onActShowHide=function(t){if(this.isHas(t.actId)){this.refreshAll()}};return e}(ui.xinshangcheng2.zhutihuodongviewUI);i.ZhutihuodongView=t;var n=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}Object.defineProperty(e.prototype,"model",{get:function(){return i.NewShangChengModel.getIns()},enumerable:true,configurable:true});e.prototype.initialize=function(){this.on(Laya.Event.CLICK,this,this.onClickHandler);this.timeView=new activitytaren.ActivityTimeView(this.labeltime,null,app.getLang("huodong_text05"));this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onUnDisplay=function(){this.timeView.stop()};e.prototype.onClickHandler=function(){game.ClosureManager.callFunction(this.cfg.functionid)};e.prototype.setData=function(t){this.cfg=t;this.imgbanner.skin=t.cp1;var e=activitytaren.ActivityTaRenModel.getIns().iconMan.getActVoByActid(t.activityid);if(e){this.timeView.start(e.timeVo.endTime);var i=activitytaren.ActivityTaRenModel.getIns().hasRedByFuncid(t.functionid);if(i){game.RedDotView.addTo(this)}else{game.RedDotView.removeFrom(this)}}};return e}(ui.xinshangcheng2.zhutihuodongitemUI)})(newshangcheng||(newshangcheng={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var onlineActivity;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){app.ViewManager.regist(i.OnlineActivityView,"meirichongzhi.atlas");game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.ZAIXIAN_JIANGLI,i.OnlineActivityView);this._model=i.OnlineActivityModel.getIns();main.MainUIIcon.iconClassMap[csv.MainIconProxy.TYPE_ICON_ONLINE]=i.OnlineIcon};e.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.OnlineActTimeNoti,this,this.checkOnlineActTimeNtf)};e.prototype.checkOnlineActTimeNtf=function(t,e){this._model.iconTime=e.time;this._model.event(i.OnlineActivityEvent.ONLINE_ACT_ICON_TIME)};e.prototype.onRedDotChange=function(){Laya.timer.callLater(this,this.onUpdateRedDot)};e.prototype.onUpdateRedDot=function(){};e.SINGLE_KEY="onlineActivity.OnlineActivityModule";return e}(app.ModuleBase);i.OnlineActivityModule=t})(onlineActivity||(onlineActivity={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var onlineActivity;(function(t){var e=function(){function t(){}t.ONLINE_ACT_REFRESH="ONLINE_ACT_REFRESH";t.ONLINE_ACT_CHANGE="ONLINE_ACT_CHANGE";t.ONLINE_ACT_ICON_TIME="ONLINE_ACT_ICON_TIME";return t}();t.OnlineActivityEvent=e;var s=function(){function t(){}return t}();t.OnlineActivityVo=s;var i;(function(t){t[t["DENG_JI_AWARD"]=1]="DENG_JI_AWARD";t[t["ZAI_XIAN_AWARD"]=2]="ZAI_XIAN_AWARD"})(i=t.Activity_Client_Type||(t.Activity_Client_Type={}));var n=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.retArr=[];t.itemActId=-1;t.iconTime=-1;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.init=function(){};t.prototype.getOnlineActivityArr=function(){var t=this.netData.cfgList;var e=this.netData.info.prize;this.retArr=[];for(var i=0;i<t.length;i++){var n=new s;n.id=+t[i].id;n.actId=+t[i].activityid;n.time=-1;n.award=t[i].award;n.state=-1;n.textNum=+t[i].p1;this.retArr.push(n)}for(var i=0;i<this.retArr.length;i++){var a=this.retArr[i];var o=e[i];a.time=o.option;a.state=o.status}this.retArr.sort(function(t,e){if(t!=e){if(t.state==1){return-1}else if(e.state==1){return 1}if(t.state==2){return 1}else if(e.state==2){return-1}}});return this.retArr};t.SINGLE_KEY="onlineActivity.OnlineActivityModel";return t}(app.ModelBase);t.OnlineActivityModel=n})(onlineActivity||(onlineActivity={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){this.initActivityTaRen()};e.prototype.initActivityTaRen=function(){var t=app.Config.getResById("activity_taren.csv");this._activityTaRenMap=t.getMap("id");this._activityTaRenArr=t.getArray()};e.prototype.getActivityTaRenMapCell=function(t){return this._activityTaRenMap[t]};e.prototype.getActivityTaRenArr=function(){return this._activityTaRenArr};e.SINGLE_KEY="csv.OnlineActivityProxy";return e}(app.ModelBase);t.OnlineActivityProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var onlineActivity;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this._model=i.OnlineActivityModel.getIns();this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.btnlingqu.on(Laya.Event.CLICK,this,this.onClick);this.listdaoju.itemRender=grids.GridView;this.listdaoju.renderHandler=new Laya.Handler(this,this.onCellHandler);this.activityTimeView=new activitytaren.ActivityTimeView(this.labeldaojishi,new Laya.Handler(this,this.endTimeCallBack),"{0}",null,2)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.onCellHandler=function(t,e){t.setData(t.dataSource)};e.prototype.setData=function(t){var e=[];this.labeldaojishi.x=447;this._tempData=t;if(t.state==0){this.activityTimeView.start(t.time)}this.labelmiaoshu.text="在线"+t.textNum/60+"分钟可以领取";var i=t.award.split(";");for(var n=0;n<i.length;n++){e.push(game.ItemUtil.parserList(i[n])[0])}this.listdaoju.array=e;this.labeldaojishi.visible=true;this.lingquEffect=false;game.RedDotView.removeFrom(this.btnlingqu);if(t.state==0){this.btnlingqu.disabled=true;this.imgyilingqu.visible=false;this.btnlingqu.visible=true}else if(t.state==1){this.labeldaojishi.visible=false;this.btnlingqu.disabled=false;this.imgyilingqu.visible=false;this.btnlingqu.visible=true;game.RedDotView.addTo(this.btnlingqu);this.lingquEffect=true}else if(t.state==2){this.labeldaojishi.visible=false;this.btnlingqu.disabled=false;this.imgyilingqu.visible=true;this.btnlingqu.visible=false}};Object.defineProperty(e.prototype,"lingquEffect",{set:function(t){if(t){this.btneffect.play();this.btneffect.visible=true}else{this.btneffect.stop();this.btneffect.visible=false}},enumerable:true,configurable:true});e.prototype.endTimeCallBack=function(){this.hideSubTime()};e.prototype.onClick=function(){this._model.itemActId=this._tempData.actId;app.ProtocolRequest.RecvActPrizeReq(this._tempData.id)};e.prototype.hideSubTime=function(){this._model.itemActId=this._tempData.actId;this.activityTimeView.stop();this.labeldaojishi.text="";this.labeldaojishi.visible=false;this._model.event(i.OnlineActivityEvent.ONLINE_ACT_REFRESH)};e.SINGLE_KEY="onlineActivity.OnlineActivityCellItem";return e}(ui.zaixianlibao.zaixianlibaoitemUI);i.OnlineActivityCellItem=t})(onlineActivity||(onlineActivity={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var onlineActivity;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=i.OnlineActivityModel.getIns();this.listzaixianlingqu.itemRender=i.OnlineActivityCellItem;this.listzaixianlingqu.renderHandler=new Laya.Handler(this,this.onCellHandler)};e.prototype.onCellHandler=function(t,e){t.setData(t.dataSource)};e.prototype.onDisplay=function(){this._model.on(i.OnlineActivityEvent.ONLINE_ACT_REFRESH,this,this.refrshNetData);activitytaren.ActivityTaRenModel.getIns().on(activitytaren.ActivityTaRenModel.ACTIVIT_TAREN_EVENT.UPDATE_ACTIVIT_DATA,this,this.refrshNetData);this.callLater(this.onGetInfo)};e.prototype.onGetInfo=function(){if(this.functionid){this._model.netData=this.actVo;this.refreshAll()}};e.prototype.onUnDisplay=function(){this._model.off(i.OnlineActivityEvent.ONLINE_ACT_REFRESH,this,this.refrshNetData);activitytaren.ActivityTaRenModel.getIns().off(activitytaren.ActivityTaRenModel.ACTIVIT_TAREN_EVENT.UPDATE_ACTIVIT_DATA,this,this.refrshNetData)};e.prototype.refreshAll=function(){this.setCellList()};e.prototype.setCellList=function(){this.listzaixianlingqu.array=this._model.getOnlineActivityArr();this.listzaixianlingqu.refresh()};e.prototype.refrshNetData=function(){var e=this;activitytaren.ActivityTaRenModel.getIns().getInfoByActID(this._model.itemActId,new Laya.Handler(this,function(t){e._model.netData.info=t;e.refreshAll()}))};e.SINGLE_KEY="onlineActivity.OnlineActivityView";return e}(ui.zaixianlibao.zaixianlibaoviewUI);i.OnlineActivityView=t})(onlineActivity||(onlineActivity={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var pedlar;(function(n){function t(t,e,i){if(e===void 0){e=1}if(i===void 0){i=0}var n=new PedlarInfoAck;n.endFlag=i;n.id=e;n.endTime=game.Context.getServerTime()+(t||0);a.getIns().parseInfo(n)}n.debugRequest=t;var a=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.PedlarInfoAck,this,this.onPedlarInfoAck);this.addMsgListener(app.ProtocolResponse.PedlarBuyAck,this,this.onPedlarBuyAck)};e.prototype.parseInfo=function(t){console.log("==========================>货郎信息id=[%d]更新 结束时间:[%s], [%s]",t.id,t.endTime,t.endFlag==1?"活动结束":"活动进行中...");var e=n.PadkarModel.getIns();if(t.endFlag==1){csv.PadkarProxy.getIns().setAllCloseStatus();e.curVo=null}else{var i=csv.PadkarProxy.getIns().getPedkarVo(t.id);i.is_buy=t.is_buy;i.endTime=t.endTime;i.isServerEnd=false;e.curVo=i}e.event(n.PadkarModel.EVENT_PEDKAR_SERVERE_INFO);activitytaren.ActivityTaRenModel.getIns().event(activitytaren.ActivityIconStatuManager.EVENET_ACTIVITY_STATUS_CHANGED)};e.prototype.onPedlarInfoAck=function(t,e){this.parseInfo(e)};e.prototype.onPedlarBuyAck=function(t,e){if(e.result){var i=e.id;app.ProtocolRequest.PedlarInfoReq()}};e.prototype.init=function(){app.ViewManager.regist(n.PedkarView,"huolangtehui.atlas");app.ViewManager.regist(n.PediarMainView,"huolangtehui.atlas","waixiantegou.atlas");activitytaren.ActivityTaRenModel.getIns().on(activitytaren.ActivityIconStatuManager.EVENT_ACRIVITY_SINGLE_VISIBLE,this,this.onShowHide);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.PEDIAR,n.PediarMainView,null,0);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.PEDIAR_FUNC,n.PediarMainView,null,0);main.MainUIIcon.iconClassMap[csv.MainIconProxy.TYPE_ICON_PEDKAR_HUO_DONG]=n.PadkarIcon;main.MainUIIcon.iconClassMap[csv.MainIconProxy.TYPE_ICON_PEDKAR_FUNC]=n.PadkarIcon};e.prototype.onInfoHandler=function(){activitytaren.ActivityTaRenModel.getIns().event(activitytaren.ActivityIconStatuManager.EVENET_ACTIVITY_STATUS_CHANGED)};e.prototype.onShowHide=function(t){var e=csv.ActivityTarenProxy.getIns().getCfgByActivityid(t.actId);if(!e){activitytaren.ActivityTaRenModel.getIns().error(t.actId);return}if(e.functionid==csv.FunctionsProxy.ENUMS.PEDIAR||e.functionid==csv.FunctionsProxy.ENUMS.PEDIAR_FUNC){if(t.visible){if(parseInt(e.client_type)==activitytaren.ActivityTaRenType.PEDLAR){n.PadkarModel.getIns().actid=t.actId;n.PadkarModel.getIns().once(n.PadkarModel.EVENT_PEDKAR_SERVERE_INFO,this,this.onInfoHandler);app.ProtocolRequest.PedlarInfoReq()}}else{app.ViewManager.toggleView(n.PedkarView,app.AppContainer.uiLayer,-1)}}};e.SINGLE_KEY="pedlar.PedkarModule";return e}(app.ModuleBase);n.PedkarModule=a})(pedlar||(pedlar={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var pedlar;(function(t){var e;(function(t){t[t["Buy"]=1]="Buy";t[t["Lingqu"]=2]="Lingqu"})(e=t.ELingquType||(t.ELingquType={}));var i=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.ids=[];t.debugMode=false;t.debugId=1;t.TYPE_HUO_DONG=1;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.init=function(){};t.prototype.pushID=function(t){if(this.ids.indexOf(t)==-1){this.ids.push(t)}};t.prototype.draw=function(t){var e=t.graphics;var i=t.width;var n=t.height;var a=new Array;a.push(i,0,i,n,0,n,0,0,i,0);e.clear();e.drawLines(0,0,a,game.STYLES.RED_COLOR_S,1)};t.prototype.isOpenFunc=function(){if(!this.curVo){return false}if(this.curVo.isCloseed){return false}return true};t.SINGLE_KEY="pedlar.PadkarModel";t.EVENT_PEDKAR_CLOSE_TIPS="EVENT_PEDKAR_CLOSE_TIPS";t.EVENT_PEDKAR_SERVERE_INFO="EVENT_PEDKAR_SERVERE_INFO";t.EVENT_PEDKAR_LINGQU_END="EVENT_PEDKAR_LINGQU_END";return t}(app.ModelBase);t.PadkarModel=i})(pedlar||(pedlar={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var i=pedlar.PedkarVo;var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("pushshop.csv");this.arr=t.getArray();this.list=[];for(var e=0;e<this.arr.length;e++){this.list.push(new i(this.arr[e]))}};e.prototype.getPedkarVo=function(t){for(var e=0;e<this.list.length;e++){if(parseInt(this.list[e].cfg.id)==parseInt(t)){return this.list[e]}}};e.prototype.setAllCloseStatus=function(){for(var t=0;t<this.list.length;t++){this.list[t].isServerEnd=true}};e.SINGLE_KEY="csv.PadkarProxy";return e}(app.ModelBase);t.PadkarProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var pedlar;(function(i){var t=function(n){__extends(t,n);function t(t,e){if(e===void 0){e=main.IconListBase.SIZE}var i=n.call(this,t,e)||this;i.setTimeLabel();return i}t.prototype.onClick=function(t){n.prototype.onClick.call(this,t);var e=i.PadkarModel.getIns().curVo;if(e){i.PadkarModel.getIns().pushID(e.cfg.id)}};t.prototype.onUndisplay=function(){n.prototype.onUndisplay.call(this)};t.prototype.onDisplay=function(){n.prototype.onDisplay.call(this);this.clearData();this.init()};t.prototype.clearData=function(){if(this.timeView){this.timeView.stop()}};t.prototype.endHandler=function(){};t.prototype.init=function(){i.PadkarModel.getIns().on(i.PadkarModel.EVENT_PEDKAR_SERVERE_INFO,this,this.onInfoHandler);this.onInfoHandler()};t.prototype.onInfoHandler=function(){if(!main.LeftIconList.getIns().parent){return}var t=i.PadkarModel.getIns().curVo;if(t){if(this.timeView){this.timeView.stop()}this.timeView=new activitytaren.ActivityTimeView(this.lblTime,new Laya.Handler(this,this.endHandler),undefined,undefined,activitytaren.ActivityTimeView.TYPE_KEEP_2_BIT);this.timeView.start(t.endTime);if(i.PadkarModel.getIns().ids.indexOf(t.cfg.id)==-1){app.ViewManager.toggleView(i.PedkarView,app.AppContainer.uiLayer,1)}}else{}};return t}(main.MainUIIcon);i.PadkarIcon=t})(pedlar||(pedlar={}));var pedlar;(function(t){var e=function(){function t(t,e){if(game.Context.disableIosRecharge()){t.visible=false}else{this.ui=t;this.typeArr=e;t.on(Laya.Event.CLICK,this,this._onOpenHuolang);t.on(Laya.Event.DISPLAY,this,this.onDisplay);t.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);pedlarnew.PedkarNewModel.getIns().on(pedlarnew.PedkarNewModel.EVENTS.UPDATE_MAIN_VIEW,this,this._huolangIcon);this.activityTimeView=new activitytaren.ActivityTimeView(t.labeldaojishi,new Laya.Handler(this,this.hideSubTime))}}t.prototype.onDisplay=function(){this._huolangIcon()};t.prototype.onUnDisplay=function(){this.hideSubTime()};t.prototype._huolangIcon=function(){var t=pedlarnew.PedkarNewModel.getIns().isShowIcon(this.typeArr);this.ui.visible=t;if(t){this.ui.kuang.play();this.ui.visible=true;this.activityTimeView.start(pedlarnew.PedkarNewModel.getIns().getTime(this.typeArr))}else{this.ui.kuang.stop();this.hideSubTime()}};t.prototype._onOpenHuolang=function(){app.ViewManager.toggleDialog(pedlarnew.PedlarNewMainView,1,0,[0,this.typeArr])};t.prototype.hideSubTime=function(){this.activityTimeView.stop();this.ui.visible=false};return t}();t.PadkarIconControl=e})(pedlar||(pedlar={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var pedlar;(function(i){var n=activitytaren.ActivityTimeView;var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listdaoju.itemRender=grids.GridView;this.listdaoju.renderHandler=grids.GridView.CommonItemRender;this.centerLayout=new game.CenterLayoutMediator(this.listdaoju,this.box1,96,this.listdaoju.spaceX);this.timeView=new n(this.imgmiaoshu4,new Laya.Handler(this,this.endHandler),app.getLang("huolan_text_03"));this.btngoumai.clickHandler=new Laya.Handler(this,this.onBuyHandler)};e.prototype.onBuyHandler=function(){var t=this.oldData;if(!t){return}var e=t.getStatus();if(!e){return}if(e.status==i.E_PEDLA_MONEY.IS_BUY_NOT_LINGQU){app.ProtocolRequest.PedlarBuyReq(t.cfg.id,i.ELingquType.Lingqu);this.hide()}else{if(t.isTimeEnd){manager.FlowManager.instance.flowByStyle1(app.getLang("huolan_text_05"));return}if(e.isrmb){shop.ShopModel.getIns().chongzhi(e.recharge_id);return}else{if(e.status==i.E_PEDLA_MONEY.GoldNotEnough){shop.ShopModel.getIns().askChongZhi(true);return}else{console.log("货郎发送协议,元宝购买========================>id = %d",parseInt(t.cfg.id));app.ProtocolRequest.PedlarBuyReq(t.cfg.id,i.ELingquType.Buy)}}}};e.prototype.hide=function(){app.ViewManager.toggleDialog(e,-1)};e.prototype.endHandler=function(){this.imgmiaoshu3.visible=false;if(this.oldData)this.oldData.isTimeEnd=true};e.prototype.onDisplay=function(){this.callLater(this.refreshAll);game.MoneyModel.getIns().on(game.MoneyModel.EVENTS.MONEY_CHANGE,this,this.onMoneyChangeEvt);i.PadkarModel.getIns().on(i.PadkarModel.EVENT_PEDKAR_SERVERE_INFO,this,this.onGetNewInfoHandler);i.PadkarModel.getIns().event(i.PadkarModel.EVENT_PEDKAR_CLOSE_TIPS)};Object.defineProperty(e.prototype,"data",{get:function(){return i.PadkarModel.getIns().curVo},enumerable:true,configurable:true});e.prototype.onGetNewInfoHandler=function(){if(this.data==null){this.hide()}if(this.oldData&&this.data&&i.PedkarVo.equal(this.oldData,this.data)){this.refreshAll()}else{this.hide()}};e.prototype.onMoneyChangeEvt=function(){this.refreshAll()};e.prototype.onUnDisplay=function(){game.MoneyModel.getIns().off(game.MoneyModel.EVENTS.MONEY_CHANGE,this,this.onMoneyChangeEvt);i.PadkarModel.getIns().off(i.PadkarModel.EVENT_PEDKAR_SERVERE_INFO,this,this.onGetNewInfoHandler);this.timeView.stop()};e.prototype.refreshAll=function(){var t=this.data;this.oldData=t;if(t){var e=t.cfg;this.centerLayout.array=game.ItemUtil.parserList(e.items);this.imgmiaoshu2.text=app.getLang("huolan_text_01",1);this.imgmiaoshu3.visible=true;this.timeView.start(t.endTime);var i=t.getStatus();this.btngoumai.label=i.label;this.imgjiaobiao.skin=game.ResUrls.getZheKou2(e.discount)}else{}};return e}(ui.huolangtehui.huolangtehuiviewUI);i.PediarMainView=t})(pedlar||(pedlar={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var pedlar;(function(n){var t=function(e){__extends(i,e);function i(){var t=e!==null&&e.apply(this,arguments)||this;t.useTime=750;t.offsetY=20;return t}i.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.zOrder=app.AppContainer.UI_LAYER_NUME.HUODONG_TIP;this.endHandler=new Laya.Handler(this,this.onEndHandler);this.startHandler=new Laya.Handler(this,this.onStartHandler)};i.prototype.onShowList=function(t){this.callLater(this.onResize)};i.prototype.onDisplay=function(){n.PadkarModel.getIns().on(n.PadkarModel.EVENT_PEDKAR_CLOSE_TIPS,this,this.onPedkarHandler);game.Context.on(game.ContextEvent.CHANGE_MAP,this,this.onMapInfoChange);main.LeftIconList.getIns().on(main.IconListBase.EVENT_UPDATE_LEFT,this,this.onShowList);this.callLater(this.refreshAll);this.on(Laya.Event.RESIZE,this,this.onResize);this.imgdikuang.y=0;if(this.myTween){this.myTween.clear()}this.onStartHandler();Laya.timer.once(1e3,this,this.onCheckHide)};i.prototype.onCheckHide=function(){if(this.parent){var t=n.PadkarModel.getIns().curVo;if(t){var e=t.endTime-game.Context.getServerTime();if(e<0){app.ViewManager.toggleView(i,app.AppContainer.uiLayer,-1)}else{}}else{app.ViewManager.toggleView(i,app.AppContainer.uiLayer,-1)}Laya.timer.once(1e3,this,this.onCheckHide)}};i.prototype.onMapInfoChange=function(){game.Context.off(game.ContextEvent.CHANGE_MAP,this,this.onMapInfoChange);this.onPedkarHandler()};i.prototype.onEndHandler=function(){this.myTween=Laya.Tween.to(this.imgdikuang,{y:0},this.useTime,null,this.startHandler)};i.prototype.onStartHandler=function(){this.myTween=Laya.Tween.to(this.imgdikuang,{y:-this.offsetY},this.useTime,null,this.endHandler)};i.prototype.onPedkarHandler=function(){app.ViewManager.toggleView(i,app.AppContainer.uiLayer,-1)};i.prototype.refreshAll=function(){this.onResize();var t=this.data.cfg;var e=game.ItemUtil.parserList(t.items)[0];this.viewdaoju.setData(e)};i.prototype.onResize=function(){var t=n.PadkarModel.getIns().curVo;if(!t){return}var e=t.mainDlgId;if(e){var i=main.MainUIIcon.getMainUIIconPoint(e);if(i){this.x=this.x=i.x+main.LeftIconList.SIZE/2;this.y=i.y-this.height+main.LeftIconList.SIZE-10}}app.AppContainer.uiLayer.updateZOrder()};Object.defineProperty(i.prototype,"data",{get:function(){return n.PadkarModel.getIns().curVo},enumerable:true,configurable:true});i.prototype.onUnDisplay=function(){main.LeftIconList.getIns().off(main.IconListBase.EVENT_UPDATE_LEFT,this,this.onShowList);this.off(Laya.Event.RESIZE,this,this.onResize);n.PadkarModel.getIns().off(n.PadkarModel.EVENT_PEDKAR_CLOSE_TIPS,this,this.onPedkarHandler);if(this.myTween){this.myTween.clear()}};return i}(ui.huolangtehui.tehuitankuangUI);n.PedkarView=t})(pedlar||(pedlar={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var pedlarnew;(function(l){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){app.ViewManager.regist(l.PedlarNewMainView,"huolangtehui.atlas","waixiantegou.atlas");game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.PEDIAR_FUNC_NEW,l.PedlarNewMainView,null,0);main.MainUIIcon.iconClassMap[csv.MainIconProxy.PEDIAR_NEW]=l.PadlarNewIcon;this._teamLv=game.Config.getIntParams(1211)};e.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.PedlarNewNtf,this,this.onPedlarNewNtf);this.addMsgListener(app.ProtocolResponse.PedlarNewAwardAck,this,this.onPedlarNewAwardAck)};e.prototype.onPedlarNewNtf=function(t,e){l.PedkarNewModel.getIns().data=e.data;l.PedkarNewModel.getIns().data.sort(this.onSort);if(e.data.length==0){game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.PEDIAR_FUNC_NEW)}else{if(l.PedkarNewModel.getIns().isRedTip()){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.PEDIAR_FUNC_NEW)}else{game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.PEDIAR_FUNC_NEW)}}main.LeftIconList.getIns().refreshAll();l.PedkarNewModel.getIns().event(l.PedkarNewModel.EVENTS.UPDATE_MAIN_VIEW);if(!this._padlarId){this._padlarId=[];for(var i=0;i<e.data.length;i++){this._padlarId.push(e.data[i].cfg_id)}}else{var n=false;var a=0;var o=0;for(var i=0;i<e.data.length;i++){if(this._padlarId.indexOf(e.data[i].cfg_id)==-1){this._padlarId.push(e.data[i].cfg_id);a=parseInt(csv.Pushshop2Proxy.getIns().getCfg(e.data[i].cfg_id).eventype);o=parseInt(csv.Pushshop2Proxy.getIns().getCfg(e.data[i].cfg_id).para);n=true}}var s=!game.Context.disableIosRecharge();if(n&&game.Context.teamLv>=this._teamLv&&e.data.length<=20){if(a==4){var r=0;if(o==12){r=5500}else{r=3500}if(s){Laya.timer.once(r,this,function(){app.ViewManager.toggleDialog(l.PedlarNewMainView,1,0,[e.data.length-1])})}}else{if(s){app.ViewManager.toggleDialog(l.PedlarNewMainView,1,0,[e.data.length-1])}}}}};e.prototype.onPedlarNewAwardAck=function(t,e){};e.prototype.onSort=function(t,e){if(t.time>e.time){return 1}else if(t.time<e.time){return-1}else{return 0}};e.SINGLE_KEY="pedlarnew.PedkarNewModule";return e}(app.ModuleBase);l.PedkarNewModule=t})(pedlarnew||(pedlarnew={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var pedlarnew;(function(t){var e=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.data=[];return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.init=function(){};t.prototype.getTimeVo=function(){for(var t=0;t<this.data.length;t++){var e=this.data[t];if(e.state==0){return e}}return null};t.prototype.isRedTip=function(){for(var t=0;t<this.data.length;t++){var e=this.data[t];if(e.state==1){return true}}return false};t.prototype.isOpenCheck=function(){if(t.getIns().data.length==0){return false}else{return true}};t.prototype.isShowIcon=function(t){for(var e=0;e<this.data.length;e++){var i=csv.Pushshop2Proxy.getIns().getCfg(this.data[e].cfg_id);if(t.indexOf(parseInt(i.eventype))!=-1){return true}}return false};t.prototype.getTime=function(t){for(var e=0;e<this.data.length;e++){var i=csv.Pushshop2Proxy.getIns().getCfg(this.data[e].cfg_id);if(t.indexOf(parseInt(i.eventype))!=-1){if(this.data[e].state==0){return this.data[e].time}}}return 0};t.SINGLE_KEY="pedlarnew.PedkarNewModel";t.EVENTS={UPDATE_MAIN_VIEW:"UPDATE_MAIN_VIEW"};t.ENUMS={TEAM_LEVEL:1,XIANGYAOZHILU:2,JIESUOWA:3,YUANSHENGJINJIE:4,QISESHAN:5,FABAOCHOUJIANG:6};return t}(app.ModelBase);t.PedkarNewModel=e})(pedlarnew||(pedlarnew={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("pushshop2.csv");this.cfgMap=t.getMap("id")};e.prototype.getCfg=function(t){return this.cfgMap[t]};e.SINGLE_KEY="csv.Pushshop2Proxy";return e}(app.ModelBase);t.Pushshop2Proxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var pedlarnew;(function(i){var t=function(n){__extends(t,n);function t(t,e){if(e===void 0){e=main.IconListBase.SIZE}var i=n.call(this,t,e)||this;i.setTimeLabel();i.timeView=new activitytaren.ActivityTimeView(i.lblTime,new Laya.Handler(i,i.endHandler),undefined,undefined,activitytaren.ActivityTimeView.TYPE_KEEP_2_BIT);return i}t.prototype.onDisplay=function(){n.prototype.onDisplay.call(this);this.clearData();this.init()};t.prototype.onUnDisplay=function(){n.prototype.onUndisplay.call(this)};t.prototype.clearData=function(){if(this.timeView){this.timeView.stop()}};t.prototype.init=function(){this.onInfoHandler()};t.prototype.onInfoHandler=function(){if(!main.LeftIconList.getIns().parent){return}var t=i.PedkarNewModel.getIns().data;if(t.length==0){return}if(this.timeView){this.timeView.stop()}var e=i.PedkarNewModel.getIns().getTimeVo();if(e){this.timeView.start(e.time)}};t.prototype.endHandler=function(){};return t}(main.MainUIIcon);i.PadlarNewIcon=t})(pedlarnew||(pedlarnew={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var pedlarnew;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.updateLayout)};e.prototype.onUnDisplay=function(){};e.prototype.updateLayout=function(){};e.SINGLE_KEY="pedlarnew.PedlarNewBtnCell";return e}(ui.huolangtehui.libaoitemUI);t.PedlarNewBtnCell=e})(pedlarnew||(pedlarnew={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var pedlarnew;(function(a){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t._num=3;t.isCellDot=true;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.listdaoju.itemRender=grids.GridView;this.listdaoju.renderHandler=grids.GridView.CommonItemRender;this.centerLayout=new game.CenterLayoutMediator(this.listdaoju,this.box1,96,this.listdaoju.spaceX);this.timeView=new activitytaren.ActivityTimeView(this.imgmiaoshu4,new Laya.Handler(this,this.endHandler));this.listlibao.itemRender=a.PedlarNewBtnCell;this.listlibao.renderHandler=new Laya.Handler(this,this.onCell);this.listlibao.selectEnable=true;this.btngoumai.clickHandler=new Laya.Handler(this,this.onBtngoumaiClick);this.btnzuo.clickHandler=new Laya.Handler(this,this.onBtnzuo);this.btnyou.clickHandler=new Laya.Handler(this,this.onBtnyou);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};t.prototype.onDisplay=function(){app.SoundManager.getIns().playSound("functionopen");guide.GuideModel.getIns().boOpen=false;a.PedkarNewModel.getIns().on(a.PedkarNewModel.EVENTS.UPDATE_MAIN_VIEW,this,this.onMainView);this.callLater(this.updateLayout)};t.prototype.onUnDisplay=function(){app.SoundManager.getIns().playSound("functionclose");guide.GuideModel.getIns().boOpen=true;a.PedkarNewModel.getIns().off(a.PedkarNewModel.EVENTS.UPDATE_MAIN_VIEW,this,this.onMainView);this.listlibao.selectedIndex=-1};t.prototype.onMainView=function(){if(!this._data)return;this.getListData();if(this._listData&&this._listData.length==0){this.close()}else{for(var t=0;t<this._listData.length;t++){if(this._listData[t].cfg_id==this._data.cfg_id){this.listlibao.array=this._listData;this.listlibao.refresh();this.updataRedTip();return}}var e=false;if(this.listlibao.selectedIndex>=this.listlibao.array.length-1){e=true}this.listlibao.array=this._listData;this.listlibao.refresh();this.onBtnzuo();if(!e){var i=this.listlibao.selectedIndex-1;if(i<0){i=0}this.listlibao.selectedIndex=i}this.updataRedTip()}};t.prototype.endHandler=function(){this.imgmiaoshu3.visible=false};t.prototype.onBtngoumaiClick=function(){if(this._data){if(this._data.state==1){app.ProtocolRequest.PedlarNewAwardReq(this._data.cfg_id)}else{var t=csv.Pushshop2Proxy.getIns().getCfg(this._data.cfg_id);shop.ShopModel.getIns().chongzhi(t.price)}}};t.prototype.onBtnzuo=function(){this._index--;if(this._index<0){this._index=0}this.updataBtn();this.listlibao.scrollTo(this._index);Laya.timer.callLater(this,this.doDotUpdate);var t=this.listlibao.selectedIndex-this._index;if(t>2){this.listlibao.selectedIndex=this.listlibao.selectedIndex-1}};t.prototype.onBtnyou=function(){this._index++;if(this._index>this._listData.length){this._index=this._listData.length}this.updataBtn();this.listlibao.scrollTo(this._index);Laya.timer.callLater(this,this.doDotUpdate);var t=this._index-this.listlibao.selectedIndex;if(t>0){this.listlibao.selectedIndex=this.listlibao.selectedIndex+1}};t.prototype.onCell=function(t,e){if(this.listlibao.selectedIndex!=-1){var i=csv.Pushshop2Proxy.getIns().getCfg(t.dataSource.cfg_id);var n=csv.RechargeProxy.getIns().getRechargeMapCell(i.price);var a=parseInt(n.recharge)/100;t.imgjiage.skin="huolangtehui/bg_libaojiage"+a+".png";if(e==this.listlibao.selectedIndex){t.btnyeqian.selected=true;this.showView(t.dataSource)}else{t.btnyeqian.selected=false}}};t.prototype.updataRedTip=function(){var t=[];for(var e=0;e<this._listData.length;e++){if(this._listData[e].state==1){t.push(e)}}this.setDots(t)};t.prototype.getListData=function(){var t=[];if(this.dataSource&&this.dataSource[1]){var e=this.dataSource[1];for(var i=0;i<a.PedkarNewModel.getIns().data.length;i++){var n=csv.Pushshop2Proxy.getIns().getCfg(a.PedkarNewModel.getIns().data[i].cfg_id);if(e.indexOf(parseInt(n.eventype))!=-1){t.push(a.PedkarNewModel.getIns().data[i])}}this._listData=t}else{this._listData=a.PedkarNewModel.getIns().data}};t.prototype.updateLayout=function(){var t=0;var e=0;var i=0;this.getListData();if(this.dataSource&&this.dataSource[0]){var n=parseInt(this.dataSource[0]);if(this._listData.length>3){t=n-2;i=n-2}e=n}this._index=t;this.listlibao.array=this._listData;this.listlibao.selectedIndex=e;this.updataBtn();this.updataRedTip();this.listlibao.scrollTo(i)};t.prototype.updataBtn=function(){var t=this._listData;if(t.length<=this._num){this.btnzuo.visible=false;this.btnyou.visible=false}else{if(this._index<=0){this.btnzuo.visible=false;this.btnyou.visible=true}else if(this._index>=t.length-3){this.btnzuo.visible=true;this.btnyou.visible=false}else{this.btnzuo.visible=true;this.btnyou.visible=true}}};t.prototype.showView=function(t){this._data=t;var e=csv.Pushshop2Proxy.getIns().getCfg(this._data.cfg_id);var i=csv.RechargeProxy.getIns().getRechargeMapCell(e.price);if(this._data.state==1){this.imgmiaoshu3.visible=false;this.imgmiaoshu4.visible=false;this.timeView.stop();this.imggoumai.skin="huolangtehui/bg_lingqujiangli.png";game.RedDotView.addTo(this.btngoumai)}else{this.imgmiaoshu3.visible=true;this.imgmiaoshu4.visible=true;this.timeView.start(this._data.time);var n=parseInt(i.recharge)/100;this.imggoumai.skin="huolangtehui/bg_libaojiageanniu"+n+".png";game.RedDotView.removeFrom(this.btngoumai)}this.centerLayout.array=game.ItemUtil.parserList(i.reward);this.imgmiaoshu1.skin="huolangtehui/"+e.res+".png"};t.prototype.setDots=function(t,e,i){if(t){this.dotsParams={indexes:t,dotX:e,dotY:i};Laya.timer.callLater(this,this.doDotUpdate)}else{this.dotsParams=null;Laya.timer.clear(this,this.doDotUpdate)}};t.prototype.doDotUpdate=function(){if(!this.dotsParams){return}var t=this.dotsParams.indexes;var e=this.dotsParams.dotX;var i=this.dotsParams.dotY;for(var n=0;n<this.listlibao.cells.length;++n){var a=this.listlibao.array.indexOf(this.listlibao.cells[n].dataSource);if(this.isCellDot&&t.indexOf(a)>-1){game.RedDotView.addTo(this.listlibao.cells[n],e?e:this.listlibao.cells[n].width-5,i?i:5)}else{game.RedDotView.removeFrom(this.listlibao.cells[n])}var o=false;var s=false;for(var r=0;r<t.length;++r){if(t[r]<this.listlibao.startIndex){o=true}if(t[r]>=this.listlibao.repeatX+this.listlibao.startIndex){s=true}}if(o){game.RedDotView.addTo(this.btnzuo)}else{game.RedDotView.removeFrom(this.btnzuo)}if(s){game.RedDotView.addTo(this.btnyou,20)}else{game.RedDotView.removeFrom(this.btnyou)}}};t.SINGLE_KEY="pedlarnew.PedlarNewMainView";return t}(ui.huolangtehui.huolangtehuiviewnewUI);a.PedlarNewMainView=t})(pedlarnew||(pedlarnew={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var pet;(function(a){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){app.ViewManager.regist(a.PetEggsView,"xianshouju.atlas");app.ViewManager.regist(a.PetListView,"chongwu.atlas");app.ViewManager.regist(a.PetGoFightView,"chongwu.atlas");app.ViewManager.regist(a.PetGettedSuccessView,"xianshouju.atlas");game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.BAG_PET,a.BagPetView);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.PET_LIST,a.PetListView);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.PET_FETTER,a.PetFetterView);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.PET_BATTLE,a.PetGoFightView);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.PET_EGGS,a.PetEggsView);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.PET_REPUTION,a.PetReputionView);game.FuncDotAdapter.registRedFunc(csv.FunctionsProxy.ENUMS.PET_LIST,this,this.onRedDotChange);a.PetModel.getIns().on(a.PetEvent.PET_EGG_GRID_UPDATE,a.PetModel.getIns(),a.PetModel.getIns().reddotEggs);game.FuncDotAdapter.registRedFunc(csv.FunctionsProxy.ENUMS.PET_EGGS,a.PetModel.getIns(),a.PetModel.getIns().reddotEggs)};e.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.FreePetAck,this,this.onFreePetAck);this.addMsgListener(app.ProtocolResponse.UpdatePetAck,this,this.onUpdatePetAck);this.addMsgListener(app.ProtocolResponse.PetStarAck,this,this.onPetStarAck);this.addMsgListener(app.ProtocolResponse.PetReputionAck,this,this.onPetReputionAck);this.addMsgListener(app.ProtocolResponse.PetDelNtf,this,this.onPetDelNtf);this.addMsgListener(app.ProtocolResponse.PetModifyNtf,this,this.onPetModifyNtf);this.addMsgListener(app.ProtocolResponse.PetGainPush,this,this.onPetGainPush);this.addMsgListener(app.ProtocolResponse.PetPackNtf,this,this.onPetPackNtf);this.addMsgListener(app.ProtocolResponse.PetReputationNtf,this,this.onPetReputationNtf);this.addMsgListener(app.ProtocolResponse.PetSpaceNtf,this,this.onPetSpaceNtf);this.addMsgListener(app.ProtocolResponse.UnlockPetSpaceAck,this,this.onUnlockPetSpaceAck);this.addMsgListener(app.ProtocolResponse.HatchPetAck,this,this.onHatchPetAck);this.addMsgListener(app.ProtocolResponse.SpeedPetAck,this,this.onSpeedPetAck);this.addMsgListener(app.ProtocolResponse.GainPetAck,this,this.onGainPetAck);this.addMsgListener(app.ProtocolResponse.PetFormNtf,this,this.onPetFormNtf);this.addMsgListener(app.ProtocolResponse.PetMoveAck,this,this.onPetMoveAck);this.addMsgListener(app.ProtocolResponse.FullPetStarNtf,this,this.onFullPetStarNtf)};e.prototype.onFullPetStarNtf=function(t,e){a.PetModel.getIns().onFullPetStar(e.fullpet)};e.prototype.onPetFormNtf=function(t,e){a.PetModel.getIns().setPetPosMap(e);if(a.PetModel.getIns().getPetPosMap()[7]){var i=a.PetModel.getIns().getWearPetRoleRedArr();game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.PET_BATTLE);for(var n=0;n<i.length;n++){if(i[n]){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.PET_BATTLE);break}}}a.PetModel.getIns().event(a.PetEvent.PET_GO_POS_CHANGE)};e.prototype.onPetMoveAck=function(t,e){if(e.result){a.PetModel.getIns().isMoveActon=false}};e.prototype.onGainPetAck=function(t,e){if(e.result==1){a.PetControl.onGainPetAck(e.spos)}};e.prototype.onSpeedPetAck=function(t,e){if(e.result==1){a.PetControl.onSpeedPetAck(e.spos)}};e.prototype.onHatchPetAck=function(t,e){if(e.result==1){a.PetControl.onHatchPetAck(e.spos)}};e.prototype.onUnlockPetSpaceAck=function(t,e){if(e.result==1){a.PetControl.onUnlockPetSpaceAck(e.spos)}};e.prototype.onPetSpaceNtf=function(t,e){a.PetModel.getIns().updatePetSpace(e.pspace)};e.prototype.onPetPackNtf=function(t,e){a.PetControl.onPetPackNtf(e.petPack)};e.prototype.onPetGainPush=function(t,e){a.PetControl.updateTipsList(e.petID)};e.prototype.onPetModifyNtf=function(t,e){a.PetControl.onPetModifyNtf(e.petModify,e.spos)};e.prototype.onPetDelNtf=function(t,e){if(a.PetModel.getIns().isMoveActon==false){a.PetModel.getIns().onDelPet(e.instId);a.PetControl.updateTipsList(e.instId)}};e.prototype.onPetReputionAck=function(t,e){if(e.result==1){a.PetControl.onReputionAck(e.replv,e.repexp)}a.PetModel.getIns().isUpgradeActon=false};e.prototype.onPetReputationNtf=function(t,e){a.PetModel.getIns().replv=e.replv;a.PetModel.getIns().repexp=e.repexp};e.prototype.onPetStarAck=function(t,e){if(e.result==1){a.PetControl.onStarUpAct()}a.PetModel.getIns().isUpgradeActon=false};e.prototype.onUpdatePetAck=function(t,e){if(e.result==1){a.PetControl.onLevelUpAct()}a.PetModel.getIns().isUpgradeActon=false};e.prototype.onFreePetAck=function(t,e){if(e.result==1){a.PetControl.onReleaseAct()}};e.prototype.onRedDotChange=function(){Laya.timer.callLater(this,this.onUpdateRedDot)};e.prototype.onUpdateRedDot=function(){a.PetModel.getIns().onUpdateRedDot()};e.SINGLE_KEY="pet.PetModule";return e}(app.ModuleBase);a.PetModule=t})(pet||(pet={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var pet;(function(s){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.on(Laya.Event.CLICK,this,this.onClick);this.btnjiasu.on(Laya.Event.CLICK,this,this.onSpeed)};e.prototype.onDisplay=function(){s.PetModel.getIns().on(s.PetEvent.PET_UNLOCKSPACE,this,this.onActionAct);s.PetModel.getIns().on(s.PetEvent.PET_HATCH_ACK,this,this.onActionAct);s.PetModel.getIns().on(s.PetEvent.PET_SPEEDPET_ACK,this,this.onActionAct);s.PetModel.getIns().on(s.PetEvent.PET_GAIN_ACK,this,this.onActionAct);this.callLater(this.refreshAll)};e.prototype.stopAllAni=function(){this.xuanzhong.stop();this.xuanzhong.visible=false;this.fuhua.stop();this.fuhua.visible=false;this.fuhuazhong.stop();this.fuhuazhong.visible=false};e.prototype.onUnDisplay=function(){this.stopAllAni();Laya.timer.clear(this,this.coolDown);s.PetModel.getIns().off(s.PetEvent.PET_UNLOCKSPACE,this,this.onActionAct);s.PetModel.getIns().off(s.PetEvent.PET_HATCH_ACK,this,this.onActionAct);s.PetModel.getIns().off(s.PetEvent.PET_SPEEDPET_ACK,this,this.onActionAct);s.PetModel.getIns().off(s.PetEvent.PET_GAIN_ACK,this,this.onActionAct)};e.prototype.onActionAct=function(t,e){if(t==s.PetEvent.PET_GAIN_ACK){this.updateView()}else if(e==this._index+1){this.updateView();if(t==s.PetEvent.PET_HATCH_ACK){s.PetEggsView.getIns().autoSelect(this._index)}}};e.prototype.onClick=function(){var t=s.PetModel.getIns().gridList[this._index];if(t.islock){var e=s.PetModel.getIns().getUnlockCost();game.Alert.show(app.getLang("peteggs_1",e.itemid,e.count),Laya.Handler.create(this,this.onUnlockGrid),new Laya.Handler);s.PetEggsView.getIns().hideSeedList()}else if(t.isEnd()){s.PetEggsView.getIns().hideSeedList();s.PetControl.cssGainPetReq(this._index+1,1);return}else if(t.id>0){s.PetEggsView.getIns().hideSeedList();tip.TipManager.show(game.ItemUtil.createVO(t.id))}else{s.PetEggsView.getIns().showSeedList()}s.PetEggsView.getIns().onSelectHandler(this)};e.prototype.onSpeed=function(t){t.stopPropagation();var e=s.PetModel.getIns().gridList[this._index];var i=e.endTime-game.Context.getServerTime();var n=Math.ceil(i/60);var a=n*game.Config.getIntParams(1242)/100;var o=csv.PetProxy.getIns().getGrowName(e.id);game.Alert.show(app.getLang("peteggs_2",app.getLang(o),game.ItemUtil.ENUMS.YUANBAO,a),Laya.Handler.create(this,this.onSpeedCallBack,[a]),new Laya.Handler)};e.prototype.onUnlockGrid=function(){s.PetControl.c2sUnlockPetSpace(this.spos())};e.prototype.onSpeedCallBack=function(t){if(game.GridsModel.getIns().hasEnoughItems(game.ItemUtil.ENUMS.YUANBAO+"-"+t)){s.PetControl.c2sSpeedPetReq(this.spos())}else{shop.ShopModel.getIns().askChongZhi()}};e.prototype.refreshAll=function(){};e.prototype.spos=function(){return this._index+1};e.prototype.getIndex=function(){return this._index};e.prototype.init=function(t){this._index=t};e.prototype.updateView=function(){this.stopAllAni();this.ani2.gotoAndStop(0);this.setSelected(false);Laya.timer.clear(this,this.coolDown);this.imggezi.skin="";var t=s.PetModel.getIns().gridList[this._index];if(t){this.imggezi.skin="res/icon/xianshou/xianshoudan_"+t.id+".png"}if(t.islock){this.ani1.gotoAndStop(0)}else if(t.isEnd()){this.eggToPet()}else if(t.id>0){var e=t.endTime-game.Context.getServerTime();if(e>=0){this.ani1.gotoAndStop(2);this.fuhuazhong.play(0,true);this.fuhuazhong.visible=true;this.labelmiaoshu.text=app.getLang("peteggs_3",util.TimeUtil.sec2Str(e,false,4,false,true));Laya.timer.loop(1e3,this,this.coolDown)}else{this.eggToPet()}}else{this.ani1.gotoAndStop(1)}};e.prototype.getState=function(){var t=s.PetModel.getIns().gridList[this._index];if(t.id>0||t.islock){return true}return false};e.prototype.setSelected=function(t){this.xuanzhongimg.visible=t};e.prototype.coolDown=function(){var t=s.PetModel.getIns().gridList[this._index];var e=t.endTime-game.Context.getServerTime();if(e>=0){this.labelmiaoshu.text=app.getLang("peteggs_3",util.TimeUtil.sec2Str(e,false,4,false,true))}else{this.eggToPet();Laya.timer.clear(this,this.coolDown)}};e.prototype.eggToPet=function(){this.ani1.gotoAndStop(3);this.fuhua.play(0,true);this.fuhua.visible=true;this.xuanzhong.play(0,true);this.xuanzhong.visible=true;this.ani2.play(0,true)};e.SINGLE_KEY="pet.EggGridView";return e}(ui.xianshouju.kongweiitemUI);s.EggGridView=t})(pet||(pet={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var pet;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.onSeedSelectHandler=function(){i.PetEggsView.getIns().onHatchPet(this._data)};e.SINGLE_KEY="pet.EggItem";return e}(garden.SeedItem);i.EggItem=t})(pet||(pet={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("newpetspace.csv");this.newpetspace=t.getArray();var e=app.Config.getResById("newpetattribute.csv");this.petCfg=e.getMap("petid");this.list=e.getArray();var i=app.Config.getResById("newpetgrow.csv");this.petGrowArr=i.getMapList("petid");this.petGrowCfg=i.getMap("peteggid");var n=app.Config.getResById("newpetattribute_update.csv");this.newpetupdate=n.getMapList("petid","level");var a=app.Config.getResById("newpet_base.csv");this.newpet_base=a.getMap("id");var o=app.Config.getResById("newpetattribute_level.csv");this.newpetattribute_level=o.getMap("levelid");var s=app.Config.getResById("newpetvolute.csv");this.newpetvolute=s.getMapList("petid","star");var r=app.Config.getResById("newpetreputation.csv");this.newpetreputation=r.getMap("index");this.newpetreputationArray=r.getArray();var l=app.Config.getResById("newpettalent.csv");this.newpettalent=l.getMapList("attriid");var h=app.Config.getResById("newpetcombination.csv");this.newpetcombination=h.getMapList("comid");this.newpetcombinationMap=h.getMap("id");this.allCombination=h.getArray();var p=app.Config.getResById("newpetskill.csv");this.newpetskill=p.getMapList("newpetskill")};e.prototype.getNewpetreputationArray=function(){return this.newpetreputationArray};e.prototype.getPetSkill=function(t){return this.newpetskill[t]};e.prototype.getShowCombEff=function(t){var e=[];for(var i=0,n=t.length;i<n;i++){e.push(this.newpetcombinationMap[t[i]])}SortUtil.sortOnArr(e,["quality","id"],[SortUtil.DESCENDING,SortUtil.DESCENDING]);return e[0].effectres};e.prototype.getAllCombination=function(){return Object.keys(this.newpetcombination)};e.prototype.getGroupById=function(t){return this.newpetcombination[t]};e.prototype.getCombination=function(t){var e=[],i=[];for(var n=0;n<this.allCombination.length;n++){e=app.str2Array(this.allCombination[n].needpet,"-");for(var a=0;a<e.length;a++){if(parseInt(e[a])==t){i.push(this.allCombination[n]);break}}}return i};e.prototype.getTalent=function(t){return this.newpettalent[t]?app.str2Array(this.newpettalent[t][0]["talent7"],"-")[0]:""};e.prototype.getReputation=function(t){return this.newpetreputation[t]};e.prototype.getMaxReputation=function(){var t=Object.keys(this.newpetreputation).length;return this.newpetreputation[t]};e.prototype.getVolute=function(t,e){return this.newpetvolute[t][e]?this.newpetvolute[t][e][0]:null};e.prototype.getAttributeLevel=function(t){return this.newpetattribute_level[t]?this.newpetattribute_level[t].attr:""};e.prototype.getScroeByLevel=function(t){return this.newpetattribute_level[t]?this.newpetattribute_level[t].levelpoint:0};e.prototype.getBattleByLevel=function(t){return this.newpetattribute_level[t]};e.prototype.getBaseAttr=function(t){return this.newpet_base[t].attr};e.prototype.getAllPets=function(){return this.list};e.prototype.getPetCfg=function(t){return this.petCfg[t]};e.prototype.getSpaceCfg=function(t){var e=app.str2Array(this.newpetspace[t].unlockitem,"-");return{itemid:parseInt(e[0]),count:parseInt(e[1])}};e.prototype.getGrowBattery=function(t){var e=this.petGrowArr[t][0];var i=app.str2Array(e.baseattr,"-");var n={};for(var a=0;a<=i.length;a++){n[i[a]]=e["addbattery"+(a+1)]}return n};e.prototype.getGrowScore=function(t){var e=this.petGrowArr[t][0];var i=app.str2Array(e.baseattr,"-");var n=[];for(var a=0;a<=i.length;a++){n[i[a]]=e["score"+(a+1)]}return n};e.prototype.getGrowName=function(t){var e=this.petGrowCfg[t].petid;return this.getPetCfg(e).namelang};e.prototype.getGrowTime=function(t){return this.petGrowCfg[t].growtime};e.prototype.getPetCfgByEggId=function(t){var e=this.petGrowCfg[t].petid;return this.getPetCfg(e)};e.prototype.getUpdateExp=function(t,e){return this.newpetupdate[t]?this.newpetupdate[t][e][0].cost:0};e.prototype.getUpdateLevel=function(t,e){return this.newpetupdate[t]?this.newpetupdate[t][e][0].level:0};e.SINGLE_KEY="csv.PetProxy";return e}(app.ModelBase);t.PetProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var pet;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.initList(this.baglist0);this.initList(this.baglist1)};e.prototype.initList=function(t){t.itemRender=grids.GridView;t.renderHandler=new Laya.Handler(this,this.onRender);t.scrollRectOffX=10;t.scrollRectOffY=5};e.prototype.onRender=function(t,e){t.setData(t.dataSource,"",1,false)};e.prototype.onDisplay=function(){this.baglist0.scrollTo(0);this.baglist0.scrollTo(1);game.GridsModel.getIns().on(game.GridsModel.EVENTS.UPDATE,this,this.refreshAll);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){game.GridsModel.getIns().off(game.GridsModel.EVENTS.UPDATE,this,this.refreshAll)};e.prototype.refreshAll=function(){this.baglist0.array=game.GridsModel.getIns().getPetItemsBySubType(2);this.baglist1.array=game.GridsModel.getIns().getPetItemsBySubType(1);var t=game.GridsModel.getIns().getGridByType(game.GridsModel.BAG_PET);this.numlabel.text=t.itemList.length+"/"+t.openSize};e.SINGLE_KEY="pet.BagPetView";return e}(ui.chongwu.chongwubeibaonewUI);t.BagPetView=e})(pet||(pet={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var pet;(function(h){var i=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.huakuai.showLabel=false;this.huakuai.changeHandler=new Laya.Handler(this,this.onChange);this.curValue=0};e.prototype.onDisplay=function(){};e.prototype.onUnDisplay=function(){this.curValue=0};e.prototype.onChange=function(t){var e=h.ItemChooseItemView.getIns().canAdd(t,this.curValue);if(e>0){this.curValue=this.data.selected+e}else{t+=e;this.curValue=t;this.huakuai.value=t}this.huakuai.value=this.curValue;this.shuliang.text=this.curValue+"/"+this.data.limit;h.ItemChooseItemView.getIns().onChooseMat(this.data.vo,this.curValue)};e.prototype.setData=function(t){this.data=t;this.wenben.text=t.vo.getName();this.huakuai.setSlider(0,t.limit,t.selected);this.daoju.setData(t.vo);this.daoju.shuzi.text=""};return e}(ui.chongwu.hunjingosuipianitemUI);h.ItemHunJinView=i;var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listliebiao.itemRender=i;this.listliebiao.renderHandler=new Laya.Handler(this,this.onItemRender);this.btnyijianxuanze.clickHandler=new Laya.Handler(this,this.onQuickChoose);this.btrnliketianjia.clickHandler=new Laya.Handler(this,this.onBtnOk)};e.prototype.canAdd=function(t,e){var i=t-e;var n=0,a=0;if(i>0){for(var o=0;o<this.mat.length;o++){a+=this.mat[o].selected}if(a<this.need){if(a+i>this.need){n=this.need-a}else{n=i}}else{n=-i}}return n};e.prototype.onChooseMat=function(t,e){var i=this.getObj(t.getInstId());i.selected=e};e.prototype.onBtnOk=function(){if(this.mat.length==0){manager.FlowManager.instance.flowByStyle1(app.getLang("当前没有可选择的魂晶"));return}var t=false;for(var e=0,i=this.mat;e<i.length;e++){var n=i[e];if(n.selected>0){t=true;break}}if(t){h.PetStarUpView.getIns().onChooseMat(this.mat);this.close()}else{manager.FlowManager.instance.flowByStyle1(app.getLang("请选择所需的魂晶"))}};e.prototype.onQuickChoose=function(){var t=this.need;for(var e=0;e<this.mat.length;e++){this.mat[e].selected=0}for(var e=0;e<this.mat.length;e++){if(t>this.mat[e].limit){this.mat[e].selected=this.mat[e].limit}else{this.mat[e].selected=t}t-=this.mat[e].selected;if(t<=0)break}this.onBtnOk()};e.prototype.onItemRender=function(t){t.setData(t.dataSource)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.getObj=function(t){var e={};for(var i=0;i<this.mat.length;i++){if(Uint64.equal(this.mat[i].vo.getInstId(),t)){e=this.mat[i];break}}return e};e.prototype.refreshAll=function(){var t=this.dataSource[0];var e=this.dataSource[1];this.need=parseInt(app.str2Array(t,"-")[1]);var i=parseInt(app.str2Array(t,"-")[0]);var n=87001;if(i>3){n=87002}var a=game.ItemUtil.createVO(n);this.daoju.setData(a);if(this.mat.length==0){var o=parseInt(app.str2Array(e,"-")[0]);var s=parseInt(app.str2Array(e,"-")[1]);var r=h.PetModel.getIns().getMat(i);for(var l=0;l<r.length;l++){if(s>0&&r[l].getItemId()==o){if(a.count>=s){this.mat.push({vo:r[l],limit:s,selected:0});s=0}else{this.mat.push({vo:r[l],limit:r[l].count,selected:0});s-=a.count}}else{this.mat.push({vo:r[l],limit:r[l].count,selected:0})}}}this.listliebiao.array=this.mat;this.imgtishi.visible=this.mat.length==0;this.labelmiaoshu.text=app.getLang("newpetvolutetips_1",app.getLang("qua_name_"+i))};e.prototype.cleanMat=function(){this.mat=[]};e.SINGLE_KEY="pet.ItemChooseItemView";return e}(ui.chongwu.xuanzehunjingtipUI);h.ItemChooseItemView=t})(pet||(pet={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var pet;(function(n){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listhuoming.renderHandler=new Laya.Handler(this,this.onTextRender);this._model=n.PetModel.getIns()};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){var t=csv.PetProxy.getIns().getCombination(this.dataSource);this.listhuoming.array=t};e.prototype.onTextRender=function(t){var e=t.dataSource.effect;var i=Attributes.decode(e).baseList[0];t.text=app.getLang(t.dataSource.des)+": "+app.getLang("newpet_effectdesc_01",Attributes.getPropName(i.propId),i.value);t.gray=!n.PetModel.getIns().checkPetEffect(t.dataSource.comstar,t.dataSource.needpet)};e.SINGLE_KEY="pet.PetFetterTipView";return e}(ui.chongwu.jibanshuomingUI);n.PetFetterTipView=t})(pet||(pet={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var pet;(function(a){var i=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.stars=new common.StarListMediator(this.xinglist,this.xingbox,game.ComStarItem.W);this.imgxuanzhong.visible=false};e.prototype.setData=function(t){var e=parseInt(t);this.imgtouxiang.skin="res/icon/item/pet_"+e+".png";var i=csv.PetProxy.getIns().getPetCfg(e);this.labelname.text=app.getLang(i.namelang);var n=a.PetModel.getIns().activeByPetid(e);if(n){this.stars.setStar(n.star,i.star);this.labeldengji.text=app.getLang("zuoqi_11")+n.plevel;this.gray=false;this.imgxuanzhong.visible=true}else{this.stars.setStar(0,i.star);this.labeldengji.text="";this.gray=true;this.imgxuanzhong.visible=false}};return e}(ui.chongwu.jibanitemUI);a.PetInfoItem=i;var n=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.list.itemRender=i;this.list.renderHandler=new Laya.Handler(this,this.onItemRender);this.laistmiaoshu.renderHandler=new Laya.Handler(this,this.onTextRender)};e.prototype.onTextRender=function(t){var e=t.dataSource.effect;var i=Attributes.decode(e).baseList[0];t.text=app.getLang("newpet_effectdesc_01",Attributes.getPropName(i.propId),i.value);t.gray=!a.PetModel.getIns().checkPetEffect(t.dataSource.comstar,t.dataSource.needpet)};e.prototype.onItemRender=function(t){t.setData(t.dataSource)};e.prototype.setData=function(t){var e=csv.PetProxy.getIns().getGroupById(parseInt(t));this.ele=e[0];this.list.array=app.str2Array(this.ele.needpet,"-");this.listwenzi.text=app.getLang(this.ele.des);this.laistmiaoshu.array=e};return e}(ui.chongwu.jibanListUI);a.PetFetterItem=n;var t=function(i){__extends(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){i.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listJiban.itemRender=n;this.listJiban.renderHandler=new Laya.Handler(this,this.onItemRender);this.selectorClass=new a.SelectorClass(this.list,new Laya.Handler(this,this.showList),this.type0,null,null);this.selectorClass.type1Souce=[];this.type0.labelmiaoshu1.text=app.getLang("newpet_title_1");var t=game.Config.getParams(1283).split(";");for(var e=0;e<t.length;e++){this.selectorClass.type1Souce.push({text:app.getLang("newpet_comdes_"+t[e]),value:t[e]})}game.HelperViewHandler.registerStr([this.wenhaobtn,this.labelguize],"func86t","func365")};t.prototype.onItemRender=function(t){t.setData(t.dataSource)};t.prototype.onDisplay=function(){this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){};t.prototype.refreshAll=function(){this.type0.labelmiaoshu2.text=app.getLang("newpet_comtag_0");this.selectorClass.param1=0;this.hideMenu();this.showList()};t.prototype.hideMenu=function(){this.list.visible=false};t.prototype.showList=function(t){if(t===void 0){t=0}var e=this.selectorClass.param1;var i=csv.PetProxy.getIns().getAllCombination();if(e==0){this.listJiban.array=i}else{var n=[];for(var a=0;a<i.length;a++){if(e==csv.PetProxy.getIns().getGroupById(parseInt(i[a]))[0].comtag){n.push(i[a])}}this.listJiban.array=n}};t.SINGLE_KEY="pet.PetFetterView";return t}(ui.chongwu.chongwujibanUI);a.PetFetterView=t})(pet||(pet={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var pet;(function(i){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t._timeScale=.3;t.btnTime=500;t.shadeList=[];return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.on(Laya.Event.CLICK,this,this.onCloseHandler);this._model=i.PetModel.getIns();this.listshuxing.renderHandler=new Laya.Handler(this,this.onAttrRender);this.avatar=new avatar.AvatarAnimation;this.guaiwu.addChild(this.avatar);this.avatarData=new avatar.AvatarData;this.avatarData.fileName=game.AniView.FILE_NAME.MONSTER;this.avatar.visible=false};t.prototype.onAttrRender=function(t){var e=t.dataSource;var i=Attributes.decode(csv.PetProxy.getIns().getBaseAttr(e.rand)).baseList[0];t.shuxing.text=app.getLang(Attributes.getPropName(i.propId));var n=this.petVO.getPropValue(e);var a=parseInt(csv.PetProxy.getIns().getTalent(i.propId));var o=this.petVO.getPropValue(e,0,a);t.labelshuzi.text=n+"";t.imgtubiao.skin="chongwu/bg_0"+e.tal+".png";t.labelshuzhi.text=e.val+"/"+a;t.jindutiao.value=e.val/a};t.prototype.onCloseHandler=function(){if(this._model.tipsList.length>0){this.clearIcon();var t=this._model.tipsList.shift();this.onRefreshData(t)}else{app.ViewManager.toggleDialog(i.PetGettedSuccessView,-1)}};t.prototype.onDisplay=function(){guide.GuideModel.getIns().boOpen=false;this.imgdiban.width=Laya.stage.width;this.imgdiban.height=Laya.stage.height;this.mengban.width=this.imgdiban.width;this.mengban.height=this.imgdiban.height;this.ani2.gotoAndStop(0);this.ani3.gotoAndStop(0);this.stopQulityAnim();this.onCloseHandler()};t.prototype.clearShader=function(){while(this.shadeList.length>0){this.shadeList.pop().removeSelf()}};t.prototype.clearIcon=function(){Laya.timer.clear(this,this.createShade);Laya.timer.clear(this,this.onImgFabaoComplete);this.clearShader();this.stopQulityAnim();this.ani2.stop();this.ani3.stop();this.chengse.stop();this.chengse.visible=false};t.prototype.onUnDisplay=function(){this.clearIcon();guide.GuideModel.getIns().boOpen=true;this.closeBtnTween();this.avatar.stop();this.avatar.visible=false};t.prototype.closeBtnTween=function(){if(this.tweenBtn){Laya.Tween.clear(this.tweenBtn)}};t.prototype.onBtnCloseComplete=function(){this.tweenBtn=Laya.Tween.to(this.btnclose,{alpha:1,scaleX:1,scaleY:1},this.btnTime,null,new Laya.Handler(this,this.playCloseBtn))};t.prototype.playCloseBtn=function(){this.tweenBtn=Laya.Tween.to(this.btnclose,{alpha:.5,scaleX:.9,scaleY:.9},this.btnTime,null,new Laya.Handler(this,this.onBtnCloseComplete))};t.prototype.onAni4PlayEnd=function(t){this.wuxing.y=t};t.prototype.stopQulityAnim=function(){this.pinzhiji.stop();this.pinzhiji.visible=false;this.pinzhijue.stop();this.pinzhijue.visible=false};t.prototype.setData=function(t){this.petVO=t;this.avatarData.roleKey=t.petCfg.res;this.avatar.setAniData(this.avatarData);var e=t.petCfg.bonetimes?t.petCfg.bonetimes/100:1;this.avatar.scale(e,e);this.avatar.setAni(avatar.AvatarAnimation.ANI_ENUMS.IDLE,0);this.avatar.play();this.avatar.visible=true;this.imgfabao.skin="";this.imgleixing.skin="res/static/bg_sx_"+t.petCfg.supportelements+".png";this.labelname.text=app.getLang(t.petCfg.namelang);this.labelname.color=game.STYLES.ITEM_QUALITY[t.qua];Laya.timer.once(chouka.FabaoShadows.USE_TIME,this,this.onImgFabaoComplete);this.listshuxing.array=t.prop;this.te.visible=false;var i=t.qua;this.stopQulityAnim();if(i>=4){this.imgpinzhi.skin="";switch(i){case 4:this.pinzhiji.visible=true;this.pinzhiji.play(0,true);break;case 5:this.pinzhijue.visible=true;this.pinzhijue.play(0,true);break}}else{this.imgpinzhi.skin="res/static/chouka/bg_fabaopinzhi_0"+(i-1)+".png"}if(t.skillId>0){this.label04.text=csv.SkillProxy.getSkillDes(t.skillId,t.getSkillLevel())}else{this.label04.text=""}var n=this.label04.y+this.label04.contextHeight;this.onAni4PlayEnd(n);this.playCloseBtn()};t.prototype.onRefreshData=function(t){app.SoundManager.getIns().playSound("firsttime");this.closeBtnTween();this.setData(t);if(t.qua<=3){this.chengse.stop();this.chengse.visible=false}else{var e={};e[4]="zi";e[5]="cheng";e[6]="hong";this.chengse.source="uieffect/ui_fabaodengji_"+e[t.qua]+".ani";this.chengse.play(0,true);this.chengse.visible=true}this.ani2.gotoAndStop(0);this.ani3.on(Laya.Event.COMPLETE,this,this.onAni3Complete);this.ani3.play(0,false);Laya.timer.loop(30,this,this.createShade)};t.prototype.createShade=function(){};t.prototype.onAni3Complete=function(){this.ani2.play(0,true);Laya.timer.clear(this,this.createShade)};t.prototype.onImgFabaoComplete=function(t){var e="";this.imgfabao.skin=e};t.SINGLE_KEY="pet.PetGettedSuccessView";return t}(ui.xianshouju.gongxihuodeviewUI);i.PetGettedSuccessView=t})(pet||(pet={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var pet;(function(a){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.CLICK,this,this.onClick);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=a.PetModel.getIns()};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.onClick=function(){if(this._data.isLock==false){return}var t;var e;if(this._index==1){t=csv.FunctionsProxy.getIns().getCfg(csv.FunctionsProxy.ENUMS.PET_ITEM_ONE);e=t.task}else if(this._index==2){t=csv.FunctionsProxy.getIns().getCfg(csv.FunctionsProxy.ENUMS.PET_ITEM_TWO);e=t.task}else if(this._index==3){t=csv.FunctionsProxy.getIns().getCfg(csv.FunctionsProxy.ENUMS.PET_ITEM_THREE);e=t.task}else if(this._index==4){t=csv.FunctionsProxy.getIns().getCfg(csv.FunctionsProxy.ENUMS.PET_ITEM_FOUR);e=t.task}if(game.TaskModel.getIns().currMainTask.data.questIndex<e||game.TaskModel.getIns().currMainTask.data.questIndex==e&&game.TaskModel.getIns().currMainTask.data.questSate!=3){manager.FlowManager.instance.flowByStyle1(app.getLang("newpet_tip_1"));return}this._model.nowSelectEpos=this._index;if(this._data.petVo){var i=[tip.TipManager.TIP_BTN_TYPE.PET_CHANGE,tip.TipManager.TIP_BTN_TYPE.PET_GOAWAY];var n={rolePos:this._data.rolePos,pos:this._data.pos,data:a.PetModel.getIns().getPetVOByInstId(this._data.petVo.instid)};tip.TipManager.showFightPet(n,i)}else{if(this._model.getPetPosMap()[this._model.nowSelectRolePos].length==0){manager.FlowManager.instance.flowByStyle1(app.getLang("newpet_des04"));return}app.ViewManager.toggleDialog(a.PetGoFightSelectView,1,0)}};e.prototype.setData=function(t,e){this._index=e+1;this._data=t;this.gezi.img.skin="public/bg_lock01.png";this.gezi.gezibg.skin="public/gridbg01.png";if(t.isLock){var i=this._model.getPetPosMap()[game.RoleModel.getIns().uiRoleSelectIndex+1];if(i.length==0){game.RedDotView.removeFrom(this.gezi)}else{if(this._model.petPackIsHavePets()){game.RedDotView.addTo(this.gezi)}else{game.RedDotView.removeFrom(this.gezi)}}this.labelmingzi.text="";this.gezi.jia.visible=true;this.gezi.img.visible=false;if(t.petVo){game.RedDotView.removeFrom(this.gezi);this.gezi.jia.visible=false;this.gezi.img.visible=true;this.gezi.img.skin="res/icon/item/pet_"+t.petVo.petid+".png";var n=csv.PetProxy.getIns().getPetCfg(t.petVo.petid);this.gezi.gezibg.skin="public/bg_daoju_0"+n.quality+".png";if(t.petVo.star>0){var a=csv.PetProxy.getIns().getVolute(t.petVo.petid,t.petVo.star);if(a.addattr&&a.addattr.length>0){i=app.str2Array(a.addattr,"-")}}else if(n.addattr&&n.addattr.length>0){i=app.str2Array(n.addattr,"-")}var o=Attributes.getPropName(parseInt(i[0]));var s=(parseInt(i[1])*.01).toFixed(2)+"%";this.labelmingzi.text=app.getLang("newpet_addattr_02",o,s)}}else{this.labelmingzi.text=app.getLang("newpet_tip_2",t.needLv);this.gezi.jia.visible=false;this.gezi.img.visible=true;game.RedDotView.removeFrom(this.gezi)}};e.SINGLE_KEY="pet.PetGoFightItem";return e}(ui.chongwu.chognwugeziitem1UI);a.PetGoFightItem=t})(pet||(pet={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var pet;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.btnshangzhen.on(Laya.Event.CLICK,this,this.onClick);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=i.PetModel.getIns();this.listshuxing.renderHandler=new Laya.Handler(this,this.onAttrRender)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.onClick=function(){i.PetModel.getIns().isMoveActon=true;app.ProtocolRequest.PetMoveReq(0,this._data.data.instid,this._model.nowSelectRolePos,this._model.nowSelectEpos);app.ViewManager.toggleDialog(i.PetGoFightSelectView,-1,0)};e.prototype.setData=function(t,e){this._index=e;this._data=t;this._petVo=t.data;this.laneldengji.visible=false;this.shuxingimg.skin="res/static/bg_sx_"+this._petVo.petCfg.supportelements+".png";this.daojuimg.skin="res/icon/item/pet_"+this._petVo.petid+".png";this.pinzhikuangimg.skin="public/bg_daoju_0"+this._petVo.petCfg.quality+".png";var i=this._data.data.petCfg?app.getLang(this._data.data.petCfg.namelang):"";this.labelmingzi.text=i;this.labelmingzi.color=game.STYLES.ITEM_QUALITY[this._data.data.qua];if(this._petVo.skillId>0){var n=csv.SkillProxy.getIns().getSkillByKey(this._petVo.skillId+"-"+this._petVo.getSkillLevel());this.miaoshu1.text="技能名字："+n.name}this.miaoshu2.text=this._petVo.getaddattr();if(t.rolePos==0){this.btnshangzhen.visible=true}else{this.btnshangzhen.visible=false;var a=game.Context.roleList[this._data.rolePos-1]}this.listshuxing.array=this._petVo.prop};e.prototype.onAttrRender=function(t){var e=t.dataSource;var i=Attributes.decode(csv.PetProxy.getIns().getBaseAttr(e.rand)).baseList[0];t.shuxing.text=app.getLang(Attributes.getPropName(i.propId));t.labelshuzi.text=this._petVo.getPropValue(e)+"";t.labelshuzhi.text=e.val+"/"+csv.PetProxy.getIns().getTalent(i.propId);t.jindutiao.value=e.val/+csv.PetProxy.getIns().getTalent(i.propId)};e.SINGLE_KEY="pet.PetGoFightSelectItem";return e}(ui.chongwu.xuanzexianshouitemUI);i.PetGoFightSelectItem=t})(pet||(pet={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var pet;(function(o){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.selectorClass=new o.SelectorClass(this.listyeqian1,new Laya.Handler(this,this.updateView),this.xuanze1,this.xuanze2,this.xuanze3);this.on(Laya.Event.CLICK,this,this.hideMenu);this.listxuanze.itemRender=o.PetGoFightSelectItem;this.listxuanze.renderHandler=new Laya.Handler(this,this.onItemRender);this._model=o.PetModel.getIns();this.btnjiban.on(Laya.Event.CLICK,this,this.openJibanView);guide.GuideModel.getIns().register(csv.GuideProxy.ENUM_VIEW.PET_SHANGZHEN_PET_SELECT,this,this.getGuideItemBtn,300)};e.prototype.getGuideItemBtn=function(t){var e=0;this.updateView();for(var i=0,n=this.listxuanze.array.length;i<n;i++){if(this.listxuanze.array[i].data.isBattle()){continue}e=i}this.listxuanze.scrollTo(e);for(var i=0,n=this.listxuanze.cells.length;i<n;i++){var a=this.listxuanze.cells[i];if(a.dataSource&&!a.dataSource.data.isBattle()){return a.btnshangzhen}}return null};e.prototype.hideMenu=function(){this.listyeqian1.visible=false;this.selectorClass.resetBtn()};e.prototype.onItemRender=function(t,e){t.setData(t.dataSource,e)};e.prototype.onDisplay=function(){o.PetModel.getIns().on(o.PetEvent.PET_RELEASE,this,this.onReleaseAct);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){o.PetModel.getIns().off(o.PetEvent.PET_RELEASE,this,this.onReleaseAct)};e.prototype.onReleaseAct=function(t){if(t==1){this.updateView()}};e.prototype.refreshAll=function(){this.xuanze1.labelmiaoshu2.text=app.getLang("pettag_1_0");this.xuanze2.labelmiaoshu2.text=app.getLang("pettag_1_0");this.xuanze3.labelmiaoshu2.text=app.getLang("magiclisttag2");this.selectorClass.param1=0;this.selectorClass.param2=0;this.selectorClass.param3=1;this.hideMenu();this.updateView();this.btnjiban.visible=o.PetGoFightView.getIns().chuandaibtn.visible;this.choosedList=[]};e.prototype.sortByShowType=function(t,e){if(t.petCfg.supportelements<e.petCfg.supportelements)return-1;if(t.petCfg.supportelements>e.petCfg.supportelements)return 1;if(t.qua>e.qua)return-1;if(t.qua<e.qua)return 1;return 0};e.prototype.sortByQua=function(t,e){if(t.qua>e.qua)return-1;if(t.qua<e.qua)return 1;if(t.petCfg.supportelements<e.petCfg.supportelements)return-1;if(t.petCfg.supportelements>e.petCfg.supportelements)return 1;return 0};e.prototype.updateView=function(t){if(t===void 0){t=0}var e=o.PetModel.getIns().getBaseListByShowType(0,0,this.selectorClass.param1,this.selectorClass.param2);if(e.length>0){if(this.selectorClass.param3==1){e.sort(this.sortByShowType)}if(this.selectorClass.param3==2){e.sort(this.sortByQua)}}var i=[];for(var n=0;n<e.length;n++){var a={rolePos:e[n].pos,pos:e[n].equippos,data:e[n]};i.push(a)}this.listxuanze.array=i;if(i.length==0){this.tishi.visible=true}else{this.tishi.visible=false}};e.prototype.openJibanView=function(){app.ViewManager.toggleDialog(o.PetFetterTipView,1,0,o.PetGoFightView.getIns().mainPetVo.petid)};e.SINGLE_KEY="pet.PetGoFightSelectView";return e}(ui.chongwu.xuanzexianshoutipsUI);o.PetGoFightSelectView=t})(pet||(pet={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var pet;(function(n){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.imgdiwei.on(Laya.Event.CLICK,this,this.openTip);this.jiaohaobtn.on(Laya.Event.CLICK,this,this.openSelectView);this.chuandaibtn.on(Laya.Event.CLICK,this,this.openJibanView);this.listdaoju.itemRender=n.PetGoFightItem;this.listdaoju.renderHandler=new Laya.Handler(this,this.onRender);this.shuxinglist.renderHandler=new Laya.Handler(this,this.onAttrRender);this.labelxiangyaolu.on(Laya.Event.CLICK,this,this._openFun);this._model=n.PetModel.getIns();this.roleMediator=new common.RoleListMediator(this.itemxuanze.xuanzelist,equip.RoleItem,new Laya.Handler(this,this.roleSelectChange));game.HelperViewHandler.registerStr([this.wenhaobtn,this.labelguize],"func86t","func365");guide.GuideModel.getIns().register(csv.GuideProxy.ENUM_VIEW.PET_SHANGZHEN_POS_SELECT,this,this.getGuideItemBtn,300)};e.prototype.getGuideItemBtn=function(t){if(t==1){return this.jiaohaobtn}return this.listdaoju.cells[t-2]};e.prototype.onDisplay=function(){this.callLater(this.refreshAll);n.PetModel.getIns().on(n.PetEvent.PET_GO_POS_CHANGE,this,this.roleSelectChange)};e.prototype.onUnDisplay=function(){n.PetModel.getIns().off(n.PetEvent.PET_GO_POS_CHANGE,this,this.roleSelectChange)};e.prototype.refreshAll=function(){this.chuandaibtn.visible=true;var t=0;var e=this._model.getWearPetRoleRedArr();for(var i=0;i<e.length;i++){if(e[i]){this._roleIndex=t=i;break}}this.roleMediator.setData(t,e);this.roleSelectChange()};e.prototype.roleSelectChange=function(){var t=this._model.getWearPetRoleRedArr();this.roleMediator.setData(-1,t);this._model.nowSelectRolePos=game.RoleModel.getIns().uiRoleSelectIndex+1;var e=this._model.getPetPosMap()[game.RoleModel.getIns().uiRoleSelectIndex+1];this.listdaoju.array=this._model.getPetFuzhuArr(game.RoleModel.getIns().uiRoleSelectIndex+1);e.length==0?this._updateNoPets():this._updateHavePets(e)};e.prototype._updateNoPets=function(){this.chuandaibtn.visible=false;this.namedi.visible=false;this.namelab.visible=false;this.labeltishi.visible=true;this.jiaohaobtn.visible=true;this.boxhuoqu.visible=true;this.boxshangzhen.visible=false;this.weizhi.visible=false;this.imgdiwei.visible=false;if(this._model.petPackIsHavePets()){game.RedDotView.addTo(this.jiaohaobtn)}else{game.RedDotView.removeFrom(this.jiaohaobtn)}};e.prototype._updateHavePets=function(t){this.namedi.visible=true;this.namelab.visible=true;this.labeltishi.visible=false;this.jiaohaobtn.visible=false;this.boxhuoqu.visible=false;this.boxshangzhen.visible=true;this.imgdiwei.visible=true;this.mainPetVo=n.PetModel.getIns().getPetVOByInstId(t[0].epet[0].instid);this.shuxinglist.array=this.mainPetVo.prop;if(this.mainPetVo&&this._model.isNeedShowJibanBtn(this.mainPetVo)){this.chuandaibtn.visible=true}else{this.chuandaibtn.visible=false}this.namelab.text=app.getLang(this.mainPetVo.petCfg.namelang);this.weizhi.visible=true;if(!this.roleAvatar){this.roleAvatar=new avatar.AvatarAnimation;this._roleAvatar=new avatar.AvatarData;this._roleAvatar.roleKey=this.mainPetVo.petCfg.res;this.weizhi.addChild(this.roleAvatar)}this._roleAvatar.roleKey=this.mainPetVo.petCfg.res;this._roleAvatar.fileName=game.AniView.FILE_NAME.MONSTER;var e=this.mainPetVo.petCfg.bonetimes?this.mainPetVo.petCfg.bonetimes/100:1;this.roleAvatar.scale(e,e);this.roleAvatar.setAniData(this._roleAvatar);this.roleAvatar.setAni(avatar.AvatarAnimation.ANI_ENUMS.IDLE,0);this.roleAvatar.play();if(this.mainPetVo.skillId>0){var i=csv.SkillProxy.getIns().getSkillByKey(this.mainPetVo.skillId+"-"+this.mainPetVo.getSkillLevel());this.jineng.setData(i,false,false,false);this.jineng.starMediator.value=0;this.labelmiaoshu.text=csv.SkillProxy.getSkillDes(this.mainPetVo.skillId,this.mainPetVo.getSkillLevel());this.labeljineng.text=i.name}};e.prototype.onRender=function(t,e){t.setData(t.dataSource,e)};e.prototype.onAttrRender=function(t){var e=t.dataSource;var i=Attributes.decode(csv.PetProxy.getIns().getBaseAttr(e.rand)).baseList[0];t.shuxing.text=app.getLang(Attributes.getPropName(i.propId));t.labelshuzi.text=this.mainPetVo.getPropValue(e)+""};e.prototype.openSelectView=function(){this._model.nowSelectEpos=0;app.ViewManager.toggleDialog(n.PetGoFightSelectView,1,0)};e.prototype.openTip=function(){var t=[tip.TipManager.TIP_BTN_TYPE.PET_CHANGE,tip.TipManager.TIP_BTN_TYPE.PET_GOAWAY];this._model.nowSelectEpos=0;var e={rolePos:game.RoleModel.getIns().uiRoleSelectIndex+1,pos:0,data:this.mainPetVo};tip.TipManager.showFightPet(e,t)};e.prototype.openJibanView=function(){app.ViewManager.toggleDialog(n.PetFetterTipView,1,0,this.mainPetVo.petid)};e.prototype._openFun=function(){if(battle.BattleModel.getIns().checkBattleState(true)){return}game.ClosureManager.callFunction(csv.FunctionsProxy.ENUMS.MONSTER_BOOK)};e.SINGLE_KEY="pet.PetGoFightView";return e}(ui.chongwu.chongwushangzhenUI);n.PetGoFightView=t})(pet||(pet={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var pet;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.SINGLE_KEY="pet.PetItemChooseView";return e}(ui.chongwu.xuanzehunjingtipUI);t.PetItemChooseView=e})(pet||(pet={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var pet;(function(a){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.avatar=new avatar.AvatarAnimation;this.weizhi.addChild(this.avatar);this.avatarData=new avatar.AvatarData;this.avatarData.fileName=game.AniView.FILE_NAME.MONSTER;this.avatar.visible=false;this.shengji1.setData(game.ItemUtil.ENUMS.PET_LEVELUP[0]);this.shengji2.setData(game.ItemUtil.ENUMS.PET_LEVELUP[1]);this.shengji3.setData(game.ItemUtil.ENUMS.PET_LEVELUP[2]);this.shengji1.locktip=true;this.shengji2.locktip=true;this.shengji3.locktip=true;this.btn1=new common.CommonButton(this.shengji1,new Laya.Handler(this,this.onLevelUp,[this.ani1,game.ItemUtil.ENUMS.PET_LEVELUP[0]]));this.btn2=new common.CommonButton(this.shengji2,new Laya.Handler(this,this.onLevelUp,[this.ani2,game.ItemUtil.ENUMS.PET_LEVELUP[1]]));this.btn3=new common.CommonButton(this.shengji3,new Laya.Handler(this,this.onLevelUp,[this.ani3,game.ItemUtil.ENUMS.PET_LEVELUP[2]]));this.shengji1.showBagCount(-3);this.shengji2.showBagCount(-3);this.shengji3.showBagCount(-3);this.stars=new common.StarListMediator(this.listxing,this.star,game.ComStarItem.W);this.listshuxing.renderHandler=new Laya.Handler(this,this.onAttrRender);this.shengxing.stop();this.xianshou.stop();this.shengji.stop();this.shengxing.visible=false;this.xianshou.visible=false;this.shengji.visible=false;this.xianshou.on(Laya.Event.COMPLETE,this,this.onPlayEnd,[this.xianshou]);this.shengji.on(Laya.Event.COMPLETE,this,this.onPlayEnd,[this.shengji])};e.prototype.onPlayEnd=function(t){t.visible=false};e.prototype.onAttrRender=function(t){var e=t.dataSource;var i=this.dataSource[0];var n=Attributes.decode(csv.PetProxy.getIns().getBaseAttr(e.rand)).baseList[0];t.shuxing.text=app.getLang(Attributes.getPropName(n.propId));var a=i.getPropValue(e);var o=parseInt(csv.PetProxy.getIns().getTalent(n.propId));var s=i.getPropValue(e,0,o);if(i.petCfg.level==i.plevel){t.labelshuzi.text=a+""}else{var r=i.getPropValue(e,i.plevel+1)-a;var l="<span color='#6bc06b'>(+{0})</span>";t.labelshuzi.text=a+app.getLang(l,r.toFixed(0))}t.imgtubiao.skin="chongwu/bg_0"+e.tal+".png";t.labelshuzhi.text=e.val+"/"+o;t.jindutiao.value=e.val/o};e.prototype.onLevelUp=function(t,e){var i=this.dataSource[0];if(i.plevel<i.petCfg.level){var n=game.GridsModel.getIns().getItemByItemId(e);if(n&&n.count>0){if(game.Context.isTeamLvReach(csv.PetProxy.getIns().getUpdateLevel(i.qua,i.plevel+1),true)){a.PetControl.c2sLevelUp(i.pos,i.instid,n.getInstId());t.play(0,false)}}else{n=game.ItemUtil.createVO(e);tip.TipManager.show(n,true)}}else{manager.FlowManager.instance.flowByStyle1(app.getLang("lotus_8"))}};e.prototype.onDisplay=function(){a.PetModel.getIns().on(a.PetEvent.PET_LEVEL_UP,this,this.onLevelUpdate);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){this.avatar.stop();this.avatar.visible=false;a.PetModel.getIns().off(a.PetEvent.PET_LEVEL_UP,this,this.onLevelUpdate);this.xianshou.stop();this.shengji.stop();this.shengji.visible=false;this.xianshou.visible=false;this._plevel=-1};e.prototype.onLevelUpdate=function(){this.updateView();this.shengji.play(0,false);this.xianshou.play(0,false);this.shengji.visible=true;this.xianshou.visible=true;this.btn1.actHandler();this.btn2.actHandler();this.btn3.actHandler()};e.prototype.refreshAll=function(){var t=this.dataSource[0];this.imgyimanji.visible=false;this.ani1.stop();this.ani2.stop();this.ani3.stop();this.avatarData.roleKey=t.petCfg.res;this.avatar.setAniData(this.avatarData);var e=t.petCfg.bonetimes?t.petCfg.bonetimes/100:1;this.avatar.scale(e,e);this.avatar.setAni(avatar.AvatarAnimation.ANI_ENUMS.IDLE,0);this.avatar.play();this.avatar.visible=true;this.updateView()};e.prototype.updateView=function(){var t=this.dataSource[0];this.stars.setStar(t.star,t.petCfg.star);if(this._plevel>0&&t.plevel>this._plevel){manager.EffectManager.playStageEffect("skill_shengjichenggong")}this._plevel=t.plevel;this.namelab.text=app.getLang(t.petCfg.namelang);this.imgshuxing.skin="res/static/bg_sx_"+t.petCfg.supportelements+".png";this.listshuxing.array=t.prop;if(t.plevel>=t.petCfg.level){this.ani4.gotoAndStop(1)}else{this.ani4.gotoAndStop(0);var e=csv.PetProxy.getIns().getUpdateExp(t.qua,t.plevel+1);this.labeldengji.text=app.getLang("tip_des_3")+t.plevel+"/"+t.petCfg.level;this.labeljindu.text=t.pexp+"/"+e;this.jindu.value=t.pexp/e;this.zhanliclip.value=t.getBattleValue()+"";this.updateItem(game.ItemUtil.ENUMS.PET_LEVELUP[0],this.shengji1);this.updateItem(game.ItemUtil.ENUMS.PET_LEVELUP[1],this.shengji2);this.updateItem(game.ItemUtil.ENUMS.PET_LEVELUP[2],this.shengji3)}};e.prototype.updateItem=function(t,e){var i=game.GridsModel.getIns().getItemByItemId(t);var n=game.STYLES.RED_COLOR_S;var a="";if(i&&i.count>0){n=game.STYLES.GREEN_COLOR_S;a=i.count+"";e.gray=false}else{e.gray=true}e.shuzi.visible=true;e.shuzi.color=n;e.shuzi.text=a};e.SINGLE_KEY="pet.PetLevelUpView";return e}(ui.chongwu.chongwushengjitipUI);a.PetLevelUpView=t})(pet||(pet={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var pet;(function(n){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.check=true;t.clsKey="pet.PetListItem";return t}t.prototype.createNode=function(t){var e=20;var i=Laya.Pool.getItemByClass(this.clsKey,n.PetListItem);i.x=28+t*(i.width+e);i.y=this.y;i.setData(this.list[t],false);return i};return t}(list.RowMoveBaseNode);n.RowPetListNode=t;var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.CLICK,this,this.onClick);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.lockimg.on(Laya.Event.CLICK,this,this.onLock);this.stars=new common.StarListMediator(this.listxingxing,null,game.ComStarItem.W)};e.prototype.onLock=function(t){t.stopPropagation();if(this._data.isLock==1){this._data.isLock=0}else{this._data.isLock=1}this.lockimg.skin="chongwu/bg_lock_"+this._data.isLock+".png"};e.prototype.onDisplay=function(){n.PetModel.getIns().on(n.PetEvent.PET_VO_CHANGE,this,this.updateView);n.PetModel.getIns().on(n.PetEvent.PET_REPUTIOH_UP,this,this.reddotUpdate);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){n.PetModel.getIns().off(n.PetEvent.PET_VO_CHANGE,this,this.updateView);n.PetModel.getIns().off(n.PetEvent.PET_REPUTIOH_UP,this,this.reddotUpdate)};e.prototype.refreshAll=function(){};e.prototype.onClick=function(){if(this._data){var t=[tip.TipManager.TIP_BTN_TYPE.PET_LEVELUP,tip.TipManager.TIP_BTN_TYPE.PET_STARUP,tip.TipManager.TIP_BTN_TYPE.PET_SHOW];tip.TipManager.showPet(this._data,t,[n.PetModel.getIns().canLevUp(this._data),n.PetModel.getIns().canStarUp(this._data),false])}};e.prototype.setData=function(t,e){this._data=t;this.imgmingzi.skin="res/static/chongwu/itemname_"+t.petid+".png";this.imgchongwu.skin="res/static/chongwu/newpet_"+t.petid+".png";this.shangzhenimg.visible=t.isBattle();this.imghushengzhong.visible=garden.GardenModel.getIns().inGuarding(t.instid);this.imgshuxing.skin="res/static/bg_sx_"+t.petCfg.supportelements+".png";this.lockimg.skin="chongwu/bg_lock_"+t.isLock+".png";this.imgbiankuang.skin="chongwu/bg_pz"+t.qua+".png";this.imgxingdi.skin="chongwu/bg_xj"+t.qua+".png";this.labeldengji.text=app.getLang("zuoqi_11")+t.plevel;this.stars.setStar(this._data.star,this._data.petCfg.star);this.reddotUpdate()};e.prototype.updateView=function(t){if(Uint64.equal(t.instid,this._data.instid)){this.setData(t,false)}else{this.reddotUpdate()}};e.prototype.reddotUpdate=function(){game.RedDotView.removeFrom(this);if(n.PetModel.getIns().canLevUp(this._data)||n.PetModel.getIns().canStarUp(this._data)){game.RedDotView.addTo(this)}};e.SINGLE_KEY="pet.PetListItem";return e}(ui.chongwu.chongwuliebiaoitemUI);n.PetListItem=e})(pet||(pet={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var pet;(function(u){var i=function(){function t(t,e,i,n,a){this.arrowlist=[];this.selectedHandler=e;this.list=t;this.type0=i;this.type1=n;this.type2=a;this.type1Souce=[];this.type2Souce=[{text:app.getLang("pettag_2_0"),value:0}];this.type3Souce=[];var o=game.Config.getParams(1243).split(";");for(var s=0;s<o.length;s++){this.type1Souce.push({text:app.getLang("pettag_1_"+o[s]),value:o[s]})}o=csv.MonsterBookProxy.getIns().getSheetMap();for(var s=0;s<o.length;s++){this.type2Souce.push({text:app.getLang(o[s].sheetesc),value:o[s].sheetid})}for(var s=1;s<=2;s++){this.type3Souce.push({text:app.getLang("magiclisttag"+s),value:s})}this.type0.labelmiaoshu1.text=app.getLang("pettag_title_1");this.arrowlist.push(new fabaonew.ArrowBtn(this.type0.btnxiala,this.list,new Laya.Handler(this,this.showMenu),this.arrowlist,this.type0));if(this.type1){this.type1.labelmiaoshu1.text=app.getLang("pettag_title_2");this.arrowlist.push(new fabaonew.ArrowBtn(this.type1.btnxiala,this.list,new Laya.Handler(this,this.showMenu),this.arrowlist,this.type1))}if(this.type2){this.arrowlist.push(new fabaonew.ArrowBtn(this.type2.btnxiala,this.list,new Laya.Handler(this,this.showMenu),this.arrowlist,this.type2));this.type2.labelmiaoshu1.text=app.getLang("pettag_title_3")}this.list.renderHandler=new Laya.Handler(this,this.onRender);this.list.scrollRectOffX=10;this.list.scrollRectOffY=5;this.list.visible=false}t.prototype.resetBtn=function(){for(var t=0;t<this.arrowlist.length;t++){this.arrowlist[t].setSelect(false)}};t.prototype.onSelectHandler=function(t){this.list.visible=false;if(this.selectedItem){this.selectedItem.labelmiaoshu2.text=t.text;if(this.selectedItem==this.type0){this.param1=t.value}else if(this.selectedItem==this.type1){this.param2=t.value}else if(this.selectedItem==this.type2){this.param3=t.value}}if(this.selectedHandler){this.selectedHandler.runWith(0)}this.resetBtn()};t.prototype.onRender=function(t){t.shuxing.text=t.dataSource.text;t.on(Laya.Event.CLICK,this,this.onSelectHandler,[t.dataSource])};t.prototype.showMenu=function(t){this.selectedItem=t.currentTarget;t.stopPropagation();var e=[];if(this.list.visible){this.list.visible=false}else{if(t.currentTarget==this.type0){this.list.x=this.type0.x;e=this.type1Souce}else if(t.currentTarget==this.type1){this.list.x=this.type1.x;e=this.type2Souce}else if(t.currentTarget==this.type2){this.list.x=this.type2.x;e=this.type3Souce}if(e.length>7){this.list.repeatX=2}else{this.list.repeatX=1}this.list.array=e;this.list.visible=true}};return t}();u.SelectorClass=i;var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listCustom=new list.JListCustom;this.listCustom.init(this.baglist1);this.selectorClass=new i(this.list,new Laya.Handler(this,this.showList),this.type0,this.type1,this.type2);this.on(Laya.Event.CLICK,this,this.hideMenu);this.btnfangsheng.clickHandler=new Laya.Handler(this,this.onRelease);this.type2.labelmiaoshu2.text=app.getLang("magiclisttag2");this.selectorClass.param3=1};e.prototype.hideMenu=function(){this.list.visible=false;this.selectorClass.resetBtn()};e.prototype.onRelease=function(){app.ViewManager.toggleDialog(u.PetReleaseView,1,0)};e.prototype.onDisplay=function(){u.PetModel.getIns().on(u.PetEvent.PET_RELEASE,this,this.showList);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){u.PetModel.getIns().off(u.PetEvent.PET_RELEASE,this,this.showList);this.listCustom.clear()};e.prototype.refreshAll=function(){this.type0.labelmiaoshu2.text=app.getLang("pettag_1_0");this.type1.labelmiaoshu2.text=app.getLang("pettag_1_0");this.selectorClass.param1=0;this.selectorClass.param2=0;this.type2.labelmiaoshu2.text=app.getLang("magiclisttag"+this.selectorClass.param3);this.hideMenu();this.showList()};e.prototype.showList=function(t){if(t===void 0){t=0}this.listCustom.clear();var e=0;var i=u.PetModel.getIns().getBaseTypeArr(this.selectorClass.param3);for(var n=0;n<i.length;n++){var a=u.PetModel.getIns().getBaseListByShowType(this.selectorClass.param3,i[n],this.selectorClass.param1,this.selectorClass.param2);if(a.length==0){continue}e+=a.length;var o=u.PetModel.getIns().getTotalByShowType(this.selectorClass.param3,i[n],this.selectorClass.param1,this.selectorClass.param2);var s=[];for(var r=0,l=a;r<l.length;r++){var h=l[r];if(s.indexOf(h.petid)==-1){s.push(h.petid)}}var p=new u.TitleVO;p.skinurl="magiclisttag"+this.selectorClass.param3+"_"+i[n];p.str=app.getLang("({0}/{1})",s.length,o);this.listCustom.split([p],u.PetRowTitle,44);this.listCustom.split(a,u.RowPetListNode,322,0,3)}this.listCustom.end(t);this.imgtishi.visible=e==0};e.SINGLE_KEY="pet.PetListView";return e}(ui.chongwu.chongwuliebiaoUI);u.PetListView=t})(pet||(pet={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var pet;(function(n){var i=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.stars=new common.StarListMediator(this.listxingxing,null,game.ComStarItem.W);this.gouxuan.on(Laya.Event.CLICK,this,this.onChkClick);this.on(Laya.Event.CLICK,this,this.onItemClick)};e.prototype.onItemClick=function(){if(this._data.isLock){manager.FlowManager.instance.flowByStyle1(app.getLang("已锁定不能选择"))}else{this.gouxuan.selected=!this.gouxuan.selected;n.PetReleaseView.getIns().onPetChoose(this.gouxuan.selected,this._data.instid)}};e.prototype.onChkClick=function(t){t.stopPropagation();if(this._data.isLock){this.gouxuan.selected=false;manager.FlowManager.instance.flowByStyle1(app.getLang("已锁定不能选择"))}else{n.PetReleaseView.getIns().onPetChoose(this.gouxuan.selected,this._data.instid)}};e.prototype.setData=function(t){this._data=t;this.imgchongwu.skin="res/static/chongwu/newpet_"+t.petid+".png";this.imgbiankuang.skin="chongwu/bg_pz"+t.qua+".png";this.imgmingzi.skin="res/static/chongwu/itemname_"+t.petid+".png";this.imgchongwu.skin="res/static/chongwu/newpet_"+t.petid+".png";this.lockimg.skin="chongwu/bg_lock_"+t.isLock+".png";this.imgshuxing.skin="res/static/bg_sx_"+t.petCfg.supportelements+".png";this.labeldengji.text=app.getLang("zuoqi_11")+t.plevel;this.stars.setStar(t.star,t.petCfg.star);this.gouxuan.selected=a.getIns().isSelected(t.instid)};return e}(ui.chongwu.chongwufangshengitemUI);n.PetReleaseItem=i;var a=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.selectorClass=new n.SelectorClass(this.listyeqian1,new Laya.Handler(this,this.updateView),this.xuanze1,this.xuanze2,this.xuanze3);this.xuanze3.labelmiaoshu2.text=app.getLang("magiclisttag2");this.selectorClass.param3=1;this.on(Laya.Event.CLICK,this,this.hideMenu);this.fangshengbtn.clickHandler=new Laya.Handler(this,this.onRelease);this.listtujian.itemRender=i;this.listtujian.renderHandler=new Laya.Handler(this,this.onItemRender);this.fanpin.on(Laya.Event.CLICK,this,this.onChkClick);this.jinpin.on(Laya.Event.CLICK,this,this.onChkClick);this.xianpin.on(Laya.Event.CLICK,this,this.onChkClick)};e.prototype.onChkClick=function(){var t=[];if(this.fanpin.selected){t.push(3)}if(this.jinpin.selected){t.push(4)}if(this.xianpin.selected){t.push(5)}for(var e=0;e<this.listData.length;e++){if(t.indexOf(this.listData[e].qua)>=0){this.onPetChoose(true,this.listData[e].instid)}else{this.onPetChoose(false,this.listData[e].instid)}}this.listtujian.refresh()};e.prototype.hideMenu=function(){this.listyeqian1.visible=false;this.selectorClass.resetBtn()};e.prototype.onItemRender=function(t){t.setData(t.dataSource)};e.prototype.onC2SRelease=function(){n.PetControl.c2sRelease(this.choosedList)};e.prototype.onRelease=function(){if(this.choosedList.length>0){var t="是否确认放生已选择的全部灵宠？";var e=void 0;for(var i=0;i<this.choosedList.length;i++){e=n.PetModel.getIns().getPetVOByInstId(this.choosedList[i]);if(e&&e.qua>3){t="当前选择含有极品以上的灵宠，是否确认放生已选择的全部灵宠";break}}game.Alert.show(t,new Laya.Handler(this,this.onC2SRelease),new Laya.Handler)}else{manager.FlowManager.instance.flowByStyle1(app.getLang("newpet_des02"))}};e.prototype.onDisplay=function(){n.PetModel.getIns().on(n.PetEvent.PET_RELEASE,this,this.onReleaseAct);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){n.PetModel.getIns().off(n.PetEvent.PET_RELEASE,this,this.onReleaseAct);this.fanpin.selected=false;this.jinpin.selected=false;this.xianpin.selected=false};e.prototype.onReleaseAct=function(){this.updateView();this.choosedList=[]};e.prototype.refreshAll=function(){this.xuanze1.labelmiaoshu2.text=app.getLang("pettag_1_0");this.xuanze2.labelmiaoshu2.text=app.getLang("pettag_1_0");this.selectorClass.param1=0;this.selectorClass.param2=0;this.xuanze3.labelmiaoshu2.text=app.getLang("magiclisttag"+this.selectorClass.param3);this.hideMenu();this.updateView();this.choosedList=[]};e.prototype.sortByShowType=function(t,e){if(t.petCfg.supportelements<e.petCfg.supportelements)return-1;if(t.petCfg.supportelements>e.petCfg.supportelements)return 1;if(t.qua>e.qua)return-1;if(t.qua<e.qua)return 1;return 0};e.prototype.sortByQua=function(t,e){if(t.qua>e.qua)return-1;if(t.qua<e.qua)return 1;if(t.petCfg.supportelements<e.petCfg.supportelements)return-1;if(t.petCfg.supportelements>e.petCfg.supportelements)return 1;return 0};e.prototype.updateView=function(t){if(t===void 0){t=0}this.listData=n.PetModel.getIns().getBaseListByShowType(0,0,this.selectorClass.param1,this.selectorClass.param2,true);if(this.listData.length>0){if(this.selectorClass.param3==1){this.listData.sort(this.sortByShowType)}if(this.selectorClass.param3==2){this.listData.sort(this.sortByQua)}this.imgtishi.visible=false}else{this.imgtishi.visible=true}this.listtujian.array=this.listData};e.prototype.isSelected=function(t){return this.choosedList.indexOf(t)>=0};e.prototype.onPetChoose=function(t,n){if(t){if(this.choosedList.indexOf(n)==-1){this.choosedList.push(n)}}else{this.choosedList.forEach(function(t,e,i){if(Uint64.equal(t,n)){i.splice(e,1)}})}};e.SINGLE_KEY="pet.PetReleaseView";return e}(ui.chongwu.chongwufangshengviewUI);n.PetReleaseView=a})(pet||(pet={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var pet;(function(l){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.daoju.showBagCount(-3);this.stars=new common.StarListMediator(this.listxing,this.star,game.ComStarItem.W);this.btnzengli.clickHandler=new Laya.Handler(this,this.onFameUp);this.shengwang.stop();this.xianshou.stop();this.shengwangdengji.stop();this.shengwang.visible=false;this.xianshou.visible=false;this.shengwangdengji.visible=false;this.xianshou.on(Laya.Event.COMPLETE,this,this.onPlayEnd,[this.xianshou]);this.shengwangdengji.on(Laya.Event.COMPLETE,this,this.onPlayEnd,[this.shengwangdengji]);game.HelperViewHandler.registerStr([this.btnshengwang],"func378t",this.getAttrTips())};e.prototype.onAttrRender=function(t){var e=t.dataSource;var i=this.dataSource[0];var n=Attributes.decode(csv.PetProxy.getIns().getBaseAttr(e.rand)).baseList[0];t.labelshu1.text=app.getLang(Attributes.getPropName(n.propId));var a=i.getPropValue(e);t.labelshu2.text=a+"";var o=0;var s=csv.PetProxy.getIns().getReputation(i.getPetRep()+1);if(s){o=s.addshow}if(o>0){var r=o*.01;t.labelshu3.text="(+"+r.toFixed(1)+"%)"}else{t.labelshu3.text=""}};e.prototype.onPlayEnd=function(t){t.visible=false};e.prototype.onFameUp=function(){var t=l.PetModel.getIns().replv;var e;if(t==0){e=csv.PetProxy.getIns().getReputation(1)}else{e=csv.PetProxy.getIns().getReputation(t)}if(e){var i=game.GridsModel.getIns().getItemByItemId(e.reitem);if(i&&i.count>0){l.PetControl.c2sReputionUp(i.getInstId())}else{manager.FlowManager.instance.flowByStyle1(app.getLang("item_not_enough",csv.ItemProxy.getName(e.reitem)))}}};e.prototype.onDisplay=function(){l.PetModel.getIns().on(l.PetEvent.PET_REPUTIOH_UP,this,this.onReputionUpdate);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){this.shengwang.stop();this.xianshou.stop();this.shengwangdengji.stop();this.shengwang.visible=false;this.xianshou.visible=false;this.shengwangdengji.visible=false;l.PetModel.getIns().off(l.PetEvent.PET_REPUTIOH_UP,this,this.onReputionUpdate)};e.prototype.onReputionUpdate=function(t){this.updateView();this.shengwangdengji.play(0,false);this.shengwangdengji.visible=true;if(t){this.xianshou.play(0,false);this.xianshou.visible=true}};e.prototype.refreshAll=function(){this.updateView()};e.prototype.getAttrTips=function(){var t=csv.PetProxy.getIns().getNewpetreputationArray();var e="";for(var i=0;i<t.length;i++){e+=app.getLang("newpet_des05",t[i].star,t[i].level,(t[i].addshow*.01).toFixed(1));if(i<t.length-1){e+="\n"}}return e};e.prototype.getAttrDesc=function(){var t=csv.PetProxy.getIns().getReputation(l.PetModel.getIns().replv);var e=0;if(t){e=t.addshow*.01}return app.getLang("newpet_des06",e)};e.prototype.updateView=function(){this.labeljiacheng.text=this.getAttrDesc();var t=l.PetModel.getIns().replv;var e=csv.PetProxy.getIns().getReputation(t+1);var i=csv.PetProxy.getIns().getMaxReputation();var n=csv.PetProxy.getIns().getReputation(t);if(n){this.stars.setStar(n.star,i.star,"bg_aixin")}else{this.stars.setStar(0,i.star,"bg_aixin")}if(e){this.ani1.gotoAndStop(0);var a=game.STYLES.RED_COLOR_S;var o=0;if(t==0){n=csv.PetProxy.getIns().getReputation(1)}else{o=n.star}this.daoju.setData(n.reitem);var s=game.GridsModel.getIns().getItemByItemId(n.reitem);var r=0;if(s&&s.count>0){a=game.STYLES.GREEN_COLOR_S;r=s.count}this.daoju.shuzi.color=a;this.daoju.shuzi.text=r+"";this.labelshengwang.text=app.getLang("声望等级：{0}/{1}",t,i.index);this.labeljindu.text=app.getLang("{0}/{1}",l.PetModel.getIns().repexp,e.starcost);this.jindu.value=l.PetModel.getIns().repexp/e.starcost;this.shengwang.x=this.listxing.x+16+36*o;this.shengwang.play(0,true);this.shengwang.visible=true}else{this.shengwang.stop();this.shengwang.visible=false;this.ani1.gotoAndStop(1)}};e.SINGLE_KEY="pet.PetReputionView";return e}(ui.chongwu.chongwushengwangtipUI);l.PetReputionView=t})(pet||(pet={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var pet;(function(_){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.ownCount1=0;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.avatar=new avatar.AvatarAnimation;this.weizhi.addChild(this.avatar);this.avatarData=new avatar.AvatarData;this.avatarData.fileName=game.AniView.FILE_NAME.MONSTER;this.avatar.visible=false;this.stars=new common.StarListMediator(this.listxing,this.star,game.ComStarItem.W);this.shengji2.btnadd.visible=false;this.shengji2.xuanzhongimg.visible=false;this.shengji1.xuanzhongimg.visible=false;this.shengji1.on(Laya.Event.CLICK,this,this.onOpenView);this.shengji1.gezi.locktip=true;this.btnshengxing.clickHandler=new Laya.Handler(this,this.onStarUp);this.shengxing.stop();this.xianshou.stop();this.shengxing.visible=false;this.xianshou.visible=false;this.xianshou.on(Laya.Event.COMPLETE,this,this.onPlayEnd,[this.xianshou])};t.prototype.onPlayEnd=function(t){t.visible=false};t.prototype.onOpenView=function(){var t=this.dataSource[0];if(t.star<t.petCfg.star){var e=csv.PetProxy.getIns().getVolute(t.petid,t.star+1);app.ViewManager.toggleDialog(_.ItemChooseItemView,1,0,[e.spcost,e.cost])}};t.prototype.onChooseMat=function(t){this.mat=t;this.ownCount1=0;for(var e=0;e<t.length;e++){this.ownCount1+=t[e].selected}var i=csv.PetProxy.getIns().getVolute(this.dataSource[0].petid,this.dataSource[0].star+1);this.refreshMatCount(i)};t.prototype.onStarUp=function(){var t=this.dataSource[0];var e=csv.PetProxy.getIns().getVolute(this.dataSource[0].petid,this.dataSource[0].star+1);if(e){if(e.cost.length>0){var i=parseInt(app.str2Array(e.cost,"-")[0]);var n=parseInt(app.str2Array(e.cost,"-")[1]);var a=game.GridsModel.getIns().getItemCount(i);if(a<n){manager.FlowManager.instance.flowByStyle1(app.getLang("item_not_enough",app.getLang("itemname_"+i)));return}}var o=[];if(e.spcost.length>0){var s=void 0;var r=0;for(var l=0;l<this.mat.length;l++){if(this.mat[l].selected>0){s=new ItemData;s.itemID=this.mat[l].vo.getItemId();s.value=this.mat[l].selected;o.push(s);r+=s.value}}var n=parseInt(app.str2Array(e.spcost,"-")[1]);if(r<n){manager.FlowManager.instance.flowByStyle1(app.getLang("item_not_enough","魂晶"));return}}_.PetControl.c2sStarUp(t.pos,t.instid,o)}};t.prototype.onDisplay=function(){_.PetModel.getIns().on(_.PetEvent.PET_START_UP,this,this.onStarUpdate);this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){_.PetModel.getIns().off(_.PetEvent.PET_START_UP,this,this.onStarUpdate);this.shengxing.stop();this.xianshou.stop();this.shengxing.visible=false;this.xianshou.visible=false};t.prototype.onStarUpdate=function(){this.xianshou.play(0,false);this.xianshou.visible=true;this.updateView()};t.prototype.refreshAll=function(){var t=this.dataSource[0];this.avatarData.roleKey=t.petCfg.res;this.avatar.setAniData(this.avatarData);var e=t.petCfg.bonetimes?t.petCfg.bonetimes/100:1;this.avatar.scale(e,e);this.avatar.setAni(avatar.AvatarAnimation.ANI_ENUMS.IDLE,0);this.avatar.play();this.avatar.visible=true;this.updateView()};t.prototype.refreshMatCount=function(t){if(t.spcost.length>0){var e=parseInt(app.str2Array(t.spcost,"-")[1]);var i=game.STYLES.GREEN_COLOR_S;if(this.ownCount1<e){i=game.STYLES.RED_COLOR_S}if(this.ownCount1>e){this.ownCount1=e}var n=parseInt(app.str2Array(t.spcost,"-")[0]);var a=87001;if(n>3){a=87002}var o=game.ItemUtil.createVO(a);this.shengji1.gezi.setData(o);this.shengji1.shuzhi.text=app.getLang("<span color='{2}'>{0}</span>/{1}",this.ownCount1,e,i);this.shengji1.btnadd.visible=this.mat.length==0;this.shengji1.gezi.shuzi.text=""}};t.prototype.updateView=function(){this.mat=[];_.ItemChooseItemView.getIns().cleanMat();this.ownCount1=0;var t=this.dataSource[0];this.stars.setStar(t.star,t.petCfg.star);this.namelab.text=app.getLang(t.petCfg.namelang);this.imgshuxing.skin="res/static/bg_sx_"+t.petCfg.supportelements+".png";var e=t.star==t.petCfg.star;this.imgyimanji.visible=e;this.shengji1.visible=!this.imgyimanji.visible;this.shengji2.visible=!this.imgyimanji.visible;this.ani2.gotoAndStop(2);if(!e){this.shengxing.x=this.listxing.x+16+36*t.star;this.shengxing.play(0,true);this.shengxing.visible=true;var i=csv.PetProxy.getIns().getVolute(t.petid,t.star+1);var n=game.ItemUtil.parserList(i.cost)[0];game.ItemShowUtil.showType5(n,this.shengji2.gezi,this.shengji2.shuzhi);if(i.spcost.length>0){this.ani2.gotoAndStop(1);this.refreshMatCount(i)}else{this.ani2.gotoAndStop(0)}}else{this.shengxing.stop();this.shengxing.visible=false}var a=csv.PetProxy.getIns().getVolute(t.petid,t.star);this.zhanliclip.value=t.getBattleValue()+"";var o="";var s=0,r=parseInt(app.str2Array(t.petCfg.basewuxing,"-")[3]);var l="";if(t.star>0){l=app.getLang("Prop"+app.str2Array(a.wuxingaddelements,"-")[0])+":";s=parseInt(app.str2Array(a.wuxingaddelements,"-")[3]);r+=s}else{l=app.getLang("Prop"+app.str2Array(t.petCfg.basewuxing,"-")[0])+":"}var h=csv.PetProxy.getIns().getVolute(t.petid,t.star+1);var p="";if(h){p="(+"+(parseInt(app.str2Array(h.wuxingaddelements,"-")[3])-s)+"↑)"}o=app.getLang("newpet_addattr_01",l,r,p);this.imgshui.skin="res/static/bg_sx_"+t.petCfg.supportelements+".png";this.labelmiaoshu1.text=o;if(t.skillId>0){var u=csv.SkillProxy.getIns().getSkillByKey(t.skillId+"-"+t.getSkillLevel());this.jinengmingzi.text=u.name;this.jinneg.setData(u,false,false,false);this.jinneg.starMediator.value=0;var c=t.getNextPetLevel();var g=0;if(c>0){g=1;this.labelmiaoshu4.text="需要等级达到"+(app.getLang("zuoqi_11")+c)+"可激活升星后的技能效果"}else{this.labelmiaoshu4.text=""}this.labelmiaoshu2.text=csv.SkillProxy.getSkillDes(t.skillId,t.getSkillLevel(),g);this.jinneg.visible=true}else{this.labelmiaoshu4.text="";this.labelmiaoshu2.text="";this.jinneg.visible=false}this.labelmiaoshu3.text="";this.imgtubiao.visible=false;var f=t.petCfg.addattr;if(f.length>0){var d=0;this.imgtubiao.skin="chongwu/bg_shuxingtubiao_"+t.petCfg.addattricon+".png";if(h){var y=app.str2Array(h.addattr,"-");d=parseInt(y[1])}var v=t.getaddattr(d);this.labelmiaoshu3.text=v;this.imgtubiao.visible=v.length>0}};t.SINGLE_KEY="pet.PetStarUpView";return t}(ui.chongwu.chongwushengxingtipUI);_.PetStarUpView=t})(pet||(pet={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var pet;(function(n){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.clsKey="pet.PetTitleItem";return t}t.prototype.createNode=function(t){var e=Laya.Pool.getItemByClass(this.clsKey,n.PetTitleItem);e.x=t*e.width;e.y=this.y;var i=this.list[t];e.setLabel(i.skinurl,i.str);return e};return t}(list.RowMoveBaseNode);n.PetRowTitle=t;var e=function(){function t(){}return t}();n.TitleVO=e;var i=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.setLabel=function(t,e){this.imgjin.skin="chongwu/"+t+".png";this.label.text=" "+e};return e}(ui.chongwu.liebiaoshuxiangitemUI);n.PetTitleItem=i})(pet||(pet={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var qiYu;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){app.ViewManager.regist(i.QiYuExploreView);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.QIYU_EXPLORE,i.QiYuExploreView,null,game.ECommonType.COMMON_TYPE_QIYUTANXIAN);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.QIYU_CHALLENGE,i.QiYuChallengeView,null,game.ECommonType.COMMON_TYPE_QIYUTANXIAN);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.QIYU_GIFT,i.QiYuGiftView,null,game.ECommonType.COMMON_TYPE_QIYUTANXIAN);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.QIYU_EXCHANGE,i.QiYuExchangeView,null,game.ECommonType.COMMON_TYPE_QIYUTANXIAN);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.QIYU_RANK,i.QiYuRankView,null,game.ECommonType.COMMON_TYPE_QIYUTANXIAN)};e.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.QiYuNtf,this,this.onQiYuNtf);this.addMsgListener(app.ProtocolResponse.QiYuDrawResp,this,this.onQiYuDrawResp)};e.prototype.onQiYuNtf=function(t,e){i.QiYuModel.getIns().updateQiYuData(e)};e.prototype.onQiYuDrawResp=function(t,e){if(e.ret==1){i.QiYuModel.getIns().updateDrawData(e)}};e.SINGLE_KEY="qiYu.QiYuModule";return e}(app.ModuleBase);i.QiYuModule=t})(qiYu||(qiYu={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("qiyu_duihuan.csv");this.cfgMap=t.getMap("id");this.cfgMapList=t.getMapList("activityid","layer");var e=t.getArray()[0];this.itemId=parseInt(app.str2Array(e.consume,"-")[0])};e.prototype.getCfg=function(t){return this.cfgMap[t]};e.prototype.getItemID=function(){return this.itemId};e.prototype.getExchangeArray=function(t,e){return this.cfgMapList[t][e]};e.SINGLE_KEY="csv.QiYuDuiHuanProxy";return e}(app.ModelBase);t.QiYuDuiHuanProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("qiyu_gacha.csv");this.cfgMap=t.getMap("gachatype","activityid")};e.prototype.getCfg=function(t,e){return this.cfgMap[t][e]};e.SINGLE_KEY="csv.QiYuGaChaProxy";return e}(app.ModelBase);t.QiYuGaChaProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var qiYu;(function(r){var t=function(t){__extends(u,t);function u(){return t!==null&&t.apply(this,arguments)||this}u.getIns=function(){return app.Singleton.getInstance(u)};u.prototype.init=function(){this.exchangeNoticeArr=[]};u.prototype.updateQiYuData=function(t){this.playerData=t.playerData[0];this.charge=t.charge;if(this.exchangeNoticeArr.length==0){var e=this.getCanExchangeArr();for(var i=0;i<e.length;i++){var n=csv.QiYuDuiHuanProxy.getIns().getExchangeArray(this.playerData.activityId,e[i]);for(var a=0;a<n.length;a++){if(n[a].remind==1){r.QiYuModel.getIns().exchangeNoticeArr.push(n[a].id)}}}}this.updateRedDot();this.event(u.EVENTS.UPDATE_QiYu_DATA)};u.prototype.updateDrawData=function(t){this.event(u.EVENTS.UPDATE_DRAW_DATA,[t.drawData])};u.prototype.updateExchangeEntryDot=function(){var t=false;var e;for(var i=0;i<this.exchangeNoticeArr.length;i++){e=csv.QiYuDuiHuanProxy.getIns().getCfg(this.exchangeNoticeArr[i]);if(this.isExchangeDot(e)){t=true;break}}if(t){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.QIYU_EXCHANGE)}else{game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.QIYU_EXCHANGE)}};u.prototype.getCostStr=function(t){var e=this.getOpenActid();var i=csv.QiYuGaChaProxy.getIns().getCfg(t,e);if(i){return i.cost}return""};u.prototype.getOpenActid=function(){var t=this.getOpenActVo();if(t){return t.actid}return 0};u.prototype.getOpenActVo=function(){var t=activitytaren.ActivityTaRenModel.getIns().getActivityID_By_functionid(csv.FunctionsProxy.ENUMS.QIYU_EXPLORE);return t};u.prototype.getChallengeArr=function(t,e){var i=csv.QiYuRenWuProxy.getIns().getCfgArr(t,e);if(t==u.TYPES.PERSON_TYPE&&!this.playerData){return i}var n=[];var a=[];var o=[];var s=[];var r=this.playerData?this.playerData.totalDraw:0;for(var l=0;l<i.length;l++){var h=this.playerData?this.playerData.recvBid:[];var p=h.indexOf(i[l].id);if(p!=-1){s.push(i[l])}else{if(r>=i[l].value){a.push(i[l])}else{o.push(i[l])}}}n=a.concat(o).concat(s);return n};u.prototype.getDotRound=function(t){var e=game.Config.getIntParams(2022);var i=csv.QiYuRenWuProxy.getIns().getCfgArr(u.TYPES.ROUND_TYPE);if(t<=0||t>e||i.length==0){return-1}var n=this.playerData?this.playerData.recvBid:[];var a=this.playerData?this.playerData.totalDraw:0;var o=[];var s=csv.QiYuRenWuProxy.getIns().getCfgArr(u.TYPES.PERSON_TYPE,t);o=o.concat(s);o.push(i[t][0]);for(var r=0;r<o.length;r++){if(n.indexOf(o[r].id)==-1&&a>=o[r].value){return o[r].rounds}}return-1};u.prototype.getMyReward=function(t){if(t==0){return""}var e=csv.QiYuPaiHangBangProxy.getIns().getCfgArr;for(var i=0;i<e.length;i++){var n=e[i];var a=n.rangk.split("-");var o=parseInt(a[0]);var s=parseInt(a[1]);if(t>=o&&t<=s){return n.reward}}return""};u.prototype.getRankLabel=function(t){var e=t.rangk.split("-");var i=parseInt(e[0]);var n=parseInt(e[1]);if(i==n){return i.toString()}return i+"~"+n};u.prototype.getExchangeData=function(t){var e=0;if(this.playerData){for(var i=0;i<this.playerData.exchangeData.length;i++){if(this.playerData.exchangeData[i].id==t){e=this.playerData.exchangeData[i].value;break}}}return e};u.prototype.getCanExchangeArr=function(){var t=[];var e=this.getNextOpenFloor();for(var i=1;i<=e;i++){var n=csv.QiYuDuiHuanProxy.getIns().getExchangeArray(this.playerData.activityId,i);for(var a=0;a<n.length;a++){var o=r.QiYuModel.getIns().getExchangeData(n[a].id);var s=game.ItemUtil.parserList(n[a].consume)[0];if(o<n[a].value&&game.GridsModel.getIns().hasEnoughItems(s)){t.push(i);break}}}return t};u.prototype.getNextOpenFloor=function(){if(this.playerData&&this.playerData.exchangeData.length){var t=this.playerData.exchangeData[this.playerData.exchangeData.length-1].id;var e=csv.QiYuDuiHuanProxy.getIns().getCfg(t);var i=csv.QiYuDuiHuanProxy.getIns().getExchangeArray(this.playerData.activityId,e.layer+1);if(e&&(i&&i.length>0)){return e.layer+1}return e.layer}return 1};u.prototype.isExporeDot=function(t){var e=this.getOpenActid();var i=csv.QiYuGaChaProxy.getIns().getCfg(1,e);var n=i.gachalimit-this.playerData.todayDraw;var a;a=this.getCostStr(t);if(n>0&&game.GridsModel.getIns().hasEnoughItems(a)){return true}return false};u.prototype.isExchangeDot=function(t){var e=game.ItemUtil.parserList(t.consume)[0];var i=this.getExchangeData(t.id);var n=u.getIns().exchangeNoticeArr.indexOf(t.id);if(n!=-1&&i<t.value&&game.GridsModel.getIns().hasEnoughItems(e)){return true}return false};u.prototype.hasChallengeDot=function(){var t=game.Config.getIntParams(2022);for(var e=1;e<=t;e++){var i=this.getDotRound(e);if(i!=-1){return true}}return false};u.prototype.updateRedDot=function(){var t=u.getIns().getCostStr(1);var e=csv.QiYuGaChaProxy.getIns().getCfg(1,this.getOpenActid());if(e){var i=e.gachalimit;if(u.getIns().playerData.todayDraw<i&&game.GridsModel.getIns().hasEnoughItems(t)){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.QIYU_EXPLORE)}else{game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.QIYU_EXPLORE)}}else{game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.QIYU_EXPLORE)}if(this.hasChallengeDot()){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.QIYU_CHALLENGE)}else{game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.QIYU_CHALLENGE)}this.updateExchangeEntryDot()};u.SINGLE_KEY="qiYu.QiYuModel";u.GACHA_TYPE_ONE=1;u.GACHA_TYPE_TEN=2;u.EXCHANGE_FLOOR_NUM=5;u.EVENTS={UPDATE_QiYu_DATA:"UPDATE_QiYu_DATA",UPDATE_DRAW_DATA:"UPDATE_DRAW_DATA",UPDATE_EXCHANGE_NOTICE:"UPDATE_EXCHANGE_NOTICE"};u.TYPES={PERSON_TYPE:1,ROUND_TYPE:2};return u}(app.ModelBase);r.QiYuModel=t})(qiYu||(qiYu={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("qiyu_paihangbang.csv");this.cfgMap=t.getMap("id");this.cfgArr=t.getArray()};e.prototype.getCfg=function(t){return this.cfgMap[t]};e.prototype.getCfgArr=function(){return this.cfgArr};e.SINGLE_KEY="csv.QiYuPaiHangBangProxy";return e}(app.ModelBase);t.QiYuPaiHangBangProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("qiyu_pool.csv");this.cfgMapList=t.getMapList("poolid","activityid");this.cfgArr=t.getArray()};e.prototype.getCfgMapList=function(t,e){return this.cfgMapList[t][e]};e.prototype.getPoolIds=function(t){var e=[];var i;for(var n=0;n<this.cfgArr.length;n++){if(!t){i=true}else{i=this.cfgArr[n].showtype==t}if(i&&e.indexOf(this.cfgArr[n].poolid)==-1){e.push(this.cfgArr[n].poolid)}}return e};e.SINGLE_KEY="csv.QiYuPoolProxy";return e}(app.ModelBase);t.QiYuPoolProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("qiyu_renwu.csv");this.cfgMap=t.getMap("id");this.cfgMapList=t.getMapList("activityid","type","rounds")};e.prototype.getCfg=function(t){return this.cfgMap[t]};e.prototype.getCfgArr=function(t,e){if(e===void 0){e=-1}var i=qiYu.QiYuModel.getIns().getOpenActid();if(i==0){return[]}var n=this.cfgMapList[i][t][e];if(e!=-1){n=this.cfgMapList[i][t][e]}else{n=this.cfgMapList[i][t]}return n};e.SINGLE_KEY="csv.QiYuRenWuProxy";return e}(app.ModelBase);t.QiYuRenWuProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var qiYu;(function(a){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.liebiao.itemRender=grids.GridView;this.liebiao.renderHandler=grids.GridView.CommonItemRender;this.qianwangbtn.clickHandler=new Laya.Handler(this,this.onClickGotoBtn);this.lingqubtn.clickHandler=new Laya.Handler(this,this.onClickGetBtn);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){this._data=t;var e=a.QiYuModel.getIns().playerData?a.QiYuModel.getIns().playerData.totalDraw:0;this.tiaojian.text=app.getLang(t.text);this.shuzhi.text=e+"/"+t.value;this.jindutiao.value=e/t.value;var i=game.ItemUtil.parserList(t.reward);this.liebiao.array=i;this.updateBtnState(e)};e.prototype.updateBtnState=function(t){var e=a.QiYuModel.getIns().playerData;var i=e?e.recvBid:[];var n=i.indexOf(this._data.id);game.RedDotView.removeFrom(this.lingqubtn);if(n!=-1){this.yilingqu.visible=true;this.lingqubtn.visible=false;this.qianwangbtn.visible=false}else{this.yilingqu.visible=false;if(t>=this._data.value){this.lingqubtn.visible=true;this.qianwangbtn.visible=false;game.RedDotView.addTo(this.lingqubtn)}else{this.qianwangbtn.visible=true;this.lingqubtn.visible=false}}};e.prototype.onClickGotoBtn=function(){game.ClosureManager.callFunction(csv.FunctionsProxy.ENUMS.QIYU_EXPLORE)};e.prototype.onClickGetBtn=function(){app.ProtocolRequest.QiYuAwardReq(this._data.id)};e.SINGLE_KEY="qiYu.QiYuChallengeItem";return e}(ui.huanlingjieui.hljpaimingitem1UI);a.QiYuChallengeItem=t})(qiYu||(qiYu={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var qiYu;(function(u){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.liebiao.itemRender=u.QiYuChallengeItem;this.liebiao.renderHandler=new Laya.Handler(this,this.onRenderHandler);this.daoju.itemRender=grids.GridView;this.daoju.renderHandler=grids.GridView.CommonItemRender;this.lingqubtn.clickHandler=new Laya.Handler(this,this.onClickBtn);this.zuo.clickHandler=new Laya.Handler(this,this.onClickLeftBtn);this.you.clickHandler=new Laya.Handler(this,this.onClickRightBtn);this.zuo.mouseEnabled=this.you.mouseEnabled=true;this.activityTimeView=new activitytaren.ActivityTimeView(this.daojishi,new Laya.Handler(this,this.endTimeCallBack),"miaosha_time_1");this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){u.QiYuModel.getIns().on(u.QiYuModel.EVENTS.UPDATE_QiYu_DATA,this,this.onUpdateData);this.curRounds=this.getInitRoundNum();this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){u.QiYuModel.getIns().off(u.QiYuModel.EVENTS.UPDATE_QiYu_DATA,this,this.onUpdateData)};e.prototype.onUpdateData=function(){this.callLater(this.refreshAll)};e.prototype.refreshAll=function(){var t=u.QiYuModel.getIns().getOpenActVo();var e=t?t.timeVo.endTime:0;this.activityTimeView.start(e);var i=u.QiYuModel.getIns().getChallengeArr(u.QiYuModel.TYPES.PERSON_TYPE,this.curRounds);var n=csv.QiYuRenWuProxy.getIns().getCfgArr(u.QiYuModel.TYPES.ROUND_TYPE,this.curRounds);var a=game.Config.getIntParams(2022);this.lunci.text=app.getLang("ttg_text6",this.curRounds,a);var o=game.ItemUtil.parserList(n[0].reward);this.daoju.array=o;this.liebiao.array=i;this.updateBtnState(n[0]);if(this.curRounds<=1){this.zuo.visible=false;this.you.visible=true}else if(this.curRounds>=a){this.zuo.visible=true;this.you.visible=false}else{this.zuo.visible=true;this.you.visible=true}var s=this.curRounds;var r=s-1;var l=s+1;var h=u.QiYuModel.getIns().getDotRound(r);var p=u.QiYuModel.getIns().getDotRound(l);if(h!=-1){game.RedDotView.addTo(this.zuo)}else{game.RedDotView.removeFrom(this.zuo)}if(p!=-1){game.RedDotView.addTo(this.you)}else{game.RedDotView.removeFrom(this.you)}};e.prototype.updateBtnState=function(t){var e=-1;var i=u.QiYuModel.getIns().playerData;if(i){e=i.recvBid.indexOf(t.id)}game.RedDotView.removeFrom(this.lingqubtn);if(e!=-1){this.lingqubtn.visible=false;this.weiwanchegnimg.visible=false;this.yilingquimg.visible=true}else{this.yilingquimg.visible=false;if(i&&i.totalDraw>=t.value){this.lingqubtn.visible=true;this.weiwanchegnimg.visible=false;game.RedDotView.addTo(this.lingqubtn)}else{this.lingqubtn.visible=false;this.weiwanchegnimg.visible=true}}};e.prototype.onRenderHandler=function(t,e){t.setData(t.dataSource)};e.prototype.onClickBtn=function(){var t=csv.QiYuRenWuProxy.getIns().getCfgArr(u.QiYuModel.TYPES.ROUND_TYPE,this.curRounds);app.ProtocolRequest.QiYuAwardReq(t[0].id)};e.prototype.onClickLeftBtn=function(){if(this.curRounds>1){this.curRounds--}this.refreshAll()};e.prototype.onClickRightBtn=function(){var t=game.Config.getIntParams(2022);if(this.curRounds<t){this.curRounds++}this.refreshAll()};e.prototype.endTimeCallBack=function(){this.activityTimeView.stop();this.daojishi.text="";Laya.Dialog.manager.closeAll()};e.prototype.getInitRoundNum=function(){var t=csv.QiYuRenWuProxy.getIns().getCfgArr(u.QiYuModel.TYPES.ROUND_TYPE);var e=u.QiYuModel.getIns().playerData;var i=[];if(e){i=e.recvBid}var n=1;while(t[n]){var a=[];var o=csv.QiYuRenWuProxy.getIns().getCfgArr(u.QiYuModel.TYPES.PERSON_TYPE,n);a=a.concat(o);a.push(t[n][0]);for(var s=0;s<a.length;s++){if(i.indexOf(a[s].id)==-1){return a[s].rounds}}n++}return 1};e.SINGLE_KEY="qiYu.QiYuChallengeView";return e}(ui.huanlingjieui.huanlingjieview2UI);u.QiYuChallengeView=t})(qiYu||(qiYu={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var qiYu;(function(a){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.imgxuanzhong.visible=false;this.duihuanbtn.clickHandler=new Laya.Handler(this,this.onClick);this.tixing.on(Laya.Event.CHANGE,this,this.onChangeHandler);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){this.data=t;this.xiangoulab.text=app.getLang("qiyutansuo_01",t.value);var e=game.ItemUtil.parserList(t.item)[0];this.daojugezi.setData(e);this.daojuname.color=game.STYLES.ITEM_QUALITY_S[e.getQuality()];this.daojuname.text=e.getName();this.huobi.parserIcon(t.consume,this.shuzhi,"",true);var i=a.QiYuModel.getIns().exchangeNoticeArr.indexOf(this.data.id);if(!this.tixing.selected&&i!=-1){this.tixing.selected=true}var n=a.QiYuModel.getIns().getExchangeData(t.id);if(n>=t.value){this.shouqinimg.visible=true;this.duihuanbtn.disabled=true}else{this.shouqinimg.visible=false;this.duihuanbtn.disabled=false}this.updateNoticeDot()};e.prototype.onSelected=function(t){this.imgxuanzhong.visible=t};e.prototype.updateNoticeDot=function(){var t=a.QiYuModel.getIns().isExchangeDot(this.data);if(t){game.RedDotView.addTo(this.duihuanbtn)}else{game.RedDotView.removeFrom(this.duihuanbtn)}};e.prototype.onChangeHandler=function(){var t=a.QiYuModel.getIns().getCanExchangeArr();if(t.indexOf(this.data.layer)!=-1){if(this.tixing.selected){if(a.QiYuModel.getIns().exchangeNoticeArr.indexOf(this.data.id)==-1){a.QiYuModel.getIns().exchangeNoticeArr.push(this.data.id)}}else{var e=a.QiYuModel.getIns().exchangeNoticeArr.indexOf(this.data.id);if(e!=-1){a.QiYuModel.getIns().exchangeNoticeArr.splice(e,1)}}}this.updateNoticeDot();a.QiYuModel.getIns().updateExchangeEntryDot()};e.prototype.onClick=function(){var t=game.ItemUtil.parserList(this.data.consume)[0];if(!game.GridsModel.getIns().hasEnoughItems(t,false,true)){return}if(game.SystemSetModel.getInstance().alertViewCheck(csv.FunctionsProxy.ENUMS.QIYU_EXCHANGE)){this.onExchangeReq()}else{game.Alert.show(app.getLang("qiyutansuo_02",game.STYLES.ITEM_QUALITY_S[t.getQuality()],t.getName(),t.count),new Laya.Handler(this,this.onExchangeReq),new Laya.Handler,0,"","","center","center",csv.FunctionsProxy.ENUMS.QIYU_EXCHANGE)}};e.prototype.onExchangeReq=function(){app.ProtocolRequest.QiYuExchangeReq(this.data.id,1)};e.SINGLE_KEY="qiYu.QiYuExchangeItem";return e}(ui.huanlingjieui.hljduihuanitemUI);a.QiYuExchangeItem=t})(qiYu||(qiYu={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var qiYu;(function(a){var t=function(i){__extends(t,i);function t(){var t=i!==null&&i.apply(this,arguments)||this;t.selectedFloor=1;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){i.prototype.initialize.call(this);this.liebiao.itemRender=a.QiYuExchangeItem;this.liebiao.renderHandler=new Laya.Handler(this,this.onListRenderHandler);this.liebiao.selectEnable=true;this.liebiao.selectHandler=new Laya.Handler(this,this.onSelectedRenderHandler);this.liebiao.scrollRectOffX=10;this.liebiao.scrollRectOffY=10;for(var t=1;t<=5;t++){this["ceng"+t].donghua.stop();this["ceng"+t].donghua.visible=false;this["ceng"+t].anniu.skin="res/static/tongtiange/btn_ttg_ceng_"+t+".png";this["ceng"+t].anniu.clickHandler=new Laya.Handler(this,this.onBtnClick,[t])}var e=csv.QiYuDuiHuanProxy.getIns().getItemID();this.wuping.parserIconByItemId(e);this.wuping.on(Laya.Event.CLICK,this,this.onTipShow,[e]);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};t.prototype.onDisplay=function(){a.QiYuModel.getIns().on(a.QiYuModel.EVENTS.UPDATE_QiYu_DATA,this,this.onUpdateExchangeData);this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){a.QiYuModel.getIns().off(a.QiYuModel.EVENTS.UPDATE_QiYu_DATA,this,this.onUpdateExchangeData);for(var t=1;t<=a.QiYuModel.EXCHANGE_FLOOR_NUM;t++){this["ceng"+t].donghua.stop();this["ceng"+t].donghua.visible=false}};t.prototype.onUpdateExchangeData=function(){this.callLater(this.refreshAll)};t.prototype.refreshAll=function(){var t=a.QiYuModel.getIns().getCanExchangeArr();var e=t.length>0?t[t.length-1]:1;for(var i=1;i<=a.QiYuModel.EXCHANGE_FLOOR_NUM;i++){var n=this["ceng"+i].donghua;if(n&&t.indexOf(i)!=-1){n.play(0,true);n.visible=true;this["ceng"+i].anniu.gray=false}else{n.stop();n.visible=false;this["ceng"+i].anniu.gray=true}}this.onBtnClick(e)};t.prototype.onListRenderHandler=function(t){t.setData(t.dataSource)};t.prototype.onSelectedRenderHandler=function(t){if(this.selectedItem){this.selectedItem.onSelected(false)}var e=this.liebiao.getCell(t);if(e){e.onSelected(true);this.selectedItem=e}};t.prototype.onTipShow=function(t){var e=game.ItemUtil.createVO(t);if(e){tip.TipManager.show(e,true)}};t.prototype.onBtnClick=function(t){for(var e=1;e<=a.QiYuModel.EXCHANGE_FLOOR_NUM;e++){if(e==t){this["ceng"+e].xuanzhong.visible=true;this["ceng"+e].anniu.selected=true}else{this["ceng"+e].xuanzhong.visible=false;this["ceng"+e].anniu.selected=false}}this.selectedFloor=t;this.updateView()};t.prototype.updateView=function(){this.shuliang.text=game.MoneyModel.format(game.GridsModel.getIns().getItemCount(csv.QiYuDuiHuanProxy.getIns().getItemID()));if(a.QiYuModel.getIns().playerData){var t=csv.QiYuDuiHuanProxy.getIns().getExchangeArray(a.QiYuModel.getIns().playerData.activityId,this.selectedFloor);this.liebiao.array=t;if(t&&t.length>0){var e=game.ItemUtil.parserList(t[0].reward)[0];var i=app.getLang("qiyutansuo_03");this.daojishilab.text=app.getLang(i,game.STYLES.ITEM_QUALITY_S[e.getQuality()],e.getName(),e.count)}}else{this.liebiao.array=[]}};t.SINGLE_KEY="qiYu.QiYuExchangeView";return t}(ui.huanlingjieui.huanlingjieview5UI);a.QiYuExchangeView=t})(qiYu||(qiYu={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var qiYu;(function(l){var t=function(i){__extends(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){i.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.daojubox.on(Laya.Event.CLICK,this,this.onClickItemHandler);this.jzbtn3.clickHandler=new Laya.Handler(this,this.onClickBtn,[1]);this.jzbtn2.clickHandler=new Laya.Handler(this,this.onClickBtn,[2]);this.yulanbtn.clickHandler=new Laya.Handler(this,this.onClickYulanBtn);this.activityTimeView=new activitytaren.ActivityTimeView(this.daojishi,new Laya.Handler(this,this.endTimeCallBack),"miaosha_time_1");this.effAniArr=[];for(var t=0;t<10;t++){var e=new game.AniView;e.on(Laya.Event.COMPLETE,this,this.onEffComplete,[e]);this.effAniArr.push(e)}};t.prototype.onDisplay=function(){l.QiYuModel.getIns().on(l.QiYuModel.EVENTS.UPDATE_QiYu_DATA,this,this.onUpdateData);l.QiYuModel.getIns().on(l.QiYuModel.EVENTS.UPDATE_DRAW_DATA,this,this.onUpdateDrawData);this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){l.QiYuModel.getIns().off(l.QiYuModel.EVENTS.UPDATE_QiYu_DATA,this,this.onUpdateData);l.QiYuModel.getIns().off(l.QiYuModel.EVENTS.UPDATE_DRAW_DATA,this,this.onUpdateDrawData);for(var t=0;t<this.effAniArr.length;t++){var e=this.effAniArr[t];e.off(Laya.Event.COMPLETE,this,this.onEffComplete)}};t.prototype.onUpdateData=function(){this.callLater(this.refreshAll)};t.prototype.onUpdateDrawData=function(t){if(!t){return}var e="";if(t.length==1){var i=Math.ceil(Math.random()*10);var n=this.effAniArr[0];var a=game.ItemUtil.createVO(t[0].itemID);e=this.getAniName(a.itemCfg.type,a.itemCfg.subtype,a.itemCfg.qua);n.load(e,game.AniView.FILE_NAME.UI);this["texiao"+i].addChild(n);n.play()}else{for(var o=0;o<t.length;o++){var n=this.effAniArr[o];var a=game.ItemUtil.createVO(t[o].itemID);e=this.getAniName(a.itemCfg.type,a.itemCfg.subtype,a.itemCfg.qua);n.load(e,game.AniView.FILE_NAME.UI);this["texiao"+(o+1)].addChild(n);n.play()}}};t.prototype.onEffComplete=function(t){t.removeSelf();t.stop()};t.prototype.refreshAll=function(){var t=l.QiYuModel.getIns();var e=csv.QiYuGaChaProxy.getIns().getCfg(1,this.actVo.actid);if(e){var i=this.getCostItem(l.QiYuModel.GACHA_TYPE_ONE);var n=this.getCostItem(l.QiYuModel.GACHA_TYPE_TEN);if(i){this.wuping.skin=i.getIconUrl();this.wuping.width=37;this.wuping.height=32;this.shuliang.text=game.GridsModel.getIns().getItemCount(i.getItemId())+""}var a=t.playerData?t.playerData.totalDraw:0;var o=e.defendtimes-a%e.defendtimes;var s=t.getCostStr(l.QiYuModel.GACHA_TYPE_ONE);var r=t.getCostStr(l.QiYuModel.GACHA_TYPE_TEN);this.cishuclip.value=o+"";this.daoju1.parserIcon(s,this.shuzhi1);this.daoju2.parserIcon(r,this.shuzhi2);this.daoju1.icon.scaleX=this.daoju2.icon.scaleX=1;this.daoju1.icon.scaleY=this.daoju2.icon.scaleY=1;this.jzbtn3.label=app.getLang("qiyutansuo_04",i.count);this.jzbtn2.label=app.getLang("qiyutansuo_04",n.count);if(t.isExporeDot(l.QiYuModel.GACHA_TYPE_ONE)){game.RedDotView.addTo(this.jzbtn3)}else{game.RedDotView.removeFrom(this.jzbtn3)}if(t.isExporeDot(l.QiYuModel.GACHA_TYPE_TEN)){game.RedDotView.addTo(this.jzbtn2)}else{game.RedDotView.removeFrom(this.jzbtn2)}}this.activityTimeView.start(this.actVo.timeVo.endTime)};t.prototype.endTimeCallBack=function(){this.activityTimeView.stop();this.daojishi.text="";Laya.Dialog.manager.closeAll()};t.prototype.onClickItemHandler=function(){var t=this.getCostItem(1);if(t){tip.TipManager.show(t,true,true)}};t.prototype.onClickBtn=function(t){var e=l.QiYuModel.getIns().getCostStr(t);var i=csv.QiYuGaChaProxy.getIns().getCfg(t,this.actVo.actid);if(!i){return}var n=i.gachalimit;if(l.QiYuModel.getIns().playerData.todayDraw>=n){manager.FlowManager.instance.flowByStyle1(app.getLang("qiyutansuo_05"));return}if(!game.GridsModel.getIns().hasEnoughItems(e,false,true)){return}app.ProtocolRequest.QiYuDrawReq(i.id)};t.prototype.onClickYulanBtn=function(){app.ViewManager.toggleDialog(l.QiYuRewardPreView,1,0)};t.prototype.getCostItem=function(t){var e=l.QiYuModel.getIns().getCostStr(t);var i=game.ItemUtil.parserList(e)[0];return i};t.prototype.getAniName=function(t,e,i){var n="";if(i==2){n="lv"}else if(i==3){n="lan"}else if(i==4){n="zi"}else if(i==5){n="huang"}if(t==csv.ItemProxy.TYPES.PET&&e==1){return"skill_UI_01_"+n}else{return"skill_UI_02_"+n}};t.SINGLE_KEY="qiYu.QiYuExploreView";return t}(ui.huanlingjieui.huanlingjieview1UI);l.QiYuExploreView=t})(qiYu||(qiYu={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var qiYu;(function(t){var e=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.iconT=new i;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.gezilist.itemRender=grids.GridView;this.gezilist.renderHandler=new Laya.Handler(this,this.onItemRender);this.newscModel=newshangcheng.NewShangChengModel.getIns();this.imgxuanzhong.removeSelf();this.on(Laya.Event.CLICK,this,this.onClickHandler);this.newscModel=newshangcheng.NewShangChengModel.getIns()};t.prototype.onDisplay=function(){this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){};t.prototype.refreshAll=function(){};t.prototype.setData=function(t,e){this.cfg=t;var i=e.getSubInfo(t.id);if(i){this.info=i;this.actVo=e;this.clear();var n=void 0;var a=this.cutType;var o=0;var s=void 0;if(a==l.GoldBuy){this.iconT.parseTaren(t.p6);n=t.p5;o=this.cfg.p1;if(o==0){this.jiyuanbox.visible=true}else{this.yuanbaobox.visible=true;this.shuzhi3.value=o.toString();this.shuzhi3.on(Laya.Event.RESIZE,this,this.onWidthChange3);s=t.p4}if(i.num>0){game.RedDotView.addTo(this,this.width-20,20)}}else{var r=csv.RechargeProxy.getIns().cfgMap[parseInt(t.p1)];if(r){s=r.limit;this.iconT.parseRecharge(r);o=r.recharge;n=r.reward;if(o==0){this.jiyuanbox.visible=true}else{this.yuanbox.visible=true;this.shuzhi1.value=app.convert_Yuan(o).toString();this.shuzhi1.on(Laya.Event.RESIZE,this,this.onWidthChange)}}else{console.error("recharge id "+t.p1+" 未找到")}}if(this.newscModel.isSellout(this.actVo,t.id)){this.shouqinimg.visible=true}else{if(o==0){game.RedDotView.addTo(this)}}if(this.iconT.showicon!=""){this.imgdaoju.skin=csv.ItemProxy.getUrl(this.iconT.showicon)}this.daoju.skin=this.iconT.res;this.imgjiaobiao.skin=this.iconT.subscript;this.xiangoulab.text=app.getLang("xinshangcheng_01",i.num,s);if(n){this.newscModel.setListVaule(this.gezilist,n)}}};t.prototype.onItemRender=function(t){t.locktip=true;t.setData(t.dataSource);t.setCntScale(this.gezilist.scaleX)};t.prototype.onClickHandler=function(){var t=this.cutType;if(t==l.ChongZhi){this.newscModel.onLiBaoAction(this.actVo,this.cfg)}else if(t==l.GoldBuy){var e=this.actVo.getSubInfo(this.cfg.id);if(e.status==activitytaren.ActivityTaRenLingQuStatus.IS_ALREADY_LING_QU){return}var i=this.cfg.p1;if(game.MoneyModel.getIns().getMoney(game.MoneyModel.MONEY_ENUM.GOLD)<i){shop.ShopModel.getIns().askChongZhi()}else{game.Alert.show(app.getLang("ttg_tips12",i),new Laya.Handler(this,this.onOkHandler))}}};t.prototype.onOkHandler=function(){app.ProtocolRequest.RecvActPrizeReq(this.cfg.id,1)};t.prototype.onWidthChange=function(){this.refreshmoney(this.shuzhi1,this.yuanbox,this.yuan)};t.prototype.onWidthChange3=function(){this.refreshmoney(this.shuzhi3,this.yuanbaobox,this.yuanbaoimg)};t.prototype.refreshmoney=function(t,e,i){t.x=(this.yuanbox.width-t.width-i.width)/2;i.x=t.x+t.width+10};t.prototype.clear=function(){game.RedDotView.removeFrom(this);this.daoju.skin="";game.RedDotView.removeFrom(this);this.shouqinimg.visible=false;this.shuzhi2.visible=false;this.yuanbaobox.visible=false;this.yuanbox.visible=false;this.jiyuanbox.visible=false};Object.defineProperty(t.prototype,"cutType",{get:function(){return this.cfg.p3},enumerable:true,configurable:true});t.SINGLE_KEY="qiYu.QiYuGiftItem";return t}(ui.huanlingjieui.hljxianshilibaoitemUI);t.QiYuGiftItem=e;var l;(function(t){t[t["GoldBuy"]=1]="GoldBuy";t[t["ChongZhi"]=2]="ChongZhi"})(l=t.ShopType||(t.ShopType={}));var i=function(){function t(){}t.prototype.parseTaren=function(t){var e=t.split(";");this.showicon=e[0];this.res=e[1];this.subscript=e[2]};t.prototype.parseRecharge=function(t){this.showicon=t.showicon;this.res=t.res;this.subscript=t.subscript};return t}()})(qiYu||(qiYu={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var qiYu;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.newscModel=newshangcheng.NewShangChengModel.getIns();this.tarenModel=activitytaren.ActivityTaRenModel.getIns();this.liebiao.itemRender=i.QiYuGiftItem;this.liebiao.renderHandler=new Laya.Handler(this,this.onRenderHander);this.timec=new activitytaren.ActivityTimeView(this.daojishilab,new Laya.Handler(this,this.endHandler),app.getLang("huodong_text05"));this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.tarenModel.on(activitytaren.ActivityTaRenModel.ACTIVIT_TAREN_EVENT.GET_MAIN_PANEL_INFO,this,this.onGetMainPanel);this.tarenModel.on(activitytaren.ActivityTaRenModel.ACTIVIT_TAREN_EVENT.UPDATE_ACTIVIT_DATA,this,this.onGetMainPanel);game.RoleModel.getIns().on(game.RoleModel.EVENTS.KUAI_TIAN,this,this.onKuaTianEvt);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){this.tarenModel.off(activitytaren.ActivityTaRenModel.ACTIVIT_TAREN_EVENT.GET_MAIN_PANEL_INFO,this,this.onGetMainPanel);this.tarenModel.off(activitytaren.ActivityTaRenModel.ACTIVIT_TAREN_EVENT.UPDATE_ACTIVIT_DATA,this,this.onGetMainPanel);game.RoleModel.getIns().off(game.RoleModel.EVENTS.KUAI_TIAN,this,this.onKuaTianEvt);this.timec.stop()};e.prototype.refreshAll=function(){this.timec.start(this.actVo.timeVo.endTime);var t=this.actVo.curCfg;this.shangditu.skin=t.cp1;this.liebiao.array=this.newscModel.sortList(this.actVo)};e.prototype.endHandler=function(){this.daojishilab.text="";this.timec.stop()};e.prototype.onRenderHander=function(t,e){t.setData(t.dataSource,this.actVo)};e.prototype.onKuaTianEvt=function(){activitytaren.ActivityTaRenModel.getIns().getInfoByActID(this.actVo.actid,new Laya.Handler(this,this.onGetMainPanel))};e.prototype.onGetMainPanel=function(){this.callLater(this.refreshAll)};e.SINGLE_KEY="qiYu.QiYuGiftView";return e}(ui.huanlingjieui.huanlingjieview3UI);i.QiYuGiftView=t})(qiYu||(qiYu={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var qiYu;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.listdaoju.itemRender=grids.GridView;this.listdaoju.renderHandler=grids.GridView.CommonItemRender;this.model=i.QiYuModel.getIns();this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){this.cfg=t;this.labelpaiming.text=app.getLang("ttg_tips4",this.model.getRankLabel(t));var e=game.ItemUtil.parserList(t.reward);var i=e.length*(98+this.listdaoju.spaceX);this.listdaoju.x=this.width-i*this.listdaoju.scaleX-20;this.listdaoju.width=i;this.listdaoju.array=e};e.SINGLE_KEY="qiYu.QiYuRankRewardItem";return e}(ui.huanlingjieui.hljpaihangjiangliitemUI);i.QiYuRankRewardItem=t})(qiYu||(qiYu={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var qiYu;(function(i){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.curType=rank.RankModel.TYPE_ENUM.QIYU_RANK;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.model=i.QiYuModel.getIns();this._rankmodel=rank.RankModel.getIns();this.listpaiming.itemRender=i.QiYuRankRewardItem;this.listpaiming.renderHandler=new Laya.Handler(this,this.renderHandler);this.listdaoju.itemRender=grids.GridView;this.listdaoju.renderHandler=grids.GridView.CommonItemRender;this.activityTimeView=new activitytaren.ActivityTimeView(this.labeltishi,new Laya.Handler(this,this.endTimeCallBack),"qiyu_tips1")};t.prototype.onDisplay=function(){this._rankmodel.on(rank.RankModel.RANK_DATA_CHANGE,this,this.onDataChange);this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){this._rankmodel.off(rank.RankModel.RANK_DATA_CHANGE,this,this.onDataChange)};t.prototype.refreshAll=function(){app.ProtocolRequest.GetRankListReq(this.curType);var t=i.QiYuModel.getIns().getOpenActVo();var e=t?t.timeVo.endTime:0;this.activityTimeView.start(e)};t.prototype.endTimeCallBack=function(){this.activityTimeView.stop();this.labeltishi.text=""};t.prototype.renderHandler=function(t,e){t.setData(t.dataSource)};t.prototype.onDataChange=function(){this.labeltishi.text=app.getLang("qiyu_tips1");var t=rank.RankModel.getIns().getRankInfo(this.curType);var e=[];if(t.rank==0){this.labeljifenjianglicishu.text=app.getLang("paihang_txt01");this.labelcishunum.text="";this.listdaoju.array=e}else{this.labeljifenjianglicishu.text=app.getLang("ttg_tips5");this.labelcishunum.text=t.rank.toString();e=game.ItemUtil.parserList(this.model.getMyReward(t.rank));this.listdaoju.array=e}var i=e.length*(98+this.listdaoju.spaceX);this.listdaoju.x=this.width-i*this.listdaoju.scaleX-100;this.listdaoju.width=i;this.listpaiming.array=csv.QiYuPaiHangBangProxy.getIns().getCfgArr()};t.SINGLE_KEY="qiYu.QiYuRankRewardView";return t}(ui.huanlingjieui.hljpaihangjiangliUI);i.QiYuRankRewardView=t})(qiYu||(qiYu={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var qiYu;(function(t){var i=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.control=new rank.RankItemNewControl;this.control.setSkin(this)};return e}(ui.huanlingjieui.hljpaihangbangitemUI);var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.rankControl=new rank.RankControl;this.rankControl.setSkin(this,i,rank.RankModel.TYPE_ENUM.TONGTIAN_GE_PAIHANG);this.jianglibtn.clickHandler=new Laya.Handler(this,this.onJiangliHandler)};e.prototype.onJiangliHandler=function(){app.ViewManager.toggleDialog(tongtiange.TongTiangePaiHangJiangliView,1,0)};e.SINGLE_KEY="qiYu.QiYuRankView";return e}(ui.huanlingjieui.huanlingjieview4UI);t.QiYuRankView=e})(qiYu||(qiYu={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var qiYu;(function(p){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.listCustom=new list.JListCustom;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};t.prototype.onDisplay=function(){this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){this.listCustom.clear()};t.prototype.refreshAll=function(){var t=p.QiYuModel.getIns().getOpenActid();if(t==0){return}var e=[];var i=csv.QiYuPoolProxy.getIns().getPoolIds(1);this.listCustom.init(this.jiemian);this.listCustom.clear();for(var n=0;n<i.length;n++){e=csv.QiYuPoolProxy.getIns().getCfgMapList(i[n],t);var a=[];var o=0;for(var s=0;s<e.length;s++){a.push(e[s].itme);o=e[s].probability}var r=[app.getLang("qiyuname_grade"+i[n],o+"%")];this.listCustom.split(r,u,46);this.listCustom.split(a,c,170,0,3)}this.listCustom.end();var l=csv.QiYuGaChaProxy.getIns().getCfg(1,t);var h=l.gachalimit;this.cishilab.text=app.getLang("qiyutansuo_06",p.QiYuModel.getIns().playerData.todayDraw,h)};t.SINGLE_KEY="qiYu.QiYuRewardPreView";return t}(ui.huanlingjieui.hljjiangliyulanUI);p.QiYuRewardPreView=t;var u=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.clsKey="ui.huanlingjieui.hljjiangliyulanitem2UI";return t}t.prototype.createNode=function(t){var e=Laya.Pool.getItemByClass(this.clsKey,ui.tongtiangeui.ttgjiangliyulanitem2UI);e.x=t*e.width;e.y=this.y;e.zi.text=this.list[t];return e};return t}(list.RowMoveBaseNode);var c=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.clsKey="ui.huanlingjieui.hljjiangliyulanitemUI";return t}t.prototype.createNode=function(t){var e=Laya.Pool.getItemByClass(this.clsKey,ui.huanlingjieui.hljjiangliyulanitemUI);var i=this.list[t].split("-");var n=game.ItemUtil.createVO(parseInt(i[0]));e.x=t*e.width;e.y=this.y;n.setCount(parseInt(i[1]));e.daojuegezi.setData(n);e.daojuname.text=n.getHTMLName();return e};return t}(list.RowMoveBaseNode)})(qiYu||(qiYu={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var question;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){app.ViewManager.regist(i.QuestionView);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.QUESTION,i.QuestionView,undefined,0);csv.MainIconProxy.getIns().registerCheckHandler(csv.MainIconProxy.TYPE_ICON_QUESTION,new Laya.Handler(this,this.onCheckMainDlgHandler));game.Context.on(game.ContextEvent.MAINDLG_OPEN,this,this.onMaindlgOpenOrClose)};e.prototype.onMaindlgOpenOrClose=function(t){if(t==csv.MainIconProxy.TYPE_ICON_QUESTION){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.QUESTION)}};Object.defineProperty(e.prototype,"model",{get:function(){return i.QuestionModel.getIns()},enumerable:true,configurable:true});e.prototype.onAskAwardNtf=function(t,e){this.model.isLingqu=e.askaward.indexOf(this.model.wenjuantime)!=-1;this.model.event(i.QuestionModel.EVENT_UPDATE_VIEW)};e.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.AskAwardNtf,this,this.onAskAwardNtf)};e.prototype.onCheckMainDlgHandler=function(){return i.QuestionModel.getIns().isActivate&&i.QuestionModel.getIns().isShow};e.SINGLE_KEY="question.QuestionModule";return e}(app.ModuleBase);i.QuestionModule=t})(question||(question={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var question;(function(t){var e=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.isLingqu=false;t.isClickWebLink=false;t._isShow=true;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.init=function(){};t.prototype.setShow=function(t){this._isShow=t;main.RightTopIconList.getIns().refreshAll()};Object.defineProperty(t.prototype,"isShow",{get:function(){return this._isShow},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"isActivate",{get:function(){if(game.Context.disableIosRecharge()){return false}if(this.isLingqu){return false}if(this.webCfg&&this.webCfg.wenjuan&&this.webCfg.wenjuantime){return true}return false},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"webCfg",{get:function(){return game.Context.webCfg},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"wenjuantime",{get:function(){if(this.webCfg){var t=this.webCfg.wenjuantime||"";if(t.length>0){return parseInt(t)}}return 0},enumerable:true,configurable:true});t.SINGLE_KEY="question.QuestionModel";t.EVENT_UPDATE_VIEW="EVENT_UPDATE_VIEW";return t}(app.ModelBase);t.QuestionModel=e})(question||(question={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var question;(function(a){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listdaoju.itemRender=grids.GridView;this.listdaoju.renderHandler=grids.GridView.CommonItemRender;this.quedingbtn.clickHandler=new Laya.Handler(this,this.onClickHandler)};Object.defineProperty(e.prototype,"model",{get:function(){return a.QuestionModel.getIns()},enumerable:true,configurable:true});e.prototype.onClickHandler=function(){if(a.QuestionModel.getIns().isClickWebLink){this.close();a.QuestionModel.getIns().setShow(false);app.ProtocolRequest.AskAwardReq(this.model.wenjuantime)}else{app.SDK.openLink(game.Context.webCfg.wenjuan);a.QuestionModel.getIns().isClickWebLink=true;this.onRefreshHandler()}};e.prototype.onRefreshHandler=function(){if(!a.QuestionModel.getIns().isLingqu&&a.QuestionModel.getIns().isClickWebLink){this.quedingbtn.label=app.getLang("lingqujiangli")}else{this.quedingbtn.label=app.getLang("button_name8")}};e.prototype.onDisplay=function(){a.QuestionModel.getIns().on(a.QuestionModel.EVENT_UPDATE_VIEW,this,this.onRefreshHandler);var t="";for(var e=0;e<5;e++){var i=game.Config.getParams(806+e);t+=i+";"}if(t.length>0){t=t.substr(0,t.length-1)}var n=game.ItemUtil.parserList(t);this.listdaoju.array=game.ItemUtil.hebingItems(n);this.label02.text=app.getLang("questionnaire");this.onRefreshHandler()};e.prototype.onUnDisplay=function(){a.QuestionModel.getIns().off(a.QuestionModel.EVENT_UPDATE_VIEW,this,this.onRefreshHandler)};e.SINGLE_KEY="question.QuestionView";return e}(ui.wenjuandiaocha.wenjuandiaochatipUI);a.QuestionView=t})(question||(question={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var rank;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){app.ViewManager.regist(i.NormalRankView,"paihangbang.atlas");app.ViewManager.regist(i.ArenaView,"paihangbang.atlas");game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.ARENA,i.ArenaView);app.ViewManager.regist(i.RankLevelView,"paihangbang.atlas");game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.RANK_LEVEL,i.RankLevelView);app.ViewManager.regist(i.RankPetView,"paihangbang.atlas");game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.PET_RANK,i.RankPetView);app.ViewManager.regist(i.RankFabaoView,"paihangbang.atlas");game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.FABAO_RANK,i.RankFabaoView);app.ViewManager.regist(i.RankYuanShengView,"paihangbang.atlas");game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.YUANSHEN_RANK,i.RankYuanShengView);app.ViewManager.regist(i.RankScoreView,"paihangbang.atlas");game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.SCORE_RANK,i.RankScoreView);app.ViewManager.regist(i.RankMountView,"paihangbang.atlas");game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.RANK_MOUNT,i.RankMountView);app.ViewManager.regist(i.RankEquipZplusView,"paihangbang.atlas");game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.EQUIP_RANK,i.RankEquipZplusView);app.ViewManager.regist(i.RankEquipZplusView,"paihangbang.atlas");game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.GUANKA_RANK,i.RankGuankaView);app.ViewManager.regist(i.KuafuRankView,"paihangbang.atlas","kuafuzhengba.atlas");game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.KUAFU_RANK,i.KuafuRankView);this._model=i.RankModel.getIns()};e.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.GetRankListResp,this,this.onGetRankListResp);this.addMsgListener(app.ProtocolResponse.RankShowPlayerResp,this,this.onRankShowPlayerResp);game.FuncDotAdapter.registRedFunc(csv.FunctionsProxy.ENUMS.ARENA,this._model,this._model.updataArenaRed);boss.BossModel.getIns().on(boss.BossEvent.BOSS_DAILY_TIME_CHANGE,this._model,this._model.updataArenaRed)};e.prototype.onGetRankListResp=function(t,e){this._model.dellRankInfo(e)};e.prototype.onRankShowPlayerResp=function(t,e){this._model.storeFirstPlayerData(e)};e.SINGLE_KEY="rank.RankModule";return e}(app.ModuleBase);i.RankModule=t})(rank||(rank={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var rank;(function(o){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.btnqiecuo.on(Laya.Event.CLICK,this,this.onQiecuo);this.on(Laya.Event.CLICK,this,this.onClick)};e.prototype.onClick=function(t){t.stopPropagation();if(!Uint64.equal(this.dataSource.uid,game.Context.mainRoleId)){rank.RankModel.showAreaBtnList(this.dataSource.uid,this.dataSource.name,this.dataSource.totallv,this.dataSource.classskin,this.dataSource.headframeId)}else{if(app.ViewManager.DisplayedInStage(friend.HaoYouCaiDanView.SINGLE_KEY)){app.ViewManager.toggleView(friend.HaoYouCaiDanView,app.AppContainer.flowLayer,-1)}}};e.prototype.onQiecuo=function(t){t.stopPropagation();if(battle.BattleModel.getIns().checkBattleState(true)){return}if(dailytask.DailyTimeUtil.checkTime(csv.DailyTimeProxy.ENUM_TYPE.QIE_CUO,true)){app.ProtocolRequest.ChargeArenaReq(this.dataSource.uid)}};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){var e=o.RankModel.getIns().getRankNum(o.RankModel.TYPE_ENUM.ENMRANKTYPE_PK,t.uid);this.imgtouxian.skin=csv.TitleProxy.getIns().getNobleSkin(t.headtitle);if(Uint64.equal(t.uid,game.Context.mainRoleId)){this.btnqiecuo.visible=false;this.labelqiecuonum.text="";this.labeljifennum.color=this.labelpaiming.color=this.labelname.color=game.STYLES.YELLOW_COLOR_S}else{this.labeljifennum.color=this.labelpaiming.color=this.labelname.color=game.STYLES.DESC_TXT_COLOR_S;this.btnqiecuo.visible=true;var i=o.RankModel.getIns().getRankInfo(o.RankModel.TYPE_ENUM.ENMRANKTYPE_PK);var n=i.rank;if(n==0){if(e>i.rankList.length-2){this.labelqiecuonum.text=app.getLang("胜利+{0}分",game.Config.getIntParams(o.RankModel.UP_ONE))}else{this.btnqiecuo.visible=false;this.labelqiecuonum.text=""}}else{var a=n-e;if(a==2){this.labelqiecuonum.text=app.getLang("胜利+{0}分",game.Config.getIntParams(o.RankModel.UP_TWO))}else if(a==1){this.labelqiecuonum.text=app.getLang("胜利+{0}分",game.Config.getIntParams(o.RankModel.UP_ONE))}else if(a==-1){this.labelqiecuonum.text=app.getLang("胜利+{0}分",game.Config.getIntParams(o.RankModel.DOWN_ONE))}else if(a==-2){this.labelqiecuonum.text=app.getLang("胜利+{0}分",game.Config.getIntParams(o.RankModel.DOWN_TWO))}else{this.btnqiecuo.visible=false;this.labelqiecuonum.text=""}}}this.labelpaiming.text=e+"";this.labelname.text=game.Context.clearPlayerName(t.name);this.labeljifennum.text=app.getLang("{0}分",t.value.toNumber())};e.SINGLE_KEY="rank.ArenaItem";return e}(ui.paihangbang.qiecuopaihangbangitemUI);o.ArenaItem=t})(rank||(rank={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var rank;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listdaoju.itemRender=grids.GridView;this.listdaoju.renderHandler=grids.GridView.CommonItemRender};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){var e=parseInt(t.rankmin);var i=parseInt(t.rankmax);if(e==i){this.labelpaiming.text=app.getLang("第{0}名",e)}else{this.labelpaiming.text=app.getLang("第{0}——{1}名",e,i)}this.listdaoju.array=game.ItemUtil.parserList(t.award);this.imgchenghao.skin=csv.TitleProxy.getIns().getTitleUrl(t.title)};e.SINGLE_KEY="rank.ArenaRewardItem";return e}(ui.paihangbang.paimingjiangliitemUI);t.ArenaRewardItem=e})(rank||(rank={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var rank;(function(n){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listpaiming.itemRender=n.ArenaRewardItem;this.listpaiming.renderHandler=new Laya.Handler(this,this.onRender);this.listdaoju.itemRender=grids.GridView;this.listdaoju.renderHandler=grids.GridView.CommonItemRender};e.prototype.onRender=function(t,e){t.setData(t.dataSource)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){var t=csv.RankProxy.getIns().getArr();this.listpaiming.array=t;var e=n.RankModel.getIns().getRankNum(n.RankModel.TYPE_ENUM.ENMRANKTYPE_PK,game.Context.mainRoleId);var i=csv.RankProxy.getIns().getCfgByRank(e);if(i){this.labelcishunum.text=e+"";this.listdaoju.array=game.ItemUtil.parserList(i.award)}else{this.labelcishunum.text=app.getLang("未上榜");this.listdaoju.array=[]}};e.SINGLE_KEY="rank.ArenaRewardView";return e}(ui.paihangbang.paimingjiangliviewUI);n.ArenaRewardView=t})(rank||(rank={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var rank;(function(n){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){if(t instanceof RankData){var e=n.RankModel.getIns().getRankNum(n.RankModel.TYPE_ENUM.ENMRANKTYPE_PK,t.uid);this.imgpaiming.skin="paihangbang/bg_paiming_"+e+".png";this.labelname.text=game.Context.clearPlayerName(t.name)+app.getLang("({0}分)",t.value.toNumber());this.itemtouxiang.setData(t.uid,t.name,t.simpleteamavatar,t.headframeId);this.imgtouxian.skin=csv.TitleProxy.getIns().getNobleSkin(t.headtitle);if(this.imgtouxian.skin==""){this.labelname.centerX=0}else{var i=(this.width-this.imgtouxian.width-this.labelname.width)/2;this.imgtouxian.x=i;this.labelname.x=i+this.imgtouxian.width}}else{this.imgpaiming.skin="paihangbang/bg_paiming_"+t+".png";this.labelname.text=app.getLang("虚位以待");this.itemtouxiang.imgtouxiang.skin="";this.imgtouxian.skin="";this.itemtouxiang.imgframe.skin="";this.labelname.centerX=0}};e.SINGLE_KEY="rank.ArenaTopItem";return e}(ui.paihangbang.paihangbangmingciitemUI);n.ArenaTopItem=t})(rank||(rank={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var rank;(function(s){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listpaihangbang.itemRender=s.ArenaItem;this.listpaihangbang.renderHandler=new Laya.Handler(this,this.onRender);this.listpaihangbang.repeatY=5;this.listwanjia.itemRender=s.ArenaTopItem;this.listwanjia.renderHandler=new Laya.Handler(this,this.onTopRender);this.btnadd.on(Laya.Event.CLICK,this,this.onAdd);this.btnpaimingjiangli.on(Laya.Event.CLICK,this,this.onJiangli);this._model=s.RankModel.getIns()};e.prototype.onRender=function(t,e){t.setData(t.dataSource)};e.prototype.onTopRender=function(t,e){t.setData(t.dataSource)};e.prototype.onAdd=function(){dailytask.DailyTimeUtil.buyTime(csv.DailyTimeProxy.ENUM_TYPE.QIE_CUO)};e.prototype.onJiangli=function(){app.ViewManager.toggleDialog(s.ArenaRewardView,1,0)};e.prototype.onDisplay=function(){app.ProtocolRequest.GetRankListReq(s.RankModel.TYPE_ENUM.ENMRANKTYPE_PK);boss.BossModel.getIns().on(boss.BossEvent.BOSS_DAILY_TIME_CHANGE,this,this.setDailyTime);this._model.on(s.RankModel.RANK_DATA_CHANGE,this,this.onDataChange);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){this._model.clearArenaRed();boss.BossModel.getIns().off(boss.BossEvent.BOSS_DAILY_TIME_CHANGE,this,this.setDailyTime);this._model.off(s.RankModel.RANK_DATA_CHANGE,this,this.onDataChange)};e.prototype.onDataChange=function(t){if(t==s.RankModel.TYPE_ENUM.ENMRANKTYPE_PK){this.refreshAll()}};e.prototype.refreshAll=function(){var t=this._model.getRankInfo(s.RankModel.TYPE_ENUM.ENMRANKTYPE_PK);if(!t){return}var e=0;var i=t.rankList.length;if(t.rank==0){e=i-1}else{e=t.rank-3;if(e<0){e=0}}this.listpaihangbang.array=t.rankList;this.listpaihangbang.scrollTo(e);var n=t.rankList[0];if(n){this.labelname.text=game.Context.clearPlayerName(n.name);this.labeljifen.text=n.value.toNumber()+app.getLang("分");this.itemtouxiang.setData(n.uid,n.name,n.simpleteamavatar,n.headframeId);this.imgtouxian.skin=csv.TitleProxy.getIns().getNobleSkin(n.headtitle);this.imgTitle.skin=csv.TitleProxy.getIns().getRankTitleUrl(s.RankModel.TYPE_ENUM.ENMRANKTYPE_PK)}var a=[];for(var o=1;o<5;o++){if(t.rankList[o]){a.push(t.rankList[o])}else{a.push(o+1)}}this.listwanjia.array=a;this.setDailyTime();this.labeljifen02.text=t.rankValue.toNumber()+""};e.prototype.setDailyTime=function(){var t=csv.DailyTimeProxy.ENUM_TYPE.QIE_CUO;var e=boss.BossModel.getIns().getDailyTime(t);var i=e.fnum+e.gnum;var n=csv.DailyTimeProxy.getIns().getCfg(t);var a=parseInt(n.time);this.labelcishunum.text=i+"/"+a;if(i>0){game.RedDotView.addTo(this.imgjifencishu)}else{game.RedDotView.removeFrom(this.imgjifencishu)}};e.SINGLE_KEY="rank.ArenaView";return e}(ui.paihangbang.qiecuopaihangbangUI);s.ArenaView=t})(rank||(rank={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var rank;(function(t){var e=function(e){__extends(u,e);function u(){var t=e!==null&&e.apply(this,arguments)||this;t._rankMap={};t._rankListMap={};t._firstPlayerMap={};t.boFirst=true;return t}u.getRankBgUrl=function(t){if(t==1){return"res/static/common/bg_jiugong_jin.png"}else if(t==2){return"res/static/common/bg_jiugong_yin.png"}else if(t==3){return"res/static/common/bg_jiugong_tong.png"}return"public/bg_jiugong_04new.png"};u.getRankValueDes=function(t,e,i){if(i===void 0){i=false}var n="";switch(t){case u.TYPE_ENUM.ENMRANKTYPE_MOUNTAIN:var a=csv.MountainProxy.getIns().getCfg(e.getHigh());if(a){n=app.getLang(a.towername)}break;case u.TYPE_ENUM.ENMRANKTYPE_ELITE:n=app.getLang("elitechallenge_des5",e.toNumber());break;case u.TYPE_ENUM.ENMRANKTYPE_YUANSHEN:var o=csv.YuanshenProxy.getIns().getXiulianCfgItem(e.toNumber());if(o){var s=yuanshencode.YuanshenModel.getIns().getBigRealm(o.bigrealm);var r=yuanshencode.YuanshenModel.getIns().getSamllRealm(o.smallrealm);var l=yuanshencode.YuanshenModel.getIns().getChineseNum(o.section);if(o.bigrealm==1){n=s+l+"重"}else{n=s+r+l+"重"}}break;case u.TYPE_ENUM.ENMRANKTYPE_GUANKA:var h=csv.GuajiProxy.getIns().getCfgGuanqia(e.toNumber());if(h){var p=csv.GuajiProxy.getIns().getPart(h.id);n=h.chapter+"-"+p.index}break;default:if(i){n=game.MoneyModel.format(e.toNumber())+""}else{n=e.toNumber().toString()}}return n};u.showNormalRankView=function(t){app.ProtocolRequest.GetRankListReq(t);app.ViewManager.toggleDialog(rank.NormalRankView,1,0,t)};u.showRankBtnList=function(t,e,i,n,a){var o=friend.FriendModel.getCommonTypeArr(t);friend.FriendModel.getIns().setFriendMenu(o,t,e,i,n,a)};u.showKuafuList=function(t,e,i,n,a){var o=[];o.push(friend.FriendConst.MENU.chakan);o.push(friend.FriendConst.MENU.qiecuo);friend.FriendModel.getIns().setFriendMenu(o,t,e,i,n,a)};u.showAreaBtnList=function(t,e,i,n,a){var o=friend.FriendModel.getCommonTypeArr(t);friend.FriendModel.getIns().setFriendMenu(o,t,e,i,n,a)};u.getIns=function(){return app.Singleton.getInstance(u)};u.prototype.init=function(){};u.prototype.dellRankInfo=function(t){this._rankMap[t.type]=t;for(var e=0,i=t.rankList.length;e<i;e++){var n=t.rankList[e];if(!this._rankListMap[t.type]){this._rankListMap[t.type]={}}this._rankListMap[t.type][n.uid.toString()]={rank:e+1,classskin:n.classskin}}this.event(u.RANK_DATA_CHANGE,t.type)};u.prototype.getRankInfo=function(t){return this._rankMap[t]};u.prototype.getRankLabel=function(t,e){if(e===void 0){e=false}switch(t){case u.TYPE_ENUM.ENMRANKTYPE_LEVEL:return app.getLang("paihang_txt02");case u.TYPE_ENUM.ENMRANKTYPE_EQUIP_ZPLUS:return app.getLang("paihang_txt03");case u.TYPE_ENUM.ENMRANKTYPE_PET:return app.getLang("paihang_txt04");case u.TYPE_ENUM.ENMRANKTYPE_FA_BAO:return app.getLang("paihang_txt05");case u.TYPE_ENUM.ENMRANKTYPE_YUANSHEN:if(e){return app.getLang("paihang_txt06")}return app.getLang("");case u.TYPE_ENUM.ENMRANKTYPE_FIGHT:return app.getLang("paihang_txt07");case u.TYPE_ENUM.ENMRANKTYPE_MOUNT:return app.getLang("paihang_txt09");case u.TYPE_ENUM.ENMRANKTYPE_GUANKA:return app.getLang("paihang_txt10");case u.TYPE_ENUM.GUILD_BOSS:return app.getLang("guild_boss_rank_desc1")}return app.getLang("paihang_txt"+t)};u.prototype.getTiShi=function(t){switch(t){case u.TYPE_ENUM.ENMRANKTYPE_LEVEL:return app.getLang("rankingdesc_1");case u.TYPE_ENUM.ENMRANKTYPE_EQUIP_ZPLUS:return app.getLang("rankingdesc_2");case u.TYPE_ENUM.ENMRANKTYPE_PET:return app.getLang("rankingdesc_3");case u.TYPE_ENUM.ENMRANKTYPE_FA_BAO:return app.getLang("rankingdesc_4");case u.TYPE_ENUM.ENMRANKTYPE_YUANSHEN:return app.getLang("rankingdesc_5");case u.TYPE_ENUM.ENMRANKTYPE_FIGHT:return app.getLang("rankingdesc_6")}return"类型:"+t.toString()};u.prototype.getRankNum=function(t,e){if(this._rankListMap[t]&&this._rankListMap[t][e.toString()]){return this._rankListMap[t][e.toString()].rank}return 0};u.prototype.storeFirstPlayerData=function(t){this._firstPlayerMap[t.type]=t.data;this.event(u.RANK_FIRST_CHANGE,t.type)};u.prototype.getRankShowPlayerData=function(t){return this._firstPlayerMap[t]};u.prototype.getRankShowPlayerProf=function(t,e){if(this._rankListMap[t]&&this._rankListMap[t][e.toString()]){return this._rankListMap[t][e.toString()].classskin}return 1};u.prototype.updataArenaRed=function(){var t=csv.DailyTimeProxy.ENUM_TYPE.QIE_CUO;if(this.boFirst){var e=boss.BossModel.getIns().getDailyTime(t);var i=e.fnum+e.gnum;if(e&&i>0){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.ARENA)}else{game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.ARENA)}}else{game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.ARENA)}};u.prototype.clearArenaRed=function(){this.boFirst=false;game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.ARENA)};u.SINGLE_KEY="rank.RankModel";u.RANK_DATA_CHANGE="rank_data_change";u.RANK_FIRST_CHANGE="rank_first_change";u.TYPE_ENUM={ENMRANKTYPE_FIGHT:1,ENMRANKTYPE_LEVEL:2,ENMRANKTYPE_ELITE:3,ENMRANKTYPE_ACHIEVE:4,ENMRANKTYPE_PK:5,ENMRANKTYPE_SKILLV:6,ENMRANKTYPE_JJC:7,ENMRANKTYPE_JJCYET:8,ENMRANKTYPE_MOUNTAIN:9,ENMRANKTYPE_EQUIP_ZPLUS:11,ENMRANKTYPE_FA_BAO:12,ENMRANKTYPE_ZHAN_LING:13,ENMRANKTYPE_PET:14,ENMRANKTYPE_YUANSHEN:15,ENMRANKTYPE_ZJQW:16,ENMRANKTYPE_MOUNT:17,ENMRANKTYPE_TANBAO:19,ENMRANKTYPE_SHHL:20,ENMRANKTYPE_SHHL_S:21,ENMRANKTYPE_JJC_NEW:22,GUILD_BOSS:23,ENMRANKTYPE_GUANKA:24,ENMRANKTYPE_KUAFU:25,ENMRANKTYPE_KUAFU_SELF:26,TONGTIAN_GE_PAIHANG:27,YI_SHOU_RU_QING:28,QIYU_RANK:28};u.UP_TWO=256;u.UP_ONE=257;u.DOWN_ONE=258;u.DOWN_TWO=259;return u}(app.ModelBase);t.RankModel=e})(rank||(rank={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("vsranking_award.csv");this.cfgMap=t.getMap("rankmin");this.cfgArr=t.getArray();var e=app.Config.getResById("ranking.csv");this.jjcMap=e.getMap("rank");this.jjcArr=e.getArray();var i=app.Config.getResById("rankingaward.csv");this.jjcRwdMap=i.getMap("id");this.jjcRwdArr=i.getArray();var n=app.Config.getResById("kuafu_rank.csv");this.kuafuRwdMap=n.getMapList("type")};e.prototype.getCfg=function(t){return this.cfgMap[t]};e.prototype.getArr=function(){return this.cfgArr};e.prototype.getCfgByRank=function(t){var e;for(var i=0,n=this.cfgArr.length;i<n;i++){var a=this.cfgArr[i];var o=parseInt(a.rankmin);var s=parseInt(a.rankmax);if(t>=o&&t<=s){e=a;break}}return e};e.prototype.getKuafuAwd=function(t){return this.kuafuRwdMap[t]};e.SINGLE_KEY="csv.RankProxy";return e}(app.ModelBase);t.RankProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var rank;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t,e){};e.prototype.recover=function(){Laya.Pool.recover(e.SINGLE_KEY,e)};e.SINGLE_KEY="rank.CommonRankCell";return e}(ui.paihangbang.tongyongpaihangbangitem02UI);t.CommonRankCell=e})(rank||(rank={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var rank;(function(n){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.on(Laya.Event.CLICK,this,this.onClick)};e.prototype.onClick=function(t){t.stopPropagation();if(!Uint64.equal(this.dataSource.uid,game.Context.mainRoleId)){rank.RankModel.showRankBtnList(this.dataSource.uid,this.dataSource.name,this.dataSource.totallv,this.dataSource.classskin,this.dataSource.headframeId)}else{if(app.ViewManager.DisplayedInStage(friend.HaoYouCaiDanView.SINGLE_KEY)){app.ViewManager.toggleView(friend.HaoYouCaiDanView,app.AppContainer.flowLayer,-1)}}};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t,e){var i=n.RankModel.getIns().getRankNum(e,t.uid);this.lapelpaiming.text=i+"";this.labelname.text=game.Context.clearPlayerName(t.name);if(Uint64.equal(t.uid,game.Context.mainRoleId)){this.lapelpaiming.color=this.labelname.color=this.labelduanwei.color=game.STYLES.YELLOW_COLOR_S}else{this.lapelpaiming.color=this.labelname.color=this.labelduanwei.color=game.STYLES.DESC_TXT_COLOR_S}this.labelduanwei.text=n.RankModel.getRankValueDes(e,t.value);this.imgbg.skin=n.RankModel.getRankBgUrl(i)};e.SINGLE_KEY="rank.NormalRankItem";return e}(ui.paihangbang.tongyongpaihangbangitem02UI);n.NormalRankItem=t})(rank||(rank={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var rank;(function(n){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.on(Laya.Event.CLICK,this,this.onClick)};e.prototype.onClick=function(t){t.stopPropagation();if(!Uint64.equal(this.dataSource.uid,game.Context.mainRoleId)){rank.RankModel.showRankBtnList(this.dataSource.uid,this.dataSource.name,this.dataSource.totallv,this.dataSource.classskin,this.dataSource.headframeId)}else{if(app.ViewManager.DisplayedInStage(friend.HaoYouCaiDanView.SINGLE_KEY)){app.ViewManager.toggleView(friend.HaoYouCaiDanView,app.AppContainer.flowLayer,-1)}}};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t,e){var i=n.RankModel.getIns().getRankNum(e,t.uid);this.labelname.text=game.Context.clearPlayerName(t.name);if(Uint64.equal(t.uid,game.Context.mainRoleId)){this.labelname.color=this.labelduanwei.color=game.STYLES.YELLOW_COLOR_S}else{this.labelname.color=this.labelduanwei.color=game.STYLES.DESC_TXT_COLOR_S}this.itemtouxiang.setData(t.uid,t.name,t.simpleteamavatar,t.headframeId);this.imgpaiming.skin="paihangbang/bg_paiming_"+i+".png";this.labelduanwei.text=n.RankModel.getRankValueDes(e,t.value);this.imgbg.skin=n.RankModel.getRankBgUrl(i)};e.SINGLE_KEY="rank.NormalRankTopItem";return e}(ui.paihangbang.tongyongpaihangbangitem01UI);n.NormalRankTopItem=t})(rank||(rank={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var rank;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=i.RankModel.getIns();this.listpaiming01.removeSelf();this.list=new Laya.MultiList;this.list.width=this.listpaiming01.width;this.list.height=this.listpaiming01.height;this.list.repeatX=1;this.addChild(this.list);this.list.vScrollBarSkin=" ";this.list.x=this.listpaiming01.x;this.list.y=this.listpaiming01.y;this.list.itemRender=i.NormalRankItem;this.list.setCustomItem(0,new i.NormalRankTopItem);this.list.setCustomItem(1,new i.NormalRankTopItem);this.list.setCustomItem(2,new i.NormalRankTopItem);this.list.renderHandler=new Laya.Handler(this,this.onRender)};e.prototype.onRender=function(t,e){t.setData(t.dataSource,this.dataSource)};e.prototype.onDisplay=function(){this._model.on(i.RankModel.RANK_DATA_CHANGE,this,this.onDataChange);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.onDataChange=function(t){if(t==this.dataSource){this.refreshAll()}};e.prototype.refreshAll=function(){var t=this._model.getRankInfo(this.dataSource);if(!t){this.list.array=[];return}this.list.array=t.rankList;this.labelwodepaimingnum.text=t.rank==0?app.getLang("未上榜"):app.getLang(t.rank);this.labelduanwei.text=i.RankModel.getRankValueDes(this.dataSource,t.rankValue)};e.SINGLE_KEY="rank.NormalRankView";return e}(ui.paihangbang.tongyongpaihangbangviewUI);i.NormalRankView=t})(rank||(rank={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var rank;(function(a){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t,e,i){this._vo=t;var n=e+1;this.labelnum.text=n.toString();if(t.name){this.labelname.text=t.name;this.labeljifen.text=a.RankModel.getRankValueDes(i,t.value,true)}else{this.labelname.text=app.getLang("kuafu_rank8");this.labeljifen.text=""}};e.SINGLE_KEY="rank.KuafuRankItem";return e}(ui.kuafupaihang.fuwuqipaihangitemUI);a.KuafuRankItem=t;var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.on(Laya.Event.CLICK,this,this.showMenu)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t,e,i){this._vo=t;var n=e+4;this.labelnum.text=n.toString();if(t){this.labelname.text=t.name;this.itemtouxiang.imgtouxiang.skin=csv.MyTeamProxy.getIns().getTeamIcon(t.simpleteamavatar);this.itemtouxiang.imgframe.skin=csv.HeadFrameProxy.getIns().getIcon(t.headframeId);this.labeljifen.text=a.RankModel.getRankValueDes(i,t.value,true);this.lblser.text=t.svrname}else{this.labelname.text=app.getLang("jingjichang11");this.itemtouxiang.imgtouxiang.skin=csv.MyTeamProxy.getIns().getDefaultTeamIcon();this.itemtouxiang.imgframe.skin="";this.labeljifen.text="";this.lblser.text=""}};e.prototype.showMenu=function(t){t.stopPropagation();if(this._vo){if(!Uint64.equal(this._vo.uid,game.Context.mainRoleId)){rank.RankModel.showKuafuList(this._vo.uid,this._vo.name,this._vo.teamlv,this._vo.classskin,this._vo.headframeId)}else{if(app.ViewManager.DisplayedInStage(friend.HaoYouCaiDanView.SINGLE_KEY)){app.ViewManager.toggleView(friend.HaoYouCaiDanView,app.AppContainer.flowLayer,-1)}}}};e.SINGLE_KEY="rank.KuafuSelfRankItem";return e}(ui.kuafupaihang.gerenpaihangitem01UI);a.KuafuSelfRankItem=e})(rank||(rank={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var rank;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.list.itemRender=grids.GridView;this.list.renderHandler=grids.GridView.CommonItemRender;this.centerLayout=new game.CenterLayoutMediator(this.list,this.boxliebiao,100,this.list.spaceX)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t,e,i){if(t){if(t.rank<=3){this.imgpaiming.visible=true;this.labelpaiming.visible=false;this.imgpaiming.skin="res/static/common/bg_paiming_jingjichang_"+t.rank+".png"}else{this.labelpaiming.visible=true;this.imgpaiming.visible=false;if(i){this.labelpaiming.text=e.rank+1+"-"+t.rank}else{this.labelpaiming.text=app.getLang("jingjichang08",e.rank)}}this.imgchenghao.skin=csv.TitleProxy.getIns().getBigTitleUrl(t.showtitle);this.centerLayout.array=game.ItemUtil.parserList(t.award);this.lblwu.visible=false}else{this.labelpaiming.visible=true;this.labelpaiming.text=app.getLang("kuafu_rank8");this.imgpaiming.visible=false;this.imgchenghao.skin="";this.centerLayout.array=[];this.lblwu.visible=true}};e.SINGLE_KEY="rank.KuafuRankRewardItem";return e}(ui.kuafupaihang.paihangjiangliitemUI);t.KuafuRankRewardItem=e})(rank||(rank={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var rank;(function(s){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.tabyeqian.on(Laya.Event.CHANGE,this,this.onShow);this.listjiangli.itemRender=s.KuafuRankRewardItem;this.listjiangli.renderHandler=new Laya.Handler(this,this.onRender)};e.prototype.onRender=function(t,e){t.setData(t.dataSource,this.listjiangli.array[e-1],this.listjiangli.array[e+1])};e.prototype.onShow=function(){if(this.tabyeqian.selectedIndex==0){this.fillServerRank()}else{this.fillSelfRank()}};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){if(this.dataSource[0]==s.RankModel.TYPE_ENUM.ENMRANKTYPE_KUAFU){this.tabyeqian.selectedIndex=0}else{this.tabyeqian.selectedIndex=1}this.onShow()};e.prototype.fillServerRank=function(){var t=csv.RankProxy.getIns().getKuafuAwd(1);this.listjiangli.array=t;var e=s.RankModel.getIns().getRankInfo(s.RankModel.TYPE_ENUM.ENMRANKTYPE_KUAFU);if(e&&e.rank){var i=void 0;var n=0;for(var a=0,o=t.length;a<o;a++){if(e.rank<=t[a].rank){i=t[a];n=a;break}}this.my.setData(i,this.listjiangli.array[n-1],this.listjiangli.array[n+1])}else{this.my.setData(null)}};e.prototype.fillSelfRank=function(){var t=csv.RankProxy.getIns().getKuafuAwd(2);this.listjiangli.array=t;var e=s.RankModel.getIns().getRankInfo(s.RankModel.TYPE_ENUM.ENMRANKTYPE_KUAFU_SELF);if(e&&e.rank){var i=void 0;var n=0;for(var a=0,o=t.length;a<o;a++){if(e.rank<=t[a].rank){i=t[a];n=a;break}}this.my.setData(i,this.listjiangli.array[n-1],this.listjiangli.array[n+1])}else{this.my.setData(null)}};e.SINGLE_KEY="rank.KuafuRankRewardView";return e}(ui.kuafupaihang.paihangjianglitipUI);s.KuafuRankRewardView=t})(rank||(rank={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var rank;(function(l){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=l.RankModel.getIns();this.listfuwuqi.itemRender=l.KuafuRankItem;this.listfuwuqi.renderHandler=new Laya.Handler(this,this.onServerPaihang);this.listpaihang.itemRender=l.KuafuSelfRankItem;this.listpaihang.renderHandler=new Laya.Handler(this,this.onSelfPaihang);this._topViewList=[];this._topViewList.push(new i(this.itemwanjia01));this._topViewList.push(new i(this.itemwanjia02));this._topViewList.push(new i(this.itemwanjia03));this.tabyeqian.on(Laya.Event.CHANGE,this,this.onShow);this.btnpaihangjiangli.clickHandler=new Laya.Handler(this,this.onAwardShow);this.btnpaihangjiangli2.clickHandler=new Laya.Handler(this,this.onAwardShow)};e.prototype.onServerPaihang=function(t,e){t.setData(t.dataSource,e,this.curRankType)};e.prototype.onSelfPaihang=function(t,e){t.setData(t.dataSource,e,this.curRankType)};e.prototype.onAwardShow=function(){app.ViewManager.toggleDialog(l.KuafuRankRewardView,1,0,[this.curRankType])};e.prototype.onShow=function(){if(this.tabyeqian.selectedIndex==0){this.curRankType=l.RankModel.TYPE_ENUM.ENMRANKTYPE_KUAFU;this.box1.visible=true;this.box2.visible=false;this.fillServerRank()}else{this.curRankType=l.RankModel.TYPE_ENUM.ENMRANKTYPE_KUAFU_SELF;this.box1.visible=false;this.box2.visible=true;this.fillSelfRank()}app.ProtocolRequest.GetRankListReq(this.curRankType)};e.prototype.onDisplay=function(){this._model.on(l.RankModel.RANK_DATA_CHANGE,this,this.onDataChange);this._model.on(l.RankModel.RANK_FIRST_CHANGE,this,this.updateTopListModel);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.onDataChange=function(t){if(t==this.curRankType){if(this.tabyeqian.selectedIndex==0){this.fillServerRank()}else{this.fillSelfRank()}}};e.prototype.refreshAll=function(){this.tabyeqian.selectedIndex=0;this.onShow()};e.prototype.fillServerRank=function(){var t=this._model.getRankInfo(this.curRankType);if(!t){this.listfuwuqi.array=[];this.labelname01.text=app.getLang("kuafu_rank9");this.labelname02.text=app.getLang("kuafu_rank9");this.labelnum01.text="";this.labelnum02.text="";this.labelname.text=""}else{this.labelnum01.text=t.rank==0?app.getLang("kuafu_rank8"):app.getLang(t.rank);this.labelnum02.text=l.RankModel.getRankValueDes(this.curRankType,t.rankValue,true);for(var e=0,i=t.rankList.length;e<i;e++){if(e+1!=t.rank){this.labelname02.text=t.rankList[e].name}else{this.labelname.text=t.rankList[e].name+app.getLang("kuafu_rank10");this.labelname01.text=t.rankList[e].name}}this.listfuwuqi.array=t.rankList;this.listfuwuqi.scrollTo(0)}};e.prototype.fillSelfRank=function(){var t=this._model.getRankInfo(this.curRankType);if(!t){this.listpaihang.array=[];this.itemtouxiang.imgtouxiang.skin=csv.MyTeamProxy.getIns().getTeamIcon(game.Context.teamAvatar);this.itemtouxiang.imgframe.skin=game.Context.mainRole.getHeadFrameUrl();this.labelwo01.text=app.getLang("kuafu_rank8");this.labelwo02.text=game.Context.mainRole.playername;this.labelwo04.text=game.Context.mainRole.svrname;this.labelwo03.text="";this.updateTopListModel()}else{this.labelwo01.text=t.rank==0?app.getLang("kuafu_rank8"):app.getLang(t.rank);this.labelwo02.text=game.Context.mainRole.playername;this.labelwo04.text=game.Context.mainRole.svrname;this.labelwo03.text=l.RankModel.getRankValueDes(this.curRankType,t.rankValue,true);this.itemtouxiang.imgtouxiang.skin=csv.MyTeamProxy.getIns().getTeamIcon(game.Context.teamAvatar);this.itemtouxiang.imgframe.skin=game.Context.mainRole.getHeadFrameUrl();var e=t.rankList.length;var i=3;var n=Math.min(i,e);var a=[];for(var o=0;o<n;o++){var s=t.rankList[o];a.push(s)}this.topArr=a;this.updateTopListModel();var r=[];for(var o=i;o<e;o++){var s=t.rankList[o];r.push(s)}for(var o=r.length;o<100-i;o++){r.push(null)}this.listpaihang.array=r;this.listpaihang.scrollTo(0)}};e.prototype.updateTopListModel=function(){var t=l.RankModel.getIns().getRankShowPlayerData(this.curRankType);for(var e=0;e<this._topViewList.length;e++){var i=void 0;if(this.topArr){i=this.topArr[e]}this._topViewList[e].setData(e+1,i,t?t[e]:undefined,this.curRankType)}};e.SINGLE_KEY="rank.KuafuRankView";return e}(ui.kuafupaihang.fuwuqipaihangviewUI);l.KuafuRankView=t;var i=function(){function t(t){this.skin=t}t.prototype.showMenu=function(t){t.stopPropagation();if(!Uint64.equal(this._vo.uid,game.Context.mainRoleId)){l.RankModel.showKuafuList(this._vo.uid,this._vo.name,this._vo.teamlv,this._vo.classskin,this._vo.headframeId)}else{if(app.ViewManager.DisplayedInStage(friend.HaoYouCaiDanView.SINGLE_KEY)){app.ViewManager.toggleView(friend.HaoYouCaiDanView,app.AppContainer.flowLayer,-1)}}};t.prototype.setData=function(t,e,i,n){this._vo=e;if(!this._shadows){this._shadows=new Laya.Image("res/assist/circle.png");this._shadows.anchorX=this._shadows.anchorY=.5}this.skin.spritejuese.addChild(this._shadows);this.skin.labelname.text="";this.skin.labeljifen.text="";this.skin.imgchenghao.skin="";this.skin.labelxuweiyidai.visible=false;if(e){this.skin.labelname.text=game.Context.getSerName(e.svrid)+e.name;this.skin.labeljifen.text=l.RankModel.getIns().getRankLabel(n)+" "+l.RankModel.getRankValueDes(n,e.value,true)}else{this.skin.labelxuweiyidai.visible=true}if(i){if(!this.roleAvatarDatas){this.roleAvatarDatas=new avatar.AvatarData;this.roleAvatars=new avatar.AvatarAnimation;this.roleAvatars.scaleX=1.5;this.roleAvatars.scaleY=1.5;this.roleAvatars.on(Laya.Event.CLICK,this,this.showMenu);this.skin.spritejuese.addChild(this.roleAvatars)}var a="";var o=i;var s=csv.SkinProxy.getIns().getCfg(o.fashion);if(s){a=s.modelres}else{if(o.setskin>0){a=csv.DefclassProxy.getIns().getCfg(o.setskin).model}else{a=csv.DefclassProxy.getIns().getCfg(e.classskin).model}}this.roleAvatarDatas.roleKey=a;this.roleAvatars.setAniData(this.roleAvatarDatas);this.roleAvatars.setAni(avatar.AvatarAnimation.ANI_ENUMS.IDLE,0);this.roleAvatars.play();this.roleAvatars.mouseEnabled=true;if(this.waitRoles){this.waitRoles.removeSelf();this.waitRoles=null}this.skin.imgchenghao.skin=csv.TitleProxy.getIns().getRankTitleUrl(n,t)}else{if(!this.waitRoles){this.waitRoles=new Laya.Image("res/static/wuxing/bg_wuxing_jianying.png");this.waitRoles.anchorX=.5;this.waitRoles.anchorY=1}if(this.roleAvatarDatas){this.roleAvatarDatas.roleKey="";this.roleAvatars.setAniData(this.roleAvatarDatas);this.roleAvatars.stop();this.roleAvatars.mouseEnabled=false}this.skin.spritejuese.addChild(this.waitRoles)}};return t}();l.KuafuTopRoleView=i})(rank||(rank={}));var rank;(function(l){var t=function(){function t(){}t.prototype.setSkin=function(t,e,i){this.skin=t;this.curRankType=i;this._model=l.RankModel.getIns();this.skin.on(Laya.Event.DISPLAY,this,this.onDisplay);this.skin.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.skin.listpaihang.itemRender=e;this.skin.listpaihang.renderHandler=new Laya.Handler(this,this.onListPaihang);this._topViewList=[];this._topViewList.push(new l.Paihangbangitem02ItemView(this.skin.itemwanjia02));this._topViewList.push(new l.Paihangbangitem02ItemView(this.skin.itemwanjia01));this._topViewList.push(new l.Paihangbangitem02ItemView(this.skin.itemwanjia03))};t.prototype.onDisplay=function(){this._model.on(l.RankModel.RANK_DATA_CHANGE,this,this.onDataChange);this._model.on(l.RankModel.RANK_FIRST_CHANGE,this,this.updateTopListModel);app.ProtocolRequest.GetRankListReq(this.curRankType);Laya.timer.callLater(this,this.refreshAll)};t.prototype.onListPaihang=function(t,e){t["control"].setData(t.dataSource,e,this.curRankType)};t.prototype.onDataChange=function(t){if(t==this.curRankType){this.refreshAll()}};t.prototype.updateTopListModel=function(){var t=l.RankModel.getIns().getRankShowPlayerData(this.curRankType);for(var e=0;e<this._topViewList.length;e++){var i=void 0;if(this.topArr){i=this.topArr[e]}this._topViewList[e].setData(e+1,i,t?t[e]:undefined,this.curRankType)}};t.prototype.refreshAll=function(){var t=this._model.getRankInfo(this.curRankType);this.skin.labeljifen.text=this._model.getRankLabel(this.curRankType,true);if(!t){this.skin.listpaihang.array=[];this.skin.itemtouxiang.visible=false;this.skin.labelwo01.visible=false;this.skin.labelwo02.text="";this.skin.labelwo03.text=""}else{this.skin.labelwo01.visible=true;this.skin.labelwo01.text=t.rank==0?app.getLang("paihang_txt01"):app.getLang(t.rank);this.skin.labelwo02.text=game.Context.clearPlayerName(game.Context.mainRole.playername);this.skin.labelwo03.text=l.RankModel.getRankValueDes(this.curRankType,t.rankValue,true);this.skin.itemtouxiang.visible=true;this.skin.itemtouxiang.imgtouxiang.skin=csv.MyTeamProxy.getIns().getTeamIcon(game.Context.teamAvatar);this.skin.itemtouxiang.imgframe.skin=game.Context.mainRole.getHeadFrameUrl();var e=t.rankList.length;var i=3;var n=Math.min(i,e);var a=[];for(var o=0;o<n;o++){var s=t.rankList[o];a.push(s)}this.topArr=a;this.updateTopListModel();var r=[];for(var o=i;o<e;o++){var s=t.rankList[o];r.push(s)}for(var o=r.length;o<100-i;o++){r.push(new RankData)}this.skin.listpaihang.array=r;this.skin.listpaihang.scrollTo(0)}};t.prototype.onUnDisplay=function(){};return t}();l.RankControl=t})(rank||(rank={}));var rank;(function(n){var t=function(){function t(){}t.prototype.setSkin=function(t){this.skin=t;this.skin.on(Laya.Event.DISPLAY,this,this.onDisplay);this.skin.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.skin.on(Laya.Event.CLICK,this,this.showMenu)};t.prototype.showMenu=function(t){t.stopPropagation();jjcnew.JingjiChangModel.getIns().showMenu(this._vo)};t.prototype.onDisplay=function(){Laya.timer.callLater(this,this.refreshAll)};t.prototype.onUnDisplay=function(){};t.prototype.setData=function(t,e,i){this._vo=t;this.skin.labelnum.text=(e+4).toString();if(t.name){this.skin.labelname.text=t.name;this.skin.itemtouxiang.imgtouxiang.skin=csv.MyTeamProxy.getIns().getTeamIcon(t.simpleteamavatar);this.skin.itemtouxiang.imgframe.skin=csv.HeadFrameProxy.getIns().getIcon(t.headframeId);this.skin.labeljifen.text=n.RankModel.getRankValueDes(i,t.value,true)}else{this.skin.labelname.text=app.getLang("jingjichang11");this.skin.itemtouxiang.imgtouxiang.skin=csv.MyTeamProxy.getIns().getDefaultTeamIcon();this.skin.itemtouxiang.imgframe.skin="";this.skin.labeljifen.text=""}};t.prototype.refreshAll=function(){};return t}();n.RankItemNewControl=t})(rank||(rank={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var rank;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}Object.defineProperty(e.prototype,"curRankType",{get:function(){return i.RankModel.TYPE_ENUM.ENMRANKTYPE_LEVEL},enumerable:true,configurable:true});return e}(i.RankViewNew);i.RankLevelView=t;var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}Object.defineProperty(e.prototype,"curRankType",{get:function(){return i.RankModel.TYPE_ENUM.ENMRANKTYPE_EQUIP_ZPLUS},enumerable:true,configurable:true});return e}(i.RankViewNew);i.RankEquipZplusView=e;var n=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}Object.defineProperty(e.prototype,"curRankType",{get:function(){return i.RankModel.TYPE_ENUM.ENMRANKTYPE_PET},enumerable:true,configurable:true});return e}(i.RankViewNew);i.RankPetView=n;var a=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}Object.defineProperty(e.prototype,"curRankType",{get:function(){return i.RankModel.TYPE_ENUM.ENMRANKTYPE_FA_BAO},enumerable:true,configurable:true});return e}(i.RankViewNew);i.RankFabaoView=a;var o=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}Object.defineProperty(e.prototype,"curRankType",{get:function(){return i.RankModel.TYPE_ENUM.ENMRANKTYPE_YUANSHEN},enumerable:true,configurable:true});return e}(i.RankViewNew);i.RankYuanShengView=o;var s=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}Object.defineProperty(e.prototype,"curRankType",{get:function(){return i.RankModel.TYPE_ENUM.ENMRANKTYPE_FIGHT},enumerable:true,configurable:true});return e}(i.RankViewNew);i.RankScoreView=s;var r=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}Object.defineProperty(e.prototype,"curRankType",{get:function(){return i.RankModel.TYPE_ENUM.ENMRANKTYPE_MOUNT},enumerable:true,configurable:true});return e}(i.RankViewNew);i.RankMountView=r;var l=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}Object.defineProperty(e.prototype,"curRankType",{get:function(){return i.RankModel.TYPE_ENUM.ENMRANKTYPE_GUANKA},enumerable:true,configurable:true});return e}(i.RankViewNew);i.RankGuankaView=l;var h=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}Object.defineProperty(e.prototype,"curRankType",{get:function(){return i.RankModel.TYPE_ENUM.GUILD_BOSS},enumerable:true,configurable:true});return e}(i.RankViewNew);i.GuildBossRankView=h})(rank||(rank={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var rank;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t,e,i,n){this.imgtouxiang.skin=csv.MyTeamProxy.getIns().getTeamIcon(i);this.imgframe.skin=csv.HeadFrameProxy.getIns().getIcon(n)};e.SINGLE_KEY="rank.RankRoleHeadView";return e}(ui.paihangbang.paihangbangtouxiangitemUI);t.RankRoleHeadView=e})(rank||(rank={}));var rank;(function(r){var t=function(){function t(t){this.skin=t}t.prototype.showMenu=function(t){t.stopPropagation();jjcnew.JingjiChangModel.getIns().showMenu(this._vo)};t.prototype.setData=function(t,e,i,n){this._vo=e;if(!this._shadows){this._shadows=new Laya.Image("res/assist/circle.png");this._shadows.anchorX=this._shadows.anchorY=.5}this.skin.spritejuese.addChild(this._shadows);this.skin.labelname.text="";this.skin.labeljifen.text="";this.skin.imgchenghao.skin="";this.skin.xuweilab.visible=false;if(e){this.skin.labelname.text=game.Context.clearPlayerName(e.name);this.skin.labeljifen.text=r.RankModel.getIns().getRankLabel(n)+" "+r.RankModel.getRankValueDes(n,e.value,true)}else{this.skin.xuweilab.visible=true}if(i){if(!this.roleAvatarDatas){this.roleAvatarDatas=new avatar.AvatarData;this.roleAvatars=new avatar.AvatarAnimation;this.roleAvatars.scaleX=1.5;this.roleAvatars.scaleY=1.5;this.roleAvatars.on(Laya.Event.CLICK,this,this.showMenu);this.skin.spritejuese.addChild(this.roleAvatars)}var a="";var o=i;var s=csv.SkinProxy.getIns().getCfg(o.fashion);if(s){a=s.modelres}else{if(o.setskin>0){a=csv.DefclassProxy.getIns().getCfg(o.setskin).model}else{a=csv.DefclassProxy.getIns().getCfg(e.classskin).model}}this.roleAvatarDatas.roleKey=a;this.roleAvatars.setAniData(this.roleAvatarDatas);this.roleAvatars.setAni(avatar.AvatarAnimation.ANI_ENUMS.IDLE,0);this.roleAvatars.play();this.roleAvatars.mouseEnabled=true;if(this.waitRoles){this.waitRoles.removeSelf();this.waitRoles=null}this.skin.imgchenghao.skin=csv.TitleProxy.getIns().getRankTitleUrl(n,t)}else{if(!this.waitRoles){this.waitRoles=new Laya.Image("res/static/wuxing/bg_wuxing_jianying.png");this.waitRoles.anchorX=.5;this.waitRoles.anchorY=1}if(this.roleAvatarDatas){this.roleAvatarDatas.roleKey="";this.roleAvatars.setAniData(this.roleAvatarDatas);this.roleAvatars.stop();this.roleAvatars.mouseEnabled=false}this.skin.spritejuese.addChild(this.waitRoles)}};return t}();r.Paihangbangitem02ItemView=t})(rank||(rank={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var renyichongzhi;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.REN_YI_CHONG_ZHI,i.RenYiChongZhiView,null,3)};e.prototype.initCommands=function(){};return e}(app.ModuleBase);i.RenYiChongZhiModule=t})(renyichongzhi||(renyichongzhi={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var renyichongzhi;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){};e.SINGLE_KEY="renyichongzhi.RenYiChongZhiModel";return e}(app.ModelBase);t.RenYiChongZhiModel=e})(renyichongzhi||(renyichongzhi={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var renyichongzhi;(function(t){var i=activitytaren.ActivityTaRenModel;var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listdaoju.itemRender=grids.GridView;this.listdaoju.renderHandler=grids.GridView.CommonItemRender;this.btnqianwangchongzhi.clickHandler=new Laya.Handler(this,this.onLingQuHandler);this.activityTimeView=new activitytaren.ActivityTimeView(this.labelmiaoshu2,new Laya.Handler(this,this.endTimeCallBack),"{0}");this.btnlingqu.clickHandler=new Laya.Handler(this,this.onChongZhiHandler)};e.prototype.onChongZhiHandler=function(){shop.ShopModel.getIns().openChongZhiShop()};e.prototype.endTimeCallBack=function(){this.hideSubTime()};e.prototype.hideSubTime=function(){this.activityTimeView.stop();this.labelmiaoshu2.text="";this.labelmiaoshu1.visible=false};e.prototype.onLingQuHandler=function(){i.getIns().lingQu(this.cfg.id,1,new Laya.Handler(this,this.onLingQuUpdateHandler))};e.prototype.onLingQuUpdateHandler=function(){this.onUpdateHander()};e.prototype.onDisplay=function(){i.getIns().on(i.ACTIVIT_TAREN_EVENT.GET_MAIN_PANEL_INFO,this,this.onGetMainPanel);this.callLater(this.onInitHandler)};e.prototype.onInitHandler=function(){if(this.functionid){this.onEndHandler()}};e.prototype.onEndHandler=function(){this.onUpdateHander()};e.prototype.onUnDisplay=function(){i.getIns().off(i.ACTIVIT_TAREN_EVENT.GET_MAIN_PANEL_INFO,this,this.onGetMainPanel)};e.prototype.onGetMainPanel=function(t){if(this.actVo&&t.actID==this.actVo.actid){this.onUpdateHander()}};Object.defineProperty(e.prototype,"qianWangBtn",{get:function(){return this.btnlingqu},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"lingquEffect",{set:function(t){if(t){this.btneffect.play();this.btneffect.visible=true}else{this.btneffect.stop();this.btneffect.visible=false}},enumerable:true,configurable:true});e.prototype.onUpdateHander=function(){var t=this,e=t.imgyilingqu,i=t.btnqianwangchongzhi;this.labelmiaoshu1.visible=true;this.activityTimeView.start(this.actVo.timeVo.endTime);var n=this.actVo.getCfgByIndex(0);var a=false;if(n){this.listdaoju.array=game.ItemUtil.parserList(n.award);var o=this.actVo.getSubInfo(n.id);switch(o.status){case activitytaren.ActivityTaRenLingQuStatus.CAN_T_LINGQU:i.visible=false;e.visible=false;this.qianWangBtn.visible=true;break;case activitytaren.ActivityTaRenLingQuStatus.IS_ALREADY_LING_QU:e.visible=true;i.visible=false;this.qianWangBtn.visible=false;break;case activitytaren.ActivityTaRenLingQuStatus.YOU_CAN_LING_QU:i.visible=true;i.gray=false;i.mouseEnabled=true;e.visible=false;this.qianWangBtn.visible=false;a=true;break}}this.lingquEffect=a;this.cfg=n};return e}(ui.renyichongzhihuodong.renyichongzhihuodongtipUI);t.RenYiChongZhiView=e})(renyichongzhi||(renyichongzhi={}));var game;(function(t){var e=function(){function t(){}t.getJie=function(t){return"res/static/jiaobiao/bg_zhuangbei_"+t+"jie.png"};t.getZheKou1=function(t){return"res/static/zhekou/bg_jiaobiao_"+t+"zhe.png"};t.getZheKou2=function(t){return"res/static/zhekou/bg_huolangtehui_jiaobiao"+t+".png"};return t}();t.ResUrls=e})(game||(game={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var game;(function(h){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.needCheckLv=false;t._FlowNoticeTypeArr=[];return t}t.prototype.init=function(){this._model=h.RoleModel.getIns();this._FlowNoticeTypeArr=app.str2Array(h.Config.getParams(640),";");app.ViewManager.regist(role.OffLineExpView,"lixianjingyan.atlas");app.ViewManager.regist(role.QuickGuajiView,"lixianjingyan.atlas");h.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.CHECK_WUXING,h.OtherRoleWuxingView);app.ViewManager.regist(h.OtherRoleMainNewView,"juese.atlas");h.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.CHECK_ROLE,h.OtherRoleMainNewView);app.ViewManager.regist(h.OtherRoleMainView,"zhuangbei.atlas");h.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.CHECK_EQUIP,h.OtherRoleMainView);app.ViewManager.regist(role.RoleMainNewView,"juese.atlas");h.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.ROLE_MAIN,role.RoleMainNewView);h.FuncDotAdapter.registRedFunc(csv.FunctionsProxy.ENUMS.ROLE_MAIN,this._model,this._model.updataLevelUpRed);h.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.ROLE_WUXING,role.RoleWuxingView);h.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.QUICK_GUAJI,role.QuickGuajiView,new Laya.Handler(this,this.openQuickGuajiView));h.FuncDotAdapter.registRedFunc(csv.FunctionsProxy.ENUMS.QUICK_GUAJI,this._model,this._model.onRedDotChange);app.ViewManager.regist(role.HeadFrameView,"chenghao.atlas");h.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.HEADFRAME,role.HeadFrameView);h.FuncDotAdapter.registRedFunc(csv.FunctionsProxy.ENUMS.HEADFRAME,this._model,this._model.onHeadFrameRedDotChange);app.ViewManager.regist(role.TeamIconView,"chenghao.atlas");h.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.TEAM_ICON,role.TeamIconView);app.ViewManager.regist(role.ChatBubbleView,"chenghao.atlas");h.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.CHAT_BUBBLE,role.ChatBubbleView);app.ViewManager.regist(role.GuajianView,"chenghao.atlas");h.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.CHAT_GUAJIAN,role.GuajianView);h.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.CHAKAN_SCORE,role.ScoreCheckView)};t.prototype.openQuickGuajiView=function(){app.ViewManager.toggleDialog(role.QuickGuajiView,1,0)};t.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.AttributeNoti,this,this.onAttributeNoti);this.addMsgListener(app.ProtocolResponse.RoleDataNoti,this,this.onRoleDataNoti);this.addMsgListener(app.ProtocolResponse.ResourceNoti,this,this.onResourceNoti);this.addMsgListener(app.ProtocolResponse.LevChangeNoti,this,this.onLevChangeNoti);this.addMsgListener(app.ProtocolResponse.AddExpNoti,this,this.onAddExpNoti);this.addMsgListener(app.ProtocolResponse.OffLineAwardItemNtf,this,this.onOffLineAwardItemNtf);this.addMsgListener(app.ProtocolResponse.RoleModifyNtf,this,this.onRoleModifyNtf);this.addMsgListener(app.ProtocolResponse.UserScoreResp,this,this.onUserScoreResp);this.addMsgListener(app.ProtocolResponse.StatusItemNtf,this,this.onStatusItemNtf);this.addMsgListener(app.ProtocolResponse.GetShowPlayerResp,this,this.onGetShowPlayerResp);this.addMsgListener(app.ProtocolResponse.FuncItemRecordNtf,this,this.onFuncItemRecordNtf);this.addMsgListener(app.ProtocolResponse.QuackHangUpInfoAck,this,this.onQuackHangUpInfoAck);this.addMsgListener(app.ProtocolResponse.CreateCombatAck,this,this.onCreateCombatAck);this.addMsgListener(app.ProtocolResponse.SetInFightAck,this,this.onSetInFightAck);this.addMsgListener(app.ProtocolResponse.HeadFrameInfoAck,this,this.onHeadFrameInfoAck);this.addMsgListener(app.ProtocolResponse.HeadFrameActiveNotice,this,this.onHeadFrameActiveNotice);this.addMsgListener(app.ProtocolResponse.HeadFramePastDueNotice,this,this.onHeadFramePastDueNotice);this.addMsgListener(app.ProtocolResponse.HeadFrameEquipAck,this,this.onHeadFrameEquipAck);this.addMsgListener(app.ProtocolResponse.SimpleTeamDataNtf,this,this.onSimpleTeamDataNtf);this.addMsgListener(app.ProtocolResponse.SimpleTeamUpdateAvatarAck,this,this.onSimpleTeamUpdateAvatarAck);this.addMsgListener(app.ProtocolResponse.TeamElementPropNtf,this,this.onTeamElementPropNtf);this.addMsgListener(app.ProtocolResponse.TeamElementSkillNtf,this,this.onTeamElementSkillNtf);this.addMsgListener(app.ProtocolResponse.UseElementSkillAck,this,this.onUseElementSkillAck);this.addMsgListener(app.ProtocolResponse.SimpleBubbleDataNtf,this,this.onSimpleBubbleDataNtf);this.addMsgListener(app.ProtocolResponse.SimpleBubbleUpdateAck,this,this.onSimpleBubbleUpdateAck);this.addMsgListener(app.ProtocolResponse.MagicPluginNtf,this,this.onMagicPluginNtf);this.addMsgListener(app.ProtocolResponse.MagicPluginAck,this,this.onMagicPluginAck);this.addMsgListener(app.ProtocolResponse.CombatAddExpNoti,this,this.onCombatAddExpNoti);this.addMsgListener(app.ProtocolResponse.SectionBattleScoreAck,this,this.onSectionBattleScoreAck);this.addMsgListener(app.ProtocolResponse.GetTarPlayerIpAck,this,this.onGetTarPlayerIpAck)};t.prototype.onGetTarPlayerIpAck=function(t,e){if(Uint64.equal(e.roleid,h.Context.mainRole.insId)){h.Context.ip=e.strip}else{this._model.event(h.RoleModel.EVENTS.ROLE_GET_IP,e)}};t.prototype.onSectionBattleScoreAck=function(t,e){this._model.scoreInfo=e.battleScore;this._model.event(h.RoleModel.EVENTS.CHAKAN_SCORE_CHANGE)};t.prototype.onCombatAddExpNoti=function(t,e){h.Context.updateTeamExp(e.combatid,e.curexp,e.changeexp)};t.prototype.onSimpleTeamDataNtf=function(t,e){var i=e.data[0];if(h.Context.teamLv){if(h.Context.teamLv!=i.level){h.Context.teamlvOld=h.Context.teamLv;h.Context.teamLv=i.level;var n=20;if(h.Context.teamlvOld<n&&h.Context.teamLv>=n){login.LoginModel.getIns().event(login.LoginModel.EVENTS.TOMATO_SEND_REPORT,[gamesdk.EReportType.TeamLevel])}this._model.event(h.RoleModel.EVENTS.TEAM_LEVEL_CHANGE);var a=[];for(var o=h.Context.teamlvOld+1;o<=h.Context.teamLv;o++){var s=csv.FunctionsProxy.getIns().teamlvMap[o];if(s){for(var r=0;r<s.length;r++){var l=s[r];if(csv.FunctionsProxy.getIns().isOpen(l)){a.push(l)}}}}h.Context.funcOpenIds=a;main.FuncOpenView.onshowFuncOpenView()}else{h.Context.teamlvOld=0}}else{h.Context.teamLv=i.level;h.Context.teamExp=i.exp.toNumber();this._model.event(h.RoleModel.EVENTS.TEAM_LEVEL_INIT);csv.FunctionsProxy.getIns().initFunctions()}h.Context.teamExp=i.exp.toNumber();h.Context.teamAvatar=i.avatar;if(h.Context.aliveTeamAvatars){var s=[];for(var r=0;r<e.avatar_list.length;r++){if(h.Context.aliveTeamAvatars.indexOf(e.avatar_list[r])<0){s.push(e.avatar_list[r]);app.ViewManager.toggleDialog(role.AlertGetTeamIconView,1,0,e.avatar_list[r])}}this._model.newTeamAvatar=this._model.newTeamAvatar.concat(s)}else{this._model.newTeamAvatar=[]}h.Context.aliveTeamAvatars=e.avatar_list;this._model.event(h.RoleModel.EVENTS.TEAM_INFO_CHANGE)};t.prototype.onSimpleTeamUpdateAvatarAck=function(t,e){if(e.result){h.Context.teamAvatar=e.avatar_id;this._model.event(h.RoleModel.EVENTS.TEAM_ICON_CHANGE)}};t.prototype.onTeamElementPropNtf=function(t,e){for(var i=0,n=e.eprop.length;i<n;i++){var a=e.eprop[i];h.Context.wuxingAttributes[a.src]=a.attribute}};t.prototype.onTeamElementSkillNtf=function(t,e){h.Context.newWuxingSkills=[];var i=h.SystemSetModel.getInstance().settingData.getValueByType(h.SettingType.wuxingSkillRed);for(var n=0,a=e.eid.length;n<a;n++){var o=e.eid[n];if(o>i.value){h.Context.newWuxingSkills.push(e.eid[n])}}h.Context.aliveWuxingSkills=e.eid;h.Context.selectWuxingSkill=e.useid;if(h.Context.newWuxingSkills.length){h.ClosureManager.addXin(csv.FunctionsProxy.ENUMS.ROLE_WUXING)}};t.prototype.onUseElementSkillAck=function(t,e){if(e.result){h.Context.selectWuxingSkill=e.useid;this._model.event(h.RoleModel.EVENTS.WUXING_SKILL_SELECT_CHANGE)}};t.prototype.onHeadFrameEquipAck=function(t,e){if(e.success){this._model.onHeadFrameIdUpdate(e.equipedId)}};t.prototype.onHeadFramePastDueNotice=function(t,e){this._model.onHeadFramePastDueNotice(e.headframeId)};t.prototype.onHeadFrameActiveNotice=function(t,e){this._model.onHeadFrameActiveNotice(e.headframeId);app.ViewManager.toggleDialog(role.AlertGetHeadFrameView,1,0,e.headframeId)};t.prototype.onHeadFrameInfoAck=function(t,e){this._model.onHeadFrameListUpdate(e.headframeList);this._model.onHeadFrameIdUpdate(e.equipedId)};t.prototype.onSimpleBubbleDataNtf=function(t,e){this._model.useBubbleId=e.bubble_id;this._model.aliveBubbleCd={};var i=false;if(!this._model.newBubbleIds){this._model.newBubbleIds=[];i=true}for(var n=0,a=e.data.length;n<a;n++){var o=e.data[n];var s=this._model.aliveBubbleIds.indexOf(o.bubble_id);if(!i){if(s==-1){this._model.newBubbleIds.push(o.bubble_id);app.ViewManager.toggleDialog(role.AlertGetBubbleView,1,0,o.bubble_id)}}if(s==-1){this._model.aliveBubbleIds.push(o.bubble_id)}if(o.expired){this._model.aliveBubbleCd[o.bubble_id]=o.expired}}this._model.onBubbleRedDotChange();this._model.event(h.RoleModel.EVENTS.CHAT_BUBBLE_UPDATA)};t.prototype.onSimpleBubbleUpdateAck=function(t,e){if(e.result){this._model.useBubbleId=e.bubble_id;this._model.event(h.RoleModel.EVENTS.CHAT_BUBBLE_USE_CHANGE)}};t.prototype.onMagicPluginNtf=function(t,e){this._model.useGuajianIds=e.magicPlugin};t.prototype.onMagicPluginAck=function(t,e){if(e.success){if(e.type==1){if(this._model.useGuajianIds.length>=h.Config.getIntParams(1233)){this._model.useGuajianIds.shift()}this._model.useGuajianIds.push(e.magicCfgID)}else{var i=this._model.useGuajianIds.indexOf(e.magicCfgID);if(i!=-1){this._model.useGuajianIds.splice(i,1)}}this._model.event(h.RoleModel.EVENTS.GUAJIAN_USE_CHANGE)}};t.prototype.onCreateCombatAck=function(t,e){if(e.result){}};t.prototype.onSetInFightAck=function(t,e){if(e.result){h.Context.changeBattleRoles(e.roleclass);this._model.event(h.RoleModel.EVENTS.SHANGZHEN_CHANGE);manager.FlowManager.instance.flowByStyle1(app.getLang("zhenrong_change1"),null,h.STYLES.GREEN_COLOR)}};t.prototype.onResourceNoti=function(t,e){var i=h.MoneyModel.getIns().getMoney(e.type);h.MoneyModel.getIns().setMoney(e.type,e.resVal);if(i<e.resVal){var n=csv.ItemProxy.getIns().resMap[e.type].id;if(n&&e.resFlag==0){var a=h.ItemUtil.createVO(n);a.setCount(e.resVal);h.NoticeManager.getIns().flowMsg(csv.ItemProxy.getTipHtmlName(n)+"<span>x"+(e.resVal-i)+"</span>",csv.ItemProxy.getUrl(n))}}else if(i>e.resVal){var o=this._FlowNoticeTypeArr.indexOf(e.type+"")>-1;if(o){var n=csv.ItemProxy.getIns().resMap[e.type].id;if(n){var s=app.getLang("buy_suc2",csv.ItemProxy.getName(n),i-e.resVal);manager.FlowManager.instance.flowByStyle1('<span color="'+h.STYLES.YELLOW_S_COLOR+'">'+s+"</span>")}}}};t.prototype.onAttributeNoti=function(t,e){if(!h.Context.mainRole){return}h.Context.roleMap[e.uid.toString()].attribute=e.attribute;this._model.event(h.RoleModel.EVENTS.PROP_CHANGE)};Object.defineProperty(t.prototype,"fabaoLv",{get:function(){return csv.ChouKaProxy.getIns().getLockLv(2)},enumerable:true,configurable:true});t.prototype.onRoleDataNoti=function(t,e){this._model.scoreCd=Laya.timer.currTimer;if(h.Context.mainRole){h.Context.exp=e.exp.toNumber();h.Context.totalexp=e.totalexp.toNumber();for(var i=0,n=e.res.length;i<n;++i){var a=e.res[i];h.MoneyModel.getIns().setMoney(a.type,a.value)}return}h.Context.exp=e.exp.toNumber();h.Context.totalexp=e.totalexp.toNumber();var o=this.fabaoLv;var s=true;for(var i=0;i<e.roleinf.length;i++){h.Context.initRole(e.roleinf[i],e.name);if(e.roleinf[i].level>=o){s=false}}this.needCheckLv=s;h.Context.sortRoleList();h.Context.mainRole=h.Context.roleList[0];h.Context.mainRole.mapId=e.mapId;h.Context.mainRole.posX=e.point[0].pX;h.Context.mainRole.posY=e.point[0].pY;h.Context.mainRole.dir=e.point[0].pDir;h.Context.mainRole.boMainRole=true;h.Context.mainRole.insId=e.roleid;h.Context.mainRole.playername=e.name;h.Context.mainRole.createTime=e.createTime;h.Context.battleCamp=h.Context.mainRole.battleCamp;if(!h.Context.ip){app.ProtocolRequest.GetTarPlayerIpReq(h.Context.mainRole.insId)}this._model.event(h.RoleModel.EVENTS.INFO_INIT);this._model.event(h.RoleModel.EVENTS.PLAYER_NUM_MODIFY);for(var i=0,n=e.res.length;i<n;++i){var a=e.res[i];h.MoneyModel.getIns().setMoney(a.type,a.value)}this._model.updataLevelUpRed();login.CoverModel.getIns().enter_game();this._model.event(h.RoleModel.EVENTS.GET_INII_DATA)};t.prototype.onRoleModifyNtf=function(t,e){if(!h.Context.roleMap[e.roleModify[0].id.toString()]){h.Context.initRole(e.roleModify[0],h.Context.mainRole.playername);h.Context.sortRoleList();this._model.event(h.RoleModel.EVENTS.PLAYER_NUM_MODIFY);console.log("创建角色"+e.roleModify[0].id.toString());var i=this._model.newUid;i.push(e.roleModify[0].id);this._model.newUid=i}else{h.Context.changeRole(e.roleModify[0]);this._model.event(h.RoleModel.EVENTS.INFO_INIT)}};t.prototype.onLevChangeNoti=function(t,e){var i=h.Context.roleMap[e.uid.toString()];i.level=e.ulv;if(i.tupoLv!=e.utupoLv){i.tupoLv=e.utupoLv;this._model.event(h.RoleModel.EVENTS.TUPOLV_CHANGE,[i.prof,e.utupoLv])}if(this.needCheckLv){if(i.level>=this.fabaoLv){main.FuncOpenView.add(csv.FunctionsProxy.getIns().getCfg(csv.FunctionsProxy.ENUMS.FABAO_GRID_ENABLE));this.needCheckLv=false}}if(h.Context.roleList.length==1){role.LevelUpView.Add()}this._model.event(h.RoleModel.EVENTS.LEVEL_CHANGE);app.SoundManager.getIns().playSound("cheer");this._model.updataLevelUpRed()};t.prototype.onAddExpNoti=function(t,e){h.Context.exp=e.exp.toNumber();h.Context.totalexp=e.totalexp.toNumber();h.Context.addexp=e.changeexp.toNumber();this._model.event(h.RoleModel.EVENTS.EXP_CHANGE);if(e.expflag==1){guaji.GuajiModel.getIns().addKillExp(h.Context.addexp)}this._model.updataLevelUpRed()};t.prototype.onUserScoreResp=function(t,e){for(var i=0,n=e.score.length;i<n;i++){var a=e.score[i];var o=a.score.toNumber();if(Uint64.equal(a.id,Uint64.ZERO)){this._model.otherScore=o}else if(!h.Context.roleMap[a.id.toString()]){console.log("角色"+a.id.toString()+"不存在")}var s=h.Context.roleMap[a.id.toString()];if(s){s.score=o}}this._model.updateScroe()};t.prototype.onOffLineAwardItemNtf=function(t,e){if(verifiedcode.VerifiedModel.getIns().offLine){return}if(e.type==1){app.ViewManager.toggleDialog(role.OffLineExpView,1,1,e)}else if(e.type==2){this._model.updateTrainTimes(e.TotalCount);for(var i=0;i<e.guajiAward.length;i++){if(e.guajiAward[i].itemID==h.ItemUtil.ENUMS.PET_EXP_ITEM&&!csv.FunctionsProxy.getIns().isOpen(csv.FunctionsProxy.ENUMS.PET_LIST)){e.guajiAward.splice(i,1);break}}var n=h.ItemUtil.getAwardItem([],e.guajiAward);app.ViewManager.toggleDialog(bag.AwardView,1,0,n)}};t.prototype.onQuackHangUpInfoAck=function(t,e){this._model.updateTrainTimes(e.totalCount)};t.prototype.onStatusItemNtf=function(t,e){this._model.onStatusItemUpdate(e.buff,e.bless)};t.prototype.onGetShowPlayerResp=function(t,e){h.OtherRoleModel.getIns().addOpenLister();h.OtherRoleModel.getIns().dellOtherPlayerInfo(e.data[0]);h.ClosureManager.callFunction(csv.FunctionsProxy.ENUMS.CHECK_WUXING);this._model.event(h.RoleModel.EVENTS.ROLE_OTHER_INFO,e)};t.prototype.onFuncItemRecordNtf=function(t,e){csv.FunctionsProxy.getIns().isItemRecord=true;this._model.dellFuncOpenList(e.gainitem)};t.SINGLE_KEY="game.RoleModule";return t}(app.ModuleBase);h.RoleModule=t})(game||(game={}));var role;(function(a){var t=function(){function t(){this.recheck=2;this.speed=a.PosMoveAction.NORAML_SPEED}Object.defineProperty(t.prototype,"target",{set:function(t){if(!t){return}if(this._target&&this._target.x==t.x&&this._target.y==t.y){return}this._target=t;this.sTar=isometric.IsoUtils.isoToScreen(new isometric.Point3D(t.x*32,0,t.y*32))},enumerable:true,configurable:true});t.prototype.onFrame=function(t){if(!this.sTar){this.complete();return 1}if(!this.tar||this.tar.roleState==a.RoleStateConst.DIE){this.complete();return 1}if(scene.SceneMediator.getInstance().checkIsMathAttack(this.char,this.tar,this.adis)){if(this.recheck>0){this.recheck--;if(scene.SceneMediator.getInstance().getEmptyStandPos(this.char,this.char.vo.posX,this.char.vo.posY,3)){if(!this.checkNeedChangePos()){this.complete();return 1}}else{this.complete();return 1}}else{if(scene.SceneMediator.getInstance().checkStandUsed(this.char,this.char.vo.posX,this.char.vo.posY)){if(!this.checkNeedChangePos()){this.complete();return 1}}else{this.complete();return 1}}}t*=app.TimerRewriter.battleScale;var e=this.sTar.distance(this.char.x,this.char.y);if(e<this.char.charactorVO.speed*t*32/120){var i=isometric.IsoUtils.screenToIso(new Laya.Point(this.char.x,this.char.y));this.char.vo.posX=Math.round(i.x/32);this.char.vo.posY=Math.round(i.z/32);this.complete();return 1}else{var n=new Laya.Point(this.sTar.x-this.char.x,this.sTar.y-this.char.y);n.normalize();this.char.x+=this.speed*32/120*t*n.x;this.char.y+=this.speed*32/120*t*n.y;this.char.isoPos=isometric.IsoUtils.screenToIso(new Laya.Point(this.char.x,this.char.y));this.char.vo.posX=Math.round(this.char.isoPosX/32);this.char.vo.posY=Math.round(this.char.isoPosZ/32);this.recordStandPos(this.char.vo.insId,this.char.vo.posX,this.char.vo.posY)}};t.prototype.cancel=function(t){};t.prototype.complete=function(t){this.char.isoPos=new isometric.Point3D(this.char.vo.posX*32,0,this.char.vo.posY*32);this.recordStandPos(this.char.vo.insId,this.char.vo.posX,this.char.vo.posY);this._isCompleted=true;if(this.completeHandler){this.completeHandler.run()}};t.prototype.checkNeedChangePos=function(){var t=scene.SceneMediator.getInstance().getEmptyStandPos(this.char,this.tar.vo.posX,this.tar.vo.posY,this.adis);if(t){this.target=t;return true}return false};t.prototype.isCompleted=function(){return this._isCompleted};t.prototype.getNextPos=function(){return null};t.prototype.pause=function(){};t.prototype.resume=function(){};t.prototype.getTargetPos=function(){return null};t.prototype.recordStandPos=function(t,e,i){scene.SceneMediator.getInstance().setStandPos(t,e,i)};return t}();a.AttackMoveAction=t})(role||(role={}));var role;(function(t){var e=function(){function t(){this.speed=.8}t.prototype.onFrame=function(t){console.log("ClientMoveAction移动");if(!this.target){this.complete();return 1}var e=this.target.distance(this.char.x,this.char.y);var i=this.speed*t*32/120;if(e<i){var n=isometric.IsoUtils.screenToIso(new Laya.Point(this.char.x,this.char.y));this.char.vo.posX=Math.round(n.x/32);this.char.vo.posY=Math.round(n.z/32);this.complete();return 1}else{var a=new Laya.Point(this.target.x-this.char.x,this.target.y-this.char.y);a.normalize();var o=this.char.x+i*a.x;var s=this.char.y+i*a.y;var r=isometric.IsoUtils.screenToIso(new Laya.Point(o,s));var l=Math.round(r.x/32);var h=Math.round(r.z/32);if(scene.SceneMediator.getInstance().getStatus(l,h,scene.E_BIT_Define.CUST4)){copy.CopyModel.getIns().beHitBack();this.complete();return 1}else if(!scene.SceneMediator.getInstance().checkCanMove(l,h)){this.complete();return 1}this.char.x=o;this.char.y=s;this.char.isoPos=r;this.char.vo.posX=l;this.char.vo.posY=h;this.recordStandPos(this.char.vo.insId,this.char.vo.posX,this.char.vo.posY)}};t.prototype.cancel=function(t){console.log("取消移动")};t.prototype.complete=function(t){console.log("ClientMoveAction移动complete",this.char.vo.posX,this.char.vo.posY);this.char.isoPos=new isometric.Point3D(this.char.vo.posX*32,0,this.char.vo.posY*32);this.recordStandPos(this.char.vo.insId,this.char.vo.posX,this.char.vo.posY);this._isCompleted=true;if(this.completeHandler){this.completeHandler.run()}};t.prototype.isCompleted=function(){return this._isCompleted};t.prototype.getNextPos=function(){return null};t.prototype.pause=function(){};t.prototype.resume=function(){};t.prototype.getTargetPos=function(){return null};t.prototype.recordStandPos=function(t,e,i){scene.SceneMediator.getInstance().setStandPos(t,e,i)};return t}();t.ClientMoveAction=e})(role||(role={}));var role;(function(t){var e=function(){function t(){this.speed=1}t.prototype.onFrame=function(t){if(!this.target){this._isCompleted=true;this.cancel();return 1}var e=this.target.distance(this.char.x,this.char.y);if(e<this.speed*32/120*t){this.char.isoPos=isometric.IsoUtils.screenToIso(new Laya.Point(this.char.x,this.char.y));this.char.vo.posX=Math.round(this.char.isoPosX/32);this.char.vo.posY=Math.round(this.char.isoPosZ/32);this.complete();return 1}else{var i=new Laya.Point(this.target.x-this.char.x,this.target.y-this.char.y);i.normalize();this.char.x+=this.speed*32/120*t*i.x;this.char.y+=this.speed*32/120*t*i.y;this.char.isoPos=isometric.IsoUtils.screenToIso(new Laya.Point(this.char.x,this.char.y));this.char.vo.posX=Math.round(this.char.isoPosX/32);this.char.vo.posY=Math.round(this.char.isoPosZ/32);return 0}};t.prototype.cancel=function(t){};t.prototype.complete=function(t){this.char.setRoleAni(avatar.AvatarAnimation.ANI_ENUMS.IDLE,this.char.vo.dir);this._isCompleted=true;if(this.completeHandler){this.completeHandler.run()}};t.prototype.isCompleted=function(){return this._isCompleted};t.prototype.getNextPos=function(){return null};t.prototype.pause=function(){};t.prototype.resume=function(){};t.prototype.getTargetPos=function(){return new Laya.Point(this.target.x,this.target.y)};t.prototype.recordStandPos=function(t,e,i){};return t}();t.FlowerPosMoveAction=e})(role||(role={}));var role;(function(t){var e=function(){function t(){this.speed=1.5;this._factor=0}t.getJumpId=function(){return++t.JumpId};t.prototype.init=function(){this.p1=new Laya.Point(this.char.x,this.char.y);this.p3=this.target;this.p2=new Laya.Point((this.p1.x+this.p3.x)/2,(this.p1.y+this.p3.y)/2-600);var t=this.p1.distance(this.p2.x,this.p2.y)+this.p3.distance(this.p2.x,this.p2.y);this.totalTime=t/this.speed;this.currTime=0};Object.defineProperty(t.prototype,"factor",{get:function(){return this._factor},set:function(t){this._factor=t;this.char.x=(1-t)*(1-t)*this.p1.x+2*t*(1-t)*this.p2.x+t*t*this.p3.x;this.char.y=(1-t)*(1-t)*this.p1.y+2*t*(1-t)*this.p2.y+t*t*this.p3.y;this.char.isoPos=isometric.IsoUtils.screenToIso(new Laya.Point(this.char.x,this.char.y))},enumerable:true,configurable:true});t.prototype.onFrame=function(t){if(!this.target||Boolean(this.target.x==this.char.x&&this.target.y==this.char.y)){this.complete();return 1}this.currTime+=t;var e=this.currTime/this.totalTime;if(e>=1){e=1}this.factor=e;if(e>=1){this.char.vo.posX=Math.round(this.char.isoPosX/32);this.char.vo.posY=Math.round(this.char.isoPosZ/32);this.complete();return 1}return 0};t.prototype.cancel=function(t){};t.prototype.complete=function(t){this.recordStandPos(this.char.vo.insId,this.char.vo.posX,this.char.vo.posY);this._isCompleted=true;if(this.completeHandler){this.completeHandler.run()}};t.prototype.isCompleted=function(){return this._isCompleted};t.prototype.getNextPos=function(){return null};t.prototype.pause=function(){};t.prototype.resume=function(){};t.prototype.getTargetPos=function(){return new Laya.Point(this.target.x,this.target.y)};t.prototype.recordStandPos=function(t,e,i){scene.SceneMediator.getInstance().setStandPos(t,e,i)};t.JumpId=0;return t}();t.JumpAction=e})(role||(role={}));var role;(function(o){var t=function(){function a(){this.speed=1;this.dirArr=[]}Object.defineProperty(a.prototype,"path",{set:function(t){this._totalPath=t.concat();if(this.char==o.LeadingRoleView.getIns()){this._groups=[];var e=Math.floor(t.length/a.SPLICE);for(var i=0;i<e;i++){var n=t.splice(0,a.SPLICE);this._groups.push(n)}if(t.length>0){this._groups.push(t)}this.checkPath()}else{this._path=t}},enumerable:true,configurable:true});a.prototype.checkPath=function(){if(this._groups.length>0){this._path=this._groups.shift();var t=csv.MapProxy.getIns().isNeedPosResponse(game.Context.mainRole.mapId);if(t){var e=[];for(var i=0;i<this._path.length;++i){var n=new Point2D;n.pX=Math.floor(this._path[i].x);n.pY=Math.floor(this._path[i].y);e.push(n)}if(e.length==1){if(e[0].pX===this.char.vo.posX&&e[0].pY===this.char.vo.posY){return}}app.ProtocolRequest.MoveRequest(e)}return false}return true};a.prototype.cancel=function(t){this._path=null;this._nextPos=this._oldPos=null};a.prototype.complete=function(t){this._path=null;this._nextPos=this._oldPos=null;this._isCompleted=true;if(this.completeHandler){this.completeHandler.runWith(this.completeHandler.args)}};a.prototype.getNextPos=function(){return this._nextPos};a.prototype.onFrame=function(t){if(!this._path){this.complete();return 1}if(this._nextPos==undefined&&this._path.length>0){this._nextPos=this._oldPos=new Laya.Point(this._path[0].x*32,this._path[0].y*32);this.smoothDir();this._path.shift();this._totalPath.shift()}if(this._nextPos){var e=this._nextPos.distance(this.char.isoPosX,this.char.isoPosZ);if(e<this.char.charactorVO.speed*t*32/120){this.char.isoPosX=this._nextPos.x;this.char.isoPosZ=this._nextPos.y;if(Uint64.equal(this.char.vo.insId,game.Context.mainRole.insId)){game.SceneModel.getInstance().event(game.SceneModel.EVENT_DRAW_PATH,[this._totalPath])}if(this._path.length>0){this._nextPos=new Laya.Point(this._path[0].x*32,this._path[0].y*32);this._MapTypeIsInCustomTypeAreaTips(this.char.vo.insId);this._oldPos=this._nextPos;this._path.shift();this._totalPath.shift();this.char.vo.dir=this.dirArr.shift();this.char.setRoleAni(avatar.AvatarAnimation.ANI_ENUMS.RUN,this.char.vo.dir)}else{this._nextPos=this._oldPos=undefined;if(this.char==o.LeadingRoleView.getIns()){if(this.checkPath()){this.complete();return 1}}else{this.complete();return 1}}}else{var i=new Laya.Point(this._nextPos.x-this.char.isoPosX,this._nextPos.y-this.char.isoPosZ);i.normalize();this.char.isoPosX+=this.char.charactorVO.speed*32/120*t*i.x;this.char.isoPosZ+=this.char.charactorVO.speed*32/120*t*i.y;this.char.vo.posX=Math.round(this.char.isoPosX/32);this.char.vo.posY=Math.round(this.char.isoPosZ/32)}}else{this.complete();return 1}return 0};a.prototype.smoothDir=function(){var t=[];for(var e=0,i=this._path.length;e<i-1;e++){var n=this._path[e];var a=this._path[e+1];t.push(game.SceneModel.getDirByTowPos(n.x,n.y,a.x,a.y))}for(var e=0,i=t.length;e<i;e++){if(t[e]==t[e+2]){t[e+1]=t[e]}}this.dirArr=t};a.prototype.pause=function(){};a.prototype.resume=function(){};a.prototype.isCompleted=function(){return this._isCompleted};a.prototype.getTargetPos=function(){var t=new Laya.Point(0,0);if(this._path&&this._path[this._path.length-1]){var e=this._path[this._path.length-1];t.x=e.x;t.y=e.y}return t};a.prototype.recordStandPos=function(t,e,i){scene.SceneMediator.getInstance().setStandPos(t,e,i)};a.prototype._MapTypeIsInCustomTypeAreaTips=function(t){if(!Uint64.equal(t,game.Context.mainRole.insId)){return}var e=csv.MapProxy.getIns().getMapType(game.Context.mainRole.mapId);switch(e){case csv.MapProxy.MAP_TYPE.WORLD_BOSS_ICE:case csv.MapProxy.MAP_TYPE.WORLD_BOSS_ICE_FIGHT:this._posNeedTips(scene.E_BIT_Define.CUST2,app.getLang("ice_warn_msg_1"),true);this._posNeedTips(scene.E_BIT_Define.CUST3,app.getLang("ice_warn_msg_2"),false);break;default:break}};a.prototype._posNeedTips=function(t,e,i){if(i){var n=csv.MapProxy.anyPosIsInCustomTypeArea(this._oldPos,t);var a=csv.MapProxy.anyPosIsInCustomTypeArea(this._nextPos,t);if(n&&!a){manager.FlowManager.instance.flowByStyle1(e)}}else{var n=csv.MapProxy.anyPosIsInCustomTypeArea(this._oldPos,t);var a=csv.MapProxy.anyPosIsInCustomTypeArea(this._nextPos,t);if(!n&&a){manager.FlowManager.instance.flowByStyle1(e)}}};a.SPLICE=10;return a}();o.PathMoveAction=t})(role||(role={}));var role;(function(e){var t=function(){function t(){this.speed=e.PosMoveAction.NORAML_SPEED}t.prototype.onFrame=function(t){if(!this.target||Boolean(this.target.x==this.char.x&&this.target.y==this.char.y)){this.complete();return 1}var e=this.target.distance(this.char.x,this.char.y);if(e<this.speed*32/120*t){this.char.isoPos=isometric.IsoUtils.screenToIso(new Laya.Point(this.char.x,this.char.y));this.char.vo.posX=Math.round(this.char.isoPosX/32);this.char.vo.posY=Math.round(this.char.isoPosZ/32);this.complete();return 1}else{var i=new Laya.Point(this.target.x-this.char.x,this.target.y-this.char.y);i.normalize();this.char.x+=this.speed*32/120*t*i.x;this.char.y+=this.speed*32/120*t*i.y;this.char.isoPos=isometric.IsoUtils.screenToIso(new Laya.Point(this.char.x,this.char.y));this.char.vo.posX=Math.round(this.char.isoPosX/32);this.char.vo.posY=Math.round(this.char.isoPosZ/32);return 0}};t.prototype.cancel=function(t){};t.prototype.complete=function(t){this.recordStandPos(this.char.vo.insId,this.char.vo.posX,this.char.vo.posY);this._isCompleted=true;if(this.completeHandler){this.completeHandler.run()}};t.prototype.isCompleted=function(){return this._isCompleted};t.prototype.getNextPos=function(){return null};t.prototype.pause=function(){};t.prototype.resume=function(){};t.prototype.getTargetPos=function(){return new Laya.Point(this.target.x,this.target.y)};t.prototype.recordStandPos=function(t,e,i){scene.SceneMediator.getInstance().setStandPos(t,e,i)};t.NORAML_SPEED=1;t.ADD_SPEED=5;return t}();e.PosMoveAction=t})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(t){var e=function(t){__extends(o,t);function o(){return t.call(this)||this}o.prototype.playBuff=function(){this.char.isoDisplay.addChild(this);var t=csv.StatusProxy.getIns().getCfg(this.buffId,this.buffLvl);if(t.effectid!=""){this.load(t.effectid,game.AniView.FILE_NAME.BUFF);this.play(0)}var e=0;this.position=t.effect_position;if(this.position=="1"){e=this.char.charactorVO.getModelHeight()+50}else if(this.position=="2"){e=this.char.charactorVO.getModelHeight()/2}this.x=0;this.y=0-e};o.prototype.recycle=function(){this.stop();this.removeSelf();this.alpha=1;this.char=null;Laya.Pool.recover("buff_effect_"+this.buffId+"_"+this.buffLvl,this)};o.getBuffEffect=function(t,e,i,n){if(e===void 0){e=1}if(n===void 0){n=false}var a=Laya.Pool.getItemByClass("buff_effect_"+t+"_"+e,o);a.buffId=t;a.char=i;a.buffLvl=e;a.canstop=n;a.playBuff();return a};return o}(game.SkillAniView);t.BuffEffect=e})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.btnqianwang.on(Laya.Event.CLICK,this,this.onGet)};e.prototype.onGet=function(){game.ClosureManager.callFunction(this.dataSource.funcid)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){this.imgmeishuzi.skin="juese/"+t.pic+".png";var e=csv.FunctionsProxy.getIns().getCfg(t.funcid);if(game.Context.isRoleReach(false,e.role,e.lv)){this.wenben.text="";this.btnqianwang.visible=true}else{this.wenben.text=app.getLang("func_er_1",e.role,csv.ReBirthProxy.getIns().getLvlDes(e.lv));this.btnqianwang.visible=false}};e.SINGLE_KEY="guaji.ExpGetItem";return e}(ui.juese.huoqutujingitemUI);t.ExpGetItem=e})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.baoshilist.itemRender=i.ExpGetItem;this.baoshilist.renderHandler=new Laya.Handler(this,this.onRenderHandler)};e.prototype.onRenderHandler=function(t,e){t.setData(t.dataSource)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){this.baoshilist.array=csv.LevelProxy.getIns().expArr};e.SINGLE_KEY="guaji.ExpGetView";return e}(ui.juese.huoqutujingtipUI);i.ExpGetView=t})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(l){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.runNums=[];return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this._model=game.RoleModel.getIns();this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.roleMediator=new common.RoleListMediator(this.itemxuanze.xuanzelist,equip.RoleItem,new Laya.Handler(this,this.roleSelectChange));this.centerLayout=new game.CenterLayoutMediator(this.hulu,this.box,73,this.hulu.spaceX);this.hulu.itemRender=ui.juese.juesehuluitemUI;this.hulu.renderHandler=new Laya.Handler(this,this.onHandler);this.hulu.on(Laya.Event.CLICK,this,this.onHuluClick);this.sjCost=new common.CostList(this.listxiaohao2,this.boxshengji);this.tpCost=new common.CostList(this.listxiaohao,this.boxjinjie);this.lblPropNames=[this.shuxing1,this.shuxing2,this.shuxing3];this.lblPropValues=[this.shuzhi1,this.shuzhi2,this.shuzhi3];this.wuxing.renderHandler=new Laya.Handler(this,this.onWuxingRender);this.jueseshengji.visible=false;this.jueseshengji.mouseEnabled=false;this.skillArr=[this.jineng03,this.jineng04,this.jineng05,this.jineng06];this.gaiminbtn.visible=false;this.btnfangdajing.clickHandler=new Laya.Handler(this,this.onDetail);this.btnshengj.clickHandler=new Laya.Handler(this,this.onShengji);this.btnjinjie.clickHandler=new Laya.Handler(this,this.onJinjie);this.btndingwei2.clickHandler=new Laya.Handler(this,this.onTexing);this.jueseshengji.on(Laya.Event.COMPLETE,this,this.onLvEffComplete);this.padkarIconControl=new pedlar.PadkarIconControl(this.btnhuolang,[pedlarnew.PedkarNewModel.ENUMS.JIESUOWA]);guide.GuideModel.getIns().register(csv.GuideProxy.ENUM_VIEW.ROLE_LEVEL_UP,this.btnshengj);guide.GuideModel.getIns().register(csv.GuideProxy.ENUM_VIEW.ROLE_TUPO,this.btnjinjie);guide.GuideModel.getIns().register(csv.GuideProxy.ENUM_VIEW.ROLE_ADD_BTN,this,this.getGuideItemBtn,300);guide.GuideModel.getIns().register(csv.GuideProxy.ENUM_VIEW.JUESE_ROLE_SELECT,this,this.getGuideItemBtn2,300)};t.prototype.getGuideItemBtn2=function(t){this.itemxuanze.xuanzelist.scrollTo(0);if(this.itemxuanze.xuanzelist.selectedIndex==t-1){return"complete"}else{var e=this.itemxuanze.xuanzelist.cells[t-1];if(e){return e}}return null};t.prototype.getGuideItemBtn=function(t){this.itemxuanze.xuanzelist.scrollTo(0);var e=this.itemxuanze.xuanzelist.cells[t-1];if(e){return e.imgjiahao}return null};t.prototype.onHuluClick=function(){var t=csv.LevelProxy.getIns().getCurrMaxLv(this.roleMediator.selectedRoleVo.tupoLv);var e={title:app.getLang("进阶次数"),txt:app.getLang("已进阶{0}次\n升级上限为{1}",this.roleMediator.selectedRoleVo.tupoLv,t)};tip.TipManager.showDes([e])};t.prototype.onHandler=function(t,e){t.hulu.skin=t.dataSource};t.prototype.changeName=function(){app.ViewManager.toggleDialog(gaiming.GaiMingView,1,0,[this.roleMediator.selectedIndex])};t.prototype.onShengji=function(){if(this.addLv){app.ProtocolRequest.UseExpReq(this.roleMediator.selectedRoleVo.insId,this.addLv,0)}else{var t=csv.LevelProxy.getIns().getCfg(this.roleMediator.selectedRoleVo.level);if(t.teamlevel>game.Context.teamLv){manager.FlowManager.instance.flowByStyle1(app.getLang("levelup_9",t.teamlevel));return}var e=csv.LevelProxy.getIns().getCurrMaxLv(this.roleMediator.selectedRoleVo.tupoLv);var i=csv.LevelProxy.getIns().getCanAddInfo(this.roleMediator.selectedRoleVo.level,e);if(!game.GridsModel.getIns().hasEnoughItems(i[1],false,true,true)){return}}};t.prototype.onJinjie=function(){var t=csv.LevelProxy.getIns().getCfg(this.roleMediator.selectedRoleVo.level);if(t.teamlevel>game.Context.teamLv){manager.FlowManager.instance.flowByStyle1(app.getLang("levelup_9",t.teamlevel));return}var e=csv.LevelProxy.getIns().getBreakCost(t,this.roleMediator.selectedRoleVo.prof);if(!game.GridsModel.getIns().hasEnoughItems(e,false,true,true)){var i=guide.GuideSpecialController.checkSpecial(csv.GuideProxy.SPECIAL_GUIDE_ID.MOUNTAIN);if(i){guide.GuideModel.getIns().specialGuideParams=[this.roleMediator.selectedIndex,e];guide.GuideModel.getIns().event(guide.GuideModel.GUIDE_SPECIAL,i.guide)}return}app.ProtocolRequest.UseExpReq(this.roleMediator.selectedRoleVo.insId,1,1)};t.prototype.onTexing=function(){app.ViewManager.toggleDialog(equip.ProfTipView,1,0,[this.roleMediator.selectedRoleVo.prof])};t.prototype.onDetail=function(){app.ViewManager.toggleDialog(l.RoleDetailAttributeView,1,0,this.roleMediator.selectedRoleVo)};t.prototype.onDisplay=function(){game.GridsModel.getIns().on(game.GridsModel.EVENTS.UPDATE,this,this.setLevel);game.RoleModel.getIns().on(game.RoleModel.EVENTS.LEVEL_CHANGE,this,this.setLevel);game.RoleModel.getIns().on(game.RoleModel.EVENTS.EXP_CHANGE,this,this.setLevel);game.RoleModel.getIns().on(game.RoleModel.EVENTS.PROP_CHANGE,this,this.onPropChange);game.RoleModel.getIns().on(game.RoleModel.EVENTS.SCORE_UPDATE,this,this.setScore);game.RoleModel.getIns().on(game.RoleModel.EVENTS.TUPOLV_CHANGE,this,this.setTupoInfo);game.RoleModel.getIns().on(game.RoleModel.EVENTS.USEEXP_RESULT_UPDATE,this,this.showUpLvEff);gaiming.GaiMingModel.getIns().on(gaiming.GaiMingEvent.OTHER_NAME_CHANGE,this,this.setRoleName);gaiming.GaiMingModel.getIns().on(gaiming.GaiMingEvent.MAIN_NAME_CHANGE,this,this.setRoleName);this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){game.GridsModel.getIns().off(game.GridsModel.EVENTS.UPDATE,this,this.setLevel);game.RoleModel.getIns().off(game.RoleModel.EVENTS.LEVEL_CHANGE,this,this.setLevel);game.RoleModel.getIns().off(game.RoleModel.EVENTS.EXP_CHANGE,this,this.setLevel);game.RoleModel.getIns().off(game.RoleModel.EVENTS.PROP_CHANGE,this,this.onPropChange);game.RoleModel.getIns().off(game.RoleModel.EVENTS.SCORE_UPDATE,this,this.setScore);game.RoleModel.getIns().off(game.RoleModel.EVENTS.TUPOLV_CHANGE,this,this.setTupoInfo);game.RoleModel.getIns().off(game.RoleModel.EVENTS.USEEXP_RESULT_UPDATE,this,this.showUpLvEff);gaiming.GaiMingModel.getIns().off(gaiming.GaiMingEvent.OTHER_NAME_CHANGE,this,this.setRoleName);gaiming.GaiMingModel.getIns().off(gaiming.GaiMingEvent.MAIN_NAME_CHANGE,this,this.setRoleName);this.skt&&this.skt.stop()};t.prototype.refreshAll=function(){if(this.dataSource&&this.dataSource.length==1){this.roleMediator.setData(Number(this.dataSource[0]),this._model.getRoleRedArr())}else{var t=0;var e=this._model.getRoleRedArr();for(var i=0;i<e.length;i++){if(e[i]){t=i;break}}this.roleMediator.setData(t,e)}this.setAvatar();this.setLevel();this.setSkills();this.setAttributes();this.setScore();this.setRoleName();this.setWuxing()};t.prototype.roleSelectChange=function(){this.setAvatar();this.setLevel();this.setSkills();this.setAttributes();this.setScore();this.setRoleName();this.setWuxing()};t.prototype.setAvatar=function(){var t;var e=skin.SkinModel.getIns().getEquipSkinId(this.roleMediator.selectedIndex+1);var i=csv.SkinProxy.getIns().getCfg(e);var n;if(i){t=i.modelres;n=i.scale/100}else{t=csv.DefclassProxy.getIns().getCfg(this.roleMediator.selectedRoleVo.prof).model;n=.6}if(this.skt&&this.skt.parent){this.skt.removeSelf()}else{this.skt=new common.CSkt}this.skt.init(l.RoleVO.getSkinSkt(t));this.skt.scale(n,n);this.weizhi.addChild(this.skt)};t.prototype.setLevel=function(){this.roleMediator.setRedArr(this._model.getRoleRedArr());var t=csv.LevelProxy.getIns().getCurrMaxLv(this.roleMediator.selectedRoleVo.tupoLv);this.labeldengji2.text=this.roleMediator.selectedRoleVo.level+"/"+t;var e=csv.LevelProxy.getIns().getCfg(this.roleMediator.selectedRoleVo.level);game.RedDotView.removeFrom(this.btnshengj);game.RedDotView.removeFrom(this.btnjinjie);if(t==this.roleMediator.selectedRoleVo.level){this.boxshengji.visible=false;this.boxjinjie.visible=true;var i=csv.LevelProxy.getIns().getBreakCost(e,this.roleMediator.selectedRoleVo.prof);this.tpCost.array=i;this.addLv=0;var n=csv.LevelProxy.getIns().getMatchSkillByTupoLv(this.roleMediator.selectedRoleVo.prof,this.roleMediator.selectedRoleVo.tupoLv+1);if(n){if(game.GridsModel.getIns().hasEnoughItems(i)&&e.teamlevel<=game.Context.teamLv){game.RedDotView.addTo(this.btnjinjie)}}}else{this.boxshengji.visible=true;this.boxjinjie.visible=false;var a=csv.LevelProxy.getIns().getCanAddInfo(this.roleMediator.selectedRoleVo.level,t);this.addLv=a[0];if(this.addLv){this.btnshengj.label=app.getLang("levelup_1",this.addLv);game.RedDotView.addTo(this.btnshengj)}else{this.btnshengj.label=app.getLang("levelup_1",1)}this.sjCost.array=a[1]}var o=[];if(this.roleMediator.selectedRoleVo.tupoLv){var s=csv.LevelProxy.getIns().getHuluStyle(this.roleMediator.selectedRoleVo.tupoLv);for(var r=0,l=5;r<l;r++){var h=void 0;if(r<s.count){h=csv.LevelProxy.HULU_ICONS[s.grade]}else{h=csv.LevelProxy.HULU_ICONS[s.grade-1]}if(h!=""){o.push(h)}}}this.centerLayout.array=o;var p=csv.LevelProxy.getIns().getMatchSkillByTupoLv(this.roleMediator.selectedRoleVo.prof,this.roleMediator.selectedRoleVo.tupoLv+1);if(p){var u=csv.LevelProxy.getIns().getFrontSkillByTupoLv(this.roleMediator.selectedRoleVo.prof,this.roleMediator.selectedRoleVo.tupoLv+1,app.str2Array(p.skill,"-")[0]);if(u){var c=csv.SkillProxy.getIns().getSkillByKey(p.skill);this.labeljiesuotishi.text=app.getLang("levelup_7",c.name,c.level)}else{var c=csv.SkillProxy.getIns().getSkillByKey(p.skill);this.labeljiesuotishi.text=app.getLang("levelup_3",c.name)}}else{this.labeljiesuotishi.text=""}};t.prototype.setSkills=function(){for(var t=0;t<csv.LevelProxy.SKILL_POS;t++){var e=csv.LevelProxy.getIns().getSkillByTupoLv(this.roleMediator.selectedRoleVo.prof,t+1,this.roleMediator.selectedRoleVo.tupoLv);this.skillArr[t].setData(e)}};t.prototype.setAttributes=function(t){if(t===void 0){t=false}var e=game.Context.roleList[this.roleMediator.selectedIndex];for(var i=0,n=equip.EquipStatic.ROLE_MAIN_ATTRIBUTE_SHOW.length;i<n;i++){var a=equip.EquipStatic.ROLE_MAIN_ATTRIBUTE_SHOW[i];var o=0;if(a==2){this.lblPropNames[i].text=app.getLang("攻击");if(e.attribute&&e.attribute[a]){o=Math.round(e.attribute[2]/1.1)}}else{this.lblPropNames[i].text=Attributes.getPropName(a);if(e.attribute&&e.attribute[a]){o=e.attribute[a]}}if(t){if(!this.runNums[i]){this.runNums[i]=new util.RunNum}this.runNums[i].play(this.lblPropValues[i],o)}else{this.runNums[i]&&this.runNums[i].stop();this.lblPropValues[i].text=o.toString()}}};t.prototype.setRoleName=function(){var t=game.Context.roleList[this.roleMediator.selectedIndex];this.namelab.text=t.getName();this.updateNameBoxPos();var e=csv.DefclassProxy.getIns().getCfg(this.roleMediator.selectedRoleVo.prof);if(e){this.btndingwei2.skin="juese/btn_dingwei_"+e.rolepic+".png"}};t.prototype.setWuxing=function(){var t=[];var e=csv.DefclassProxy.getIns().getCfg(this.roleMediator.selectedRoleVo.prof);if(e){t=e.roleattr.split("-")}this.wuxing.array=t;this.updateNameBoxPos()};t.prototype.updateNameBoxPos=function(){this.wuxing.x=this.namelab.x+this.namelab.width+2;var t=this.wuxing.length*this.wuxing.getCell(0).width;var e=this.namelab.width+t+2;this.boxmingzi.x=this.boxmingzi.pivotX+(this.width-e)*.5};t.prototype.setScore=function(){var t=game.Context.roleList[this.roleMediator.selectedIndex];this.zhanliclip.value=t.score+""};t.prototype.setTupoInfo=function(t,e){this.setSkills();var i=csv.LevelProxy.getIns().getCfg(this.roleMediator.selectedRoleVo.level-1);var n=csv.LevelProxy.getIns().getCfg(this.roleMediator.selectedRoleVo.level);var a=Attributes.decode(n["attributepre"+t]).baseList;if(i){var o=Attributes.decode(i["attributepre"+t]).baseList;a=Attributes.minuteAttributes(o,a)}var s=csv.LevelProxy.getIns().getMatchSkillByTupoLv(t,e);if(s){var r=csv.LevelProxy.getIns().getFrontSkillByTupoLv(t,e,app.str2Array(s.skill,"-")[0]);if(r){app.ViewManager.toggleDialog(l.RoleSkillTip2,1,0,[e,a,r.skill,s.skill])}else{app.ViewManager.toggleDialog(l.RoleSkillTip,1,0,[e,a,s.skill])}}};t.prototype.showUpLvEff=function(){this.jueseshengji.visible=true;this.jueseshengji.play()};t.prototype.onLvEffComplete=function(){this.jueseshengji.visible=false;this.jueseshengji.stop()};t.prototype.onWuxingRender=function(t,e){var i=t.dataSource;t.shuxing.skin="public/bg_wuxing_"+i+".png"};t.prototype.onPropChange=function(){this.setAttributes(true)};t.SINGLE_KEY="equip.RoleMainNewView";return t}(ui.juese.jueseUI);l.RoleMainNewView=t})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.hulu.renderHandler=new Laya.Handler(this,this.onHuluRender);this.centerMediator=new game.CenterLayoutMediator(this.hulu,this.box,71,this.hulu.spaceX);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.on(Laya.Event.CLICK,this,this.onShowTip)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){this._data=t;this._skillEle=csv.SkillProxy.getIns().getSkillByKey(t.ele.skill);this.gezi.setData(this._skillEle);this.gezi.shuzi.text=this.gezi.skillLv;this.labelmingzi.text=this.gezi.skillName;if(t.alive){this.zhezhao.visible=this.tiaojian.visible=this.box.visible=false}else{this.zhezhao.visible=this.tiaojian.visible=this.box.visible=true;this.tiaojian.text=app.getLang("levelup_5",t.ele.level);var e=[];if(t.ele.point==3){e=this.getHuluImgArr(2,1)}else if(t.ele.point==4){e=this.getHuluImgArr(4,1)}else{}this.centerMediator.array=e}};e.prototype.onShowTip=function(){var t=new SkillData;t.id=this._skillEle.skillid;t.lv=this._skillEle.level;t["alive"]=this._data.alive;tip.TipManager.showSkill(t)};e.prototype.onHuluRender=function(t,e){t.hulu.skin=t.dataSource};e.prototype.getHuluImgArr=function(t,e){var i=[];for(var n=0;n<t;n++){i.push("res/static/common/bg_hulu_0"+e+".png")}return i};e.SINGLE_KEY="role.RoleSkillItem";return e}(ui.juese.juesejinengitem1UI);t.RoleSkillItem=e})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(t){var i=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.effIndex=-1;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.centerLayout=new game.CenterLayoutMediator(this.laithulu,this.box,73,this.laithulu.spaceX);this.laithulu.itemRender=ui.juese.juesehuluitemUI;this.laithulu.renderHandler=new Laya.Handler(this,this.onHandler);this.bg01.width=Laya.stage.width};t.prototype.onHandler=function(e,t){e.hulu.skin=e.dataSource;if(this.effIndex!=-1&&t==this.effIndex){e.hulu.visible=false;e.hulu.scaleX=e.hulu.scaleY=0;var i=Laya.Pool.getItemByClass("effect_skill_hulu_bz",game.AniView);this.addChild(i);var n=this.dataSource[0];var a=n>5?e.x:(this.box.width-(t+1)*e.width)*.5+e.width*t;i.x=this.box.x+(a+e.width*.5);i.y=this.box.y+(e.y+e.height*.5);i.on(Laya.Event.COMPLETE,this,function t(){i.off(Laya.Event.COMPLETE,this,t);i.removeSelf();Laya.Pool.recover("effect_skill_hulu_bz",i);e.hulu.visible=true;app.MyTween.to(e.hulu,{scaleX:1,scaleY:1},300,Laya.Ease.linearNone)});i.load("skill_hulu_bz",game.AniView.FILE_NAME.UI);i.play(0,false)}};t.prototype.onDisplay=function(){guide.GuideModel.getIns().boOpen=false;this.callLater(this.refreshAll)};t.prototype.refreshAll=function(){var t=this.dataSource[0];var e=this.dataSource[1];var i=e.splice(0,3);this.lblprop2.text=Attributes.getShowLabels(e,"{0}+{1}",null," ");this.lblprop.text=Attributes.getShowLabels(i,"{0}+{1}",null," ");this.jineng.setData(this.dataSource[2],false,false,true);var n=[];var a=csv.LevelProxy.getIns().getHuluStyle(t);this.effIndex=-1;for(var o=0,s=5;o<s;o++){var r=void 0;if(o<a.count){r=csv.LevelProxy.HULU_ICONS[a.grade];this.effIndex=o}else{r=csv.LevelProxy.HULU_ICONS[a.grade-1]}if(r!=""){n.push(r)}}this.centerLayout.array=n;var l=csv.LevelProxy.getIns().getCurrMaxLv(t);this.tiaozhanlab1.text=app.getLang("levelup_2",l)};t.prototype.onUnDisplay=function(){guide.GuideModel.getIns().boOpen=true};t.SINGLE_KEY="jihuoma.RoleSkillTip";return t}(ui.juese.jinjiechenggongtipUI);t.RoleSkillTip=i;var e=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.effIndex=-1;return t}t.getIns=function(){return app.Singleton.getInstance(i)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.centerLayout=new game.CenterLayoutMediator(this.laithulu,this.box,71,this.laithulu.spaceX);this.laithulu.itemRender=ui.juese.juesehuluitemUI;this.laithulu.renderHandler=new Laya.Handler(this,this.onHandler);this.bg01.width=Laya.stage.width};t.prototype.onHandler=function(e,t){e.hulu.skin=e.dataSource;if(this.effIndex!=-1&&t==this.effIndex){e.hulu.visible=false;e.hulu.scaleX=e.hulu.scaleY=0;var i=Laya.Pool.getItemByClass("effect_skill_hulu_bz",game.AniView);this.addChild(i);var n=this.dataSource[0];var a=n>5?e.x:(this.box.width-(t+1)*e.width)*.5+e.width*t;i.x=this.box.x+(a+e.width*.5);i.y=this.box.y+(e.y+e.height*.5);i.on(Laya.Event.COMPLETE,this,function t(){i.off(Laya.Event.COMPLETE,this,t);i.removeSelf();Laya.Pool.recover("effect_skill_hulu_bz",i);e.hulu.visible=true;app.MyTween.to(e.hulu,{scaleX:1,scaleY:1},300,Laya.Ease.linearNone)});i.load("skill_hulu_bz",game.AniView.FILE_NAME.UI);i.play(0,false)}};t.prototype.onDisplay=function(){guide.GuideModel.getIns().boOpen=false;this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){guide.GuideModel.getIns().boOpen=true;for(var t=0;t<this.laithulu.array.length;t++){app.MyTween.clearTween(this.laithulu.getCell(t))}};t.prototype.refreshAll=function(){var t=this.dataSource[0];var e=this.dataSource[1];var i=e.splice(0,3);this.lblprop2.text=Attributes.getShowLabels(e,"{0}+{1}",null," ");this.lblprop.text=Attributes.getShowLabels(i,"{0}+{1}",null," ");this.jineng.setData(this.dataSource[2],false,false,true);this.jineng1.setData(this.dataSource[3],false,false,true);var n=[];var a=csv.LevelProxy.getIns().getHuluStyle(t);this.effIndex=-1;for(var o=0,s=5;o<s;o++){var r=void 0;if(o<a.count){r=csv.LevelProxy.HULU_ICONS[a.grade];this.effIndex=o}else{r=csv.LevelProxy.HULU_ICONS[a.grade-1]}if(r!=""){n.push(r)}}this.centerLayout.array=n;var l=csv.LevelProxy.getIns().getCurrMaxLv(t);this.tiaozhanlab1.text=app.getLang("levelup_2",l)};t.SINGLE_KEY="jihuoma.RoleSkillTip2";return t}(ui.juese.jinjiechenggongtip2UI);t.RoleSkillTip2=e})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("bubbleicon.csv");this.bubbleMap=t.getMap("id");this.bubbleArr=t.getArray()};e.prototype.getBubbleIcon=function(t){if(typeof t=="number"){t=this.getCfg(t)}else if(typeof t=="string"){t=this.getCfg(parseInt(t))}return"res/static/qipaokuang/"+t.icon+".png"};e.prototype.getCfg=function(t){return this.bubbleMap[t]};e.SINGLE_KEY="csv.ChatBubbleProxy";return e}(app.ModelBase);t.ChatBubbleProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("defclass.csv");this.cfgMap=t.getMap("id");this.cfgArr=t.getArray();var e=app.Config.getResById("create_role.csv");this.cfgCreate=e.getMap("role");var i=app.Config.getResById("hlxd_yd.csv");this.hlxd_yd=i.getMap("id")};e.prototype.getCfgCreate=function(t){return this.cfgCreate[t]};e.prototype.getCfg=function(t){return this.cfgMap[t]};e.prototype.getNameRes=function(t){return"res/static/main/"+this.getCfg(t).nameres+".png"};e.prototype.boRemote=function(t){return this.getCfg(t).distance>e.REMOTE_DIS};e.prototype.getRebirthRoles=function(t){var e=[];var i=this.cfgArr;var n="firstcreate";if(t==2){n="secondcreate"}else if(t==3){n="thirdcreate"}else if(t==4){n="forthcreate"}else if(t==5){n="fifthcreate"}for(var a=0,o=i.length;a<o;a++){var s=i[a];s.createParam=s[n]==0;if(s["show"]==0){e.push(s)}}return e};e.prototype.gethlxdCfg=function(t){return this.hlxd_yd[t]};e.SINGLE_KEY="csv.DefclassProxy";e.REMOTE_DIS=6;return e}(app.ModelBase);t.DefclassProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("magicweaponicon.csv");this.cfgMap=t.getMap("id");this.cfgArr=t.getArray()};e.prototype.getIcon=function(t){if(typeof t=="number"){t=this.getCfg(t)}else if(typeof t=="string"){t=this.getCfg(parseInt(t))}return"res/static/qipaokuang/"+t.icon+".png"};e.prototype.getCfg=function(t){return this.cfgMap[t]};e.prototype.getRes=function(t){return"res/icon/magicweapon_guajian/guajian_"+t+".png"};e.SINGLE_KEY="csv.GuajianProxy";return e}(app.ModelBase);t.GuajianProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("pictureframe.csv");this.cfgMap=t.getMap("id");this.cfgArray=t.getArray()};e.prototype.getCfg=function(t){return this.cfgMap[t]};e.prototype.getArray=function(){return this.cfgArray};e.prototype.getIcon=function(t){if(t>0){return"res/static/touxiangkuang/"+this.getCfg(t).useshow+".png"}return""};e.SINGLE_KEY="csv.HeadFrameProxy";return e}(app.ModelBase);t.HeadFrameProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("level.csv");var e=t.getArray();this.maxLev=e.length;var i=0;var n=1;this.cfgMap={};this.tupoMap={};for(var a=0;a<this.maxLev;a++){var o=e[a];this.cfgMap[o.level]=o;if(o.break==""){continue}this.tupoMap[i]={min:n,max:o.level};n=o.level+1;i++}this.initExpGetWay();this.initSkill()};e.prototype.getCfg=function(t){return this.cfgMap[t]};e.prototype.getBreakCost=function(t,e){return game.ItemUtil.parserList(t.break,e)};e.prototype.getHuluStyle=function(t){var e=Math.ceil(t/5);var i=t%5;return{grade:e,count:i?i:5}};e.prototype.getCurrMaxLv=function(t){var e=this.tupoMap[t];if(!e){e=this.tupoMap[0]}return e.max};e.prototype.getCanAddInfo=function(t,e){var i=0;var n=0;var a=[];for(var o=t;o<e;o++){var s=this.getCfg(o);var r=n+s.exp;var l=game.ItemUtil.parserList(s.breakmoney).concat(a);l=game.ItemUtil.hebingItems(l);if(r>game.Context.exp||!game.GridsModel.getIns().hasEnoughItems(l)){if(i==0){n=r;a=l}break}n=r;a=l;i++;if(i==5){break}if(t>=game.Config.getIntParams(1222)){break}}var h=game.ItemUtil.createVO(8003);h.setCount(n);a.unshift(h);return[i,a]};e.prototype.getBubbleExp=function(t){var e=this.getCfg(t);if(e){return e.actexp}return 0};e.prototype.getAllItemExp=function(){var t=0;for(var e=0,i=game.Context.roleList.length;e<i;e++){var n=game.Context.roleList[e].level;var a=this.getCfg(n);if(a){t+=a.itemexp}}return t};e.prototype.getAllItemMoney=function(){var t=0;for(var e=0,i=game.Context.roleList.length;e<i;e++){var n=game.Context.roleList[e].level;var a=this.getCfg(n);if(a){t+=a.itemmoney}}return t};e.prototype.initExpGetWay=function(){var t=app.Config.getResById("expgateway.csv");this.expArr=t.getArray()};e.prototype.initSkill=function(){var t=app.Config.getResById("levelupskill.csv");var e=t.getArray();this.skillMap={};for(var i=0,n=e.length;i<n;i++){var a=e[i];if(!this.skillMap[a.role]){this.skillMap[a.role]=[]}this.skillMap[a.role].push(a)}};e.prototype.getSkillByTupoLv=function(t,e,i){var n=this.skillMap[t];var a;var o=false;for(var s=0,r=n.length;s<r;s++){var l=n[s];if(l.point!=e){continue}if(!a){a=l}if(l.level>i){break}o=true;a=l}return{alive:o,ele:a}};e.prototype.getMatchSkillByTupoLv=function(t,e){var i;var n=this.skillMap[t];for(var a=0,o=n.length;a<o;a++){var s=n[a];if(s.level==e){i=s;break}}return i};e.prototype.getFrontSkillByTupoLv=function(t,e,i){var n;var a=this.skillMap[t];for(var o=0,s=a.length;o<s;o++){var r=a[o];if(r.level>=e){break}if(i==app.str2Array(r.skill,"-")[0]){n=r}}return n};e.SINGLE_KEY="csv.LevelProxy";e.HULU_ICONS=["","res/static/common/bg_hulu_01.png","res/static/common/bg_hulu_02.png","res/static/common/bg_hulu_03.png","res/static/common/bg_hulu_04.png","res/static/common/bg_hulu_05.png","res/static/common/bg_hulu_06.png"];e.SKILL_POS=4;return e}(app.ModelBase);t.LevelProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){this._sceneMap={};this._voMap=[];var t=app.Config.getResById("trapmachine.csv");this.cfgMap=t.getMap("id");this.cfgArr=t.getArray();var e=t.getArray();for(var i=0;i<e.length;++i){var n=e[i];if(!this._sceneMap[n.map]){this._sceneMap[n.map]=[]}var a=new scene.TrapMachineVO;a.mapId=n.map;a.posX=n.x1;a.posY=n.y1;a.dir=n.dir;a.setCfg(n);a.insId=Uint64.initClientUint64();this._sceneMap[n.map].push(a);this._voMap[n.id]=a}};e.prototype.getMachine=function(t){return this.cfgMap[t]};e.prototype.getMachineList=function(t){var e=this._sceneMap[t]||[];return e};e.prototype.getVO=function(t){var e=this._voMap[t];return e};e.getName=function(t){if(!t){return""}return app.getLang(t.npcname)};e.getSceneUrl=function(t){return"res/atlas/ani/"+t.model+".atlas"};e.prototype.createControl=function(t){if(!this._controlMap){var e=app.Config.getResById("trapcontrol.csv");this._controlMap=e.getMap("mapid")}return this._controlMap[t]};e.prototype.getArea=function(t){if(!this._areaMap){var e=app.Config.getResById("traparea.csv");this._areaMap=e.getMap("id")}return this._areaMap[t]};e.prototype.getTrigger=function(t){if(!this._triggerMap){var e=app.Config.getResById("traptrigger.csv");this._triggerMap=e.getMap("id")}return this._triggerMap[t]};e.prototype.getHurt=function(t){if(!this._hurtMap){var e=app.Config.getResById("traphurt.csv");this._hurtMap=e.getMap("id")}return this._hurtMap[t]};e.SINGLE_KEY="csv.MapTrapProxy";return e}(app.ModelBase);t.MapTrapProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var game;(function(e){var t=function(t){__extends(i,t);function i(){return t!==null&&t.apply(this,arguments)||this}i.getIns=function(){return app.Singleton.getInstance(i)};i.prototype.init=function(){this.moneyList=[]};i.prototype.setMoney=function(t,e){if(this.moneyList[t]!=e){this.moneyList[t]=e;this.event(i.EVENTS.MONEY_CHANGE,t)}};i.prototype.getMoney=function(t){if(t==e.MoneyModel.MONEY_ENUM.EXP){return e.Context.exp}return this.moneyList[t]||0};i.prototype.getMoneyByItemId=function(t){return this.getMoney(csv.ItemProxy.getSubType(t))};i.prototype.hasEnoughMoneyItem=function(t,e,i){if(i===void 0){i=false}var n=this.getMoneyByItemId(e);if(n<t){if(i){var a=csv.ItemProxy.getName(e);manager.FlowManager.instance.flowByStyle1(app.getLang("{0}不足",a))}return false}return true};i.format=function(t){var e="";if(t==0){return"0"}else if(t<1e5){return t.toString()}else if(t>=1e5&&t<1e9){e=(Math.floor(t/1e3)/10).toString();return e+app.getLang("exp_order_1")}else{e=(Math.floor(t/1e7)/10).toString();return e+app.getLang("exp_order_2")}};i.formatZheng=function(t){var e="";if(t==0){return"0"}else if(t<1e5){return t.toString()}else if(t>=1e5&&t<1e9){e=Math.floor(t/1e4).toString();return e+app.getLang("exp_order_1")}else{e=Math.floor(t/1e8).toString();return e+app.getLang("exp_order_2")}};i.formatFix=function(t,e,i){if(e===void 0){e=2}if(i===void 0){i=1e4}var n="";if(t<i){return t.toString()}else if(t>=i&&t<1e8){n=this.setFixNum(t/i,e);return n+app.getLang("exp_order_1")}else{n=this.setFixNum(t/1e8,e);return n+app.getLang("exp_order_2")}};i.formatTenFix=function(t){var e="";if(t==0){return"0"}else if(t<1e4){e=this.changeTenNum(t);return e}else if(t>=1e4&&t<1e8){e=this.changeTenNum(t/1e4);return e+app.getLang("exp_order_1")}else{e=this.changeTenNum(t/1e8);return e+app.getLang("exp_order_2")}};i.changeTenNum=function(t,e,i){if(e===void 0){e=true}if(i===void 0){i=2}var n="";var a=t.toString().split(".");var o=parseInt(a[0]);if(o<10){if(a.length==1){n=a[0]}else{if(!e){n=a[0]+"."+a[1].slice(0,i)}else{n=t.toFixed(i)}}}else{if(a[1]){if(e){var s=parseInt(a[1][0]);if(s>=5){o++}}}n=o.toString()}return n};i.setFixNum=function(t,e){if(t.toString().split(".")[1]){return t.toFixed(e)}else{return t}};i.roleScoreNum=function(t){var e="";if(t==0){return"0"}else if(t<1e4){return t.toString()}else if(t>=1e4&&t<1e8){e=this.changeTenNum(t/1e4,false,1);return e+app.getLang("exp_order_1")}else{e=this.changeTenNum(t/1e8,false,1);return e+app.getLang("exp_order_2")}};i.SINGLE_KEY="game.MoneyModel";i.EVENTS={MONEY_CHANGE:"money_change"};i.MONEY_ENUM={GOLD:1,CHARGE_COIN:2,SILVER:3,EXP:4,PET:6,SKILL:7,GUILD_DEVOTE:8,GUILD_MONEY:9,RONGYU:10,ACHIEVE:11,XIN_FA_EXP:13,DOUBAO_SHANG_CHENG:19,TANBAO:26,FRIENDS:28,KUA_FU_RONGYU:29,ZHULINGZHI:30,YISHOU__MONEY:35};return i}(app.ModelBase);e.MoneyModel=t})(game||(game={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(n,t);function n(){return t!==null&&t.apply(this,arguments)||this}n.getIns=function(){return app.Singleton.getInstance(n)};n.prototype.init=function(){var t=app.Config.getResById("monster.csv");this.cfgMap=t.getMap("monid");this.cfgArr=t.getArray();var e=app.Config.getResById("monstersetbase.csv");this.monsterBaseMap=e.getMap("id")};n.prototype.getArr=function(){return this.cfgArr};n.prototype.getCfg=function(t){return this.cfgMap[t]};n.prototype.getMonsterBase=function(t){return this.monsterBaseMap[t]};n.prototype.getMonsterWuxingHead=function(t){return"res/touxiang/"+this.getMonsterBase(t).head+".png"};n.prototype.getMonsterPos=function(t){var e=this.getMonsterBase(t);var i=app.str2Array(e.battleset,";","-");var n=parseInt(i[0][0]);var a=parseInt(i[0][1]);return new Laya.Point(n,a)};n.prototype.getMidsByMset=function(t,e){var i=this.getMonsterBase(t);var n=app.str2Array(i.battleset,";","-");var a=[];for(var o=0,s=n.length;o<s;o++){var r=parseInt(n[o][2]);var l=csv.BattleGroupProxy.getIns().getCfg(r);var h=app.str2Array(l.monster,";","-");for(var p=0,u=h.length;p<u;p++){if(h[p]==""){continue}var c=parseInt(h[p][1]);if(a.indexOf(c)==-1){a.push(c)}}}return a};n.formatCfg=function(t){if(typeof t=="number"){t=csv.MonsterProxy.getIns().getCfg(t)}else if(typeof t=="string"){t=csv.MonsterProxy.getIns().getCfg(parseInt(t))}return t};n.getMonsterName=function(t){t=n.formatCfg(t);return app.getLang(t.monname)};n.getMonsterLvName=function(t){t=n.formatCfg(t);return app.getLang(t.monname)+("("+t.monlevel+app.getLang("级")+")")};n.getMonsterHeadUrl=function(t){t=n.formatCfg(t);return"res/touxiang/"+t.monicon+".png"};n.getMonsterModelUrl=function(t,e,i){if(e===void 0){e=avatar.AvatarAnimation.ANI_ENUMS.IDLE}if(i===void 0){i=7}t=n.formatCfg(t);return"res/atlas/ani/monster/"+t.res+"_"+e+"_"+game.SceneModel.getSimpleDir(i)+".atlas"};n.SINGLE_KEY="csv.MonsterProxy";n.MON_TYPE={STUPID:3};return n}(app.ModelBase);t.MonsterProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("teamicon.csv");this.teamIconMap=t.getMap("id");this.teamioncArr=t.getArray();var e=app.Config.getResById("teamlevel.csv");this.teamExpMap=e.getMap("teamlevel")};e.prototype.getCfg=function(t){return this.teamIconMap[t]};e.prototype.getTeamIcon=function(t){if(this.teamIconMap[t]){return"res/static/head/"+this.teamIconMap[t].icon+".png"}return""};e.prototype.getTeamIconName=function(t){if(this.teamIconMap[t]){return"res/static/skin/"+this.teamIconMap[t].iconword+".png"}return""};e.prototype.getTeamMaxExp=function(t){return this.teamExpMap[t].exp};e.prototype.getTupoTimeByTeamLv=function(t){return this.teamExpMap[t].tupocishi};e.prototype.getDefaultTeamIcon=function(){return"res/static/head/bg_head_kong.png"};e.SINGLE_KEY="csv.MyTeamProxy";return e}(app.ModelBase);t.MyTeamProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e;(function(t){t[t["ICE_NPC"]=1]="ICE_NPC"})(e=t.NPC_SHOW_TYPE||(t.NPC_SHOW_TYPE={}));var i=function(t){__extends(l,t);function l(){return t!==null&&t.apply(this,arguments)||this}l.getIns=function(){return app.Singleton.getInstance(l)};l.prototype.init=function(){var t=app.Config.getResById("npc.csv");if(!t){return}this.cfgMap=t.getMap("npcid");this.cfgArr=t.getArray();this._sceneMap={};this._voMap=[];this.funcNpcMap={};var e=t.getArray();for(var i=0;i<e.length;++i){var n=e[i];if(!this._sceneMap[n.npcmap]){this._sceneMap[n.npcmap]=[]}var a=new role.NpcVO;a.mapId=n.npcmap;a.posX=n.x1;a.posY=n.y1;a.dir=n.dir;a.setCfg(n);a.insId=new Uint64(n.npcid,Uint64.MAX_UINT32);if(n.npctype==l.ENUM_TYPE.FUNC){a.control=new role.NpcFuncControl;var o=app.str2Array(n.param1,";");for(var s=0,r=o.length;s<r;s++){this.funcNpcMap[o[s]]=n.npcid}}else if(n.npctype==l.ENUM_TYPE.BOSS){a.control=new role.NpcBossControl}else if(n.npctype==l.ENUM_TYPE.ACTIVITY){a.control=new role.NpcActControl}else if(n.npctype==l.ENUM_TYPE.TYPE_ISLAND_MONSTER_NPC){a.control=new role.NpcBossHldControl}else if(n.npctype==l.ENUM_TYPE.TYPE_ISLAND_COLLECT){a.control=new role.NpcCollectHldControl}else if(n.npctype==l.ENUM_TYPE.BUILD){a.control=new role.NpcBuildControl}else if(n.npctype==l.ENUM_TYPE.BUILD){a.control=new role.NpcBuildControl}else if(n.npctype==l.ENUM_TYPE.HOME_EVENT){a.control=new role.NPCHomeEventControl}else{a.control=new role.NpcBaseControl}this._sceneMap[n.npcmap].push(a);this._voMap[a.getCfgId()]=a}};l.prototype.getCfg=function(t){return this.cfgMap[t]};l.prototype.getMapNpcList=function(t){var e=this._sceneMap[t]||[];var i=scene.SceneMediator.getInstance().huludaoRoleList;if(i&&i.length>0){e=e.concat(i)}return e};l.prototype.getMapCollectList=function(t){var e=scene.SceneMediator.getInstance().collectList;return e};l.prototype.getBossMap=function(t){var e;for(var i=0,n=this.cfgArr.length;i<n;i++){var a=this.cfgArr[i];if(parseInt(a.npctype)==l.ENUM_TYPE.BOSS&&parseInt(a.param1)==t){e=a;break}}return e};l.prototype.getNpcVO=function(t){var e=this._voMap[t];if(!e){console.log("npc: "+t+" 不存在,npc.csv 或 monstersetbase.csv 未配置")}return e};l.getName=function(t){if(!t){return""}return app.getLang(t.npcname)};l.getSceneUrl=function(t){if(!t.model){}if(!t||!t.model){return""}return"res/atlas/ani/"+t.model+".atlas"};l.SINGLE_KEY="csv.NpcProxy";l.ENUM_TYPE={FUNC:1,BOSS:2,ACTIVITY:3,TYPE_ISLAND_MONSTER_NPC:4,TYPE_ISLAND_COLLECT:5,BUILD:6,HOME_EVENT:7};return l}(app.ModelBase);t.NpcProxy=i})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var game;(function(t){var e=function(t){__extends(i,t);function i(){return t!==null&&t.apply(this,arguments)||this}i.getIns=function(){return app.Singleton.getInstance(i)};i.prototype.init=function(){};i.prototype.isActive=function(){return!!this.talkNpc};i.prototype.inTalkDistance=function(t,e,i,n,a){if(a===void 0){a=20}return Math.abs(t-i)+Math.abs(e-n)<a};i.prototype.ineffective=function(){this.talkNpc=null;this.event(i.EVENTS.INEFFECTIVE)};i.prototype.effective=function(t,e){this.talkNpc=t;this.talkData=e;this.event(i.EVENTS.EFFECTIVE)};i.SINGLE_KEY="game.NpcTalkModel";i.EVENTS={EFFECTIVE:"effective",INEFFECTIVE:"ineffective"};return i}(app.ModelBase);t.NpcTalkModel=e})(game||(game={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var game;(function(g){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.wuxingAttributes={};t.aliveWuxingSkills=[];t.score=0;t.title=0;return t}t.getIns=function(){if(!t._sin){t._sin=new t}return t._sin};t.prototype.init=function(){};Object.defineProperty(t.prototype,"reOpenFuncId",{set:function(t){this._reOpenFuncId=t;g.SceneModel.createAllScreenSp(0,0);Laya.timer.once(3e3,this,this.removeScreenSp)},enumerable:true,configurable:true});t.prototype.removeScreenSp=function(){g.SceneModel.clearAllScreenSp()};t.prototype.addOpenLister=function(){Laya.timer.clear(this,this.removeScreenSp);g.SceneModel.clearAllScreenSp();g.Context.on(g.ContextEvent.DIALOG_CLOSE_COMPLETE,this,this.reOpen)};t.prototype.reOpen=function(){g.Context.off(g.ContextEvent.DIALOG_CLOSE_COMPLETE,this,this.reOpen);if(this._reOpenFuncId){Laya.timer.once(200,this,this.laterCall)}};t.prototype.laterCall=function(){g.ClosureManager.callFunction(this._reOpenFuncId);this._reOpenFuncId=null};t.prototype.dellOtherPlayerInfo=function(t){this.otherBattleRoleList=[];this.otherRoleList=[];this._otherRoleMap={};this._otherEquipMap={};this._otherFabaoMap={};this._otherFabaoWearMap={};this.otherGuildName=t.gname;this.otherTeamName=t.name;this.exp=t.teamexp.toNumber();this.teamLv=t.teamlv;this.totalexp=csv.MyTeamProxy.getIns().getTeamMaxExp(g.Context.teamLv);this.teamAvatar=t.simpleteamavatar;this.headframeId=t.headframeId;this.title=t.title;var e=t.magicPlugin[0];if(e){this.guajianIds=e.magicPlugin;this.guajianMagicList=e.magicList}else{this.guajianIds=[];this.guajianMagicList=[]}for(var i=0,n=t.eprop.length;i<n;i++){var a=t.eprop[i];this.wuxingAttributes[a.src]=a.attribute}this.aliveWuxingSkills=t.eid;this.selectWuxingSkill=t.useid;for(var i=0,n=t.roleinf.length;i<n;i++){var o=t.roleinf[i];var s=o.uid.toString();this._otherRoleMap[s]=o;var r=role.RoleVO.parserShowInfo(o);r.playername=t.name;r.attribute=o.attribute;r.score=o.score.toNumber();this.otherRoleList.push(r);if(r.infight){this.otherBattleRoleList.push(r)}this._otherEquipMap[s]=[];for(var l=0,h=o.itempack.length;l<h;l++){var p=o.itempack[l];var u=g.ItemUtil.createVO(p.itemId,p);this._otherEquipMap[s][u.pos]=u}for(var l=0,h=o.magicw.length;l<h;l++){var p=o.magicw[l];var c=new fabaonew.FaBaoNewVo;c.cfg=csv.ChouKaProxy.getIns().getBaseCfg(p.magicCfgID);c.star=p.star;c.level=p.level;c.isActive=p.active;this._otherFabaoMap[p.magicCfgID]=c}for(var l=0,h=o.magicwequip.length;l<h;l++){var p=o.magicwequip[l];if(!this._otherFabaoWearMap[p.combatPos]){this._otherFabaoWearMap[p.combatPos]={}}this._otherFabaoWearMap[p.combatPos][p.index]=p.magicCfgID}}};t.prototype.getOtherRoleEquipVo=function(t,e){return this._otherEquipMap[t.toString()][e]};t.prototype.getResonates=function(t,e,i){if(e==csv.EquipProxy.RESONATE.QIANGHUA){return csv.EquipProxy.getIns().getResonate1Ids(t)}else if(e==csv.EquipProxy.RESONATE.CUILIAN){return csv.EquipProxy.getIns().getResonate2Ids(t)}return csv.EquipProxy.getIns().getResonate3Ids(t,i)};t.prototype.getFabaoWear=function(t,e){if(this._otherFabaoWearMap[t]&&this._otherFabaoWearMap[t][e]){return this._otherFabaoMap[this._otherFabaoWearMap[t][e]]}return null};t.SINGLE_KEY="game.OtherRoleModel";return t}(app.ModelBase);g.OtherRoleModel=t})(game||(game={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var game;(function(s){var t=function(e){__extends(n,e);function n(){var t=e!==null&&e.apply(this,arguments)||this;t._openListIds=[];t._isInit=true;t.trainTimes=0;t.trainTotalTimes=0;t._newTeamAvatar=[];t._newheadframeId=[];return t}n.getIns=function(){if(!n._sin){n._sin=new n}return n._sin};n.prototype.init=function(){this.scoreInfo=[];this.headframeList=[];this._newUid=[];this.aliveBubbleIds=[];this.newGujianIds=[];this.useGuajianIds=[];this.aliveGuajianIds=[]};Object.defineProperty(n.prototype,"mainRoleId",{get:function(){return this._mainRoleId},set:function(t){this._mainRoleId=t},enumerable:true,configurable:true});n.prototype.updataLevelUpRed=function(){var t=false;for(var e=1,i=s.Context.roleList.length;e<=i;++e){if(this.getRoleLevelUpRed(e)){t=true;break}}if(t){s.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.ROLE_MAIN)}else{s.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.ROLE_MAIN)}};n.prototype.getRoleRedArr=function(){var t=[];for(var e=1,i=s.Context.roleList.length;e<=i;++e){var n=this.getRoleLevelUpRed(e);t.push(n)}return t};n.prototype.getRoleLevelUpRed=function(t){var e=s.Context.roleList[t-1];var i=csv.LevelProxy.getIns().getCurrMaxLv(e.tupoLv);var n=csv.LevelProxy.getIns().getCfg(e.level);if(i==e.level){var a=csv.LevelProxy.getIns().getBreakCost(n,e.prof);if(s.GridsModel.getIns().hasEnoughItems(a)&&n.teamlevel<=s.Context.teamLv){return true}}else{if(n&&s.Context.exp>n.exp&&s.GridsModel.getIns().hasEnoughItems(n.breakmoney)){return true}}return false};n.prototype.onStatusItemUpdate=function(t,e){this.buffGroup=t;this.bless=e;this.event(n.EVENTS.PLAYER_BUFF_CHANGE)};n.prototype.getStatusGroup=function(t){var e;var i=s.RoleModel.getIns().buffGroup;if(i&&i.length>0){i.forEach(function(a,t,e){if(a.sitem){a.sitem.forEach(function(t,e,i){var n=a.gtime+t.stime-s.Context.getServerTime();if(n<=0){i.splice(e,1)}});if(a.sitem.length==0){e.splice(t,1)}}})}for(var n=0,a=i.length;n<a;n++){if(i[n].groupid==s.Config.getIntParams(1)){e=i[n];break}}return e};n.prototype.hasExpBuffStatus=function(){var t=this.buffGroup;var e=false;if(t){for(var i=0;i<t.length;i++){if(t[i].sitem){for(var n=0;n<t[i].sitem.length;n++){var a=csv.StatusProxy.getIns().getStatusItem(t[i].sitem[n].sid);if(a&&parseInt(a.mutexgroup)==1){e=true;break}}if(e){break}}}}return e};n.prototype.hasQuickbattlebuff=function(){var t=this.buffGroup;var e;if(t){for(var i=0;i<t.length;i++){if(t[i].sitem){for(var n=0;n<t[i].sitem.length;n++){var a=csv.StatusProxy.getIns().getStatusItem(t[i].sitem[n].sid);if(a&&parseInt(a.id)==1204){var o=t[i].gtime+t[i].sitem[n].stime-s.Context.getServerTime();if(o>0){e=t[i];break}}}if(e){break}}}}return e};n.prototype.dellFuncOpenList=function(t){this._openListIds=t;if(this._isInit==false){csv.FunctionsProxy.getIns().onFuncListChange()}else{csv.FunctionsProxy.getIns().initFunctions()}this._isInit=false};n.prototype.checkIfIgnoreOpen=function(t){if(t.opened==""){return false}var e=app.str2Array(t.opened,";");for(var i=0,n=e.length;i<n;i++){var a=parseInt(e[i]);if(this._openListIds.indexOf(a)!=-1){return true}}return false};n.prototype.updateTrainTimes=function(t){s.RoleModel.getIns().result=0;var e=boss.BossModel.getIns().getDailyTime(csv.DailyTimeProxy.ENUM_TYPE.QUICK_GUAJI);this.trainTimes=e.fnum;this.trainTotalTimes=t;this.onRedDotChange();this.event(s.RoleModel.EVENTS.ROLE_OFFLINE_AWARD_ITEM_UPDATE)};n.prototype.onRedDotChange=function(){var t=boss.BossModel.getIns().getDailyTime(csv.DailyTimeProxy.ENUM_TYPE.QUICK_GUAJI);if(t.fnum>0){s.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.QUICK_GUAJI)}else{s.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.QUICK_GUAJI)}};n.prototype.onTrain=function(){if(this.getTrainTimes()>0){var t=boss.BossModel.getIns().getDailyTime(csv.DailyTimeProxy.ENUM_TYPE.QUICK_GUAJI);if(t.fnum==0){var e=csv.DailyTimeProxy.getIns().buytime(csv.DailyTimeProxy.ENUM_TYPE.QUICK_GUAJI);var i=void 0;if(t.bnum>=e){i=csv.DailyTimeProxy.getIns().buycost(csv.DailyTimeProxy.ENUM_TYPE.QUICK_GUAJI,e)}else{i=csv.DailyTimeProxy.getIns().buycost(csv.DailyTimeProxy.ENUM_TYPE.QUICK_GUAJI,t.bnum+1)}var n=s.GridsModel.getIns().getItemCount(i[0]);if(n<i[1]){var a=csv.ItemProxy.getName(i[0]);manager.FlowManager.instance.flowByStyle1(app.getLang("item_not_enough",a));return}}if(this.result==0){this.result=1;app.ProtocolRequest.QuickHangUpInfoReq()}}else{manager.FlowManager.instance.flowByStyle1(app.getLang("vipboss_button_2"))}};n.prototype.getTrainTimes=function(){var t=boss.BossModel.getIns().getDailyTime(csv.DailyTimeProxy.ENUM_TYPE.QUICK_GUAJI);var e=csv.VipProxy.getIns().getVipPri(csv.PRI_TYPE.QUICK_GUAJI_TIME,vipcode.VipModel.getIns().vipLvl);return e+t.fnum-t.bnum};n.prototype.checkAddRoleCondiion=function(t){var e=csv.DefclassProxy.getIns().getCfgCreate(t);var i=false;if(e){var n=0;if(e.type==1){n=dailytask.DailyTaskModel.getIns().taskMainId}else if(e.type==2){n=mountain.MountainModel.getIns().mountainId}else if(e.type==3){n=achievement.AchievementModel.getIns().spoint}if(n>=e.value){i=true}}return i};n.prototype.addRoleCheck=function(){var t=false;var e=s.Context.roleList.length+1;if(e<=s.Context.TOTAL_ROLE_NUM){var i=0;var n=csv.DefclassProxy.getIns().getCfgCreate(e);if(n&&n.type==1){var a=csv.DungeonProxy.getIns().getZxrwCfg(n.value);i=a.teamlevel}if(this.checkAddRoleCondiion(e)&&s.Context.isTeamLvReach(i)){t=true}}return t};n.prototype.onShowRoleUnlockView=function(){if(s.Context.getMapType()==csv.MapProxy.MAP_TYPE.GUAJI||s.Context.getMapType()==csv.MapProxy.MAP_TYPE.HOME){if(csv.FunctionsProxy.getIns().isOpen(csv.FunctionsProxy.ENUMS.TASK_MAIN,true)){app.ViewManager.toggleDialog(role.RoleChooseView,1,0)}}else{manager.FlowManager.instance.flowByStyle1(app.getLang("create_fuben"))}};n.prototype.updateScroe=function(){if(!fabaonew.FaBaoNewModel.getIns().magicCfgList){return}s.Context.score=0;for(var t=0,e=s.Context.roleList.length;t<e;t++){var i=s.Context.roleList[t];s.Context.score+=i.score}s.Context.score+=this.otherScore||0;this.event(n.EVENTS.SCORE_UPDATE);if(window["wx"]){window["wx"].setUserCloudStorage({KVDataList:[{key:"score",value:s.Context.score.toString()}],fail:function(t){console.log("updateScroe:"+JSON.stringify(t))}})}};n.prototype.getHeadframeList=function(){if(!this.headframeList){this.headframeList=[];var t=csv.HeadFrameProxy.getIns().getArray();for(var e=0,i=t;e<i.length;e++){var n=i[e];var a=new HeadFrameData;a.headframeId=n.id;a.activeTime=0;a.state=0;this.headframeList.push(a)}}return this.headframeList};n.prototype.onHeadFramePastDueNotice=function(t){var e=this.getHeadFrameDataById(t);e.state=0;e.activeTime=0;s.RoleModel.getIns().event(s.RoleModel.EVENTS.HEADFRAME_UPDATE)};n.prototype.onHeadFrameActiveNotice=function(t){var e=this.getHeadFrameDataById(t);e.state=1;e.activeTime=s.Context.getServerTime();s.RoleModel.getIns().event(s.RoleModel.EVENTS.HEADFRAME_UPDATE);var i=this.newheadframeId;i.push(t);this.newheadframeId=i};n.prototype.getHeadFrameDataById=function(t){var e;for(var i=0;i<this.headframeList.length;i++){if(this.headframeList[i].headframeId==t){e=this.headframeList[i];break}}return e};n.prototype.onHeadFrameListUpdate=function(t){this.headframeList=t};n.prototype.onHeadFrameIdUpdate=function(t){this.headFrameId=t;s.Context.mainRole.headframeId=t;this.event(s.RoleModel.EVENTS.HEADFRAMEID_CHANGE)};n.prototype.onHeadFrameEquipReq=function(t){if(t&&t.state==1){if(t.headframeId==s.RoleModel.getIns().headFrameId){app.ProtocolRequest.HeadFrameEquipReq(0)}else{app.ProtocolRequest.HeadFrameEquipReq(t.headframeId)}}};Object.defineProperty(n.prototype,"newTeamAvatar",{get:function(){return this._newTeamAvatar},set:function(t){this._newTeamAvatar=t;this.onTeamAvatarRedDotChange()},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"newUid",{get:function(){return this._newUid},set:function(t){this._newUid=t;this.onNewUidRedDotChange()},enumerable:true,configurable:true});n.prototype.onTeamAvatarRedDotChange=function(){var t=false;if(this._newTeamAvatar.length>0){s.ClosureManager.addXin(csv.FunctionsProxy.ENUMS.TEAM_ICON)}else{s.ClosureManager.removeXin(csv.FunctionsProxy.ENUMS.TEAM_ICON)}return t};n.prototype.onNewUidRedDotChange=function(){var t=false;for(var e=0;e<this._newUid.length;e++){if(!Uint64.equal(this._newUid[e],Uint64.ZERO)){t=true;break}}if(t){s.ClosureManager.addXin(csv.FunctionsProxy.ENUMS.SETTING_VIEW)}else{s.ClosureManager.removeXin(csv.FunctionsProxy.ENUMS.SETTING_VIEW)}return t};Object.defineProperty(n.prototype,"newheadframeId",{get:function(){return this._newheadframeId},set:function(t){this._newheadframeId=t;this.onHeadFrameRedDotChange()},enumerable:true,configurable:true});n.prototype.onHeadFrameRedDotChange=function(){var t=false;s.ClosureManager.removeXin(csv.FunctionsProxy.ENUMS.HEADFRAME);s.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.HEADFRAME);if(this._newheadframeId.length>0){s.ClosureManager.addXin(csv.FunctionsProxy.ENUMS.HEADFRAME);t=true}else{for(var e in this.headframeList){if(this.headframeList[e].state==0){t=this.headFrameActiveCheck(this.headframeList[e].headframeId);if(t){break}}}if(t){s.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.HEADFRAME)}}return t};n.prototype.headFrameActiveCheck=function(t){var e=false;var i=csv.HeadFrameProxy.getIns().getCfg(t);if(i&&s.GridsModel.getIns().hasEnoughItems(i.item,false,false)){e=true}return e};n.prototype.getHeadFrameIcon=function(){if(this.headFrameId>0){return csv.HeadFrameProxy.getIns().getIcon(this.headFrameId)}return""};n.prototype.onBubbleRedDotChange=function(){var t=false;if(this.newBubbleIds.length>0){s.ClosureManager.addXin(csv.FunctionsProxy.ENUMS.CHAT_BUBBLE)}else{s.ClosureManager.removeXin(csv.FunctionsProxy.ENUMS.CHAT_BUBBLE)}return t};n.prototype.onGuajianRedDotChange=function(){var t=false;if(this.newGujianIds.length>0){s.ClosureManager.addXin(csv.FunctionsProxy.ENUMS.CHAT_GUAJIAN)}else{s.ClosureManager.removeXin(csv.FunctionsProxy.ENUMS.CHAT_GUAJIAN)}return t};n.prototype.buyVip=function(){if(s.Context.disableIosRecharge()){manager.FlowManager.instance.flowByStyle1(app.getLang("shandong_error3"))}else{s.Alert.show(app.getLang("shandong_error2"),Laya.Handler.create(this,this.onVip),null,0,"","fullScreen","center","center",0,"","button_name8")}};n.prototype.onVip=function(){s.ClosureManager.callFunction(csv.FunctionsProxy.ENUMS.VIP)};n.SINGLE_KEY="game.RoleModel";n.EVENTS={REFRESH:"refresh",END_BATTLE:"end_battle",INFO_INIT:"info_init",PROP_CHANGE:"prop_change",LEVEL_CHANGE:"level_change",TUPOLV_CHANGE:"tupolv_change",EXP_CHANGE:"exp_change",SCORE_UPDATE:"score_update",MOUNT_CHANGE:"mount_change",PROF_CHANGE:"prof_change",SHIZHUANG_CHANGE:"SHIZHUANG_CHANGE",EXCHANGE_GOLD_CHANGE:"exchange_gold_change",PLAYER_NAME_CHANGE:"player_name_change",PLAYER_NAME_MODIFY:"player_name_modify",PLAYER_NUM_MODIFY:"PLAYER_NUM_MODIFY",PLAYER_BUFF_CHANGE:"PLAYER_BUFF_CHANGE",PLAYER_DIE:"player_die",SHANGZHEN_CHANGE:"shangzhen_change",HEADFRAMEID_CHANGE:"headFrameId_change",HEADFRAME_UPDATE:"headFrame_update",TEAM_ICON_CHANGE:"team_icon_change",TEAM_INFO_CHANGE:"team_info_change",TEAM_LEVEL_INIT:"team_level_init",TEAM_LEVEL_CHANGE:"team_level_change",WUXING_SKILL_SELECT_CHANGE:"wuxing_skill_select_change",USEEXP_RESULT_UPDATE:"USEEXP_RESULT_UPDATE",CHAT_BUBBLE_UPDATA:"chat_bubble_updata",CHAT_BUBBLE_USE_CHANGE:"chat_bubble_use_change",GUAJIAN_USE_CHANGE:"guanjian_use_change",CHAKAN_SCORE_CHANGE:"chakan_score_change",ROLE_OFFLINE_AWARD_ITEM_UPDATE:"Role_Offline_AwardItem_Update",ROLE_GET_IP:"ROLE_GET_IP",ROLE_OTHER_INFO:"ROLE_OTHER_INFO",KUAI_TIAN:"KUAI_TIAN",FIVE_CLOCK:"FIVE_CLOCK",WUXING_SKILL_NEW:"WUXING_SKILL_NEW",GET_INII_DATA:"GET_INII_DATA"};return n}(app.ModelBase);s.RoleModel=t})(game||(game={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var game;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.jihuotexiao.visible=false};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){this._role=t.role;if(this._role){this.labelnum.visible=true;this.bgshuzi.visible=true;this.labelnum.text=this._role.level.toString();this.imglock.visible=false;this.imgjiahao.visible=false;this.imgtouxiang.visible=true;this.imgtouxiang.skin=this._role.getHeadIconUrl();this.chuzhanimg.visible=this._role.infight==1;if(this._role.tupoLv){var e=csv.LevelProxy.getIns().getHuluStyle(this._role.tupoLv);this.hulu.hulu.skin=csv.LevelProxy.HULU_ICONS[e.grade];this.dengji.text=this._role.tupoLv.toString();this.hulu.visible=true;this.dengji.visible=true}else{this.hulu.visible=false;this.dengji.visible=false}}else{this.labelnum.visible=false;this.bgshuzi.visible=false;this.imgtouxiang.visible=false;this.imglock.visible=true;this.imgjiahao.visible=false;this.chuzhanimg.visible=false;this.hulu.visible=false;this.dengji.visible=false;this.imglock.visible=false;this.imgjiahao.visible=false}this.imgxuanzhong.visible=t.select};e.SINGLE_KEY="equip.OtherRoleItem";return e}(ui.zhuangbei.zhuangbeiitem1UI);t.OtherRoleItem=e})(game||(game={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var game;(function(i){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.runNums=[];return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this._model=i.OtherRoleModel.getIns();this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.roleMediator=new common.RoleListMediator(this.itemxuanze.xuanzelist,i.OtherRoleItem,new Laya.Handler(this,this.roleSelectChange));this.centerLayout=new i.CenterLayoutMediator(this.hulu,this.box,73,this.hulu.spaceX);this.hulu.itemRender=ui.juese.juesehuluitemUI;this.hulu.renderHandler=new Laya.Handler(this,this.onHandler);this.lblPropNames=[this.shuxing1,this.shuxing2,this.shuxing3];this.lblPropValues=[this.shuzhi1,this.shuzhi2,this.shuzhi3];this.wuxing.renderHandler=new Laya.Handler(this,this.onWuxingRender);this.skillArr=[this.jineng03,this.jineng04,this.jineng05,this.jineng06];this.gaiminbtn.visible=false;this.btnfangdajing.clickHandler=new Laya.Handler(this,this.onDetail);this.btnjinjie.visible=false;this.btndingwei2.clickHandler=new Laya.Handler(this,this.onTexing);this.labeljiesuotishi.visible=this.boxshengji.visible=this.boxjinjie.visible=false;this.jueseshengji.visible=false;this.jueseshengji.mouseEnabled=false;this.btnhuolang.visible=false};t.prototype.onHandler=function(t,e){t.hulu.skin=t.dataSource};t.prototype.onTexing=function(){app.ViewManager.toggleDialog(equip.ProfTipView,1,0,[this.roleMediator.selectedRoleVo.prof])};t.prototype.onDetail=function(){app.ViewManager.toggleDialog(role.RoleDetailAttributeView,1,0,this.roleMediator.selectedRoleVo)};t.prototype.onDisplay=function(){this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){this.skt&&this.skt.stop()};t.prototype.refreshAll=function(){this.roleMediator.setData(0,[],[],this._model.otherRoleList);this.setAvatar();this.setLevel();this.setSkills();this.setAttributes();this.setScore();this.setRoleName();this.setWuxing()};t.prototype.roleSelectChange=function(){this.setAvatar();this.setLevel();this.setSkills();this.setAttributes();this.setScore();this.setRoleName();this.setWuxing()};t.prototype.setAvatar=function(){var t;var e=this.roleMediator.selectedRoleVo.classSkin;var i=csv.SkinProxy.getIns().getCfg(e);var n;if(i){t=i.modelres;n=i.scale/100}else{t=csv.DefclassProxy.getIns().getCfg(this.roleMediator.selectedRoleVo.prof).model;n=.6}if(this.skt&&this.skt.parent){this.skt.removeSelf()}else{this.skt=new common.CSkt}this.skt.init(role.RoleVO.getSkinSkt(t));this.skt.scale(n,n);this.weizhi.addChild(this.skt)};t.prototype.setLevel=function(){var t=csv.LevelProxy.getIns().getCurrMaxLv(this.roleMediator.selectedRoleVo.tupoLv);this.labeldengji2.text=this.roleMediator.selectedRoleVo.level+"/"+t};t.prototype.setSkills=function(){for(var t=0;t<csv.LevelProxy.SKILL_POS;t++){var e=csv.LevelProxy.getIns().getSkillByTupoLv(this.roleMediator.selectedRoleVo.prof,t+1,this.roleMediator.selectedRoleVo.tupoLv);this.skillArr[t].setData(e)}};t.prototype.setAttributes=function(t){if(t===void 0){t=false}var e=this.roleMediator.selectedRoleVo;for(var i=0,n=equip.EquipStatic.ROLE_MAIN_ATTRIBUTE_SHOW.length;i<n;i++){var a=equip.EquipStatic.ROLE_MAIN_ATTRIBUTE_SHOW[i];var o=0;if(a==2){this.lblPropNames[i].text=app.getLang("攻击");if(e.attribute&&e.attribute[a]){o=Math.round(e.attribute[2]/1.1)}}else{this.lblPropNames[i].text=Attributes.getPropName(a);if(e.attribute&&e.attribute[a]){o=e.attribute[a]}}if(t){if(!this.runNums[i]){this.runNums[i]=new util.RunNum}this.runNums[i].play(this.lblPropValues[i],o)}else{this.runNums[i]&&this.runNums[i].stop();this.lblPropValues[i].text=o.toString()}}};t.prototype.setRoleName=function(){var t=this.roleMediator.selectedRoleVo;this.namelab.text=t.getName();this.updateNameBoxPos();var e=csv.DefclassProxy.getIns().getCfg(this.roleMediator.selectedRoleVo.prof);if(e){this.btndingwei2.skin="juese/btn_dingwei_"+e.rolepic+".png"}};t.prototype.setWuxing=function(){var t=[];var e=csv.DefclassProxy.getIns().getCfg(this.roleMediator.selectedRoleVo.prof);if(e){t=e.roleattr.split("-")}this.wuxing.array=t;this.updateNameBoxPos()};t.prototype.updateNameBoxPos=function(){this.wuxing.x=this.namelab.x+this.namelab.width+2;var t=this.wuxing.length*this.wuxing.getCell(0).width;var e=this.namelab.width+t+2;this.boxmingzi.x=this.boxmingzi.pivotX+(this.width-e)*.5};t.prototype.setScore=function(){var t=this.roleMediator.selectedRoleVo;this.zhanliclip.value=t.score+""};t.prototype.onWuxingRender=function(t,e){var i=t.dataSource;t.shuxing.skin="public/bg_wuxing_"+i+".png"};t.SINGLE_KEY="equip.OtherRoleMainNewView";return t}(ui.juese.jueseUI);i.OtherRoleMainNewView=t})(game||(game={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var game;(function(h){var t=function(i){__extends(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){i.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=h.OtherRoleModel.getIns();this.roleMediator=new common.RoleListMediator(this.itemxuanze.xuanzelist,h.OtherRoleItem,new Laya.Handler(this,this.roleSelectChange));this.fabaoArr=[];for(var t=1;t<=equip.EquipStatic.FABAO_NUM;t++){var e=this["fabao"+t];e.position=t;this.fabaoArr.push(e)}this.equipArr=[];for(var t=1;t<=equip.EquipStatic.EQUIP_NUM;t++){var e=this["zhuangbei"+t];e.position=t;e.boOther=true;this.equipArr.push(e);this.equipArr[t-1].setData(h.GridsModel.EMPTY)}this.huluArr=[];for(var t=1;t<=2;t++){var e=this["hulu"+t];e.position=t+6;e.boOther=true;e.mouseEnabled=false;e.setData(h.GridsModel.LOCKED);this.huluArr.push(e)}this.xiangxi.visible=false;this.chuandaibtn.visible=false};t.prototype.onDisplay=function(){this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){this.skt&&this.skt.stop()};t.prototype.refreshAll=function(){this.roleMediator.setData(0,[],[],this._model.otherRoleList);this.setAvatar();this.setEquips();this.setFabao();this.setScore();this.setRoleName();this.setResonate()};t.prototype.roleSelectChange=function(){this.setAvatar();this.setEquips();this.setFabao();this.setScore();this.setRoleName();this.setResonate()};t.prototype.setFabao=function(){var t=this.roleMediator.selectedRoleVo;for(var e=0;e<2;e++){if(t.level<csv.ChouKaProxy.getIns().getLockLv(e+1)){this.fabaoArr[e].setData(h.GridsModel.LOCKED,t.prof,true)}else{this.fabaoArr[e].setData(this._model.getFabaoWear(t.prof,e+1),t.prof,true)}}};t.prototype.setAvatar=function(){var t;var e=this.roleMediator.selectedRoleVo.classSkin;var i=csv.SkinProxy.getIns().getCfg(e);var n;if(i){t=i.modelres;n=i.scale/100}else{t=csv.DefclassProxy.getIns().getCfg(this.roleMediator.selectedRoleVo.prof).model;n=.6}if(this.skt&&this.skt.parent){this.skt.removeSelf()}else{this.skt=new common.CSkt}this.skt.init(role.RoleVO.getSkinSkt(t));this.skt.scale(n,n);this.weizhi.addChild(this.skt)};t.prototype.setEquips=function(){this.equips=[];for(var t=1;t<=equip.EquipStatic.EQUIP_NUM;t++){var e=this.equipArr[t-1];if(t>=4&&t<=6&&this._model.teamLv<h.Config.getIntParams(1149)){e.setData(h.GridsModel.LOCKED)}else{var i=this._model.getOtherRoleEquipVo(this.roleMediator.selectedRoleVo.insId,t);if(i){this.equips.push(i);e.setData(i)}else{e.setData(h.GridsModel.EMPTY)}}}};t.prototype.setRoleName=function(){this.namelab.text=this.roleMediator.selectedRoleVo.getName()};t.prototype.setScore=function(){this.zhanliclip.value=this.roleMediator.selectedRoleVo.score+""};t.prototype.setResonate=function(){var t=this._model.getResonates(this.equips,csv.EquipProxy.RESONATE.QIANGHUA);if(t.length){this.shuzhi2.color=h.STYLES.DESC_TXT_COLOR_S;this.shuzhi2.text=csv.EquipProxy.getIns().getTotalResonate(t)}else{this.shuzhi2.color=h.STYLES.GRAY_COLOR_S;var e=csv.EquipProxy.getIns().resonate1[0];this.shuzhi2.text=app.getLang("zhuangbei_gongming7",e.condition[0],e.condition[1])}t=this._model.getResonates(this.equips,csv.EquipProxy.RESONATE.CUILIAN);if(t.length){this.shuzhi4.color=h.STYLES.DESC_TXT_COLOR_S;this.shuzhi4.text=csv.EquipProxy.getIns().getTotalResonate(t)}else{this.shuzhi4.color=h.STYLES.GRAY_COLOR_S;var e=csv.EquipProxy.getIns().resonate2[0];var i=parseInt(e.condition[1]);var n=app.getLang("cuilian_grade"+csv.EquipProxy.getIns().getGradeByCuilianGrade(i)+"_1");var a=csv.EquipProxy.getIns().getGradeByCuilianLv(i);if(a){this.shuzhi4.text=app.getLang("zhuangbei_gongming8",e.condition[0],n,a)}else{this.shuzhi4.text=app.getLang("zhuangbei_gongming11",e.condition[0],n)}}var o=[this.shuzhi6,this.shuzhi7,this.shuzhi8];var s=0;for(var r=1;r<=equip.EquipStatic.BAOSHI_NUM;++r){t=this._model.getResonates(this.equips,csv.EquipProxy.RESONATE.BAOSHI,r);if(t.length){o[s].color=h.STYLES.DESC_TXT_COLOR_S;o[s].text=csv.EquipProxy.getIns().getTotalResonate(t);s++}}if(s<3){o[s].color=h.STYLES.GRAY_COLOR_S;o[s].text=app.getLang("zhuangbei_gongming10")}for(var l=s+1;l<3;l++){o[l].text=""}};t.SINGLE_KEY="game.OtherRoleMainView";return t}(ui.zhuangbei.renwu1viewUI);h.OtherRoleMainView=t})(game||(game={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var game;(function(o){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.roleAvatarDatas=[];t.roleAvatars=[];t.waitRoles=[];t.shadows=[];return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this._model=o.OtherRoleModel.getIns();this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.skillArr=[this.jineng1,this.jineng2,this.jineng3];this.fiveStar=new chouka.FiveStar;this.fiveStar.x=this.imgwuwei.x;this.fiveStar.y=this.imgwuwei.y;this.addChild(this.fiveStar);this.fiveLabs=[this.shuxingshuzhi1,this.shuxingshuzhi2,this.shuxingshuzhi3,this.shuxingshuzhi4,this.shuxingshuzhi5];this.addLabs=[this.add1,this.add2,this.add3,this.add4,this.add5];this.weizhis=[this.weizhi1,this.weizhi2,this.weizhi3,this.weizhi4,this.weizhi5];this.tiaozhengbtn.visible=this.genghuanbtn.visible=false;this.xiangxibtn.clickHandler=new Laya.Handler(this,this.onShowWuxing);this.wenhaobtn.clickHandler=new Laya.Handler(this,this.onWuxingTip);this.list.on(Laya.Event.CLICK,this,this.showGuajian);this.gaiming.visible=false};t.prototype.showGuajian=function(){var t=[];for(var e=0,i=this._model.guajianMagicList.length;e<i;e++){var n=fabaonew.FaBaoNewVo.create(this._model.guajianMagicList[e]);t.push(n)}app.ViewManager.toggleDialog(role.GuajianShowView,1,0,t)};t.prototype.onWuxingTip=function(){app.ViewManager.toggleDialog(ui.wuxing.wuxingguizetipUI,1,0)};t.prototype.onShowWuxing=function(){app.ViewManager.toggleDialog(role.WuxingTip,1,0,this._model.wuxingAttributes)};t.prototype.onDisplay=function(){this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){for(var t=0;t<5;t++){this.shadows[t]&&this.shadows[t].removeSelf();this.waitRoles[t]&&this.waitRoles[t].removeSelf();this.roleAvatars[t]&&this.roleAvatars[t].removeSelf()}o.OtherRoleModel.getIns().boGuajian=false};t.prototype.refreshAll=function(){this.duiwuname.text=this._model.otherTeamName;this.dengjilab.text=app.getLang("level_des_1",this._model.teamLv);this.jinyantiao.value=o.Context.teamExp/this._model.totalexp;this.shuzhilab.text=o.Context.teamExp+"/"+this._model.totalexp;var t=csv.TitleProxy.getIns().getCfg(this._model.title);if(t){if(t.effect!=""){this.chenghaoimg.visible=true;if(!this.titleEff){this.titleEff=new o.AniView;this.titleEff.x=this.chenghaoimg.width/2;this.titleEff.y=this.chenghaoimg.height/2+20}this.chenghaoimg.skin="";this.titleEff.load(t.effect,o.AniView.FILE_NAME.UI);this.chenghaoimg.addChild(this.titleEff);this.titleEff.play()}else{var e=csv.TitleProxy.getIns().getTitleUrl(this._model.title);if(e==""){this.chenghaoimg.visible=false}else{this.chenghaoimg.visible=true;this.chenghaoimg.skin=e}if(this.titleEff){this.titleEff.removeSelf();this.titleEff.stop()}}}else{this.chenghaoimg.visible=false;if(this.titleEff){this.titleEff.removeSelf();this.titleEff.stop()}}this.kuangimg.skin=csv.HeadFrameProxy.getIns().getIcon(this._model.headframeId);this.touxiangimg.skin=csv.MyTeamProxy.getIns().getTeamIcon(this._model.teamAvatar);this.setWuxing();this.setWuxingSkills();this.showFive();this.setGuajian()};t.prototype.setWuxing=function(){var t=this._model.wuxingAttributes[o.Context.WUXING_ORIGIN.TOTAL].concat();var e=app.getLang("magic_color_in").split(":");var i=t.splice(5,10);this.fiveStar.draw(Attributes.getWuxingPercents(t),100,e[0],parseFloat(e[1]));for(var n=0,a=t.length;n<a;n++){this.fiveLabs[n].text=t[n].toString();if(i[n]){this.addLabs[n].visible=true;this.addLabs[n].text="("+Attributes.getNumber2Percent(i[n])+")";if(n>2){this.addLabs[n].x=this.fiveLabs[n].x-this.addLabs[n].textField.textWidth-3}else{this.addLabs[n].x=this.fiveLabs[n].x+this.fiveLabs[n].textField.textWidth+3}}else{this.addLabs[n].visible=false}}};t.prototype.setWuxingSkills=function(){var t=csv.SkillProxy.getIns().wuxingArr;for(var e=0,i=this.skillArr.length;e<i;e++){this.skillArr[e].setData(t[e],this._model.aliveWuxingSkills,this._model.selectWuxingSkill==t[e].id);this.skillArr[e].mouseEnabled=false}};t.prototype.showFive=function(){for(var t=0;t<5;t++){if(!this.shadows[t]){this.shadows[t]=new Laya.Image("res/assist/circle.png");this.shadows[t].anchorX=this.shadows[t].anchorY=.5}this.weizhis[t].addChild(this.shadows[t]);var e=this._model.otherBattleRoleList[t];if(e){if(!this.roleAvatarDatas[t]){this.roleAvatarDatas[t]=new avatar.AvatarData;this.roleAvatars[t]=new avatar.AvatarAnimation;this.roleAvatars[t].scaleX=1.5;this.roleAvatars[t].scaleY=1.5}this.weizhis[t].addChild(this.roleAvatars[t]);var i=void 0;var n=e.classSkin;var a=csv.SkinProxy.getIns().getCfg(n);if(a){i=a.modelres}else{i=csv.DefclassProxy.getIns().getCfg(e.prof).model}this.roleAvatarDatas[t].roleKey=i;this.roleAvatars[t].setAniData(this.roleAvatarDatas[t]);this.roleAvatars[t].setAni(avatar.AvatarAnimation.ANI_ENUMS.IDLE,0);this.roleAvatars[t].play();if(this.waitRoles[t]){this.waitRoles[t].removeSelf();this.waitRoles[t]=null}}else{if(!this.waitRoles[t]){this.waitRoles[t]=new Laya.Image("res/static/wuxing/bg_wuxing_jianying.png");this.waitRoles[t].anchorX=.5;this.waitRoles[t].anchorY=1}this.weizhis[t].addChild(this.waitRoles[t])}}};t.prototype.setGuajian=function(){chat.ChatStatic.dellGuajian(this.list,o.OtherRoleModel.getIns().guajianIds,50);if(this._model.boGuajian){this.showGuajian()}};t.SINGLE_KEY="equip.OtherRoleWuxingView";return t}(ui.wuxing.wuxingjueseUI);o.OtherRoleWuxingView=t})(game||(game={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(t){var e=function(t){__extends(e,t);function e(){return t.call(this)||this}e.prototype.getState=function(){return this._state};e.prototype.setState=function(t){this._state=t;if(this._state!=""){this.event(this._state)}};return e}(Laya.EventDispatcher);t.RoleState=e})(role||(role={}));var role;(function(t){var e=function(){function t(){}t.MOVE="MOVE";t.BATTLE="BATTLE";t.DIE="DIE";t.IDLE="IDLE";t.JUMP="JUMP";t.HIT="HIT";return t}();t.RoleStateConst=e})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=game.RoleModel.getIns()};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){this.zhanliminglab.text=app.getLang("zhanli_des"+t);var e=this._model.scoreInfo[t];if(e){this.zhanlilab.text=e.toNumber().toString()}else{this.zhanlilab.text="0"}};e.SINGLE_KEY="role.ScoreCheckDetailItem";return e}(ui.zhanlixiangxi.zhanlixiangxi_itemUI);t.ScoreCheckDetailItem=e})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.zhanlilist.itemRender=i.ScoreCheckDetailItem;this.zhanlilist.renderHandler=new Laya.Handler(this,this.onRender);this._model=game.RoleModel.getIns()};e.prototype.onRender=function(t,e){t.setData(t.dataSource)};e.prototype.onDisplay=function(){this._model.on(game.RoleModel.EVENTS.CHAKAN_SCORE_CHANGE,this,this.refreshAll);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){this._model.off(game.RoleModel.EVENTS.CHAKAN_SCORE_CHANGE,this,this.refreshAll)};e.prototype.refreshAll=function(){var t=this.dataSource.type;var e=this._model.scoreInfo[t];this.titleimg.text=app.getLang("zhanli_des"+t);if(e){this.zongzhanlilab.text=app.getLang("zhanli_des"+t)+":"+e.toNumber().toString()}else{this.zongzhanlilab.text="0"}this.zhanlilist.array=this.dataSource.subArr};e.SINGLE_KEY="role.ScoreCheckDetailView";return e}(ui.zhanlixiangxi.zhanlixiangxiUI);i.ScoreCheckDetailView=t})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(a){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.btnChallenge.clickHandler=new Laya.Handler(this,this.onClick);this._model=game.RoleModel.getIns()};e.prototype.onClick=function(){app.ViewManager.toggleDialog(a.ScoreCheckDetailView,1,0,this.dataSource)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){var e=t.type;var i=a.ScoreProxy.getIns().getIcon(e);this.gongnengbtn.skin=i;this.zhanliminglab.text=app.getLang("zhanli_des"+e);var n=this._model.scoreInfo[e];if(n){this.zhanlilab.text=n.toNumber().toString()}else{this.zhanlilab.text="0"}};e.SINGLE_KEY="role.ScoreCheckItem";return e}(ui.zhanlixiangxi.zhanlixiangxi_zongheitemUI);a.ScoreCheckItem=t})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.zhandoulilist.itemRender=i.ScoreCheckItem;this.zhandoulilist.renderHandler=new Laya.Handler(this,this.onRender);this._model=game.RoleModel.getIns()};e.prototype.onRender=function(t,e){t.setData(t.dataSource)};e.prototype.onDisplay=function(){app.ProtocolRequest.SectionBattleScoreReq();this._model.on(game.RoleModel.EVENTS.CHAKAN_SCORE_CHANGE,this,this.refreshAll);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){this._model.off(game.RoleModel.EVENTS.CHAKAN_SCORE_CHANGE,this,this.refreshAll)};e.prototype.refreshAll=function(){var t=[];for(var e in n.getIns().listMap){var i=n.getIns().listMap[e];if(csv.FunctionsProxy.getIns().isOpen(n.getIns().cfgMap[e].functionid)){t.push({type:parseInt(e),subArr:i})}}this.zhandoulilist.array=t;this.zhanli.value=game.Context.score.toString()};e.SINGLE_KEY="role.ScoreCheckView";return e}(ui.zhanlixiangxi.zhanlixiangxi_zongheUI);i.ScoreCheckView=t;var n=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("score.csv");var e=t.getArray();this.listMap={};this.cfgMap={};for(var i=0,n=e.length;i<n;i++){var a=e[i];if(!this.listMap[a.type]){this.listMap[a.type]=[];this.cfgMap[a.type]=a}this.listMap[a.type].push(a.subtype)}};e.prototype.getIcon=function(t){return"res/static/mainicon/"+this.cfgMap[t].icon+".png"};e.SINGLE_KEY="csv.ScoreProxy";return e}(app.ModelBase);i.ScoreProxy=n})(role||(role={}));var skill;(function(t){var e=function(){function t(){}t.FLYEFFECT_COMPLETE="FLYEFFECT_COMPLETE";return t}();t.SkillConst=e})(skill||(skill={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("skill.csv");this.cfgMap=t.getMap("skillid","level");this.cfgArr=t.getArray();this.roleSkillMap={};for(var e=0,i=this.cfgArr.length;e<i;e++){var n=this.cfgArr[e];if(!this.roleSkillMap[n.role]){this.roleSkillMap[n.role]=[]}if(this.roleSkillMap[n.role].indexOf(n.skillid)==-1){this.roleSkillMap[n.role].push(n)}}t=app.Config.getResById("skill_effect.csv");this.skillEffMap=t.getMap("skillid","laiyuan");t=app.Config.getResById("skill_skin.csv");this.skinSkillMap=t.getMap("skillid","skin");var a=app.Config.getResById("masterskill.csv");this.masterMap=a.getMap("masterid","level");var o=app.Config.getResById("elements.csv");this.wuxingArr=o.getArray()};e.prototype.getCfg=function(t,e){if(e===void 0){e=1}if(this.cfgMap[t]){return this.cfgMap[t][e]}return null};e.prototype.getSkinSkill=function(t,e){if(this.skinSkillMap[t]&&this.skinSkillMap[t][e]){return this.skinSkillMap[t][e].sceneeffect}return""};e.prototype.getSkillByKey=function(t,e){if(e===void 0){e=false}var i=app.str2Array(t,"-");if(!e){return this.cfgMap[i[0]][i[1]]}else{if(parseInt(i[1])==0){return this.cfgMap[i[0]]["1"]}else{return this.cfgMap[i[0]][i[1]]}}};e.prototype.getArr=function(){return this.cfgArr};e.prototype.getMasterCfg=function(t,e){if(e===void 0){e=1}if(!this.masterMap[t]){for(var i in this.masterMap){manager.FlowManager.instance.flowByStyle1(app.getLang("天赋技能{0}不能存在,规避报错用{1}替换",t,i));return this.masterMap[i][e]}}return this.masterMap[t][e]};e.prototype.getSkillList=function(){if(!this.skillArr){this.skillArr=[];var t=[];for(var e=0,i=this.cfgArr.length;e<i;e++){var n=this.cfgArr[e];var a=parseInt(n.skillid);if(parseInt(n.actionid)==0){continue}if(t.indexOf(a)==-1){t.push(a);this.skillArr.push(n)}}return this.skillArr}};e.prototype.getSkillIcon=function(t){if(!t){return""}return"res/icon/skill/"+t+".png"};e.prototype.boBeici=function(t,e){if(this.skillEffMap[t]&&this.skillEffMap[t][e]){return this.skillEffMap[t][e].beici==1}return false};e.prototype.boBig=function(t,e){if(this.skillEffMap[t]&&this.skillEffMap[t][e]){return this.skillEffMap[t][e].big}return 0};e.prototype.setSkillInfo=function(t,e,i){if(i){t.shuzi.text=app.getLang("zuoqi_11")+e.level;t.shuzhibg.visible=true}else{t.shuzi.text=""}t.img.skin=this.getSkillIcon(e.icon);for(var n=1;n<=3;n++){t["xing"+n].visible=false}};e.getSkillDesSp=function(t,e,i){var n=i.split("-");var a=+n[0]?n[1]+"%":n[0]+"";return app.getLang("skill"+t+"_"+e+"_des","",a)};e.getSkillDes=function(t,e,i,n){if(i===void 0){i=0}if(n===void 0){n=true}var a="";var o=csv.SkillProxy.getIns().getCfg(t,e);if(n&&csv.SkillProxy.NO_SHOW_CD_ORIGIN.indexOf(o.skillorigin)==-1){var s=parseInt(o.coldtime);if(s==0){a+=app.getLang("冷却：无\n")}else{a+=app.getLang("冷却：{0}秒\n",s/1e3)}}if(i){if(o.skillparameters1==""){a+=app.getLang(o.explain,o.attackvalue)}else{var r=csv.SkillProxy.getIns().getCfg(t,e+i);var l=void 0;var h=app.str2Array(o.skillparameters1,";","-");var p=[o.attackvalue];var u=app.str2Array(r.skillparameters1,";","-");for(var c=0,g=h.length;c<g;c++){var f=h[c];var d=u[c];if(f.length>1){var y=Number(d[1])-Number(f[1]);if(y){l=f[1]+('%<span color="'+game.STYLES.RED_COLOR_S+'">('+y+"%↑)</span>")}else{l=f[1]+"%"}}else{var y=d[0]-f[0];if(y){l=f[0]+('<span color="'+game.STYLES.RED_COLOR_S+'">('+y+"↑)</span>")}else{l=f[0]}}p.push(l)}a+=app.getLang(r.explain,p)}}else{if(o.skillparameters1==""){a+=app.getLang(o.explain,o.attackvalue)}else{if(o.skillparameters1==""){a+=app.getLang(o.explain,o.attackvalue)}else{var h=app.str2Array(o.skillparameters1,";","-");var p=[o.attackvalue];for(var c=0,g=h.length;c<g;c++){var f=h[c];if(f.length>1){p.push(f[1]+"%")}else{p.push(f[0])}}a+=app.getLang(o.explain,p)}}}return a};e.SINGLE_KEY="csv.SkillProxy";e.ORIGIN_ENUM={NORMAL:0,ROLE:1,FABAO:2,PET:3,MOUNT:4,SEVEN:5,BEIZHAN:7,WUXING:13};e.NO_SHOW_CD_ORIGIN=[e.ORIGIN_ENUM.FABAO,e.ORIGIN_ENUM.PET,e.ORIGIN_ENUM.MOUNT,e.ORIGIN_ENUM.WUXING];return e}(app.ModelBase);t.SkillProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(t){var e=function(t){__extends(a,t);function a(){return t.call(this)||this}a.prototype.playEff=function(){this.char.isoDisplay.addChild(this);this.load(this.url,game.AniView.FILE_NAME.SKILL);this.on(Laya.Event.COMPLETE,this,this.recycle);this.play(0);this.x=0;this.y=0};a.prototype.recycle=function(){this.stop();this.removeSelf();this.char=null;Laya.Pool.recover("pet_comb_effect_"+this.url,this)};a.playPetCombEffect=function(t,e,i){if(i===void 0){i=false}var n=Laya.Pool.getItemByClass("pet_comb_effect_"+t,a);n.url=t;n.char=e;n.canstop=i;n.playEff()};return a}(game.SkillAniView);t.PetCombEffect=e})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var skill;(function(h){var t=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t.isoType=isometric.IsoType.SKILL_TYPE;return t}t.prototype.cast=function(t,e){this.attackVo=t;this.tarArr=[];this.stepMap={};this.step=0;this.maxStep=0;this.useEffArr=[];this.tweens=[];this.call=e;var i=false;for(var n=0;n<t.hps.length;n++){var a=t.hps[n];var o=scene.SceneMediator.getInstance().getViewById(a.tar);if(!t.real){if(this.tarArr.indexOf(o)==-1){this.tarArr.push(o)}continue}if(!i&&battle.HurtView.checkType(a.effectType,battle.HurtView.EFFECT_ENUM.DOUBLE_ATT)){i=true}if(o){if(battle.HurtView.checkType(a.effectType,battle.HurtView.EFFECT_ENUM.MP_USE)){o.updataMp(a)}else{if(this.tarArr.indexOf(o)==-1){if(o==t.targetView){this.tarArr.unshift(o)}else{this.tarArr.push(o)}}}}}for(var n=0;n<t.buffs.length;n++){var s=t.buffs[n];var o=scene.SceneMediator.getInstance().getViewById(s.objId);if(this.tarArr.indexOf(o)==-1){if(o==t.targetView){this.tarArr.unshift(o)}else{this.tarArr.push(o)}}}if(i){var r=1;if(game.Context.isMainRole(t.attackView.vo.insId)){r=2}var o=Laya.Pool.getItemByClass(battle.HurtSkillImgMove.SINGLE_KEY,battle.HurtSkillImgMove);o.setEffect(battle.HurtView.EFFECT_ENUM.DOUBLE_ATT,r,t.attackView.x,t.attackView.y,t.attackView.charactorVO.getModelHeight(),true)}var l;if(!t.showSkill){t.showSkill=t.skill}if(t.attackView instanceof role.RoleView){var h=csv.SkillProxy.getIns().getSkinSkill(t.showSkill.skillid,t.attackView.roleVO.classSkin);if(h!=""){l=h}else{l=t.showSkill.sceneeffect}}else{l=t.showSkill.sceneeffect}this.dellJson(l);this.doStep();scene.SceneMediator.getInstance().addSkill(this);t.attackView.setSKillHurt(this.attackVo)};t.prototype.dellJson=function(t){var e=JSON.parse(t);for(var i=0,n=e.length;i<n;i++){var a=e[i];var o=new h.SceneSkillVo;h.SceneSkillVo.setJson(o,a);if(i>0&&o.borely){this.maxStep++}if(!this.stepMap[this.maxStep]){this.stepMap[this.maxStep]=[]}this.stepMap[this.maxStep].push(o)}};t.prototype.doStep=function(){var t=this.stepMap[this.step];if(t){for(var e=0,i=t.length;e<i;e++){var n=t[e];if(!n.buffLink||this.attackVo.attackView.hasBuff(n.buffLink)){if(n.type==0){this.playRelease(n)}else if(n.type==1){this.playBullet(n)}else if(n.type==2){this.playCenter(n)}}else{n.boEnd=true;for(var a=0,o=n.subCenters.length;a<o;a++){var s=n.subCenters[a];s.boEnd=true}}if(!n.boHitRely){Laya.timer.once1(n.hitStartTime/app.TimerRewriter.battleScale,this,this.playHit,[n,this.tarArr])}}this.checkCanNextStep()}};t.prototype.checkCanNextStep=function(){var t=this.stepMap[this.step];if(t){for(var e=0,i=t.length;e<i;e++){var n=t[e];if(!n.boEnd){return}for(var a=0,o=n.subCenters.length;a<o;a++){var s=n.subCenters[a];if(!s.boEnd){return}}}}this.step++;if(this.step>this.maxStep){if(this.call&&this.attackVo.real){this.call.run()}Laya.timer.once1(1e3/app.TimerRewriter.battleScale,this,this.recycle)}else{this.doStep()}};t.prototype.setCastPosition=function(t,e,i,n,a,o){if(o===void 0){o=false}if(i==0){t.x=e.x;t.y=e.y-e.charactorVO.getModelHeight();this.isoDisplay.addChild(t)}else if(i==1){t.x=e.x;t.y=e.y-e.charactorVO.getModelHeight()/2;this.isoDisplay.addChild(t)}else if(i==3){t.x=e.x+n;if(a<0){t.y=e.y-e.charactorVO.getModelHeight()+a}else{t.y=e.y+a}this.isoDisplay.addChild(t)}else{t.x=e.x;t.y=e.y;this.isoDisplay.addChild(t)}if(o){var s=t.scaleX*e.isoDisplay.scaleX;var r=t.scaleY*e.isoDisplay.scaleY;t.scale(s,r)}};t.prototype.getTarPosition=function(t,e,i,n){var a=new Laya.Point;if(e==0){a.x=t.x;a.y=t.y-t.charactorVO.getModelHeight()}else if(e==1){a.x=t.x;a.y=t.y-t.charactorVO.getModelHeight()/2}else if(e==3){a.x=t.x+i;a.y=t.y+n}else{a.x=t.x;a.y=t.y}return a};t.prototype.addEff=function(t){var e=Laya.Pool.getItemByClass(t,game.SkillAniView);this.useEffArr.push(e);return e};t.prototype.removeEff=function(t){t.stop();t.removeSelf();t.scale(1,1);t.offAll(Laya.Event.COMPLETE);Laya.Pool.recover(t.aniName,t);if(this.useEffArr){var e=this.useEffArr.indexOf(t);if(e!=-1){this.useEffArr.splice(e,1)}}};t.prototype.clearAll=function(){for(var t=0,e=this.useEffArr.length;t<e;t++){var i=this.useEffArr[t];if(i){i.stop();i.removeSelf();i.offAll(Laya.Event.COMPLETE);Laya.Pool.recover(i.aniName,i)}}for(var t=0,e=this.tweens.length;t<e;t++){this.tweens[t].recover()}this.attackVo=null;this.tarArr=null;this.stepMap=null;this.step=null;this.maxStep=null;this.useEffArr=null;this.tweens=null;this.call=null;Laya.timer.clearAll(this)};t.prototype.recycle=function(){scene.SceneMediator.getInstance().removeSkill(this);Laya.Pool.recover(h.SceneSkillEffect.SINGLE_KEY,this)};t.prototype.updateFrame=function(t){};t.prototype.playMusic=function(t,e){if(e){if(e!=""&&t.musicRate&&game.SceneModel.random(0,100)<t.musicRate){app.SoundManager.getIns().playSpecialSound(e)}}else{if(t.music!=""&&t.musicRate&&game.SceneModel.random(0,100)<t.musicRate){app.SoundManager.getIns().playSpecialSound(t.music)}}};t.prototype.playRelease=function(t){Laya.timer.once1(t.starttime/app.TimerRewriter.battleScale,this,this.startRelease,[t],false)};t.prototype.startRelease=function(t){this.playMusic(t);if(t.url==""){if(t.boHitRely){this.playHit(t,this.tarArr)}t.boEnd=true;this.checkCanNextStep()}else{if(!this.attackVo.targetView){t.boEnd=true;this.checkCanNextStep();return}this.playPerRelease(t)}};t.prototype.playPerRelease=function(t){var e=1;if(t.dirType==1){if(this.attackVo.attackView.vo.dir==2){t.url+="01"}else if(this.attackVo.attackView.vo.dir==4){t.url+="01";e=-1}else if(this.attackVo.attackView.vo.dir==0){t.url+="02"}else if(this.attackVo.attackView.vo.dir==6){t.url+="02";e=-1}else{t.url+="01"}}var i=this.addEff(t.url);i.scaleX=e;if(t.dirType==2){i.rotation=(9-this.attackVo.attackView.vo.dir)*45}this.setCastPosition(i,t.posType==3?this.attackVo.targetView:this.attackVo.attackView,t.posType,t.sceneX,t.sceneY,true);i.load(t.url);if(t.destoryType==1){Laya.timer.once1(t.duration/app.TimerRewriter.battleScale,this,this.onRealseComplete,[i,t],false)}else{i.on(Laya.Event.COMPLETE,this,this.onRealseComplete,[i,t])}i.play()};t.prototype.onRealseComplete=function(t,e){if(e.boHitRely){this.playHit(e,this.tarArr)}this.removeEff(t);e.boEnd=true;this.checkCanNextStep()};t.prototype.playBullet=function(t){Laya.timer.once1(t.starttime/app.TimerRewriter.battleScale,this,this.startBullet,[t],false)};t.prototype.startBullet=function(t){this.playMusic(t);if(t.url==""){if(t.boHitRely){this.playHit(t,this.tarArr)}t.boEnd=true;this.checkCanNextStep()}else{if(t.bulletType==0){var e=Math.min(this.tarArr.length,t.bulletCount);t.playCount=e;for(var i=0;i<e;i++){var n=this.tarArr[i];if(!n){continue}Laya.timer.once1(t.scatterPerDelay*i/app.TimerRewriter.battleScale,this,this.playPerNormalBullet,[t,t.posType==3?this.attackVo.targetView:this.attackVo.attackView,n],false)}}else if(t.bulletType==1){this.playPerJumpBullet(t,t.posType==3?this.attackVo.targetView:this.attackVo.attackView)}else if(t.bulletType==2){this.playPerScatterBullet(t,t.posType==3?this.attackVo.targetView:this.attackVo.attackView,this.attackVo.targetView)}}};t.prototype.playPerNormalBullet=function(t,e,i){var n=this.addEff(t.url);if(t.speed==0){this.setCastPosition(n,i,t.tarPosType,t.tarSx,t.tarSy);n.load(t.url);n.on(Laya.Event.COMPLETE,this,this.onBulletNormalComplete,[n,t]);n.play(0)}else{this.setCastPosition(n,e,t.posType,t.sceneX,t.sceneY);var a=this.getTarPosition(i,t.tarPosType,t.sceneX,t.sceneY);var o=Math.atan2(a.y-n.y,a.x-n.x);var s=a.distance(n.x,n.y);n.rotation=o*180/Math.PI;n.load(t.url);n.play(0);var r=app.MyTween.to(n,{x:a.x,y:a.y},s/t.speed,null,Laya.Handler.create(this,this.onBulletNormalComplete,[n,t,i]),0,true,false,false);this.tweens.push(r)}};t.prototype.onBulletNormalComplete=function(t,e,i){if(e.boHitRely){this.playHit(e,[i])}this.removeEff(t);e.endCount++;if(e.endCount>=e.playCount){e.boEnd=true;this.checkCanNextStep()}};t.prototype.playPerJumpBullet=function(t,e){var i=Math.min(this.tarArr.length,t.bulletCount);if(t.playCount<i){var n=this.tarArr[t.playCount];t.playCount++;if(n){var a=this.addEff(t.url);this.setCastPosition(a,e,t.posType,t.sceneX,t.sceneY);var o=this.getTarPosition(n,t.tarPosType,t.sceneX,t.sceneY);var s=Math.atan2(o.y-a.y,o.x-a.x);var r=o.distance(a.x,a.y);a.rotation=s*180/Math.PI;a.load(t.url);if(t.jumpType==0){var l=app.MyTween.to(a,{x:a.x+Math.cos(s)*r,y:a.y+Math.sin(s)*r},r/t.speed,null,Laya.Handler.create(this,this.onBulletJumpComplete,[a,t,n]),0,true,false,false);a.play(0);this.tweens.push(l)}else{a.x=o.x;a.y=o.y;a.scaleX=r/t.linkWidth;a.on(Laya.Event.COMPLETE,this,this.onBulletJump2Complete,[a,t,n]);a.play(0);Laya.timer.once1(t.linkDelay/app.TimerRewriter.battleScale,this,this.playPerJumpBullet,[t,n])}}else{t.endCount++;this.playPerJumpBullet(t,e)}}};t.prototype.onBulletJumpComplete=function(t,e,i){e.endCount++;if(e.boHitRely){this.playHit(e,[i])}this.removeEff(t);this.playPerJumpBullet(e,i);var n=Math.min(this.tarArr.length,e.bulletCount);if(e.endCount>=n){e.boEnd=true;this.checkCanNextStep()}};t.prototype.onBulletJump2Complete=function(t,e,i){e.endCount++;if(e.boHitRely){this.playHit(e,[i])}this.removeEff(t);var n=Math.min(this.tarArr.length,e.bulletCount);if(e.endCount>=n){e.boEnd=true;this.checkCanNextStep()}};t.prototype.playPerScatterBullet=function(t,e,i){if(!i){t.boEnd=true;this.checkCanNextStep();return}t.playCount=t.bulletCount;for(var n=0,a=t.bulletCount;n<a;n++){Laya.timer.once1(t.scatterPerDelay*n/app.TimerRewriter.battleScale,this,this.playSubPerScatterBullet,[t,e,i,n],false)}};t.prototype.playSubPerScatterBullet=function(t,e,i,n){var a=t.scatterAngle/180*Math.PI;var o=a/t.bulletCount;var s=this.addEff(t.url);this.setCastPosition(s,e,t.posType,t.sceneX,t.sceneY);var r=this.getTarPosition(i,t.tarPosType,t.sceneX,t.sceneY);var l=Math.atan2(r.y-s.y,r.x-s.x)-a/2+o*n;var h=r.distance(s.x,s.y);s.rotation=l*180/Math.PI;s.load(t.url);s.play(0);var p=app.MyTween.to(s,{x:s.x+Math.cos(l)*h,y:s.y+Math.sin(l)*h},h/t.speed,null,Laya.Handler.create(this,this.onBulletScatterComplete,[s,t,i,n==0]),0,true,false,false);this.tweens.push(p)};t.prototype.onBulletScatterComplete=function(t,e,i,n){if(e.boHitRely&&n){if(e.bulletCount!=e.hitCount){if(e.endCount==0){this.playHit(e,this.tarArr)}}else{this.playHit(e,[i])}}this.removeEff(t);e.endCount++;if(e.endCount>=e.playCount){e.boEnd=true;this.checkCanNextStep()}""};t.prototype.playCenter=function(t){this.attX=this.attackVo.attackView.x;this.attY=this.attackVo.attackView.y;this.tarX=this.attackVo.targetView.x;this.tarY=this.attackVo.targetView.y;if(t.bomove){var e=scene.SceneMediator.getInstance().getIsoWorldCenterPoint();this.sceneX=e[0];this.sceneY=e[1];Laya.timer.once1(t.starttime/app.TimerRewriter.battleScale,this,this.startMoveCenter,[t],false)}else{Laya.timer.once1(t.starttime/app.TimerRewriter.battleScale,this,this.startCenter,[t],false)}for(var i=0,n=t.subCenters.length;i<n;i++){var a=t.subCenters[i];Laya.timer.once1(a.delay/app.TimerRewriter.battleScale,this,this.startSubCenter,[t,a],false)}if(t.boShake){Laya.timer.once1(t.shakeStart/app.TimerRewriter.battleScale,this,this.startShake,[t],false)}};t.prototype.startShake=function(t){scene.SceneMediator.getInstance().shakeScene(t.shakeDuration,t.shakeRange,t.shakeRate)};t.prototype.startCenter=function(t){this.playMusic(t);if(t.url==""){if(t.boHitRely){this.playHit(t,this.tarArr)}t.boEnd=true;this.checkCanNextStep()}else{if(t.centerTar==1){var e=Math.min(this.tarArr.length,t.centerCount);t.playCount=e;for(var i=0;i<e;i++){Laya.timer.once1(t.centerPerDelay*i/app.TimerRewriter.battleScale,this,this.playPerCenter,[t,i],false)}}else{var n=this.addEff(t.url);n.rotation=game.SceneModel.random(t.minAngle,t.maxAngle);this.setCastPosition(n,this.attackVo.attackView,t.posType,t.sceneX,t.sceneY);n.load(t.url);if(t.destoryType==1){Laya.timer.once1(t.duration/app.TimerRewriter.battleScale,this,this.onCenterComplete,[n,t],false)}else{n.on(Laya.Event.COMPLETE,this,this.onCenterComplete,[n,t])}n.play()}}};t.prototype.playPerCenter=function(t,e){var i=this.tarArr[e];if(!i){return}var n=this.addEff(t.url);n.rotation=game.SceneModel.random(t.minAngle,t.maxAngle);this.setCastPosition(n,i,t.posType,t.sceneX,t.sceneY);n.load(t.url);if(t.destoryType==1){Laya.timer.once1(t.duration/app.TimerRewriter.battleScale,this,this.onCenterComplete,[n,t,i],false)}else{n.on(Laya.Event.COMPLETE,this,this.onCenterComplete,[n,t,i])}n.play()};t.prototype.onCenterComplete=function(t,e,i){if(e.boHitRely){if(i){if(e.centerCount!=e.hitCount){if(e.endCount==0){this.playHit(e,this.tarArr)}}else{this.playHit(e,[i])}}else{this.playHit(e,this.tarArr)}}this.removeEff(t);Laya.Pool.recover(e.url,t);e.endCount++;if(e.endCount>=e.playCount){e.boEnd=true;this.checkCanNextStep()}};t.prototype.startSubCenter=function(t,e){this.playMusic(t,e.music);if(e.url==""){e.boEnd=true;this.checkCanNextStep()}else{var i=this.addEff(e.url);this.isoDisplay.addChild(i);if(t.centerTar==1){i.x=this.tarX+e.offX;i.y=this.tarY+e.offY}else{i.x=this.attX+e.offX;i.y=this.attY+e.offY}i.scaleX=e.scaleX;i.scaleY=e.scaleY;i.load(e.url);i.on(Laya.Event.COMPLETE,this,this.onSubCenterComplete,[i,t,e]);i.play()}};t.prototype.onSubCenterComplete=function(t,e,i){this.removeEff(t);i.boEnd=true;this.checkCanNextStep()};t.prototype.startMoveCenter=function(t){this.playMusic(t);if(t.url==""){if(t.boHitRely){this.playHit(t,this.tarArr)}t.boEnd=true;this.checkCanNextStep()}else{var e=[];var i=new Laya.Point;var n=new Laya.Point;if(t.movePosType==0){var a=Math.PI/4*(9-this.attackVo.attackView.vo.dir);var o=a+Math.PI/180*t.moveStartX;i.x=this.attackVo.attackView.x+Math.cos(o)*t.moveStartY;i.y=this.attackVo.attackView.y+Math.sin(o)*t.moveStartY;o=a+Math.PI/180*t.moveEndX;n.x=this.attackVo.attackView.x+Math.cos(o)*t.moveEndY;n.y=this.attackVo.attackView.y+Math.sin(o)*t.moveEndY;if(t.movePath!=""){var s=app.str2Array(t.movePath,",");for(var r=0,l=s.length;r<l;r+=2){var h=a+Math.PI/180*parseInt(s[r]);var p=parseInt(s[r+1]);var u=new Laya.Point;u.x=this.attackVo.attackView.x+Math.cos(h)*p;u.y=this.attackVo.attackView.y+Math.sin(h)*p;e.push(u)}}e.push(n)}else{i.x=this.sceneX+t.moveStartX;i.y=this.sceneY+t.moveStartY;n.x=this.sceneX+t.moveEndX;n.y=this.sceneY+t.moveEndY;if(t.movePath!=""){var s=app.str2Array(t.movePath,",");for(var r=0,l=s.length;r<l;r+=2){var u=new Laya.Point(i.x+parseInt(s[r]),i.y+parseInt(s[r+1]));e.push(u)}}}e.push(n);if(t.effectCd){var c=new Laya.Sprite;this.isoDisplay.addChild(c);c.x=i.x;c.y=i.y;c.alpha=t.appearAlpha;c.scale(t.appearScale,t.appearScale);var g=app.MyTween.to(c,{alpha:1,scaleX:t.moveScale,scaleY:t.moveScale},t.appearTime,null,null,0,true,false,false);this.tweens.push(g);this.movePath(c,t,e);this.startMoveEff(c,t)}else{var f=this.addEff(t.url);this.isoDisplay.addChild(f);f.rotation=game.SceneModel.random(t.minAngle,t.maxAngle);f.play();f.x=i.x;f.y=i.y;f.alpha=t.appearAlpha;f.scale(t.appearScale,t.appearScale);f.load(t.url);var g=app.MyTween.to(f,{alpha:1,scaleX:t.moveScale,scaleY:t.moveScale},t.appearTime,null,null,0,true,false,false);this.tweens.push(g);this.movePath(f,t,e);if(t.botail){Laya.timer.once1(t.tailStart/app.TimerRewriter.battleScale,this,this.startTail,[f,t],false)}}}};t.prototype.movePath=function(t,e,i){var n=this;if(i.length>0){var a=i.shift();var o=a.distance(t.x,t.y);e.movingRotation=Math.atan2(a.y-t.y,a.x-t.x)/Math.PI*180;var s=app.MyTween.to(t,{x:a.x,y:a.y},o/e.moveSpeed,Laya.Ease.linearNone,Laya.Handler.create(this,this.movePath,[t,e,i]),0,true,false,false);this.tweens.push(s)}else{e.movingEnd=true;var s=app.MyTween.to(t,{alpha:e.hideAlpha,scaleX:e.hideScale,scaleY:e.hideScale},e.hideTime,Laya.Ease.linearNone,Laya.Handler.create(this,function(){if(t instanceof game.SkillAniView){n.removeEff(t);Laya.Pool.recover(e.url,t)}else{t.removeSelf()}e.boEnd=true;n.checkCanNextStep()}),0,true,false,false);this.tweens.push(s)}};t.prototype.startMoveEff=function(t,e){this.playMoveEff(t,e);Laya.timer.loop1(e.effectCd/app.TimerRewriter.battleScale,this,this.playMoveEff,[t,e],false)};t.prototype.playMoveEff=function(t,e){if(e.movingEnd){return}var i=this.addEff(e.url);i.rotation=e.movingRotation;scene.SceneMediator.getInstance().isoWorld.skillLayer1.addChild(i);i.x=t.x;i.y=t.y;i.scaleX=t.scaleX;i.scaleY=t.scaleY;i.load(e.url);i.on(Laya.Event.COMPLETE,this,this.removeEff,[i]);i.play()};t.prototype.startTail=function(t,e){this.playTail(t,e);Laya.timer.loop1(e.taildelay/app.TimerRewriter.battleScale,this,this.playTail,[t,e],false)};t.prototype.playTail=function(t,e){if(e.movingEnd){return}var i=this.addEff(e.tailurl);i.rotation=e.movingRotation;scene.SceneMediator.getInstance().isoWorld.skillLayer1.addChild(i);i.x=t.x;i.y=t.y;i.load(e.tailurl);i.on(Laya.Event.COMPLETE,this,this.removeEff,[i]);i.play()};t.prototype.playHit=function(t,e){if(t.hitMusic!=""&&t.hitMusicRate&&game.SceneModel.random(0,100)<t.hitMusicRate){app.SoundManager.getIns().playSpecialSound(t.hitMusic)}for(var i=0;i<e.length;i++){var n=e[i];if(!n){continue}if(n.charactorVO.boSkillShield){continue}if(t.bohit&&t.hitUrl!=""){var a=Laya.Pool.getItemByClass(t.hitUrl,game.AniView);if(t.hitPosType==0){a.x=0;a.y=-n.charactorVO.getModelHeight()}else if(t.hitPosType==1){a.x=0;a.y=-n.charactorVO.getModelHeight()/2}else{a.x=0;a.y=0}n.addChild(a);a.on(Laya.Event.COMPLETE,this,this.onHitComplete,[a,t]);a.load(t.hitUrl);a.play(0)}}};t.prototype.onHitComplete=function(t,e){t.stop();t.removeSelf();t.off(Laya.Event.COMPLETE,this,this.onHitComplete);Laya.Pool.recover(t.aniName,t)};t.SINGLE_KEY="skill.SceneSkillEffect";return t}(h.SkillEffect);h.SceneSkillEffect=t;var e=function(){function l(){this.type=0;this.buffLink=0;this.url="";this.music="";this.musicRate=100;this.borely=false;this.starttime=0;this.destoryType=0;this.duration=1e3;this.posType=0;this.sceneX=0;this.sceneY=200;this.hurtNum=1;this.hurtdelay=50;this.bohit=false;this.bomove=false;this.botail=false;this.dirType=0;this.bulletType=0;this.bulletCount=5;this.speed=1;this.speedRate=1;this.scaleRate=1;this.scatterAngle=120;this.scatterPerDelay=0;this.tarPosType=0;this.tarSx=0;this.tarSy=0;this.jumpType=0;this.linkWidth=500;this.linkDelay=50;this.centerCount=1;this.centerTar=1;this.minAngle=0;this.maxAngle=0;this.centerPerDelay=0;this.boShake=false;this.shakeStart=0;this.shakeDuration=200;this.shakeRange=10;this.shakeRate=2;this.subCenters=[];this.subCenterJson="";this.hitPosType=0;this.hitUrl="";this.hitMusic="";this.hitMusicRate=100;this.hitCount=1;this.boHitRely=false;this.hitStartTime=100;this.movePosType=0;this.moveSpeed=1;this.moveScale=1;this.effectCd=0;this.moveStartX=0;this.moveStartY=0;this.moveEndX=0;this.moveEndY=0;this.movePath="";this.appearAlpha=0;this.appearScale=0;this.appearTime=100;this.hideAlpha=0;this.hideScale=0;this.hideTime=100;this.tailurl="";this.tailStart=100;this.taildelay=100;this.tailX=0;this.tailY=0;this.boEnd=false;this.playCount=0;this.endCount=0}l.getJson=function(t){var e={};for(var i=0,n=l.keys.length;i<n;++i){var a=l.keys[i];if(l.compare[a]!=t[a]){e[a]=t[a]}}var o=[];for(var s=0,r=t.subCenters.length;s<r;++s){o.push(p.getJson(t.subCenters[s]))}e["subCenterJson"]=JSON.stringify(o);return e};l.setJson=function(t,e){for(var i in e){t[i]=e[i];if(i=="subCenterJson"){var n=JSON.parse(e[i]);for(var a=0,o=n.length;a<o;a++){var s=n[a];var r=new h.SceneSubCenterSkillVo;h.SceneSubCenterSkillVo.setJson(r,s);t.subCenters.push(r)}}}};l.compare=new l;l.keys=["type","buffLink","url","music","musicRate","borely","starttime","destoryType","duration","posType","sceneX","sceneY","hurtNum","hurtdelay","bohit","bomove","botail","dirType","bulletType","bulletCount","speed","speedRate","scaleRate","scatterAngle","scatterPerDelay","tarPosType","tarSx","tarSy","jumpType","linkWidth","linkDelay","centerCount","centerTar","minAngle","maxAngle","centerPerDelay","boShake","shakeStart","shakeDuration","shakeRange","shakeRate","hitPosType","hitUrl","hitMusic","hitMusicRate","hitCount","boHitRely","hitStartTime","movePosType","moveSpeed","moveScale","effectCd","moveStartX","moveStartY","moveEndX","moveEndY","movePath","appearAlpha","appearScale","appearTime","hideAlpha","hideScale","hideTime","tailurl","tailStart","taildelay","tailX","tailY"];return l}();h.SceneSkillVo=e;var p=function(){function o(){this.url="";this.music="";this.offX=0;this.offY=0;this.scaleX=1;this.scaleY=1;this.delay=0;this.boEnd=false}o.getJson=function(t){var e={};for(var i=0,n=o.keys.length;i<n;++i){var a=o.keys[i];if(o.compare[a]!=t[a]){e[a]=t[a]}}return e};o.setJson=function(t,e){for(var i in e){t[i]=e[i]}};o.compare=new o;o.keys=["url","music","offX","offY","scaleX","scaleY","delay"];return o}();h.SceneSubCenterSkillVo=p})(skill||(skill={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var skill;(function(t){var e=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t.killEffs=[];t.reliveEffs=[];t.isoType=isometric.IsoType.STAGE_SKILL_TYPE;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.boShenWei=function(){return Boolean(this.killEffs.length>0)||Boolean(this.reliveEffs.length>0)};t.prototype.pushEff=function(t,e){if(e==1){this.killEffs.push(t)}else{this.reliveEffs.push(t)}};t.prototype.play=function(t){this.call=t;this.useEffArr=[];scene.SceneMediator.getInstance().addStageSkill(this);this.huluAni=this.addEff("skill_hulushenwei03");this.huluAni.x=Laya.stage.width/2-200;this.huluAni.y=150-Laya.stage.height/2;this.isoDisplay.addChild(this.huluAni);this.huluAni.load("skill_hulushenwei03");this.huluAni.play();Laya.timer.once(500,this,this.startHurt)};t.prototype.startHurt=function(){var t=this.addEff("skill_hulushenwei01");this.huluAni.addChild(t);t.load("skill_hulushenwei01");t.on(Laya.Event.COMPLETE,this,this.hurtReleaseEnd,[t]);t.play();Laya.timer.once(300,this,this.playHurt)};t.prototype.hurtReleaseEnd=function(t){this.removeEff(t)};t.prototype.playHurt=function(){for(var t=0,e=this.killEffs.length;t<e;t++){var i=this.killEffs[t];var n=scene.SceneMediator.getInstance().getViewById(i.tar);if(n){this.playHurtEff(n,i.hurt.toNumber(),1,i);var a=this.addEff("skill_dianshanleiming");n.addChild(a);a.load("skill_dianshanleiming");a.on(Laya.Event.COMPLETE,this,this.removeEff,[a]);a.play();n.die()}}Laya.timer.once(500,this,this.startRelive)};t.prototype.startRelive=function(){this.playRelive();Laya.timer.loop(300,this,this.playRelive)};t.prototype.playRelive=function(){if(this.reliveEffs.length<1){Laya.timer.clear(this,this.playRelive);Laya.timer.once(1500,this,this.recycle);return}var t=this.reliveEffs.shift();var e=scene.SceneMediator.getInstance().getViewById(t.tar);if(e){var i=this.addEff("skill_hulushenwei02");this.huluAni.addChild(i);i.load("skill_hulushenwei02");i.on(Laya.Event.COMPLETE,this,this.reliveReleaseEnd,[i,e,t]);i.play()}};t.prototype.reliveReleaseEnd=function(t,e,i){this.removeEff(t);this.playHurtEff(e,i.hurt.toNumber(),2,i);var n=this.addEff("skill_fuhuo01");e.addChild(n);n.load("skill_fuhuo01");n.on(Laya.Event.COMPLETE,this,this.removeEff,[n]);n.play();e.charactorVO.hp=i.hp.toNumber();e.initHeadHpMp();e.roleState=role.RoleStateConst.IDLE};t.prototype.playHurtEff=function(t,e,i,n){t.showHitEff(e,n.effectType,i,n.def==1,false,true)};t.prototype.addEff=function(t){var e=Laya.Pool.getItemByClass(t,game.SkillAniView);this.useEffArr.push(e);return e};t.prototype.removeEff=function(t){t.stop();t.removeSelf();t.offAll(Laya.Event.COMPLETE);Laya.Pool.recover(t.aniName,t);if(this.useEffArr){var e=this.useEffArr.indexOf(t);if(e!=-1){this.useEffArr.splice(e,1)}}};t.prototype.clearAll=function(){for(var t=0,e=this.useEffArr.length;t<e;t++){var i=this.useEffArr[t];if(i){i.stop();i.removeSelf();i.offAll(Laya.Event.COMPLETE);Laya.Pool.recover(i.aniName,i)}}this.useEffArr=null;Laya.timer.clearAll(this);this.killEffs=[];this.reliveEffs=[]};t.prototype.recycle=function(){scene.SceneMediator.getInstance().removeSkill(this);if(this.call){this.call.run()}};t.prototype.updateFrame=function(t){};t.SINGLE_KEY="skill.ShenWeiSkillEffect";return t}(t.SkillEffect);t.ShenWeiSkillEffect=e})(skill||(skill={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var xiulian;(function(t){var e=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t._boTip=false;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.on(Laya.Event.CLICK,this,this.onShowTip);this.starMediator=new common.StarClipMediator([this.xing1,this.xing2,this.xing3])};t.prototype.onDisplay=function(){this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){};t.prototype.refreshAll=function(){};t.prototype.setData=function(t,e,i,n,a){if(e===void 0){e=false}if(i===void 0){i=false}if(n===void 0){n=false}if(a===void 0){a=true}this._data=t;this._boTip=n;if(e){this.gray=false;this.img.skin="public/bg_lock01.png";this.shuzi.visible=false;this.starMediator.value=0;this.jiaobiao.visible=false;this.skillName=""}else{this.jiaobiao.visible=true;if(t instanceof SkillData){this.shuzi.visible=true;var o=void 0;if(t.lv==0){o=csv.SkillProxy.getIns().getCfg(t.id,1)}else{o=csv.SkillProxy.getIns().getCfg(t.id,t.lv)}this.gray=i;this.shuzi.text="";this.img.skin="res/icon/skill/"+o.icon+".png";this._showStar(a,t.lv-1);if(o.typeicon){this.jiaobiao.skin="public/bg_jinengbiaoqian_"+o.typeicon+".png"}else{this.jiaobiao.skin=""}this.skillName=o.name;this.skillLv="Lv."+o.level}else if(typeof t=="string"){var s=csv.SkillProxy.getIns().getSkillByKey(t);this.gray=i;this.shuzi.text="";this.img.skin="res/icon/skill/"+s.icon+".png";this._showStar(a,s.level-1);if(s.typeicon){this.jiaobiao.skin="public/bg_jinengbiaoqian_"+s.typeicon+".png"}else{this.jiaobiao.skin=""}this.skillName=s.name;this.skillLv="Lv."+s.level}else{this.gray=i;this.shuzi.text="";this.img.skin="res/icon/skill/"+t.icon+".png";this._showStar(a,parseInt(t.level)-1);if(t.typeicon){this.jiaobiao.skin="public/bg_jinengbiaoqian_"+t.typeicon+".png"}else{this.jiaobiao.skin=""}this.skillName=t.name;this.skillLv="Lv."+t.level}}};t.prototype._showStar=function(t,e){if(t==false){this.starMediator.value=0}else{this.starMediator.value=e}};t.prototype.onShowTip=function(){if(!this._boTip){return}var t;if(this._data instanceof SkillData){t=this._data}else if(typeof this._data=="string"){var e=app.str2Array(this._data,"-");t=new SkillData;t.id=e[0];t.lv=e[1]}else{t=new SkillData;t.id=this._data.skillid;t.lv=this._data.level}tip.TipManager.showSkill(t);if(this.clickHandler){this.clickHandler.run()}};t.prototype.getData=function(){return this._data};t.SINGLE_KEY="xiulian.SkillGridView";return t}(ui.jineng.jinengitem2UI);t.SkillGridView=e})(xiulian||(xiulian={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var xiulian;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t,e,i,n,a){if(e===void 0){e=false}if(i===void 0){i=false}if(n===void 0){n=false}if(a===void 0){a=true}this.jineng.setData(t,e,i,n,a);this.jinengname.text=this.jineng.skillName+this.jineng.skillLv};e.SINGLE_KEY="xiulian.SkillGridViewN";return e}(ui.jineng.jinengitemUI);t.SkillGridViewN=e})(xiulian||(xiulian={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var skill;(function(i){var t=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t.keyformat="res/atlas/ani/skill/{0}.atlas";t.isoType=isometric.IsoType.STAGE_SKILL_TYPE;t.bg=new Laya.Image;t.bg.skin="public/bg_jiugong_zhezhao2.png";t.showHandler=new Laya.Handler(t,t.near);t.hideHandler=new Laya.Handler(t,t.hideShow);t.forceHandler=new Laya.Handler(t,t.forceEnd);t.nearEnd=new Laya.Handler(t,t.onNearEnd);t.farEnd=new Laya.Handler(t,t.onFarEnd);return t}Object.defineProperty(t,"ins",{get:function(){var t=Laya.Pool.getItemByClass("StageSkillEffect",i.StageSkillEffect);return t},enumerable:true,configurable:true});t.prototype.cast=function(t,e){app.TimerRewriter.boStop=true;this.attackVo=t;this.call=e;scene.SceneMediator.getInstance().addStageSkill(this);var i=scene.SceneMediator.getInstance().vo;this.bg.x=i.bg.bgOffsetX-50;this.bg.y=i.bg.bgOffsetY-50;this.bg.width=i.bgWidth+100;this.bg.height=i.bgHeight+100;this.voArr=[];this.useEffArr=[];this.tarArr=[];this.hurtMap={};this.boDouble=false;for(var n=0;n<this.attackVo.hps.length;n++){var a=this.attackVo.hps[n];if(!this.boDouble&&battle.HurtView.checkType(a.effectType,battle.HurtView.EFFECT_ENUM.DOUBLE_ATT)){this.boDouble=true}var o=scene.SceneMediator.getInstance().getViewById(a.tar);if(o){if(battle.HurtView.checkType(a.effectType,battle.HurtView.EFFECT_ENUM.MP_USE)){o.updataMp(a)}else{if(o==t.targetView){this.tarArr.unshift(o)}else{this.tarArr.push(o)}this.hurtMap[a.tar.toString()]={tar:o,att:a}}}}var s=JSON.parse(t.skill.bigeffect);var r=[];for(var n=0,l=s.length;n<l;n++){var h=s[n];var p="";if(h.type==0){this.showVo=new f;f.setJson(this.showVo,h)}else if(h.type==1){var u=new d;d.setJson(u,h);this.voArr.push(u);if(u.url!=""){p=app.getLang(this.keyformat,u.url)}}else if(h.type==2){var c=new y;y.setJson(c,h);this.voArr.push(c);if(c.flyurl!=""){p=app.getLang(this.keyformat,c.flyurl)}if(c.boomurl!=""){p=app.getLang(this.keyformat,c.boomurl)}}else if(h.type==3){var g=new v;v.setJson(g,h);this.voArr.push(g);if(g.boomurl!=""){p=app.getLang(this.keyformat,g.boomurl)}}if(r.indexOf(p)==-1){r.push(p)}}Laya.loader.load(r);this.upChars()};t.prototype.upChars=function(){scene.SceneMediator.getInstance().isoWorld.characterLayer2.addChild(this.bg);var t=this.tarArr.concat([this.attackVo.attackView]);SortUtil.sortOnArr(t,["depth"],[SortUtil.NUMERIC]);for(var e=0,i=t.length;e<i;e++){var n=t[e];scene.SceneMediator.getInstance().isoWorld.characterLayer2.addChild(n);n.changeHeadState(1)}this.playShow(this.showVo)};t.prototype.forceEnd=function(){this.playShow(this.showVo)};t.prototype.backChars=function(){for(var t=0,e=this.tarArr.length;t<e;t++){var i=this.tarArr[t];scene.SceneMediator.getInstance().addSceneItem(i.vo)}scene.SceneMediator.getInstance().addSceneItem(this.attackVo.attackView.vo);this.bg.removeSelf()};t.prototype.near=function(){this.worldScale=scene.CameraView.getIns().worldScale;scene.SceneMediator.getInstance().forceCamera(true);var t=this.worldScale+.15;scene.CameraView.getIns().maxScale=t;scene.CameraView.getIns().changeWorldScale(t,this.nearEnd)};t.prototype.onNearEnd=function(){this.playEffs()};t.prototype.far=function(){scene.CameraView.getIns().changeWorldScale(this.worldScale,this.farEnd)};t.prototype.onFarEnd=function(){battle.BattleManager.getIns().dellStepChange(this.attackVo);scene.CameraView.getIns().maxScale=1;scene.SceneMediator.getInstance().forceCamera(false);this.recycle()};t.prototype.playShow=function(t){app.ViewManager.toggleView(i.StageSkillShow,app.AppContainer.flyLayer,1,[t,this.showHandler,this.hideHandler]);Laya.timer.once(5e3,this,this.onShowTimeOut)};t.prototype.onShowTimeOut=function(){this.showHandler.run();this.hideHandler.run()};t.prototype.hideShow=function(){app.ViewManager.toggleView(i.StageSkillShow,app.AppContainer.flyLayer,-1);Laya.timer.clear(this,this.onShowTimeOut);if(this.voArr.length==0){this.attackVo.attackView.setSKillHurt(this.attackVo,true);this.far()}};t.prototype.playEffs=function(){if(!gm.GmModel.getIns().boGm){this.attackVo.attackView.setSKillMpUse()}for(var t=0,e=this.voArr.length;t<e;t++){var i=this.voArr[t];if(i.type==1){this.playStart(i)}else if(i.type==2){this.playFly(i)}else if(i.type==3){this.playBoom(i)}}this.attackVo.attackView.setSKillHurt(this.attackVo,true);Laya.timer.once(this.showVo.hurtDelay,this,this.showHurt)};t.prototype.showHurt=function(){if(this.boDouble){var t=1;if(game.Context.isMainRole(this.attackVo.attackView.vo.insId)){t=2}var e=Laya.Pool.getItemByClass(battle.HurtSkillImgMove.SINGLE_KEY,battle.HurtSkillImgMove);e.setEffect(battle.HurtView.EFFECT_ENUM.DOUBLE_ATT,t,this.attackVo.attackView.x,this.attackVo.attackView.y,this.attackVo.attackView.charactorVO.getModelHeight(),false)}for(var i in this.hurtMap){var n=this.hurtMap[i];var e=n.tar;var a=n.att;var o=1;if(game.Context.isMainRole(e.vo.insId)){o=2}var s=Math.ceil(a.hurt.toNumber()/this.showVo.hurtNum);if(battle.HurtView.checkType(a.effectType,battle.HurtView.EFFECT_ENUM.MISS)){this.playHurtEff(e,s,o,a)}else{for(var r=0;r<this.showVo.hurtNum;r++){Laya.timer.once(r*this.showVo.hurtTime,this,this.playHurtEff,[e,s,o,a],false)}}}};t.prototype.playHurtEff=function(t,e,i,n){t.showHitEff(e,n.effectType,i,n.def==1,false,true)};t.prototype.playStart=function(t){Laya.timer.once(t.starttime,this,this.startStart,[t],false)};t.prototype.startStart=function(t){var e=this.addEff(t.url);this.isoDisplay.addChild(e);e.x=t.x;e.y=t.y;e.scale(t.scaleX,t.scaleY);e.rotation=game.SceneModel.random(t.minAngle,t.maxAngle);if(!t.loop){e.on(Laya.Event.COMPLETE,this,this.onStartComplete,[e,t])}else{if(t.duration!=0){Laya.timer.once(t.duration,this,this.onStartComplete,[e,t],false)}}e.load(t.url);e.play(0,t.loop);Laya.timer.once(t.musicDelay,this,this.playStartMusic,[t],false)};t.prototype.playStartMusic=function(t){if(t.music!=""){app.SoundManager.getIns().playSpecialSound(t.music)}};t.prototype.onStartComplete=function(t,e){this.removeEff(t);e.boEnd=true;this.checkEnd()};t.prototype.playFly=function(t){Laya.timer.once(t.startdelay,this,this.startFlyPer,[t],false)};t.prototype.startFlyPer=function(t){var e=t.duration/t.num;this.playFlyPer(t);Laya.timer.loop(e,this,this.playFlyPer,[t],false)};t.prototype.playFlyPer=function(t){if(t.currCount>=t.num){return}if(t.useTarget){for(var e=0,i=t.flynum;e<i;e++){var n=this.addEff(t.flyurl);this.isoDisplay.addChild(n);var a=game.SceneModel.getDisByTowPoint(t.x,t.y,t.targetX,t.targetY);var o=Math.atan2(t.targetY-t.y,t.targetX-t.x);n.rotation=o/Math.PI*180;n.x=t.x;n.y=t.y;n.load(t.flyurl);n.scale(t.scaleX,t.scaleY);n.play(0);app.MyTween.to(n,{x:t.targetX,y:t.targetY},a/t.speed,null,Laya.Handler.create(this,this.playFlyBoom,[n,e,t]),t.flydelay*e);if(t.flyMusic!=""){app.SoundManager.getIns().playSpecialSound(t.flyMusic)}}}else{if(t.angle!=0){if(t.lastAngle){var s=t.lastAngle/3;var r=t.lastAngle;while(Math.abs(t.lastAngle-r)<s){r=90+game.SceneModel.random(-t.angle,t.angle)}t.lastAngle=r}else{t.lastAngle=90+game.SceneModel.random(-t.angle,t.angle)}}else{t.lastAngle=90}var l=void 0;if(t.currCount%2==0){l=game.SceneModel.random(t.offXL,0)}else{l=game.SceneModel.random(0,t.offXR)}var o=t.lastAngle/180*Math.PI;var a=game.SceneModel.random(t.minDis,t.maxDis);t.setFlyMask(this.isoDisplay);for(var e=0,i=t.flynum;e<i;e++){var n=this.addEff(t.flyurl);t.flyBox.addChild(n);n.rotation=t.lastAngle;n.x=t.x+l;n.y=t.y;n.load(t.flyurl);n.scale(t.scaleX,t.scaleY);n.play(0);app.MyTween.to(n,{x:n.x+Math.cos(o)*a,y:n.y+Math.sin(o)*a},a/t.speed,null,Laya.Handler.create(this,this.playFlyBoom,[n,e,t]),t.flydelay*e);if(t.flyMusic!=""){app.SoundManager.getIns().playSpecialSound(t.flyMusic)}}}t.currCount++};t.prototype.playFlyBoom=function(t,e,i){if(e==0){if(i.boomurl==""){i.boEnd=true;if(!i.useTarget){i.clearFlyMask()}this.checkEnd()}else{var n=this.addEff(i.boomurl);this.isoDisplay.addChild(n);n.on(Laya.Event.COMPLETE,this,this.onFlyBoomComplete,[n,i]);n.load(i.boomurl);n.play(0);n.x=t.x;n.y=t.y;if(i.boomMusic!=""){app.SoundManager.getIns().playSpecialSound(i.boomMusic)}}}this.removeEff(t)};t.prototype.onFlyBoomComplete=function(t,e){this.removeEff(t);e.boomCount++;if(e.boomCount>=e.num){e.boEnd=true;if(!e.useTarget){e.clearFlyMask()}this.checkEnd()}};t.prototype.playBoom=function(t){Laya.timer.once(t.startdelay,this,this.startBoomPer,[t],false)};t.prototype.startBoomPer=function(t){var e=t.duration/t.num;this.playBoomPer(t);Laya.timer.loop(e,this,this.playBoomPer,[t],false)};t.prototype.playBoomPer=function(t){if(t.currCount>=t.num){return}var e=this.addEff(t.boomurl);this.isoDisplay.addChild(e);e.on(Laya.Event.COMPLETE,this,this.onBoomComplete,[e,t]);e.x=t.x+game.SceneModel.random(t.mindisX,t.maxdisX);e.y=t.y+game.SceneModel.random(t.mindisY,t.maxdisY);e.scale(t.scaleX,t.scaleY);e.rotation=game.SceneModel.random(t.minAngle,t.maxAngle);e.load(t.boomurl);e.play(0);if(t.music!=""){app.SoundManager.getIns().playSpecialSound(t.music)}t.currCount++};t.prototype.onBoomComplete=function(t,e){this.removeEff(t);e.boomCount++;if(e.boomCount>=e.num){e.boEnd=true;this.checkEnd()}};t.prototype.checkEnd=function(){for(var t=0,e=this.voArr.length;t<e;t++){if(!this.voArr[t].boEnd){return}}this.voArr=[];this.far()};t.prototype.addEff=function(t){var e=Laya.Pool.getItemByClass("s_"+t,game.AniView);this.useEffArr.push(e);return e};t.prototype.removeEff=function(t){t.stop();t.removeSelf();t.offAll(Laya.Event.COMPLETE);Laya.Pool.recover("s_"+t.aniName,t);if(this.useEffArr){var e=this.useEffArr.indexOf(t);if(e!=-1){this.useEffArr.splice(e,1)}}};t.prototype.clearAll=function(){this.backChars();for(var t=0,e=this.useEffArr.length;t<e;t++){var i=this.useEffArr[t];if(i){i.stop();i.removeSelf();i.offAll(Laya.Event.COMPLETE);Laya.Pool.recover(i.aniName,i)}}this.useEffArr=null;this.attackVo=null;this.showVo=null;this.voArr=null;this.tarArr=null;this.hurtMap=null;Laya.timer.clearAll(this);Laya.Pool.recover("StageSkillEffect",this)};t.prototype.recycle=function(){scene.SceneMediator.getInstance().removeSkill(this);if(this.call){this.call.run()}app.TimerRewriter.boStop=false};t.prototype.updateFrame=function(t){};return t}(i.SkillEffect);i.StageSkillEffect=t;var f=function(){function o(){this.type=0;this.aninum=1;this.stoptime=0;this.alphatime=300;this.alpha=0;this.breaktime=100;this.music="";this.musicDelay=0;this.hurtDelay=0;this.hurtNum=10;this.hurtTime=200;this.boEnd=false}o.getJson=function(t){var e={};e["type"]=t["type"];for(var i=0,n=o.keys.length;i<n;++i){var a=o.keys[i];if(o.compare[a]!=t[a]){e[a]=t[a]}}return e};o.setJson=function(t,e){for(var i in e){t[i]=e[i]}};o.compare=new o;o.keys=["aninum","stoptime","alphatime","alpha","breaktime","music","musicDelay","hurtDelay","hurtNum","hurtTime"];return o}();i.StageSkillShowVo=f;var d=function(){function o(){this.type=1;this.url="skill_erwa_aoe01";this.starttime=0;this.x=0;this.y=-400;this.scaleX=1;this.scaleY=1;this.minAngle=0;this.maxAngle=0;this.loop=false;this.duration=0;this.music="";this.musicDelay=0;this.boEnd=false}o.getJson=function(t){var e={};e["type"]=t["type"];for(var i=0,n=o.keys.length;i<n;++i){var a=o.keys[i];if(o.compare[a]!=t[a]){e[a]=t[a]}}return e};o.setJson=function(t,e){for(var i in e){t[i]=e[i]}};o.compare=new o;o.keys=["url","starttime","x","y","scaleX","scaleY","minAngle","maxAngle","loop","duration","music","musicDelay"];return o}();i.StageSkillStartVo=d;var y=function(){function o(){this.type=2;this.flyurl="skill_erwa_aoe02";this.boomurl="skill_erwa_aoe03";this.x=0;this.y=0;this.scaleX=1;this.scaleY=1;this.offXL=0;this.offXR=0;this.useTarget=false;this.targetX=0;this.targetY=0;this.flynum=1;this.flydelay=0;this.speed=1;this.angle=45;this.minDis=200;this.maxDis=900;this.duration=1e3;this.num=10;this.startdelay=300;this.flyMusic="";this.boomMusic="";this.boEnd=false;this.currCount=0;this.boomCount=0}o.prototype.setFlyMask=function(t){this.flyBox=new Laya.Sprite;this.flyMask=new Laya.Sprite;t.addChild(this.flyBox);this.flyMask.graphics.drawRect(-Laya.stage.width/2,this.y,Laya.stage.width,Laya.stage.height,"#a5a5a5");this.flyBox.mask=this.flyMask};o.prototype.clearFlyMask=function(){this.flyBox.removeSelf();this.flyBox=null;this.flyMask=null};o.getJson=function(t){var e={};e["type"]=t["type"];for(var i=0,n=o.keys.length;i<n;++i){var a=o.keys[i];if(o.compare[a]!=t[a]){e[a]=t[a]}}return e};o.setJson=function(t,e){for(var i in e){t[i]=e[i]}};o.compare=new o;o.keys=["flyurl","boomurl","x","y","scaleX","scaleY","offXL","offXR","useTarget","targetX","targetY","flynum","flydelay","speed","angle","minDis","maxDis","duration","num","startdelay","breaktime","flyMusic","boomMusic"];return o}();i.StageSkillFlyVo=y;var v=function(){function o(){this.type=3;this.boomurl="skill_pitianliedi01";this.x=0;this.y=0;this.scaleX=1;this.scaleY=1;this.minAngle=0;this.maxAngle=0;this.mindisX=0;this.maxdisX=0;this.mindisY=200;this.maxdisY=600;this.duration=1e3;this.num=10;this.startdelay=0;this.music="";this.boEnd=false;this.currCount=0;this.boomCount=0}o.getJson=function(t){var e={};e["type"]=t["type"];for(var i=0,n=o.keys.length;i<n;++i){var a=o.keys[i];if(o.compare[a]!=t[a]){e[a]=t[a]}}return e};o.setJson=function(t,e){for(var i in e){t[i]=e[i]}};o.compare=new y;o.keys=["boomurl","x","y","scaleX","scaleY","minAngle","maxAngle","flynum","flydelay","speed","angle","mindisX","maxdisX","mindisY","maxdisY","duration","num","startdelay","music"];return o}();i.StageSkillBoomVo=v})(skill||(skill={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var skill;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.x=(Laya.stage.width-this.width)/2;this.y=(Laya.stage.height-this.height)/2;this.ani0.on("p_s_complete",this,this.onAniComplete);this.skt=new common.CSkt;this.load1=new Laya.Handler(this,this.loadSkill);this.load2=new Laya.Handler(this,this.loadSkt);this.load3=new Laya.Handler(this,this.startAni)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){this.box.visible=false;this.call=null;this.end=null;Laya.timer.clear(this,this.hide)};e.prototype.refreshAll=function(){this.vo=this.dataSource[0];this.call=this.dataSource[1];this.end=this.dataSource[2];this.alpha=0;this.ani=this["ani"+this.vo.aninum];this.box=this["box"+this.vo.aninum];this.imgpiaozi.skin="res/static/skill/dazhao_"+this.vo.aninum+".png";Laya.loader.load(["res/static/skill/bg_jinengzhanshi_bg.png","res/atlas/dazhao/speed.atlas"],this.load1)};e.prototype.loadSkill=function(){Laya.loader.load("res/atlas/dazhao/skill_"+this.vo.aninum+".atlas",this.load2)};e.prototype.loadSkt=function(){this.sktkey="bg_wa_"+this.vo.aninum;Laya.loader.load(["res/sks/"+this.sktkey+".sk","res/sks/"+this.sktkey+".png"],this.load3)};e.prototype.startAni=function(){this.alpha=1;var t=this["img"+this.vo.aninum];this.skt.x=t.width/2;this.skt.y=t.height/2;this.skt.init(role.RoleVO.getSkinSkt(this.sktkey));t.addChild(this.skt);Laya.timer.once(this.vo.musicDelay,this,this.playMusic);this.ani0.playToAndStop(this.ani0.count-1);this.ani.playToAndStop(this.ani.count-1);this.box.visible=true};e.prototype.onAniComplete=function(){Laya.timer.once(this.vo.stoptime,this,this.hide)};e.prototype.playMusic=function(){if(this.vo.music!=""){app.SoundManager.getIns().playSpecialSound(this.vo.music)}};e.prototype.hide=function(){if(!this.end){return}app.MyTween.toWithCall(this,{alpha:this.vo.alpha},this.vo.alphatime,null,this.end,0,this.call,this.vo.breaktime,false)};e.SINGLE_KEY="skill.StageSkillShow";return e}(ui.bosszhandou.jinengzhanshi_newUI);t.StageSkillShow=e})(skill||(skill={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.btnqianwangpeidai.clickHandler=new Laya.Handler(this,this.onClickHandler)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){var t=csv.ChatBubbleProxy.getIns().getCfg(this.dataSource);this.imgchenghao.sizeGrid=t.sizegrid;this.imgchenghao.skin=csv.ChatBubbleProxy.getIns().getBubbleIcon(t.id)};e.prototype.onClickHandler=function(){app.ViewManager.toggleDialog(i.AlertGetBubbleView,-1,0);game.ClosureManager.callFunction(csv.FunctionsProxy.ENUMS.CHAT_BUBBLE)};e.SINGLE_KEY="role.AlertGetBubbleView";return e}(ui.alert.qipaokuangjihuotipUI);i.AlertGetBubbleView=t})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.btnqianwangpeidai.clickHandler=new Laya.Handler(this,this.onClickHandler)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){var t=csv.HeadFrameProxy.getIns().getCfg(this.dataSource);this.imgframe.skin="res/static/touxiangkuang/"+t.show+".png"};e.prototype.onClickHandler=function(){app.ViewManager.toggleDialog(i.AlertGetHeadFrameView,-1,0);game.ClosureManager.callFunction(csv.FunctionsProxy.ENUMS.HEADFRAME)};e.SINGLE_KEY="role.AlertGetHeadFrameView";return e}(ui.alert.touxiangkuangjihuotipUI);i.AlertGetHeadFrameView=t})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=game.RoleModel.getIns()};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t,e){var i=this._model.aliveBubbleIds.indexOf(t.id)==-1;this.imgbg.gray=i;this.imgname.gray=i;this.imgname.skin="res/static/skin/"+t.iconword+".png";if(e&&e.id==t.id){this.imgbgxuanzhong.visible=this._model.aliveBubbleIds.indexOf(t.id)>=0;this.imghuisebgxuanzhong.visible=!this.imgbgxuanzhong.visible}else{this.imgbgxuanzhong.visible=false;this.imghuisebgxuanzhong.visible=false}this.imgyipeidai.visible=Boolean(t.id==this._model.useBubbleId);if(game.RoleModel.getIns().newBubbleIds.indexOf(t.id)>=0){game.RedDotView.addTo(this,this.width-10,30,1,1,game.RedDotView.ENUM_TYPE.XIN)}else{game.RedDotView.removeFrom(this)}};e.SINGLE_KEY="titleName.ChatBubbleItem";return e}(ui.qipaokuang.qipaokuangitem01UI);t.ChatBubbleItem=e})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=game.RoleModel.getIns();this.headframeList=new common.CommonListMediator(this.listyeqianpaizi,i.ChatBubbleItem);this.headframeList.setHSkin();this.btnshuaxin.clickHandler=new Laya.Handler(this,this.onClickHandler);this.imgyongjiu.visible=true;this.labelyouxiaoshijian.visible=false;this.jihuo01.visible=false;this.headframeList.on(common.CommonListMediator.LIST_ITEM_SELECT,this,this.onItemListSelect);this.shuxinglist.itemRender=game.ComAttrItem10;this.shuxinglist.renderHandler=game.ComAttrItem10.CommonRender;this.lbl.on(Laya.Event.CLICK,this,this.onShowAttr)};e.prototype.onShowAttr=function(){var t=[];for(var e=0;e<game.RoleModel.getIns().aliveBubbleIds.length;e++){var i=csv.ChatBubbleProxy.getIns().getCfg(game.RoleModel.getIns().aliveBubbleIds[e]);var n=Attributes.decode(i.activationattr);t=t.concat(n.baseList)}app.ViewManager.toggleDialog(common.ComAttrTip,1,0,Attributes.hebingAttributes(t))};e.prototype.onClickHandler=function(){var t=this.headframeList.selecItemData;if(t.id==this._model.useBubbleId){manager.FlowManager.instance.flowByStyle1(app.getLang("guard_tips4"));return}app.ProtocolRequest.SimpleBubbleUpdateReq(t.id)};e.prototype.onDisplay=function(){this._model.on(game.RoleModel.EVENTS.CHAT_BUBBLE_UPDATA,this,this.teamIconChange);this._model.on(game.RoleModel.EVENTS.CHAT_BUBBLE_USE_CHANGE,this,this.teamIconChange);this.zhanshi01.play(0);this.ani1.play(0,true);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){this._model.off(game.RoleModel.EVENTS.CHAT_BUBBLE_UPDATA,this,this.teamIconChange);this._model.off(game.RoleModel.EVENTS.CHAT_BUBBLE_USE_CHANGE,this,this.teamIconChange);this.zhanshi01.stop();this.ani1.stop()};e.prototype.refreshAll=function(){var t=csv.ChatBubbleProxy.getIns().bubbleArr;t.sort(this.sortHToL);this.headframeList.setData(0,t)};e.prototype.teamIconChange=function(){this.listyeqianpaizi.refresh();var t=this.headframeList.selecItemData;this.labelhuodetujing.text=app.getLang(t.get);if(this._model.aliveBubbleIds.indexOf(t.id)!=-1){this.btnshuaxin.disabled=false;if(t.id==this._model.useBubbleId){this.btnshuaxin.label=app.getLang("guard_tips4")}else{this.btnshuaxin.label=app.getLang("title_load")}}else{this.btnshuaxin.disabled=true;this.btnshuaxin.label=app.getLang("magicweapon_des6")}};e.prototype.onItemListSelect=function(){var t=this.headframeList.selecItemData;if(t.activationattr!=""){var e=Attributes.decode(t.activationattr);this.shuxinglist.array=e.baseList;this.box.visible=true}else{this.box.visible=false}var i=this._model.newBubbleIds.indexOf(t.id);if(i>=0){this._model.newBubbleIds.splice(i,1);this._model.onBubbleRedDotChange()}this.imgchenghao.sizeGrid=t.sizegrid;this.imgchenghao.skin=csv.ChatBubbleProxy.getIns().getBubbleIcon(t.id);this.labelhuodetujing.text=app.getLang(t.get);this.weihuodeimg.visible=false;if(this._model.aliveBubbleIds.indexOf(t.id)!=-1){this.btnshuaxin.disabled=false;if(t.id==this._model.useBubbleId){this.btnshuaxin.label=app.getLang("guard_tips4")}else{this.btnshuaxin.label=app.getLang("title_load")}}else{this.btnshuaxin.disabled=true;this.btnshuaxin.label=app.getLang("magicweapon_des6");this.weihuodeimg.visible=true}this.btnshuaxin.visible=!this.weihuodeimg.visible};e.prototype.sortHToL=function(t,e){var i=game.RoleModel.getIns();if(t.id==i.useBubbleId){return-1}if(e.id==i.useBubbleId){return 1}var n=i.aliveBubbleIds.indexOf(t.id)>=0;var a=i.aliveBubbleIds.indexOf(e.id)>=0;if(n&&!a){return-1}if(!n&&a){return 1}if(t.id<e.id){return-1}else if(t.id>e.id){return 1}return 0};e.SINGLE_KEY="role.ChatBubbleView";return e}(ui.qipaokuang.qipaokuangviewUI);i.ChatBubbleView=t})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=game.RoleModel.getIns()};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t,e){var i=this._model.aliveGuajianIds.indexOf(t.id)==-1;this.imgbg.gray=i;this.imgname.gray=i;this.imgname.skin="res/static/skin/"+t.iconword+".png";if(e&&e.id==t.id){this.imgbgxuanzhong.visible=this._model.aliveGuajianIds.indexOf(t.id)>=0;this.imghuisebgxuanzhong.visible=!this.imgbgxuanzhong.visible}else{this.imgbgxuanzhong.visible=false;this.imghuisebgxuanzhong.visible=false}this.imgyipeidai.visible=this._model.useGuajianIds.indexOf(t.id)!=-1;if(game.RoleModel.getIns().newGujianIds.indexOf(t.id)>=0){game.RedDotView.addTo(this,this.width-10,30,1,1,game.RedDotView.ENUM_TYPE.XIN)}else{game.RedDotView.removeFrom(this)}};e.SINGLE_KEY="titleName.GuajianItem";return e}(ui.fabaoguajian.guajianitem01UI);t.GuajianItem=e})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=game.RoleModel.getIns();this.fabaoliebiao.itemRender=fabaonew.FaBaoLieBiaoItemShow;this.fabaoliebiao.renderHandler=new Laya.Handler(this,this.onHander)};e.prototype.onHander=function(t,e){t.setData(t.dataSource)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){this.dataSource.sort(this.sortRule);this.fabaoliebiao.array=this.dataSource};e.prototype.sortRule=function(t,e){if(t.cfg.id>e.cfg.id){return 1}else if(t.cfg.id<e.cfg.id){return-1}return 0};e.SINGLE_KEY="role.GuajianShowView";return e}(ui.fabaoguajian.guajianishowUI);t.GuajianShowView=e})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=game.RoleModel.getIns();this.headframeList=new common.CommonListMediator(this.listyeqianpaizi,i.GuajianItem);this.headframeList.setHSkin();this.btnshuaxin.clickHandler=new Laya.Handler(this,this.onClickHandler);this.imgyongjiu.visible=true;this.labelyouxiaoshijian.visible=false;this.jihuo01.visible=false;this.headframeList.on(common.CommonListMediator.LIST_ITEM_SELECT,this,this.onItemListSelect)};e.prototype.onClickHandler=function(){var t=this.headframeList.selecItemData;if(this._model.useGuajianIds.indexOf(t.id)!=-1){app.ProtocolRequest.MagicPluginReq(t.id,0)}else{app.ProtocolRequest.MagicPluginReq(t.id,1)}};e.prototype.onDisplay=function(){this._model.on(game.RoleModel.EVENTS.GUAJIAN_USE_CHANGE,this,this.teamIconChange);this.zhanshi01.play(0);this.ani1.play(0,true);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){this._model.off(game.RoleModel.EVENTS.GUAJIAN_USE_CHANGE,this,this.teamIconChange);this.zhanshi01.stop();this.ani1.stop()};e.prototype.refreshAll=function(){var t=csv.GuajianProxy.getIns().cfgArr;t.sort(this.sortHToL);this.headframeList.setData(0,t)};e.prototype.teamIconChange=function(){this.listyeqianpaizi.refresh();var t=this.headframeList.selecItemData;this.labelhuodetujing.text=app.getLang(t.get);if(this._model.aliveGuajianIds.indexOf(t.id)!=-1){this.btnshuaxin.disabled=false;if(this._model.useGuajianIds.indexOf(t.id)!=-1){this.btnshuaxin.label=app.getLang("title_upload")}else{this.btnshuaxin.label=app.getLang("title_load")}}else{this.btnshuaxin.disabled=true;this.btnshuaxin.label=app.getLang("magicweapon_des6")}};e.prototype.onItemListSelect=function(){var t=this.headframeList.selecItemData;var e=this._model.newGujianIds.indexOf(t.id);if(e>=0){this._model.newGujianIds.splice(e,1);this._model.onGuajianRedDotChange()}this.imgchenghao.sizeGrid=t.sizegrid;var i=csv.ChouKaProxy.getIns().getBaseCfg(t.id);this.imgchenghao.skin=csv.ChouKaProxy.getIns().getRes(i);this.labelhuodetujing.text=app.getLang(t.get);this.weihuodeimg.visible=false;if(this._model.aliveGuajianIds.indexOf(t.id)!=-1){this.btnshuaxin.disabled=false;if(this._model.useGuajianIds.indexOf(t.id)!=-1){this.btnshuaxin.label=app.getLang("title_upload")}else{this.btnshuaxin.label=app.getLang("title_load")}}else{this.btnshuaxin.disabled=true;this.btnshuaxin.label=app.getLang("magicweapon_des6");this.weihuodeimg.visible=true}this.btnshuaxin.visible=!this.weihuodeimg.visible};e.prototype.sortHToL=function(t,e){var i=game.RoleModel.getIns();if(i.useGuajianIds.indexOf(t.id)>=0){return-1}if(i.useGuajianIds.indexOf(e.id)>=0){return 1}var n=i.aliveGuajianIds.indexOf(t.id)>=0;var a=i.aliveGuajianIds.indexOf(e.id)>=0;if(n&&!a){return-1}if(!n&&a){return 1}if(t.id<e.id){return-1}else if(t.id>e.id){return 1}return 0};e.SINGLE_KEY="role.GuajianView";return e}(ui.fabaoguajian.guajianUI);i.GuajianView=t})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.headframeList=new common.CommonListMediator(this.listyeqianpaizi,i.RoleHeadFrameItem);this.headframeList.setHSkin();this.btnpeidai.clickHandler=new Laya.Handler(this,this.onClickHandler);this.imgyongjiu.visible=false;this.zhanshi01.visible=false;this.jihuo01.visible=false;this.zhanshi01.stop();this.jihuo01.stop();this.jihuo01.on(Laya.Event.COMPLETE,this,this.onAniEnd);this.ani1.stop();this.labelhuodetujing.on(Laya.Event.CLICK,this,this.onOpenWin);this.headframeList.on(common.CommonListMediator.LIST_ITEM_SELECT,this,this.onItemListSelect);this.shuxinglist.itemRender=game.ComAttrItem10;this.shuxinglist.renderHandler=game.ComAttrItem10.CommonRender;this.lbl.on(Laya.Event.CLICK,this,this.onShowAttr)};e.prototype.onShowAttr=function(){var t=[];for(var e=0;e<game.RoleModel.getIns().headframeList.length;e++){var i=game.RoleModel.getIns().headframeList[e];if(i.state){var n=csv.HeadFrameProxy.getIns().getCfg(i.headframeId);var a=Attributes.decode(n.activationattr);t=t.concat(a.baseList)}}app.ViewManager.toggleDialog(common.ComAttrTip,1,0,Attributes.hebingAttributes(t))};e.prototype.onAniEnd=function(){this.jihuo01.visible=false;this.jihuo01.stop()};e.prototype.onDisplay=function(){game.RoleModel.getIns().on(game.RoleModel.EVENTS.HEADFRAMEID_CHANGE,this,this.onUpdateEquipInfo);game.RoleModel.getIns().on(game.RoleModel.EVENTS.HEADFRAME_UPDATE,this,this.onUpdateList);app.ProtocolRequest.HeadFrameInfoReq();this.callLater(this.refreshAll);this.zhanshi01.play(0);this.zhanshi01.visible=true;this.ani1.play(0,true);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){game.RoleModel.getIns().off(game.RoleModel.EVENTS.HEADFRAMEID_CHANGE,this,this.onUpdateEquipInfo);game.RoleModel.getIns().off(game.RoleModel.EVENTS.HEADFRAME_UPDATE,this,this.onUpdateList);this.zhanshi01.stop();this.jihuo01.stop();this.zhanshi01.visible=false;this.jihuo01.visible=false;this.ani1.stop()};e.prototype.refreshAll=function(){this.onUpdateList(true)};e.prototype.onOpenWin=function(){var t=this.headframeList.selecItemData;var e=csv.HeadFrameProxy.getIns().getCfg(t.headframeId);var i=parseInt(e.window);if(i>0){game.ClosureManager.callFunction(parseInt(e.window),true,true)}};e.prototype.clean=function(){this._endTime=0;Laya.timer.clear(this,this.coolDown)};e.prototype.coolDown=function(){var t=this._endTime-game.Context.getServerTime();if(t>0){this.labelyouxiaoshijian.text=app.getLang("title_limit",util.TimeUtil.sec2Str(t))}else{this.labelyouxiaoshijian.text=app.getLang("title_limit",util.TimeUtil.sec2Str(0));this.clean()}};e.prototype.onItemListSelect=function(){var t=this.headframeList.selecItemData.headframeId;var e=game.RoleModel.getIns().getHeadFrameDataById(t);var i=csv.HeadFrameProxy.getIns().getCfg(t);if(i.activationattr!=""){var n=Attributes.decode(i.activationattr);this.shuxinglist.array=n.baseList;this.box.visible=true}else{this.box.visible=false}this.labelhuodetujing.text=i.lang?app.getLang(i.lang):"";var a=parseInt(i.window);this.labelhuodetujing.underline=false;if(a>0){this.labelhuodetujing.underline=true}this.imgframe.skin="res/static/touxiangkuang/"+i.show+".png";this.clean();var o=0;if(i.p1&&i.p1>0){o=i.p1*3600}if(o>0){if(e.state==1){var s=e.activeTime+o-game.Context.getServerTime();this.labelyouxiaoshijian.text=app.getLang("title_limit",util.TimeUtil.sec2Str(s));this._endTime=e.activeTime+o;Laya.timer.loop(1e3,this,this.coolDown)}else{this.labelyouxiaoshijian.text=app.getLang("title_limit",util.TimeUtil.sec2Str(o))}this.labelyouxiaoshijian.visible=true}else{this.labelyouxiaoshijian.visible=false}this.imgyongjiu.visible=!this.labelyouxiaoshijian.visible;this.refreshBtn(e);game.RedDotView.removeFrom(this.btnpeidai);if(e.state==0&&game.GridsModel.getIns().hasEnoughItems(i.item,false,false)){game.RedDotView.addTo(this.btnpeidai)}var r=game.RoleModel.getIns().newheadframeId;var l=r.indexOf(t);if(l>=0){r.splice(l,1);game.RoleModel.getIns().newheadframeId=r}};e.prototype.refreshBtn=function(t){if(t){var e="";this.btnpeidai.disabled=t.state?false:true;this.weihuodeimg.visible=false;if(t.state==0){this.weihuodeimg.visible=true;e=app.getLang("magicweapon_des6");var i=csv.HeadFrameProxy.getIns().getCfg(t.headframeId);if(i){var n=game.GridsModel.getIns().hasEnoughItems(i.item,false,false);if(n){this.btnpeidai.disabled=false;e=app.getLang("tip_btn_39")}}}else if(t.headframeId==game.RoleModel.getIns().headFrameId){e=app.getLang("title_upload")}else{e=app.getLang("title_load")}this.btnpeidai.visible=!this.weihuodeimg.visible;this.btnpeidai.label=e}};e.prototype.onClickHandler=function(){var t=this.headframeList.selecItemData.headframeId;var e=game.RoleModel.getIns().getHeadFrameDataById(t);if(e.state==0){var i=csv.HeadFrameProxy.getIns().getCfg(e.headframeId);if(i){var n=game.ItemUtil.parserList(i.item)[0];var a=game.GridsModel.getIns().hasEnoughItems(n,false,false);if(a){var o=game.GridsModel.getIns().getItemByItemId(n.getItemId()).getInstId();app.ProtocolRequest.UseItemReq(o,n.count,Uint64.ZERO);this.jihuo01.visible=true;this.jihuo01.play(0,false)}}}else{game.RoleModel.getIns().onHeadFrameEquipReq(e);if(this.headframeList.selecItemData.headframeId!=game.RoleModel.getIns().headFrameId){this.jihuo01.visible=true;this.jihuo01.play(0,false)}}};e.prototype.onUpdateEquipInfo=function(){this.refreshBtn(this.headframeList.selecItemData)};e.prototype.onUpdateList=function(t){if(t===void 0){t=false}if(t){var e=0,i=void 0;var n=game.RoleModel.getIns().headframeList;n.sort(this.sortHToL);for(var a=0;a<n.length;a++){if(n[a].state==0){i=game.RoleModel.getIns().headFrameActiveCheck(n[a].headframeId);if(i){e=a;break}}}this.headframeList.setData(e,n)}else{this.listyeqianpaizi.refresh();this.onItemListSelect()}};e.prototype.sortHToL=function(t,e){if(game.RoleModel.getIns().headFrameId==t.headframeId)return-1;if(game.RoleModel.getIns().headFrameId==e.headframeId)return 1;if(t.state>e.state){return-1}if(t.state<e.state){return 1}if(t.headframeId<e.headframeId){return-1}if(t.headframeId>e.headframeId){return 1}return 0};e.SINGLE_KEY="role.HeadFrameView";return e}(ui.touxiangkuang.touxiangkuangUI);i.HeadFrameView=t})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(i){var t=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t.loadAtlas("res/atlas/ani/ui/skill_shengji.atlas",Laya.Handler.create(t,t.loadComplete));return t}t.prototype.loadComplete=function(){this.loadAnimation("res/atlas/ani/ui/skill_shengji.ani",Laya.Handler.create(this,this.aniLoaded))};t.prototype.aniLoaded=function(){this.play(0,false);this.on(Laya.Event.COMPLETE,this,this.onComplete)};t.prototype.onComplete=function(){this.removeSelf()};t.Add=function(){var t=new i.LevelUpView;if(Laya.stage.contains(i.LeadingRoleView.getIns())){i.LeadingRoleView.getIns().addChild(t);t.y=-210}};return t}(Laya.Animation);i.LevelUpView=t})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.shouyilist.renderHandler=new Laya.Handler(this,this.onListRender);this.ronglianlist.renderHandler=new Laya.Handler(this,this.onListRender);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.huodebtn1.clickHandler=new Laya.Handler(this,this.showVipView);this.huodebtn2.clickHandler=new Laya.Handler(this,this.showShopView);this.boxGuaji.visible=true;this.boxQuickGuaji.visible=false;this.titlebg.skin="res/static/txt_title_guajishouyi.png"};e.prototype.showVipView=function(){game.ClosureManager.callFunction(csv.FunctionsProxy.ENUMS.VIP,true,true)};e.prototype.showShopView=function(){game.ClosureManager.callFunction(csv.FunctionsProxy.ENUMS.GUARD,true,true)};e.prototype.onDisplay=function(){guide.GuideModel.getIns().boOpen=false;this.callLater(this.updateLayout)};e.prototype.onUnDisplay=function(){guide.GuideModel.getIns().boOpen=true};e.prototype.updateLayout=function(){var t=this.dataSource;this.shijianlab.text=app.getLang("offline_time",util.TimeUtil.formatTime(t.guajiSec));var e=t.guajiAward;var i=game.Config.getParams(410);var n=game.ItemUtil.parserList(i);var a=[];for(var o=e.length-1;o>=0;o--){for(var s=0;s<n.length;s++){if(e[o].itemID==n[s].getItemId()){a=e.splice(o,1).concat(a);break}}}if(a.length>0){a.sort(this.sortSpecialData)}if(e.length>0){e.sort(this.sortItemData);a.push.apply(a,e)}this.shouyilist.array=a;this.ronglianlist.array=t.ronglianAward;this.shuzhi1.text=game.MoneyModel.format(t.addExp.toNumber());this.shuzhi2.text=game.MoneyModel.format(t.addGold.toNumber());this.shuzhi3.text=game.MoneyModel.format(t.addSp.toNumber());this.vipCheck()};e.prototype.onListRender=function(t){var e=game.ItemUtil.createVO(t.dataSource.itemID);e.setCount(t.dataSource.value);t.gezi.setData(e);t.gezi.mouseEnabled=false;t.gezi.shuzi.text="";t.shulianglab.text=e.getName()+"x"+game.MoneyModel.format(e.count);var i=game.Config.getParams(410);var n=game.ItemUtil.parserList(i);var a=-1;for(var o=0;o<n.length;o++){if(n[o].getItemId()==e.getItemId()){a=o;break}}if(a>=0){if(a==0){t.shulianglab.text=app.getLang("offline_show1")+"x"+game.MoneyModel.format(e.count)}else if(a==1){t.shulianglab.text=app.getLang("offline_show2")+"x"+game.MoneyModel.format(e.count)}else if(a==2){t.shulianglab.text=app.getLang("offline_show3")+"x"+game.MoneyModel.format(e.count)}else if(a==3){t.shulianglab.text=app.getLang("offline_show4")+"x"+game.MoneyModel.format(e.count)}}};e.prototype.vipCheck=function(){var t=vipcode.VipModel.getIns().vipLvl;if(t>0){this.huodeimg.visible=true;this.huodebtn1.visible=false}else{this.huodeimg.visible=false;this.huodebtn1.visible=true}};e.prototype.sortSpecialData=function(t,e){if(t.itemID<e.itemID){return-1}else if(t.itemID>e.itemID){return 1}return 0};e.prototype.sortItemData=function(t,e){var i=csv.ItemProxy.getIns().getItemCfgById(t.itemID);var n=csv.ItemProxy.getIns().getItemCfgById(e.itemID);if(i.qua>n.qua){return-1}else if(i.qua<n.qua){return 1}return 0};e.SINGLE_KEY="role.OffLineExpView";return e}(ui.lixianjingyan.lixianjingyanbgUI);t.OffLineExpView=e})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(t){var e=function(t){__extends(s,t);function s(){return t!==null&&t.apply(this,arguments)||this}s.getIns=function(){return app.Singleton.getInstance(s)};s.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.mianfeibtn.clickHandler=new Laya.Handler(this,this.onTrain);this.cishubtn.clickHandler=new Laya.Handler(this,this.onTrain);this.jianglilist.itemRender=grids.GridView;this.jianglilist.renderHandler=grids.GridView.CommonItemRenderWithBtn;this.centerLayout=new game.CenterLayoutMediator(this.jianglilist,this.jianglibox,98,10);if(game.Context.disableIosRecharge()){this.wenhao.visible=this.guizelab.visible=false}else{game.HelperViewHandler.registerStr([this.wenhao,this.guizelab],"func147t","func147")}guide.GuideModel.getIns().register(csv.GuideProxy.ENUM_VIEW.QUICK_BATTLE_CLICK,this.mianfeibtn,null,500);guide.GuideModel.getIns().register(csv.GuideProxy.ENUM_VIEW.QUICK_GUAJI_CLOSE,this.closebtn,null,500)};s.prototype.onDisplay=function(){game.Context.event(game.ContextEvent.FUNCTION_OPEN);game.RoleModel.getIns().on(game.RoleModel.EVENTS.ROLE_OFFLINE_AWARD_ITEM_UPDATE,this,this.refreshAll);this.callLater(this.refreshAll)};s.prototype.onUnDisplay=function(){game.Context.event(game.ContextEvent.FUNCTION_CLOSE);game.RoleModel.getIns().off(game.RoleModel.EVENTS.ROLE_OFFLINE_AWARD_ITEM_UPDATE,this,this.refreshAll);this.playGuildEff(false);s.boEffect=false;var t=main.MainUIIcon.getMainUIIcon(csv.MainIconProxy.TYPE_ICON_QUICKGUAJI);if(t){t.setEffect(false)}};s.prototype.refreshAll=function(){if(s.boEffect){this.playGuildEff(true)}game.RoleModel.getIns().result=0;var t=game.Config.getIntParams(498);this.txtDesc0.text=app.getLang("quickguaji_desc",t);var e=boss.BossModel.getIns().getDailyTime(csv.DailyTimeProxy.ENUM_TYPE.QUICK_GUAJI);var i=game.RoleModel.getIns().getTrainTimes();if(e.fnum>0){this.mianfeibtn.label=app.getLang("elitechallenge_des2");this.boxmianfei.visible=true;this.boxxiaohao.visible=false}else{var n=csv.DailyTimeProxy.getIns().buytime(csv.DailyTimeProxy.ENUM_TYPE.QUICK_GUAJI);if(n==0)n=1;var a=void 0;if(e.bnum>=n){a=csv.DailyTimeProxy.getIns().buycost(csv.DailyTimeProxy.ENUM_TYPE.QUICK_GUAJI,n)}else{a=csv.DailyTimeProxy.getIns().buycost(csv.DailyTimeProxy.ENUM_TYPE.QUICK_GUAJI,e.bnum+1)}this.cishubtn.labelColors=game.STYLES.YELLOW_YB_COLOR_S;var o=game.GridsModel.getIns().getItemCount(a[0]);if(o<a[1]){this.cishubtn.labelColors=game.STYLES.RED_COLOR_S}this.cishubtn.label=a[1];this.money.parserIcon(a[0]+"-"+a[1]);this.boxmianfei.visible=false;this.boxxiaohao.visible=true}if(i>0){this.cishu.color=game.STYLES.GREEN_COLOR_S;this.cishu.text=i+""}else{this.cishu.color=game.STYLES.RED_COLOR_S;this.cishu.text="0";this.mianfeibtn.label=app.getLang("button_name14");this.boxmianfei.visible=true;this.boxxiaohao.visible=false}this.updateAward()};s.prototype.updateAward=function(){var t=game.Config.getIntParams(498);var e=csv.GuajiProxy.getIns().getCfgGuanqia(guaji.GuajiModel.getIns().passId-1);var i=[];if(e){i=game.ItemUtil.parserList(e.reward);for(var n=0;n<i.length;n++){var a=Math.floor(i[n].count*t);i[n].setCount(a);if(i[n].getItemId()==game.ItemUtil.ENUMS.PET_EXP_ITEM&&!csv.FunctionsProxy.getIns().isOpen(csv.FunctionsProxy.ENUMS.PET_LIST)){i.splice(n,1);n--}}var o=game.ItemUtil.parserList(e.reward1)[0];if(o){var a=Math.floor(o.count*t*1e-4);if(a>0){o.setCount(a);i.push(o)}}}this.centerLayout.array=i};s.prototype.onTrain=function(){var t=boss.BossModel.getIns().getDailyTime(csv.DailyTimeProxy.ENUM_TYPE.QUICK_GUAJI);if(t.fnum>0){game.RoleModel.getIns().onTrain()}else{var e=game.RoleModel.getIns().getTrainTimes();if(e>0){var i=csv.DailyTimeProxy.getIns().buytime(csv.DailyTimeProxy.ENUM_TYPE.QUICK_GUAJI);if(i==0)i=1;var n=void 0;if(t.bnum>=i){n=csv.DailyTimeProxy.getIns().buycost(csv.DailyTimeProxy.ENUM_TYPE.QUICK_GUAJI,i)}else{n=csv.DailyTimeProxy.getIns().buycost(csv.DailyTimeProxy.ENUM_TYPE.QUICK_GUAJI,t.bnum+1)}var a=game.GridsModel.getIns().getItemCount(n[0]);if(a<n[1]){shop.ShopModel.getIns().askChongZhi()}else{if(game.SystemSetModel.getInstance().alertViewCheck(csv.FunctionsProxy.ENUMS.QUICK_GUAJI)){game.RoleModel.getIns().onTrain()}else{game.Alert.show(app.getLang("quickguajitips",n[1]),new Laya.Handler(game.RoleModel.getIns(),game.RoleModel.getIns().onTrain),new Laya.Handler,0,"","","center","center",csv.FunctionsProxy.ENUMS.QUICK_GUAJI)}}}else{game.ClosureManager.callFunction(csv.FunctionsProxy.ENUMS.VIP);this.close()}}};s.prototype.playGuildEff=function(t){if(!this.aniEff){this.aniEff=new game.AniView;this.aniEff.load("skill_xuanzhong01",game.AniView.FILE_NAME.UI)}if(t){var e=void 0;if(this.cishubtn.visible){e=this.boxxiaohao}else if(this.mianfeibtn.visible){e=this.boxmianfei}if(e){this.aniEff.x=e.x+85;this.aniEff.y=e.y+28;this.aniEff.play();this.aniEff.visible=true;this.addChild(this.aniEff)}}else{this.aniEff.stop();this.aniEff.visible=false;this.aniEff.removeSelf()}};s.SINGLE_KEY="role.QuickGuajiView";return s}(ui.lixianjingyan.kuaisuguajitipUI);t.QuickGuajiView=e})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){game.RoleModel.getIns().on(game.RoleModel.EVENTS.HEADFRAMEID_CHANGE,this,this.refreshflag);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){game.RoleModel.getIns().off(game.RoleModel.EVENTS.HEADFRAMEID_CHANGE,this,this.refreshflag)};e.prototype.refreshAll=function(){};e.prototype.setData=function(t,e){var i=t.headframeId;t=game.RoleModel.getIns().getHeadFrameDataById(i);this._data=t;var n=csv.HeadFrameProxy.getIns().getCfg(t.headframeId);this.imgname.skin="res/static/skin/"+n.res+".png";this.imgframe.skin=csv.HeadFrameProxy.getIns().getIcon(t.headframeId);var a=t.state?false:true;this.imgbg.gray=a;this.imgframe.gray=a;this.imgtouxiang.gray=a;this.imgtouxiangbg.gray=a;this.imgname.gray=a;this.refreshflag();if(e&&e.headframeId==t.headframeId){this.imgbgxuanzhong.visible=t.state?true:false;this.imghuisebgxuanzhong.visible=!this.imgbgxuanzhong.visible}else{this.imgbgxuanzhong.visible=false;this.imghuisebgxuanzhong.visible=false}game.RedDotView.removeFrom(this);if(game.RoleModel.getIns().newheadframeId.indexOf(i)>=0){game.RedDotView.addTo(this,this.width-10,30,1,1,game.RedDotView.ENUM_TYPE.XIN)}else if(t.state==0&&game.GridsModel.getIns().hasEnoughItems(n.item,false,false)){game.RedDotView.addTo(this,this.width,40)}};e.prototype.refreshflag=function(){this.imgyipeidai.visible=false;if(this._data&&this._data.state==1&&this._data.headframeId==game.RoleModel.getIns().headFrameId){this.imgyipeidai.visible=true}};e.SINGLE_KEY="role.RoleHeadFrameItem";return e}(ui.touxiangkuang.touxiangkuangitem01UI);t.RoleHeadFrameItem=e})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.timetf.y=0;this.aniEffect=new game.AniView;this.aniEffect.load("skill_zhandoutubiao01",game.AniView.FILE_NAME.UI);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onUnDisplay=function(){this.aniEffect.stop();this.aniEffect.removeSelf()};Object.defineProperty(e.prototype,"percent",{set:function(t){if(t>0){this.bossxuetiao.visible=true;this.bossxuetiao.value=t}else{this.bossxuetiao.visible=false}},enumerable:true,configurable:true});e.prototype.showfight=function(t){if(t){this.aniEffect.play()}else{this.aniEffect.stop()}if(t){this.addChild(this.aniEffect)}else{this.aniEffect.removeSelf()}};e.prototype.showCutDownTime=function(t){this.relviTime=t;this.ticketHandler()};e.prototype.ticketHandler=function(){var t=this.relviTime-game.Context.getServerTime();if(t<=0){this.timetf.text=""}else{this.timetf.text=util.TimeUtil.formatTime(t,false);Laya.timer.once(1e3,this,this.ticketHandler)}};return e}(ui.bosszhandou.changjingbossxuetiaoUI);t.SceneBossBloodView=e})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t,e){this._data=t;this.imgtouxiang.skin=csv.MyTeamProxy.getIns().getTeamIcon(t.id);this.imgname.skin=csv.MyTeamProxy.getIns().getTeamIconName(t.id);var i=game.Context.aliveTeamAvatars.indexOf(t.id)==-1;this.imgbg.gray=i;this.imgtouxiang.gray=i;this.imgtouxiang.gray=i;this.imgtouxiangbg.gray=i;this.imgname.gray=i;if(e&&e.id==t.id){this.imgbgxuanzhong.visible=game.Context.aliveTeamAvatars.indexOf(t.id)>=0;this.imghuisebgxuanzhong.visible=!this.imgbgxuanzhong.visible}else{this.imgbgxuanzhong.visible=false;this.imghuisebgxuanzhong.visible=false}this.imgyipeidai.visible=Boolean(this._data.id==game.Context.teamAvatar);game.RedDotView.removeFrom(this);if(game.RoleModel.getIns().newTeamAvatar.indexOf(t.id)>=0){game.RedDotView.addTo(this,this.width-10,30,1,1,game.RedDotView.ENUM_TYPE.XIN)}};e.SINGLE_KEY="role.TeamIconItem";return e}(ui.touxiang.touxiangitem01UI);t.TeamIconItem=e})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.headframeList=new common.CommonListMediator(this.listyeqianpaizi,i.TeamIconItem);this.headframeList.setHSkin();this.btnpeidai.clickHandler=new Laya.Handler(this,this.onClickHandler);this.imgyongjiu.visible=true;this.labelyouxiaoshijian.visible=false;this.jihuo01.visible=false;this.headframeList.on(common.CommonListMediator.LIST_ITEM_SELECT,this,this.onItemListSelect);this.shuxinglist.itemRender=game.ComAttrItem10;this.shuxinglist.renderHandler=game.ComAttrItem10.CommonRender;this.lbl.on(Laya.Event.CLICK,this,this.onShowAttr);guide.GuideModel.getIns().register(csv.GuideProxy.ENUM_VIEW.TEAM_ICON_SELECT,this,this.getGuideItemBtn,300);guide.GuideModel.getIns().register(csv.GuideProxy.ENUM_VIEW.TEAM_ICON_WEAR,this.btnpeidai)};e.prototype.getGuideItemBtn=function(t){var e=csv.MyTeamProxy.getIns().teamioncArr;e.sort(this.sortHToL);this.headframeList.setData(0,e);for(var i=0,n=this.listyeqianpaizi.cells.length;i<n;i++){var a=this.listyeqianpaizi.cells[i];if(a.dataSource&&a.dataSource.id==t){return a}}return null};e.prototype.onShowAttr=function(){var t=[];for(var e=0;e<game.Context.aliveTeamAvatars.length;e++){var i=csv.MyTeamProxy.getIns().getCfg(game.Context.aliveTeamAvatars[e]);var n=Attributes.decode(i.activationattr);t=t.concat(n.baseList)}app.ViewManager.toggleDialog(common.ComAttrTip,1,0,Attributes.hebingAttributes(t))};e.prototype.onClickHandler=function(){var t=this.headframeList.selecItemData;if(t.id==game.Context.teamAvatar){manager.FlowManager.instance.flowByStyle1(app.getLang("guard_tips4"));return}app.ProtocolRequest.SimpleTeamUpdateAvatarReq(t.id)};e.prototype.onDisplay=function(){game.RoleModel.getIns().on(game.RoleModel.EVENTS.TEAM_INFO_CHANGE,this,this.teamIconChange);game.RoleModel.getIns().on(game.RoleModel.EVENTS.TEAM_ICON_CHANGE,this,this.teamIconChange);this.zhanshi01.play(0);this.ani1.play(0,true);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){game.RoleModel.getIns().off(game.RoleModel.EVENTS.TEAM_INFO_CHANGE,this,this.teamIconChange);game.RoleModel.getIns().off(game.RoleModel.EVENTS.TEAM_ICON_CHANGE,this,this.teamIconChange);this.zhanshi01.stop();this.ani1.stop()};e.prototype.refreshAll=function(){var t=csv.MyTeamProxy.getIns().teamioncArr;t.sort(this.sortHToL);this.headframeList.setData(0,t)};e.prototype.teamIconChange=function(){this.listyeqianpaizi.refresh();var t=this.headframeList.selecItemData;this.labelhuodetujing.text=app.getLang(t.get);if(game.Context.aliveTeamAvatars.indexOf(t.id)!=-1){this.btnpeidai.disabled=false;if(t.id==game.Context.teamAvatar){this.btnpeidai.label=app.getLang("guard_tips4")}else{this.btnpeidai.label=app.getLang("title_load")}}else{this.btnpeidai.disabled=true;this.btnpeidai.label=app.getLang("magicweapon_des6")}};e.prototype.onItemListSelect=function(){var t=this.headframeList.selecItemData;this.imgframe.skin=csv.MyTeamProxy.getIns().getTeamIcon(t.id);if(t.activationattr!=""){var e=Attributes.decode(t.activationattr);this.shuxinglist.array=e.baseList;this.box.visible=true}else{this.box.visible=false}var i=game.RoleModel.getIns().newTeamAvatar.indexOf(t.id);if(i>=0){game.RoleModel.getIns().newTeamAvatar.splice(i,1);game.RoleModel.getIns().onTeamAvatarRedDotChange()}this.labelhuodetujing.text=app.getLang(t.get);this.weihuodeimg.visible=false;if(game.Context.aliveTeamAvatars.indexOf(t.id)!=-1){this.btnpeidai.disabled=false;if(t.id==game.Context.teamAvatar){this.btnpeidai.label=app.getLang("guard_tips4")}else{this.btnpeidai.label=app.getLang("title_load")}}else{this.btnpeidai.disabled=true;this.btnpeidai.label=app.getLang("magicweapon_des6");this.weihuodeimg.visible=true}this.btnpeidai.visible=!this.weihuodeimg.visible};e.prototype.sortHToL=function(t,e){if(t.id==game.Context.teamAvatar){return-1}if(e.id==game.Context.teamAvatar){return 1}var i=game.Context.aliveTeamAvatars.indexOf(t.id)>=0;var n=game.Context.aliveTeamAvatars.indexOf(e.id)>=0;if(i&&!n){return-1}if(!i&&n){return 1}if(t.id<e.id){return-1}else if(t.id>e.id){return 1}return 0};e.SINGLE_KEY="role.TeamIconView";return e}(ui.touxiang.touxiangUI);i.TeamIconView=t})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var scene;(function(n){var t=function(e){__extends(i,e);function i(){var t=e!==null&&e.apply(this,arguments)||this;t._worldScale=1;t.minScale=.8;t.maxScale=1;return t}i.getIns=function(){if(!i._instance){var t=new i;var e=new n.CarmeraVO;e.insId=Uint64.initClientUint64();t.init(e);i._instance=t}return i._instance};i.prototype.init=function(t){e.prototype.init.call(this,t)};i.prototype.setObscured=function(t){this.alpha=0};i.prototype.updateFrame=function(t){this.changeScale(t)};i.prototype.changeScale=function(t){if(this._tarScale){var e=this._scaleAdd/120*t;if(Math.abs(this._tarScale-this._worldScale)<Math.abs(e)){this.worldScale=this._tarScale;this._tarScale=null;if(this.call){this.call.run()}}else{this.worldScale+=e}}};i.prototype.initScale=function(t){this._worldScale=t};Object.defineProperty(i.prototype,"worldScale",{get:function(){if(this._worldScale>this.maxScale){this._worldScale=this.maxScale}if(this._worldScale<this.minScale){this._worldScale=this.minScale}return this._worldScale},set:function(t){if(t>this.maxScale){t=this.maxScale}if(this._worldScale<this.minScale){t=this.minScale}this._worldScale=t},enumerable:true,configurable:true});i.prototype.changeWorldScale=function(t,e){if(t==this._worldScale){return}if(t>this.maxScale){t=this.maxScale}if(t<this.minScale){t=this.minScale}this._scaleAdd=.04*(t>this._worldScale?1:-1);this._tarScale=t;this.call=e};i.prototype.clearAll=function(){this._tarScale=null;this.call=null};return i}(n.SceneItemView);n.CameraView=t})(scene||(scene={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var scene;(function(i){var t=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.setRoleAni=function(t,e,i){if(i===void 0){i=false}this.avatar.setAni(t,e,i)};t.prototype.init=function(t){this.boLink=true;this.sceneMediator=i.SceneMediator.getInstance();e.prototype.init.call(this,t);this.initRole();this.sceneMediator.setStandPos(this.vo.insId,this.vo.posX,this.vo.posY)};t.prototype.initRole=function(){this.avatar=new avatar.AvatarAnimation;this.avatar.on(avatar.AvatarAnimation.EVENTS.LOADED,this,this.onAniLoaded);this.avatar.canstop=true;this.avatar.setAniData(this.vo);this.avatar.play();this.roleState=role.RoleStateConst.IDLE;this._shadow=new Laya.Image("res/assist/circle.png");this._shadow.anchorX=this._shadow.anchorY=.5;this.isoDisplay.addChild(this.avatar);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);var t=this.vo;this.headView=new role.NpcHeadView(t);this.headView.y=-t.getModelHeight();this.addChild(this.headView);this.avatar.setAniData(t);var e=t.getCfg().times;if(e==0){e=100}this.isoDisplay.scale(e/100,e/100);this.on(Laya.Event.CLICK,this,this.onClick)};t.prototype.setObscured=function(t){this.avatar.alpha=t?.6:1};t.prototype.updateFrame=function(t){if(this._moveAction){if(this._moveAction.isCompleted()){this._moveAction=null;this.roleState=role.RoleStateConst.IDLE;return}this._moveAction.onFrame(t)}};t.prototype.setMoveAction=function(t,e){if(this.roleState==role.RoleStateConst.DIE){return}if(this._moveAction){this._moveAction.cancel(e)}this._moveAction=t;this.roleState=role.RoleStateConst.MOVE};Object.defineProperty(t.prototype,"currentAniName",{get:function(){return this.avatar.aniName},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"currentAniDri",{get:function(){return this.avatar.dir},enumerable:true,configurable:true});t.prototype.onDisplay=function(){this.mouseEnabled=true;var t=this.vo;this.avatar.setAniData(t);this._shadow.noGlobal=true;util.SpriteLinkUtil.addLinkChild(this,this._shadow,this.sceneMediator.isoWorld.shadowLayer,0,0,true)};t.prototype.onUnDisplay=function(){util.SpriteLinkUtil.removeLinkChild(this,this._shadow)};Object.defineProperty(t.prototype,"roleState",{get:function(){return this._roleState},set:function(t){this._roleState=t;if(t==role.RoleStateConst.IDLE){this.setRoleAni(avatar.AvatarAnimation.ANI_ENUMS.IDLE,this.vo.dir)}else if(t==role.RoleStateConst.DIE){this.setRoleAni(avatar.AvatarAnimation.ANI_ENUMS.DIE,this.vo.dir)}},enumerable:true,configurable:true});t.prototype.onAniLoaded=function(){this.hitArea=this.avatar.hitArea};t.prototype.playDieWithAni=function(t){this.aniEnd=t;this.avatar.on(Laya.Event.COMPLETE,this,this.onCollectAniCollectComplete);this.setRoleAni(avatar.AvatarAnimation.ANI_ENUMS.DIE,this.vo.dir,true)};t.prototype.onCollectAniCollectComplete=function(){if(this.aniEnd){this.aniEnd.run()}guardisland.GuardIslandsModel.getIns().succeedWindow()};Object.defineProperty(t.prototype,"npcType",{get:function(){var t=this.vo.getCfg();var e=parseInt(t.npctype);return e},enumerable:true,configurable:true});t.prototype.onClick=function(t){if(t){t.stopPropagation()}this.setClickView(csv.MapProxy.getIns().getClickUrl());role.LeadingRoleView.getIns().aiRoleCollect(this.vo)};return t}(i.SceneItemView);i.CollectView=t})(scene||(scene={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(n){var t=function(i){__extends(t,i);function t(t){var e=i.call(this)||this;e.posArr=[];e.vo=t;e.hpBar=new n.HeadHpView;e.hpBar.anchorX=.5;e.hpBar.visible=t.boShowHp;e.lblName=new Laya.Label;e.lblName.autoSize=true;e.lblName.fontSize=20;e.lblName.color="#dadada";e.lblName.bold=true;e.lblName.anchorX=.5;e.lblName.stroke=2;e.lblName.strokeColor="#203c56";if(battle.BattleConst.BATTLE_TYPE.GUAJI==battle.BattleModel.getIns().battleType){e.lblName.text=csv.MonsterProxy.getMonsterLvName(e.vo.getCfg())}else{e.lblName.text=csv.MonsterProxy.getMonsterName(e.vo.getCfg())}e.posArr.push(e.lblName);return e}t.prototype.initialize=function(){i.prototype.initialize.call(this);this.autoSize=true;this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};t.prototype.updatePos=function(){var t=0;for(var e=0,i=this.posArr.length;e<i;++e){var n=this.posArr[e];if(n.visible){n.y=t-n.height-5;t=n.y}}};t.prototype.onDisplay=function(){this.visible=true;this.addChild(this.hpBar);this.addChild(this.lblName);this.updateName();this.initHpMp();this.callLater(this.updatePos)};t.prototype.onUnDisplay=function(){this.hpBar.removeSelf();this.lblName.removeSelf()};t.prototype.initHpMp=function(){this.hpBar.visible=true;var t;if(this.vo.maxhp==0){t=1}else{t=this.vo.hp/this.vo.maxhp}this.hpBar.initHp(t,this.vo.boShowHp);this.hpBar.mpbar.visible=true;var e;if(this.vo.maxmp==0){e=0}else{e=this.vo.mp/this.vo.maxmp}this.hpBar.initMp(e,this.vo.boShowMp)};t.prototype.updataHp=function(){var t;if(this.vo.maxhp==0){t=1}else{t=this.vo.hp/this.vo.maxhp}this.hpBar.setHpValue(t)};t.prototype.updataMp=function(){var t;if(this.vo.maxmp==0){t=0}else{t=this.vo.mp/this.vo.maxmp}this.hpBar.setMpValue(t)};t.prototype.updateName=function(){if(this.vo.monsterType==n.MonsterVO.ENUM_MONSTER_TYPE.FUBEN_MON){this.lblName.visible=true}else{this.lblName.visible=false}this.updatePos()};t.prototype.setNameVisible=function(t){this.lblName.visible=t;this.updatePos()};t.prototype.clearAll=function(){this.hpBar.clearAll()};return t}(Laya.Component);n.DebugMonsterHeadView=t})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(r){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t._time=0;return t}t.prototype.init=function(t){this.boLink=true;e.prototype.init.call(this,t);this.initGuard()};Object.defineProperty(t.prototype,"guardPetVO",{get:function(){return this.vo},enumerable:true,configurable:true});t.prototype.setObscured=function(t){this.avatar.alpha=t?.6:1};t.prototype.initGuard=function(){var t=this.guardPetVO.flower;var e=Math.PI+(1-t.vo.dir)*Math.PI/4;var i=new isometric.Point3D(t.vo.posX*32,0,t.vo.posY*32);var n=isometric.IsoUtils.isoToScreen(i);var a=n.x+Math.cos(e)*this.guardPetVO.stopDis;var o=n.y+Math.sin(e)*this.guardPetVO.stopDis;var s=isometric.IsoUtils.screenToIso(new Laya.Point(a,o));this.vo.posX=Math.round(s.x/32);this.vo.posY=Math.round(s.z/32);this.vo.dir=Math.floor(Math.random()*8);this.avatar=new avatar.AvatarAnimation;this.avatar.canstop=true;this.avatar.setAniData(this.vo);this.avatar.play();this.roleState=r.RoleStateConst.IDLE;this._shadow=new Laya.Image("res/assist/circle.png");this._shadow.anchorX=this._shadow.anchorY=.5;this._shadow.noGlobal=true;this.isoDisplay.addChild(this.avatar);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};t.prototype.onDisplay=function(){util.SpriteLinkUtil.addLinkChild(this,this._shadow,scene.SceneMediator.getInstance().isoWorld.shadowLayer)};t.prototype.onUnDisplay=function(){util.SpriteLinkUtil.removeLinkChild(this,this._shadow)};t.prototype.updateFrame=function(t){this._time+=t;if(this._time>200){var e=this.checkIfNeedMove();if(e){var i=this.guardPetVO.flower;var n=game.SceneModel.getPosByTowPos(i.vo.posX,i.vo.posY,this.vo.posX,this.vo.posY,this.guardPetVO.stopDis);var a=game.SceneModel.getDirByTowPos(this.vo.posX,this.vo.posY,i.vo.posX,i.vo.posY);this.vo.dir=a;if(n.x==this.vo.posX&&n.y==this.vo.posY){}else{this.move(n.x,n.y)}}this._time=0}if(this._moveAction){if(this._moveAction.isCompleted()){this.stopMove(false);return}this._moveAction.onFrame(t)}};t.prototype.checkIfNeedMove=function(){var t=false;var e=this.guardPetVO.flower;if(e){var i=game.SceneModel.getDisByTowPos(e.vo.posX,e.vo.posY,this.vo.posX,this.vo.posY);if(i>this.guardPetVO.startDis){t=true}}return t};Object.defineProperty(t.prototype,"roleState",{get:function(){return this._roleState},set:function(t){this._roleState=t;if(t==r.RoleStateConst.IDLE){this.setRoleAni(avatar.AvatarAnimation.ANI_ENUMS.IDLE,this.vo.dir)}else if(t==r.RoleStateConst.MOVE){this.setRoleAni(avatar.AvatarAnimation.ANI_ENUMS.RUN,this.vo.dir)}},enumerable:true,configurable:true});t.prototype.onMoveStart=function(){};t.prototype.onMoveEnd=function(t){};t.prototype.setRoleAni=function(t,e,i){if(i===void 0){i=false}this.avatar.setAni(t,e,i)};t.prototype.setMoveAction=function(t,e){if(this._moveAction){this._moveAction.cancel(e)}this._moveAction=t;this.roleState=r.RoleStateConst.MOVE};t.prototype.move=function(t,e){var i=new r.FlowerPosMoveAction;i.char=this;i.target=isometric.IsoUtils.isoToScreen(new isometric.Point3D(t*32,0,e*32));i.speed=this.guardPetVO.speed;this.setMoveAction(i)};t.prototype.stopMove=function(t){this.setMoveAction(null);this.onMoveEnd(t);this.roleState=r.RoleStateConst.IDLE};t.prototype.clearAll=function(){this.roleState=r.RoleStateConst.IDLE;this.avatar.setAniData(this.vo)};return t}(scene.SceneItemView);r.GuardPetView=t})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(n){var t=function(e){__extends(i,e);function i(){var t=e!==null&&e.apply(this,arguments)||this;t.boShowHp=true;t.boShowMp=true;return t}i.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.liangbg.visible=false;this.checkMpHandler=new Laya.Handler(this,this.checkShine)};i.prototype.onDisplay=function(){this.callLater(this.refreshAll)};i.prototype.onUnDisplay=function(){};i.prototype.refreshAll=function(){};i.prototype.initHp=function(t,e){this.hpbar.visible=this.boShowHp=e;if(isNaN(t)){this.hpbar.value=1}else{this.hpbar.value=t}};i.prototype.initMp=function(t,e){this.mpbar.visible=this.boShowMp=e;this.stopShine();if(e){if(isNaN(t)){this.mpbar.value=1}else{this.mpbar.value=t}if(this.mpbar.value==1){this.playShine()}}};i.prototype.initSp=function(t){if(!this.spBar){this.spBar=n.QiwaExpBar.getIns();this.spBar.x=-this.spBar.width;this.spBar.y=(this.height-this.spBar.height)/2;this.addChild(this.spBar)}this.spBar.lastValue=0;this.spBar.visible=this.boShowMp;if(this.boShowMp){this.spBar.value=t}};i.prototype.setHpValue=function(t){if(this.boShowHp){Laya.timer.once(i.HP_DELAY/app.TimerRewriter.battleScale,this,this.delayHpValue,[t],false)}};i.prototype.delayHpValue=function(t){app.MyTween.to(this.hpbar,{value:t},i.HP_DURATION/app.TimerRewriter.battleScale)};i.prototype.setMpValue=function(t){if(this.boShowMp){if(t>this.mpbar.value){app.MyTween.to(this.mpbar,{value:t},i.HP_DURATION/app.TimerRewriter.battleScale,null,this.checkMpHandler,i.HP_DELAY)}else{this.stopShine();this.mpbar.value=t}}};i.prototype.checkShine=function(){if(this.mpbar.value>=1){this.playShine()}else{this.stopShine()}};i.prototype.playShine=function(){this.liangbg.visible=true;Laya.timer.loop1(400/app.TimerRewriter.battleScale,this,this.loopShine)};i.prototype.stopShine=function(){this.liangbg.visible=false;Laya.timer.clear(this,this.loopShine)};i.prototype.loopShine=function(){this.liangbg.visible=!this.liangbg.visible};i.prototype.setSpValue=function(t){if(this.spBar&&this.boShowMp){if(t>this.spBar.value){app.MyTween.to(this.spBar,{value:t},i.HP_DURATION/app.TimerRewriter.battleScale,null,null,i.HP_DELAY/app.TimerRewriter.battleScale)}else{this.spBar.value=t}}};i.prototype.clearAll=function(){app.MyTween.clearAll(this.hpbar);app.MyTween.clearAll(this.mpbar);app.MyTween.clearAll(this.spBar);Laya.timer.clearAll(this)};i.HP_TIME=500;i.HP_DELAY=300;i.HP_DURATION=200;return i}(ui.common.toudingxuetiaoUI);n.HeadHpView=t})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(u){var t=function(i){__extends(e,i);function e(){var t=i!==null&&i.apply(this,arguments)||this;t._isBeginingCollect=false;return t}e.getIns=function(){if(!game.Context.mainRole){throw new Error("ROLE HAS NOT INITED")}if(!e._instance){var t=new e;t.init(game.Context.mainRole);e._instance=t}return e._instance};Object.defineProperty(e.prototype,"isBeginingCollect",{get:function(){return this._isBeginingCollect},set:function(t){if(t){}else{this.hideProgressBar();this.gatherVo=null}this._isBeginingCollect=t},enumerable:true,configurable:true});e.prototype.cancelCollect=function(t){if(t===void 0){t=true}this.hideProgressBar();if(this.gatherVo){if(t){var e=app.getLang("shoufuisland_txt_42");manager.FlowManager.instance.flowByStyle1(e)}}app.ProtocolRequest.StopGatherReq();this.gatherVo=null};e.prototype.endRequest=function(){this.hideProgressBar();if(this.gatherVo&&guardisland.GuardIslandsModel.getIns().isCollecting(this.gatherVo.gatherID)){guardisland.GuardIslandsModel.getIns().once(guardisland.GuardIslandsModel.EVENT_GATHER_END,this,this.collectEndCallBack);app.ProtocolRequest.EndGatherReq(this.gatherVo.gatherID)}this.gatherVo=null};e.prototype.startCollect=function(t){this.gatherVo=t;this.showProgressBar(u.ProgressBarView.ENUM_TYPE.CAI_JI,this.gatherVo.endTime,Laya.Handler.create(this,this.endRequest))};e.prototype.collectEndCallBack=function(t){this.isBeginingCollect=false;guardisland.GuardIslandsModel.getIns().startCold()};e.prototype.initRole=function(){i.prototype.initRole.call(this);this.ai=new game.AiController(this);this.aiState=e.AI_STATE.IDLE;this._npcTalkAI=new ai.NpcTalkAI(this);this._moveAI=new ai.MoveAI(this);this._bossBattleAI=new ai.BossBattleAI(this);this._autoFightAI=new ai.BattleAI(this);this._actMoveAi=new ai.ActivityMoveAI(this);this._roleBattleAI=new ai.RoleBattleAI(this);this._roleCollectAI=new ai.RoleCollectAI(this);this._trapMachineAI=new ai.TrapMachineAI(this)};e.prototype.onDisplay=function(){i.prototype.onDisplay.call(this);this.updataBubble();dailytask.BubbleModel.getIns().on(dailytask.BubbleModel.BUBBLE_OPEN_CHANGE,this,this.updataBubble);title.TitleModel.getIns().on(title.TitleEvent.TITLE_EQUIP_INFO_UPDATE,this,this.updateTitle);title.TitleModel.getIns().on(title.TitleEvent.TITLE_HEAD_UPDATE,this,this.updateHeadTitle);this.manager.on(battle.BattleManager.MAP_LOAD_END,this,this.awakeAI);this.disPlayedHandler&&this.disPlayedHandler.run()};e.prototype.onUnDisplay=function(){i.prototype.onUnDisplay.call(this);this.isBeginingCollect=false;dailytask.BubbleModel.getIns().off(dailytask.BubbleModel.BUBBLE_OPEN_CHANGE,this,this.updataBubble);title.TitleModel.getIns().off(title.TitleEvent.TITLE_EQUIP_INFO_UPDATE,this,this.updateTitle);title.TitleModel.getIns().off(title.TitleEvent.TITLE_HEAD_UPDATE,this,this.updateHeadTitle);this.manager.off(battle.BattleManager.MAP_LOAD_END,this,this.awakeAI);this.sleepAI()};e.prototype.onVisibleChange=function(){if(!Laya.stage.isVisibility){if(this instanceof e&&csv.MapProxy.getIns().isNeedPosResponse(game.Context.mainRole.mapId)){u.LeadingRoleView.getIns().sleepAI();this.stopMove()}}else{u.LeadingRoleView.getIns().awakeAI()}};e.prototype.updateFrame=function(t){i.prototype.updateFrame.call(this,t);var e=this.ai.getAction();if(e){e.updateFrame(t)}};e.prototype.move=function(t,e,i){if(game.Context.getMapType()==csv.MapProxy.MAP_TYPE.DUJIE_OUT){if(copy.CopyModel.getIns().boCopyMove){copy.CopyModel.getIns().doMove(t,e)}}else{if(!this.sceneMediator.checkCanMove(t,e)){var n=Math.atan2(this.vo.posY-e,this.vo.posX-t);var a=game.SceneModel.getDisByTowPoint(this.vo.posX-t,this.vo.posX-e,t,e);for(var o=1;o<=a;o++){var s=Math.round(t+o*Math.cos(n));var r=Math.round(e+o*Math.sin(n));if(this.sceneMediator.checkCanMove(s,r)){u.LeadingRoleView.getIns().move(s,r);break}}}var l=void 0;var h=void 0;l=Math.floor(this.isoPosX/32);h=Math.floor(this.isoPosZ/32);var p=this.sceneMediator.findPath(l,h,t,e);this.movePath(p,i)}};e.prototype.onMoveEnd=function(t){if(!t){if(game.Context.getMapType()!=csv.MapProxy.MAP_TYPE.DUJIE_OUT){var e=csv.MapProxy.getIns().isNeedPosResponse(game.Context.mainRole.mapId);if(e){this._npcTalkAI.autoCloseTalkView();app.ProtocolRequest.StopMove(this.vo.posX,this.vo.posY,this.vo.dir);game.Context.event(game.ContextEvent.LEAD_ROLE_MOVE_END)}}}if(this.isAIAwake()){this.sleepAI()}};e.prototype.aiTalk=function(t,e,i,n){if(!this.displayedInStage){this.disPlayedHandler=Laya.Handler.create(this,this.aiTalk,[t,e,i,n]);return}this.disPlayedHandler=null;if(this.ai.isAwake()&&this._npcTalkAI.checkIsSame(t,e,i,n)){return}this.awakeAI();this.ai.doAction(this._npcTalkAI.setTarget(t,e,i,n))};e.prototype.aiMove=function(t,e,i){this.ai.doAction(this._moveAI.setData(t,e,i))};e.prototype.aiBossBattle=function(t){this.awakeAI();this.ai.doAction(this._bossBattleAI.setData(t))};e.prototype.aiRoleBattle=function(t){this.awakeAI();this.ai.doAction(this._roleBattleAI.setData(t))};e.prototype.aiRoleCollect=function(t){this.awakeAI();this.ai.doAction(this._roleCollectAI.setData(t))};e.prototype.aiTrapMachine=function(t,e){this.awakeAI();this.ai.doAction(this._trapMachineAI.setData(t,e))};e.prototype.aiActMove=function(t){this.awakeAI();this.ai.doAction(this._actMoveAi.setData(t))};e.prototype.getAIState=function(){if(!this.ai){return this.exAiState?this.exAiState:u.LeadingRoleView.AI_STATE.IDLE}return this.ai.getState()};e.prototype.cancelAI=function(t){this.ai.cancel(t)};e.prototype.sleepAI=function(){this.ai.sleep()};e.prototype.isAIAwake=function(){return this.ai.isAwake()};e.prototype.awakeAI=function(){this.ai.awake()};e.prototype.completeAI=function(){this.ai.complete()};e.prototype.nextAI=function(){this.ai.next()};e.prototype.setRoleMountAni=function(){this.avatar.setAni(this.avatar.aniName,this.vo.dir,true)};e.AI_STATE={MOVE:"move",BOSS_BATTLE:"boss_battle",IDLE:"idle",TALK:"talk",TALKING:"talking",BATTLE:"battle",AUTO_TASK:"auto_task",AUTO_COLLECT:"auto_collect",ROLE_BATTLE:"ROLE_BATTLE",ROLE_COLLECT:"ROLE_COLLECT",TRAP_CLICK:"TRAP_CLICK"};return e}(u.RoleView);u.LeadingRoleView=t})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(n){var t=function(i){__extends(t,i);function t(t){var e=i.call(this)||this;e.posArr=[];e.vo=t;e.state=0;e.hpBar=new n.HeadHpView;e.hpBar.anchorX=.5;e.hpBar.visible=t.boShowHp;e.posArr.push(e.hpBar);e.lblName=new Laya.Label;e.lblName.autoSize=true;e.lblName.fontSize=20;e.lblName.color="#dadada";e.lblName.bold=true;e.lblName.anchorX=.5;e.lblName.stroke=2;e.lblName.strokeColor="#203c56";if(battle.BattleConst.BATTLE_TYPE.GUAJI==battle.BattleModel.getIns().battleType){e.lblName.text=csv.MonsterProxy.getMonsterLvName(e.vo.getCfg())}else{e.lblName.text=csv.MonsterProxy.getMonsterName(e.vo.getCfg())}e.posArr.push(e.lblName);e.icon=new Laya.Image;e.icon.anchorY=.5;e.icon.width=e.icon.height=29;e.posArr.push(e.icon);if(t.getCfg().montype==2){e.icon.skin="public/bg_guaiwubiaoshi_boss.png"}else if(t.getCfg().montype==4){e.icon.skin="public/bg_guaiwubiaoshi_jingying.png"}else{e.icon.skin=""}return e}t.prototype.initialize=function(){i.prototype.initialize.call(this);this.autoSize=true;this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};t.prototype.updatePos=function(){var t=0;if(this.state==1){util.SpriteLinkUtil.removeLinkChild(this,this.hpBar);util.SpriteLinkUtil.removeLinkChild(this,this.icon);util.SpriteLinkUtil.removeLinkChild(this,this.lblName);for(var e=0,i=this.posArr.length;e<i;++e){var n=this.posArr[e];this.addChild(n);if(this.icon===n){this.icon.x=this.lblName.x-this.lblName.textField.width/2-29;this.icon.y=this.lblName.y+this.lblName.textField.height/2}else{if(n.visible){n.y=t-n.height-5;t=n.y;n.x=0}}}}else{for(var e=0,i=this.posArr.length;e<i;++e){var n=this.posArr[e];if(n.visible){if(this.icon===n){this.icon.linkOffX=this.lblName.linkOffX-this.lblName.textField.width/2-29;this.icon.linkOffY=this.lblName.linkOffY+this.lblName.textField.height/2}else{n.linkOffY=t-n.height-5;t=n.linkOffY}}}}};t.prototype.onDisplay=function(){this.visible=true;util.SpriteLinkUtil.addLinkChild(this,this.hpBar,scene.SceneMediator.getInstance().isoWorld.hpLayer,0,0,true);util.SpriteLinkUtil.addLinkChild(this,this.icon,scene.SceneMediator.getInstance().isoWorld.hpLayer,0,0,true);util.SpriteLinkUtil.addLinkChild(this,this.lblName,scene.SceneMediator.getInstance().isoWorld.nameLayer,0,0,true);this.updateName();this.initHpMp();this.callLater(this.updatePos)};t.prototype.onUnDisplay=function(){util.SpriteLinkUtil.removeLinkChild(this,this.hpBar);util.SpriteLinkUtil.removeLinkChild(this,this.icon);util.SpriteLinkUtil.removeLinkChild(this,this.lblName)};t.prototype.changeState=function(t){this.state=t;this.callLater(this.updatePos)};t.prototype.initHpMp=function(){this.hpBar.visible=true;var t;if(this.vo.maxhp==0){t=1}else{t=this.vo.hp/this.vo.maxhp}this.hpBar.initHp(t,this.vo.boShowHp);this.hpBar.mpbar.visible=true;var e;if(this.vo.maxmp==0){e=0}else{e=this.vo.mp/this.vo.maxmp}this.hpBar.initMp(e,this.vo.boShowMp)};t.prototype.updataHp=function(){var t;if(this.vo.maxhp==0){t=1}else{t=this.vo.hp/this.vo.maxhp}this.hpBar.setHpValue(t)};t.prototype.updataMp=function(){var t;if(this.vo.maxmp==0){t=0}else{t=this.vo.mp/this.vo.maxmp}this.hpBar.setMpValue(t)};t.prototype.updateName=function(){if(this.vo.monsterType==n.MonsterVO.ENUM_MONSTER_TYPE.FUBEN_MON){this.icon.visible=this.lblName.visible=true}else{this.icon.visible=this.lblName.visible=false}this.updatePos()};t.prototype.setNameVisible=function(t){this.lblName.visible=t;this.updatePos()};t.prototype.clearAll=function(){this.hpBar.clearAll()};return t}(Laya.Component);n.MonsterHeadView=t})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(u){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t._hitTime=0;t._hitCd=2e3;t.filter=new Laya.ColorFilter(game.STYLES.WHITE_MATRIX);t.hitAreaWidth=190;t.hitAreaHeight=185;t.hitOffX=0;return t}Object.defineProperty(t.prototype,"roleVO",{get:function(){return this.vo},enumerable:true,configurable:true});t.prototype.initRole=function(){e.prototype.initRole.call(this);var t=this.vo;if(gm.GmMonView.isDebug){this.headView=new u.DebugMonsterHeadView(t)}else{this.headView=new u.MonsterHeadView(t)}this.headView.y=-t.getModelHeight();this.addChild(this.headView);this.isoDisplay.scale(t.scaleNum,t.scaleNum)};t.prototype.resetHeadView=function(t){this.headView.y=-t};t.prototype.setRedHeadName=function(t){if(t){this.headView.lblName.color=game.STYLES.RED_COLOR}else{this.headView.lblName.color=game.STYLES.DESC_TXT_COLOR}};t.prototype.onDisplay=function(){e.prototype.onDisplay.call(this);battle.BattleModel.getIns().on(battle.BattleModel.SHIELD_CHANGE,this,this.onAllShieldChange);game.SystemSetModel.getInstance().on(game.SystemSetModel.EVENTS.SKILL_SWITCH_CHANGE,this,this.onSkillShieldChange)};t.prototype.onUnDisplay=function(){e.prototype.onUnDisplay.call(this);battle.BattleModel.getIns().off(battle.BattleModel.SHIELD_CHANGE,this,this.onAllShieldChange);game.SystemSetModel.getInstance().off(game.SystemSetModel.EVENTS.SKILL_SWITCH_CHANGE,this,this.onSkillShieldChange);Laya.timer.clear(this,this.randomMove)};t.prototype.onAllShieldChange=function(){this.setShield()};t.prototype.setShield=function(){this.charactorVO.boSkillShield=u.MonsterVO.getSkillShield(this.charactorVO);this.setBuffEffs()};t.prototype.onSkillShieldChange=function(){this.charactorVO.boSkillShield=u.MonsterVO.getSkillShield(this.charactorVO);this.setBuffEffs()};t.prototype.onVisibleChange=function(){if(Laya.stage.isVisibility&&!this.roleVO.ignoreBattleId&&this.roleVO.battleid!=battle.BattleModel.getIns().battleid){scene.SceneMediator.getInstance().removeSceneItem(this.vo.insId)}};t.prototype.attack=function(){if(this.attackArr.length>0){var t=this.attackArr[0];if(this.roleVO.movetype==0){var e=this.attackArr[0];if(battle.BattleModel.attackType==0){this.checkIfBehind(e)}if(this.roleState!=u.RoleStateConst.IDLE){return}if(e.type==1&&battle.BattleModel.attackType==0&&!e.walkEnd){if(this.checkIfWalk(e)){return}}}else{if(this.roleState!=u.RoleStateConst.IDLE){return}}if(t.step!=this.manager.battleStep){return}this.currAttack=this.attackArr.shift();if(this.currAttack.type==1){if(!this.currAttack.targetView||this.currAttack.targetView.roleState==u.RoleStateConst.DIE){this.setSKillHurt(this.currAttack);this.attack();return}if(!this.roleVO.boModelShield){this.calculateAttackTime();this.playSkill();if(t.otherAttackVo.length){for(var i=0,n=t.otherAttackVo.length;i<n;i++){var a=t.otherAttackVo[i];if(!this.charactorVO.boSkillShield&&a.showSkill){a.attackView.showSkillName(a)}}}}else{this.setSKillHurt(this.currAttack);this.attack()}}else if(t.type==2){if(!this.roleVO.boModelShield&&!this.charactorVO.boSkillShield&&t.showSkill){this.showSkillName(t)}else{this.setSKillHurt(t)}this.attack()}else{this.setSKillHurt(this.currAttack);this.attack()}}};t.prototype.calculateAttackTime=function(){var t=avatar.AvatarAnimation.DEF_INTERVAL;var e=battle.BattleModel.getIns().attackSpace/this.roleVO.attackSpeed;if(e<battle.BattleModel.getIns().minAttackSpace){e=battle.BattleModel.getIns().minAttackSpace}t=Math.floor(e/7);if(t>avatar.AvatarAnimation.DEF_INTERVAL){t=avatar.AvatarAnimation.DEF_INTERVAL}this.avatar.interval=t/app.TimerRewriter.battleScale};t.prototype.beHurt=function(t,e){var i=this;if(e===void 0){e=0}if(!this.roleVO.boHurtShield&&e){if(this.roleVO.hittype==0&&this.roleVO.getCfg().montype!=csv.MonsterProxy.MON_TYPE.STUPID){if(this.roleState!=u.RoleStateConst.MOVE&&app.TimerRewriter.currTimer-this._hitTime>this._hitCd){this._hitCd*=2;this._hitTime=app.TimerRewriter.currTimer;var n=Math.PI+(1-this.vo.dir)*Math.PI/4;var a=this.x;var o=this.y;var s=a+Math.cos(n)*32;var r=o+Math.sin(n)*32;var l=isometric.IsoUtils.screenToIso(new Laya.Point(s,r));var h=Math.round(l.x/32);var p=Math.round(l.z/32);if(!scene.SceneMediator.getInstance().checkStandUsed(this,h,p)){if(scene.SceneMediator.getInstance().checkCanMove(h,p)){app.MyTween.to(this,{x:s,y:r},50,null,Laya.Handler.create(this,function(){i.isoPos=l}));this.vo.posX=h;this.vo.posY=p;scene.SceneMediator.getInstance().setStandPos(this.vo.insId,h,p)}}}}if(!this.avatar.filters||this.avatar.filters.length==0){this.createFilter()}}};t.prototype.createFilter=function(){this.avatar.filters=[this.filter];Laya.timer.once1(200,this,this.clearFilter)};t.prototype.clearFilter=function(){this.avatar.filters=[]};t.prototype.updataHp=function(t){this.roleVO.hp=t.hp.toNumber();this.roleVO.maxhp=t.maxhp.toNumber();if(battle.HurtView.checkType(t.effectType,battle.HurtView.EFFECT_ENUM.RE_BIRTH)){this.rebirth()}if(this.roleVO.monsterType==u.MonsterVO.ENUM_MONSTER_TYPE.GUAJI_BOSS){battle.GuajiBossHpView.getIns().setBossHp(this.roleVO.hp)}else if(this.roleVO.monsterType==u.MonsterVO.ENUM_MONSTER_TYPE.REPORT_BOSS){battle.BossHpView.getIns().setBossHp(this.roleVO.hp)}else{this.headView.updataHp()}if(this.roleVO.hp<=0){this.die()}};t.prototype.updataMp=function(t){if(!this.roleVO.boShowMp){return}this.roleVO.mp=t.mp.toNumber();this.roleVO.maxmp=t.maxmp.toNumber();this.headView.updataMp()};t.prototype.die=function(){if(this.roleState==u.RoleStateConst.DIE){return}e.prototype.die.call(this);if(this.roleVO.monsterType==u.MonsterVO.ENUM_MONSTER_TYPE.GUAJI_BOSS){battle.GuajiBossHpView.getIns().setBossHp(0)}};t.prototype.runAway=function(){app.MyTween.to(this,{alpha:0},500,Laya.Ease.linearNone,Laya.Handler.create(this,this.onRemoveTarget),500,true)};t.prototype.directDie=function(){this._moveAction=null;this.avatar.interval=avatar.AvatarAnimation.DEF_INTERVAL;this.roleState=u.RoleStateConst.DIE;this.clearAllBuff();this.setRoleAni(avatar.AvatarAnimation.ANI_ENUMS.IDLE,this.vo.dir);this.avatar.off(Laya.Event.COMPLETE,this,this.onSkillAniComplete);this.removeClickView();this.onDieEnd()};t.prototype.onDieEnd=function(){e.prototype.onDieEnd.call(this);battle.BattleModel.getIns().countDieMonster(this);app.MyTween.to(this,{alpha:.2},500,Laya.Ease.linearNone,Laya.Handler.create(this,this.onRemoveTarget),500,true)};t.prototype.onRemoveTarget=function(){scene.SceneMediator.getInstance().removeSceneItem(this.vo.insId)};t.prototype.showInStage=function(){this.alpha=0;app.MyTween.to(this,{alpha:1},500)};t.prototype.startRandomMove=function(){Laya.timer.loop(1e3,this,this.randomMove)};t.prototype.stopRandomMove=function(){Laya.timer.clear(this,this.randomMove)};t.prototype.randomMove=function(){if(this.roleVO.getCfg().montype==csv.MonsterProxy.MON_TYPE.STUPID){return}if(Math.random()>.5){return}var t=Math.random()*2*Math.PI;var e=this.x+Math.cos(t)*64;var i=this.y+Math.sin(t)*64;var n=new Laya.Point(e,i);var a=isometric.IsoUtils.screenToIso(n);var o=Math.round(a.x/32);var s=Math.round(a.z/32);if(scene.SceneMediator.getInstance().checkStandUsed(this,o,s)){var r=scene.SceneMediator.getInstance().getNextStand(this,o,s);if(r){this.move(r.x,r.y)}}else{if(scene.SceneMediator.getInstance().checkCanMove(o,s)){this.move(o,s)}}};t.prototype.setClickView=function(t){e.prototype.setClickView.call(this,t);if(this.roleVO.monsterType==u.MonsterVO.ENUM_MONSTER_TYPE.NORMAL){this.headView.setNameVisible(true)}};t.prototype.removeClickView=function(){e.prototype.removeClickView.call(this);if(this.roleVO.monsterType==u.MonsterVO.ENUM_MONSTER_TYPE.NORMAL){this.headView.setNameVisible(false)}};t.prototype.onAniLoaded=function(){if(gm.GmMonView.isDebug){if(!this.avatar){return}this.hitArea=this.avatar.hitArea;this.graphics.clear();this.graphics.drawRect(this.hitArea.x,this.hitArea.y,this.hitArea.width,this.hitArea.height,"#63a3ec");this.graphics.drawRect(this.hitArea.x+this.hitArea.width/2-this.hitAreaWidth/2+this.hitOffX,this.hitArea.y+this.hitArea.height/2-this.hitAreaHeight/2,this.hitAreaWidth,this.hitAreaHeight,"#f61f1f")}};t.prototype.setHitViewWidth=function(t){this.hitAreaWidth=t};t.prototype.setHitViewHeight=function(t){this.hitAreaHeight=t};t.prototype.setHitViewOffX=function(t){this.hitOffX=t};t.prototype.drawHitView=function(){this.onAniLoaded()};t.SINGLE_KEY="role.MonsterView";return t}(u.CharactorView);u.MonsterView=t})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initRole=function(){t.prototype.initRole.call(this);this.on(Laya.Event.CLICK,this,this.onClick);this.moveEndCheck=new Laya.Handler(this,this.onMoveEndCheck)};e.prototype.onDisplay=function(){t.prototype.onDisplay.call(this);this.checkIfCanClick();game.SystemSetModel.getInstance().on(game.SystemSetModel.EVENTS.OTHERPLAYER_SWITCH_CHANGE,this,this.setShield);this.updataBubble();dailytask.BubbleModel.getIns().on(dailytask.BubbleModel.BUBBLE_OPEN_CHANGE,this,this.updataBubble)};e.prototype.onUnDisplay=function(){t.prototype.onUnDisplay.call(this);game.Context.off(game.ContextEvent.MAP_LOAD_COMPLETE,this,this.onMapComplete);game.SystemSetModel.getInstance().off(game.SystemSetModel.EVENTS.OTHERPLAYER_SWITCH_CHANGE,this,this.setShield);dailytask.BubbleModel.getIns().off(dailytask.BubbleModel.BUBBLE_OPEN_CHANGE,this,this.updataBubble)};e.prototype.setShield=function(){this.roleVO.boModelShield=i.PlayerRoleVO.getModelShield(this.roleVO);this.isoDisplay.visible=!this.roleVO.boModelShield;this.headView.hpBar.visible=!this.roleVO.boModelShield;this.setShadowVisible(!this.roleVO.boModelShield);if(this.roleVO.boModelShield){this.removeGuardPet()}else{this.updataGuardPet()}};e.prototype.onClick=function(t){t.stopPropagation();var e=csv.MapProxy.getIns().getMapType(game.Context.mainRole.mapId);this.setClickView(csv.MapProxy.getIns().getClickUrl());switch(e){case csv.MapProxy.MAP_TYPE.HULU_DAO:if(t){guardisland.GuardIslandsModel.getIns().stopAutoFight()}this.showChankanMenu();break;case csv.MapProxy.MAP_TYPE.KUAFU_BOSS_OUT:case csv.MapProxy.MAP_TYPE.WORLD_BOSS_OUT:case csv.MapProxy.MAP_TYPE.WORLD_BOSS_ICE:i.LeadingRoleView.getIns().aiRoleBattle(this);break;default:this.showChankanMenu()}};e.prototype.showChankanMenu=function(){var t=friend.FriendModel.getCommonTypeArr(this.roleVO.insId);friend.FriendModel.getIns().setFriendMenu(t,this.roleVO.insId,this.roleVO.playername,this.roleVO.level,this.roleVO.prof,this.roleVO.headframeId)};e.prototype.checkIfCanClick=function(){var t=true;var e=csv.NpcProxy.getIns().getMapNpcList(game.Context.mainRole.mapId);for(var i=0,n=e.length;i<n;i++){var a=e[i];if(this.vo.posX>=a.posX-2&&this.vo.posX<=a.posX+2&&this.vo.posY>=a.posY-2&&this.vo.posY<=a.posY+2){t=false}}return t};e.prototype.tryWalk=function(){if(!scene.SceneMediator.getInstance().isLoading){this.move(this.walkPosX,this.walkPosY,this.moveEndCheck)}else{game.Context.on(game.ContextEvent.MAP_LOAD_COMPLETE,this,this.onMapComplete)}};e.prototype.onMapComplete=function(){game.Context.off(game.ContextEvent.MAP_LOAD_COMPLETE,this,this.onMapComplete);this.tryWalk()};e.prototype.onMoveEndCheck=function(){this.mouseEnabled=this.checkIfCanClick();this.mouseThrough=!this.checkIfCanClick();this.walkPosX=null;this.walkPosY=null;dailytask.BubbleModel.getIns().checkIfBubble()};e.prototype.setBySetting=function(t){if(Uint64.equal(this.vo.insId,game.Context.mainRoleId)){return}this.isoDisplay.visible=!t};return e}(i.RoleView);i.PlayerRoleView=t})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(n){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){Laya.timer.clear(this,this.loopFreshTime);this.endHandler=undefined};e.prototype.refreshAll=function(){};e.prototype.setType=function(t,e,i){this.endHandler=i;this._loopTime=e;switch(t){case n.ProgressBarView.ENUM_TYPE.CHUAN_GONG:this.imgcaijizhong.skin="res/static/word/bg_chuangongzhong.png";break;case n.ProgressBarView.ENUM_TYPE.MO_BAI:this.imgcaijizhong.skin="res/static/word/bg_mobaizhong.png";break;case n.ProgressBarView.ENUM_TYPE.CAI_JI:this.imgcaijizhong.skin="res/static/word/bg_caijizhong.png";break;case n.ProgressBarView.ENUM_TYPE.TRAP_OPEN:this.imgcaijizhong.skin="res/static/word/bg_jiesuozhong.png";break}this._startTime=Laya.timer.currTimer;this.loopFreshTime();Laya.timer.frameLoop(1,this,this.loopFreshTime)};e.prototype.loopFreshTime=function(){var t=Laya.timer.currTimer-this._startTime;if(t<=this._loopTime){var e=t/this._loopTime;this.jindutiao.value=e}else{this.jindutiao.value=1;Laya.timer.clear(this,this.loopFreshTime);if(this.endHandler){this.endHandler.run()}}};e.SINGLE_KEY="role.ProgressBarView";e.ENUM_TYPE={CHUAN_GONG:1,MO_BAI:2,CAI_JI:3,TRAP_OPEN:4};return e}(ui.bosszhandou.shouhuhuludaocaijizhongitemUI);n.ProgressBarView=t})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(t){var e=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.lastValue=0;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.cdMask=new common.CdMask(this.qiwa2,false);this.shanguang.on(Laya.Event.COMPLETE,this,this.boomEnd);this.shanguang.visible=false};Object.defineProperty(t.prototype,"value",{set:function(t){if(t==1&&this.lastValue<1){this.playBoom()}this.lastValue=t;this.cdMask.setProgress(t);this.jindutiao.rotation=360*t},enumerable:true,configurable:true});t.prototype.playBoom=function(){this.shanguang.visible=true;this.shanguang.play(0,false)};t.prototype.boomEnd=function(){this.shanguang.visible=false;this.shanguang.stop()};t.SINGLE_KEY="role.QiwaExpBar";return t}(ui.common.qiwadaojishiUI);t.QiwaExpBar=e})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(n){var t=function(i){__extends(t,i);function t(t){var e=i.call(this)||this;e.boLink=true;e.posArr=[];e.vo=t;e.state=1;e.hpBar=new n.HeadHpView;e.hpBar.anchorX=.5;e.posArr.push(e.hpBar);e.familyLab=new Laya.Label;e.familyLab.fontSize=18;e.familyLab.bold=true;e.familyLab.color="#f1e453";e.familyLab.strokeColor="#203c56";e.familyLab.stroke=2;e.familyLab.anchorX=.5;e.lblName=new Laya.Label;e.lblName.autoSize=true;e.lblName.fontSize=20;if(e.vo.battleCamp==game.Context.battleCamp){e.lblName.color=game.STYLES.DESC_TXT_COLOR;e.hpBar.hpbar.skin="public/progress_hp4.png"}else{e.lblName.color=game.STYLES.RED_COLOR;e.hpBar.hpbar.skin="public/progress_hp3.png"}e.lblName.bold=true;e.lblName.stroke=2;e.lblName.strokeColor="#203c56";e.titleImg=new Laya.Image;e.titleImg.anchorX=.5;e.imgHeadTitle=new Laya.Image;e.headScale=.8;e.imgHeadTitle.scale(e.headScale,e.headScale);e.aniEffect=new game.AniView;e.aniEffect.load("skill_zhandoutubiao01",game.AniView.FILE_NAME.UI);e.aniEffect.visible=false;e.aniEffect.scale(.8,.8);e.titleImg.on(Laya.Event.LOADED,e,e.onImgComplete);e.imgHeadTitle.on(Laya.Event.LOADED,e,e.onImgComplete);e.posArr.push(e.lblName);e.posArr.push(e.familyLab);e.posArr.push(e.titleImg);e.posArr.push(e.imgHeadTitle);return e}t.prototype.initialize=function(){i.prototype.initialize.call(this);this.autoSize=true;this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};t.prototype.updatePos=function(){var t=0;if(this.state==1){util.SpriteLinkUtil.removeLinkChild(this,this.hpBar);util.SpriteLinkUtil.removeLinkChild(this,this.familyLab);util.SpriteLinkUtil.removeLinkChild(this,this.lblName);util.SpriteLinkUtil.removeLinkChild(this,this.titleImg);util.SpriteLinkUtil.removeLinkChild(this,this.imgHeadTitle);util.SpriteLinkUtil.removeLinkChild(this,this.aniEffect);util.SpriteLinkUtil.removeLinkChild(this,this.bubbleEff);for(var e=0,i=this.posArr.length;e<i;++e){var n=this.posArr[e];this.addChild(n);if(n.visible==false||this.imgHeadTitle===n||this.aniEffect===n){}else{n.x=0;if(this.titleImg===n){n.y=t-n.height;t=n.y}else{n.y=t-n.height-5;t=n.y}}}if(this.imgHeadTitle.visible){this.imgHeadTitle.x=-(this.lblName.width+this.imgHeadTitle.width*this.headScale)/2;this.lblName.x=this.imgHeadTitle.x+this.imgHeadTitle.width*this.headScale;this.imgHeadTitle.y=this.lblName.y+this.lblName.height/2-this.imgHeadTitle.height*this.headScale/2;if(this.aniEffect.visible){this.aniEffect.x=this.imgHeadTitle.x-30;this.aniEffect.y=this.imgHeadTitle.y}}else{this.lblName.x=-this.lblName.width/2;if(this.aniEffect.visible){this.aniEffect.x=this.lblName.x-30;this.aniEffect.y=this.lblName.y}}}else{for(var e=0,i=this.posArr.length;e<i;++e){var n=this.posArr[e];if(n.visible==false||this.imgHeadTitle===n||this.aniEffect===n){}else{if(this.titleImg===n){n.linkOffY=t-n.height;t=n.linkOffY}else{n.linkOffY=t-n.height-5;t=n.linkOffY}}}if(this.imgHeadTitle.visible){this.imgHeadTitle.linkOffX=-(this.lblName.width+this.imgHeadTitle.width*this.headScale)/2;this.lblName.linkOffX=this.imgHeadTitle.linkOffX+this.imgHeadTitle.width*this.headScale;this.imgHeadTitle.linkOffY=this.lblName.linkOffY+this.lblName.height/2-this.imgHeadTitle.height*this.headScale/2;if(this.aniEffect.visible){this.aniEffect.linkOffX=this.imgHeadTitle.linkOffX-30;this.aniEffect.linkOffY=this.imgHeadTitle.linkOffY}}else{this.lblName.linkOffX=-this.lblName.width/2;if(this.aniEffect.visible){this.aniEffect.linkOffX=this.lblName.linkOffX-30;this.aniEffect.linkOffY=this.lblName.linkOffY}}}};t.prototype.onDisplay=function(){this.state=0;util.SpriteLinkUtil.addLinkChild(this,this.hpBar,scene.SceneMediator.getInstance().isoWorld.hpLayer);util.SpriteLinkUtil.addLinkChild(this,this.familyLab,scene.SceneMediator.getInstance().isoWorld.nameLayer);util.SpriteLinkUtil.addLinkChild(this,this.lblName,scene.SceneMediator.getInstance().isoWorld.nameLayer);util.SpriteLinkUtil.addLinkChild(this,this.titleImg,scene.SceneMediator.getInstance().isoWorld.headLayer);util.SpriteLinkUtil.addLinkChild(this,this.imgHeadTitle,scene.SceneMediator.getInstance().isoWorld.headLayer);util.SpriteLinkUtil.addLinkChild(this,this.aniEffect,scene.SceneMediator.getInstance().isoWorld.headLayer);this.initHpMp();this.updateName();this.updateTitle();this.updateFamilyName();this.updateHeadTitle();this.updataBattle();this.callLater(this.updatePos)};t.prototype.onUnDisplay=function(){util.SpriteLinkUtil.removeLinkChild(this,this.hpBar);util.SpriteLinkUtil.removeLinkChild(this,this.familyLab);util.SpriteLinkUtil.removeLinkChild(this,this.lblName);util.SpriteLinkUtil.removeLinkChild(this,this.titleImg);util.SpriteLinkUtil.removeLinkChild(this,this.imgHeadTitle);util.SpriteLinkUtil.removeLinkChild(this,this.aniEffect);util.SpriteLinkUtil.removeLinkChild(this,this.bubbleEff)};t.prototype.changeState=function(t){this.state=t;this.callLater(this.updatePos)};t.prototype.onImgComplete=function(){this.callLater(this.updatePos)};t.prototype.initHpMp=function(){var t;if(this.vo.maxhp==0){t=1}else{t=this.vo.hp/this.vo.maxhp}this.hpBar.initHp(t,this.vo.boShowHp);var e;if(this.vo.maxmp==0){e=0}else{e=this.vo.mp/this.vo.maxmp}this.hpBar.initMp(e,this.vo.boShowMp);if(this.vo.maxsp){var i=this.vo.sp/this.vo.maxsp;this.hpBar.initSp(i)}this.callLater(this.updatePos)};t.prototype.updataHp=function(){var t;if(this.vo.maxhp==0){t=1}else{t=this.vo.hp/this.vo.maxhp}this.hpBar.setHpValue(t)};t.prototype.updataMp=function(){var t;if(this.vo.maxmp==0){t=0}else{t=this.vo.mp/this.vo.maxmp}this.hpBar.setMpValue(t)};t.prototype.updataSp=function(){if(this.vo.maxsp){var t=this.vo.sp/this.vo.maxsp;this.hpBar.setSpValue(t)}};t.prototype.refreshView=function(){if(!n.RoleVO.getGmShield(this.vo)){this.updateName();this.updateTitle();this.updateFamilyName();this.updateHeadTitle()}};t.prototype.updateName=function(){var t=this.vo.getModelName();if(t!=""){this.lblName.visible=true;this.lblName.text=t}else{this.lblName.visible=false}this.callLater(this.updatePos)};t.prototype.updateTitle=function(){if(this.vo.boMainRole&&this.vo.usetitle){var t=this.vo.getTitleUrl();if(t[1]){this.titleImg.visible=true;if(!this.titleEff){this.titleEff=new game.AniView;this.titleEff.scale(.8,.8);this.titleEff.y=-20}this.titleImg.skin="";this.titleEff.load(t[0],game.AniView.FILE_NAME.UI);this.titleImg.addChild(this.titleEff);this.titleEff.play()}else{var e=t[0];if(e==""){this.titleImg.visible=false}else{this.titleImg.visible=true;this.titleImg.skin=e}if(this.titleEff){this.titleEff.removeSelf();this.titleEff.stop()}}}else{this.titleImg.visible=false;if(this.titleEff){this.titleEff.removeSelf();this.titleEff.stop()}}this.callLater(this.updatePos)};t.prototype.updateHeadTitle=function(){if(this.vo.headTitle){var t=this.vo.getHeadTitleUrl();if(t==""){this.imgHeadTitle.visible=false}else{this.imgHeadTitle.visible=true;this.imgHeadTitle.skin=t}}else{this.imgHeadTitle.visible=false}this.callLater(this.updatePos)};t.prototype.updateFamilyName=function(){if(this.vo.boMainRole&&this.vo.guildName){this.familyLab.visible=true;if(csv.MapProxy.isInKuaFuMap()){this.familyLab.text=(this.vo.boGuildOwner?app.getLang("[会长]"):"")+this.vo.guildName}else{this.familyLab.text=(this.vo.boGuildOwner?app.getLang("[会长]"):"")+game.Context.getGuildName(this.vo.guildName)}}else{this.familyLab.visible=false}this.callLater(this.updatePos)};t.prototype.updataBattle=function(){if(this.vo.isInBattle){this.hpBar.visible=false;this.aniEffect.visible=true}else{this.hpBar.visible=true;this.aniEffect.visible=false}this.callLater(this.updatePos)};t.prototype.showProgressBar=function(t,e,i){if(!this.progressBar){this.progressBar=new n.ProgressBarView;this.progressBar.anchorX=.5}this.addChild(this.progressBar);this.progressBar.setType(t,e,i)};t.prototype.hideProgressBar=function(){if(this.progressBar){this.removeChild(this.progressBar)}};t.prototype.updataBubble=function(){if(dailytask.BubbleModel.getIns().checkIfShowBubble(this.vo)){if(!this.bubbleEff){this.bubbleEff=new game.AniView;this.bubbleEff.load("skill_paodianzhong",game.AniView.FILE_NAME.UI);this.bubbleEff.height=20;this.posArr.push(this.bubbleEff)}util.SpriteLinkUtil.addLinkChild(this,this.bubbleEff,scene.SceneMediator.getInstance().isoWorld.headLayer);this.bubbleEff.visible=true}else{if(this.bubbleEff){this.bubbleEff.visible=false}}this.callLater(this.updatePos)};t.prototype.clearAll=function(){this.hpBar.clearAll()};return t}(Laya.Component);n.RoleHeadView=t})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var scene;(function(e){var t=function(i){__extends(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}t.prototype.init=function(t){i.prototype.init.call(this,t);if(!this.bm){this.bm=new Laya.Image;this.addChild(this.bm)}this.initTime=0;this.alpha=.8;var e=this.vo;this.bm.scaleX=e.data.sx;this.bm.graphics=e.data.g;this.x=e.x;this.y=e.x;this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};t.prototype.clearAll=function(){this.init(this.vo)};t.prototype.onDisplay=function(){Laya.timer.once1(200,this,this.hide)};t.prototype.onUnDisplay=function(){this.hide()};t.prototype.setObscured=function(t){this.bm.alpha=t?.6:1};Object.defineProperty(t.prototype,"isoPos",{set:function(t){},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"depth",{get:function(){return 0},enumerable:true,configurable:true});t.prototype.updateFrame=function(t){this.initTime+=t};t.prototype.hide=function(){Laya.Tween.clearAll(this);Laya.timer.clear(this,this.hide);e.SceneMediator.getInstance().removeSceneItem(this.vo.insId);t.pushShade(this)};t.getShadeVO=function(){if(this.poolVoList.length>0){return this.poolVoList.pop()}var t=new e.RoleShadeVO;t.insId=Uint64.initClientUint64();return t};t.popShade=function(t){if(this.poolDic[t.toString()]){return this.poolDic[t.toString()]}return new e.RoleShadeView};t.pushShade=function(t){this.poolDic[t.vo.insId.toString()]=t;if(this.poolVoList.indexOf(t.vo)==-1){this.poolVoList.push(t.vo)}};t.poolVoList=[];t.poolDic={};return t}(e.SceneItemView);e.RoleShadeView=t})(scene||(scene={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){this.wenbtn.width=200;this.wenbtn.text=app.getLang(t,game.Context.mainRole.playername);var e=this.wenbtn.contextWidth;var i=this.wenbtn.contextHeight;this.ditu.width=e+20;this.ditu.height=i+46};e.SINGLE_KEY="role.TalkBubbleView";return e}(ui.duihua.duihuaqipaoUI);t.TalkBubbleView=e})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var scene;(function(a){var t=function(e){__extends(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}n.prototype.setEffect=function(){if(this.mVo.noEffect){var t=this.vo.getCfg();if(t.clickaction!=""){this.roleState=t.clickaction.toUpperCase()}else{this.hide()}}};n.prototype.hide=function(){app.MyTween.to(this,{alpha:.2},800,Laya.Ease.linearNone,Laya.Handler.create(this,this.onRemoveTarget))};n.prototype.onRemoveTarget=function(){a.SceneMediator.getInstance().removeSceneItem(this.vo.insId)};Object.defineProperty(n.prototype,"mVo",{get:function(){return this.vo},enumerable:true,configurable:true});n.prototype.setRoleAni=function(t,e,i){if(i===void 0){i=false}this.avatar.setAni(t,e,i)};n.prototype.init=function(t){this.boLink=true;this.sceneMediator=a.SceneMediator.getInstance();e.prototype.init.call(this,t);this.initRole();this.sceneMediator.setStandPos(this.vo.insId,this.vo.posX,this.vo.posY)};n.prototype.initRole=function(){this.avatar=new avatar.AvatarAnimation;this.avatar.on(avatar.AvatarAnimation.EVENTS.LOADED,this,this.onAniLoaded);this.avatar.canstop=true;this.avatar.setAniData(this.vo);this.avatar.play();var t=this.vo.getCfg();this.roleState=t.iniaction.toUpperCase();this._shadow=new Laya.Image("res/assist/circle.png");this._shadow.anchorX=this._shadow.anchorY=.5;this.isoDisplay.addChild(this.avatar);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.avatar.setAniData(this.vo);var e=this.vo.getCfg().times;if(e==0){e=100}this.isoDisplay.scale(e/100,e/100);this.on(Laya.Event.CLICK,this,this.onClick)};n.prototype.setObscured=function(t){this.avatar.alpha=t?.6:1};n.prototype.updateFrame=function(t){if(this.mVo.noEffect){return}var e=this.vo.getCfg();if(e.type==n.ENUM_TYPE.EXIT){var i=role.LeadingRoleView.getIns().vo;if(this.isInArea(i.posX,i.posY)){copy.CopyModel.getIns().setMachineOpen(e.id);role.LeadingRoleView.getIns().stopMove();copy.CopyModel.getIns().success()}}else if(e.type==n.ENUM_TYPE.REACH_OPEN){var i=role.LeadingRoleView.getIns().vo;if(this.isInArea(i.posX,i.posY)){this.openEnd()}}};n.prototype.onDisplay=function(){this.mouseEnabled=true;this.avatar.setAniData(this.vo);this._shadow.noGlobal=true;this.setEffect();copy.CopyModel.getIns().on(copy.CopyModel.MACHINE_OPEN,this,this.setEffect);util.SpriteLinkUtil.addLinkChild(this,this._shadow,this.sceneMediator.isoWorld.shadowLayer,0,0,true)};n.prototype.onUnDisplay=function(){copy.CopyModel.getIns().off(copy.CopyModel.MACHINE_OPEN,this,this.setEffect);util.SpriteLinkUtil.removeLinkChild(this,this._shadow)};Object.defineProperty(n.prototype,"roleState",{get:function(){return this._roleState},set:function(t){this._roleState=t;if(t==role.RoleStateConst.IDLE){this.setRoleAni(avatar.AvatarAnimation.ANI_ENUMS.IDLE,this.vo.dir)}else if(t==role.RoleStateConst.DIE){this.setRoleAni(avatar.AvatarAnimation.ANI_ENUMS.DIE,this.vo.dir)}},enumerable:true,configurable:true});n.prototype.onAniLoaded=function(){this.hitArea=this.avatar.hitArea};n.prototype.isInArea=function(t,e){var i=this.vo.getCfg();return game.SceneModel.checkPosInRect(t,e,this.vo.posX-i.dis,this.vo.posY-i.dis,this.vo.posX+i.dis,this.vo.posY+i.dis)};n.prototype.onClick=function(t){if(this.mVo.noEffect){return}var e=this.vo.getCfg();if(e.type==n.ENUM_TYPE.CLICK_OPEN){if(game.SceneModel.checkReachPos(game.Context.mainRole.posX,game.Context.mainRole.posY,this.vo.posX,this.vo.posY,e.dis)){t.stopPropagation();role.LeadingRoleView.getIns().stopMove();role.LeadingRoleView.getIns().aiTrapMachine(this.vo,Laya.Handler.create(this,this.openEnd))}}};n.prototype.openEnd=function(){game.SceneModel.createAllScreenSp(0,.2);var t=this.vo.getCfg();copy.CopyModel.getIns().setMachineOpen(t.id);var e=copy.CopyModel.getIns().getOpenAreaByMid(t.id);var i=copy.CopyModel.getIns().getCloseMidByAid(e);var n=csv.MapTrapProxy.getIns().getVO(i);a.SceneMediator.getInstance().setCameraPos(n.getCfg().x1,n.getCfg().y1);Laya.timer.once(1e3,this,this.lookBack);Laya.timer.once(200,this,this.delayRemove)};n.prototype.delayRemove=function(){var t=this.vo.getCfg();copy.CopyModel.getIns().pushOpenMid(t.id)};n.prototype.lookBack=function(){game.SceneModel.clearAllScreenSp();a.SceneMediator.getInstance().changeCamera(role.LeadingRoleView.getIns());manager.FlowManager.instance.flowByStyle1(app.getLang("机关开启成功"))};n.ENUM_TYPE={CLICK_OPEN:1,EXIT:2,STOP:3,REACH_OPEN:4};return n}(a.SceneItemView);a.TrapMachineView=t})(scene||(scene={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(a){var t=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.init=function(t){e.prototype.init.call(this,t);this.headView=new a.NpcFuncHeadView(t.npcVo);this.headView.x=t.npcVo.headoffx;this.headView.y=-t.npcVo.getModelHeight();this.npc.addChild(this.headView)};t.prototype.doClick=function(){var t=this.npc.npcVo.getCfg();var e=parseInt(t.param1);var i=csv.NpcProxy.getIns().getNpcVO(t.npcid);if(e==csv.ActivityFunction.ENUM.PAO_DIAN){a.LeadingRoleView.getIns().aiTalk(i,ai.NpcTalkAI.ENUM_TYPE.DIALOG,dailytask.BubbleView)}else if(e==csv.ActivityFunction.ENUM.SHOU_HU){a.LeadingRoleView.getIns().aiTalk(i,ai.NpcTalkAI.ENUM_TYPE.DIALOG,dailytask.HuluDefendView)}else if(e==csv.ActivityFunction.ENUM.MO_BAI){if(team.TeamZhanyouModel.getIns().bcid==0){if(team.TeamModel.getIns().hasTeam){if(team.TeamModel.getIns().myTeamInfo.copyId==3&&team.TeamModel.getIns().myTeamInfo.count==3){this.onStartBcReq();return}}}var n=dailytask.DailyTaskModel.getIns().getOpenActivityByType(e);if(n){a.LeadingRoleView.getIns().aiTalk(i,ai.NpcTalkAI.ENUM_TYPE.CALL,Laya.Handler.create(this,function(){app.ProtocolRequest.HomeWorshipStartReq()}))}}};t.prototype.dieAni=function(t){};t.prototype.onStartBcReq=function(){team.TeamZhanyouModel.getIns().onStartBcReq()};return t}(a.NpcBaseControl);a.NpcActControl=t})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(i){var t=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.init=function(t){e.prototype.init.call(this,t);this.headView=new i.NpcHeadView(t.npcVo);this.headView.x=t.npcVo.headoffx;this.headView.y=-t.npcVo.getModelHeight();this.npc.addChild(this.headView);this.onChange();boss.BossModel.getIns().on(boss.BossEvent.BOSS_DETAIL_CHANGE,this,this.onChange)};t.prototype.doClick=function(){i.LeadingRoleView.getIns().aiBossBattle(this.npc.vo.getCfg().param1)};t.prototype.dieAni=function(t){};t.prototype.onChange=function(){var t=parseInt(this.npc.npcVo.getCfg().param1);var e=boss.BossModel.getIns().getBossDetail(t);if(e){this.npc.npcVo.boDie=!!e.deadtime;this.npc.avatar.setAniData(this.npc.npcVo)}};return t}(i.NpcBaseControl);i.NpcBossControl=t})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(n){var t=function(i){__extends(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}t.prototype.init=function(t){i.prototype.init.call(this,t);this.headView=new n.NpcHeadView(t.npcVo);this.headView.x=t.npcVo.headoffx;this.headView.y=-t.npcVo.getModelHeight();this.npc.addChild(this.headView);this.addBossHp();guardisland.GuardIslandsModel.getIns().on(guardisland.GuardIslandsModel.EVENT_UPDATA_MAP_ONE_ITEMS,this,this.onUpdateOneItem);var e=guardisland.GuardIslandsModel.getIns().getObjView(this.npc.vo.insId);if(e){this.onUpdateOneItem(e)}};t.prototype.doClick=function(){n.LeadingRoleView.getIns().aiTalk(this.npc.vo,ai.NpcTalkAI.ENUM_TYPE.CALL,Laya.Handler.create(this,this.doAction))};t.prototype.dieAni=function(t){};t.prototype.doAction=function(){n.LeadingRoleView.getIns().stopMove();var t=this.npc.vo;if(t&&t.isDead()){}else{app.ProtocolRequest.GuardIslandFightReq(this.npc.vo.insId)}};t.prototype.addBossHp=function(){if(!this.bossHp){this.bossHp=new n.SceneBossBloodView;this.npc.addChild(this.bossHp);this.bossHp.x=-this.bossHp.width/2;this.bossHp.y=-this.npc.npcVo.getModelHeight()+this.headView.height+this.bossHp.height}};t.prototype.onUpdateOneItem=function(t){if(Uint64.equal(t.id,this.npc.vo.insId)){if(this.bossHp){this.bossHp.percent=t.curhp/t.maxhp;this.bossHp.showfight(t.fightflag>0);this.bossHp.showCutDownTime(t.relievetime);this.crossDeadModel(t.curhp<=0)}}};t.prototype.crossDeadModel=function(t){this.npc.npcVo.boDie=t;this.npc.avatar.setAniData(this.npc.npcVo);if(t){this.npc.mouseEnabled=false}else{this.npc.mouseEnabled=true}};return t}(n.NpcBaseControl);n.NpcBossHldControl=t})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(t){this.npc=t;this.npc.boShadow=false;csv.FunctionsProxy.getIns().on(csv.FunctionsProxy.EVENTS.ADD,this,this.onBuildOpen)};e.prototype.doClick=function(){};e.prototype.dieAni=function(t){};e.prototype.onBuildOpen=function(t){if(t.id==this.npc.npcVo.getCfg().param1&&this.npc.npcVo.skins.length>1){var e=manager.EffectManager.playStageEffectByPos("skill_shengjijiaose",this.npc,0,-this.npc.vo.getMountHeight()/2,game.AniView.FILE_NAME.UI,Laya.Handler.create(this,this.onOpenEnd));e.scale(2,2)}};e.prototype.onOpenEnd=function(){this.npc.setRoleAni(avatar.AvatarAnimation.ANI_ENUMS.IDLE,this.npc.vo.dir,true)};return e}(t.NpcBaseControl);t.NpcBuildControl=e})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(i){var t=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.init=function(t){e.prototype.init.call(this,t);this.headView=new i.NpcHeadView(t.npcVo);this.headView.x=t.npcVo.headoffx;this.headView.y=-t.npcVo.getModelHeight();this.npc.addChild(this.headView)};t.prototype.doClick=function(){i.LeadingRoleView.getIns().aiTalk(this.npc.vo,ai.NpcTalkAI.ENUM_TYPE.CALL,Laya.Handler.create(this,this.doAction))};t.prototype.doAction=function(){guardisland.GuardIslandsModel.getIns().once(guardisland.GuardIslandsModel.EVENT_GATHER_INFO,this,this.onGatherInfoHandler);i.LeadingRoleView.getIns().isBeginingCollect=true;app.ProtocolRequest.StartGatherReq(this.npc.vo.insId)};t.prototype.onGatherInfoHandler=function(t){if(Uint64.equal(t.playerID,game.Context.mainRole.insId)&&t.endTime==0){guardisland.GuardIslandsModel.getIns().stopCold();return}i.LeadingRoleView.getIns().startCollect(t)};t.prototype.dieAni=function(t){this.aniEnd=t;this.npc.avatar.on(Laya.Event.COMPLETE,this,this.onCollectAniCollectComplete);this.npc.setRoleAni(avatar.AvatarAnimation.ANI_ENUMS.DIE,this.npc.vo.dir,true)};t.prototype.onCollectAniCollectComplete=function(){if(this.aniEnd){this.aniEnd.run()}guardisland.GuardIslandsModel.getIns().succeedWindow()};return t}(i.NpcBaseControl);i.NpcCollectHldControl=t})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(i){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t._isQiPao=false;return t}t.prototype.init=function(t){e.prototype.init.call(this,t);this.headView=new i.NpcFuncHeadView(t.npcVo);this.headView.x=t.npcVo.headoffx;this.headView.y=-t.npcVo.getModelHeight();this.funcs=app.str2Array(this.npc.vo.getCfg().param1,";");this.headView.obFunc(this.funcs);this.setHideState();this.setQiPao()};t.prototype.setQiPao=function(){if(this.headView){this.headView.setQiPao(this._isQiPao,this._skin,this._funClick)}};t.prototype.isShowQiPao=function(t,e,i){this._isQiPao=t;this._skin=e;this._funClick=i;if(this.npc){var n=scene.SceneMediator.getInstance().getViewById(this.npc.vo.insId);if(n){this.setQiPao()}}};t.prototype.setHideState=function(){var t=false;for(var e=0,i=this.funcs.length;e<i;e++){if(csv.FunctionsProxy.getIns().isOpen(this.funcs[e])){t=true;break}}if(!t){csv.FunctionsProxy.getIns().on(csv.FunctionsProxy.EVENTS.CHANGE,this,this.setHideState)}else{csv.FunctionsProxy.getIns().off(csv.FunctionsProxy.EVENTS.CHANGE,this,this.setHideState)}if(this.npc.vo.getCfg().hidestate==1){if(t){this.npc.addChild(this.headView)}else{this.npc.removeChild(this.headView)}}else if(this.npc.vo.getCfg().hidestate==2){this.npc.visible=t;if(t){this.npc.addChild(this.headView)}else{this.npc.removeChild(this.headView)}}};t.prototype.doClick=function(){i.LeadingRoleView.getIns().aiTalk(this.npc.vo,ai.NpcTalkAI.ENUM_TYPE.FUNC,this.npc.vo.getCfg().param1,[true,false]);this.headView.funcAdapter.changeDot()};t.prototype.dieAni=function(t){};return t}(i.NpcBaseControl);i.NpcFuncControl=t})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(t){var e=function(i){__extends(t,i);function t(t){var e=i.call(this)||this;e._isQiPao=false;e._skin="";e.posArr=[];e.vo=t;e.posArr.push(e.imgbanghui);e.posArr.push(e.imgbanghuijianzhu);e.posArr.push(e.imgtishi);e.posArr.push(e.imgdaoju);e.imgbanghuijianzhu.skin=e.vo.getNameUrl();return e}t.prototype.initialize=function(){i.prototype.initialize.call(this);this.autoSize=true;this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.funcAdapter=new game.FuncDotAdapter(this.imgbanghui,55,5,true)};t.prototype.obFunc=function(t){this.funcAdapter.obFunc(t)};t.prototype.onDisplay=function(){this.callLater(this.updateLayout);util.SpriteLinkUtil.addLinkChild(this,this.imgbanghui,scene.SceneMediator.getInstance().isoWorld.headLayer,0,0,true);util.SpriteLinkUtil.addLinkChild(this,this.imgbanghuijianzhu,scene.SceneMediator.getInstance().isoWorld.headLayer,this.imgbanghuijianzhu.x,this.imgbanghuijianzhu.y,true)};t.prototype.onUnDisplay=function(){util.SpriteLinkUtil.removeLinkChild(this,this.imgbanghui);util.SpriteLinkUtil.removeLinkChild(this,this.imgtishi);util.SpriteLinkUtil.removeLinkChild(this,this.imgdaoju);util.SpriteLinkUtil.removeLinkChild(this,this.imgbanghuijianzhu)};t.prototype.updateLayout=function(){};t.prototype.clearAll=function(){};t.prototype.setQiPao=function(t,e,i){this._isQiPao=t;this._skin=e;if(t){this.imgdaoju.skin=this._skin;util.SpriteLinkUtil.addLinkChild(this,this.imgtishi,scene.SceneMediator.getInstance().isoWorld.flyLayer,-53,-12,true);util.SpriteLinkUtil.addLinkChild(this,this.imgdaoju,scene.SceneMediator.getInstance().isoWorld.flyLayer,5,19,true)}else{util.SpriteLinkUtil.removeLinkChild(this,this.imgtishi);util.SpriteLinkUtil.removeLinkChild(this,this.imgdaoju)}if(i){this.setQiPaoClick(t,i)}};t.prototype.setQiPaoClick=function(t,e){this._funClick=e;if(t){this.imgtishi.on(Laya.Event.CLICK,this,this._funClick)}else{this.imgtishi.off(Laya.Event.CLICK,this,this._funClick)}};return t}(ui.main.mapnameUI);t.NpcFuncHeadView=e})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(t){var e=function(i){__extends(t,i);function t(t){var e=i.call(this)||this;e.posArr=[];e.vo=t;e.lblName=new Laya.Label;e.lblName.autoSize=true;e.lblName.fontSize=24;e.lblName.color=game.STYLES.YELLOW_COLOR;e.lblName.bold=true;e.lblName.cacheAs="normal";e.lblName.stroke=2;e.lblName.strokeColor="#203c56";e.posArr.push(e.lblName);e.lblTemp=new Laya.Label;e.lblTemp.autoSize=true;e.lblTemp.fontSize=24;e.lblTemp.color=game.STYLES.BLUE_COLOR;e.lblTemp.stroke=1;e.lblName.strokeColor="#203c56";e.lblTemp.bold=true;e.lblTemp.cacheAs="normal";e.lblTemp.visible=false;e.posArr.push(e.lblTemp);e.imgTemp=new Laya.Image;e.imgTemp.scale(.8,.8);e.imgTemp.visible=false;e.imgTemp.on(Laya.Event.LOADED,e,e.onImgComplete);e.posArr.push(e.imgTemp);return e}t.prototype.initialize=function(){i.prototype.initialize.call(this);this.autoSize=true;this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};t.prototype.onDisplay=function(){this.callLater(this.updateLayout);util.SpriteLinkUtil.addLinkChild(this,this.lblName,scene.SceneMediator.getInstance().isoWorld.nameLayer);util.SpriteLinkUtil.addLinkChild(this,this.lblTime,scene.SceneMediator.getInstance().isoWorld.nameLayer);util.SpriteLinkUtil.addLinkChild(this,this.lblTemp,scene.SceneMediator.getInstance().isoWorld.nameLayer);util.SpriteLinkUtil.addLinkChild(this,this.imgTemp,scene.SceneMediator.getInstance().isoWorld.nameLayer)};t.prototype.onUnDisplay=function(){util.SpriteLinkUtil.removeLinkChild(this,this.lblName);util.SpriteLinkUtil.removeLinkChild(this,this.lblTime);util.SpriteLinkUtil.removeLinkChild(this,this.lblTemp);util.SpriteLinkUtil.removeLinkChild(this,this.imgTemp)};t.prototype.updateLayout=function(){this._showSubOther();this.updatePos()};t.prototype.onImgComplete=function(){this.callLater(this.updatePos)};t.prototype.updatePos=function(){var t=0;for(var e=0,i=this.posArr.length;e<i;++e){var n=this.posArr[e];if(n.visible&&(n===this.lblName||n===this.lblTime)){n.linkOffY=t-n.height-5;t=n.linkOffY}}this.lblName.linkOffX=-this.lblName.width/2;if(this.imgTemp.visible&&this.lblTemp.visible){this.lblTemp.linkOffX=this.lblName.linkOffX+this.lblName.width/2-this.lblTemp.width/2;this.imgTemp.linkOffX=this.lblTemp.linkOffX-this.imgTemp.width+5;this.lblTemp.linkOffY=this.lblName.linkOffY-this.lblName.height-10;this.imgTemp.linkOffY=this.lblName.linkOffY-this.imgTemp.height+8;if(this.lblTime){if(this.lblTime.visible==true)this.lblTime.linkOffY=this.imgTemp.linkOffY-this.imgTemp.height}}else{this.lblName.linkOffX=-this.lblName.width/2}};t.prototype._showSubOther=function(){var t=this.vo.getCfg();switch(t.showtype){case csv.NPC_SHOW_TYPE.ICE_NPC:this.imgTemp.skin="bosszhandou/bg_hanqi.png";this.imgTemp.visible=true;this.lblTemp.visible=true;if(t.npctype==2){var e=this.vo.getCfg().param1;var i=csv.BossProxy.getIns().getCfg(e);var n=csv.BossProxy.getIns().getMonsterId(i.bosssetbase);var a=csv.MonsterProxy.getIns().getCfg(n);this.lblTemp.text=i.param2.split(";")[0];this.lblName.text=csv.NpcProxy.getName(this.vo.getCfg())+"("+a.monlevel+")"+app.getLang("级")}else{this.lblName.text=csv.NpcProxy.getName(t);this.lblTemp.text=this.vo["danaoCfg"].icenum+""}break;default:this.lblName.text=csv.NpcProxy.getName(t);break}};t.prototype.clearAll=function(){};t.prototype.addTime=function(t){if(!this.lblTime){this.lblTime=new Laya.Label;this.lblTime.autoSize=true;this.lblTime.fontSize=24;this.lblTime.color=game.STYLES.YELLOW_COLOR_S;this.lblTime.bold=true;this.lblTime.anchorX=.5;this.lblTime.cacheAs="normal";this.lblTime.stroke=2;this.lblTime.strokeColor="#203c56";this.posArr.push(this.lblTime)}util.SpriteLinkUtil.addLinkChild(this,this.lblTime,scene.SceneMediator.getInstance().isoWorld.nameLayer);this.updatePos();this._timeLablePosOffset();this.least=t;Laya.timer.loop(1e3,this,this.loopTime);this.lblTime.text=util.TimeUtil.formatTime(this.least)};t.prototype._timeLablePosOffset=function(){var t=Math.abs(this.lblName.y-this.lblTime.y);if(t<this.lblName.height){this.lblTime.y-=this.lblName.height-t}};t.prototype.loopTime=function(){this.least--;if(this.least>0){this.lblTime.text=util.TimeUtil.formatTime(this.least)}else{this.removeTime()}};t.prototype.removeTime=function(){Laya.timer.clear(this,this.loopTime);util.SpriteLinkUtil.removeLinkChild(this,this.lblTime);this.updatePos()};return t}(Laya.Component);t.NpcHeadView=e})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(i){var t=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.init=function(t){e.prototype.init.call(this,t);this.headView=new i.NpcHeadView(t.npcVo);this.headView.x=t.npcVo.headoffx;this.headView.y=-t.npcVo.getModelHeight();this.npc.addChild(this.headView)};t.prototype.doClick=function(){var t=game.HomeEventModel.getInstance().getEventIDByNpcID(this.npc.npcVo.getCfgId());if(csv.GardenEventProxy.getIns().cfgMap[t].dieani==1){i.LeadingRoleView.getIns().aiTalk(this.npc.vo,ai.NpcTalkAI.ENUM_TYPE.CALL,Laya.Handler.create(this,this.dieAni))}else{i.LeadingRoleView.getIns().aiTalk(this.npc.vo,ai.NpcTalkAI.ENUM_TYPE.CALL,Laya.Handler.create(this,this.getReward))}};t.prototype.getReward=function(){var e=this;if(this.removeTween)Laya.Tween.clear(this.removeTween);this.removeTween=Laya.Tween.to(this.npc,{alpha:0},1e3,Laya.Ease.linearNone,Laya.Handler.create(this,function(){var t=game.HomeEventModel.getInstance().getEventIDByNpcID(e.npc.npcVo.getCfgId());if(game.HomeEventModel.getInstance().canShowEventNPC(t)){console.log("AwardHomeReq "+t);app.ProtocolRequest.AwardHomeReq(t)}}))};t.prototype.doAction=function(){};t.prototype.dieAni=function(t){this.npc.avatar.once(Laya.Event.COMPLETE,this,this.getReward);this.npc.setRoleAni(avatar.AvatarAnimation.ANI_ENUMS.DIE,this.npc.vo.dir,true)};return t}(i.NpcBaseControl);i.NPCHomeEventControl=t})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(t){var e=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.init=function(t){e.prototype.init.call(this,t);this.boShadow=true;this.npcVo.control.init(this);if(this.npcVo.type==csv.NpcProxy.ENUM_TYPE.BUILD){this.isoType=isometric.IsoType.OBJECTS_TYPE}};t.prototype.onDisplay=function(){if(this.boShadow){if(this.charactorVO.isShadow()){this.avatar.createShadow(this,this.isoDisplay.scaleX,this.isoDisplay.scaleY)}else{util.SpriteLinkUtil.addLinkChild(this,this.shadow,this.sceneMediator.isoWorld.shadowLayer,0,0,true)}Laya.stage.on(Laya.Event.VISIBILITY_CHANGE,this,this.onVisibleChange);game.SystemSetModel.getInstance().on(game.SystemSetModel.EVENTS.REALSHADOW_SWITCH_CHANGE,this,this.changeShadow);game.SystemSetModel.getInstance().on(game.SystemSetModel.EVENTS.MODEL_SWITCH_CHANGE,this,this.changeShadow);if(this.npcVo.getCfg().npcyincang){this.isoDisplay.alpha=0}else{this.isoDisplay.alpha=1}}};t.prototype.onUnDisplay=function(){if(this.boShadow){if(this.charactorVO.isShadow()){this.avatar.clearShadow(this)}else{util.SpriteLinkUtil.removeLinkChild(this,this.shadow)}Laya.stage.off(Laya.Event.VISIBILITY_CHANGE,this,this.onVisibleChange);game.SystemSetModel.getInstance().off(game.SystemSetModel.EVENTS.REALSHADOW_SWITCH_CHANGE,this,this.changeShadow);game.SystemSetModel.getInstance().off(game.SystemSetModel.EVENTS.MODEL_SWITCH_CHANGE,this,this.changeShadow)}};t.prototype.onAniLoaded=function(){var t=this.vo.getCfg();if(t.clickarea==""){this.hitArea=this.avatar.hitArea}else{var e=t.clickarea.split(";");this.hitArea=new Laya.Rectangle(parseInt(e[0]),parseInt(e[1]),parseInt(e[2]),parseInt(e[3]))}};Object.defineProperty(t.prototype,"npcVo",{get:function(){return this.vo},enumerable:true,configurable:true});t.prototype.clearAll=function(){this.isoDisplay.x=0;this.isoDisplay.y=0;this.isoDisplay.alpha=1};t.prototype.draw=function(t,e,i,n){if(!this.sp){this.sp=new Laya.Sprite;this.sp.alpha=.7;this.addChild(this.sp)}this.sp.graphics.clear();this.sp.graphics.drawRect(t,e,i,n,1)};t.setNpcClickArea=function(t,e,i,n,a){var o=csv.NpcProxy.getIns().getNpcVO(t);var s=scene.SceneMediator.getInstance().getViewById(o.insId);if(s){s.draw(e,i,n,a)}};return t}(t.SceneMoveView);t.NpcView=e})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var scene;(function(i){var t=function(t){__extends(e,t);function e(){return t.call(this)||this}e.prototype.getVoType=function(){return i.SceneItemType.CARMERA};e.prototype.getCfg=function(){return null};e.prototype.getRoleUrl=function(t,e){return""};return e}(i.SceneItemVO);i.CarmeraVO=t})(scene||(scene={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var scene;(function(e){var t=function(a){__extends(t,a);function t(t){var e=a.call(this)||this;e.mapobj=t;e.dir=t.dir;e.insId=t.id;var i=t.cfgid;if(t.objtype==game.LAND_OBJ_TYPE.BOSS_KUA_FU){e.danaoCfg=csv.BossProxy.getIns().danaotiangongCfgMap[i]}else if(t.objtype==game.LAND_OBJ_TYPE.BOSS_ICE){e.danaoCfg=csv.BossProxy.getIns().iceCfgMap[i]}e.posX=t.x;e.posY=t.y;var n=csv.GuardIsandProxy.getIns().collectionMap[e.danaoCfg.collectionid];e.setCfg(csv.NpcProxy.getIns().getCfg(n.npcid));return e}t.prototype.getUrl=function(){return csv.NpcProxy.getSceneUrl(this._cfg)};t.prototype.getRoleUrl=function(t,e){var i=this.getCfg().model;return"res/atlas/ani/"+i+"_"+t+"_"+e+".atlas"};t.prototype.getVoType=function(){return e.SceneItemType.COLLECT};t.prototype.setCfg=function(t){this._cfgId=parseInt(t.npcid);this._cfg=t};t.prototype.setCfgId=function(t){this._cfgId=t;this._cfg=csv.NpcProxy.getIns().getCfg(t)};t.prototype.getCfg=function(){return this._cfg};t.prototype.getModelHeight=function(){var t=parseInt(this._cfg.high);return t};return t}(e.SceneItemVO);e.CollectVO=t})(scene||(scene={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(t){var e=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t.startDis=150;t.stopDis=50;t.speed=.9;return t}t.prototype.getVoType=function(){return scene.SceneItemType.GUARDPET};t.prototype.getCfg=function(){return csv.GuardProxy.getIns().getCfg(this._cfgId)};Object.defineProperty(t.prototype,"offY",{get:function(){var t=this.getCfg();if(t&&t.high!=""){return parseInt(t.high)}return 0},enumerable:true,configurable:true});t.prototype.getRoleUrl=function(t,e){var i=this.getCfg();if(i){e=game.SceneModel.getMountDir(e);return"res/atlas/ani/guard/"+i.modelres+"_"+t+"_"+e+".atlas"}return""};t.prototype.createVo=function(t,e){this.insId=Uint64.initClientUint64();this.setCfgId(t);this.flower=e};return t}(scene.SceneItemVO);t.GuardPetVO=e})(role||(role={}));var role;(function(t){var e=function(){function t(t){this.list=[];this.list=app.str2Array(t,"|",";")}t.prototype.getMax=function(t){for(var e=this.list.length;e>0;e--){if(t<this.list[e-1][0]){continue}return parseInt(this.list[e-1][1])}return parseInt(this.list[0][1])};return t}();t.MaxTalent=e})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(n){var t=function(e){__extends(i,e);function i(){var t=e.call(this)||this;t._boFirstSet=true;t.monsterType=0;t.movetype=0;t.hittype=0;t.voType=scene.SceneItemType.MONSTER;return t}Object.defineProperty(i.prototype,"hp",{get:function(){return this._hp},set:function(t){this._hp=t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"dir",{get:function(){return this._dir},set:function(t){if(this.monsterType==n.MonsterVO.ENUM_MONSTER_TYPE.LIMIT_BOSS){if(this._boFirstSet){this._dir=t;this._boFirstSet=false}}else{this._dir=t}},enumerable:true,configurable:true});i.recode=function(t){var e=new i;e.insId=t.objId;e.hp=t.hp.toNumber();e.maxhp=t.maxhp.toNumber();e.mp=t.mp.toNumber();e.maxmp=t.maxmp.toNumber();e.monsterId=t.monsterId;e.name=t.name;e.pos=t.pos;e.battleCamp=t.camp;e.setCfgId(e.monsterId);e.battleid=battle.BattleModel.getIns().battleid;return e};i.prototype.getHeadUrl=function(){return csv.MonsterProxy.getMonsterHeadUrl(this._cfg)};i.prototype.getRoleUrl=function(t,e){return csv.MonsterProxy.getMonsterModelUrl(this._cfg,t,e)};i.prototype.getMountUrl=function(t,e){return""};i.prototype.getCfg=function(){return this._cfg};i.prototype.getName=function(){if(this.name==""){var t=csv.MonsterProxy.getIns().getCfg(this.monsterId).monname;return app.getLang(t)}return this.name};i.prototype.getLevel=function(){if(this._cfg){return this._cfg.monlevel}return 1};Object.defineProperty(i.prototype,"scaleNum",{get:function(){if(this._cfg){var t=this._cfg.times;if(t==0){t=100}return t/100}return 1},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"boRemoteHero",{get:function(){if(!this._boRemoteHero){this._boRemoteHero=this.attackDis>csv.DefclassProxy.REMOTE_DIS}return this._boRemoteHero},enumerable:true,configurable:true});i.prototype.getVoType=function(){return scene.SceneItemType.MONSTER};i.prototype.setCfgId=function(t){this._cfgId=t;this._cfg=csv.MonsterProxy.getIns().getCfg(t);if(!this._cfg){console.log("error roleVO: "+t)}this.prof=parseInt(this._cfg.monpro)};Object.defineProperty(i.prototype,"attackDis",{get:function(){return this._cfg.attackdis},enumerable:true,configurable:true});i.prototype.getModelHeight=function(){var t=100;if(this._cfg){t=parseInt(this._cfg.hpheight)}return t};Object.defineProperty(i.prototype,"attackSpeed",{get:function(){var t=50;if(this._cfg){t=parseInt(this._cfg.specialprop.split("-")[3])}return t},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"boEnergy",{get:function(){var t=false;if(this._cfg){t=parseInt(this._cfg.energybar)==0}return t},enumerable:true,configurable:true});i.prototype.getUrl=function(){return""};i.getSkillShield=function(t){if(battle.BattleModel.getIns().boShield){return true}var e=game.SystemSetModel.getInstance().settingData.getValueByType(game.SettingType.skillEffect);if(!e.switch){return false}if(e.value){return true}return false};i.ENUM_MONSTER_TYPE={NORMAL:0,GUAJI_BOSS:1,LIMIT_BOSS:2,FUBEN_MON:3,REPORT_BOSS:4,SUMMON:5};return i}(n.CharactorVO);n.MonsterVO=t})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.getVoType=function(){return scene.SceneItemType.PLAYER};e.recode=function(t,e){!e?e=new i.PlayerRoleVO:null;e.name=t.name;e.playername=t.name;e.prof=t.classSkin;if(t.hasOwnProperty("id")){e.insId=t.id}else if(t.hasOwnProperty("roleId")){e.insId=t.roleId}else if(t.hasOwnProperty("uid")){e.insId=t.uid}if(t.hasOwnProperty("setskin"))e.setskin=t.setskin;if(t.hasOwnProperty("uplv"))e.uplv=t.uplv;if(t.hasOwnProperty("transf"))e.transf=t.transf;if(t.hasOwnProperty("camp"))e.battleCamp=t.camp;if(t.hasOwnProperty("fashion"))e.classSkin=t.fashion;if(t.hasOwnProperty("soulStar"))e.soulStar=t.soulStar;if(t.hasOwnProperty("level"))e.level=t.level;if(t.hasOwnProperty("tupoLv"))e.tupoLv=t.tupoLv;if(t.hasOwnProperty("titleId"))e.usetitle=t.titleId;if(t.hasOwnProperty("hp"))e.hp=t.hp.toNumber();if(t.hasOwnProperty("maxhp"))e.maxhp=t.maxhp.toNumber();if(t.hasOwnProperty("mp"))e.mp=t.mp.toNumber();if(t.hasOwnProperty("maxmp"))e.maxmp=t.maxmp.toNumber();if(t.hasOwnProperty("sp"))e.sp=t.sp.toNumber();if(t.hasOwnProperty("maxsp"))e.maxsp=t.maxsp.toNumber();if(t.hasOwnProperty("svrname"))e.svrname=t.svrname;if(t.hasOwnProperty("svrid"))e.svrid=t.svrid;if(t.hasOwnProperty("cursvrid"))e.cursvrid=t.cursvrid;e.boShowHp=false;e.boShowMp=false;return e};e.prototype.getModelName=function(){var t="";if(csv.MapProxy.isInKuaFuMap()){var e=game.Context.getSerName(this.cursvrid);t=e+this.playername}else{t=this.playername}return t};e.getModelShield=function(t){if(Uint64.equal(game.Context.mainRoleId,t.insId)){return false}if(battle.BattleModel.getIns().boShield){return true}if(game.Context.getMapType()==csv.MapProxy.MAP_TYPE.HOME){var e=game.SystemSetModel.getInstance().settingData.getValueByType(game.SettingType.otherPlayer);if(e.switch){if(e.value){return true}}}return false};return e}(i.RoleVO);i.PlayerRoleVO=t})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(t){var e=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.attackSpeed=100;return t}t.prototype.createRoleVo=function(t,e,i,n){this.insId=t.uid;this.prof=t.classSkin;this.setCfgId(this.prof);this.playername=t.uname;this.name=t.name;this.posX=e;this.posY=i;this.dir=n;this.hp=100;this.classSkin=t.fashion;this.soulStar=t.soulStar;this.usetitle=t.title;this.guildName=t.gname;this.headframeId=t.headframeId;this.headTitle=t.headtitle;this.maxhp=100;this.mp=100;this.maxmp=100;this.skillList=[];for(var a=0,o=t.skilllist.length;a<o;a++){var s=t.skilllist[a];if(s.id==this._cfg.skill){this.normalSkill=s}else{this.skillList.push(s)}}this.fstate=t.fstate;this.setSerInfo(t.cursvrid,t.svrid,t.svrname)};t.prototype.getVoType=function(){return scene.SceneItemType.ROBOT};return t}(t.RoleVO);t.RobotVo=e})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var scene;(function(a){var t=function(t){__extends(e,t);function e(){return t.call(this)||this}e.prototype.getVoType=function(){return a.SceneItemType.ROLE_SHADE};e.prototype.getCfg=function(){return null};e.prototype.getRoleUrl=function(){return""};e.createVo=function(t,e,i){var n=a.RoleShadeView.getShadeVO();n.data=t;n.x=e;n.y=i;return n};return e}(a.SceneItemVO);a.RoleShadeVO=t})(scene||(scene={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var scene;(function(i){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.noEffect=false;return t}t.prototype.getCfg=function(){return this._cfg};t.prototype.setCfg=function(t){this._cfgId=parseInt(t.id);this._cfg=t};t.prototype.setCfgId=function(t){this._cfgId=t;this._cfg=csv.NpcProxy.getIns().getCfg(t)};t.prototype.getVoType=function(){return i.SceneItemType.MACHINE};t.prototype.getRoleUrl=function(t,e){var i=this.getCfg().model;return"res/atlas/ani/monster/"+i+"_"+t+"_"+e+".atlas"};t.prototype.getUrl=function(){return csv.NpcProxy.getSceneUrl(this._cfg)};t.prototype.getModelHeight=function(){var t=parseInt(this._cfg.high);return t};return t}(i.SceneItemVO);i.TrapMachineVO=t})(scene||(scene={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(a){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.selectId=-1;t.roleAvatarDatas=[];t.roleAvatars=[];t.waitRoles=[];t.shadows=[];return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this._model=game.RoleModel.getIns();this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.skillArr=[this.jineng1,this.jineng2,this.jineng3];this.jineng1.selectHandler=this.jineng2.selectHandler=this.jineng3.selectHandler=new Laya.Handler(this,this.onSelectSkill);this.fiveStar=new chouka.FiveStar;this.fiveStar.x=this.imgwuwei.x;this.fiveStar.y=this.imgwuwei.y;this.addChild(this.fiveStar);this.fiveLabs=[this.shuxingshuzhi1,this.shuxingshuzhi2,this.shuxingshuzhi3,this.shuxingshuzhi4,this.shuxingshuzhi5];this.addLabs=[this.add1,this.add2,this.add3,this.add4,this.add5];this.weizhis=[this.weizhi1,this.weizhi2,this.weizhi3,this.weizhi4,this.weizhi5];this.genghuanbtn.clickHandler=new Laya.Handler(this,this.onGengHuan);this.tiaozhengbtn.clickHandler=new Laya.Handler(this,this.onShangzhen);this.xiangxibtn.clickHandler=new Laya.Handler(this,this.onShowWuxing);this.wenhaobtn.clickHandler=new Laya.Handler(this,this.onWuxingTip);this.gaiming.clickHandler=new Laya.Handler(this,this.changeName);this.list.on(Laya.Event.CLICK,this,this.showGuajian);guide.GuideModel.getIns().register(csv.GuideProxy.ENUM_VIEW.ROLE_WUXING_SKILL_CHECK,this.jineng1)};t.prototype.showGuajian=function(){var t=[];for(var e=0,i=this._model.aliveGuajianIds.length;e<i;e++){var n=fabaonew.FaBaoNewModel.getIns().getMagicCfgById(this._model.aliveGuajianIds[e]);t.push(n)}app.ViewManager.toggleDialog(a.GuajianShowView,1,0,t)};t.prototype.onWuxingTip=function(){app.ViewManager.toggleDialog(ui.wuxing.wuxingguizetipUI,1,0)};t.prototype.onGengHuan=function(){common.CommonWindowMK.callBackFunc=csv.FunctionsProxy.ENUMS.ROLE_WUXING;game.ClosureManager.callFunction(csv.FunctionsProxy.ENUMS.TEAM_ICON)};t.prototype.onShangzhen=function(){var t=csv.MapProxy.getIns().getMapType(game.Context.mainRole.mapId);if(t!=csv.MapProxy.MAP_TYPE.HOME){manager.FlowManager.instance.flowByStyle1(app.getLang("战斗中不可更换，请先返回家园"));return}if(game.Context.waitRoleList.length<=0){manager.FlowManager.instance.flowByStyle1(app.getLang("wuxing_des6"))}else{app.ViewManager.toggleDialog(a.ShangZhenView,1,0)}};t.prototype.onShowWuxing=function(){app.ViewManager.toggleDialog(a.WuxingTip,1,0,game.Context.wuxingAttributes)};t.prototype.onSelectSkill=function(t){this.selectId=t;app.ProtocolRequest.UseElementSkillReq(this.selectId)};t.prototype.onDisplay=function(){game.RoleModel.getIns().on(game.RoleModel.EVENTS.WUXING_SKILL_SELECT_CHANGE,this,this.setWuxingSkills);game.RoleModel.getIns().on(game.RoleModel.EVENTS.SHANGZHEN_CHANGE,this,this.showFive);game.RoleModel.getIns().on(game.RoleModel.EVENTS.TEAM_INFO_CHANGE,this,this.setWuxing);gaiming.GaiMingModel.getIns().on(gaiming.GaiMingEvent.MAIN_NAME_CHANGE,this,this.setRoleName);this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){game.RoleModel.getIns().off(game.RoleModel.EVENTS.WUXING_SKILL_SELECT_CHANGE,this,this.setWuxingSkills);game.RoleModel.getIns().off(game.RoleModel.EVENTS.SHANGZHEN_CHANGE,this,this.showFive);game.RoleModel.getIns().off(game.RoleModel.EVENTS.TEAM_INFO_CHANGE,this,this.setWuxing);gaiming.GaiMingModel.getIns().off(gaiming.GaiMingEvent.MAIN_NAME_CHANGE,this,this.setRoleName);this._model.boGuajian=false};t.prototype.refreshAll=function(){this.duiwuname.text=game.Context.mainRole.playername;this.dengjilab.text=app.getLang("level_des_1",game.Context.teamLv);var t=csv.MyTeamProxy.getIns().getTeamMaxExp(game.Context.teamLv);this.jinyantiao.value=game.Context.teamExp/t;this.shuzhilab.text=game.Context.teamExp+"/"+t;var e=[];for(var i=0,n=game.Context.roleList.length;i<n;i++){var a=game.Context.roleList[i];if(a.usetitle){e=a.getTitleUrl()}}if(e[1]){this.chenghaoimg.visible=true;if(!this.titleEff){this.titleEff=new game.AniView;this.titleEff.x=this.chenghaoimg.width/2;this.titleEff.y=this.chenghaoimg.height/2+20}this.chenghaoimg.skin="";this.titleEff.load(e[0],game.AniView.FILE_NAME.UI);this.chenghaoimg.addChild(this.titleEff);this.titleEff.play()}else{var o=e[0];if(o==""){this.chenghaoimg.visible=false}else{this.chenghaoimg.visible=true;this.chenghaoimg.skin=o}if(this.titleEff){this.titleEff.removeSelf();this.titleEff.stop()}}this.kuangimg.skin=game.Context.mainRole.getHeadFrameUrl();this.touxiangimg.skin=csv.MyTeamProxy.getIns().getTeamIcon(game.Context.teamAvatar);this.setWuxing();this.setWuxingSkills();this.showFive();this.setGuajian()};t.prototype.setWuxing=function(){var t=game.Context.wuxingAttributes[game.Context.WUXING_ORIGIN.TOTAL].concat();var e=app.getLang("magic_color_in").split(":");var i=t.splice(5,10);this.fiveStar.draw(Attributes.getWuxingPercents(t),100,e[0],parseFloat(e[1]));for(var n=0,a=t.length;n<a;n++){this.fiveLabs[n].text=t[n].toString();if(i[n]){this.addLabs[n].visible=true;this.addLabs[n].text="("+Attributes.getNumber2Percent(i[n])+")";if(n>2){this.addLabs[n].x=this.fiveLabs[n].x-this.addLabs[n].textField.textWidth-3}else{this.addLabs[n].x=this.fiveLabs[n].x+this.fiveLabs[n].textField.textWidth+3}}else{this.addLabs[n].visible=false}}};t.prototype.setWuxingSkills=function(){var t=csv.SkillProxy.getIns().wuxingArr;for(var e=0,i=this.skillArr.length;e<i;e++){this.skillArr[e].setData(t[e],game.Context.aliveWuxingSkills,game.Context.selectWuxingSkill==t[e].id);this.skillArr[e].setNew()}};t.prototype.showFive=function(){for(var t=0;t<5;t++){if(!this.shadows[t]){this.shadows[t]=new Laya.Image("res/assist/circle.png");this.shadows[t].anchorX=this.shadows[t].anchorY=.5}this.weizhis[t].addChild(this.shadows[t]);var e=game.Context.battleRoleList[t];if(e){if(!this.roleAvatarDatas[t]){this.roleAvatarDatas[t]=new avatar.AvatarData;this.roleAvatars[t]=new avatar.AvatarAnimation;this.roleAvatars[t].scaleX=1.5;this.roleAvatars[t].scaleY=1.5;this.weizhis[t].addChild(this.roleAvatars[t])}var i=void 0;var n=skin.SkinModel.getIns().getEquipSkinId(e.prof);var a=csv.SkinProxy.getIns().getCfg(n);if(a){i=a.modelres}else{i=csv.DefclassProxy.getIns().getCfg(e.prof).model}this.roleAvatarDatas[t].roleKey=i;this.roleAvatars[t].setAniData(this.roleAvatarDatas[t]);this.roleAvatars[t].setAni(avatar.AvatarAnimation.ANI_ENUMS.IDLE,0);this.roleAvatars[t].play();if(this.waitRoles[t]){this.waitRoles[t].removeSelf();this.waitRoles[t]=null}}else{if(!this.waitRoles[t]){this.waitRoles[t]=new Laya.Image("res/static/wuxing/bg_wuxing_jianying.png");this.waitRoles[t].anchorX=.5;this.waitRoles[t].anchorY=1}this.weizhis[t].addChild(this.waitRoles[t])}}};t.prototype.setGuajian=function(){chat.ChatStatic.dellGuajian(this.list,game.RoleModel.getIns().useGuajianIds,50);if(this._model.boGuajian){this.showGuajian()}};t.prototype.changeName=function(){var t=csv.MapProxy.getIns().getMapType(game.Context.mainRole.mapId);if(!csv.MapProxy.isFuncMap(t)){manager.FlowManager.instance.flowByStyle1(app.getLang("战斗中无法改名"));return}app.ViewManager.toggleDialog(gaiming.GaiMingView2,1,0)};t.prototype.setRoleName=function(){this.duiwuname.text=game.Context.clearPlayerName(game.Context.mainRole.playername)};t.SINGLE_KEY="equip.RoleWuxingView";return t}(ui.wuxing.wuxingjueseUI);a.RoleWuxingView=t})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t,e){this._role=t.role;if(this._role){this.labelnum.visible=true;this.bgshuzi.visible=true;this.labelnum.text=csv.ReBirthProxy.getIns().getTransLvl(this._role.level).toString();this.imglock.visible=false;this.imgtouxiang.visible=true;this.imgtouxiang.skin=this._role.getHeadIconUrl();if(this._role.tupoLv){var i=csv.LevelProxy.getIns().getHuluStyle(this._role.tupoLv);this.hulu.hulu.skin=csv.LevelProxy.HULU_ICONS[i.grade];this.dengji.text=this._role.tupoLv.toString()}else{this.hulu.visible=false;this.dengji.visible=false}this.zhanzi.visible=true;this.zhanshuzhi.visible=true;this.zhanshuzhi.value=game.MoneyModel.format(this._role.score)}else{this.labelnum.visible=false;this.bgshuzi.visible=false;this.imgtouxiang.visible=false;this.imglock.visible=true;this.hulu.visible=false;this.dengji.visible=false;this.zhanzi.visible=false;this.zhanshuzhi.visible=false}this.imgxuanzhong.visible=t.select};e.SINGLE_KEY="role.ShangZhenItem";return e}(ui.wuxing.wuxingduiwuitemUI);t.ShangZhenItem=e})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(i.ShangZhenItem)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.tihuanbtn.clickHandler=new Laya.Handler(this,this.onHandler)};e.prototype.onHandler=function(){if(this.sweepHandler){this.sweepHandler.runWith(this._role.prof)}};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t,e){this._role=t.role;this.tihuanbtn.visible=t.canSweep;this.zhenrongitem.setData(t,e)};e.SINGLE_KEY="role.ShangZhenItem";return e}(ui.wuxing.zhenrongtouxiangitem2UI);i.ShangZhenItem2=t})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listchuzhan.itemRender=i.ShangZhenItem2;this.listchuzhan.renderHandler=new Laya.Handler(this,this.onRenderHandler2);this.listchuzhan.scrollRectOffX=10;this.listchuzhan.scrollRectOffY=10;this.listbeizhan.itemRender=i.ShangZhenItem;this.listbeizhan.renderHandler=new Laya.Handler(this,this.onRenderHandler);this.listbeizhan.selectHandler=new Laya.Handler(this,this.onDownSelect);this.listbeizhan.selectEnable=true;this.listbeizhan.scrollRectOffX=10;this.listbeizhan.scrollRectOffY=10;game.HelperViewHandler.registerStr([this.shuominglab,this.shuomingbtn],"rule_des1","rule_battledes")};e.prototype.onRenderHandler=function(t,e){t.setData(t.dataSource,e)};e.prototype.onRenderHandler2=function(t,e){t.setData(t.dataSource,e);t.sweepHandler=new Laya.Handler(this,this.sweep)};e.prototype.onDownSelect=function(t){if(t==-1){return}if(this._downSelectDex==t){this._downArr[this._downSelectDex].select=false;this._downSelectDex=NaN}else{if(this._downArr[this._downSelectDex]){this._downArr[this._downSelectDex].select=false}this._downSelectDex=t;this._downArr[this._downSelectDex].select=true}if(!isNaN(this._downSelectDex)){for(var e=0,i=this._upArr.length;e<i;e++){this._upArr[e].canSweep=true}this.listchuzhan.refresh()}};e.prototype.sweep=function(t){if(!isNaN(this._downSelectDex)){game.Alert.show(app.getLang("zhenrong_change"),Laya.Handler.create(this,this.onOk,[t]))}};e.prototype.onOk=function(t){var e=[];for(var i=0,n=this._upArr.length;i<n;i++){var a=this._upArr[i].role.prof;if(t==a){a=this._downArr[this._downSelectDex].role.prof}e.push(a)}app.ProtocolRequest.SetInFightReq(e)};e.prototype.onDisplay=function(){game.RoleModel.getIns().on(game.RoleModel.EVENTS.SHANGZHEN_CHANGE,this,this.refreshAll);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){game.RoleModel.getIns().off(game.RoleModel.EVENTS.SHANGZHEN_CHANGE,this,this.refreshAll)};e.prototype.refreshAll=function(){this._downSelectDex=NaN;this.listbeizhan.selectedIndex=-1;this._upArr=[];for(var t=0,e=5;t<e;t++){var i={role:game.Context.battleRoleList[t],select:false,canSweep:false};this._upArr.push(i)}this.listchuzhan.array=this._upArr;this._downArr=[];for(var t=0,e=game.Context.waitRoleList.length;t<e;t++){var i={role:game.Context.waitRoleList[t],select:Boolean(this._downSelectDex==t)};this._downArr.push(i)}this.listbeizhan.array=this._downArr;this.listbeizhan.selectedIndex=0};e.SINGLE_KEY="role.ShangZhenView";return e}(ui.wuxing.zhenrongviewUI);i.ShangZhenView=t})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.gouxuan.clickHandler=new Laya.Handler(this,this.onHandler)};e.prototype.onHandler=function(){if(this.selectHandler){this.selectHandler.runWith(this._data.id)}};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t,e,i){this._data=t;var n=csv.SkillProxy.getIns().getSkillByKey(t.skill);if(!this._skillData){this._skillData=new SkillData}this._skillData.id=n.skillid;this._skillData.lv=n.level;var a=e.indexOf(t.id)!=-1;this._skillData["alive"]=a;this._skillData["alive_des"]=app.getLang(this._data.des);this.jineng.setData(this._skillData,false,false,true);if(a){this.xuanzhong.visible=i;this.gouxuan.selected=i;this.gouxuan.mouseEnabled=!i;this.heidi.visible=this.suoimg.visible=false}else{this.xuanzhong.visible=false;this.gouxuan.selected=false;this.gouxuan.disabled=true;this.heidi.visible=this.suoimg.visible=true}};e.prototype.setNew=function(){if(game.Context.newWuxingSkills.indexOf(this._data.id)!=-1){this.jineng.clickHandler=Laya.Handler.create(this,this.newClickBack);game.RedDotView.addTo(this,85,15,1,1,game.RedDotView.ENUM_TYPE.XIN)}else{this.jineng.clickHandler=null;game.RedDotView.removeFrom(this)}};e.prototype.newClickBack=function(){var t=game.Context.newWuxingSkills.indexOf(this._data.id);game.Context.newWuxingSkills.splice(t,1);game.SystemSetModel.getInstance().setValueByType(this._data.id,game.SettingType.wuxingSkillRed);this.jineng.clickHandler=null;game.RedDotView.removeFrom(this);if(!game.Context.newWuxingSkills.length){game.ClosureManager.removeXin(csv.FunctionsProxy.ENUMS.ROLE_WUXING)}};e.SINGLE_KEY="role.WuxingSkillItem";return e}(ui.wuxing.wuxingjinengitemUI);t.WuxingSkillItem=e})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(n){var t=function(i){__extends(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}t.prototype.initialize=function(){this.name="";i.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listliebiao.itemRender=n.WuxingTipItem;this.listliebiao.renderHandler=new Laya.Handler(this,this.onRender);this.initH=[];this.initY=[];this.totalH=this.height;this.compare=this.listliebiao.height;this.offSpH=[this.bg01,this.bg02,this.neibudibanimg01];for(var t=0,e=this.offSpH.length;t<e;t++){this.initH.push(this.offSpH[t].height)}this.offSpY=[this.bg04,this.imgzhuangshierji03,this.backbtn];for(var t=0,e=this.offSpY.length;t<e;t++){this.initY.push(this.offSpY[t].y)}};t.prototype.onRender=function(t,e){t.setData(t.dataSource)};t.prototype.onDisplay=function(){this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){};t.prototype.refreshAll=function(){var t=[];for(var e=1;e<=3;e++){var i=this.dataSource[e];var n=Attributes.getMaxValue(i);if(n){t.push({type:e,values:i,max:n})}}var a=t.length;this.listliebiao.array=t;var o=this.listliebiao.cells[0]?this.listliebiao.cells[0].height:0;var s=a*o+(a-1)*this.listliebiao.spaceY;if(s<this.compare){this.listliebiao.vScrollBarSkin="";this.listliebiao.height=s}else{this.listliebiao.vScrollBarSkin=" ";this.listliebiao.height=this.compare}var r=this.listliebiao.height-this.compare;for(var e=0,l=this.offSpH.length;e<l;e++){this.offSpH[e].height=this.initH[e]+r}for(var e=0,h=this.offSpY.length;e<h;e++){this.offSpY[e].y=this.initY[e]+r}this.height=this.totalH+r;this.y=(Laya.stage.height-this.height)/2;util.AniUtil.PopEffect(this)};t.SINGLE_KEY="role.WuxingTip";return t}(ui.wuxing.wuxingshuxinghuizongtipUI);n.WuxingTip=t})(role||(role={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var role;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.prgArr=[this.jindutiao1,this.jindutiao2,this.jindutiao3,this.jindutiao4,this.jindutiao5];this.labArr=[this.shuzhi1,this.shuzhi2,this.shuzhi3,this.shuzhi4,this.shuzhi5]};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){var e=Attributes.getPercents(t.values,t.max);this.namelab.text=app.getLang("wuxing_origin"+t.type);for(var i=0;i<e.length;i++){this.prgArr[i].value=e[i];this.labArr[i].text=t.values[i].toString()}};e.SINGLE_KEY="role.WuxingTipItem";return e}(ui.wuxing.wuxingshuxinghuizongitemUI);t.WuxingTipItem=e})(role||(role={}));var scene;(function(t){var i=game.Context;var e=function(){function a(){}a.registItem=function(t,e,i){if(a.itemRefMap[t]){console.log("duplicate type"+t)}var n=new o;n.type=t;n.voClass=e;n.viewClass=i;a.itemRefMap[t]=n};a.getVOByType=function(t,e){if(a.itemRefMap[t]){if(e){return new a.itemRefMap[t].voClass(e)}else{return new a.itemRefMap[t].voClass}}return null};a.initView=function(t){if(t==i.mainRole){return role.LeadingRoleView.getIns()}var e=new a.itemRefMap[t.getVoType()].viewClass;e.init(t);return e};a.itemRefMap={};return a}();t.SceneManager=e;var o=function(){function t(){}return t}()})(scene||(scene={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var game;(function(m){var c=boss.BossEvent;var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.worldBossArr=[csv.MapProxy.MAP_TYPE.WORLD_BOSS_OUT,csv.MapProxy.MAP_TYPE.KUAFU_BOSS_OUT,csv.MapProxy.MAP_TYPE.WORLD_BOSS_ICE];return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.init=function(){scene.SceneParser.init();scene.SceneManager.registItem(scene.SceneItemType.ROLE,role.RoleVO,role.RoleView);scene.SceneManager.registItem(scene.SceneItemType.NPC,role.NpcVO,role.NpcView);scene.SceneManager.registItem(scene.SceneItemType.MONSTER,role.MonsterVO,role.MonsterView);scene.SceneManager.registItem(scene.SceneItemType.ROBOT,role.RoleVO,role.RobotView);scene.SceneManager.registItem(scene.SceneItemType.PLAYER,role.PlayerRoleVO,role.PlayerRoleView);scene.SceneManager.registItem(scene.SceneItemType.GUARDPET,role.GuardPetVO,role.GuardPetView);scene.SceneManager.registItem(scene.SceneItemType.COLLECT,scene.CollectVO,scene.CollectView);scene.SceneManager.registItem(scene.SceneItemType.MACHINE,scene.TrapMachineVO,scene.TrapMachineView)};t.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.JoinNewMapNtf,this,this.onJoinNewMapNtf);this.addMsgListener(app.ProtocolResponse.TeleportAck,this,this.onTeleportAck);this.addMsgListener(app.ProtocolResponse.MoveResponse,this,this.onMoveResponse);this.addMsgListener(app.ProtocolResponse.UserViewAck,this,this.onUserViewAck);this.addMsgListener(app.ProtocolResponse.ViewportDestroyAck,this,this.onViewportDestroyAck);this.addMsgListener(app.ProtocolResponse.GuajiAck,this,this.onGuajiAck);this.addMsgListener(app.ProtocolResponse.SetPosistionResponse,this,this.onSetPosistionResponse);this.addMsgListener(app.ProtocolResponse.RoleStatusNtf,this,this.onRoleStatusNtf);this.addMsgListener(app.ProtocolResponse.PlayerGuildChangeNtf,this,this.onPlayerGuildChangeNtf);this.addMsgListener(app.ProtocolResponse.GuardIslandObjNtf,this,this.onGuardIslandObjNtf);this.addMsgListener(app.ProtocolResponse.MapObjFightNtf,this,this.onMapObjFightNtf);this.addMsgListener(app.ProtocolResponse.MapObjViewAck,this,this.onMapLandAndObjAck);this.addMsgListener(app.ProtocolResponse.UserViewHpAck,this,this.onUserViewHpAck);this.addMsgListener(app.ProtocolResponse.UserDeadRelieveNtf,this,this.onUserDeadRelieveNtf);this.addMsgListener(app.ProtocolResponse.SetSkinNtf,this,this.onSetSkinNtf);this.addMsgListener(app.ProtocolResponse.HomeDataNtf,this,this.onHomeDataNtf);this.addMsgListener(app.ProtocolResponse.AwardHomeAck,this,this.onAwardHomeAck)};t.prototype.onUserDeadRelieveNtf=function(t,e){role.LeadingRoleView.getIns().cancelCollect();app.ViewManager.toggleDialog(boss.BossWorldIceFuHuoView,1,0,e)};t.prototype.onSetSkinNtf=function(t,e){var i=scene.SceneMediator.getInstance().getViewById(e.objId);if(i){i.roleVO.classSkin=e.fasion;i.roleVO.soulStar=e.soulStar;i.roleVO.setskin=e.setskin;i.updataSkin()}};t.prototype.onMapObjFightNtf=function(t,e){var i=scene.SceneMediator.getInstance().huludaoRoleList;for(var n=0;n<i.length;n++){if(Uint64.equal(i[n].mapobj.id,e.objId)){i[n].mapobj.fightflag=e.fnum}}guardisland.GuardIslandsModel.getIns().event(guardisland.GuardIslandsModel.EVENT_UPDATA_MAP_ITEMS)};t.prototype.hasCollect=function(t){if(t){for(var e=0;e<t.length;e++){if(t[e].monsterType==guardisland.EGuardIslandType.Collect){return true}}}};t.prototype.bossIsDead=function(t){if(t){for(var e=0;e<t.length;e++){var i=t[e];if(i.isBoss){if(i.isDead()){return true}else{return false}}}}return true};t.prototype.onMapLandAndObjAck=function(t,e){var i=e.objViewportList[0].objtype;var n=e.objViewportList;var a=[];if(!scene.SceneMediator.getInstance().collectList||scene.SceneMediator.getInstance().collectList.length==0){if(i==m.LAND_OBJ_TYPE.BOSS_KUA_FU||i==m.LAND_OBJ_TYPE.BOSS_ICE){for(var o=0;o<n.length;o++){var s=n[o];if(s.x==0&&s.y==0){}else{var r=new scene.CollectVO(s);a.push(r)}}scene.SceneMediator.getInstance().collectList=a;scene.SceneMediator.getInstance().sceneCollectDataList=csv.NpcProxy.getIns().getMapCollectList(m.Context.mainRole.mapId)}else{console.warn("Null Type")}}else{if(i==m.LAND_OBJ_TYPE.BOSS_KUA_FU||i==m.LAND_OBJ_TYPE.BOSS_ICE){var l=scene.SceneMediator.getInstance().collectList;var h=[];for(var o=0;o<n.length;o++){for(var p=0;p<l.length;p++){if(Uint64.equal(n[o].id,l[p].insId)){var r=new scene.CollectVO(n[p]);l[o]=r}else{var r=new scene.CollectVO(n[p]);h.push(r);break}}}var u=scene.SceneMediator.getInstance().collectList.concat(h);scene.SceneMediator.getInstance().collectList=u;scene.SceneMediator.getInstance().sceneCollectDataList=csv.NpcProxy.getIns().getMapCollectList(m.Context.mainRole.mapId)}}boss.BossModel.getIns().collectsNum=scene.SceneMediator.getInstance().collectList.length;boss.BossModel.getIns().event(c.BOSS_UPDATE_COLLECT_NUM)};t.prototype.onGuardIslandObjNtf=function(t,e){if(e.mapobj&&e.mapobj.length>=0){var i=m.LAND_OBJ_TYPE.HU_LU_DAO;var n=e.mapobj;var a=[];if(i==m.LAND_OBJ_TYPE.HU_LU_DAO){for(var o=0;o<n.length;o++){var s=n[o];if(s.x==0&&s.y==0){}else{var r=new scene.HuLuDaooRoleVo(s);if(r.isBoss){guardisland.GuardIslandsModel.getIns().vo.updateBossBlood(s.curhp/s.maxhp)}a.push(r);guardisland.GuardIslandsModel.getIns().event(guardisland.GuardIslandsModel.EVENT_UPDATA_MAP_ONE_ITEMS,s)}}if(this.bossIsDead(a)){}else{if(!this.hasCollect(a)&&guardisland.GuardIslandsModel.getIns().vo){var l=csv.GuardIsandProxy.getIns().getCollectID(guardisland.GuardIslandsModel.getIns().vo.diff);if(l!=-1){var s=new ObjViewData;s.cfgid=l;var r=new scene.HuLuDaooRoleVo(s);a.push(r)}}}scene.SceneMediator.getInstance().huludaoRoleList=a;guardisland.GuardIslandsModel.getIns().showlist=guardisland.GuardIslandsModel.getIns().rebuildShowList();scene.SceneMediator.getInstance().sceneNpcDataList=csv.NpcProxy.getIns().getMapNpcList(m.Context.mainRole.mapId);guardisland.GuardIslandsModel.getIns().event(guardisland.GuardIslandsModel.EVENT_UPDATA_MAP_ITEMS);guardisland.GuardIslandsModel.getIns().event(guardisland.GuardIslandsModel.EVENT_UPDATE_AUTO_SEARCH)}else{console.warn("Null Type")}}};t.prototype.delByIns=function(t){var e=scene.SceneMediator.getInstance().huludaoRoleList;for(var i=0;i<e.length;i++){var n=e[i];if(Uint64.equal(t,n.mapobj.id)){scene.SceneMediator.getInstance().huludaoRoleList.splice(i,1);break}}guardisland.GuardIslandsModel.getIns().delByCollectUID(t)};t.prototype.delCollectByIns=function(t){var e=scene.SceneMediator.getInstance().collectList;for(var i=0;i<e.length;i++){var n=e[i];if(Uint64.equal(t,n.mapobj.id)){scene.SceneMediator.getInstance().collectList.splice(i,1);break}}};t.prototype.onTeleportAck=function(t,e){if(e.result==1){var i=csv.MapProxy.getIns().getMapType(m.Context.mainRole.mapId);guaji.GuajiModel.getIns().onBackHomeHandler(i==csv.MapProxy.MAP_TYPE.HOME)}};t.prototype.onJoinNewMapNtf=function(t,e){var i=battle.BattleManager.getIns();if(i.currControl&&i.currControl.boGame){i.currControl.stopGame(true)}m.Context.mainRole.mapId=e.mapid;m.Context.mainRole.mapId=e.mapid;m.Context.mainRole.posX=e.mapX;m.Context.mainRole.posY=e.mapY;m.Context.mainRole.dir=e.dir;m.Context.event(m.ContextEvent.CHANGE_MAP,e.mapid);scene.SceneMediator.getInstance().initScene(e.mapid);battle.BattleManager.getIns().currControl.checkReady()};t.prototype.onMoveResponse=function(t,e){if(csv.MapProxy.getIns().isNeedPosResponse(m.Context.mainRole.mapId)){var i=scene.SceneMediator.getInstance().getViewById(e.userId);if(i){var n=e.path[0];i.walkPosX=n.pX;i.walkPosY=n.pY;i.tryWalk()}}};t.prototype.onUserViewHpAck=function(t,e){if(csv.MapProxy.getIns().isNeedPosResponse(m.Context.mainRole.mapId)){if(!Uint64.equal(m.Context.mainRoleId,e.id)){var i=scene.SceneMediator.getInstance().getViewById(e.id);if(i){var n=i.roleVO;n.hp=0;n.maxhp=0;n.mp=0;n.maxmp=1;for(var a=0,o=e.rolehps.length;a<o;a++){var s=e.rolehps[a];n.hp+=s.curhp;n.maxhp+=s.maxhp}i.initHeadHpMp(true,false)}else{}}else{var r=scene.SceneMediator.getInstance().getViewById(e.id);for(var a=0,o=e.rolehps.length;a<o;a++){var s=e.rolehps[a];m.Context.roleMap[s.id.toString()].hp=s.curhp;m.Context.roleMap[s.id.toString()].maxhp=s.maxhp}var l=m.Context.battleRoleList[0];var h=l.hp;var p=l.maxhp;for(var a=0,o=m.Context.battleRoleList.length;a<o;a++){var u=m.Context.battleRoleList[a];m.Context.battleRoleList[0].hp+=u.hp;m.Context.battleRoleList[0].maxhp+=u.maxhp}r.initHeadHpMp(true,false);l.hp=h;l.maxhp=p;for(var a=0,o=m.Context.battleRoleList.length;a<o;a++){var u=m.Context.battleRoleList[a];m.Context.setRoleHp(u.insId)}}}};t.prototype.onUserViewAck=function(t,e){var i=m.Context.getMapType();if(csv.MapProxy.getIns().isNeedPosResponse(m.Context.mainRole.mapId)){for(var n=0,a=e.userViewportList.length;n<a;n++){var o=e.userViewportList[n];if(!Uint64.equal(m.Context.mainRoleId,o.id)){var s=role.PlayerRoleVO.recode(o);s.setShowInfo(o);s.battleCamp=1;s.boMainRole=true;var r=battle.BattleManager.getIns().createPlayerRole(s,o.x,o.y,o.dir);if(this.worldBossArr.indexOf(i)!=-1){s.hp=0;s.maxhp=0;s.mp=0;s.maxmp=1;for(var l=0,h=o.rolehps.length;l<h;l++){var p=o.rolehps[l];s.hp+=p.curhp;s.maxhp+=p.maxhp}r.initHeadHpMp(true,false)}r.walkPosX=o.tx;r.walkPosY=o.ty;r.tryWalk()}else{m.Context.mainRole.boShowHp=m.Context.mainRole.boShowMp=false;m.Context.mainRole.setShowInfo(o);m.Context.mainRole.battleCamp=1;m.Context.mainRole.boMainRole=true;var u=battle.BattleManager.getIns().createRole(m.Context.mainRole,o.x,o.y,o.dir);u.refreshView();if(this.worldBossArr.indexOf(i)!=-1){m.Context.mainRole.hp=0;m.Context.mainRole.maxhp=0;m.Context.mainRole.mp=0;m.Context.mainRole.maxmp=1;for(var c=0,g=o.rolehps.length;c<g;c++){var p=o.rolehps[c];m.Context.mainRole.hp+=p.curhp;m.Context.mainRole.maxhp+=p.maxhp}u.initHeadHpMp(true,false)}for(var f=0,d=m.Context.roleList.length;f<d;f++){var y=m.Context.roleList[f];for(var v=0,_=o.rolehps.length;v<_;v++){var p=o.rolehps[v];if(p&&Uint64.equal(p.id,y.insId)){y.hp=p.curhp;y.maxhp=p.maxhp;m.Context.setRoleHp(y.insId)}}}}}}};t.prototype.playend=function(t){scene.SceneMediator.getInstance().removeSceneItem(t);this.delByIns(t);this.delCollectByIns(t);scene.SceneMediator.getInstance().sceneNpcDataList=csv.NpcProxy.getIns().getMapNpcList(m.Context.mainRole.mapId);scene.SceneMediator.getInstance().sceneCollectDataList=csv.NpcProxy.getIns().getMapCollectList(m.Context.mainRole.mapId)};t.prototype.onViewportDestroyAck=function(t,e){var i=m.Context.getMapType();if(csv.MapProxy.getIns().isNeedPosResponse(m.Context.mainRole.mapId)){for(var n=0;n<e.objIds.length;++n){if(i==csv.MapProxy.MAP_TYPE.WORLD_BOSS_ICE||i==csv.MapProxy.MAP_TYPE.KUAFU_BOSS_OUT){this.collectRemove(e.objIds[n])}var a=scene.SceneMediator.getInstance().getViewById(e.objIds[n]);if(!a){return}if(a instanceof role.RoleView){a.removeGuardPet()}if(a instanceof role.NpcView){a.npcVo.control.dieAni(new Laya.Handler(this,this.playend,[e.objIds[n]]))}else if(a instanceof scene.CollectView){a.playDieWithAni(new Laya.Handler(this,this.playend,[e.objIds[n]]))}else{this.playend(e.objIds[n])}}}};t.prototype.collectRemove=function(t){var e=scene.SceneMediator.getInstance().collectList;for(var i=0;i<e.length;i++){if(Uint64.equal(t,e[i].mapobj.id)){boss.BossModel.getIns().collectsNum-=1;boss.BossModel.getIns().event(c.BOSS_UPDATE_COLLECT_NUM)}}};t.prototype.onRoleStatusNtf=function(t,e){var i=scene.SceneMediator.getInstance().getViewById(e.objId);if(i){switch(e.ctype){case 1:i.roleVO.isInBattle=Boolean(e.cval==1);break;case 2:i.roleVO.zuoqiId=e.cval;i.updataMount();break;case 3:i.roleVO.classSkin=e.cval;i.updataSkin();break;case 4:i.roleVO.headTitle=e.cval;i.updateHeadTitle();break;case 5:i.roleVO.guardId=e.cval;i.updataGuardPet();break;case 6:i.roleVO.usetitle=e.cval;i.updateTitle();break;case 7:i.roleVO.boGuildOwner=Boolean(e.cval==1);i.updateFamilyName();break;case 8:i.roleVO.uplv=e.cval;i.updataSkin();break;case 9:i.roleVO.soulStar=e.cval;i.updataSkin();break}}};t.prototype.onPlayerGuildChangeNtf=function(t,e){var i=scene.SceneMediator.getInstance().getViewById(e.playerID);if(i){i.roleVO.guildName=e.guildName;i.updateFamilyName()}};t.prototype.onGuajiAck=function(t,e){Laya.Dialog.closeAll()};t.prototype.onSetPosistionResponse=function(t,e){if(m.Context.custMapID!=undefined){return}var i=csv.MapProxy.getIns().isNeedPosResponse(m.Context.mainRole.mapId);if(i){var n=scene.SceneMediator.getInstance().getViewById(e.userId);if(n instanceof role.PlayerRoleView){n.vo.posX=e.x;n.vo.posY=e.y;n.walkPosX=null;n.walkPosY=null;n.isoPosX=e.x*32;n.isoPosZ=e.y*32;n.setRoleAni(n.currentAniName,e.dir);n.stopMove(true)}}};t.prototype.onChangeNameNoti=function(t,e){scene.SceneMediator.getInstance().onPlayerNameChange(e);m.RoleModel.getIns().event(m.RoleModel.EVENTS.PLAYER_NAME_CHANGE)};t.prototype.onHomeDataNtf=function(t,e){m.HomeEventModel.getInstance().onHomeDataNtf(e)};t.prototype.onAwardHomeAck=function(t,e){m.HomeEventModel.getInstance().onAwardHomeAck(e)};t.SINGLE_KEY="game.scene.SceneModule";return t}(app.ModuleBase);m.SceneModule=t})(game||(game={}));var game;(function(s){var t=function(){function t(){this._frameTime1=0;this._cacheTimes=[]}t.getInstance=function(){return app.Singleton.getInstance(t)};t.prototype.onFrameFrequency=function(){if(this._frameTime1==0){this._frameTime1=(new Date).getTime()}else{var t=(new Date).getTime();var e=t-this._frameTime1;if(this._cacheTimes.length==60){var i=0;for(var n=0;n<60;n++){i+=this._cacheTimes[n]}var a=i/60;if(a>50){var o=s.SystemSetModel.getInstance()}else{}this._cacheTimes.length=0}else{}this._cacheTimes.push(e);this._frameTime1=t}};t.SINGLE_KEY="GameFrameFrequency";return t}();s.GameFrameFrequency=t})(game||(game={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("gardenevent.csv");this.cfgMap=t.getMap("eventid")};e.SINGLE_KEY="csv.GardenEventProxy";return e}(app.ModelBase);t.GardenEventProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var game;(function(n){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.npcArray=[];return t}t.getInstance=function(){return app.Singleton.getInstance(t)};t.prototype.init=function(){csv.FunctionsProxy.getIns().on(csv.FunctionsProxy.EVENTS.ADD,this,this.onFuncOpen)};t.prototype.onHomeDataNtf=function(e){var i=this;this.resp=e;console.log(this.resp);var t=this.info!=undefined;if(this.info){this.info.einf.forEach(function(t){if(!(t.eventid in e.einf)){}})}this.info=new a;this.info.nextcd=e.nextcd;this.info.dailynum=e.dailynum;e.einf.forEach(function(t){var e=new o;e.eventid=t.eventid;e.eflag=t.eflag;i.info.einf[e.eventid]=e});if(t){Laya.timer.once(5e3,this,function(){i.tryRefreshNPC()})}};t.prototype.onAwardHomeAck=function(t){if(this.info){if(t.ret!=1){n.Alert.show("onAwardHomeAck "+t.ret+" "+t.eventid);this.printInfo()}this.removeNPC(t.eventid)}};t.prototype.tryRefreshNPC=function(){var a=this;if(csv.MapProxy.getIns().getMapType(n.Context.mainRole.mapId)!=csv.MapProxy.MAP_TYPE.HOME)return;this.info.einf.forEach(function(t){if(a.canShowEventNPC(t.eventid)){var e=scene.SceneMediator.getInstance().refreshHomeEventNPC(a.getNpcID(t.eventid));e.visible=true;var i=e.vo;var n=i.control;n.headView.lblName.text=app.getLang(i.getCfg().npcname);a.npcArray[e.vo.insId.toString()]=e}})};t.prototype.removeNPC=function(t){var e=csv.NpcProxy.getIns().getNpcVO(this.getNpcID(t)).insId;scene.SceneMediator.getInstance().removeSceneItem(e)};t.prototype.onFuncOpen=function(t){if(t.id==csv.FunctionsProxy.ENUMS.HOME_EVENT){this.tryRefreshNPC()}};t.prototype.canShowEventNPC=function(t){return csv.FunctionsProxy.getIns().isOpen(csv.FunctionsProxy.ENUMS.HOME_EVENT)&&this.info&&this.info.einf[t]&&this.info.einf[t].eflag==0};t.prototype.getNpcID=function(t){if(csv.GardenEventProxy.getIns().cfgMap[t]){return csv.GardenEventProxy.getIns().cfgMap[t].npcid}return 0};t.prototype.getEventIDByNpcID=function(t){if(this.info){for(var e in this.info.einf){if(csv.GardenEventProxy.getIns().cfgMap[this.info.einf[e].eventid].npcid==t){return this.info.einf[e].eventid}}}return 0};t.prototype.printInfo=function(){if(this.info){var e="";this.info.einf.forEach(function(t){e+=" "+t.eventid});console.log(e);console.log(" dailynum "+this.info.dailynum);console.log(util.TimeUtil.formatDate(n.Context.getServerTime(),true,true,true,true));console.log(util.TimeUtil.formatDate(this.info.nextcd,true,true,true,true))}else{console.log("no NTF")}};t.prototype.printResp=function(){if(this.resp){var e="";this.resp.einf.forEach(function(t){e+=" "+t.eventid});console.log(e);console.log(" dailynum "+this.resp.dailynum);console.log(util.TimeUtil.formatDate(n.Context.getServerTime(),true,true,true,true));console.log(util.TimeUtil.formatDate(this.resp.nextcd,true,true,true,true))}else{console.log("no NTF")}};t.prototype.fake=function(t){var i=this;this.info=new a;this.info.nextcd=n.Context.getServerTime()+600;t.forEach(function(t){var e=new o;e.eventid=t;e.eflag=0;e.fake=true;i.info.einf[e.eventid]=e});this.tryRefreshNPC()};t.SINGLE_KEY="game.HomeEventModel";return t}(app.ModelBase);n.HomeEventModel=t;var a=function(){function t(){this.einf=[]}return t}();var o=function(){function t(){this.fake=false}return t}()})(game||(game={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.walkTypeArr=[csv.MapProxy.MAP_TYPE.HOME,csv.MapProxy.MAP_TYPE.WORLD_BOSS_OUT,csv.MapProxy.MAP_TYPE.HULU_DAO,csv.MapProxy.MAP_TYPE.KUAFU_BOSS_OUT,csv.MapProxy.MAP_TYPE.WORLD_BOSS_ICE,csv.MapProxy.MAP_TYPE.DUJIE_OUT];return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.init=function(){this.cfgMap={};var t=app.Config.getResById("map.csv");if(!t){return}this.cfgMap=t.getMap("mapid")};t.prototype.getCfg=function(t){return this.cfgMap[t]};t.prototype.getNode=function(){var t=this.getCfg(game.Context.mainRole.mapId);if(!t||!t.patrolxy){return null}if(!t.patrolxys){t.patrolxys=app.str2Array(t.patrolxy,";","-")}if(!scene.SceneMediator.getInstance().mapGrid){return null}var e=scene.SceneMediator.getInstance().mapGrid.getNode(t.patrolxys[0][0],t.patrolxys[0][1]);t.patrolxys.push(t.patrolxys.shift());Math.random()>.6?t.patrolxys.push(t.patrolxys.shift()):null;Math.random()>.5?t.patrolxys.push(t.patrolxys.shift()):null;return e};t.prototype.getMapRightshow=function(t){var e=this.cfgMap[t];var i=e.rightshow;if(i==undefined){return 0}return i};t.prototype.getMapRevive=function(t){var e=this.cfgMap[t];return e.revive===1};t.prototype.getMapType=function(t){var e=this.cfgMap[t];var i=1;if(e!=null){i=e["type"]}return i};t.prototype.getMapBlesson=function(t){var e=this.cfgMap[t];return e.blesson===1};t.prototype.getQuickbattlebuff=function(t){var e=this.cfgMap[t];return e.quickbattlebuff===1};t.prototype.getClickUrl=function(){var t="";var e=csv.MapProxy.getIns().getMapType(game.Context.mainRole.mapId);switch(e){case csv.MapProxy.MAP_TYPE.HOME:t="res/atlas/ani/skill/skill_juesexuanzhong02.atlas";break;default:t="res/atlas/ani/skill/skill_juesexuanzhong01.atlas"}return t};t.prototype.isMove=function(t){var e=this.cfgMap[t];if(e&&parseInt(e.click)==1){return true}return false};t.prototype.isNeedPosResponse=function(t){var e=this.getMapType(t);return this.walkTypeArr.indexOf(e)!=-1};t.prototype.checkSameMapTypoe=function(t){var e=csv.MapProxy.getIns().getMapType(game.Context.mainRole.mapId);if(e==t){return true}return false};t.isFuncMap=function(t){t=t|csv.MapProxy.getIns().getMapType(game.Context.mainRole.mapId);if(t==csv.MapProxy.MAP_TYPE.HOME||t==csv.MapProxy.MAP_TYPE.GUAJI){return true}return false};t.isNoJumpMap=function(t){t=t|csv.MapProxy.getIns().getMapType(game.Context.mainRole.mapId);if(t==csv.MapProxy.MAP_TYPE.WORLD_BOSS_IN||t==csv.MapProxy.MAP_TYPE.KUAFU_BOSS_IN){return true}return false};t.isInKuaFuMap=function(){var t=csv.MapProxy.getIns().getMapType(game.Context.mainRole.mapId);if(t==csv.MapProxy.MAP_TYPE.KUAFU_BOSS_OUT||t==csv.MapProxy.MAP_TYPE.KUAFU_BOSS_IN){return true}return false};t.isInIceMap=function(){var t=csv.MapProxy.getIns().getMapType(game.Context.mainRole.mapId);if(t==csv.MapProxy.MAP_TYPE.WORLD_BOSS_ICE||t==csv.MapProxy.MAP_TYPE.WORLD_BOSS_ICE_FIGHT){return true}return false};t.isInDuJieIceMap=function(){var t=csv.MapProxy.getIns().getMapType(game.Context.mainRole.mapId);if(t==csv.MapProxy.MAP_TYPE.DUJIE_OUT){return true}return false};t.LeadRoleIsInCustomTypeArea=function(t){return scene.SceneMediator.getInstance().getStatus(role.LeadingRoleView.getIns().vo.posX,role.LeadingRoleView.getIns().vo.posY,t)};t.anyPosIsInCustomTypeArea=function(t,e,i){if(i===void 0){i=true}if(i){return scene.SceneMediator.getInstance().getStatus(Math.floor(t.x/32),Math.floor(t.y/32),e)}return scene.SceneMediator.getInstance().getStatus(t.x,t.y,e)};t.SINGLE_KEY="csv.MapProxy";t.MAP_TYPE={HOME:1,WORLD_BOSS_OUT:2,GUAJI:3,BOSS:4,WORLD_BOSS_IN:5,KUAFU_BOSS_OUT:6,KUAFU_BOSS_IN:7,DUNGEON:9,PATA:10,PVP:11,HULU_DAO:12,HULU_DAO_BOSS:13,HULU_DAO_MONSTER:14,WORLD_BOSS_ICE:15,WORLD_BOSS_ICE_FIGHT:16,DUJIE_OUT:17,GUILD_BOSS:19};return t}(app.ModelBase);t.MapProxy=e})(csv||(csv={}));var scene;(function(t){var e=function(){function t(){}t.CARMERA="0";t.ROLE="1";t.NPC="2";t.MONSTER="3";t.PET="4";t.PLAYER="6";t.ROBOT="7";t.GUARDPET="8";t.ROLE_SHADE="9";t.COLLECT="10";t.MACHINE="11";return t}();t.SceneItemType=e})(scene||(scene={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var game;(function(a){var t;(function(t){t[t["OtherPlayerCollect"]=3452]="OtherPlayerCollect";t[t["CollectFail"]=3453]="CollectFail";t[t["CollectFar"]=3454]="CollectFar"})(t=a.ERROR_TIP_CODE||(a.ERROR_TIP_CODE={}));var e;(function(t){t[t["HU_LU_DAO"]=1]="HU_LU_DAO";t[t["BOSS_KUA_FU"]=2]="BOSS_KUA_FU";t[t["BOSS_ICE"]=3]="BOSS_ICE";t[t["DUJIE_TRAP"]=4]="DUJIE_TRAP"})(e=a.LAND_OBJ_TYPE||(a.LAND_OBJ_TYPE={}));var i=function(t){__extends(y,t);function y(){return t!==null&&t.apply(this,arguments)||this}y.getInstance=function(){return app.Singleton.getInstance(y)};y.prototype.init=function(){};y.prototype.teleportRequest=function(t,e){app.ProtocolRequest.TeleportReq(t);return true};y.prototype.EnterBossMapRequest=function(t,e){app.ProtocolRequest.EnterBossMapReq(t);return true};y.random=function(t,e){return Math.floor(Math.random()*(e-t)+t)};y.getRolePosList=function(t,e,i,n){if(i===void 0){i=2}t=Number(t);e=Number(e);var a=[];if(i==-1){i=Math.floor(Math.random()*8)}var o=isometric.IsoUtils.isoToScreen(new isometric.Point3D(t*32,0,e*32));n=n?n:Math.PI/4*(1-i);for(var s=1;s<=6;s++){var r=y.roleOffPos[s];var l=-r[0];var h=r[1];var p=Math.atan2(h,l);var u=Math.sqrt(l*l+h*h);var c=o.x+Math.cos(n+p)*u*96;var g=o.y+Math.sin(n+p)*u*96;var f=isometric.IsoUtils.screenToIso(new Laya.Point(c,g));var d=new v;d.pX=Math.round(f.x/32);d.pY=Math.round(f.z/32);d.pDir=i;d.pos=s;a.push(d)}return a};y.lineUpTeam=function(t,e,i){var n=this.teamrank[t+"_"+e];var a=[];for(var o=0;o<t;o++){var s=n[o];var r=i[s-1];var l=new v;l.pos=s;l.pX=r.pX;l.pY=r.pY;l.pDir=r.pDir;a.push(l)}return a};y.getMonsterPosList=function(t,e,i){var n=[];var a=Math.PI/4*(1-i);var o=isometric.IsoUtils.isoToScreen(new isometric.Point3D(t*32,0,e*32));for(var s=0;s<15;s++){var r=new Point2D;var l=-Math.floor(s/5);var h=s%5-2;var p=Math.atan2(h,l);var u=Math.sqrt(l*l+h*h);var c=o.x+Math.cos(a+p)*u*96;var g=o.y+Math.sin(a+p)*u*64;var f=isometric.IsoUtils.screenToIso(new Laya.Point(c,g));r.pX=Math.round(f.x/32);r.pY=Math.round(f.z/32);r.pDir=i;n.push(r)}return n};y.randomMonsterPosArr=function(t,e,i,n){if(n===void 0){n=3}var a=[];var o=[];for(var s=t-n;s<=t+n;s+=n){for(var r=e-n;r<=e+n;r+=n){if(!scene.SceneMediator.getInstance().checkCanMove(s,r)){continue}var l=new Point2D;l.pX=s;l.pY=r;o.push(l)}}while(a.length<i){var h=Math.floor(Math.random()*o.length);var l=o.splice(h,1)[0];var p=Math.floor(Math.random()*8);if(l){l.pDir=p}else{l=new Point2D;l.pX=t;l.pY=e;l.pDir=p}a.push(l)}return a};y.summonMonsterPosArr=function(t,e,i,n,a){if(a===void 0){a=3}var o=[];var s=[];for(var r=t-a;r<=t+a;r+=a){for(var l=e-a;l<=e+a;l+=a){if(!scene.SceneMediator.getInstance().checkCanMove(r,l)||scene.SceneMediator.getInstance().checkStandUsed(null,r,l)){continue}var h=new Point2D;h.pX=r;h.pY=l;s.push(h)}}if(s.length<n){for(var p=0,u=s.length;p<u;p++){var h=new Point2D;h.pX=s[p].pX;h.pY=s[p].pY;s.push(h)}}while(o.length<n){var c=Math.floor(Math.random()*s.length);var h=s.splice(c,1)[0];if(h){h.pDir=i}else{h=new Point2D;h.pX=t;h.pY=e;h.pDir=i}o.push(h)}return o};y.getDirByTowPos=function(t,e,i,n){var a=new isometric.Point3D(t*32,0,e*32);var o=new isometric.Point3D(i*32,0,n*32);var s=isometric.IsoUtils.isoToScreen(a);var r=isometric.IsoUtils.isoToScreen(o);return this.getDirByTowPoint(s.x,s.y,r.x,r.y)};y.getPosByTowPos=function(t,e,i,n,a,o){if(o===void 0){o=true}var s=new isometric.Point3D(t*32,0,e*32);var r=new isometric.Point3D(i*32,0,n*32);var l=isometric.IsoUtils.isoToScreen(s);var h=isometric.IsoUtils.isoToScreen(r);var p=Math.atan2(h.y-l.y,h.x-l.x);var u;var c;if(o){u=l.x+Math.cos(p)*a;c=l.y+Math.sin(p)*a}else{u=h.x+Math.cos(p)*a;c=h.y+Math.sin(p)*a}var g=isometric.IsoUtils.screenToIso(new Laya.Point(u,c));return new Laya.Point(Math.round(g.x/32),Math.round(g.z/32))};y.getSceenAngleByTowPos=function(t,e,i,n){var a=new isometric.Point3D(t*32,0,e*32);var o=new isometric.Point3D(i*32,0,n*32);var s=isometric.IsoUtils.isoToScreen(a);var r=isometric.IsoUtils.isoToScreen(o);return Math.atan2(r.y-s.y,r.x-s.x)};y.getSceenByTowPos=function(t,e,i,n,a,o){if(o===void 0){o=true}var s=new isometric.Point3D(t*32,0,e*32);var r=new isometric.Point3D(i*32,0,n*32);var l=isometric.IsoUtils.isoToScreen(s);var h=isometric.IsoUtils.isoToScreen(r);var p=Math.atan2(h.y-l.y,h.x-l.x);var u;var c;if(o){u=l.x+Math.cos(p)*a;c=l.y+Math.sin(p)*a}else{u=h.x+Math.cos(p)*a;c=h.y+Math.sin(p)*a}return new Laya.Point(u,c)};y.getDirByTowPoint=function(t,e,i,n){var a=Math.atan2(n-e,i-t)-3*Math.PI/8;if(a>=0){a-=Math.PI*2}var o=Math.floor(-a/(Math.PI/4));if(o>=8||o<0){o=0}return o};y.getJumpDirByTowPos=function(t,e,i,n){var a=new isometric.Point3D(t*32,0,e*32);var o=new isometric.Point3D(i*32,0,n*32);var s=isometric.IsoUtils.isoToScreen(a);var r=isometric.IsoUtils.isoToScreen(o);return this.getJumpDirByTowPoint(s.x,s.y,r.x,r.y)};y.getJumpDirByTowPoint=function(t,e,i,n){var a=Math.atan2(n-e,i-t);if(a>=-Math.PI/2&&a<=Math.PI/2){return 1}return 5};y.getDisByTowPos=function(t,e,i,n){var a=new isometric.Point3D(t*32,0,e*32);var o=new isometric.Point3D(i*32,0,n*32);var s=isometric.IsoUtils.isoToScreen(a);var r=isometric.IsoUtils.isoToScreen(o);return this.getDisByTowPoint(s.x,s.y,r.x,r.y)};y.getDisByTowPoint=function(t,e,i,n){var a=i-t;var o=n-e;return Math.sqrt(a*a+o*o)};y.getFrontPos=function(t,e,i,n){var a=-Math.PI/4*i;var o=new Point2D;o.pX=Math.round(t+Math.cos(a)*n);o.pY=Math.round(e+Math.sin(a)*n);o.pDir=this.getDiffDir(i);return o};y.getDiffDir=function(t){return(t+4)%8};y.getAttackDir=function(t,e,i,n){var a=Math.atan2(n-e,i-t);var o=0;if(a>=0&&a<Math.PI/2){o=0}else if(a>=Math.PI/2&&a<=Math.PI){o=6}else if(a>=-Math.PI/2&&a<0){o=2}else if(a>=-Math.PI&&a<-Math.PI/2){o=4}return o};y.getSelfDir=function(t){if(t==1){t=0}else if(t==3){t=2}else if(t==5){t=4}else if(t==7){t=6}return t};y.getMountDir=function(t){var e=0;switch(t){case 0:case 1:case 6:case 7:e=0;break;default:e=2}return e};y.getSimpleDir=function(t){var e=t;switch(t){case 1:e=0;break;case 3:e=2;break;case 5:e=6;case 7:e=0;break}return e};y.interpolate=function(t,e,i){var n=Math.atan2(t.y-e.y,t.x-e.x);var a=e.distance(t.x,t.y);var o=e.x+Math.cos(n)*a*i;var s=e.y+Math.sin(n)*a*i;return new Laya.Point(o,s)};y.checkReachPos=function(t,e,i,n,a){if(a===void 0){a=1}if(Math.abs(t-i)<=a&&Math.abs(e-n)<=a){return true}return false};y.checkPosInRect=function(t,e,i,n,a,o){var s=Math.min(i,a);var r=Math.max(i,a);var l=Math.min(n,o);var h=Math.max(n,o);if(t>=s&&t<=r&&e>=l&&e<=h){return true}return false};y.isLineIntersectRectangle=function(t,e,i,n,a,o,s,r){var l=e-n;var h=i-t;var p=t*n-i*e;if(l*a+h*o+p>=0&&l*s+h*r+p<=0||l*a+h*o+p<=0&&l*s+h*r+p>=0||l*a+h*r+p>=0&&l*s+h*o+p<=0||l*a+h*r+p<=0&&l*s+h*o+p>=0){if(a>s){var u=a;a=s;s=u}if(o<r){var c=o;o=r;r=c}if(t<a&&i<a||t>s&&i>s||e>o&&n>o||e<r&&n<r){return false}else{return true}}else{return false}};y.createAllScreenSp=function(t,e,i,n){if(t===void 0){t=0}if(e===void 0){e=.5}if(i===void 0){i=app.AppContainer.zhezhaoLayer}if(n===void 0){n=100}this._screenState=t;if(!this.allScreenSp){this.allScreenSp=new Laya.Sprite;this._screenBg=new Laya.Sprite;this._screenBg.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,a.STYLES.BLACK_COLOR);this.allScreenSp.width=this._screenBg.width=Laya.stage.width;this.allScreenSp.height=this._screenBg.height=Laya.stage.height;this.allScreenSp.addChild(this._screenBg);this.allScreenSp.on(Laya.Event.CLICK,this,this.onClick)}this.allScreenSp.zOrder=n;this._screenBg.alpha=e;i.addChild(this.allScreenSp)};y.onClick=function(t){t.stopPropagation();if(this._screenState==y.ENUM_ALL_SCREEN.KUNGFU){manager.FlowManager.instance.flowByStyle1("传功中...")}else if(this._screenState==y.ENUM_ALL_SCREEN.JJC){}else if(this._screenState==y.ENUM_ALL_SCREEN.STORY){}else if(this._screenState==y.ENUM_ALL_SCREEN.MOBAI){manager.FlowManager.instance.flowByStyle1("膜拜中...")}else if(this._screenState==y.ENUM_ALL_SCREEN.GONGFEN){manager.FlowManager.instance.flowByStyle1("供奉中...")}};y.clearAllScreenSp=function(){if(this.allScreenSp&&this.allScreenSp.parent){this.allScreenSp.removeSelf()}};y.drawHole=function(t,e,i,n,a){if(!this._holeMask){this._holeMask=new Laya.Sprite;this._holeMask.width=Laya.stage.width;this._holeMask.height=Laya.stage.height;this._holeMask.zOrder=app.AppContainer.LAYER_NUME.CHAT_MASK;this._hole=new Laya.Sprite;this._holeMask.on(Laya.Event.CLICK,this,this.onHoleClick)}this._hole.graphics.clear();this._hole.graphics.drawRect(0,0,Laya.stage.width,e,0);this._hole.graphics.drawRect(0,e,t,n,0);this._hole.graphics.drawRect(t+i,e,Laya.stage.width-t-i,n,0);this._hole.graphics.drawRect(0,e+n,Laya.stage.width,Laya.stage.height-e-n,0);var o=new Laya.HitArea;o.hit=this._hole.graphics;this._holeMask.hitArea=o;this._handler=a;Laya.stage.addChild(this._holeMask);Laya.stage.updateZOrder()};y.onHoleClick=function(t){t.stopPropagation();if(this._handler){this._handler.run()}};y.clearHole=function(){this._holeMask&&this._holeMask.removeSelf()};y.prototype.walkEndHandler=function(t){var e=scene.SceneMediator.getInstance().getViewById(t.insId);if(e){if(e.npcVo.control instanceof role.NpcBossHldControl){e.npcVo.control.doAction()}else if(e.npcVo.control instanceof role.NpcCollectHldControl){e.npcVo.control.doAction()}}};y.prototype.onAddHandler=function(t){if(Uint64.equal(t.insId,this.curVo.insId)){var e=scene.SceneMediator.getInstance().getViewById(t.insId);e.setClickView(csv.MapProxy.getIns().getClickUrl())}};y.prototype.goto=function(t){if(scene.ClickEffect.getIns().posView){scene.ClickEffect.getIns().posView.removeClickView()}var e=scene.SceneMediator.getInstance().getViewById(t.insId);if(e){e.npcVo.control.doClick()}else{this.curVo=t;this.on(a.SceneModel.EVENT_ADD_ITEM,this,this.onAddHandler);role.LeadingRoleView.getIns().aiTalk(t,ai.NpcTalkAI.ENUM_TYPE.CALL,new Laya.Handler(this,this.walkEndHandler,[t]))}};y.SINGLE_KEY="game.SceneModel";y.EVENT_ERROR_TIP="EVENT_ERROR_TIP";y.EVENT_TOUCH_ROCKET="EVENT_TOUCH_ROCKET";y.EVENT_DRAW_PATH="EVENT_DRAW_PATH";y.EVENT_ADD_ITEM="EVENT_ADD_ITEM";y.EVENT_CLICK="EVENT_CLICK";y.EVENT_REMOVE="EVENT_REMOVE";y.roleOffPos={1:[0,-1],2:[0,0],3:[0,1],4:[2,-1],5:[2,0],6:[2,1]};y.teamrank={"1_0":[2],"1_1":[5],"2_0":[1,3],"2_1":[2,5],"2_2":[4,6],"3_0":[1,2,3],"3_1":[1,3,5],"3_2":[2,4,6],"3_3":[4,5,6],"4_0":[1,2,3,5],"4_1":[1,2,3,5],"4_2":[1,3,4,6],"4_3":[2,4,5,6],"4_4":[2,4,5,6],"5_0":[1,2,3,4,6],"5_1":[1,2,3,4,6],"5_2":[1,2,3,4,6],"5_3":[1,3,4,5,6],"5_4":[1,3,4,5,6],"5_5":[1,3,4,5,6]};y.ENUM_ALL_SCREEN={KUNGFU:1,JJC:2,STORY:3,MOBAI:4,SKILL:5,GONGFEN:6};return y}(app.ModelBase);a.SceneModel=i;var v=function(){function t(){}return t}();a.TeamPoint=v})(game||(game={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var scene;(function(i){var t=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t._count=1;t.isoType=isometric.IsoType.OBJECTS_TYPE;t.animator=new Laya.Animation;t.on(Laya.Event.DISPLAY,t,t.onDisplay);t.on(Laya.Event.UNDISPLAY,t,t.onUnDisplay);return t}t.getIns=function(){return app.Singleton.getInstance(i.ClickPosView)};t.prototype.onDisplay=function(){Laya.timer.loop(500,this,this.doCount)};t.prototype.onUnDisplay=function(){Laya.timer.clear(this,this.doCount)};t.prototype.setClickType=function(t){this.animator.loadAtlas(t,Laya.Handler.create(this,this.onAniComplete))};t.prototype.doCount=function(){this._count--;if(this._count<0){i.SceneMediator.getInstance().getIsoWorld().removeIsoChild(t.getIns())}};t.prototype.onAniComplete=function(){this.isoDisplay.addChild(this.animator);this.animator.interval=100;this.animator.play();var t=this.animator.getGraphicBounds();this.animator.pivot(t.width*.5,t.height*.5)};t.prototype.recount=function(){this._count=1};t.SINGLE_KEY="scene.ClickPosView";return t}(isometric.IsoSprite);i.ClickPosView=t})(scene||(scene={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var scene;(function(i){var t=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t.canstop=true;t.on(Laya.Event.DISPLAY,t,t.onDisplay);t.on(Laya.Event.UNDISPLAY,t,t.onUnDisplay);t.interval=100;return t}t.getIns=function(){return app.Singleton.getInstance(i.ClickEffect)};t.prototype.setUrl=function(t,e){if(this.posView==t){return}if(this.posView){this.posView.off(Laya.Event.UNDISPLAY,this,this.remove)}t.on(Laya.Event.UNDISPLAY,this,this.remove);this.posView=t;this.loadAtlas(e,Laya.Handler.create(this,this.onAniComplete))};t.prototype.remove=function(){this.posView=null;this.removeSelf()};t.prototype.onDisplay=function(){};t.prototype.onUnDisplay=function(){};t.prototype.onAniComplete=function(){if(this.posView){this.posView.addChildAt(this,0)}this.play();var t=this.getGraphicBounds();this.pivot(t.width*.5,t.height*.5)};t.SINGLE_KEY="scene.ClickEffect";return t}(Laya.Animation);i.ClickEffect=t})(scene||(scene={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var scene;(function(t){var e=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.boTouch=false;t.boFirst=false;t.multX=0;t.multY=0;t.offset=0;t.endPoint=new Laya.Point;t.moveRadius=80;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.hideHandler=new Laya.Handler(this,this.hide)};t.prototype.onDisplay=function(){this.alpha=1;this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){Laya.timer.clear(this,this.loopmove)};t.prototype.refreshAll=function(){this.x=this.dataSource[0];this.y=this.dataSource[1];this.touchBeginHandler(this.x,this.y);this.loopmove();Laya.timer.loop(100,this,this.loopmove)};t.prototype.loopmove=function(){var t=role.LeadingRoleView.getIns();var e=t.x+64*this.multX;var i=t.y+64*this.multY;var n=isometric.IsoUtils.screenToIso(new Laya.Point(e,i));var a=Math.round(n.x/32);var o=Math.round(n.z/32);if(this._lastX==a&&this._lastY==o){return}t.move(a,o);this._lastX=a;this._lastY=o};t.prototype.touchBeginHandler=function(t,e){this.touchX=t;this.touchY=e;this.boTouch=true;this.boFirst=true;if(this.startPoint==null){this.startPoint=new Laya.Point}this.startPoint.x=t;this.startPoint.y=e;Laya.stage.on(Laya.Event.MOUSE_MOVE,this,this.touchMoveHandler);game.SceneModel.getInstance().event(game.SceneModel.EVENT_TOUCH_ROCKET,1)};t.prototype.touchMoveHandler=function(t){this.endPoint.x=t.stageX;this.endPoint.y=t.stageY;var e=this.startPoint.distance(this.endPoint.x,this.endPoint.y);if(e==0){return}if(e<=this.moveRadius){this.imgpoint.x=this.endPoint.x-this.startPoint.x;this.imgpoint.y=this.endPoint.y-this.startPoint.y}else{var i=game.SceneModel.interpolate(this.endPoint,this.startPoint,this.moveRadius/e);this.imgpoint.x=i.x-this.startPoint.x;this.imgpoint.y=i.y-this.startPoint.y}this.multX=(this.endPoint.x-this.startPoint.x)/e;this.multY=(this.endPoint.y-this.startPoint.y)/e;this.offset=e/this.moveRadius};t.prototype.touchCancel=function(){Laya.timer.clear(this,this.loopmove);Laya.stage.off(Laya.Event.MOUSE_MOVE,this,this.touchMoveHandler);this.imgpoint.x=0;this.imgpoint.y=0;Laya.Tween.to(this,{alpha:0},200,null,this.hideHandler);this.multX=0;this.multY=0;this.offset=0;this.boTouch=false;this.boFirst=false;game.SceneModel.getInstance().event(game.SceneModel.EVENT_TOUCH_ROCKET,0)};t.prototype.hide=function(){Laya.Tween.clearAll(this);app.ViewManager.toggleView(t,app.AppContainer.sceneLayer,-1)};t.SINGLE_KEY="scene.Rocker";t.EVENT_TOUCH_BEGIN="EVENT_TOUCH_BEGIN";return t}(ui.main.rockerUI);t.Rocker=e})(scene||(scene={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var scene;(function(t){var e=function(n){__extends(t,n);function t(t,e){var i=n.call(this,1,1,e.bg.bgOffsetX,e.bg.bgOffsetY)||this;i.force=false;i._gridX=-999999;i._gridY=-999999;i.isoType=isometric.IsoType.FLOOR_TYPE;i.mapId=t;i.vo=e;i.listImage={};Laya.stage.on(Laya.Event.RESIZE,i,i.onStageResize);i.onStageResize();return i}t.prototype.onStageResize=function(){this.force=true};t.prototype.drawImg=function(t,e,i){if(!this.maps){this.maps={}}if(this.maps[e+","+i]){return}this.maps[e+","+i]=1;if(!this.shapeList){this.shapeList={}}var n=e+","+i;var a;if(this.shapeList[n]){a=this.shapeList[n]}else{a=new Laya.Sprite;var o=new Laya.Label;o.color="#ffffff";o.fontSize*=2;a.addChild(o);o.text=n+"*"+t.x+","+t.y;this.shapeList[n]=a}a.name=n;var s=this.vo.bg.sliceWidth-1;var r=this.vo.bg.sliceHeight-1;a.graphics.clear();a.graphics.drawLines(0,0,[0,0,s,0,s,r,0,r,0,0],"#ff0000",1);t.addChild(a)};t.prototype.update=function(t,e,i,n){if(n===void 0){n=1}var a=this.vo.bg.sliceWidth*n;var o=this.vo.bg.sliceHeight*n;var s=this.vo.bg.bgOffsetX*n;var r=this.vo.bg.bgOffsetY*n;var l=Laya.stage.width*(1-n)/2;var h=Laya.stage.height*(1-n)/2;var p=t-s;var u=e-r;var c=Math.floor(p/a);c=Math.max(0,Math.min(c,this.vo.bg.bgXNum-1));var g=Math.floor(u/o);g=Math.max(0,Math.min(g,this.vo.bg.bgYNum-1));if(c==this._gridX&&g==this._gridY&&!this.force){return}if(i.x==0&&i.y==0){return}var f=Math.ceil((c*a-(i.x-s)+l)/a);var d=Math.ceil((Laya.stage.width*n-(c*a-(i.x-s)))/a);var y=Math.ceil((g*o-(i.y-r)+h)/o);var v=Math.ceil((Laya.stage.height*n-(g*o-(i.y-r)))/o);this._gridX=c;this._gridY=g;for(var _=0,m=this.vo.bg.bgXNum;_<m;++_){for(var I=0,L=this.vo.bg.bgYNum;I<L;++I){var w=_+"_"+I;if(_>=c-f&&_<=c+d&&I>=g-y&&I<=g+v){var b=this.listImage[w];if(!b){b=new Laya.Image;this.listImage[w]=b;var S="res/maps/"+this.mapId+"/"+_+"_"+I+".jpg";b.loadImage(S)}if(!b.parent){this.isoDisplay.addChild(b);b.x=_*a/n;b.y=I*o/n}}else if(this.listImage[w]&&this.listImage[w].parent){this.listImage[w].removeSelf()}}}};t.CELL_SIZE=32;return t}(isometric.IsoSprite);t.SceneArea=e})(scene||(scene={}));var scene;(function(L){var e;(function(t){t[t["WALK"]=1]="WALK";t[t["MASK"]=2]="MASK";t[t["CUST2"]=4]="CUST2";t[t["CUST3"]=8]="CUST3";t[t["CUST4"]=16]="CUST4";t[t["CUST5"]=32]="CUST5";t[t["CUST6"]=64]="CUST6";t[t["CUST7"]=128]="CUST7"})(e=L.E_BIT_Define||(L.E_BIT_Define={}));var t=function(){function t(){this.mapScale=1;this.canClick=false;this.itemMap={};this.itemList=[];this.waitList=[];this.dropList=[];this.skillList=[];this.trapList=[];this.battleHurtList=[];this.isLoading=true;this.firstEnter=true;this.rc=new zhenjiuqiwa.RandomCirle;this.isPlaying=false;this.boUseCenter=false;this.centerCheckCd=0;this._gridX=NaN;this._gridY=NaN;this._sceneMoveSpeed=0;this._mouseIgnore=0;this._standMap={};this.drawClickArr=[];this._aStar=new isometric.AStar(isometric.AStar.DIRECTION_8);this._isoRollRect=new Laya.Rectangle(0,0,Laya.stage.width,this.curHeight);this.initListener();Laya.stage.on(Laya.Event.RESIZE,this,this.onStageResize)}t.getInstance=function(){return app.Singleton.getInstance(t)};Object.defineProperty(t.prototype,"boInit",{set:function(t){this._boInit=t},enumerable:true,configurable:true});t.prototype.getItemCount=function(){return this.itemList.length};t.prototype.getv=function(t,e){return(t&e)>>this.tl_bintree(e)};t.prototype.tl_bintree=function(t){var e=0;var i=t;while(i!=1){i=i/2;e++;if(i==0){break}}return e};t.prototype.isCanWalk=function(t){return this.getv(t,e.WALK)==1};t.prototype.onStageResize=function(){this._isoRollRect=new Laya.Rectangle(0,0,Laya.stage.width,this.curHeight);this._boInit=true};Object.defineProperty(t.prototype,"isoWorld",{get:function(){return this._isoWorld},enumerable:true,configurable:true});t.prototype.showIsoWorldLayers=function(){if(this._isoWorld){this.stopRender=false;this._isoWorld.showLayers();this._boInit=true}};t.prototype.hideIsoWorldLayers=function(){if(this._isoWorld){this.stopRender=true;this._isoWorld.hideLayers()}};Object.defineProperty(t.prototype,"mapGrid",{get:function(){return this._mapGrid},enumerable:true,configurable:true});t.prototype.onLoadComplete=function(){Laya.timer.callLater(this,this.doLoadComplete)};Object.defineProperty(t.prototype,"lookAt",{get:function(){return this._lookAt.vo},set:function(t){this._lookAt=this.itemMap[t.insId.toString()]},enumerable:true,configurable:true});t.prototype.setGmLook=function(t){if(this._lookAt!=L.CameraView.getIns()&&!csv.MapProxy.getIns().isMove(game.Context.mainRole.mapId))this._lookAt=this.itemMap[t.insId.toString()]};t.prototype.doLoadComplete=function(){this.isLoading=false;this.vo=L.MapVO.getVO(this.mapfile);L.CameraView.getIns().minScale=Math.min(this.mapScale,Math.max(Laya.stage.width/this.vo.bgWidth,Laya.stage.height/this.vo.bgHeight));this._isoWorld=new isometric.IsoWorld;this._isoWorld.on(Laya.Event.CLICK,this,this.onClick);this._isoWorld.on(Laya.Event.MOUSE_DOWN,this,this.onMouseDown);this._mapGrid=new isometric.MapGrid(this.vo.xSize,this.vo.zSize,0,0,this.vo);this._aStar.findPath(this._mapGrid);app.AppContainer.sceneLayer.addChildAt(this._isoWorld,0);if(this._sm){this._isoWorld.removeIsoChild(this._sm)}this._sm=new isometric.IsoSprite(1,1,this.vo.bg.bgOffsetX,this.vo.bg.bgOffsetY);this._sm.isoType=isometric.IsoType.SM_MAP_TYPE;this._sm.loadImage("res/maps/"+this.mapfile+"/s.jpg",0,0,this.vo.bgWidth,this.vo.bgHeight);this._isoWorld.addIsoChild(this._sm);for(var t=0,e=this.waitList.length;t<e;t++){var i=this.waitList[t];this._isoWorld.addIsoChild(i);i.isoPos=new isometric.Point3D(i.vo.posX*32,0,i.vo.posY*32);game.SceneModel.getInstance().event(game.SceneModel.EVENT_ADD_ITEM,[i.vo])}for(var t=0,e=this.vo.obj.length;t<e;++t){var n=this.vo.obj[t];var a=Math.floor(n.x/32);var o=Math.floor(n.z/32);for(var s=0,r=n.att.length;s<r;++s){for(var l=0,h=n.att[s].length;l<h;++l){this._mapGrid.setWalkAtt(s+a,l+o,this.isCanWalk(n.att[s][l])?1:0)}}var p=isometric.IsoUtils.isoToScreen(new isometric.Point3D(n.x,0,n.z));n.screenX=p.x-n.w*.5;n.screenY=p.y-n.h*.5}if(this.vo.eff){for(var t=0,e=this.vo.eff.length;t<e;++t){var n=this.vo.eff[t];var p=isometric.IsoUtils.isoToScreen(new isometric.Point3D(n.x,0,n.z));n.screenX=p.x;n.screenY=p.y}}this._bgArea=new L.SceneArea(this.mapfile,this.vo);this._isoWorld.addIsoChild(this._bgArea);app.ProtocolRequest.JoinNewMapLoadOK();game.Context.event(game.ContextEvent.MAP_LOAD_COMPLETE);if(this.firstEnter){app.ViewManager.toggleView(login.LoginMainView,Laya.stage,-1);this.firstEnter=false}this.loadKZ();if(this.stopRender){this.stopRender=false;this.renderScene();this.stopRender=true;this.hideIsoWorldLayers()}else{this.showIsoWorldLayers()}};t.prototype.kz_alpha=function(t){if(this._kz){this._kz.alpha=t}};t.prototype.loadKZ=function(){var i=this;if(game.Context.kz!=0){if(this._kz){this._isoWorld.removeIsoChild(this._kz)}this._kz=new isometric.IsoSprite(1,1);this._kz.alpha=.5;var t="res/maps/"+this.mapfile+"/kz.jpg";this._kz.loadImage(t,0,0,undefined,undefined,new Laya.Handler(this,function(){var t=(i.vo.xSize+i.vo.zSize)*32;var e=i._kz.isoDisplay.width/t;i._kz.setDisplayOffset(-i.vo.zSize*32*e,0);i._kz.scaleX=i._kz.scaleY=1/e}));this._kz.isoType=isometric.IsoType.FLOOR_TYPE;this._isoWorld.addIsoChild(this._kz);this.kz_alpha(game.Context.kz)}};t.prototype.addChest=function(t,e){this.useDEBUG=e;if(!this._chestList){this._chestList=[]}if(!this.isPlaying&&battle.BattleManager.getIns().currControl==main.MapZJQWControl.getIns()){this.createChest(t)}else{this._chestList.push(t)}};t.prototype.createChest=function(t){this.isPlaying=true;var e;var i;if(this.useDEBUG){var n=game.Context.mainRole;e=n.posX;i=n.posY}else{var a=battle.BattleModel.getIns().bossInfo;if(!a){return}e=a.posX;i=a.posY}var o=new zhenjiuqiwa.ChestView;o.setData(t);this._isoWorld.addIsoChild(o);var s=this.rc.posList;var r=this.rc.getRandomPosIndex();var l=s[r];var h=32;var p=isometric.IsoUtils.isoToScreen(new isometric.Point3D(e,0,i));o.setScreenPosition(p.x*h+l.x,p.y*h+l.y,new Laya.Handler(this,this.playEnd))};t.prototype.playEnd=function(){this.isPlaying=false;if(this._isoWorld==null){this._chestList=[]}if(this._chestList.length>0){this.addChest(this._chestList.shift(),this.useDEBUG)}};t.prototype.clearBattleScene=function(){if(battle.BattleManager.getIns().boBattleLog){console.log("clearScene")}Laya.AtlasResourceManager.instance.freeBattleAtlas();if(this._isoWorld){Laya.timer.clear(this,this.loopForce);this.removeOtherItems()}};t.prototype.initScene=function(t){Laya.AtlasResourceManager.instance.freeAll();if(this._isoWorld){Laya.timer.clear(this,this.loopForce);this.removeAllSceneItems();this._isoWorld.clearAll();this._isoWorld=null;this.waitList=[]}if(ent.DebugConfig.isDebugger&&game.Context.custMapID!=undefined)t=parseInt(game.Context.custMapID);this.mapId=t;this.cfg=csv.MapProxy.getIns().getCfg(this.mapId.toString());this.useCameraCenter(false);this.mapScale=Number(this.cfg.mapscale);L.CameraView.getIns().initScale(this.mapScale);L.CameraView.getIns().clearAll();this.canClick=Boolean(this.cfg.click==1);var e=csv.MapProxy.getIns().getMapType(this.mapId);if(e==csv.MapProxy.MAP_TYPE.HULU_DAO||e==csv.MapProxy.MAP_TYPE.HULU_DAO_BOSS||e==csv.MapProxy.MAP_TYPE.HULU_DAO_MONSTER){}else{this.huludaoRoleList=[]}this.collectList=[];this.sceneNpcDataList=csv.NpcProxy.getIns().getMapNpcList(game.Context.mainRole.mapId);this.sceneCollectDataList=csv.NpcProxy.getIns().getMapCollectList(game.Context.mainRole.mapId);this.machineList=csv.MapTrapProxy.getIns().getMachineList(game.Context.mainRole.mapId);this.mapfile=this.cfg.mapfile;this.itemMap={};this.itemList=[];this._gridX=NaN;this._gridY=NaN;this.objList=[];this.effList=[];this.skillList=[];this.battleHurtList=[];this._standMap={};this.isLoading=true;this._boInit=true;this.boUseCenter=false;Laya.timer.clear(this,this.doLoadComplete);role.JumpAction.JumpId=0;if(game.Context.useZip){this.onLoadComplete()}else{Laya.loader.load("res/maps/"+this.mapfile+"/data.mapd",Laya.Handler.create(this,this.onLoadComplete))}};t.prototype.shakeScene=function(t,e,i){if(t===void 0){t=200}if(e===void 0){e=10}if(i===void 0){i=2}if(this._boShake){return}this._boShake=true;this._shakeDuration=t;this._shakeRange=e;this._shakeStart=Laya.timer.currTimer;Laya.timer.frameLoop(i,this,this.shake)};t.prototype.shake=function(){if(!this._isoWorld){return}if(Laya.timer.currTimer-this._shakeStart>this._shakeDuration){Laya.timer.clear(this,this.shake);this._isoWorld.setWorldXy(0,0);this._boShake=false;return}var t=game.SceneModel.random(0,Math.PI*2);var e=Math.cos(t)*this._shakeRange;var i=Math.sin(t)*this._shakeRange;this._isoWorld.setWorldXy(e,i)};t.prototype.setCameraInit=function(){this._boInit=true};t.prototype.setCameraPos=function(t,e){L.CameraView.getIns().clearAll();this._lookAt=L.CameraView.getIns();this._lookAt.vo.posX=t;this._lookAt.vo.posY=e;this._lookAt.isoPos=new isometric.Point3D(t*32,0,e*32);L.CameraView.getIns().worldScale=this.mapScale;this.useCameraCenter(false)};t.prototype.useCameraCenter=function(t){this.boUseCenter=t};t.prototype.changeCamera=function(t){this._sceneMoveSpeed=0;L.CameraView.getIns().clearAll();if(gm.GmModel.GM_PROF[0]){var e=game.Context.roleList[gm.GmModel.GM_PROF[0]-1];if(e){t=this.getViewById(e.insId)}}this._lookAt=t};t.prototype.setCenterPoint=function(){if(!this._boInit&&Laya.timer.currTimer-this.centerCheckCd>200){this.centerCheckCd=Laya.timer.currTimer;return}var t=false;var e;var i;var n;var a;var o;var s=0;for(var r in this._standMap){var l=this.getViewById(Uint64.fromString16(r));if(l&&l.roleState!=role.RoleStateConst.DIE){if(!t){e=l.x;i=l.x;n=l.y;a=l.y;t=true}else{e=e>l.x?l.x:e;i=i<l.x?l.x:i;n=n>l.y?l.y:n;a=a<l.y?l.y:a}if(o){if(l.charactorVO.battleCamp!=o){s++}}else{o=l.charactorVO.battleCamp}}}if(s>0){var h=new Laya.Point;h.x=(e+i)/2;h.y=(n+a)/2;var p=isometric.IsoUtils.screenToIso(h);h.x=Math.round(p.x/32);h.y=Math.round(p.z/32);var u=i==e?1:Laya.stage.width/(i-e);L.CameraView.getIns().changeWorldScale(u);this._lookAt.vo.posX=h.x;this._lookAt.vo.posY=h.y;this._lookAt.isoPos=p}else{L.CameraView.getIns().clearAll()}};t.prototype.initListener=function(){Laya.timer.frameLoop1(1,this,this.renderScene);game.SystemSetModel.getInstance().on(game.SystemSetModel.EVENTS.APPEAR_CHANGE,this,this.onRoleAppearChange);gm.GmModel.getIns().on("GM_PROF_SET",this,this.onRoleAppearChange)};t.prototype.forceCamera=function(t){if(t){Laya.timer.frameLoop(1,this,this.loopForce)}else{Laya.timer.clear(this,this.loopForce)}};t.prototype.loopForce=function(){L.CameraView.getIns().updateFrame(Laya.timer.delta);this.mapScale=L.CameraView.getIns().worldScale;var t=this._lookAt.x*this.mapScale;var e=this._lookAt.y*this.mapScale;this._isoRollRect.x=t-Laya.stage.width*this.mapScale*.5;this._isoRollRect.y=e-this.curHeight*this.mapScale*.5;var i=this.vo.bg.bgOffsetX*this.mapScale;var n=this.vo.bg.bgOffsetY*this.mapScale;var a=this.vo.bgWidth*this.mapScale;var o=this.vo.bgHeight*this.mapScale;var s=Laya.stage.width*(1-this.mapScale)/2;var r=Laya.stage.height*(1-this.mapScale)/2;var l=Laya.stage.width*this.mapScale;var h=Laya.stage.height*this.mapScale;if(this._isoRollRect.x<=i+s){this._isoRollRect.x=i+s}else if(this._isoRollRect.x+l>=a+i+s){this._isoRollRect.x=a+i+s-l}if(this._isoRollRect.y<=n+r){this._isoRollRect.y=n+r}else if(this._isoRollRect.y+h>=o+n+r){this._isoRollRect.y=o+n+r-h}this._isoWorld.scrollRect=this._isoRollRect;this._isoWorld.scaleWorld(this.mapScale)};t.prototype.renderSceneObjects=function(){if(!this._lookAt){return}if(this._lookAt.x<this._gridX+10&&this._lookAt.y<this._gridY+10&&this._lookAt.x>this._gridX-10&&this._lookAt.y<this._gridY-10){return}this._gridX=this._lookAt.x;this._gridY=this._lookAt.y;for(var t=0,e=this.vo.obj.length;t<e;++t){var i=this.vo.obj[t];if(this._isoWorld.scrollRect.contains(i.screenX,i.screenY)||this._isoWorld.scrollRect.contains(i.screenX,i.screenY+i.h)||this._isoWorld.scrollRect.contains(i.screenX+i.w,i.screenY)||this._isoWorld.scrollRect.contains(i.screenX+i.w,i.screenY+i.h)){var n=this.objList[t];if(!n){n=this.objList[t]=new isometric.IsoSprite(1,1,i.offsetX-i.w*.5,i.offsetY-i.h*.5);n.isoPos=new isometric.Point3D(i.x,0,i.z);n.isoType=isometric.IsoType.OBJECTS_TYPE;n.loadImage("res/objects/"+i.img)}if(!n.parent){this._isoWorld.addIsoChild(n)}}else if(this.objList[t]&&this.objList[t].parent){this._isoWorld.removeIsoChild(this.objList[t])}}if(this.vo.eff){for(var t=0,e=this.vo.eff.length;t<e;++t){var i=this.vo.eff[t];if(this._isoWorld.scrollRect.contains(i.screenX,i.screenY)){var n=this.effList[t];if(!n){n=this.effList[t]=new isometric.IsoSprite(1,1);n.isoPos=new isometric.Point3D(i.x,0,i.z);n.isoType=isometric.IsoType.OBJECTS_TYPE;n.isoDisplay.addChild(new game.AniView(i.img.split(".")[0],game.AniView.FILE_NAME.MAP))}if(!n.parent){this._isoWorld.addIsoChild(n)}}else if(this.effList[t]&&this.effList[t].parent){this._isoWorld.removeIsoChild(this.effList[t])}}}if(this.sceneNpcDataList&&this.sceneNpcDataList.length>0){for(var t=0,e=this.sceneNpcDataList.length;t<e;++t){if(this.sceneNpcDataList[t].getCfg().npctype==csv.NpcProxy.ENUM_TYPE.HOME_EVENT){continue}this.updateRenderScene(this.sceneNpcDataList[t],false)}game.HomeEventModel.getInstance().tryRefreshNPC()}if(this.sceneCollectDataList&&this.sceneCollectDataList.length>0){for(var t=0,e=this.sceneCollectDataList.length;t<e;++t){this.updateRenderScene(this.sceneCollectDataList[t])}}if(this.machineList&&this.machineList.length>0){for(var t=0,e=this.machineList.length;t<e;++t){if(!(this.machineList[t].noEffect&&this.machineList[t].getCfg().clickaction=="")){this.updateRenderScene(this.machineList[t])}}}};t.prototype.updateRenderScene=function(t,e){if(e===void 0){e=true}if(t){if(e){var i=isometric.IsoUtils.isoToScreen(new isometric.Point3D(t.posX,0,t.posY));var n=new Laya.Rectangle(this._isoWorld.scrollRect.x-500,this._isoWorld.scrollRect.y-500,this._isoWorld.scrollRect.width+500,this._isoWorld.scrollRect.height+500);if(n.contains(i.x*32*this.mapScale,i.y*32*this.mapScale)){var a=this.getViewById(t.insId);if(a){a.refreshItemView()}else{this.addSceneItem(t)}}else{if(this.getViewById(t.insId)){this.removeSceneItem(t.insId)}}}else{var a=this.getViewById(t.insId);if(a){a.refreshItemView()}else{this.addSceneItem(t)}}}};t.prototype.renderScene=function(){if(this.isLoading){return}if(!this._isoWorld||!this._lookAt){return}for(var t=0;t<this.itemList.length;++t){this.itemList[t].updateFrame(Laya.timer.delta);var e=Math.floor(this.itemList[t].isoPosX/32);var i=Math.floor(this.itemList[t].isoPosZ/32);if(this.vo.isMask(e,i)){this.itemList[t].setObscured(true)}else{this.itemList[t].setObscured(false)}}for(var t=0;t<this.skillList.length;++t){this.skillList[t].updateFrame(Laya.timer.delta)}if(this.stopRender){return}if(this._lookAt==L.CameraView.getIns()){if(this.boUseCenter){this.setCenterPoint()}L.CameraView.getIns().updateFrame(Laya.timer.delta);this.mapScale=L.CameraView.getIns().worldScale}var n=this._lookAt.x*this.mapScale;var a=this._lookAt.y*this.mapScale;if(this._boInit||this.canClick||this._lookAt!=L.CameraView.getIns()){this._isoRollRect.x=n-Laya.stage.width*this.mapScale*.5;this._isoRollRect.y=a-this.curHeight*this.mapScale*.5;this._boInit=false}else{var o=this._isoRollRect.x+Laya.stage.width*this.mapScale*.5;var s=this._isoRollRect.y+this.curHeight*this.mapScale*.5;var r=new Laya.Point(n,a);var l=Math.floor(r.distance(o,s));if(l<=100&&l>5){this._sceneMoveSpeed=10;var h=Math.atan2(a-s,n-o);var p=this._sceneMoveSpeed*Laya.timer.delta/100;if(p>l){p=l}var u=Math.cos(h)*p;var c=Math.sin(h)*p;this._isoRollRect.x+=u;this._isoRollRect.y+=c}else if(l>100){if(this._sceneMoveSpeed<10){this._sceneMoveSpeed=10}var h=Math.atan2(a-s,n-o);var p=this._sceneMoveSpeed*Laya.timer.delta/100;if(p>l){p=l}var u=Math.cos(h)*p;var c=Math.sin(h)*p;this._isoRollRect.x+=u;this._isoRollRect.y+=c;this._sceneMoveSpeed+=1;if(this._sceneMoveSpeed>50){this._sceneMoveSpeed=50}}else{this._isoRollRect.x=n-Laya.stage.width*this.mapScale*.5;this._isoRollRect.y=a-this.curHeight*this.mapScale*.5}}var g=this.vo.bg.bgOffsetX*this.mapScale;var f=this.vo.bg.bgOffsetY*this.mapScale;var d=this.vo.bgWidth*this.mapScale;var y=this.vo.bgHeight*this.mapScale;var v=Laya.stage.width*(1-this.mapScale)/2;var _=Laya.stage.height*(1-this.mapScale)/2;var m=Laya.stage.width*this.mapScale;var I=Laya.stage.height*this.mapScale;if(Laya.stage.width>this.vo.bgWidth){}else{if(this._isoRollRect.x<=g+v){this._isoRollRect.x=g+v}else if(this._isoRollRect.x+m>=d+g+v){this._isoRollRect.x=d+g+v-m}}if(Laya.stage.height>this.vo.bgHeight){if(this._isoRollRect.y<=f+_){this._isoRollRect.y=f+_}}else{if(this._isoRollRect.y<=f+_){this._isoRollRect.y=f+_}else if(this._isoRollRect.y+I>=y+f+_){this._isoRollRect.y=y+f+_-I}}this._isoWorld.scrollRect=this._isoRollRect;this._isoWorld.scaleWorld(this.mapScale);if(this._bgArea){this._bgArea.update(n,a,this._isoRollRect,this.mapScale)}this.renderSceneObjects()};t.prototype.onClick=function(t){if(this._lookAt&&this.canClick){if(this._mouseIgnore>0){this._mouseIgnore--;return}game.SceneModel.getInstance().event(game.SceneModel.EVENT_CLICK);this.doLookatMove()}};t.prototype.onMouseDown=function(t){var e=csv.MapProxy.getIns().isMove(game.Context.mainRole.mapId);if(this._lookAt&&e){Laya.stage.on(Laya.Event.MOUSE_UP,this,this.onMouseUp);this._mouseX=Laya.stage.mouseX;this._mouseY=Laya.stage.mouseY;Laya.timer.once(200,this,this.checkMouseDown)}};t.prototype.checkMouseDown=function(){this._mouseIgnore=1;app.ViewManager.toggleView(L.Rocker,app.AppContainer.sceneLayer,1,[this._mouseX,this._mouseY])};t.prototype.onMouseUp=function(t){t.stopPropagation();Laya.timer.clear(this,this.checkMouseDown);L.Rocker.getIns().touchCancel();Laya.stage.off(Laya.Event.MOUSE_UP,this,this.onMouseUp)};t.prototype.doLookatMove=function(){var t=isometric.IsoUtils.screenToIso(new Laya.Point(this._isoWorld.mouseX,this._isoWorld.mouseY));var e=Math.floor(t.x/32);var i=Math.floor(t.z/32);t.x=e*32;t.z=i*32;role.LeadingRoleView.getIns().cancelAI("walk_click");role.LeadingRoleView.getIns().move(e,i);if(this.checkCanMove(e,i)){L.ClickPosView.getIns().setClickType("res/atlas/ani/ui/skill_dianjidimian.atlas")}else{L.ClickPosView.getIns().setClickType("res/atlas/ani/ui/skill_dianjidimian01.atlas")}this._isoWorld.addIsoChild(L.ClickPosView.getIns());L.ClickPosView.getIns().isoPos=t;L.ClickPosView.getIns().recount();L.ClickEffect.getIns().remove();if(game.Context.openClickDraw){this.draw(e,i)}else{this.clearDraw()}};t.prototype.findPath=function(t,e,i,n){if(!this._mapGrid){return[]}this._mapGrid.setStartNode(t,e);this._mapGrid.setEndNode(i,n);this._aStar.findPath(this._mapGrid);return this._aStar.pathArr};t.prototype.findRandomPathByArea=function(t,e,i,n){if(!this._mapGrid){return[0,0]}var a=[];for(var o=t;o<=i;o++){for(var s=e;s<=n;s++){if(this.checkCanMove(o,s)){a.push([o,s])}}}var r=a.length;var l=game.SceneModel.random(0,r);return a[l]};t.prototype.addSceneItem=function(t){var e=t.insId.toString();var i;if(this.itemMap[e]){i=this.itemMap[e];i.vo=t}else{i=L.SceneManager.initView(t);this.itemMap[e]=i;this.itemList.push(i)}if(this._isoWorld){i.isoPos=new isometric.Point3D(i.vo.posX*32,0,i.vo.posY*32);game.SceneModel.getInstance().event(game.SceneModel.EVENT_ADD_ITEM,[t]);this._isoWorld.addIsoChild(i)}else{this.waitList.push(i)}return i};t.prototype.getViewById=function(t){return this.itemMap[t.toString()]};t.prototype.removeSceneItem=function(t){if(!t){return}var e=t.toString();var i=this.itemMap[e];if(i){i.clearAll();var n=this.itemList.indexOf(i);if(n>-1){this.itemList.splice(n,1)}this._isoWorld.removeIsoChild(i);if(!game.Context.isMainRole(i.vo.insId)){this.itemMap[e]=undefined;delete this.itemMap[e]}}};t.prototype.removeAllSceneItems=function(){while(this.itemList.length>0){this.removeSceneItem(this.itemList[0].vo.insId)}this.itemList=[];while(this.skillList.length>0){this.removeSkill(this.skillList[0])}this.skillList=[];while(this.battleHurtList.length>0){this.removebattleHurt(this.battleHurtList[0])}this.battleHurtList=[]};t.prototype.removeOtherItems=function(){var t=[];for(var e=0;e<this.itemList.length;e++){var i=this.itemList[e];if(i){if(i instanceof role.RobotView){continue}if(i instanceof role.GuardPetView){continue}if(game.Context.isMainRole(i.vo.insId)){continue}t.push(i.vo.insId)}}for(var e=0,n=t.length;e<n;e++){this.removeSceneItem(t[e])}while(this.skillList.length>0){this.removeSkill(this.skillList[0])}this.skillList=[];while(this.battleHurtList.length>0){this.removebattleHurt(this.battleHurtList[0])}this.battleHurtList=[]};t.prototype.getIsoWorld=function(){return this._isoWorld};t.prototype.onRoleAppearChange=function(){var t;for(var e=0;e<this.itemList.length;e++){t=this.itemList[e];if(t instanceof role.RoleView){t.refreshView()}}};t.prototype.onPlayerNameChange=function(t){var e;var i;for(var n=0;n<this.itemList.length;n++){e=this.itemList[n];if(e instanceof role.RoleView){i=e.roleVO;if(Uint64.equal(i.insId,t.objId)){i.name=t.name;e.updatePlayerName();if(Uint64.equal(i.insId,game.Context.mainRole.insId)){game.Context.mainRole.name=t.name}break}}}};Object.defineProperty(t.prototype,"curHeight",{get:function(){return Laya.stage.height+2*ScreenAdapter.OFFSET_Y},enumerable:true,configurable:true});t.prototype.getIsoWorldCenterPoint=function(){return[this._isoRollRect.x+Laya.stage.width*.5,this._isoRollRect.y+Laya.stage.height*.5]};t.prototype.addSkill=function(t){if(this._isoWorld){if(this.skillList.indexOf(t)==-1){this.skillList.push(t)}this._isoWorld.addIsoChild(t)}};t.prototype.addStageSkill=function(t){if(this._isoWorld){if(this.skillList.indexOf(t)==-1){this.skillList.push(t)}t.x=this._isoRollRect.x+Laya.stage.width*.5;t.y=this._isoRollRect.y+Laya.stage.height*.5;this._isoWorld.addIsoChild(t)}};t.prototype.removeSkill=function(t){if(this._isoWorld){if(t){t.clearAll();var e=this.skillList.indexOf(t);if(e>-1){this.skillList.splice(e,1)}this._isoWorld.removeIsoChild(t)}}};t.prototype.addbattleHurt=function(t){if(this._isoWorld){if(this.battleHurtList.indexOf(t)==-1){this.battleHurtList.push(t)}if(t.type==isometric.IsoType.BATTLEHURT_TYPE){this._isoWorld.battleHurtLayer.addChild(t)}else{this._isoWorld.stageHurtLayer.addChild(t)}}};t.prototype.removebattleHurt=function(t){if(this._isoWorld){if(t){t.clearAll();var e=this.battleHurtList.indexOf(t);if(e>-1){this.battleHurtList.splice(e,1)}t.removeSelf()}}};t.prototype.addIsoObj=function(t){if(this._isoWorld){if(this.dropList.indexOf(t)==-1){this.dropList.push(t)}this._isoWorld.addIsoChild(t)}};t.prototype.removeIsoObj=function(t){if(this._isoWorld){if(t){var e=this.dropList.indexOf(t);if(e>-1){this.dropList.splice(e,1)}this._isoWorld.removeIsoChild(t)}}};t.prototype.addTrapObj=function(t){if(this._isoWorld){if(this.trapList.indexOf(t)==-1){this.trapList.push(t)}this._isoWorld.addIsoChild(t)}};t.prototype.removeTrapObj=function(t){if(this._isoWorld){if(t){t.clearAll();var e=this.trapList.indexOf(t);if(e>-1){this.trapList.splice(e,1)}this._isoWorld.removeIsoChild(t)}}};t.prototype.checkCanMove=function(t,e){if(this.vo){return this.vo.isWalk(t,e)}return false};t.prototype.getStatus=function(t,e,i){if(this.vo){return this.vo.getv(t,e,i)}return false};t.prototype.checkStandUsed=function(t,e,i){for(var n in this._standMap){var a=this._standMap[n];if(!t||n!=t.vo.insId.toString()){if(e==a[0]&&i==a[1]){return true}}}return false};t.prototype.getNextStand=function(t,e,i,n){if(n===void 0){n=1}for(var a=e-n;a<=e+n;a++){for(var o=i-n;o<=i+n;o++){if(this.checkStandUsed(t,a,o)){continue}if(this.checkCanMove(a,o)){return new Laya.Point(a,o)}}}return null};t.prototype.setStandPos=function(t,e,i){this._standMap[t.toString()]=[e,i]};t.prototype.deleteStandPos=function(t){if(this._standMap[t.toString()]){this._standMap[t.toString()]=null;delete this._standMap[t.toString()]}};t.prototype.checkIsMathAttack=function(t,e,i){if(Math.abs(t.vo.posX-e.vo.posX)<=i&&Math.abs(t.vo.posY-e.vo.posY)<=i){return true}return false};t.prototype.getBehindStandPos=function(t,e){var i=game.SceneModel.getDiffDir(e.vo.dir);i=game.SceneModel.getSelfDir(i);t.vo.dir=i;var n=e.vo.posX;var a=e.vo.posY;var o;var s;var r=(2-i/4)*Math.PI;var l=2;var h=Math.cos(r);if(h==-1||h==1){}else{h=0}var p=Math.sin(r);if(p==-1||p==1){}else{p=0}for(;l<=t.charactorVO.attackDis;l++){var u=l*h;var c=l*p;o=n+u;s=a+c;var g=[];if(u){var f=Math.abs(u);for(var d=s-f+1;d<s+f;d++){if(!this.checkCanMove(o,d)||this.checkStandUsed(t,o,d)){continue}g.push({priority:Math.abs(o-n)+Math.abs(d-a),col:o,row:d})}}else if(c){var f=Math.abs(c);for(var d=o-f+1;d<o+f;d++){if(!this.checkCanMove(d,s)||this.checkStandUsed(t,d,s)){continue}g.push({priority:Math.abs(d-n)+Math.abs(s-a),col:d,row:s})}}SortUtil.sortOnArr(g,["priority"],[SortUtil.NUMERIC]);if(g.length){var y=0;var v=g[y];return new Laya.Point(v.col,v.row)}}return this.getEmptyStandPos(t,n,a,2)};t.prototype.getEmptyStandPos=function(t,e,i,n,a){if(a===void 0){a=false}var o=[];for(var s=e-n;s<=e+n;s++){for(var r=i-n;r<=i+n;r++){if(t.charactorVO.boRemoteHero){if(t.vo.posX>e&&s<e){continue}else if(t.vo.posX<e&&s>e){continue}if(t.vo.posY>i&&r<i){continue}else if(t.vo.posY<i&&r>i){continue}if(s<e+n/2&&s>e-n/2&&(r<i+n/2&&r>i-n/2)){continue}}if(!this.checkCanMove(s,r)||this.checkStandUsed(t,s,r)){continue}var l=Math.abs(s-e);var h=Math.abs(r-i);var p=void 0;if(t.charactorVO.boRemoteHero){p=n-Math.max(l,h)}else{p=Math.min(l,h)}p+=Math.abs(s-t.vo.posX)+Math.abs(r-t.vo.posY);p+=this.getStandPriority(t,s,r,n);o.push({priority:p,col:s,row:r})}}SortUtil.sortOnArr(o,["priority"],[SortUtil.NUMERIC]);if(o.length){var u=0;if(a){u=game.SceneModel.random(0,o.length)}var c=o[u];return new Laya.Point(c.col,c.row)}return null};t.prototype.getStandPriority=function(t,e,i,n){var a=0;for(var o in this._standMap){var s=this._standMap[o];if(o!=t.vo.insId.toString()){var r=Math.abs(e-s[0]);var l=Math.abs(i-s[1]);var h=3-Math.max(r,l);if(a<h){a=h*n}}}return a};t.prototype.clearDraw=function(){for(var t=0;t<this.drawClickArr.length;t++){if(this.drawClickArr[t].parent){this.drawClickArr[t].parent.removeChild(this.drawClickArr[t])}}this.drawClickArr=[]};t.prototype.draw=function(t,e,i,n,a,o){if(i===void 0){i="#ef2"}if(n===void 0){n=0}if(a===void 0){a=true}if(o===void 0){o=""}if(a){this.clearDraw()}if(n==0){var s=new isometric.IsoTile(32,i);s.setLabel(t,e,o,1);s.isoPos=new isometric.Point3D(t*32,0,e*32);this._isoWorld.objectLayer.addChild(s);this.drawClickArr.push(s)}else if(n==1){}};t.prototype.refreshHomeEventNPC=function(t){return this.addSceneItem(csv.NpcProxy.getIns().getNpcVO(t))};t.SINGLE_KEY="scene.SceneMediator";return t}();L.SceneMediator=t})(scene||(scene={}));var scene;(function(t){var n=Laya.Loader;var e=function(){function i(){}i.init=function(){n.typeMap["mapd"]="mapd";n.parserMap["mapd"]=i.DataParser};i.DataParser=function(t){t.on(Laya.Event.LOADED,null,i.onJsonLoaded,[t]);t.load(t.url,n.JSON,false,null,true)};i.onJsonLoaded=function(t,e){n.loadedMap[Laya.URL.formatURL(t.url)]=e;i.parser(e,t.url);t.endLoad.call(t,e)};i.parser=function(t,e){if(t.att){t.xSize=t.att.length;t.zSize=t.att[0].length}t.bg.sliceWidth=t.bg.sliceWidth||375;t.bg.sliceHeight=t.bg.sliceHeight||667;if(t.bg.bgw==0||t.bg.bgh==0){console.warn("["+(t.map?t.map.mapName:e)+"]vo.bg.bgw == 0 ||  vo.bg.bgh == 0 检测地图配置 非sliceWidth,sliceHeight倍的有切边!")}t.bgWidth=t.bg.bgw||t.bg.sliceWidth*t.bg.bgXNum;t.bgHeight=t.bg.bgh||t.bg.sliceHeight*t.bg.bgYNum;t.bg.bgw=t.bgWidth;t.bg.bgh=t.bgHeight;return t};return i}();t.SceneParser=e})(scene||(scene={}));var scene;(function(t){var e=function(){function a(){}a.clone=function(t){var e=new a;e.att=t.att;e.bg=t.bg;e.bgHeight=t.bgHeight;e.bgWidth=t.bgWidth;e.eff=t.eff;e.mask=t.mask;e.obj=t.obj;e.xSize=t.xSize;e.zSize=t.zSize;return e};a.prototype.getv=function(t,e,i){var n=0;if(this.att){if(this.att[t]&&this.att[t][e]){n=this.att[t][e]}}else{n=this.map.getXY(t,e)}return bc.MapByteCfg.getv(n,i)==1};a.prototype.isMask=function(t,e){if(this.mask&&this.mask[t]!=undefined&&this.mask[t][e]!=undefined){return this.mask[t][e]==1}return this.getv(t,e,bc.MapByteCfg.BIT_MASK)};a.prototype.isWalk=function(t,e){if(this.att){if(this.att[t]&&this.att[t][e]){var i=bc.MapByteCfg.getv(this.att[t][e],bc.MapByteCfg.BIT_COLLISION);return i==1}}return this.getv(t,e,bc.MapByteCfg.BIT_COLLISION)};a.getVO=function(t){var e;if(game.Context.use_xbin){var i=Laya.URL.formatURL(game.Context.MAPS_DAS+".mapbin");e=Laya.loader.getRes(i).getMapVO(t)}else{var n=Laya.loader.getRes("res/maps/"+t+"/data.mapd");if(n){e=a.clone(n)}}return e};return a}();t.MapVO=e;var i=function(){function t(){}return t}();t.MapBgCfg=i;var n=function(){function t(){}return t}();t.MapObjCfg=n;var a=function(){function t(){}return t}();t.MapEffCfg=a})(scene||(scene={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var sevenday;(function(i){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.debug=true;t.DelayTime=1e3*3;t.oldDay=-1;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.init=function(){app.ViewManager.regist(i.QiRiMuBiaoView,"qirimubiao.atlas","shangcheng.atlas");game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.SEVEN_DAY,i.QiRiMuBiaoView);main.MainUIIcon.iconClassMap[csv.MainIconProxy.TYPE_ICON_SEVEN_DAY]=i.SevenDaySmallIcon;csv.MainIconProxy.getIns().registerCheckHandler(csv.MainIconProxy.TYPE_ICON_SEVEN_DAY,new Laya.Handler(this,this.onCheckMainDlgHandler));app.ProtocolRequest.SevenDayDataReq();csv.FunctionsProxy.getIns().on(csv.FunctionsProxy.EVENTS.ADD,this,this.onFuncOpen)};t.prototype.onFuncOpen=function(t){if(parseInt(t.maindlg)){if(t.id==csv.FunctionsProxy.ENUMS.SEVEN_DAY){app.ProtocolRequest.SevenDayDataReq();csv.FunctionsProxy.getIns().off(csv.FunctionsProxy.EVENTS.ADD,this,this.onFuncOpen)}}};t.prototype.updateData=function(){if(i.SevenDayModel.getIns().isEnd()){csv.FunctionsProxy.getIns().addOpened(csv.FunctionsProxy.ENUMS.SEVEN_DAY)}else{csv.FunctionsProxy.getIns().removeOpened(csv.FunctionsProxy.ENUMS.SEVEN_DAY)}};t.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.SevenDayRewardAck,this,this.onSevenDayRewardAck);this.addMsgListener(app.ProtocolResponse.SevenDayDataAck,this,this.onSevenDayDataAck)};t.prototype.onSevenDayDataAck=function(t,e){i.SevenDayModel.getIns().parseData(e);if(this.oldDay!=i.SevenDayModel.getIns().curInDay){Laya.timer.once(this.DelayTime,this,this.checkPost)}};t.prototype.sendInfo=function(){app.ProtocolRequest.SevenDayDataReq()};t.prototype.checkPost=function(){if(this.oldDay!=i.SevenDayModel.getIns().curInDay){this.oldDay=i.SevenDayModel.getIns().curInDay;this.sendInfo()}Laya.timer.once(this.DelayTime,this,this.checkPost)};t.prototype.onSevenDayRewardAck=function(t,e){if(e.result==1){app.ProtocolRequest.SevenDayDataReq()}i.SevenDayModel.getIns().event(i.SevenDayModel.EVENT_BUY_COMPLETE,e)};t.prototype.onCheckMainDlgHandler=function(){return!i.SevenDayModel.getIns().isEnd()};t.SINGLE_KEY="sevenday.SevenDayModule";return t}(app.ModuleBase);i.SevenDayModule=t})(sevenday||(sevenday={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var sevenday;(function(g){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.endtime=0;t.redVo=new g.SevenRedVo;return t}t.getIns=function(){return app.Singleton.getInstance(t)};Object.defineProperty(t.prototype,"curScore",{get:function(){if(this.sDayPointDdata){return this.sDayPointDdata.point}return 0},enumerable:true,configurable:true});t.prototype.init=function(){};t.prototype.getShopData=function(t,e){if(this.info){if(this.info.daydata){for(var i=0;i<this.info.daydata.length;i++){var n=this.info.daydata[i];if(n){if(n.day==e&&n.shopdata){for(var a=0;a<n.shopdata.length;a++){if(n.shopdata[a].id==t){return n.shopdata[a]}}}}}}}};t.prototype.checkCanBuy=function(t,e){var i=csv.SevenDayProxy.getIns().targettask_shopMap[t];if(!i){console.log("servenDay checkCanBuy:"+t);return false}if(i.vipneed>vipcode.VipModel.getIns().vipLvl){return false}var n=false;if(e){if(e.buynum>=i.times){}else{n=true}}else{n=true}if(n){var a=game.ItemUtil.parserList(i.trueprice)[0];if(a.count==0){return true}}return false};t.prototype.buyShopRed=function(t,e){if(this.curInDay<e){return false}var i=this.getShopData(t,e);return this.checkCanBuy(t,i)};t.prototype.getTaskData=function(t,e){if(this.info){if(this.info.daydata){for(var i=0;i<this.info.daydata.length;i++){var n=this.info.daydata[i];if(n){if(n.day==e&&n.taskdata){for(var a=0;a<n.taskdata.length;a++){if(n.taskdata[a].id==t){return n.taskdata[a]}}}}}}}};t.prototype.isEnd=function(){if(this.endtime==0){return true}if(this.endtime<=game.Context.getServerTime()){return true}else{return false}};Object.defineProperty(t.prototype,"curInDay",{get:function(){var t=this.endtime-game.Context.getServerTime();var e=csv.SevenDayProxy.getIns().day-t/util.TimeUtil.secOneDay;return Math.ceil(e)},enumerable:true,configurable:true});t.prototype.getLimitEndTime=function(t){var e=game.Config.getParams(922);var i=parseInt(e.split("-")[1]);var n=game.Context.openZeroTime+(t-1+i)*util.TimeUtil.secOneDay;return n};t.prototype.dayRed=function(t,e){var i=this.info;if(i){if(i.daydata){var n=i.daydata;for(var a=0;a<n.length;a++){var o=n[a];if(o.day==t){for(var s=0;s<e.length;s++){var r=e[s];if(r==g.ESevenTabType.Tianqifuli_Shop){if(o.shopdata){for(var l=0;l<o.shopdata.length;l++){var h=o.shopdata[l];var p=csv.SevenDayProxy.getIns().targettask_shopMap[h.id];if(p&&p.day==t&&this.buyShopRed(h.id,t)){return r}}}}else{if(o.taskdata){for(var l=0;l<o.taskdata.length;l++){var u=o.taskdata[l];var c=csv.SevenDayProxy.getIns().targettask_taskMap[u.id];if(c){if(u.statu==g.E_DayComData.COMPLETE_REWARD){return r}}}}}}}}}}return};t.prototype.dayRedDot=function(t){var e=this.info;if(e){if(e.daydata){var i=e.daydata;for(var n=0;n<i.length;n++){var a=i[n];if(a.day==t){if(a.taskdata){for(var o=0;o<a.taskdata.length;o++){var s=a.taskdata[o];var r=csv.SevenDayProxy.getIns().targettask_taskMap[s.id];if(r){if(s.statu==1){return r.type}}}}}}}}return};t.prototype.isAllComplete=function(t){var e=true;var i=false;if(g.SevenDayModel.getIns().curInDay>=t){var n=csv.SevenDayProxy.getIns().getCfgLimitEndTask(t,g.SevenDayModel.QiriTaskType.limitTimeTask);e=this.isAllCompleteGrowTask(t);if(n){var a=this.getTaskData(n.id,t);i=a.statu==2}else{console.log("配置错误====== 限时任务中没有taskid==0的数据")}}else{e=false}var o=this.getLimitEndTime(t);var s=o-game.Context.getServerTime();if(e&&(i||s<=0)){return true}return false};t.prototype.isAllCompleteGrowTask=function(t){var e=true;var i=csv.SevenDayProxy.getIns().getCfgListByType(t,g.SevenDayModel.QiriTaskType.chengZhangTask);for(var n=0;n<i.length;n++){var a=this.getTaskData(i[n].id,t);if(!a){console.log("")}if(a.statu!=2){e=false;break}}return e};t.prototype.getTypeDot=function(t){if(t>this.curInDay){return[]}var e=[];var i=csv.SevenDayProxy.getIns().getCfgListByType(t,g.SevenDayModel.QiriTaskType.chengZhangTask);var n=csv.SevenDayProxy.getIns().getLimitList(t);for(var a=0;a<i.length;a++){var o=this.getTaskData(i[a].id,t);if(o&&o.statu==1){e.push(g.SevenDayModel.QiriTaskType.chengZhangTask);break}}for(var s=0;s<n.length;s++){var o=this.getTaskData(n[s].id,t);if(o&&o.statu==1){e.push(g.SevenDayModel.QiriTaskType.limitTimeTask);break}}return e};t.prototype.getRewardTaskDay=function(){var t=[];for(var e=0;e<this.info.daydata.length;e++){t=this.info.daydata[e].taskdata;for(var i=0;i<t.length;i++){if(t[i].statu==1&&this.info.daydata[e].day<=this.curInDay){return this.info.daydata[e].day}}}return-1};t.prototype.sortTask=function(t,e){if(t.day>e.day){return 1}else if(t.day<e.day){return-1}return 0};t.prototype.checkIconRed=function(){var t=this.info;if(t){var e=this.redVo;e.clear();if(t.daydata){var i=t.daydata;i=i.sort(this.sortTask);for(var n=0;n<i.length;n++){var a=i[n];if(a.day<=g.SevenDayModel.getIns().curInDay){var o=this.dayRed(a.day,[g.ESevenTabType.ChengZhangTask]);if(o!=undefined){e.type=o;e.day=a.day;return this.redVo}}}}if(t.pointdata){var s=t.pointdata;for(var n=0;n<s.length;n++){var r=s[n];var l=r.reward;for(var h=0;h<l.length;h++){if(l[h].statu==g.E_DayComData.COMPLETE_REWARD){e.points=true;return e}}}}}return};t.prototype.update=function(){var t=this.info;if(!t){return}if(t.pointdata){if(t.pointdata.length>0){this.endtime=t.pointdata[0].endtime;this.sDayPointDdata=t.pointdata[0];g.SevenDayModule.getIns().updateData()}}var e=csv.FunctionsProxy.ENUMS.SEVEN_DAY;var i=this.checkIconRed();this.defaultTypeIndex=0;this.defaultDayIndex=this.curInDay-1;var n=game.SystemSetModel.getInstance().settingData.getValueByType(game.SettingType.qirimubiao);if(n.value==0){this.defaultDayIndex=0}else if(this.getRewardTaskDay()!=-1){this.defaultDayIndex=this.getRewardTaskDay()-1}else if(this.isAllComplete(this.curInDay)){this.defaultDayIndex=this.curInDay+1}else if(this.defaultDayIndex+1>=csv.SevenDayProxy.getIns().maxDay){this.defaultDayIndex=csv.SevenDayProxy.getIns().maxDay-1}if(i){game.ClosureManager.addDot(e)}else{game.ClosureManager.removeDot(e)}this.event(g.SevenDayModel.EVENT_INFO_REFRESH)};t.prototype.parseData=function(t){if(!this.info){this.info=t}else{if(!this.info.daydata){this.info.daydata=t.daydata}else{for(var e=0;e<t.daydata.length;e++){for(var i=0;i<this.info.daydata.length;i++){if(t.daydata[e].day==this.info.daydata[i].day){this.info.daydata[i]=t.daydata[e];break}}}}this.info.pointdata=t.pointdata}this.update()};t.prototype.getJiFenData=function(t){if(this.sDayPointDdata&&this.sDayPointDdata.reward){for(var e=0;e<this.sDayPointDdata.reward.length;e++){var i=this.sDayPointDdata.reward[e];if(i.id==t){return i}}}};t.SINGLE_KEY="sevenday.SevenDayModel";t.EVENT_INFO_REFRESH="EVENT_INFO_REFRESH";t.EVENT_BUY_COMPLETE="EVENT_BUY_COMPLETE";t.QiriTaskType={chengZhangTask:1,limitTimeTask:2};return t}(app.ModelBase);g.SevenDayModel=t})(sevenday||(sevenday={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("targettask_shop.csv");this.targettask_shop=t.getArray();this.targettask_shopMap=t.getMap("id");t=app.Config.getResById("targettask_stage.csv");this.targettask_stage=t.getArray();this.allScore=this.targettask_stage[this.targettask_stage.length-1].pointsneed;t=app.Config.getResById("targettask_task.csv");this.targettask_task=t.getArray();this.targettask_taskMap=t.getMap("id");this.day=parseInt(game.Config.getParams("922").split("-")[0]);this.maxDay=0;for(var e=0;e<this.targettask_task.length;e++){var i=this.targettask_task[e];if(this.maxDay<i.day){this.maxDay=i.day}}};e.prototype.convertType=function(t){return t==1?sevenday.ESevenTabType.ChengZhangTask:sevenday.ESevenTabType.Venture};e.prototype.getCfgList=function(t,e){var i=[];if(e==sevenday.ESevenTabType.Tianqifuli_Shop){for(var n=0;n<this.targettask_shop.length;n++){var a=this.targettask_shop[n];if(a.day==t){i.push(a)}}}else{for(var n=0;n<this.targettask_task.length;n++){var a=this.targettask_task[n];if(a.day==t&&this.convertType(a.tag)==e){i.push(a)}}}return i};e.prototype.getCfgListByType=function(t,e){var i=[];for(var n=0;n<this.targettask_task.length;n++){var a=this.targettask_task[n];if(a.day==t&&a.type==e&&a.taskid!=0){i.push(a)}}return i};e.prototype.getCfgLimitEndTask=function(t,e){for(var i=0;i<this.targettask_task.length;i++){var n=this.targettask_task[i];if(n.day==t&&n.type==e&&n.taskid==0){return n}}return null};e.prototype.getLimitList=function(t){var e=this.getCfgListByType(t,sevenday.SevenDayModel.QiriTaskType.limitTimeTask);var i=this.getCfgLimitEndTask(t,sevenday.SevenDayModel.QiriTaskType.limitTimeTask);e.push(i);return e};e.prototype.getCfgCompleteTask=function(t,e){var i={};for(var n=0;n<this.targettask_task.length;n++){var a=this.targettask_task[n];if(a.day==t&&a.type==e&&a.taskid==0){return a}}return i};e.SINGLE_KEY="sevenday.SevenDayProxy";return e}(app.ModelBase);t.SevenDayProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var sevenday;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){this.data=t;this.cliptianshu.value=util.TimeUtil.getChineseNum(t.day);if(i.SevenDayModel.getIns().curInDay<t.day){game.RedDotView.removeFrom(this)}else{if(i.SevenDayModel.getIns().dayRedDot(t.day)!=undefined){game.RedDotView.addTo(this,this.width,5)}else{game.RedDotView.removeFrom(this)}}var e=i.SevenDayModel.getIns().isAllComplete(t.day);if(e){this.xianshiimg.skin="res/static/qirimubiao/bg_jiaobiao_wancheng.png";this.imglock.visible=false}else{if(i.SevenDayModel.getIns().curInDay+1<t.day){this.gray=true;this.imglock.visible=true;this.xianshiimg.skin=""}else{this.gray=false;this.imglock.visible=false;if(t.day==i.SevenDayModel.getIns().curInDay+1){this.xianshiimg.skin="res/static/qirimubiao/bg_jiaobiao_yulan.png"}else{this.xianshiimg.skin="res/static/qirimubiao/bg_jiaobiao_xianshi.png"}}}if(t.day>i.SevenDayModel.getIns().curInDay+1){this.gray=true}else{this.gray=false}};e.prototype.setSelect=function(t){if(this.data.day-1>i.SevenDayModel.getIns().curInDay){this.imgxuanzhong.visible=false}else{this.imgxuanzhong.visible=t}};e.SINGLE_KEY="sevenday.QiRiMuBiaoDayCell";return e}(ui.qirimubiao.qirimubiaoitem021UI);i.QiRiMuBiaoDayCell=t})(sevenday||(sevenday={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var sevenday;(function(r){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.listdaoju.itemRender=grids.GridView;this.listdaoju.renderHandler=grids.GridView.CommonItemRender;this.btnlingqu.clickHandler=new Laya.Handler(this,this.onLingquHandler);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){this.cfg=t;var e;var i="";if(t.taskid>0){e=csv.TaskProxy.getIns().getCfg(t.taskid);this.taskCfg=e;i=e.item}else{i=t.award}this.listdaoju.array=game.ItemUtil.parserList(i);this.btnlingqu.visible=false;this.yihuode.visible=false;this.yijieshu.visible=false;var n=r.SevenDayModel.getIns().getTaskData(t.id,t.day);game.RedDotView.removeFrom(this.btnlingqu);var a=0;if(n){a=n.fnum;switch(n.statu){case 2:this.yihuode.visible=true;break;case 1:this.btnlingqu.label=app.getLang("lingqu");this.btnlingqu.visible=true;game.RedDotView.addTo(this.btnlingqu);break;case 0:this.btnlingqu.label=app.getLang("sevenday04");this.btnlingqu.visible=true;break;case 3:this.yijieshu.visible=true;break}}else{this.btnlingqu.label=app.getLang("sevenday04");this.btnlingqu.visible=true}if(r.SevenDayModel.getIns().curInDay<t.day){game.RedDotView.removeFrom(this.btnlingqu);if(t.day==r.SevenDayModel.getIns().curInDay+1){this.btnlingqu.label=app.getLang("明日解锁")}else{this.btnlingqu.label=app.getLang("weikaiqi")}this.btnlingqu.disabled=true}else{var o=r.SevenDayModel.getIns().getLimitEndTime(t.day);var s=o-game.Context.getServerTime();if(t.type==2&&s<=0){this.btnlingqu.disabled=true;this.btnlingqu.label=app.getLang("已结束")}else{if(t.taskid>0){this.btnlingqu.disabled=false}else{if(n&&n.statu==1){this.btnlingqu.disabled=false}else{this.btnlingqu.disabled=true}}}}if(t.taskid>0){this.getTaskProgress(e,a,t.progress==1)}else{this.labeltitle.text=app.getLang("完成当前全部限时挑战");this.btnlingqu.label=app.getLang("lingqu")}};e.prototype.getTaskProgress=function(t,e,i){var n=parseInt(t.param.split("-").length>1?t.param.split("-")[1]:t.param.split("-")[0]);if(task.TaskDataAdapter.checkIsSubTypeByCount(t.subtype)){if(e>=n){this.labeltitle.text=t.name+"(1/1)"}else{this.labeltitle.text=t.name+"(0/1)"}}else{if(e>n){e=n}if(i){if(e>=n){this.labeltitle.text=t.name+"(1/1)"}else{this.labeltitle.text=t.name+"(0/1)"}}else{this.labeltitle.text=t.name+"("+e+"/"+n+")"}}};e.prototype.onLingquHandler=function(){var t=this.cfg;if(r.SevenDayModel.getIns().isEnd()){manager.FlowManager.instance.flowByStyle1(app.getLang("sevenday07"));return}var e=r.SevenDayModel.getIns().getTaskData(t.id,t.day);var i=true;if(e){switch(e.statu){case 2:break;case 1:i=false;break;case 0:break}}else{}if(i){if(this.taskCfg.client_params){if(this.taskCfg.client_params==csv.FunctionsProxy.ENUMS.REFINE_HOUSE.toString()){game.ClosureManager.callFunction(csv.FunctionsProxy.ENUMS.REFINE_HOUSE,true,false,"1")}else{game.ClosureManager.callFunction(parseInt(this.taskCfg.client_params))}}}else{app.ProtocolRequest.SevenDayRewardReq(1,t.id)}};e.SINGLE_KEY="sevenday.QiRiMuBiaoTaskCell";return e}(ui.qirimubiao.qirimubiaoitem04newUI);r.QiRiMuBiaoTaskCell=t})(sevenday||(sevenday={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var sevenday;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.SINGLE_KEY="sevenday.QiRiMuBiaoTypeCell";return e}(ui.qirimubiao.qirimubiaoitem03newUI);t.QiRiMuBiaoTypeCell=e})(sevenday||(sevenday={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var sevenday;(function(r){var t=function(i){__extends(t,i);function t(){var t=i!==null&&i.apply(this,arguments)||this;t.listrenwuIndex=0;return t}t.getIns=function(){return app.Singleton.getInstance(t)};Object.defineProperty(t.prototype,"model",{get:function(){return r.SevenDayModel.getIns()},enumerable:true,configurable:true});t.prototype.initialize=function(){i.prototype.initialize.call(this);this.itemList=[];this.posList=[];this.listtianshu.itemRender=r.QiRiMuBiaoDayCell;this.listtianshu.renderHandler=new Laya.Handler(this,this.onDayRenderHandler);this.listtianshu.selectHandler=new Laya.Handler(this,this.onDaySelectHandler);this.listtianshu.selectEnable=true;this.posList.push(0);for(var t=0;t<7;t++){var e=new r.SevenJiFenItem(this["itemjifen0"+(t+1).toString()]);this.posList.push(e.skin.x-this.barjifen.x);this.itemList.push(e)}this.imgmoney.on(Laya.Event.CLICK,this,this.onClickHandler);this.listyeqian.renderHandler=new Laya.Handler(this,this.onTypeListYeQianRender);this.listyeqian.selectHandler=new Laya.Handler(this,this.onTypeListSelectHandler);this.listyeqian.selectEnable=true;this.listrenwu.itemRender=r.QiRiMuBiaoTaskCell;this.listrenwu.renderHandler=new Laya.Handler(this,this.onRenWuHandler);this.renwulist2.itemRender=r.QiRiMuBiaoTaskCell;this.renwulist2.renderHandler=new Laya.Handler(this,this.onRenWuHandler);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.timeView=new activitytaren.ActivityTimeView(this.labeltime,new Laya.Handler(this,this.endHandler),undefined,new Laya.Handler(this,this.updateTimeHandler));this.limitTimeView=new activitytaren.ActivityTimeView(this.daojishi2,new Laya.Handler(this,this.limitTimeEndHandler),app.getLang("{0}后结束"),undefined,activitytaren.ActivityTimeView.TYPE_KEEP_2_BIT)};t.prototype.onDisplay=function(){r.SevenDayModel.getIns().once(r.SevenDayModel.EVENT_INFO_REFRESH,this,this.onGetResult);this.timeView.start(r.SevenDayModel.getIns().endtime);var t=game.SystemSetModel.getInstance().settingData.getValueByType(game.SettingType.qirimubiao);if(t.value==0){game.SystemSetModel.getInstance().setValueByType(1,game.SettingType.qirimubiao)}app.ProtocolRequest.SevenDayDataReq()};t.prototype.onUnDisplay=function(){};t.prototype.onGetResult=function(){this.selectDayIndex=r.SevenDayModel.getIns().defaultDayIndex;this.listrenwuIndex=0;this.listtianshu.selectedIndex=this.selectDayIndex;r.SevenDayModel.getIns().on(r.SevenDayModel.EVENT_INFO_REFRESH,this,this.getInfo);this.getInfo()};t.prototype.getInfo=function(){this.callLater(this.refreshAll)};t.prototype.refreshAll=function(){this.labelmoney.text=game.MoneyModel.format(game.MoneyModel.getIns().getMoney(game.MoneyModel.MONEY_ENUM.GOLD));this.refreshDayTab();this.labeljifen.text=this.model.curScore.toString();this.barjifen.value=this.getPercent();var t=csv.SevenDayProxy.getIns().targettask_stage;for(var e=0;e<t.length;e++){this.itemList[e].setData(t[e])}var i=r.SevenDayModel.getIns().getJiFenData(t[t.length-1].id);if(i&&i.statu==2){this.guangxiao.stop();this.guangxiao.visible=false}this.refreshContext()};t.prototype.refreshContext=function(){var t=this.listyeqian.selectedIndex+1;var e=csv.SevenDayProxy.getIns().getCfgListByType(this.selectDayIndex+1,t);if(t==r.SevenDayModel.QiriTaskType.chengZhangTask){this.renwulist2.visible=true;this.xianshibox.visible=false;this.renwulist2.array=this.getSortList(e)}else{this.renwulist2.visible=false;this.xianshibox.visible=true;this.listrenwu.array=this.getSortList(e);var i=csv.SevenDayProxy.getIns().getCfgCompleteTask(this.selectDayIndex+1,t);this.changzhu.setData(i)}};t.prototype.getSortList=function(t){var e=[];for(var i=0;i<t.length;i++){var n=t[i];var a=r.SevenDayModel.getIns().getTaskData(n.id,n.day);if(a){if(a.statu==1){e.push(n)}}}for(var i=0;i<t.length;i++){var n=t[i];var a=r.SevenDayModel.getIns().getTaskData(n.id,n.day);var o=false;if(a){if(a.statu==0){o=true}}else{o=true}if(o){e.push(n)}}for(var i=0;i<t.length;i++){var n=t[i];var a=r.SevenDayModel.getIns().getTaskData(n.id,n.day);if(a){if(a.statu==2||a.statu==3){e.push(n)}}}if(e.length>0){return e}return t};t.prototype.refreshDayTab=function(){var t=[];for(var e=0;e<7;e++){var i={};i.day=e+1;t.push(i)}this.listtianshu.array=t;this.refreshTypesTab()};t.prototype.refreshTypesTab=function(){var t=[];t.push(r.SevenDayModel.QiriTaskType.chengZhangTask);t.push(r.SevenDayModel.QiriTaskType.limitTimeTask);this.listyeqian.array=t;var e=r.SevenDayModel.getIns().dayRedDot(this.selectDayIndex+1);if(this.model.isAllCompleteGrowTask(this.selectDayIndex+1)||e==2){this.listyeqian.selectedIndex=1}else{this.listyeqian.selectedIndex=0}};t.prototype.updateTimeHandler=function(t){var e=util.TimeUtil.sec2Str(t);this.labeltime.text=app.getLang("sevenday05",e)};t.prototype.endHandler=function(){this.labeltime.text=""};t.prototype.limitTimeEndHandler=function(){this.limitTimeView.stop();this.daojishi2.text=app.getLang("kaifuchongban_text_06")};t.prototype.getPercent=function(){var t=this.model.curScore;var e=this.getIndex(t);var i=csv.SevenDayProxy.getIns().targettask_stage;var n=i[e];if(n){var a=0;var o=i[e-1];if(o){a=o.pointsneed}var s=n.pointsneed;var r=(t-a)/(s-a);var l=(this.posList[e+1]-this.posList[e])*r;return(this.posList[e]+l)/this.posList[this.posList.length-1]}else{return 1}};t.prototype.getIndex=function(t){var e=csv.SevenDayProxy.getIns().targettask_stage;for(var i=0;i<e.length;i++){var n=e[i];if(i==0){if(t>0&&t<n.pointsneed){return i}}if(e[i+1]){var a=e[i+1];if(t>=n.pointsneed&&t<=a.pointsneed-1){return i+1}}else{if(t>=n.pointsneed){return i+1}}}return 0};t.prototype.getRewardNum=function(t){var e=0;var i=csv.SevenDayProxy.getIns().getCfgListByType(this.selectDayIndex+1,t);for(var n=0;n<i.length;n++){var a=i[n];var o=r.SevenDayModel.getIns().getTaskData(a.id,a.day);if(o&&o.statu==2){e++}}return e};t.prototype.onDayRenderHandler=function(t,e){t.setData(t.dataSource);if(e==this.selectDayIndex){t.setSelect(true)}else{t.setSelect(false)}};t.prototype.onDaySelectHandler=function(t){if(t+1>this.model.curInDay+1){manager.FlowManager.instance.flowByStyle1(app.getLang("sevenday06"))}this.updateLimitEndTime(t);if(t>this.model.curInDay){if(this.listtianshu.selectedIndex!=this.selectDayIndex){this.listtianshu.selectedIndex=this.selectDayIndex}return}this.selectDayIndex=t;this.refreshDayTab();this.refreshContext()};t.prototype.updateLimitEndTime=function(t){var e=r.SevenDayModel.getIns().getLimitEndTime(t+1);if(e>0){this.limitTimeView.start(e)}};t.prototype.onTypeListYeQianRender=function(t,e){var i=t.dataSource;var n=csv.SevenDayProxy.getIns().getCfgListByType(this.selectDayIndex+1,i);var a=this.getRewardNum(i);if(i==r.SevenDayModel.QiriTaskType.chengZhangTask){t.btnyeqian.label=app.getLang("成长任务({0}/{1})",a,n.length)}else{t.btnyeqian.label=app.getLang("限时任务({0}/{1})",a,n.length)}var o=this.listyeqian.getCell(e);if(this.listyeqian.selectedIndex==e){o.btnyeqian.selected=true}else{o.btnyeqian.selected=false}var s=this.model.getTypeDot(this.selectDayIndex+1);if(s.indexOf(i)!=-1){game.RedDotView.addTo(t,t.width-10)}else{game.RedDotView.removeFrom(t)}};t.prototype.onTypeListSelectHandler=function(t){this.refreshContext()};t.prototype.onRenWuHandler=function(t,e){t.setData(t.dataSource)};t.prototype.onClickHandler=function(){shop.ShopModel.getIns().moneyTips()};t.SINGLE_KEY="sevenday.QiRiMuBiaoView";return t}(ui.qirimubiao.qirimubiaogaiUI);r.QiRiMuBiaoView=t})(sevenday||(sevenday={}));var sevenday;(function(n){var t=function(){function t(t){this.mSacle=1.3;this.skin=t;this.skin.on(Laya.Event.CLICK,this,this.onClickHandler)}t.prototype.onClickHandler=function(){if(n.SevenDayModel.getIns().isEnd()){manager.FlowManager.instance.flowByStyle1(app.getLang("sevenday07"));return}var t=false;var e=n.SevenDayModel.getIns().getJiFenData(this.cfg.id);if(e){if(e.statu==n.E_DayComData.IS_LINGQUED){t=true}else if(e.statu==n.E_DayComData.COMPLETE_REWARD){}else{t=true}}else{t=true}if(t){tip.TipManager.show(this._itemVo)}else if(e&&e.statu==n.E_DayComData.COMPLETE_REWARD){app.ProtocolRequest.SevenDayRewardReq(n.E_LingquType.TargettaskStage,this.cfg.id)}};t.prototype.setData=function(t){this.cfg=t;if(t.isbigicon){this.skin.scale(this.mSacle,this.mSacle);this.skin.labeljifen.y=65}else{this.skin.scale(1,1);this.skin.labeljifen.y=66}this.skin.labeljifen.text=t.pointsneed.toString();var e=game.ItemUtil.parserList(t.reward)[0];this._itemVo=e;this.skin.imgdaoju.skin=e.getIconUrl();this.skin.labelnum.text=e.count.toString();this.skin.imgyilingqu.visible=false;this.skin.animationlingqu.visible=false;this.skin.animationlingqu.stop();var i=n.SevenDayModel.getIns().getJiFenData(t.id);if(i){if(i.statu==n.E_DayComData.IS_LINGQUED){this.skin.imgyilingqu.visible=true}else if(i.statu==n.E_DayComData.COMPLETE_REWARD){this.skin.imgyilingqu.visible=false;this.skin.animationlingqu.visible=true;this.skin.animationlingqu.play()}}else{}};return t}();n.SevenJiFenItem=t})(sevenday||(sevenday={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var sevenday;(function(s){var t;(function(t){t[t["NOT_COMPLETE"]=0]="NOT_COMPLETE";t[t["COMPLETE_REWARD"]=1]="COMPLETE_REWARD";t[t["IS_LINGQUED"]=2]="IS_LINGQUED"})(t=s.E_DayComData||(s.E_DayComData={}));var n;(function(t){t[t["TargettaskShop"]=0]="TargettaskShop";t[t["Targettask_Task"]=1]="Targettask_Task";t[t["TargettaskStage"]=3]="TargettaskStage"})(n=s.E_LingquType||(s.E_LingquType={}));var i;(function(t){t[t["Tianqifuli_Shop"]=0]="Tianqifuli_Shop";t[t["ChengZhangTask"]=1]="ChengZhangTask";t[t["Venture"]=2]="Venture"})(i=s.ESevenTabType||(s.ESevenTabType={}));var r;(function(t){t[t["NotComolete"]=0]="NotComolete";t[t["Is_finishCanLingQu"]=1]="Is_finishCanLingQu";t[t["IsLingqued"]=2]="IsLingqued"})(r=s.ISevenTask||(s.ISevenTask={}));var e=function(){function t(){}t.prototype.clear=function(){this.day=undefined;this.type=undefined;this.points=undefined};return t}();s.SevenRedVo=e;var a=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){};e.prototype.setData=function(t){this.vo=t;this.cliptianshu.value=util.TimeUtil.getChineseNum(t.day);if(s.SevenDayModel.getIns().curInDay<t.day){game.RedDotView.removeFrom(this)}else{if(s.SevenDayModel.getIns().dayRed(t.day,[i.Tianqifuli_Shop,i.ChengZhangTask,i.Venture])!=undefined){game.RedDotView.addTo(this,this.width,5)}else{game.RedDotView.removeFrom(this)}}if(s.SevenDayModel.getIns().curInDay<t.day){this.gray=true;this.imglock.visible=true}else{this.gray=false;this.imglock.visible=false}};e.prototype.setSelect=function(t){if(this.vo.day-1>s.SevenDayModel.getIns().curInDay){this.imgxuanzhong.visible=false}else{this.imgxuanzhong.visible=t}};return e}(ui.qirimubiao.qirimubiaoitem02UI);var o=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){this.btnyeqian.on(Laya.Event.MOUSE_OVER,this,this.onMouseOver);this.btnyeqian.on(Laya.Event.MOUSE_OUT,this,this.onMouseOut)};e.prototype.onMouseOut=function(){if(this.isSelected){return}this.imgyeqian.skin=this.getIcon(false)};Object.defineProperty(e.prototype,"isSelected",{get:function(){return this.btnyeqian.selected},enumerable:true,configurable:true});e.prototype.onMouseOver=function(){if(this.isSelected){return}this.imgyeqian.skin=this.getIcon(true)};e.prototype.setData=function(t,e){this._day=e;this.tabType=t;if(s.SevenDayModel.getIns().curInDay<e){game.RedDotView.removeFrom(this)}else{if(s.SevenDayModel.getIns().dayRed(e,[t])!=undefined){game.RedDotView.addTo(this,this.width-23)}else{game.RedDotView.removeFrom(this)}}};e.prototype.getIcon=function(t){var e=this._day;if(e==0){e=1}if(t){if(this.tabType==0){return"res/static/qirimubiao/bg_yeqian_tcfl_x.png"}return"res/static/qirimubiao/bg_yeqian_d"+e+"_0"+this.tabType+"_x.png"}else{if(this.tabType==0){return"res/static/qirimubiao/bg_yeqian_tcfl_v.png"}return"res/static/qirimubiao/bg_yeqian_d"+e+"_0"+this.tabType+"_v.png"}};e.prototype.setSelected=function(t){this.btnyeqian.selected=t;this.imgyeqian.skin=this.getIcon(t)};return e}(ui.qirimubiao.qirimubiaoitem03UI);var l=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){this.listdaoju.itemRender=grids.GridView;this.listdaoju.renderHandler=grids.GridView.CommonItemRender;this.btnlingqu.clickHandler=new Laya.Handler(this,this.onLingquHandler)};e.prototype.onLingquHandler=function(){var t=this.cfg;if(s.SevenDayModel.getIns().isEnd()){manager.FlowManager.instance.flowByStyle1(app.getLang("sevenday07"));return}var e=s.SevenDayModel.getIns().getTaskData(t.id,t.day);var i=true;if(e){switch(e.statu){case r.IsLingqued:break;case r.Is_finishCanLingQu:i=false;break;case r.NotComolete:break}}else{}if(i){if(this.taskCfg.client_params){if(this.taskCfg.client_params==csv.FunctionsProxy.ENUMS.REFINE_HOUSE.toString()){game.ClosureManager.callFunction(csv.FunctionsProxy.ENUMS.REFINE_HOUSE,true,false,"1")}else{game.ClosureManager.callFunction(parseInt(this.taskCfg.client_params))}}}else{app.ProtocolRequest.SevenDayRewardReq(n.Targettask_Task,t.id)}};e.prototype.getTaskProgress=function(t,e,i){var n=parseInt(t.param.split("-").length>1?t.param.split("-")[1]:t.param.split("-")[0]);if(task.TaskDataAdapter.checkIsSubTypeByCount(t.subtype)){if(e>=+n){this.labeltitle.text=t.name+"(1/1)"}else{this.labeltitle.text=t.name+"(0/1)"}}else{if(e>n){e=n}if(i){if(e>=n){this.labeltitle.text=t.name+"(1/1)"}else{this.labeltitle.text=t.name+"(0/1)"}}else{this.labeltitle.text=t.name+"("+e+"/"+n+")"}}};e.prototype.setData=function(t){this.cfg=t;var e=csv.TaskProxy.getIns().getCfg(t.taskid);this.taskCfg=e;this.listdaoju.array=game.ItemUtil.parserList(e.item);this.labelhuode.text=app.getLang("sevenday03",t.point);this.btnlingqu.visible=false;this.imgyiwancheng.visible=false;var i=s.SevenDayModel.getIns().getTaskData(t.id,t.day);game.RedDotView.removeFrom(this.btnlingqu);var n=0;if(i){n=i.fnum;switch(i.statu){case r.IsLingqued:this.imgyiwancheng.visible=true;this.labelhuode.visible=false;break;case r.Is_finishCanLingQu:this.btnlingqu.label=app.getLang("lingqu");this.btnlingqu.visible=true;this.labelhuode.visible=true;game.RedDotView.addTo(this.btnlingqu);break;case r.NotComolete:this.btnlingqu.label=app.getLang("sevenday04");this.btnlingqu.visible=true;this.labelhuode.visible=true;break}}else{this.btnlingqu.label=app.getLang("sevenday04");this.btnlingqu.visible=true}if(s.SevenDayModel.getIns().curInDay<t.day){game.RedDotView.removeFrom(this.btnlingqu);this.btnlingqu.label=app.getLang("weikaiqi");this.btnlingqu.mouseEnabled=false;this.btnlingqu.gray=true}else{this.btnlingqu.mouseEnabled=true;this.btnlingqu.gray=false}this.getTaskProgress(e,n,t.progress==1)};return e}(ui.qirimubiao.qirimubiaoitem04UI);var h=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){this.goumaibtn.clickHandler=new Laya.Handler(this,this.onClickHandler);this.gezilist.itemRender=grids.GridView;this.gezilist.renderHandler=grids.GridView.CommonItemRender;this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){};e.prototype.onUnDisplay=function(){};e.prototype.onBuySucceedSend=function(t){if(s.SevenDayModel.getIns().isEnd()){manager.FlowManager.instance.flowByStyle1(app.getLang("sevenday07"))}else{app.ProtocolRequest.SevenDayRewardReq(n.TargettaskShop,t)}};e.prototype.onClickHandler=function(){if(vipcode.VipModel.getIns().vipLvl<this.cfg.vipneed){manager.FlowManager.instance.flowByStyle1(app.getLang("liuhe_ui_3",this.cfg.vipneed));return}var t=game.ItemUtil.parserList(this.cfg.trueprice)[0];var e=game.GridsModel.getIns().getItemCount(t.getItemId());if(e>=t.count){s.SevenDayModel.getIns().once(s.SevenDayModel.EVENT_BUY_COMPLETE,this,this.onRefreshHandler);if(t.count>0){game.Alert.show(app.getLang("targettask_shoptip",t.count+t.itemCfg.namedispaly),new Laya.Handler(this,this.onBuySucceedSend,[this.cfg.id]))}else{this.onBuySucceedSend(this.cfg.id)}}else{if(game.ItemUtil.ENUMS.YUANBAO==t.getItemId()){shop.ShopModel.getIns().moneyTips()}else{manager.FlowManager.instance.flowByStyle1(app.getLang("item_not_enough",t.getName()))}}};e.prototype.onRefreshHandler=function(t){if(t.result==1){this.setData(this.cfg)}};e.prototype.setData=function(t){this.cfg=t;var e=s.SevenDayModel.getIns().getShopData(t.id,t.day);this.isBuyed.visible=false;this.goumai.visible=false;this.imgtitle.skin="res/static/qirimubiao/"+t.titlepic+".png";var i=0;if(e){if(e.buynum>=t.times){this.isBuyed.visible=true}else{this.goumai.visible=true}i=e.buynum}else{this.goumai.visible=true}this.labelxiangou.text=app.getLang("sevenday02",i,t.times);if(t.vipneed||0>0){this.clipvipnum.visible=true;this.imgvip01.visible=true;this.imgvip.visible=true;this.clipvipnum.value=t.vipneed}else{this.clipvipnum.visible=false;this.imgvip01.visible=false;this.imgvip.visible=false}var n=game.ItemUtil.parserList(t.showprice)[0];this.labelmoneynum.text=n.count.toString();this.imgmoney.skin=n.getIconUrl();this.imgmoney.width=37;this.imgmoney.height=32;var a=game.ItemUtil.parserList(t.trueprice)[0];this.goumailab.text=a.count.toString();var o=game.GridsModel.getIns().getItemCount(a.getItemId());if(o<a.count){this.goumailab.color=game.STYLES.RED_COLOR_S}else{this.goumailab.color=game.STYLES.GREEN_COLOR_S}this.jinbiimg.skin=a.getIconUrl();this.jinbiimg.width=37;this.jinbiimg.height=32;this.gezilist.array=game.ItemUtil.parserList(t.showitem);this.gezilist.array=game.ItemUtil.parserList(t.showitem);if(s.SevenDayModel.getIns().buyShopRed(t.id,t.day)){game.RedDotView.addTo(this.goumaibtn)}else{game.RedDotView.removeFrom(this.goumaibtn)}if(s.SevenDayModel.getIns().curInDay<t.day){this.btnweikaiqi.visible=true;this.btnweikaiqi.gray=true;this.btnweikaiqi.mouseEnabled=false;this.goumai.visible=false}else{this.btnweikaiqi.visible=false}};return e}(ui.qirimubiao.qirimubiaoitem05newUI);var p=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.typeIndex=0;t.listfuliIndex=0;t.listrenwuIndex=0;return t}t.getIns=function(){return app.Singleton.getInstance(s.SevenQirimubiaoView)};t.prototype.initialize=function(){this._model=s.SevenDayModel.getIns();this.itemList=[];this.listtianshu.itemRender=a;this.listtianshu.renderHandler=new Laya.Handler(this,this.onRenderHandler);this.listtianshu.selectHandler=new Laya.Handler(this,this.onDaySelectHandler);this.listtianshu.selectEnable=true;this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.posList=[];this.posList.push(0);for(var t=0;t<5;t++){var e=new s.SevenJiFenItem(this["itemjifen0"+(t+1).toString()]);this.posList.push(e.skin.x-this.barjifen.x);this.itemList.push(e)}this.imgmoney.on(Laya.Event.CLICK,this,this.onClickHandler);this.listyeqian.itemRender=o;this.listyeqian.renderHandler=new Laya.Handler(this,this.onTypeListYeQianRender);this.listyeqian.selectHandler=new Laya.Handler(this,this.onTypeListSelectHandler);this.listyeqian.selectEnable=true;this.listfuli.itemRender=h;this.listfuli.renderHandler=new Laya.Handler(this,this.onListRender);this.listfuli.selectHandler=new Laya.Handler(this,this.onListFuLiSelectHandler);this.listrenwu.itemRender=l;this.listrenwu.renderHandler=new Laya.Handler(this,this.onRenWuHandler);this.listrenwu.selectHandler=new Laya.Handler(this,this.onListReWuSelectHandler);this.btnclose.clickHandler=new Laya.Handler(this,this.close);this.timeView=new activitytaren.ActivityTimeView(this.labeltime,new Laya.Handler(this,this.endHandler),undefined,new Laya.Handler(this,this.updateTimeHandler))};t.prototype.onListFuLiSelectHandler=function(t){this.listfuliIndex=t};t.prototype.onListReWuSelectHandler=function(t){this.listrenwuIndex=t};t.prototype.onRenWuHandler=function(t,e){t.setData(t.dataSource)};t.prototype.onListRender=function(t,e){t.setData(t.dataSource)};t.prototype.getSortList=function(t){var e=[];for(var i=0;i<t.length;i++){var n=t[i];var a=s.SevenDayModel.getIns().getTaskData(n.id,n.day);if(a){if(a.statu==r.Is_finishCanLingQu){e.push(n)}}}for(var i=0;i<t.length;i++){var n=t[i];var a=s.SevenDayModel.getIns().getTaskData(n.id,n.day);var o=false;if(a){if(a.statu==r.NotComolete){o=true}}else{o=true}if(o){e.push(n)}}for(var i=0;i<t.length;i++){var n=t[i];var a=s.SevenDayModel.getIns().getTaskData(n.id,n.day);if(a){if(a.statu==r.IsLingqued){e.push(n)}}}return e};t.prototype.refreshContext=function(){var t=this.typeIndex;var e=csv.SevenDayProxy.getIns().getCfgList(this.selectDayIndex+1,t);if(t==s.ESevenTabType.Tianqifuli_Shop){this.listfuli.visible=true;this.listrenwu.visible=false;this.listfuli.array=e;this.listfuli.selectedIndex=this.listfuliIndex;this.listfuli.refresh()}else{this.listfuli.visible=false;this.listrenwu.visible=true;this.listrenwu.array=this.getSortList(e);this.listrenwu.selectedIndex=this.listrenwuIndex;this.listrenwu.refresh()}};t.prototype.onTypeListSelectHandler=function(t){this.typeIndex=t;this.refreshContext()};t.prototype.onTypeListYeQianRender=function(t,e){t.setData(e,this.selectDayIndex+1);if(this.typeIndex==e){t.setSelected(true)}else{t.setSelected(false)}};t.prototype.onDaySelectHandler=function(t){if(t+1>this._model.curInDay){manager.FlowManager.instance.flowByStyle1(app.getLang("sevenday06"))}if(t>this._model.curInDay){if(this.listtianshu.selectedIndex!=this.selectDayIndex){this.listtianshu.selectedIndex=this.selectDayIndex}return}this.selectDayIndex=t;this.refreshTab();this.refreshContext()};t.prototype.onRenderHandler=function(t,e){t.setData(t.dataSource);if(e==this.selectDayIndex){t.setSelect(true)}else{t.setSelect(false)}};t.prototype.onClickHandler=function(){shop.ShopModel.getIns().moneyTips()};t.prototype.updateTimeHandler=function(t){var e=util.TimeUtil.sec2Str(t);this.labeltime.text=app.getLang("sevenday05",e)};t.prototype.endHandler=function(){this.labeltime.text=""};t.prototype.onDisplay=function(){app.SoundManager.getIns().playSound("functionopen");this.timeView.start(s.SevenDayModel.getIns().endtime);guide.GuideModel.getIns().boOpen=false;game.MoneyModel.getIns().on(game.MoneyModel.EVENTS.MONEY_CHANGE,this,this.onMoneyRefresh);vipcode.VipModel.getIns().on(vipcode.VipEvent.VIP_CHANGE,this,this.refreshAll);s.SevenDayModel.getIns().once(s.SevenDayModel.EVENT_INFO_REFRESH,this,this.onGetResult);app.ProtocolRequest.SevenDayDataReq()};t.prototype.onGetResult=function(){this.selectDayIndex=s.SevenDayModel.getIns().defaultDayIndex;this.typeIndex=s.SevenDayModel.getIns().defaultTypeIndex;this.listfuliIndex=0;this.listrenwuIndex=0;s.SevenDayModel.getIns().on(s.SevenDayModel.EVENT_INFO_REFRESH,this,this.getInfo);this.getInfo()};t.prototype.getInfo=function(){this.callLater(this.refreshAll)};t.prototype.onMoneyRefresh=function(){this.refreshAll()};t.prototype.refreshTypesTab=function(){var t=[];t.push(i.Tianqifuli_Shop);t.push(i.ChengZhangTask);t.push(i.Venture);this.listyeqian.array=t;this.listyeqian.selectedIndex=this.typeIndex;this.listyeqian.refresh()};t.prototype.refreshTab=function(){var t=[];for(var e=0;e<7;e++){var i={};i.day=e+1;t.push(i)}this.listtianshu.array=t;this.listtianshu.refresh();if(this.listtianshu.selectedIndex!=this.selectDayIndex){this.listtianshu.selectedIndex=this.selectDayIndex}this.refreshTypesTab()};t.prototype.getIndex=function(t){var e=csv.SevenDayProxy.getIns().targettask_stage;for(var i=0;i<e.length;i++){var n=e[i];if(i==0){if(t>0&&t<n.pointsneed){return i}}if(e[i+1]){var a=e[i+1];if(t>=n.pointsneed&&t<=a.pointsneed-1){return i+1}}else{if(t>=n.pointsneed){return i+1}}}return 0};Object.defineProperty(t.prototype,"model",{get:function(){return s.SevenDayModel.getIns()},enumerable:true,configurable:true});t.prototype.getPercent=function(){var t=this.model.curScore;var e=this.getIndex(t);var i=csv.SevenDayProxy.getIns().targettask_stage;var n=i[e];if(n){var a=0;var o=i[e-1];if(o){a=o.pointsneed}var s=n.pointsneed;var r=(t-a)/(s-a);var l=(this.posList[e+1]-this.posList[e])*r;return(this.posList[e]+l)/this.posList[this.posList.length-1]}else{return 1}};t.prototype.refreshAll=function(){this.labelmoney.text=game.MoneyModel.format(game.MoneyModel.getIns().getMoney(game.MoneyModel.MONEY_ENUM.GOLD));this.refreshTab();this.labeljifen.text=this.model.curScore.toString();this.barjifen.value=this.getPercent();var t=csv.SevenDayProxy.getIns().targettask_stage;for(var e=0;e<t.length;e++){this.itemList[e].setData(t[e])}this.refreshContext()};t.prototype.onUnDisplay=function(){app.SoundManager.getIns().playSound("functionclose");guide.GuideModel.getIns().boOpen=true;s.SevenDayModel.getIns().off(s.SevenDayModel.EVENT_INFO_REFRESH,this,this.getInfo);game.MoneyModel.getIns().off(game.MoneyModel.EVENTS.MONEY_CHANGE,this,this.onMoneyRefresh);vipcode.VipModel.getIns().off(vipcode.VipEvent.VIP_CHANGE,this,this.refreshAll);this.listtianshu.selectedIndex=-1;this.listyeqian.selectedIndex=-1;this.listrenwu.selectedIndex=-1};t.SINGLE_KEY="sevenday.SevenQirimubiaoView";return t}(ui.qirimubiao.qirimubiaoUI);s.SevenQirimubiaoView=p})(sevenday||(sevenday={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var sevenSoul;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.SEVEN_SOUL,i.SevenSoulMainView);game.FuncDotAdapter.registRedFunc(csv.FunctionsProxy.ENUMS.SEVEN_SOUL,i.SevenSoulModel.getIns(),i.SevenSoulModel.getIns().onRedDotChange)};e.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.SevenInfoAck,this,this.onSevenInfoAck);this.addMsgListener(app.ProtocolResponse.SevenUpAck,this,this.onSevenUpAck);this.addMsgListener(app.ProtocolResponse.SevenSpiritLvAck,this,this.onSevenSpiritLvAck);this.addMsgListener(app.ProtocolResponse.SevenEffectChooseAck,this,this.onSevenEffectChooseAck)};e.prototype.onReddotChange=function(){i.SevenSoulModel.getIns().onRedDotChange()};e.prototype.onSevenInfoAck=function(t,e){i.SevenSoulModel.getIns().onSevenInfoAck(e.sevenlv,e.spiritlv,e.effect)};e.prototype.onSevenUpAck=function(t,e){if(e.result){i.SevenSoulModel.getIns().onSevenUpAck(e.sevenlv)}};e.prototype.onSevenSpiritLvAck=function(t,e){if(e.result){i.SevenSoulModel.getIns().onSevenSpiritLvAck(e.index,e.spiritlv)}};e.prototype.onSevenEffectChooseAck=function(t,e){if(e.result){i.SevenSoulModel.getIns().onSevenEffectChooseAck(e.index,e.effect)}};e.SINGLE_KEY="sevenSoul.SevenSoulModule";return e}(app.ModuleBase);i.SevenSoulModule=t})(sevenSoul||(sevenSoul={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var sevenSoul;(function(o){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){this.sevenlv=0;this.spiritlv=[];this.effect=[]};e.prototype.onRedDotChange=function(){var t=false;var e=o.SevenSoulModel.getIns().sevenlv;var i=csv.SevenSoulProxy.getIns().getCfg(e+1);if(i){if(this.canUpgrade(false)){t=true}}else{for(var n=1;n<=7;n++){if(this.canSpiritLvReq(n,false)){t=true;break}}}if(!t){for(var n=0;n<this.spiritlv.length;n++){var a=csv.SevenSoulProxy.getIns().getSpiritCfgById(n+1);if(this.spiritlv[n]>=a.exp){if(this.effect[n]==0){t=true;break}}}}if(t){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.SEVEN_SOUL)}else{game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.SEVEN_SOUL)}return t};e.prototype.onSevenInfoAck=function(t,e,i){this.sevenlv=t;this.spiritlv=e;this.effect=i;o.SevenSoulModel.getIns().event(o.SevenSoulMainView.SEVEN_SOUL_MAINVIEUPDATE)};e.prototype.onSevenUpAck=function(t){this.sevenlv=t;o.SevenSoulModel.getIns().event(o.SevenSoulMainView.SEVEN_SOUL_SEVENUP)};e.prototype.onSevenSpiritLvAck=function(t,e){var i=this.spiritlv[t-1];this.spiritlv[t-1]=e;o.SevenSoulModel.getIns().event(o.SevenSoulMainView.SEVEN_SOUL_MAINVIEUPDATE);var n=csv.SevenSoulProxy.getIns().getSpiritCfgById(t);if(n){var a=e-i;if(a>n.perexp){manager.FlowManager.instance.flowByStyle2(a/n.perexp)}if(e>=n.exp){manager.EffectManager.playStageEffect("skill_jihuochenggong")}}};e.prototype.onSevenEffectChooseAck=function(t,e){var i=csv.SevenSoulProxy.getIns().getSpiritList(t);for(var n=0;n<i.length;n++){this.effect[i[n].id-1]=e[n]}o.SevenSoulModel.getIns().event(o.SevenSoulMainView.SEVEN_SOUL_MAINVIEUPDATE)};e.prototype.getCurEle=function(t){var e=csv.SevenSoulProxy.getIns().getSpiritList(t);var i;for(var n in e){if(this.spiritlv[e[n].id-1]<e[n].exp){i=e[n];break}}return i};e.prototype.canUpgrade=function(t){var e=false;var i=csv.SevenSoulProxy.getIns().getCfg(this.sevenlv+1);if(i){var n=game.Context.getTotalUplv();var a=i.requirement;e=n>=a;if(!e&&t){var o=app.getLang("seven_spirits_tips1",n,a,app.getLang("zuoqi_6"),game.STYLES.RED_COLOR);if(i.type==2){o=app.getLang("seven_spirits_tips1",n,a,"",game.STYLES.RED_COLOR);o=app.getLang("seven_spirits_btn2",o)}manager.FlowManager.instance.flowByStyle1(o)}}return e};e.prototype.canSpiritLvReq=function(t,e){var i=0;var n=this.getCurEle(t);if(n){if(game.GridsModel.getIns().hasEnoughItems(n.cost,false,e)){i=n.id}}else if(e){manager.FlowManager.instance.flowByStyle1(app.getLang("lotus_8"))}return i};e.prototype.onSevenUpReq=function(){if(this.canUpgrade(true)){app.ProtocolRequest.SevenUpReq();return true}return false};e.prototype.onSevenSpiritLvReq=function(t){var e=this.canSpiritLvReq(t,true);if(e>0){app.ProtocolRequest.SevenSpiritLvReq(e);return true}return false};e.prototype.onSevenEffectChooseReq=function(t,e,i){if(i==0){if(e){if(game.GridsModel.getIns().hasEnoughItems(e.refreshcost,false,true)){app.ProtocolRequest.SevenEffectChooseReq(t,e.level,0)}}else{app.ProtocolRequest.SevenEffectChooseReq(t,0,0)}}else{var n=this.spiritlv[e.id-1];var a=this.effect[e.id-1];if(n<e.exp){manager.FlowManager.instance.flowByStyle1(app.getLang("seven_spirits_tips6"));return}if(a>0){manager.FlowManager.instance.flowByStyle1(app.getLang("seven_spirits_tips7"));return}app.ProtocolRequest.SevenEffectChooseReq(t,e.level,i)}};e.prototype.canEffectReq=function(t){var e=false;var i=csv.SevenSoulProxy.getIns().getSpiritList(t);for(var n=i.length-1;n>=0;n--){var a=this.spiritlv[i[n].id-1];var o=this.effect[i[n].id-1];if(a>=i[n].exp&&o==0){e=true;break}}return e};e.prototype.getSpiritExp=function(t){return this.spiritlv[t-1]};e.prototype.getResetCost=function(t){var e=csv.SevenSoulProxy.getIns().getSpiritList(t);var i;var n=0;for(var a=0;a<e.length;a++){if(o.SevenSoulModel.getIns().effect[e[a].id-1]>0){i=game.ItemUtil.parserList(e[a].refreshcost)[0];if(i){n+=i.count}}}if(i){i.setCount(n)}return i};e.SINGLE_KEY="sevenSoul.SevenSoulModel";return e}(app.ModelBase);o.SevenSoulModel=t})(sevenSoul||(sevenSoul={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("seven_spirits.csv");this.cfgMap=t.getMap("id");var e=t.getMapList("skill");this.skills=[];for(var i in e){if(i.length>0){this.skills.push(i)}}t=app.Config.getResById("seven_spiritspromote.csv");this.spiritMap=t.getMapList("spirit");this.spiritCfg=t.getMap("id");var n=t.getArray();this.linkskills=[[],[]];for(var a in n){if(n[a].linkskill1==1||n[a].linkskill2==1){this.linkskills[0].push(n[a])}if(n[a].linkskill1==2||n[a].linkskill2==2){this.linkskills[1].push(n[a])}}};e.prototype.getCfg=function(t){return this.cfgMap[t]};e.prototype.getSpiritList=function(t){return this.spiritMap[t]};e.prototype.getSpiritCfgById=function(t){return this.spiritCfg[t]};e.prototype.getLinkskillArray=function(t){return this.linkskills[t-1]};e.SINGLE_KEY="csv.SevenSoulProxy";return e}(app.ModelBase);t.SevenSoulProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var sevenSoul;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.CLICK,this,this.onClick)};e.prototype.onClick=function(t){t.stopPropagation()};e.prototype.ani4End=function(){this.ani4.off(Laya.Event.COMPLETE,this,this.ani4End);this.ani4.gotoAndStop(this.ani4["_count"]);this.onClose()};e.prototype.onClose=function(){this.ani5.stop();app.ViewManager.toggleView(i.HuluRoleAniView,app.AppContainer.zhezhaoLayer,-1);i.SevenSoulMainView.getIns().playAni(this.dataSource[0],this.dataSource[1])};e.SINGLE_KEY="sevenSoul.HuluRoleAniView";return e}(talk.OtherBirthStoryView);i.HuluRoleAniView=t})(sevenSoul||(sevenSoul={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var sevenSoul;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.ani1.stop();this.imgRole.visible=false;this.imgMask.visible=false;this.imgfaguang.visible=false};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){this._prof=t;this.imgRole.skin="res/static/qizizhihun/role_"+t+".png";this.imgMask.skin="res/static/qizizhihun/role_bg_"+t+".png";this.imghulu.skin="res/static/qizizhihun/hulu_"+t+".png"};e.prototype.setImageHuluGary=function(){this.imgfaguang.visible=false;this.imghulu.visible=true;this.imgRole.visible=false;this.imgMask.visible=false;this.ani1.gotoAndStop(0)};e.prototype.setImageHulu=function(){this.imgfaguang.visible=false;this.imghulu.visible=true;this.imgRole.visible=false;this.imgMask.visible=false;this.ani1.gotoAndStop(5)};e.prototype.setImageRole=function(){this.imgfaguang.visible=false;this.ani1.stop();this.imghulu.visible=false;this.imgRole.visible=true;this.imgMask.visible=false};e.prototype.setImageMask=function(){this.imgfaguang.visible=false;this.ani1.stop();this.imghulu.visible=false;this.imgRole.visible=true;this.imgMask.visible=true};e.prototype.playAni=function(){this.imgfaguang.visible=false;this.imghulu.visible=true;this.imgRole.visible=false;this.imgMask.visible=false;this.ani1.play(0,false)};e.prototype.setSelected=function(t){this.imgfaguang.visible=t};e.SINGLE_KEY="sevenSoul.RoleHuluItem";return e}(ui.qizizhihun.huluitemUI);t.RoleHuluItem=e})(sevenSoul||(sevenSoul={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var sevenSoul;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.ui=new ui.qizizhihun.qiziviewUI;this.dipanani.x+=40;this.dipanani.y-=100;this.bg_jihuo01.y-=100};e.prototype.onUnDisplay=function(){t.prototype.onUnDisplay.call(this);this.ui.removeSelf();i.SevenSoulModel.getIns().event(i.SevenSoulMainView.SEVEN_SOUL_MAINVIEUPDATE)};e.prototype.addArtImgToStage=function(){this.ui.x=this._jihuoData.offX;this.ui.y=this._jihuoData.offY;Laya.stage.addChild(this.ui);this.ui.zOrder=1e4;this.bg_jihuo01.x+=40;t.prototype.addArtImgToStage.call(this)};e.SINGLE_KEY="sevenSoul.SevenJihuoSuccessView";return e}(game.JiHuoSuccessView);i.SevenJihuoSuccessView=t})(sevenSoul||(sevenSoul={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var sevenSoul;(function(m){var t=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.daojubox.width+=40;this.btnclose.x=this.daojubox.x+this.daojubox.width-60;var t=this.daojubox.width;this._lblDes=game.MenuHelper.initDesc("",t);this._lblDes.text="";this._lblDes.x=0};t.prototype.onUnDisplay=function(){e.prototype.onUnDisplay.call(this);this._lblDes.removeSelf()};t.prototype.refreshAll=function(){this.daojubox.vScrollBar.value=0;var t=this.dataSource[0];var e=csv.SevenSoulProxy.getIns().getLinkskillArray(t);var i=m.SevenSoulModel.getIns().effect;var n=csv.SevenSoulProxy.getIns().skills;var a=csv.SkillProxy.getIns().getCfg(app.str2Array(n[t-1],"-")[0]);var o=app.getLang(a.name);var s=csv.SevenSoulProxy.getIns().getCfg(m.SevenSoulModel.getIns().sevenlv).attack;var r=Attributes.decode(s).baseList[0];var l=Attributes.getPropName(r.propId);var h=m.SevenSoulModel.getIns().spiritlv;for(var p=0;p<h.length;p++){var u=h[p];if(u>0){var c=csv.SevenSoulProxy.getIns().getSpiritCfgById(p+1);if(c){r.value+=u/c.perexp*c.rise}}}var g=Attributes.getPropValue(r.propId,r.value,r.formula);var f=app.getLang(a.explain)+app.getLang("seven_spirits_tips10",l,g,game.STYLES.DESC_TXT_COLOR);this.currH=0;this.currH+=tip.TipManager.TIP_INIT_GAP;this.txtTitle.color=game.STYLES.YELLOW_COLOR_S;this.txtTitle.align="left";this.txtTitle.text=o;this.currH+=this.txtTitle.textField.textHeight+tip.TipManager.GAPS.GAP_V_LABLE;this._lblDes.text=app.getLang(f);this._lblDes.y=this.currH;this.daojubox.addChild(this._lblDes);this.currH+=this._lblDes.contextHeight;for(var p=0;p<e.length;p++){var d=i[e[p].id-1]==t?game.STYLES.DESC_TXT_COLOR:game.STYLES.GRAY_COLOR_S;var y=app.getLang("seven_spirits_tips8",app.getLang("rolename_"+e[p].spirit),e[p].level);var v=this.addAttr(this.daojubox,y,0,20,d);var _=this.daojubox.width-v.textField.textWidth;if(e[p].linkskill1==t){this.addAttr(this.daojubox,app.getLang(e[p].powerdes1),v.textField.textWidth+10,20,d,_)}else if(e[p].linkskill2==t){this.addAttr(this.daojubox,app.getLang(e[p].powerdes2),v.textField.textWidth+10,20,d,_)}this.currH+=v.textField.textHeight;this.currH+=tip.TipManager.GAPS.GAP_V_LABLE}this.totalHeight=this.currH+this.daojubox.y;this.totalHeight+=tip.TipManager.GAPS.GAP_V_LABLE+tip.TipManager.GAPS.GAP_BOTTOM;this.tipsbg.height=this.totalHeight>831?831:this.totalHeight;this.tipsbg.width=this.daojubox.width+50};t.SINGLE_KEY="sevenSoul.SevenSoulAttrTipView";return t}(guild.TipHelpInfoView);m.SevenSoulAttrTipView=t})(sevenSoul||(sevenSoul={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var sevenSoul;(function(v){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.offset=0;t.selectIndex=0;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listshenli.itemRender=ui.qizizhihun.qizizhihunshenliitemnewnewUI;this.listshenli.renderHandler=new Laya.Handler(this,this.onRenderHandler);this.jihuowazhihun.visible=false;this.dawabianshen.visible=false;this.btnjihuo.clickHandler=new Laya.Handler(this,this.onSevenUpReq);this.btnbianshen.clickHandler=new Laya.Handler(this,this.onSevenUpReq);this.btnzhuling.clickHandler=new Laya.Handler(this,this.onSevenSpiritLvReq);this.btnchongzhi.clickHandler=new Laya.Handler(this,this.onResetBtnClick);this.btnLeft.clickHandler=new Laya.Handler(this,this.onLeft);this.btnRight.clickHandler=new Laya.Handler(this,this.onRight);this.btnSkill0.clickHandler=new Laya.Handler(this,this.onShowTips,[1]);this.btnSkill1.clickHandler=new Laya.Handler(this,this.onShowTips,[2]);this.labelguishu.text=app.getLang("seven_spirits_tips2");this.labelguishujilu.text=app.getLang("seven_spirits_tips2");this.updateDesc(null);this.labelguishu.on(Laya.Event.LINK,this,this.onHandler);this.labelguishujilu.on(Laya.Event.LINK,this,this.onHandler);this.roleList=[this.boxr1,this.boxr2,this.boxr3,this.boxr4,this.boxr5,this.boxr6,this.boxr7];this.prof=[1,2,3,4,5,6,7];for(var t=1;t<=7;t++){this.getRoleHuluItem(this.roleList[this.prof.indexOf(t)]).setData(t)}this.posList=[new Laya.Point(this.boxr1.x,this.boxr1.y),new Laya.Point(this.boxr3.x,this.boxr3.y),new Laya.Point(this.boxr7.x,this.boxr7.y),new Laya.Point(this.boxr4.x,this.boxr4.y),new Laya.Point(this.boxr6.x,this.boxr6.y),new Laya.Point(this.boxr5.x,this.boxr5.y),new Laya.Point(this.boxr2.x,this.boxr2.y)];this.childIndex=[this.getChildIndex(this.boxr1),this.getChildIndex(this.boxr3),this.getChildIndex(this.boxr7),this.getChildIndex(this.boxr4),this.getChildIndex(this.boxr6),this.getChildIndex(this.boxr5),this.getChildIndex(this.boxr2)];guide.GuideModel.getIns().register(csv.GuideProxy.ENUM_VIEW.SEVEN_SOUL_ALIVE,this.btnjihuo)};t.prototype.onShowTips=function(t){app.ViewManager.toggleDialog(tip.TipSimpleMeiator,1,0,[v.SevenSoulAttrTipView,t])};t.prototype.onRenderHandler=function(t,e){var i=t.dataSource;var n=app.str2Array(app.getLang("xianshiqianggou_text_1"),",");t.labelbanghui.text=app.getLang("seven_spirits_tips3",n[i.level-1]);var a=v.SevenSoulModel.getIns().getSpiritExp(i.id);t.skill0.img.skin="res/icon/masterskill/"+i.powericon1+".png";t.skill1.img.skin="res/icon/masterskill/"+i.powericon2+".png";var o=v.SevenSoulModel.getIns().effect[i.id-1];game.RedDotView.removeFrom(t.skill0);game.RedDotView.removeFrom(t.skill1);if(o==0){t.skill0.img.gray=true;t.skill1.img.gray=true;if(a>=i.exp){game.RedDotView.addTo(t.skill0);game.RedDotView.addTo(t.skill1)}}else if(o==1){t.skill0.img.gray=false;t.skill1.img.gray=true}else if(o==2){t.skill0.img.gray=true;t.skill1.img.gray=false}t.skill0.clickHandler=new Laya.Handler(this,this.onCellItemClick,[i,1,o]);t.skill1.clickHandler=new Laya.Handler(this,this.onCellItemClick,[i,2,o])};t.prototype.onCellItemClick=function(t,e,i){var n=[];if(i==0){n=[tip.TipManager.TIP_BTN_TYPE.SEVEN_SOUL_JIHUO];this.selectType=e}else{n=[tip.TipManager.TIP_BTN_TYPE.SEVEN_SOUL_RESET];this.selectType=0}this.clickData=t;app.ViewManager.toggleDialog(tip.TipSixBoxMediator,1,0,[tip.TipSevenSoulView,t,n,new Laya.Handler(this,this.btnClickHandler),e])};t.prototype.btnClickHandler=function(t){v.SevenSoulModel.getIns().onSevenEffectChooseReq(this.prof[this.selectIndex],this.clickData,this.selectType)};t.prototype.onHandler=function(t){chat.ChatStatic.dellLink(t)};t.prototype.onDisplay=function(){this.callLater(this.refreshAll);v.SevenSoulModel.getIns().on(v.SevenSoulMainView.SEVEN_SOUL_MAINVIEUPDATE,this,this.updateView);v.SevenSoulModel.getIns().on(v.SevenSoulMainView.SEVEN_SOUL_SEVENUP,this,this.onSevenUp);app.ProtocolRequest.SevenInfoReq()};t.prototype.onUnDisplay=function(){v.SevenSoulModel.getIns().off(v.SevenSoulMainView.SEVEN_SOUL_MAINVIEUPDATE,this,this.updateView);v.SevenSoulModel.getIns().off(v.SevenSoulMainView.SEVEN_SOUL_SEVENUP,this,this.onSevenUp);this.animationhulu.stop()};t.prototype.onSevenUpReq=function(){if(v.SevenSoulModel.getIns().onSevenUpReq()){this.btnjihuo.disabled=true;this.btnbianshen.disabled=true}};t.prototype.onSevenSpiritLvReq=function(){if(v.SevenSoulModel.getIns().onSevenSpiritLvReq(this.prof[this.selectIndex])){this.btnzhuling.disabled=true}};t.prototype.onResetBtnClick=function(){var t=v.SevenSoulModel.getIns().getResetCost(this.prof[this.selectIndex]);if(t&&t.count>0){game.Alert.show(app.getLang("seven_spirits_tips5",t.count,t.getName()),Laya.Handler.create(this,this.onSevenEffectChooseReq,[t.getItemId()+"-"+t.count]))}};t.prototype.onSevenEffectChooseReq=function(t){if(game.GridsModel.getIns().hasEnoughItems(t,false,true)){v.SevenSoulModel.getIns().onSevenEffectChooseReq(this.prof[this.selectIndex],null,0)}};t.prototype.onLeft=function(){this.onPrevClick()};t.prototype.onRight=function(){this.onNextClick()};t.prototype.refreshAll=function(){this.updateView(true);this.animationhulu.play(0,true)};t.prototype.playAni=function(t,e){var i=this.prof.indexOf(t);var n=new Laya.Point(this.roleList[i].x,this.roleList[i].y);var a=new Laya.Image;a.anchorX=.5;a.anchorY=.5;a.skin="res/static/qizizhihun/role_"+t+".png";a.x=this.width*.5;a.y=this.height*.5;this.addChild(a);Laya.Tween.to(a,{scaleX:1,scaleY:1,x:n.x,y:n.y},300,null,Laya.Handler.create(this,this.onPlayEnd,[a,t,e]))};t.prototype.onPlayEnd=function(t,e,i){this.getRoleHuluItem(this.roleList[this.prof.indexOf(e)]).setImageRole();t.removeSelf();if(i){var n=this.localToGlobal(new Laya.Point(this.weizhi.x,this.weizhi.y));app.ViewManager.toggleDialog(v.SevenJihuoSuccessView,1,0,[0,"",n.x,n.y])}};t.prototype.getRoleHuluItem=function(t){return t.getChildAt(0)};t.prototype.onSevenUp=function(){this.btnbianshen.disabled=false;this.btnjihuo.disabled=false;var t=v.SevenSoulModel.getIns().sevenlv;var e=csv.SevenSoulProxy.getIns().getCfg(t);var i=csv.SevenSoulProxy.getIns().getCfg(t+1);if(e.type==1){this.getRoleHuluItem(this.roleList[this.prof.indexOf(e.spirit)]).playAni()}else if(e.type==2){if(i){app.ViewManager.toggleView(v.HuluRoleAniView,app.AppContainer.zhezhaoLayer,1,[e.spirit,false])}else{app.ViewManager.toggleView(v.HuluRoleAniView,app.AppContainer.zhezhaoLayer,1,[e.spirit,true])}}this.getRoleHuluItem(this.roleList[this.prof.indexOf(e.spirit)]).setSelected(false);if(i){this.updateButton(i.spirit,i.type,i.requirement);this.gezi2.setData(i.award);this.updateDesc(i);this.getRoleHuluItem(this.roleList[this.prof.indexOf(i.spirit)]).setSelected(true)}};t.prototype.updateView=function(t){if(t===void 0){t=false}this.btnbianshen.disabled=false;this.btnjihuo.disabled=false;var e=v.SevenSoulModel.getIns().sevenlv;var i=csv.SevenSoulProxy.getIns().getCfg(e+1);if(i){this.updateButton(i.spirit,i.type,i.requirement);this.gezi2.setData(i.award);this.updateDesc(i);this.updateRoleView(i.type,i.spirit);this.getRoleHuluItem(this.roleList[this.prof.indexOf(i.spirit)]).setSelected(true)}else{if(t){this.autofind()}for(var n=0;n<this.roleList.length;++n){this.roleList[n].scaleX=1;this.roleList[n].scaleY=1;this.getRoleHuluItem(this.roleList[n]).setImageMask()}this.roleList[0].scaleX=1.5;this.roleList[0].scaleY=1.5;this.getRoleHuluItem(this.roleList[0]).setImageRole();this.updateZhuruView(this.prof[this.selectIndex]);this.showStage(3);this.btnzhuling.disabled=false}v.SevenSoulModel.getIns().onRedDotChange()};t.prototype.autofind=function(){while(this.selectIndex>0){this.updateRole(1)}var t=false;for(var e=0;e<this.prof.length;e++){if(v.SevenSoulModel.getIns().canEffectReq(this.prof[this.selectIndex])){t=true;break}this.updateRole(1)}if(!t){for(var e=0;e<this.prof.length;e++){if(v.SevenSoulModel.getIns().canSpiritLvReq(this.prof[this.selectIndex],false)>0){break}this.updateRole(1)}}};t.prototype.showStage=function(t){this.boxhuluzhili.visible=true;this.gezi2.visible=true;this.labeljiangli.visible=true;this.boxzhuling.visible=false;this.btnLeft.visible=false;this.btnRight.visible=false;this.btnSkill0.visible=false;this.btnSkill1.visible=false;this.boxfengexian.visible=true;if(t==1){this.jihuowazhihun.visible=true;this.dawabianshen.visible=false;this.btnjihuo.visible=true;this.btnbianshen.visible=false}else if(t==2){this.jihuowazhihun.visible=false;this.dawabianshen.visible=true;this.btnjihuo.visible=false;this.btnbianshen.visible=true}else if(t==3){this.boxhuluzhili.visible=false;this.jihuowazhihun.visible=false;this.dawabianshen.visible=false;this.gezi2.visible=false;this.labeljiangli.visible=false;this.boxzhuling.visible=true;this.btnLeft.visible=true;this.btnRight.visible=true;this.btnSkill0.visible=true;this.btnSkill1.visible=true;this.btnjihuo.visible=false;this.btnbianshen.visible=false;this.boxfengexian.visible=false}};t.prototype.updateDesc=function(t){var e=csv.SevenSoulProxy.getIns().skills;var i=csv.SkillProxy.getIns().getCfg(app.str2Array(e[0],"-")[0]);this.guizelab.color=game.STYLES.GRAY_COLOR_S;this.labeltaitou.color=game.STYLES.GRAY_COLOR_S;this.shuoming.color=game.STYLES.GRAY_COLOR_S;this.labeljingangzhili.color=game.STYLES.GRAY_COLOR_S;this.guizelab.text=app.getLang(i.name);this.shuoming.text=app.getLang(i.explain);if(t){if(t.id>7){this.guizelab.color=game.STYLES.DESC_TXT_COLOR_S;this.shuoming.color=game.STYLES.DESC_TXT_COLOR_S;var n=Attributes.decode(csv.SevenSoulProxy.getIns().getCfg(7).attack).baseList[0];var a=Attributes.getPropName(n.propId);var o=Attributes.getPropValue(n.propId,n.value,n.formula);this.shuoming.text=app.getLang(i.explain)+app.getLang("seven_spirits_tips10",a,o,game.STYLES.DESC_TXT_COLOR_S)}else{var n=Attributes.decode(t.attack).baseList[0];var a=Attributes.getPropName(n.propId);var o=Attributes.getPropValue(n.propId,n.value,n.formula);this.shuoming.text=app.getLang(i.explain)+app.getLang("seven_spirits_tips10",a,o,game.STYLES.GRAY_COLOR_S)+app.getLang("seven_spirits_tips9")}}i=csv.SkillProxy.getIns().getCfg(app.str2Array(e[1],"-")[0]);this.labeltaitou.text=app.getLang(i.name);this.labeljingangzhili.text=app.getLang(i.explain);if(t){if(t.id>14){this.labeltaitou.color=game.STYLES.DESC_TXT_COLOR_S;this.labeljingangzhili.color=game.STYLES.DESC_TXT_COLOR_S;var n=Attributes.decode(csv.SevenSoulProxy.getIns().getCfg(14).attack).baseList[0];var a=Attributes.getPropName(n.propId);var o=Attributes.getPropValue(n.propId,n.value,n.formula);this.labeljingangzhili.text=app.getLang(i.explain)+app.getLang("seven_spirits_tips10",a,o,game.STYLES.DESC_TXT_COLOR_S)}else{var n=Attributes.decode(t.attack).baseList[0];var a=Attributes.getPropName(n.propId);var o=Attributes.getPropValue(n.propId,n.value,n.formula);this.labeljingangzhili.text=app.getLang(i.explain)+app.getLang("seven_spirits_tips10",a,o,game.STYLES.GRAY_COLOR_S)+app.getLang("seven_spirits_tips11")}}};t.prototype.updateButton=function(t,e,i){var n=app.getLang("rolename_"+t);this.btnjihuo.label=app.getLang("seven_spirits_btn1",app.getLang("garden_btn_1")+n);var a=game.STYLES.DESC_TXT_COLOR_S;var o=game.Context.getTotalUplv();if(o<i){a=game.STYLES.RED_COLOR_S}else{a=game.STYLES.GREEN_COLOR_S}this.txtmiaoshu.text=app.getLang("seven_spirits_tips1",o,i,app.getLang("zuoqi_6"),a);this.txtjihuomiaoshu.text=app.getLang("seven_spirits_tips1",o,i,app.getLang("zuoqi_6"),a);game.RedDotView.removeFrom(this.btnjihuo);game.RedDotView.removeFrom(this.btnbianshen);game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.SEVEN_SOUL);this.btnjihuo.gray=true;this.btnbianshen.gray=true;if(v.SevenSoulModel.getIns().canUpgrade(false)){game.RedDotView.addTo(this.btnjihuo);game.RedDotView.addTo(this.btnbianshen);game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.SEVEN_SOUL);this.btnjihuo.gray=false;this.btnbianshen.gray=false}if(e==1){this.showStage(1)}else if(e==2){this.showStage(2);this.btnbianshen.label=app.getLang("seven_spirits_btn2",n);var s=app.getLang("seven_spirits_tips1",o,i,"",a);this.txtmiaoshu.text=app.getLang("seven_spirits_btn2",s);this.txtjihuomiaoshu.text=app.getLang("seven_spirits_btn2",s)}};t.prototype.updateZhuruView=function(t){var e=app.getLang("rolename_"+t);this.labeldawa.text=app.getLang("seven_spirits_btn1",e);var i=csv.SevenSoulProxy.getIns().getSpiritList(t);this.listshenli.array=i;var n=v.SevenSoulModel.getIns().getCurEle(t);if(n){var a=app.str2Array(n.cost,"-");var o=parseInt(a[0]);this.moneyIcon.parserIconByItemId(o);var s=game.GridsModel.getIns().getItemCount(o);game.ItemShowUtil.showLabelColor(this.labelxiaohao,parseInt(a[1]),s);this.labelxiaohao.text=s+"/"+a[1];this.txttishi.text=app.getLang("seven_spirits_tips4",n.rise);this.setMax(false);this.imgcengshu.skin="res/static/qizizhihun/bg_hulu_jie_"+n.level+".png";var r=v.SevenSoulModel.getIns().getSpiritExp(n.id);this.labelshuzi.visible=false;if(r<n.exp){this.labelshuzi.text=app.getLang("{0}/{1}",r,n.exp);this.labelshuzi.visible=true;var l=r/n.exp;if(l>1){l=1}this.animationhulu.y=this.imghuluzhezhao.y+Math.floor(this.imghuluzhezhao.height*(1-l))}}else{this.setMax(true);this.imgcengshu.skin="res/static/qizizhihun/bg_hulu_jie_3.png";this.animationhulu.y=this.imghuluzhezhao.y}var h=v.SevenSoulModel.getIns().getResetCost(this.prof[this.selectIndex]);if(h&&h.count>0){this.btnchongzhi.disabled=false}else{this.btnchongzhi.disabled=true}game.RedDotView.removeFrom(this.btnzhuling);var p=v.SevenSoulModel.getIns().canSpiritLvReq(t,false);if(p>0){game.RedDotView.addTo(this.btnzhuling)}game.RedDotView.removeFrom(this.btnLeft);game.RedDotView.removeFrom(this.btnRight);for(var u=1;u<=3;u++){var c=this.selectIndex+u;var g=this.prof[c<=6?c:c-7];var f=v.SevenSoulModel.getIns().canSpiritLvReq(g,false);if(f>0){game.RedDotView.addTo(this.btnRight)}else{var d=v.SevenSoulModel.getIns().canEffectReq(g);if(d){game.RedDotView.addTo(this.btnRight)}}c=this.selectIndex-u;g=this.prof[c>=0?c:c+7];var y=v.SevenSoulModel.getIns().canSpiritLvReq(g,false);if(y>0){game.RedDotView.addTo(this.btnLeft)}else{var d=v.SevenSoulModel.getIns().canEffectReq(g);if(d){game.RedDotView.addTo(this.btnLeft)}}}};t.prototype.setMax=function(t){this.imgyimanji.visible=t;this.moneyIcon.visible=!t;this.labelxiaohao.visible=!t;this.txttishi.visible=!t;this.btnzhuling.visible=!t;this.labelshuzi.visible=!t;this.imghuluyezi.visible=t};t.prototype.updateRoleView=function(t,e){for(var i=0;i<this.prof.length;i++){var n=this.getRoleHuluItem(this.roleList[i]);if(t==1){n.setImageHulu();if(e<=this.prof[i]){n.setImageHuluGary()}}else{n.setImageRole();if(e<=this.prof[i]){n.setImageHulu()}}}};t.prototype.onPrevClick=function(t){if(t===void 0){t=-1}if(this.isPlaying){return}this.updateRole(t)};t.prototype.onNextClick=function(t){if(t===void 0){t=1}if(this.isPlaying){return}this.updateRole(t)};t.prototype.updateRole=function(t){this.offset=t;if(t>0){this.selectIndex++;if(this.selectIndex>=this.roleList.length){this.selectIndex=0}this.roleList.push(this.roleList.shift());this.offset-=1}else if(t<0){this.selectIndex--;if(this.selectIndex<0){this.selectIndex=this.roleList.length-1}this.roleList.unshift(this.roleList.pop());this.offset+=1}else{this.isPlaying=false;this.updateZhuruView(this.prof[this.selectIndex]);return}this.tweenStart()};t.prototype.tweenStart=function(){this.isPlaying=true;for(var t=0;t<this.roleList.length;++t){this.roleList[t].mouseEnabled=true;if(t==0||t==this.roleList.length-1){this.roleList[t].mouseEnabled=false}Laya.Tween.to(this.roleList[t],{x:this.posList[t].x,y:this.posList[t].y,scaleX:t==0?1.5:1,scaleY:t==0?1.5:1},400);if(t==0){this.getRoleHuluItem(this.roleList[t]).setImageRole()}else{this.getRoleHuluItem(this.roleList[t]).setImageMask()}this.roleList[t].parent.setChildIndex(this.roleList[t],this.childIndex[t])}Laya.timer.once(400,this,this.onComplete)};t.prototype.onComplete=function(){this.isPlaying=false;this.updateRole(this.offset)};t.SINGLE_KEY="sevenSoul.SevenSoulMainView";t.SEVEN_SOUL_MAINVIEUPDATE="sevenSoulEvent.SevenSoulMainViewUpdate";t.SEVEN_SOUL_SEVENUP="sevenSoulEvent.SevenUp";return t}(ui.qizizhihun.qizizhihunviewnewnewUI);v.SevenSoulMainView=t})(sevenSoul||(sevenSoul={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var share;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){app.ViewManager.regist(i.ShareDailyView);app.ViewManager.regist(i.ShareWeekView);app.ViewManager.regist(i.ShareFriendView);app.ViewManager.regist(i.ShareTeamView);app.ViewManager.regist(i.ShareLevelUpView);app.ViewManager.regist(i.ShareHelpView);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.SHARE_DAILY,i.ShareDailyView);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.SHARE_WEEK,i.ShareWeekView);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.SHARE_FRIEND_LEVEL,i.ShareFriendView);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.SHARE_QUN_LEVEL,i.ShareTeamView);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.SHARE_LEVEL_UP,i.ShareLevelUpView);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.SHARE_HELP,i.ShareHelpView);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.WX_PAIHANG,i.WxPaiHangVIew);this._model=i.ShareModel.getIns()};e.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.WxShareDataNtf,this,this.onWxShareDataNtf)};e.prototype.onWxShareDataNtf=function(t,e){i.ShareModel.getIns().setShareData(e.data);this._model.event(i.ShareModel.WX_NET_DATA)};e.prototype.onUpdateRedDot=function(){};e.SINGLE_KEY="share.ShareModule";return e}(app.ModuleBase);i.ShareModule=t})(share||(share={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var share;(function(t){var a=function(){function t(){}return t}();t.WxShareClientVo=a;var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){this._dataMap={};this._dataByTypeMap={}};e.prototype.setShareData=function(t){this._dataByTypeMap={};for(var e=0;e<t.length;e++){var i=t[e];this._dataMap[i.id]=i}for(var e=0;e<t.length;e++){var n=csv.ShareProxy.getIns().getCfgById(t[e].id);var i=new a;i.cfg=n;i.net=t[e];if(this._dataByTypeMap[n.rewardtype]){this._dataByTypeMap[n.rewardtype].push(i)}else{this._dataByTypeMap[n.rewardtype]=[];this._dataByTypeMap[n.rewardtype].push(i)}}};e.prototype.getShareData=function(t){return this._dataMap[t]};e.prototype.getShareDataByType=function(t){return this._dataByTypeMap[t]};e.SINGLE_KEY="share.ShareModel";e.WX_NET_DATA="WX_NET_DATA";return e}(app.ModelBase);t.ShareModel=e})(share||(share={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("wx_fenxiang.csv");this.cfgMap=t.getMapList("functionid");this.cfgIdMap=t.getMap("id");this.cfgArr=t.getArray()};e.prototype.getCfg=function(t){return this.cfgMap[t]};e.prototype.getArr=function(){return this.cfgArr};e.prototype.getCfgById=function(t){return this.cfgIdMap[t]};e.SINGLE_KEY="csv.ShareProxy";return e}(app.ModelBase);t.ShareProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var share;(function(i){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.id=1;t.fid=csv.FunctionsProxy.ENUMS.SHARE_DAILY;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.btnchakan.on(Laya.Event.CLICK,this,this.onShare);this.jiangli.itemRender=grids.GridView;this.jiangli.renderHandler=grids.GridView.RenderWithoutGetWay;this.centerLayout=new game.CenterLayoutMediator(this.jiangli,this,98,10);this._model=i.ShareModel.getIns()};t.prototype.onShare=function(){var t={title:"",imageUrl:""};gamesdk.WXminiSDK.getIns().shareWxFriendsChat(t);this.shareBack()};t.prototype.shareBack=function(){app.ProtocolRequest.WxShareInfoSyn(this.id)};t.prototype.onDisplay=function(){this.callLater(this.onGetInfo);this._model.on(i.ShareModel.WX_NET_DATA,this,this.refreshAll)};t.prototype.onGetInfo=function(){app.ProtocolRequest.WxShareDataReq()};t.prototype.onUnDisplay=function(){this._model.off(i.ShareModel.WX_NET_DATA,this,this.refreshAll)};t.prototype.refreshAll=function(){var t=this._model.getShareData(this.id);var e=csv.ShareProxy.getIns().getCfg(this.fid)[0];var i=game.ItemUtil.parserList(e);this.centerLayout.array=i;this.paihangbangguize.text=app.getLang("",t.fnum,e.rewardnum);this.btnchakan.disabled=false;if(t.fnum>=e.rewardnum){this.btnchakan.disabled=true}};t.SINGLE_KEY="share.ShareDailyView";return t}(ui.weixin.weixinview1UI);i.ShareDailyView=t})(share||(share={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var share;(function(i){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.type=3;t.fid=csv.FunctionsProxy.ENUMS.SHARE_FRIEND_LEVEL;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.liebiao.itemRender=i.ShareFriendViewItem2;this.liebiao.renderHandler=new Laya.Handler(this,this.onCellHandler);this._model=i.ShareModel.getIns()};t.prototype.onShare=function(){};t.prototype.onDisplay=function(){this.callLater(this.onGetInfo);this._model.on(i.ShareModel.WX_NET_DATA,this,this.refreshAll)};t.prototype.onGetInfo=function(){app.ProtocolRequest.WxShareDataReq()};t.prototype.onUnDisplay=function(){this._model.off(i.ShareModel.WX_NET_DATA,this,this.refreshAll)};t.prototype.refreshAll=function(){this.liebiao.array=this._model.getShareDataByType(this.type)};t.prototype.onCellHandler=function(t,e){t.setData(t.dataSource)};t.SINGLE_KEY="share.ShareFriendView";return t}(ui.weixin.weixinview2UI);i.ShareFriendView=t})(share||(share={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var share;(function(t){var e=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.btnState=1;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.fenxiangbtn.on(Laya.Event.CLICK,this,this.onClick);this.liebiao.itemRender=grids.GridView;this.liebiao.renderHandler=grids.GridView.RenderWithoutGetWay};t.prototype.onClick=function(){if(this.btnState==1){var t={title:"",imageUrl:"",query:"uid = "+game.AccountModel.accountId+"&"+"tasktype = 3"};gamesdk.WXminiSDK.getIns().shareWxFriendsChat(t)}else{app.ProtocolRequest.WxShareAwardReq(this.id)}};t.prototype.onDisplay=function(){this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){};t.prototype.refreshAll=function(){};t.prototype.setData=function(t){this.id=t.cfg.id;var e=game.ItemUtil.parserList(t.cfg.reward);this.liebiao.array=e;var i=t.cfg.complete.split("-");this.wenzi.text=app.getLang("",i[0],i[1]);this.cishu.text=t.net.fnum+"/"+i[0];this.fenxiangbtn.disabled=false;this.fenxiangbtn.label="分享";this.btnState=1;if(t.net.fnum>=+i[0]){this.fenxiangbtn.label="领取";this.btnState=2;if(t.net.gnum>=t.cfg.rewardnum){this.fenxiangbtn.disabled=true;this.fenxiangbtn.label="已领取";this.btnState=3}}};t.SINGLE_KEY="share.ShareFriendViewItem2";return t}(ui.weixin.weixinitem1UI);t.ShareFriendViewItem2=e})(share||(share={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var share;(function(i){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.type=6;t.btnState=1;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.datibtn.on(Laya.Event.CLICK,this,this.onShare);this._model=i.ShareModel.getIns()};t.prototype.onShare=function(){if(this.btnState==1){var t={title:"",imageUrl:"",query:"uid = "+game.AccountModel.accountId+"&"+"tasktype = 6"};gamesdk.WXminiSDK.getIns().shareWxFriendsChat(t)}else{app.ProtocolRequest.WxShareAwardReq(this.id)}};t.prototype.onDisplay=function(){this.callLater(this.onGetInfo);var t=this.touxianglist.parent.localToGlobal(new Laya.Point(this.touxianglist.x,this.touxianglist.y));if(window["tr_wx_openSub"]){var e={x:t.x,y:t.y,ui:"sub.HlwHelpView",parent:app.AppContainer.zhezhaoLayer};window["tr_wx_openSub"](e)}this._model.on(i.ShareModel.WX_NET_DATA,this,this.refreshAll)};t.prototype.onGetInfo=function(){app.ProtocolRequest.WxShareDataReq()};t.prototype.onUnDisplay=function(){if(window["tr_wx_openSub"]){window["tr_wx_openSub"]("clearCanvas")}this._model.off(i.ShareModel.WX_NET_DATA,this,this.refreshAll)};t.prototype.refreshAll=function(){var t=this._model.getShareDataByType(this.type)[0];this.id=t.cfg.id;this.datibtn.disabled=false;this.datibtn.label="邀请好友";this.btnState=1;if(t.net.fnum>=t.cfg.complete){this.datibtn.label="领取";this.btnState=2;if(t.net.gnum>=t.cfg.rewardnum){this.datibtn.disabled=true;this.datibtn.label="已领取";this.btnState=3}}};t.SINGLE_KEY="share.ShareHelpFriendsView";return t}(ui.weixin.weixinzhulitipUI);i.ShareHelpFriendsView=t})(share||(share={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var share;(function(i){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.type=6;t.fid=csv.FunctionsProxy.ENUMS.SHARE_HELP;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.btnchakan.on(Laya.Event.CLICK,this,this.onShare);this.jiangli.itemRender=grids.GridView;this.jiangli.renderHandler=grids.GridView.RenderWithoutGetWay;this.centerLayout=new game.CenterLayoutMediator(this.jiangli,this,98,10);this._model=i.ShareModel.getIns()};t.prototype.onShare=function(){app.ViewManager.toggleDialog(i.ShareHelpFriendsView,1,1)};t.prototype.onDisplay=function(){this.callLater(this.onGetInfo);this._model.on(i.ShareModel.WX_NET_DATA,this,this.refreshAll)};t.prototype.onGetInfo=function(){app.ProtocolRequest.WxShareDataReq()};t.prototype.onUnDisplay=function(){this._model.off(i.ShareModel.WX_NET_DATA,this,this.refreshAll)};t.prototype.refreshAll=function(){var t=this._model.getShareData(this.type);var e=csv.ShareProxy.getIns().getCfg(this.fid)[0];var i=game.ItemUtil.parserList(e);this.centerLayout.array=i;this.paihangbangguize.text=app.getLang("",t.fnum,e.rewardnum);this.btnchakan.disabled=false;if(t.fnum>=e.rewardnum){this.btnchakan.disabled=true}};t.SINGLE_KEY="share.ShareHelpView";return t}(ui.weixin.weixinview6UI);i.ShareHelpView=t})(share||(share={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var share;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.btnchakan.on(Laya.Event.CLICK,this,this.onClick)};e.prototype.onClick=function(){app.ProtocolRequest.WxShareInfoSyn()};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){};e.SINGLE_KEY="share.ShareItem1";return e}(ui.weixin.weixinview1UI);t.ShareItem1=e})(share||(share={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var share;(function(i){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.type=5;t.fid=csv.FunctionsProxy.ENUMS.SHARE_LEVEL_UP;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.liebiao.itemRender=i.ShareLevelUpViewItem4;this.liebiao.renderHandler=new Laya.Handler(this,this.onCellHandler);this._model=i.ShareModel.getIns()};t.prototype.onShare=function(){};t.prototype.onDisplay=function(){this.callLater(this.onGetInfo);this._model.on(i.ShareModel.WX_NET_DATA,this,this.refreshAll)};t.prototype.onGetInfo=function(){app.ProtocolRequest.WxShareDataReq()};t.prototype.onUnDisplay=function(){this._model.off(i.ShareModel.WX_NET_DATA,this,this.refreshAll)};t.prototype.refreshAll=function(){this.liebiao.array=this._model.getShareDataByType(this.type)};t.prototype.onCellHandler=function(t,e){t.setData(t.dataSource)};t.SINGLE_KEY="share.ShareLevelUpView";return t}(ui.weixin.weixinview2UI);i.ShareLevelUpView=t})(share||(share={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var share;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.fenxiangbtn.on(Laya.Event.CLICK,this,this.onClick);this.liebiao.itemRender=grids.GridView;this.liebiao.renderHandler=grids.GridView.RenderWithoutGetWay};e.prototype.onClick=function(){app.ProtocolRequest.WxShareAwardReq(this.id)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){this.id=t.cfg.id;var e=game.ItemUtil.parserList(t.cfg.reward);this.liebiao.array=e;var i=t.cfg.complete.split("-");this.wenzi.text=app.getLang("",i[0],i[1]);this.cishu.text=t.net.fnum+"/"+i[0];this.fenxiangbtn.label="领取";this.fenxiangbtn.disabled=true;if(t.net.gnum>=t.cfg.rewardnum){this.fenxiangbtn.label="已领取";this.fenxiangbtn.disabled=true}else{if(t.net.fnum>=+i[0]){this.fenxiangbtn.disabled=false}}};e.SINGLE_KEY="share.ShareLevelUpViewItem4";return e}(ui.weixin.weixinitem1UI);t.ShareLevelUpViewItem4=e})(share||(share={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var share;(function(i){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.type=4;t.fid=csv.FunctionsProxy.ENUMS.SHARE_QUN_LEVEL;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.liebiao.itemRender=i.ShareTeamViewItem3;this.liebiao.renderHandler=new Laya.Handler(this,this.onCellHandler);this._model=i.ShareModel.getIns()};t.prototype.onShare=function(){};t.prototype.onDisplay=function(){this.callLater(this.onGetInfo);this._model.on(i.ShareModel.WX_NET_DATA,this,this.refreshAll)};t.prototype.onGetInfo=function(){app.ProtocolRequest.WxShareDataReq()};t.prototype.onUnDisplay=function(){this._model.off(i.ShareModel.WX_NET_DATA,this,this.refreshAll)};t.prototype.refreshAll=function(){this.liebiao.array=this._model.getShareDataByType(this.type)};t.prototype.onCellHandler=function(t,e){t.setData(t.dataSource)};t.SINGLE_KEY="share.ShareTeamView";return t}(ui.weixin.weixinview2UI);i.ShareTeamView=t})(share||(share={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var share;(function(t){var e=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.btnState=1;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.fenxiangbtn.on(Laya.Event.CLICK,this,this.onClick);this.liebiao.itemRender=grids.GridView;this.liebiao.renderHandler=grids.GridView.RenderWithoutGetWay};t.prototype.onClick=function(){if(this.btnState==1){var t={title:"",imageUrl:"",query:"uid = "+game.AccountModel.accountId+"&"+"tasktype = 4"};gamesdk.WXminiSDK.getIns().shareWxFriendsChat(t)}else{app.ProtocolRequest.WxShareAwardReq(this.id)}};t.prototype.onDisplay=function(){this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){};t.prototype.refreshAll=function(){};t.prototype.setData=function(t){this.id=t.cfg.id;var e=game.ItemUtil.parserList(t.cfg.reward);this.liebiao.array=e;var i=t.cfg.complete.split("-");this.wenzi.text=app.getLang("",i[0],i[1]);this.cishu.text=t.net.fnum+"/"+i[0];this.fenxiangbtn.disabled=false;this.fenxiangbtn.label="分享";this.btnState=1;if(t.net.fnum>=+i[0]){this.fenxiangbtn.label="领取";this.btnState=2;if(t.net.gnum>=t.cfg.rewardnum){this.fenxiangbtn.disabled=true;this.fenxiangbtn.label="已领取";this.btnState=3}}};t.SINGLE_KEY="share.ShareTeamViewItem3";return t}(ui.weixin.weixinitem1UI);t.ShareTeamViewItem3=e})(share||(share={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var share;(function(i){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.type=2;t.fid=csv.FunctionsProxy.ENUMS.SHARE_WEEK;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.liebiao.itemRender=i.ShareWeekViewItem1;this.liebiao.renderHandler=new Laya.Handler(this,this.onCellHandler);this._model=i.ShareModel.getIns()};t.prototype.onShare=function(){};t.prototype.onDisplay=function(){this.callLater(this.onGetInfo);this._model.on(i.ShareModel.WX_NET_DATA,this,this.refreshAll)};t.prototype.onGetInfo=function(){app.ProtocolRequest.WxShareDataReq()};t.prototype.onUnDisplay=function(){this._model.off(i.ShareModel.WX_NET_DATA,this,this.refreshAll)};t.prototype.refreshAll=function(){this.liebiao.array=this._model.getShareDataByType(this.type)};t.prototype.onCellHandler=function(t,e){t.setData(t.dataSource)};t.SINGLE_KEY="share.ShareWeekView";return t}(ui.weixin.weixinview2UI);i.ShareWeekView=t})(share||(share={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var share;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.fenxiangbtn.on(Laya.Event.CLICK,this,this.onClick);this.liebiao.itemRender=grids.GridView;this.liebiao.renderHandler=grids.GridView.RenderWithoutGetWay};e.prototype.onClick=function(){var t={title:"",imageUrl:""};gamesdk.WXminiSDK.getIns().shareWxFriendsChat(t);app.ProtocolRequest.WxShareInfoSyn(this.type)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){this.type=t.cfg.rewardtype;var e=game.ItemUtil.parserList(t.cfg.reward);this.liebiao.array=e;this.wenzi.text="周分享"+t.cfg.complete+"次";this.cishu.text=t.net.fnum+"/"+t.cfg.complete};e.SINGLE_KEY="share.ShareWeekViewItem1";return e}(ui.weixin.weixinitem1UI);t.ShareWeekViewItem1=e})(share||(share={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var share;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.listpaiming01.array=[];this.paihangbangguize.text="";if(window["tr_wx_openSub"]){var t=this.parent.localToGlobal(new Laya.Point(this.x,this.y));var e={x:t.x,y:t.y,ui:"sub.HlwRankView",parent:app.AppContainer.zhezhaoLayer};window["tr_wx_openSub"](e)}};e.prototype.onUnDisplay=function(){if(window["tr_wx_openSub"]){window["tr_wx_openSub"]("clearCanvas")}};return e}(ui.weixin.weixinpaihangUI);t.WxPaiHangVIew=e})(share||(share={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var shop;(function(i){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.isKufuInit=true;return t}t.prototype.init=function(){app.ViewManager.regist(i.ShopBetterView,"shangcheng.atlas","lilian.atlas");app.ViewManager.regist(i.ShopHonorView,"shangcheng.atlas");app.ViewManager.regist(i.BlackBaseShopView,"heishi.atlas","shangcheng.atlas");app.ViewManager.regist(i.Jinhuoyulantip,"heishi.atlas","shangcheng.atlas");app.ViewManager.regist(i.ShopEveryDayView,"shangcheng.atlas");app.ViewManager.regist(i.ChongZhiView,"shangcheng.atlas","vip.atlas");app.ViewManager.regist(i.ShopGuildPkView,"shangcheng.atlas");app.ViewManager.regist(i.KuaFuShopView,"shangcheng.atlas");game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.MALL,i.ShopEveryDayView);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.GROW_UP,i.ShopBetterView);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.HONOR_EXCHANGE,i.ShopHonorView);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.BLACK_MARKET,i.BlackBaseShopView);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.HIGH_BLACK_SHOP,i.BlackHighShopView);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.CHONGZHI_SHOP,i.ChongZhiView,null,game.ECommonType.COMMON_SHANG_CHENG_WITHOUT_BTN);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.GUILD_PK_SHOP,i.ShopGuildPkView);game.WindowsResigter.registRedirectMapCheck(csv.FunctionsProxy.ENUMS.CHONGZHI_SHOP,new Laya.Handler(i.ShopModel.getIns(),i.ShopModel.getIns().onChongZhiRedirectHandle));game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.FRIENDS_SHOP,i.FriendsShopView);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.KUAFU_SHOP,i.KuaFuShopView);game.FuncDotAdapter.registRedFunc(csv.FunctionsProxy.ENUMS.MALL,i.ShopModel.getIns(),i.ShopModel.getIns().checkEveryDay)};Object.defineProperty(t.prototype,"model",{get:function(){return i.ShopModel.getIns()},enumerable:true,configurable:true});t.prototype.onHighBlackShop=function(){var t=i.ShopModel.getIns().blackRefreshItem;if(game.GridsModel.getIns().hasEnoughItems(t)){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.HIGH_BLACK_SHOP)}else{game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.HIGH_BLACK_SHOP)}};t.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.RecharegeMallInfoAck,this,this.onFirstChargeNotiHandle);this.addMsgListener(app.ProtocolResponse.KfMallBuyRecordNtf,this,this.onKfMallBuyRecordNtf);this.addMsgListener(app.ProtocolResponse.BuyKfMallWithNumberAck,this,this.onBuyKfMallWithNumberAck)};t.prototype.onBuyKfMallWithNumberAck=function(t,e){if(e.result==1){this.model.event(i.ShopEvent.EVENT_KUAFU_BUY_SUCCEED);this.kuafu_hide_red()}};t.prototype.kuafu_hide_red=function(){if(!this.hasRed()){game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.KUAFU_SHOP)}};t.prototype.hasRed=function(){var t=game.Config.getIntParams(1190);var e=game.GridsModel.getIns().getItemCount(this.model.kuaFuMoneyId);if(e>t&&this.model.canKuaFuBuy()){return true}return false};t.prototype.onKfMallBuyRecordNtf=function(t,e){this.model.kuafuRecordList=e.recordList;this.model.getCanBuyList();this.model.event(i.ShopEvent.EVENT_KUAFU_NOTICE);if(this.isKufuInit){if(this.hasRed()){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.KUAFU_SHOP)}this.isKufuInit=false}else{this.kuafu_hide_red()}};t.prototype.onFirstChargeNotiHandle=function(t,e){i.ShopModel.getIns().chongzhiShopInfo=e;i.ShopModel.getIns().event(i.ShopModel.EVENT_CHONGZHI_SHOP_INFO)};t.SINGLE_KEY="shop.ShopModule";return t}(app.ModuleBase);i.ShopModule=t})(shop||(shop={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var i;(function(t){t[t["WeekCard"]=4]="WeekCard";t[t["ChengZhangJiJing"]=6]="ChengZhangJiJing";t[t["Zhanlin"]=8]="Zhanlin";t[t["Meiritehui"]=9]="Meiritehui";t[t["TouZiLiCai"]=11]="TouZiLiCai";t[t["OneTimeGift"]=12]="OneTimeGift";t[t["OneLife"]=13]="OneLife";t[t["WeekPackage"]=14]="WeekPackage";t[t["MonthPackage"]=15]="MonthPackage";t[t["LimitTimePackage"]=16]="LimitTimePackage"})(i=t.IRechargeType||(t.IRechargeType={}));var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("recharge.csv");this.cfgMap=t.getMap("id");this.cfgList=t.getArray();this.czShopCfgList=[];for(var e=0;e<this.cfgList.length;e++){if(this.cfgList[e].type==1){this.czShopCfgList.push(this.cfgList[e])}}};e.prototype.getRechargeMapCell=function(t){return this.cfgMap[t]};e.prototype.getCfgByType=function(t){var e=this.cfgList;for(var i=0;i<e.length;i++){if(e[i].type==t){return e[i]}}console.log("不存在配置recharge.csv type"+t)};e.prototype.getType=function(t){switch(t){case i.OneTimeGift:return huodong.EHuoDongType.OneTimeGift;case i.WeekCard:return huodong.EHuoDongType.Week;case i.OneLife:return huodong.EHuoDongType.ZhongShengKa;case i.TouZiLiCai:return huodong.EHuoDongType.TouZiLiCai;case i.ChengZhangJiJing:return huodong.EHuoDongType.ChengZhangJiJing;case i.WeekPackage:return huodong.EHuoDongType.WeekLiBao;case i.MonthPackage:return huodong.EHuoDongType.MonthLiBao;case i.LimitTimePackage:return huodong.EHuoDongType.LimtGift}};e.prototype.checkPush=function(t,e){var i=this.getType(t);if(i!=undefined){var n=[];var a=this.huodongProxy.cfglist;for(var o=0;o<a.length;o++){if(a[o].type==i){n.push(a[o])}}if(n.length>0){for(var o=0;o<n.length;o++){var s=n[o];var r=s.recharge;if(r&&r.length>0){var l=r.split(";");if(l.length>0&&l.indexOf(e.id.toString())!=-1){return true}}}return false}}return true};Object.defineProperty(e.prototype,"huodongProxy",{get:function(){return huodong.HuoDongShangChengProxy.getIns()},enumerable:true,configurable:true});e.prototype.getCfgListByType=function(t){var e=[];var i=this.cfgList;for(var n=0;n<i.length;n++){if(i[n].type==t){if(this.checkPush(t,i[n])){e.push(i[n])}}}return e};e.prototype.getArrByType=function(t){var e=[];for(var i=0;i<this.cfgList.length;i++){if(this.cfgList[i].type==t){e.push(this.cfgList[i])}}return e};e.SINGLE_KEY="csv.RechargeProxy";return e}(app.ModelBase);t.RechargeProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var shop;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listdaojugezi.itemRender=grids.GridView;this.listdaojugezi.renderHandler=grids.GridView.CommonItemRender;this.btnlijichongzhi.clickHandler=new Laya.Handler(this,this.onChongZhiHandle)};e.prototype.onChongZhiHandle=function(){i.ShopModel.getIns().openPlatform(this.cfg.id)};Object.defineProperty(e.prototype,"cfg",{get:function(){return this.dataSource},enumerable:true,configurable:true});e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.refreshAll=function(){if(i.ShopModel.getIns().isExtremeBoxSelled(this.cfg)){this.labeltitle.text=app.getLang("chongzhi_text_06");this.listdaojugezi.visible=false;this.label01.visible=false;this.imgtishi.visible=true;this.btnlijichongzhi.visible=false}else{this.labeltitle.text=app.getLang("chongzhi_text_05");var t=game.ItemUtil.parserList(this.cfg.show);this.listdaojugezi.array=t;this.listdaojugezi.visible=true;this.label01.visible=true;this.imgtishi.visible=false;this.btnlijichongzhi.visible=true}};e.prototype.onUnDisplay=function(){};return e}(ui.shangcheng.baoxiangtipUI);i.BaoXiangTip=t})(shop||(shop={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var shop;(function(o){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.imgbg.on(Laya.Event.MOUSE_UP,this,this.onMouseUpHandle);this.imgmoneyzeng.on(Laya.Event.MOUSE_UP,this,this.onTipsHandler);this.initW=this.itemmoney.width;this.imgbaoxiang.skin="";this.imgshouqin.visible=this.imgxuanzhong.visible=this.imgmianfei.visible=false;this.clipmoney.width=0};e.prototype.onTipsHandler=function(){if(this.itemVo)tip.TipManager.show(this.itemVo)};e.prototype.onMouseUpHandle=function(){var t=this.cfg;if(!t){return}o.ShopModel.getIns().openPlatform(t.id)};Object.defineProperty(e.prototype,"cfg",{get:function(){return this.dataSource},enumerable:true,configurable:true});e.prototype.onDisplay=function(){o.ShopModel.getIns().on(o.ShopModel.EVENT_CHONGZHI_SHOP_INFO,this,this.onRefreshHandler)};e.prototype.onUnDisplay=function(){o.ShopModel.getIns().off(o.ShopModel.EVENT_CHONGZHI_SHOP_INFO,this,this.onRefreshHandler)};e.prototype.onRefreshHandler=function(){this.setData()};e.prototype.setData=function(){if(!this.cfg){return}var t=this.cfg;this.imgbaoxiang.skin="res/static/shangcheng/"+t.res+".png";this.clipmoney.value=app.convert_Yuan(t.recharge)+"";var e=game.ItemUtil.parserList(t.reward1)[0];this.labelmoney.text=game.MoneyModel.format(e.count);var i=false;if(parseInt(t.double)){if(o.ShopModel.getIns().isRecgarfed(t)){this.imgzhekou.visible=false}else{this.imgzhekou.visible=true;i=true}}else{this.imgzhekou.visible=false}var n;if(i){n=app.str2Array(t.reward1,"-")}else{n=app.str2Array(t.reward,"-")}if(n&&n.length>=2){this.imgmoneyzeng.visible=true;this.itemmoney.visible=true;var a=game.ItemUtil.createVO(parseInt(n[0]));a.setCount(parseInt(n[1]));if(a){this.itemmoney.icon.skin=a.getIconUrl();this.itemmoney.icon.width=this.initW;this.itemmoney.icon.height=this.initW;this.clipmoneyzeng.visible=true;this.clipmoneyzeng.value="x"+parseInt(n[1])}else{if(ent.DebugConfig.isDebugger){console.log("不存在道具id:",n[0])}}this.itemVo=a}else{this.imgmoneyzeng.visible=false;this.itemmoney.visible=false;this.clipmoneyzeng.value="";this.clipmoneyzeng.visible=false}this.clipmoney.on(Laya.Event.RESIZE,this,this.setClipPos)};e.prototype.setClipPos=function(){this.clipmoney.x=(this.boxmoney.width-this.clipmoney.width-this.imgmoney.width)*.5;this.imgmoney.x=this.clipmoney.x+this.clipmoney.width+3};return e}(ui.xinshangcheng2.yuanbaochongzhiitemUI);o.ChongZhiItemView=t})(shop||(shop={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var shop;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.btnviptequan.clickHandler=new Laya.Handler(this,this.onClickVipPriBtn);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listbaoxiang.itemRender=i.ChongZhiItemView;this.listbaoxiang.vScrollBarSkin=" ";this.listbaoxiang.renderHandler=new Laya.Handler(this,this.onRenderHandler);csv.OtherFuncOpen.register(this.btnyueka,csv.FunctionsProxy.ENUMS.MONTH_CARD,true,csv.FunctionsProxy.ENUMS.CHONGZHI_SHOP);csv.OtherFuncOpen.register(this.btnchengzhangjijin,csv.FunctionsProxy.ENUMS.CHAO_ZHI_JI_JING,true,csv.FunctionsProxy.ENUMS.CHONGZHI_SHOP)};e.prototype.onJiaHandle=function(){i.ShopModel.getIns().chongzhi()};e.prototype.onRenderHandler=function(t,e){t.setData()};e.prototype.onDisplay=function(){vipcode.VipModel.getIns().on(vipcode.VipEvent.VIP_CHANGE,this,this.onVipChange);i.ShopModel.getIns().once(i.ShopModel.EVENT_CHONGZHI_SHOP_INFO,this,this.onInitHandler);app.ProtocolRequest.RecharegeMallInfoReq();this.updateVipData()};e.prototype.onInitHandler=function(){game.MoneyModel.getIns().on(game.MoneyModel.EVENTS.MONEY_CHANGE,this,this.onMoneyChangeEvt);this.onMoneyChangeEvt()};e.prototype.refreshAll=function(){this.listbaoxiang.array=csv.RechargeProxy.getIns().czShopCfgList;this.onOwnerGold()};e.prototype.onUnDisplay=function(){vipcode.VipModel.getIns().off(vipcode.VipEvent.VIP_CHANGE,this,this.onVipChange);game.MoneyModel.getIns().off(game.MoneyModel.EVENTS.MONEY_CHANGE,this,this.onMoneyChangeEvt)};e.prototype.onOwnerGold=function(){};e.prototype.onMoneyChangeEvt=function(){this.callLater(this.refreshAll)};e.prototype.onVipChange=function(){this.updateVipData()};e.prototype.updateVipData=function(){var t=vipcode.VipModel.getIns();var e=parseInt(game.Config.getParams(vipcode.VipModel.PARAM_62));var i=t.maxExp()/e;var n=t.vipExp/e;if(i>0){this.imgguanggaoyunum02.value=i-n+"";this.barvip.value=n/i;this.labelvip.text=n+"/"+i}else{var a=csv.VipProxy.getIns().getArr();var o=a[a.length-1];var s=csv.VipProxy.getIns().getCfg(o.level);this.barvip.value=1;this.labelvip.text=n+"/"+s.exp/e}if(t.isMaxLevel()){this.clipviplv.value=t.vipLvl+"";this.imgguanggaoyunum01.value=t.vipLvl+"";this.boxbanner.visible=false}else{this.clipviplv.value=t.vipLvl==0?"1":t.vipLvl+"";this.imgguanggaoyunum01.value=t.vipLvl+1+"";this.boxbanner.visible=true}};e.prototype.onClickVipPriBtn=function(){game.ClosureManager.callFunction(csv.FunctionsProxy.ENUMS.VIP)};return e}(ui.xinshangcheng2.yuanbaochongzhiviewUI);i.ChongZhiView=t})(shop||(shop={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var shop;(function(e){var i=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.initialize=function(){e.prototype.initialize.call(this);var t=new o;t.initialize(this);this._c=t};return t}(ui.youqingshangdian.youqingshangdiantemUI);var n=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.clsKey="Youqingshangdiantem";t.bgkey="youqingshangdianitem1UI";t.con=s.getIns()._control;return t}t.prototype.getbgItem=function(){return Laya.Pool.getItemByClass(this.bgkey,ui.youqingshangdian.youqingshangdianitem1UI)};t.prototype.getItem=function(){return Laya.Pool.getItemByClass(this.clsKey,i)};return t}(e.ShopBaseRowNode);var a=function(i){__extends(t,i);function t(t){var e=i.call(this,t,n,200)||this;e.friendItemid=8025;e.skin=t;return e}t.prototype.onDisplay=function(){i.prototype.onDisplay.call(this);mall.MallModel.getIns().on(mall.MallModel.UPDATE_MALL_BUY_RECORD_DATA,this,this.onRefreshHandle)};t.prototype.getFuncid=function(){return csv.FunctionsProxy.ENUMS.FRIENDS_SHOP};t.prototype.onRefreshHandle=function(){this.onRefreshView()};t.prototype.timeEnd=function(){this.onRefreshView()};t.prototype.onUnDisplay=function(){i.prototype.onUnDisplay.call(this);mall.MallModel.getIns().off(mall.MallModel.UPDATE_MALL_BUY_RECORD_DATA,this,this.onRefreshHandle)};t.prototype.onMoneyChange=function(){i.prototype.onMoneyChange.call(this);this.skin.imgaixin.skin=game.ItemUtil.parserList(this.friendItemid)[0].getIconUrl();this.skin.imgaixin.scaleX=this.skin.imgaixin.scaleY=.4;this.skin.imgaixin.on(Laya.Event.MOUSE_DOWN,this,this.onMoneyShow);this.skin.labelshuzi.text=game.MoneyModel.format(game.MoneyModel.getIns().getMoney(game.MoneyModel.MONEY_ENUM.FRIENDS))};t.prototype.onMoneyShow=function(){tip.TipManager.show(game.ItemUtil.createVO(this.friendItemid),true)};t.prototype.sortHander=function(t,e){var i=game.ItemUtil.parserList(t.item)[0];var n=game.ItemUtil.parserList(e.item)[0];if(i.getQuality()>n.getQuality()){return-1}else if(i.getQuality()<n.getQuality()){return 1}if(i.itemCfg.id>n.itemCfg.id){return 1}else if(i.itemCfg.id<n.itemCfg.id){return-1}return 0};t.prototype.calculateTime=function(){var t=e.ShopModel.getIns().friendRefreshTime;this._timeControl.start(t)};t.prototype.onRefreshView=function(){i.prototype.onRefreshView.call(this);this.calculateTime();var t=csv.MallProxy.getIns().getArrayByType(csv.MallProxy.ENUM_TYPE.FRIENDS_SHOP);t=t.sort(this.sortHander);this.dataList(t)};return t}(e.BaseShopControl);var o=function(){function t(){this.cnt=1}t.prototype.initialize=function(t){this._model=e.ShopModel.getIns();this._skin=t;this._skin.itemdaoju.locktip=true;this._skin.on(Laya.Event.CLICK,this,this.onMouseClick)};t.prototype.onBuyEnd=function(){this._friendControl.lock=false};t.prototype.onMouseClick=function(){if(this._friendControl.lock==false){if(this._friendControl.isCheckBoxSelected()){if(this._model.buyCallBack(this.__cfg.type,this.__cfg,this.cnt)){this._model.once(e.ShopEvent.BUY_WITH_ACK,this,this.onBuyEnd);this._friendControl.lock=true}}else{tip.TipManager.normalShop(this._itemVo,this._price,new Laya.Handler(this,this.buyCallBack),-1)}}};t.prototype.buyCallBack=function(){this._model.buyCallBack(this.__cfg.type,this.__cfg,this.cnt)};t.prototype.setData=function(t,e){this._friendControl=t;this.__cfg=e;var i=game.ItemUtil.parserList(e.item+"-"+e.num)[0];this._itemVo=i;this._skin.itemdaoju.setData(i);this._skin.labelname.text=i.getName();this._skin.labelname.color=game.STYLES.ITEM_QUALITY_S[i.getQuality()];var n=e.trueprice;this._price=n;this._skin.itemmoney.parserIcon(n,this._skin.labelmoneynum,undefined,true,[game.STYLES.GREEN_COLOR,game.STYLES.RED_COLOR]);this._skin.imgzhenxi.visible=e.res==1;this._skin.isbuyed.visible=this._model.isSellOut(e.id)};return t}();var s=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this._control=new a(this);this._control.panel=this.listdaoju;this._control.timelabel=this.labeltishi01;this._control.checkBox=this.checkboxxuanze};e.SINGLE_KEY="shop.FriendsShopView";return e}(ui.youqingshangdian.youqingshangdianUI);e.FriendsShopView=s})(shop||(shop={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var shop;(function(t){var i=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.setData=function(t){this.labeltitle.text=t};return e}(ui.heishi.jinhuoyulanitem02UI);var p=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.clsKey="shop.JinHuoTitle";return t}t.prototype.createNode=function(t){var e=Laya.Pool.getItemByClass(this.clsKey,i);e.setData(this.list[t]);e.x=0;e.y=this.y;return e};return t}(list.RowMoveBaseNode);var u=function(){function t(){}return t}();var c=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.clsKey="shop.JinHuoItem";return t}t.prototype.createNode=function(t){var e=this.list[t];var i=e.item.split("-");var n=csv.BlackMarketProxy.getIns().getCfg(i[0]);var a=n.item+"-"+n.num;var o=0;var s=Laya.Pool.getItemByClass(this.clsKey,r);s.x=t*(200+o);s.y=this.y;s.setData(a,e.rate);return s};return t}(list.RowMoveBaseNode);var r=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.setData=function(t,e){var i=game.ItemUtil.parserList(t)[0];if(i){this.itemdaoju.setData(i);this.labelname.text=i.getName();this.labelname.color=game.STYLES.ITEM_QUALITY_S[i.getQuality()];this.labelnum.text=Math.floor(e*1e4)/100+"%"}else{this.labelnum.text=t}};return e}(ui.heishi.jinhuoyulanitem01UI);var o=function(){function t(){}t.prototype.getRate=function(t){var e=parseInt(this.arr[t].split("-")[1])/this._allValue;return e*this.getRealValue()};t.prototype.parse=function(){this._allValue=0;var t=this.pro.split(";");this.arr=t;for(var e=0;e<t.length;e++){var i=t[e].split("-");this._allValue+=parseInt(i[1])}};t.prototype.getRealValue=function(){var t=this.groupCfg.numandrate;var e=t.split(";");var i=0;var n=0;for(var a=0;a<e.length;a++){var o=e[a];var s=o.split("-");if(s[0]=="1"){i+=parseInt(s[1])}n+=parseInt(s[1])}return i/n};return t}();var e=function(e){__extends(h,e);function h(){var t=e!==null&&e.apply(this,arguments)||this;t._titleList=[];t._itemList=[];t.listCustom=new list.JListCustom;return t}Object.defineProperty(h.prototype,"curType",{get:function(){return this.dataSource[0]},enumerable:true,configurable:true});h.getIns=function(){return app.Singleton.getInstance(h)};h.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.weizhi.vScrollBarSkin=" ";this.weizhi.vScrollBar.elasticBackTime=0;this.weizhi.vScrollBar.elasticDistance=0};h.prototype.onDisplay=function(){this.callLater(this.onRefreshHandler)};h.prototype.canAdd=function(t){var e=t.pro;var i=e.split(";");var n="";for(var a=0;a<i.length;a++){var o=i[a];if(o!=""){var s=o.split("-");var r=parseInt(s[0]);var l=csv.BlackMarketProxy.getIns().getCfg(r);var h=game.Context.teamLv;if(h>=l.showlevel){var p=l.level.split("-");if(h>=parseInt(p[0])&&h<=parseInt(p[1])){n+=o+";"}}}}return n};h.prototype.getList=function(){var t=[];for(var e=0;e<csv.BlackMarketProxy.getIns().blackmarketgroupArr.length;e++){var i=csv.BlackMarketProxy.getIns().blackmarketgroupArr[e];var n=this.canAdd(i);if(n){var a=new o;if(n.length>0){n=n.substr(0,n.length-1)}a.pro=n;a.groupCfg=i;a.parse();t.push(a)}}return t};h.prototype.onRefreshHandler=function(){this.listCustom.init(this.weizhi);this.listCustom.clear();var t=this.getList();for(var e=0;e<t.length;e++){var i=t[e];var n=i.groupCfg;if(csv.BlackMarketProxy.getIns().getGroupType(n.group)!=this.curType){}else{this.listCustom.split([app.getLang(n.name)],p,40);var a=i.pro.split(";");var o=[];for(var s=0;s<a.length;s++){var r=a[s];var l=new u;l.item=r;l.rate=i.getRate(s);o.push(l)}this.listCustom.split(o,c,198,h.ItemGAP,3)}}this.listCustom.end()};h.prototype.onUnDisplay=function(){this.listCustom.clear()};h.SINGLE_KEY="shop.Jinhuoyulantip";h.ItemGAP=0;return h}(ui.heishi.jinhuoyulantipUI);t.Jinhuoyulantip=e})(shop||(shop={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var shop;(function(s){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}Object.defineProperty(e.prototype,"model",{get:function(){return s.ShopModel.getIns()},enumerable:true,configurable:true});e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.baglist.itemRender=i;this.baglist.renderHandler=new Laya.Handler(this,this.renderHandler);this.imgyuanbao.on(Laya.Event.CLICK,this,this.onTipShow);this.jiabtn.clickHandler=new Laya.Handler(this,this.onTipShow);this.jinbiimg.removeSelf();this.shuominglab.text=app.getLang("kuafushop_text_03")};e.prototype.onTipShow=function(){var t=game.ItemUtil.createVO(this.model.kuaFuMoneyId);tip.TipManager.show(t,true)};e.prototype.renderHandler=function(t){t.setData(t.dataSource)};e.prototype.onDisplay=function(){game.MoneyModel.getIns().on(game.MoneyModel.EVENTS.MONEY_CHANGE,this,this.onMoneyChange);this.model.on(s.ShopEvent.EVENT_KUAFU_BUY_SUCCEED,this,this.refreshAll);this.model.on(s.ShopEvent.EVENT_KUAFU_NOTICE,this,this.refreshAll);game.RoleModel.getIns().on(game.RoleModel.EVENTS.TEAM_LEVEL_CHANGE,this,this.refreshAll);this.onMoneyChange();this.callLater(this.refreshAll)};e.prototype.refreshAll=function(){this.model.getCanBuyList();this.baglist.array=this.model.kfList};e.prototype.onUnDisplay=function(){game.MoneyModel.getIns().off(game.MoneyModel.EVENTS.MONEY_CHANGE,this,this.onMoneyChange);this.model.off(s.ShopEvent.EVENT_KUAFU_BUY_SUCCEED,this,this.refreshAll);this.model.off(s.ShopEvent.EVENT_KUAFU_NOTICE,this,this.refreshAll);game.RoleModel.getIns().off(game.RoleModel.EVENTS.TEAM_LEVEL_CHANGE,this,this.refreshAll);game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.KUAFU_SHOP)};e.prototype.onMoneyChange=function(){this.imgyuanbao.icon.skin=csv.ItemProxy.getItemSmallIcon(this.model.kuaFuMoneyId);this.shuliangimg.text=game.MoneyModel.format(game.MoneyModel.getIns().getMoney(game.MoneyModel.MONEY_ENUM.KUA_FU_RONGYU))};return e}(ui.shangcheng.kuafushangdianUI);s.KuaFuShopView=t;var i=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.itemdaoju.locktip=true;this.on(Laya.Event.CLICK,this,this.onMouseUpHandler)};e.prototype.clear=function(){this.zhezhaobox.visible=false;this.recommend.visible=false;this.imgdi.visible=false;this.shijianlab.text="";this.shouqingimg.visible=false;this.tiaojianlab.text="";this.jiagebox.visible=true};Object.defineProperty(e.prototype,"model",{get:function(){return s.ShopModel.getIns()},enumerable:true,configurable:true});e.prototype.buyItem=function(){if(!this.guanKaCanBuy()){var t=csv.GuajiProxy.getIns().getCfgGuanqia(this.cfg.guanka);manager.FlowManager.instance.flowByStyle1(app.getLang("kfshop_error2",t.chapter));return}var e=this._vo.getKfMaxCnt();if(e<=0){e=1}var i=this.model.getBtnType(this.itemVO);var n=new s.ShopExtVo;n.callBackHandler=new Laya.Handler(this,this.callBackHandler);this.itemVO.ext=n;tip.TipManager.normalShop(this.itemVO,this.cfg.trueprice,new Laya.Handler(this,this.buyCallBack,[this.cfg.id]),e,i)};e.prototype.onMouseUpHandler=function(){if(this.type==s.EKuaFuShopStatus.isSellOut){manager.FlowManager.instance.flowByStyle1(app.getLang("kuafushop_text_02"));return}this.buyItem()};e.prototype.callBackHandler=function(){this.buyItem()};e.prototype.buyCallBack=function(t,e){this.model.kuaFuBuy(t,e)};e.prototype.guanKaCanBuy=function(){if(this.cfg.guanka==0){return true}if(guaji.GuajiModel.getIns().passId-1>=this.cfg.guanka){return true}return false};e.prototype.setData=function(t){this.clear();this._vo=t;this.cfg=t.cfg;var e=game.ItemUtil.createVO(this.cfg.item);e.setCount(this.cfg.num);this.itemdaoju.setData(e);this.labelname.text=e.getName();this.labelname.color=game.STYLES.ITEM_QUALITY_S[e.getQuality()];this.itemVO=e;var i=game.ItemUtil.parserList(this.cfg.trueprice)[0];this.labelmoneynum.text=i.count.toString();this.imgmoney.icon.skin=csv.ItemProxy.getItemSmallIcon(i.getItemId());var n=t.getKuaFuStatus();this.type=n;var a=game.STYLES.GREEN_COLOR_S;if(t.weekLimit<=0){a=game.STYLES.RED_COLOR_S}this.labelmiaoshu.text=app.getLang("kuafushop_text_01",t.haveTime+"/"+t.weekLimit);switch(n){case s.EKuaFuShopStatus.canBuy:break;case s.EKuaFuShopStatus.isSellOut:this.zhezhaobox.visible=true;this.shouqingimg.visible=true;break}if(!this.guanKaCanBuy()){this.jiagebox.visible=false;this.zhezhaobox.visible=true;var o=csv.GuajiProxy.getIns().getCfgGuanqia(this.cfg.guanka);this.tiaojianlab.text=app.getLang("kfshop_error1",o.chapter)}};return e}(ui.shangcheng.shangchengitem9UI)})(shop||(shop={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var shop;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this)};return e}(ui.shangcheng.rongyuyeqianitemUI);t.RongYuYeQianItemView=e})(shop||(shop={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var shop;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.baglist.itemRender=i.ShopItemRenderView;this.baglist.renderHandler=new Laya.Handler(this,this.onRenderHandler);this.baglist.vScrollBarSkin="";this.jiabtn.clickHandler=new Laya.Handler(this,this.chongzhiHandle);this.jinbiimg.removeSelf();this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.chongzhiHandle=function(){i.ShopModel.getIns().chongzhi()};e.prototype.onRenderHandler=function(t){t.setData(t.dataSource)};e.prototype.onDisplay=function(){mall.MallModel.getIns().on(mall.MallModel.UPDATE_MALL_BUY_RECORD_DATA,this,this.onRefreshHandle);game.MoneyModel.getIns().on(game.MoneyModel.EVENTS.MONEY_CHANGE,this,this.onRefreshHandle);i.ShopModel.getIns().actState=waixiantegou.WaiXianTeGouModel.getIns().isActOpen(103);i.ShopModel.getIns().actPhoenixState=waixiantegou.WaiXianTeGouModel.getIns().isActOpen(206);activitytaren.ActivityTaRenModel.getIns().on(activitytaren.ActivityIconStatuManager.EVENT_ACRIVITY_SINGLE_VISIBLE,this,this.onShowHide);this.callLater(this.refreshAll)};e.prototype.onRefreshHandle=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){mall.MallModel.getIns().off(mall.MallModel.UPDATE_MALL_BUY_RECORD_DATA,this,this.onRefreshHandle);game.MoneyModel.getIns().off(game.MoneyModel.EVENTS.MONEY_CHANGE,this,this.onRefreshHandle);activitytaren.ActivityTaRenModel.getIns().off(activitytaren.ActivityIconStatuManager.EVENT_ACRIVITY_SINGLE_VISIBLE,this,this.onShowHide)};Object.defineProperty(e.prototype,"curShop",{get:function(){return 1},enumerable:true,configurable:true});e.prototype.initDesc=function(){};e.prototype.refreshAll=function(){var t=csv.MallProxy.getIns().getArrayByType(this.curShop);this.arr=t;this.baglist.array=t;this.initDesc();if(t.length>0){var e=app.str2Array(t[0].trueprice)}this.shuliangimg.text=game.MoneyModel.format(game.MoneyModel.getIns().getMoney(game.MoneyModel.MONEY_ENUM.GOLD))};e.prototype.onShowHide=function(t){};return e}(ui.shangcheng.chengzhangbianqiangUI);i.ShopBetterView=t})(shop||(shop={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var shop;(function(l){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.itemdaoju.mouseEnabled=false};e.prototype.setData=function(t,e,i){this.index=i;var n;var a=parseInt(n.item);var o=game.ItemUtil.createVO(a);o.setCount(parseInt(n.num));this.itemdaoju.setData(o);var s="";s+=o.getName();this.labelname.text=s;this.imgzhenxi.visible=n.res==1;var r=n.price;this.moneyicon.skin=csv.ItemProxy.getItemSmallIcon(parseInt(r.split("-")[0]));l.ShopModel.getIns().setMoneyLabelColor(this.labelmoneynum,r,game.STYLES.DESC_TXT_COLOR,false);this.locktip=e};Object.defineProperty(e.prototype,"locktip",{set:function(t){this.itemdaoju.locktip=t},enumerable:true,configurable:true});return e}(ui.heishi.heishiitemUI);l.ShopBlackItemView=t})(shop||(shop={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var shop;(function(s){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.gezilist.itemRender=grids.GridView;this.gezilist.renderHandler=grids.GridView.CommonItemRender;this.goumaibtn.clickHandler=new Laya.Handler(this,this.onBuyHandler)};e.prototype.onBuyHandler=function(){if(this.vo){var t=this.vo.cfg;if(!s.ShopModel.getIns().isSellOut(t.id)){s.ShopModel.getIns().buyItem(s.ShopModel.ENNUMS.NORMAL_SHOP,t,s.ShopModel.getIns().getTimes(t))}}};e.prototype.setData=function(t){this.vo=t;var e=t.cfg;var i=[];if(e.showitem!=""){i=game.ItemUtil.parserList(e.showitem)}this.gezilist.array=i;var n=game.ItemUtil.createVO(e.item);this.baoxiangimg.skin=n.getIconUrl();this.libaoname.text=n.getName();this.wenziimg.skin="shangcheng/"+e.des+".png";var a=app.str2Array(e.trueprice);var o=csv.ItemProxy.getItemSmallIcon(parseInt(a[0]));this.imgmoney.skin=o;this.jinbiimg.skin=o;s.ShopModel.getIns().setMoneyLabelColor(this.labelmoneynum,e.showprice,game.STYLES.YELLOW_YB_COLOR_S);s.ShopModel.getIns().setMoneyLabelColor(this.goumailab,e.trueprice,game.STYLES.YELLOW_YB_COLOR_S);if(s.ShopModel.getIns().isSellOut(e.id)){this.goumai.visible=false;this.isBuyed.visible=true}else{this.goumai.visible=true;this.isBuyed.visible=false}if(s.ShopModel.getIns().moneyIsZero(this.vo.cfg)){game.RedDotView.addTo(this.goumaibtn)}else{game.RedDotView.removeFrom(this.goumaibtn)}};return e}(ui.shangcheng.shangchengitem2UI);s.ShopEveryDayItemView=t})(shop||(shop={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var shop;(function(n){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.baglist.itemRender=n.ShopEveryDayItemView;this.baglist.renderHandler=new Laya.Handler(this,this.onRenderHandler);this.baglist.vScrollBarSkin="";this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.jiabtn.on(Laya.Event.CLICK,this,this.onClickHandle)};e.prototype.onClickHandle=function(){n.ShopModel.getIns().chongzhi()};e.prototype.onRenderHandler=function(t){t.setData(t.dataSource)};e.prototype.onDisplay=function(){mall.MallModel.getIns().on(mall.MallModel.UPDATE_MALL_BUY_RECORD_DATA,this,this.onRefreshHandle);game.MoneyModel.getIns().on(game.MoneyModel.EVENTS.MONEY_CHANGE,this,this.onRefreshHandle);this.callLater(this.onInit)};e.prototype.onInit=function(){this.refreshAll();this.baglist.scrollTo(0)};e.prototype.onRefreshHandle=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){mall.MallModel.getIns().off(mall.MallModel.UPDATE_MALL_BUY_RECORD_DATA,this,this.onRefreshHandle);game.MoneyModel.getIns().off(game.MoneyModel.EVENTS.MONEY_CHANGE,this,this.onRefreshHandle)};e.prototype.initDesc=function(){};e.prototype.refreshAll=function(){var t=n.ShopModel.getIns().getEveryDayList();this.shuominglab.text=app.getLang("shop_everyday",(n.ShopModel.getIns().offsetRefreshTime/3600).toFixed(0));this.baglist.array=t;this.initDesc();var e=game.ItemUtil.ENUMS.TONGBI;if(t.length>0){var i=app.str2Array(t[0].cfg.trueprice);e=parseInt(i[0])}this.imghuobi.skin=csv.ItemProxy.getItemSmallIcon(e);this.labelshuzi.text=game.MoneyModel.format(game.MoneyModel.getIns().getMoney(game.MoneyModel.MONEY_ENUM.GOLD))};return e}(ui.shangcheng.meirilibaoUI);n.ShopEveryDayView=t})(shop||(shop={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var shop;(function(r){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onMouseUpHandler=function(){if(r.ShopGuildPkView.getIns().boInTime){var t=-1;r.ShopModel.getIns().buyItem(r.ShopModel.ENNUMS.GUILD_PK_SHOP,this.dataSource,t)}else{manager.FlowManager.instance.flowByStyle1(app.getLang("guild_battle_tips22"))}};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){var e=game.ItemUtil.createVO(t.item);this.labelname.text=e.getName();this.itemdaoju.setData(e);this.itemdaoju.shuzi.text=t.num.toString();if(!r.ShopGuildPkView.getIns().boInTime){this.box1.visible=false;this.box2.y=41;this.itemdaoju.mouseEnabled=true;this.itemdaoju.clickHandler=null;this.imgzhezhao.visible=false;this.imgyishouqing.visible=false;this.off(Laya.Event.CLICK,this,this.onMouseUpHandler)}else{if(r.ShopGuildPkView.getIns().boShopOpen){this.itemdaoju.mouseEnabled=false;this.on(Laya.Event.CLICK,this,this.onMouseUpHandler)}else{this.imgzhezhao.visible=true;this.imgyishouqing.visible=false;this.itemdaoju.mouseEnabled=true;this.itemdaoju.clickHandler=null;this.off(Laya.Event.CLICK,this,this.onMouseUpHandler)}this.box1.visible=true;this.box2.y=18;this.imgmoney.parserIcon(t.trueprice,this.labelmoneynum);var i=parseInt(app.str2Array(t.showprice,"-")[1]);var n=parseInt(app.str2Array(t.trueprice,"-")[1]);var a=Math.floor(n/i*10);this.imgzhekou.skin=game.ResUrls.getZheKou1(a)}var o=mall.MallModel.getIns().getBuyRecord(t.id);if(o){var s=t.times-mall.MallModel.getIns().getCnt(o);if(s){this.imgzhezhao.visible=this.imgyishouqing.visible=false;this.labelmiaoshu.text=app.getLang("guild_battle_tips21",s,game.STYLES.GREEN_COLOR_S)}else{this.off(Laya.Event.CLICK,this,this.onMouseUpHandler);this.imgzhezhao.visible=this.imgyishouqing.visible=true;this.labelmiaoshu.text=app.getLang("guild_battle_tips21",s,game.STYLES.RED_COLOR_S)}}else{this.imgzhezhao.visible=this.imgyishouqing.visible=false;this.labelmiaoshu.text=app.getLang("guild_battle_tips21",t.times,game.STYLES.GREEN_COLOR_S)}};e.SINGLE_KEY="guild.ShopGuildPkItem";return e}(ui.shangcheng.shangchengitem4UI);r.ShopGuildPkItem=t})(shop||(shop={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var shop;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.baglist.itemRender=i.ShopGuildPkItem;this.baglist.renderHandler=new Laya.Handler(this,this.onRenderHandler);this.jiabtn.clickHandler=new Laya.Handler(this,this.chongzhiHandle);game.HelperViewHandler.register(csv.FunctionsProxy.ENUMS.GUILD_PK_SHOP,[this.btntishi,this.labeltishi]);this.imghuobi.parserIconByItemId(game.ItemUtil.ENUMS.YUANBAO)};e.prototype.chongzhiHandle=function(){i.ShopModel.getIns().chongzhi()};e.prototype.onRenderHandler=function(t,e){t.setData(t.dataSource)};e.prototype.onDisplay=function(){guild.GuildPkModel.getIns().setGuildPkName();mall.MallModel.getIns().on(mall.MallModel.UPDATE_MALL_BUY_RECORD_DATA,this,this.refreshList);game.MoneyModel.getIns().on(game.MoneyModel.EVENTS.MONEY_CHANGE,this,this.refreshList);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){mall.MallModel.getIns().off(mall.MallModel.UPDATE_MALL_BUY_RECORD_DATA,this,this.refreshList);game.MoneyModel.getIns().off(game.MoneyModel.EVENTS.MONEY_CHANGE,this,this.refreshList);if(this.boShopOpen){guild.GuildPkModel.getIns().shopFirstOpen=false}};e.prototype.refreshList=function(){this.setMoney();this.baglist.refresh()};e.prototype.refreshAll=function(){this.setMoney();var t=guild.GuildPkModel.getIns().info;if(!t){return}var e=csv.CycleActivityFunction.getIns().getCfg(t.actid);if(!e){return}var i=csv.MallProxy.getIns().getArrayByType(e.award3);this.baglist.array=i;var n=guild.GuildPkModel.getIns().battleInfo;if(n){var a=void 0;if(e.type==1){a=guild.GuildModel.getIns().guildVO?guild.GuildModel.getIns().guildVO.guildInf.guildID:Uint64.ZERO}else{a=Uint64.fromNumber(game.Context.cursvrid)}if(n.finalState==1){if(Uint64.equal(a,t.guildPair[0].guildId)){this.boShopOpen=true}}else if(n.finalState==2){if(Uint64.equal(a,t.guildPair[1].guildId)){this.boShopOpen=true}}else if(n.finalState==3){if(Uint64.equal(a,t.guildPair[0].guildId)){this.boShopOpen=true}else if(Uint64.equal(a,t.guildPair[1].guildId)){this.boShopOpen=true}}}if(t.endTime>game.Context.getServerTime()){this.boInTime=util.TimeUtil.checkIfReachWeekTime(t.startTime,e.date5)}if(!this.boInTime){this.imgwufagoumaibg.visible=this.labelwufagoumai.visible=false}else{if(this.boShopOpen){this.imgwufagoumaibg.visible=this.labelwufagoumai.visible=false}else{this.imgwufagoumaibg.visible=this.labelwufagoumai.visible=true}}var o=app.str2Array(e.date5,"-");this.labeltishi.text=app.getLang("guild_battle_tips20",util.TimeUtil.getWeekCn(parseInt(o[0])),o[1],o[2],o[3])};e.prototype.setMoney=function(){this.labelnum.text=game.MoneyModel.format(game.MoneyModel.getIns().getMoney(game.MoneyModel.MONEY_ENUM.GOLD))};e.SINGLE_KEY="guild.ShopGuildPkView";return e}(ui.shangcheng.zhengbashangchengviewUI);i.ShopGuildPkView=t})(shop||(shop={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var shop;(function(n){var t=function(i){__extends(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}Object.defineProperty(t.prototype,"curShop",{get:function(){return 3},enumerable:true,configurable:true});t.prototype.initialize=function(){i.prototype.initialize.call(this);this.baglist.itemRender=n.ShopRongYuItem;this.baglist.renderHandler=new Laya.Handler(this,this.onRenderHandler);this.baglist.vScrollBarSkin="";this.jiabtn.clickHandler=new Laya.Handler(this,this.chongzhiHandle);this.shuominglab.text=app.getLang("shop_rongyu");this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.dict={};var t=csv.MallProxy.getIns().getArrayByType(this.curShop);for(var e=0;e<t.length;e++){if(!this.dict[t[e].class]){this.dict[t[e].class]=[]}this.dict[t[e].class].push(t[e])}this.jinbiimg.visible=false;guide.GuideModel.getIns().register(csv.GuideProxy.ENUM_VIEW.SHOP_RONGYU_BUY,this,this.getGuideItemBtn,300)};t.prototype.getGuideItemBtn=function(t){var e=0;for(var i=0,n=this.baglist.array.length;i<n;i++){if(this.baglist.array[i].id==t){e=i;break}}this.baglist.scrollTo(e-1);for(var i=0,n=this.baglist.cells.length;i<n;i++){var a=this.baglist.cells[i];if(a.dataSource&&a.dataSource.id==t){return a}}return null};t.prototype.onRenderHandler=function(t){t.setData(t.dataSource)};t.prototype.chongzhiHandle=function(){tip.TipManager.show(game.ItemUtil.createVO(this.buyItemId))};t.prototype.onDisplay=function(){game.MoneyModel.getIns().on(game.MoneyModel.EVENTS.MONEY_CHANGE,this,this.refreshAll);mall.MallModel.getIns().on(mall.MallModel.UPDATE_MALL_BUY_RECORD_DATA,this,this.refreshAll);this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){mall.MallModel.getIns().off(mall.MallModel.UPDATE_MALL_BUY_RECORD_DATA,this,this.refreshAll);game.MoneyModel.getIns().off(game.MoneyModel.EVENTS.MONEY_CHANGE,this,this.refreshAll)};t.prototype.checek=function(t){var e=true;var i=mall.MallModel.getIns().getBuyRecord(t);var n=csv.MallProxy.getIns().getItemCfgById(t);if(n&&n.limit>0){if(i&&(i.dailynum==0&&n.limit-i.total<=0)){e=false}}return e};t.prototype.refreshAll=function(){var t=[];var e=Object.keys(this.dict);var i=[],n;for(var a=0;a<e.length;a++){i=this.dict[e[a]];for(var o=0;o<i.length;o++){n=this.dict[e[a]][o];if(game.Context.teamLv>=n.teamlv&&this.checek(n.id)){t.push(n);break}}}this.baglist.array=t;this.refreshShowMoney(t)};t.prototype.refreshShowMoney=function(t){this.curList=t;var e=game.ItemUtil.ENUMS.TONGBI;if(t.length>0){var i=app.str2Array(t[0].trueprice);e=parseInt(i[0])}this.buyItemId=e;this.imgyuanbao.icon.skin=csv.ItemProxy.getItemSmallIcon(e);this.shuliangimg.text=game.MoneyModel.format(game.MoneyModel.getIns().getMoney(game.MoneyModel.MONEY_ENUM.RONGYU))};return t}(ui.shangcheng.rongyulibaonewUI);n.ShopHonorView=t})(shop||(shop={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var shop;(function(a){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.imgmoneybg.on(Laya.Event.MOUSE_UP,this,this.onMouseUpHandler)};e.prototype.onMouseUpHandler=function(){if(this.data){if(a.ShopModel.getIns().actState&&this.data.activityid==11){app.ViewManager.toggleDialog(waixiantegou.WaiXianTeGouShopTipView,1,0,this.data)}else if(a.ShopModel.getIns().actPhoenixState&&this.data.activityid==43){app.ViewManager.toggleDialog(waixiantegou.WaiXianTeGouPhoenixShopTipView,1,0,this.data)}else{a.ShopModel.getIns().buyItem(a.ShopModel.ENNUMS.NORMAL_SHOP,this.data,a.ShopModel.getIns().getTimes(this.data))}}};e.prototype.setData=function(t){this.data=t;var e=t.item;var i=game.ItemUtil.createVO(e);this.labelname.text=i.getName();this.itemdaoju.setData(i);this.itemdaoju.clickHandler=new Laya.Handler(this,this.onMouseUpHandler);var n=t.trueprice||t.price;this.imgmoney.icon.skin=csv.ItemProxy.getItemSmallIcon(parseInt(n.split("-")[0]));a.ShopModel.getIns().setMoneyLabelColor(this.labelmoneynum,n);this.tuijianjiaobiao.skin=t.res;this.shouqingimg.visible=a.ShopModel.getIns().isSellOut(t.id)};return e}(ui.shangcheng.shangchengitem1UI);a.ShopItemRenderView=t})(shop||(shop={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var shop;(function(n){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.lock=false;return t}t.prototype.initialize=function(){e.prototype.initialize.call(this);this.listdaoju.itemRender=n.ShopBlackItemView;this.listdaoju.renderHandler=new Laya.Handler(this,this.onRenderHandler);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.btnshuaxin.clickHandler=new Laya.Handler(this,this.onClickHandle);this.checkboxxuanze.clickHandler=new Laya.Handler(this,this.onCheckHandle);guide.GuideModel.getIns().register(csv.GuideProxy.ENUM_VIEW.SHOP_BLACK_REFRESH,this.btnshuaxin);guide.GuideModel.getIns().register(csv.GuideProxy.ENUM_VIEW.SHOP_BLACK_BUY,this,this.getGuideItemBtn);this.imgmoney01.on(Laya.Event.MOUSE_DOWN,this,this.onMoneyHandler);this.imgmoney02.on(Laya.Event.MOUSE_DOWN,this,this.onGoldHandler)};t.prototype.onMoneyHandler=function(){tip.TipManager.show(game.ItemUtil.createVO(8e3),true)};t.prototype.onGoldHandler=function(){n.ShopModel.getIns().openChongZhiShop()};t.prototype.getGuideItemBtn=function(t){var e=this.listdaoju.getCell(t-1);return e};t.prototype.onCheckHandle=function(){for(var t=0;t<this.listdaoju.cells.length;t++){var e=this.listdaoju.cells[t];e.locktip=this.checkboxxuanze.selected}};t.prototype.refreshMoney=function(t,e,i){e.text=game.MoneyModel.format(game.MoneyModel.getIns().getMoney(i));t.on(Laya.Event.MOUSE_DOWN,this,this.onMoneyClickHandle,[i])};t.prototype.onMoneyClickHandle=function(t){};t.prototype.onClickHandle=function(){var t=game.GridsModel.getIns().hasEnoughItems(this._refreshVO);if(!t){manager.FlowManager.instance.flowByStyle1(app.getLang("item_not_enough",this._refreshVO.getName()))}else{app.ProtocolRequest.FreshBlackMallReq()}};t.prototype.onDisplay=function(){this.itemdaoju.showBagCount(1);game.GridsModel.getIns().on(game.GridsModel.EVENTS.UPDATE,this,this.onGridsUpdate);game.MoneyModel.getIns().on(game.MoneyModel.EVENTS.MONEY_CHANGE,this,this.onGetBlackShop);mall.MallModel.getIns().on(mall.MallModel.UPDATE_BLACK_SHOP_DATA,this,this.onGetBlackShop);app.ProtocolRequest.BlackMallReq()};t.prototype.onGetBlackShop=function(){this.callLater(this.refreshAll)};t.prototype.onRenderHandler=function(t,e){t.setData(t.dataSource,this.checkboxxuanze.selected,e);t.on(Laya.Event.CLICK,this,this.onMouseDownHandle,[t])};t.prototype.onBuyEndHadnler=function(t){this.lock=false};t.prototype.onMouseDownHandle=function(t){if(this.lock){return}var e=mall.MallModel.getIns().blackmallList.indexOf(t.dataSource);if(e==-1){return}if(this.checkboxxuanze.selected){if(n.ShopModel.getIns().buyBlack(t.dataSource,1,e)){this.lock=true;mall.MallModel.getIns().once(mall.MallModel.UPDATE_BLACK_SHOP_DATA,this,this.onBuyEndHadnler,[t])}}else{n.ShopModel.getIns().buyBlackItem(t.dataSource,e)}};t.prototype.onGridsUpdate=function(){this.refreshItem()};t.prototype.onUnDisplay=function(){game.GridsModel.getIns().off(game.GridsModel.EVENTS.UPDATE,this,this.onGridsUpdate);game.MoneyModel.getIns().off(game.MoneyModel.EVENTS.MONEY_CHANGE,this,this.onGetBlackShop);mall.MallModel.getIns().off(mall.MallModel.UPDATE_BLACK_SHOP_DATA,this,this.onGetBlackShop);this.lock=false};t.prototype.sortHandler=function(t,e){return 0};t.prototype.sortList=function(t){var e=[];for(var i=0;i<t.length;i++){var n=t[i]}e=e.sort(this.sortHandler);for(var i=0;i<t.length;i++){var n=t[i]}return e};t.prototype.refreshList=function(){var t=mall.MallModel.getIns().blackmallList||[];this.listdaoju.array=t};t.prototype.refreshItem=function(){var t=n.ShopModel.getIns().blackRefreshItem;var e=t.split("-");var i=game.ItemUtil.createVO(parseInt(e[0]));i.setCount(parseInt(e[1]));this.itemdaoju.setData(i);this._refreshVO=i};t.prototype.refreshAll=function(){this.refreshList();this.labeltishi.text=app.getLang("shop_black");this.labelxuanze.text=app.getLang("shop_tips");this.refreshItem();this.refreshMoney(this.imgmoney01,this.labelmoneynum01,game.MoneyModel.MONEY_ENUM.SILVER);this.refreshMoney(this.imgmoney02,this.labelmoneynum02,game.MoneyModel.MONEY_ENUM.GOLD)};return t}(ui.heishi.heishiUI);n.ShopMainBlackView=t})(shop||(shop={}));var shop;(function(e){var t=function(){function t(t){this.priorityList=[];this.cfg=t;this.priorityList=[];this.checkProority(this.cfg.priority)}t.prototype.refresh=function(){};t.prototype.checkProority=function(t){if(t!=0){var e=csv.MallProxy.getIns().getArrayByType(2);for(var i=0;i<e.length;i++){if(t==e[i].id){this.priorityList.push(e[i].id);if(e[i].priority!=0){this.checkProority(e[i].priority)}}}}};t.prototype.isCanShow=function(t){if(!e.ShopModel.getIns().isCanBuyByDay(this.cfg)){return false}if(this.cfg.priority!=0){if(e.ShopModel.getIns().isSellOut(this.cfg.priority)){this.delNodeById(t,this.cfg.priority);return true}return false}else{}return true};t.prototype.delNodeById=function(t,e){for(var i=0;i<t.length;i++){if(t[i].cfg.id==e){t.splice(i,1)}}};return t}();e.EveryDayShopVO=t})(shop||(shop={}));var shop;(function(e){var t=function(){function t(t){this.id=t;this.cfg=csv.MallProxy.getIns().kuafu_shop[t]}Object.defineProperty(t.prototype,"model",{get:function(){return e.ShopModel.getIns()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"mb",{get:function(){return this.model.getKfData(this.id)},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"weekLimit",{get:function(){return this.curWeekLimit(this.mb,this.cfg.id)},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"haveTime",{get:function(){if(this.mb){return this.weekLimit-this.mb.weeknum}else{return this.cfg.weektimes}},enumerable:true,configurable:true});t.prototype.haveCnt=function(){var t=app.str2Array(this.cfg.trueprice,"-");var e=game.GridsModel.getIns().getItemCount(parseInt(t[0]));var i=e/parseInt(t[1]);return Math.floor(i)};t.prototype.getKfMaxCnt=function(){var t=this.cfg;var e=this.haveCnt();var i=this.curWeekLimit(this.mb,this.cfg.id);if(e>i){e=i}if(this.mb){var n=i-this.mb.weeknum;if(e>n){e=n}}return e};t.prototype.canBuy=function(){return this.getKfMaxCnt()>0};t.prototype.getKuaFuStatus=function(){if(this.mb){var t=this.weekLimit;if(this.mb.weeknum>=t){return e.EKuaFuShopStatus.isSellOut}else{return e.EKuaFuShopStatus.canBuy}}return e.EKuaFuShopStatus.canBuy};t.prototype.curWeekLimit=function(t,e){var i=this.cfg;if(i.limit!=0){if(t){var n=Math.min(i.weektimes,i.limit-t.total+t.weeknum);return n}}return i.weektimes};return t}();e.KuaFuShopVo=t})(shop||(shop={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var shouchonghaoli;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){app.ViewManager.regist(i.ShouChongView,"shouchongjiangli.atlas");app.ViewManager.regist(i.ChongzhitestuiView);app.ViewManager.regist(i.ShouChongTips,"shouchongjiangli.atlas");app.ViewManager.regist(i.QitianleichongView,"shangcheng.atlas");app.ViewManager.regist(i.DuoRiChongZhijiangliView,"shangcheng.atlas");main.MainUIIcon.iconClassMap[csv.MainIconProxy.TYPE_ICON_SHOUCHONG]=newshangcheng.ShouChongSkIcon;game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.SHOU_CHONG,i.ShouChongView,null,0);csv.MainIconProxy.getIns().on(main.MainUIIcon.EVENT_CREATE_BTN,this,this.onCreateBtnHandler);var t={};var e=game.Config.getParams(911).split("-");t.taskid=parseInt(e[0]);t.sec=parseInt(e[1]);i.ShouChongModel.getIns().tipCfg=t;game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.QI_RI_LEI_CHONG,i.QitianleichongView,null,3);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.LIAN_XU_LEI_CHONG,i.DuoRiChongZhijiangliView,null,3)};e.prototype.onCreateBtnHandler=function(t){if(t==csv.MainIconProxy.TYPE_ICON_SHOUCHONG){i.ShouChongModel.getIns().showTips()}};e.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.FirstChargeNoti,this,this.onFirstChargeNoti);this.addMsgListener(app.ProtocolResponse.RecharegeTaskNotify,this,this.onRecharegeTaskNotify)};e.prototype.onRecharegeTaskNotify=function(t,e){i.ShouChongModel.getIns().taskFinishTime=e.taskFinishTime+i.ShouChongModel.getIns().tipCfg.sec;i.ShouChongModel.getIns().showTips()};e.prototype.onFirstChargeNoti=function(t,e){i.ShouChongModel.getIns().isAlreadyChongZhi=e.firstCharge==1;if(app.ViewManager.DisplayedInStage(i.ShouChongView)){i.ShouChongView.getIns().onChongZhiHasChangedHandler()}i.ShouChongModel.getIns().showTips();activitytaren.ActivityTaRenModel.getIns().event(activitytaren.ActivityIconStatuManager.EVENET_ACTIVITY_STATUS_CHANGED)};return e}(app.ModuleBase);i.ShouChongModule=t})(shouchonghaoli||(shouchonghaoli={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var shouchonghaoli;(function(i){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.dontOpenTips=false;t.DAY_CNT=3;t.isAlreadyChongZhi=false;t.tipSubSec=0;t.taskFinishTime=0;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.init=function(){};Object.defineProperty(t.prototype,"isSkipShouChong",{get:function(){return false},enumerable:true,configurable:true});t.prototype.getCanLinquIndex=function(t){if(t.info){var e=t.info.prize;for(var i=0;i<e.length;i++){if(e[i].status==activitytaren.ActivityTaRenLingQuStatus.YOU_CAN_LING_QU){return i}}}return-1};t.prototype.onSortHandle=function(t,e){if(t<e){return-1}else if(t>e){return 1}return 0};t.prototype.getSubTime=function(t,e){if(t.info){var i=t.info.prize;for(var n=0;n<i.length;n++){if(n==e){var a=i[n].option;var o=game.Context.getServerTime();var s=game.Context.getServerZeroTime(o);var r=game.Context.getServerZeroTime(a);r+=n*24*60*60;if(r>o){return r}}}}return 0};t.prototype.getNear=function(t){if(t.info){var e=[];var i=t.info.prize;for(var n=0;n<i.length;n++){var a=i[n].status;if(a==activitytaren.ActivityTaRenLingQuStatus.YOU_CAN_LING_QU||a==activitytaren.ActivityTaRenLingQuStatus.IS_ALREADY_LING_QU){}else{e.push(n)}}if(e.length){e.sort(this.onSortHandle);var o=e[0];return o}}return-1};t.prototype.getTodayIndex=function(t){var e=t.getFirstActivityListInfo();if(e){var i=e.option;var n=game.Context.getServerTime();var a=game.Context.getServerZeroTime(n);var o=game.Context.getServerZeroTime(i);if(o>=a){return 0}var s=(a-o)/24/60/60;s=Math.floor(s);if(s>this.DAY_CNT){return this.DAY_CNT}return s}return 0};t.prototype.getIndex=function(t){if(!this.isAlreadyChongZhi){return 0}var e=this.getTodayIndex(t);var i=this.getCanLinquIndex(t);if(i!=-1){return i}i=this.getNear(t);if(i!=-1){return i}return Math.min(e,2)};t.prototype.showTips=function(){var t=this.taskFinishTime-game.Context.getServerTime();var e=true;if(app.ViewManager.DisplayedInStage(i.ShouChongTips.SINGLE_KEY)){e=i.ShouChongTips.getIns().canShow}if(e&&this.dontOpenTips==false&&!this.isAlreadyChongZhi){if(t>0){console.log("show shouchong tips...");this.tipSubSec=t;this.openScTip(true);return}}this.openScTip(false)};t.prototype.openScTip=function(t){if(t&&!app.ViewManager.DisplayedInStage(main.LeftIconList.SINGLE_KEY)){t=false}app.ViewManager.toggleView(i.ShouChongTips,app.AppContainer.uiLayer,t?1:-1)};t.prototype.sortlist=function(t,e){var i=[];for(var n=0;n<e.length;n++){var a=t.getSubInfo(e[n].id);if(a&&a.status==activitytaren.ActivityTaRenLingQuStatus.IS_ALREADY_LING_QU){}else{i.push(e[n])}}for(var n=0;n<e.length;n++){var a=t.getSubInfo(e[n].id);if(a&&a.status==activitytaren.ActivityTaRenLingQuStatus.IS_ALREADY_LING_QU){i.push(e[n])}}return i};Object.defineProperty(t.prototype,"rechargeId",{get:function(){return game.Config.getIntParams(968)},enumerable:true,configurable:true});t.SINGLE_KEY="shouchonghaoli.ShouChongModel";t.EVENT_CHONGZHI_ITEM_CHANGEED="EVENT_CHONGZHI_ITEM_CHANGEED";return t}(app.ModelBase);i.ShouChongModel=t})(shouchonghaoli||(shouchonghaoli={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var shouchonghaoli;(function(i){var o=24;var s=function(a){__extends(t,a);function t(t,e){var i=a.call(this)||this;i.f=3;var n=new Laya.Label;i._txt=n;n.text=t;n.fontSize=o;n.color=game.STYLES.BLACK_COLOR;i.addChild(n);i.graphics.drawRect(0,0,n.textField.width*i.f,n.textField.height,"#a5a5a5");i.hitArea=new Laya.Rectangle(0,0,n.textField.width*i.f,n.textField.height);i.on(Laya.Event.MOUSE_UP,i,function(){e.runWith(n.text)});return i}Object.defineProperty(t.prototype,"height",{get:function(){return this._txt.textField.height},enumerable:true,configurable:true});t.prototype.setLabel=function(t){this._txt.text=t};return t}(laya.display.Sprite);var t=function(a){__extends(t,a);function t(t,e){var i=a.call(this)||this;i.hander=e;i.inputExcept=new Laya.TextInput;var n=i.inputExcept;n.bgColor="#00eeee";n.fontSize=o;i.addChild(n);i.btn=new s(t,new Laya.Handler(i,i.onClickHandler));i.btn.x=n.width;i.addChild(i.btn);return i}Object.defineProperty(t.prototype,"height",{get:function(){return this.btn.height},enumerable:true,configurable:true});t.prototype.onClickHandler=function(){this.hander.runWith(this.inputExcept.text)};return t}(laya.display.Sprite);var n=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t.useAniTime=250;t.btn=new s("充值",new Laya.Handler(t,t.onChongZhiHandler));t.addChild(t.btn);t.onRefresh();t.width=o*8;t.height=o*1.5;t.on(Laya.Event.UNDISPLAY,t,t.unDisplay);return t}t.prototype.unDisplay=function(){Laya.Tween.clearTween(this.jiantou)};t.prototype.onRefresh=function(){var t=0;for(var e=0;e<this.numChildren;e++){var i=this.getChildAt(e);i["y"]=t;t+=i["height"]}};t.prototype.onChongZhiHandler=function(){if(this.dataSource){var t="recharge "+this.dataSource.id;ent.GmDebug.cmd(t);app.ViewManager.toggleDialog(i.ChongzhitestuiView,-1)}};t.prototype.setData=function(t,e){if(!this.jiantou){this.jiantou=new Laya.Image;this.jiantou.skin="public/bg_jiantou_heng.png";this.jiantou.scaleX=-1}this.dataSource=t;Laya.Tween.clearTween(this.jiantou);if(t){if(t.id==e){this.btn._txt.color="#ff0000";this.addChild(this.jiantou);this.jiantou.x=200;this.startAni()}else{this.btn._txt.color=game.STYLES.BLACK_COLOR;this.jiantou.removeSelf()}this.btn.setLabel(t.type+"-"+t.id.toString()+"|"+app.convert_Yuan(t.recharge)+"元")}};t.prototype.startAni=function(){this.tween=Laya.Tween.to(this.jiantou,{x:230},this.useAniTime,null,new Laya.Handler(this,this.aniHandler))};t.prototype.aniHandler=function(){this.tween=Laya.Tween.to(this.jiantou,{x:200},this.useAniTime,null,new Laya.Handler(this,this.startAni))};return t}(View);var e=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.createLabel=function(){var t=new Laya.Label;t.fontSize=22;t.color="#ffffff";return t};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.list.itemRender=n;this.list.renderHandler=new Laya.Handler(this,this.onRenderHander);this.list.repeatX=1;this.list.spaceY=2;this.list.spaceX=2;this.list.vScrollBarSkin=" ";this.drawLine(this.width,this.height);var t=this.createLabel();t.text="GM命令\n"+"活动充值:actcharge 1(充值的数额) 2(充值id)\n"+"充值:recharge 1(充值id)\n";this.addChild(t);t.y=this.list.height};t.prototype.drawLine=function(t,e){var i=new Array;i.push(t,0,t,e,0,e,0,0,t,0);this.graphics.drawLines(0,0,i,"#ff0000",1)};t.prototype.curID=function(){return this.dataSource[0]};t.prototype.onRenderHander=function(t,e){t.setData(t.dataSource,this.curID())};t.prototype.onDisplay=function(){this.callLater(this.refreshAll)};t.prototype.getIndex=function(t){for(var e=0;e<t.length;e++){if(t[e].id==this.curID()){return e}}return 0};t.prototype.refreshAll=function(){var t=csv.RechargeProxy.getIns().cfgList;this.list.array=t;this.list.scrollTo(this.getIndex(t))};t.prototype.onUnDisplay=function(){};return t}(ui.shouchongjiangli.chongzhitestuiUI);i.ChongzhitestuiView=e})(shouchonghaoli||(shouchonghaoli={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var shouchonghaoli;(function(i){var n=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};Object.defineProperty(e.prototype,"model",{get:function(){return i.ShouChongModel.getIns()},enumerable:true,configurable:true});e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.libaolist.repeatX=1;this.libaolist.repeatY=0;this.libaolist.vScrollBarSkin="";this.libaolist.itemRender=a;this.libaolist.renderHandler=new Laya.Handler(this,this.onRenderHandler)};e.prototype.onCloseHandler=function(){this.removeSelf()};e.prototype.onDisplay=function(){game.MoneyModel.getIns().on(game.MoneyModel.EVENTS.MONEY_CHANGE,this,this.onMoneyChange);this.callLater(this.onInitHandler)};e.prototype.endTimeCallBack=function(){};e.prototype.onRenderHandler=function(t,e){t.setData(this.actVo,t.dataSource,e)};e.prototype.onInitHandler=function(){if(!this.actVo){return}this.libaolist.array=this.model.sortlist(this.actVo,this.actVo.cfgList);this.libaolist.scrollTo(0)};e.prototype.onUnDisplay=function(){game.MoneyModel.getIns().off(game.MoneyModel.EVENTS.MONEY_CHANGE,this,this.onMoneyChange);this.endTimeCallBack()};Object.defineProperty(e.prototype,"actmodel",{get:function(){return activitytaren.ActivityTaRenModel.getIns()},enumerable:true,configurable:true});e.prototype.onMoneyChange=function(){if(this.actVo){this.actmodel.getInfoByActID(this.actVo.actid,new Laya.Handler(this,this.onInitHandler))}};e.SINGLE_KEY="shouchonghaoli.DuoRiChongZhijiangliView";return e}(ui.xinshangcheng2.jitianhaoliviewUI);i.DuoRiChongZhijiangliView=n;var a=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}Object.defineProperty(e.prototype,"btnlingqu",{get:function(){return this.btnweikaiqi},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"btnchongzhi",{get:function(){return this.btnqianwang},enumerable:true,configurable:true});e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.gezilist.itemRender=grids.GridView;this.gezilist.renderHandler=grids.GridView.CommonItemRender;this.btnlingqu.clickHandler=new Laya.Handler(this,this.onLingquHandler);this.btnlingqu.label=app.getLang("huodong_text03");this.btnchongzhi.clickHandler=new Laya.Handler(this,this.onChongZhiHandler);game.RedDotView.addTo(this.btnlingqu)};e.prototype.onChongZhiHandler=function(){newshangcheng.NewShangChengModel.getIns().updateView()};e.prototype.onDisplay=function(){};e.prototype.onLingquHandler=function(){activitytaren.ActivityTaRenModel.getIns().lingQu(this.cfg.id,1,new Laya.Handler(this,this.onRefreshHandler))};e.prototype.onUnDisplay=function(){};e.prototype.onRefreshHandler=function(){n.getIns().onInitHandler()};e.prototype.setData=function(t,e,i){this.index=i;this.actVo=t;this.cfg=e;var n=game.ItemUtil.parserList(e.award);this.gezilist.array=n;this.gezilist.width=(this.gezilist.spaceX+98)*n.length;this.cliplibaojiage.value=e.p6;var a=this.actVo.getSubInfo(this.cfg.id);this.info=a;this.labelshuzi.text=a.option+"/"+e.p6;this.checkHandler();Laya.timer.once(1e3,this,this.checkHandler)};e.prototype.normalBtnStatus=function(){this.imgyilingqu.visible=false;this.btnlingqu.visible=false;this.btnchongzhi.visible=true;if(this.index==0&&this.info.option<parseInt(this.cfg.p6)&&this.info.num==0){this.btnchongzhi.label=app.getLang("mall_text_06");this.btnchongzhi.mouseEnabled=true;this.btnchongzhi.gray=false}else{this.btnchongzhi.label=app.getLang("mall_text_05");this.btnchongzhi.mouseEnabled=false;this.btnchongzhi.gray=true}};e.prototype.checkHandler=function(){if(app.ViewManager.DisplayedInStage(n.SINGLE_KEY)){Laya.timer.once(1e3,this,this.checkHandler);if(this.info){switch(this.info.status){case activitytaren.ActivityTaRenLingQuStatus.CAN_T_LINGQU:this.normalBtnStatus();break;case activitytaren.ActivityTaRenLingQuStatus.IS_ALREADY_LING_QU:this.imgyilingqu.visible=true;this.btnlingqu.visible=false;this.btnchongzhi.visible=false;break;case activitytaren.ActivityTaRenLingQuStatus.YOU_CAN_LING_QU:this.imgyilingqu.visible=false;this.btnchongzhi.visible=false;this.btnlingqu.visible=true;break;default:break}}else{this.normalBtnStatus()}if(this.btnchongzhi.visible){var t=(game.Context.getServerZeroTime()-this.actVo.timeVo.startTime)/3600/24+1;if(t<parseInt(this.cfg.p6)){}}}};return e}(ui.xinshangcheng2.jitianhaoliitemUI)})(shouchonghaoli||(shouchonghaoli={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var shouchonghaoli;(function(n){var i=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};Object.defineProperty(e.prototype,"model",{get:function(){return activitytaren.ActivityTaRenModel.getIns()},enumerable:true,configurable:true});e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.baglist.repeatX=0;this.baglist.repeatY=0;this.baglist.itemRender=a;this.baglist.renderHandler=new Laya.Handler(this,this.onRenderHandler);this.activityTimeView=new activitytaren.ActivityTimeView(this.labeldaojishi,new Laya.Handler(this,this.endTimeCallBack),app.getLang("huodong_text05"))};e.prototype.laterCallBack=function(){this.labelshuzi.text=game.MoneyModel.format(game.MoneyModel.getIns().getMoney(game.MoneyModel.MONEY_ENUM.GOLD));app.ProtocolRequest.GetActMainPanelReq(this.actVo.actid)};e.prototype.onMoneyChange=function(){Laya.timer.callLater(this,this.laterCallBack)};e.prototype.getList=function(t){var e=[];for(var i=0;i<t.length;i++){var n=t[i];if(n.p6&&n.p6.length>0){var a=n.p6.split(";");var o=false;for(var s=0;s<a.length;s++){var r=parseInt(a[s]);if(game.Context.cursvrid==r){o=true;break}}if(o){e.push(n)}}}return e};e.prototype.onCurMoneyHandler=function(){var t=activitytaren.ActivityTaRenModel.getIns().iconMan.getActVoByActid(this.actVo.actid);this.actVo=t;var e=this.getAllRecharge().toString();this.clipchongzhishu.value=e;var i=this.getList(this.actVo.cfgList);this.baglist.array=n.ShouChongModel.getIns().sortlist(this.actVo,i)};e.prototype.endTimeCallBack=function(){this.activityTimeView.stop();this.labeldaojishi.text=""};e.prototype.onRenderHandler=function(t,e){t.setData(this.actVo,t.dataSource)};e.prototype.onDisplay=function(){activitytaren.ActivityTaRenModel.getIns().on(activitytaren.ActivityTaRenModel.ACTIVIT_TAREN_EVENT.GET_MAIN_PANEL_INFO,this,this.onCurMoneyHandler);game.MoneyModel.getIns().on(game.MoneyModel.EVENTS.MONEY_CHANGE,this,this.onMoneyChange);this.callLater(this.onInitHandler)};e.prototype.getAllRecharge=function(){return activitytaren.ActivityTaRenModel.getIns().getAllRecharge(this.actVo)};e.prototype.onInitHandler=function(){if(this.actVo){game.HelperViewHandler.register(this.functionid,[this.btnwenhao]);this.onMoneyChange();this.activityTimeView.start(this.actVo.timeVo.endTime)}else{game.Alert.show("活动function:"+this.functionid+"不存在")}};e.prototype.onUnDisplay=function(){activitytaren.ActivityTaRenModel.getIns().off(activitytaren.ActivityTaRenModel.ACTIVIT_TAREN_EVENT.GET_MAIN_PANEL_INFO,this,this.onCurMoneyHandler);game.MoneyModel.getIns().off(game.MoneyModel.EVENTS.MONEY_CHANGE,this,this.onMoneyChange);this.endTimeCallBack()};e.SINGLE_KEY="shouchonghaoli.QitianleichongView";return e}(ui.shangcheng.qitianleichongviewUI);n.QitianleichongView=i;var a=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.gezilist.itemRender=grids.GridView;this.gezilist.renderHandler=grids.GridView.CommonItemRender;this.btnlingqu.clickHandler=new Laya.Handler(this,this.onLingquHandler);this.btnchongzhi.clickHandler=new Laya.Handler(this,this.onChongZhiHandler);game.RedDotView.addTo(this.btnlingqu);this.clipshuzi.align="right"};e.prototype.onChongZhiHandler=function(){game.ClosureManager.callFunction(csv.FunctionsProxy.ENUMS.HOD_DONG_SHANG_CHENG)};e.prototype.onLingquHandler=function(){activitytaren.ActivityTaRenModel.getIns().lingQu(this.cfg.id,1,new Laya.Handler(this,this.onRefreshHandler))};e.prototype.onRefreshHandler=function(){i.getIns().onInitHandler()};e.prototype.onDisplay=function(){};e.prototype.onUnDisplay=function(){};e.prototype.setData=function(t,e){this.actVo=t;this.cfg=e;this.gezilist.array=game.ItemUtil.parserList(e.award);this.clipshuzi.value=e.p1;var i=t.getSubInfo(e.id);if(i){switch(i.status){case activitytaren.ActivityTaRenLingQuStatus.CAN_T_LINGQU:this.imgyilingqu.visible=false;this.btnlingqu.visible=false;this.btnchongzhi.visible=true;break;case activitytaren.ActivityTaRenLingQuStatus.IS_ALREADY_LING_QU:this.imgyilingqu.visible=true;this.btnlingqu.visible=false;this.btnchongzhi.visible=false;break;case activitytaren.ActivityTaRenLingQuStatus.YOU_CAN_LING_QU:this.imgyilingqu.visible=false;this.btnchongzhi.visible=false;this.btnlingqu.visible=true;break;default:break}}else{this.imgyilingqu.visible=false;this.btnlingqu.visible=false;this.btnchongzhi.visible=true}};return e}(ui.shangcheng.shangchengitem7UI)})(shouchonghaoli||(shouchonghaoli={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var shouchonghaoli;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.MOUSE_UP,this,this.onClickHandler)};e.prototype.onClickHandler=function(){var t=this.rechCfg;if(t)shop.ShopModel.getIns().chongzhi(t.id)};e.prototype.setData=function(t,e,i){var n=app.str2Array(e,"-");if(!t){return}var a=this,o=a.imgmoney,s=a.imgtuijian,r=a.labelhuodeyuanbao;o.skin="shouchongjiangli/bg_shouchongjiangli_money0"+(i+1)+".png";if(parseInt(n[1])==1)s.visible=true;else s.visible=false;var l=csv.RechargeProxy.getIns().cfgMap[n[0]];this.rechCfg=l;var h=app.str2Array(l.reward1,"-");var p=game.ItemUtil.createVO(parseInt(h[0]));if(p){r.text=app.getLang("shouchong_text_03",h[1]+p.getName())}else{r.text=""}};return e}(ui.shouchongjiangli.shouchongjiangliitemUI);t.ShouChongJiangliItemView=e})(shouchonghaoli||(shouchonghaoli={}));var shouchonghaoli;(function(f){var t=function(){function t(t){this.skin=t;var e=t.cliphaolinum,i=t.listhaoli;e.align="left";i.itemRender=grids.GridView;i.renderHandler=new Laya.Handler(this,this.onCellHandler);var n=t.btnlingqu;n.clickHandler=new Laya.Handler(this,this.onLingQuHandler);t.btngoumai.clickHandler=new Laya.Handler(this,this.onChongZhiHandler)}t.prototype.onUnDisplay=function(){this.showAnim(false)};t.prototype.onChongZhiHandler=function(){shop.ShopModel.getIns().chongzhi(f.ShouChongModel.getIns().rechargeId)};t.prototype.onCellHandler=function(t,e){var i=this.cfg.receive_effect.split(";")[e];t.setData(t.dataSource,"",1,undefined,i)};t.prototype.updateHandler=function(t){var e=util.TimeUtil.sec2Str(t)};t.prototype.timelater=function(){if(this.cfg){activitytaren.ActivityTaRenModel.getIns().once(activitytaren.ActivityTaRenModel.ACTIVIT_TAREN_EVENT.UPDATE_ACTIVIT_DATA,this,this.updateActivitData);app.ProtocolRequest.RecvActPrizeReq(this.cfg.id,1)}};t.prototype.onLingQuHandler=function(){this.timelater()};t.prototype.updateActivitData=function(){this.skin.onChongZhiHasChangedHandler()};t.prototype.showAnim=function(t){this.skin.texiao.visible=t;if(t){this.skin.texiao.play(0,true)}else{this.skin.texiao.stop()}};t.prototype.selectIndex=function(t,e){if(t==-1){return}this.index=t;this.actVo=e;var i=this.skin,n=i.listhaoli,a=i.cliphaolinum,o=i.btnlingqu,s=i.imgyilingqu,r=i.imgjiangli;var l=false;var h=e.getCfgByIndex(t);if(h){this.cfg=h;n.array=game.ItemUtil.parserList(h.award);r.skin=h.cp3;a.align="left";if(h.cp2==""){a.visible=false}else{a.visible=true;a.value=h.cp2}if(f.ShouChongModel.getIns().isAlreadyChongZhi){this.skin.btngoumai.visible=false;o.visible=true}else{this.skin.btngoumai.visible=true;o.visible=false}var p=e.getSubInfo(h.id);var u="";this.skin.gongjili.visible=this.skin.zhanli.visible=false;var c=h.p4.split(";");this.skin[c[0]].visible=true;this.skin.zhanliclip.value=c[1];this.skin.imgbanner.skin=h.p5;if(p){switch(p.status){case activitytaren.ActivityTaRenLingQuStatus.YOU_CAN_LING_QU:o.gray=false;o.mouseEnabled=true;s.visible=false;l=true;u=app.getLang("chongzhi_text_02");break;case activitytaren.ActivityTaRenLingQuStatus.CAN_T_LINGQU:o.gray=true;o.mouseEnabled=false;s.visible=false;if(f.ShouChongModel.getIns().isAlreadyChongZhi){var g=f.ShouChongModel.getIns().getSubTime(this.actVo,t);if(g>0){this.updateHandler(g)}else{}}break;case activitytaren.ActivityTaRenLingQuStatus.IS_ALREADY_LING_QU:o.visible=false;s.visible=true;u="";break}}}this.showAnim(l)};return t}();f.ShouChongMidView=t})(shouchonghaoli||(shouchonghaoli={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var shouchonghaoli;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.setData=function(t,e){this.vo=e;this.actVo=t;var i=e.index;var n=this.btn;var a=app.str2Array(app.getLang("xianshiqianggou_text_1"),",");n.label=app.getLang("shouchong_text_01",a[i]);n.selected=e.selected;var o=t.getCfgByIndex(i);var s=t.getSubInfo(o.id);if(s.status==activitytaren.ActivityTaRenLingQuStatus.YOU_CAN_LING_QU){game.RedDotView.addTo(this,this.width,5)}else{game.RedDotView.removeFrom(this)}};e.prototype.refresh=function(){if(this.vo&&this.actVo)this.setData(this.actVo,this.vo)};e.prototype.onDisplay=function(){};e.prototype.onUnDisplay=function(){};return e}(ui.shouchongjiangli.shouchongjianglitab01UI);t.ShouChongTabView=e})(shouchonghaoli||(shouchonghaoli={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var shouchonghaoli;(function(i){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.canShow=true;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.zOrder=app.AppContainer.UI_LAYER_NUME.HUODONG_TIP};t.prototype.onDisplay=function(){app.AppContainer.uiLayer.updateZOrder();this.on(Laya.Event.RESIZE,this,this.onResize);this.callLater(this.refreshAll);game.Context.on(game.ContextEvent.ICONLIST,this,this.onShowList)};t.prototype.onShowList=function(t){if(t.key==main.LeftIconList.SINGLE_KEY){this.canShow=t.v;i.ShouChongModel.getIns().showTips()}};t.prototype.refreshAll=function(){var t=game.Config.getParams(912);var e=game.ItemUtil.parserList(t);for(var i=0;i<e.length;i++){this["daoju"+(i+1)].setData(e[i])}this.onTickHandler();this.onResize()};t.prototype.onTickHandler=function(){i.ShouChongModel.getIns().tipSubSec--;if(i.ShouChongModel.getIns().tipSubSec>0){this.clipdaojishi.value=util.TimeUtil.formatTime(i.ShouChongModel.getIns().tipSubSec);Laya.timer.once(1e3,this,this.onTickHandler)}else{this.removeSelf()}};t.prototype.onUnDisplay=function(){game.Context.off(game.ContextEvent.ICONLIST,this,this.onShowList);this.off(Laya.Event.RESIZE,this,this.onResize)};t.prototype.onResize=function(){var t=csv.MainIconProxy.TYPE_ICON_SHOUCHONG;var e=main.MainUIIcon.getMainUIIconPoint(t);if(e){this.x=this.x=e.x+main.LeftIconList.SIZE/2;this.y=e.y-this.height+main.LeftIconList.SIZE/2}};t.SINGLE_KEY="shouchonghaoli.ShouChongTips";return t}(ui.shouchongjiangli.shouchongtishitankuangUI);i.ShouChongTips=t})(shouchonghaoli||(shouchonghaoli={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var shouchonghaoli;(function(i){var n=function(){function t(t){this.index=t;this.selected=false}return t}();i.TabItemVo=n;var t=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.midview=new i.ShouChongMidView(this);this.listyeqian.itemRender=i.ShouChongTabView;this.listyeqian.renderHandler=new Laya.Handler(this,this.onYeQianRenderHandler);this.listyeqian.selectEnable=true;this.listyeqian.selectHandler=new Laya.Handler(this,this.onYeQianSelectHander);this.listyeqian.hScrollBarSkin=" ";this.tabs=[];for(var t=0;t<i.ShouChongModel.getIns().DAY_CNT;t++){this.tabs.push(new n(t))}};t.prototype.updateActivityView=function(){this.listyeqian.selectedIndex=-1;this.onInitHandler()};t.prototype.onYeQianSelectHander=function(t){this.midview.selectIndex(t,this.actVo);for(var e=0;e<this.tabs.length;e++){if(this.tabs[e].index==t){this.tabs[e].selected=true}else{this.tabs[e].selected=false}}this.listyeqian.refresh()};t.prototype.onYeQianRenderHandler=function(t,e){t.setData(this.actVo,t.dataSource)};t.prototype.onDisplay=function(){app.SoundManager.getIns().playSound("functionopen");guide.GuideModel.getIns().boOpen=false;if(app.ViewManager.DisplayedInStage(i.ShouChongTips.SINGLE_KEY)){i.ShouChongModel.getIns().dontOpenTips=true;i.ShouChongModel.getIns().openScTip(false)}game.Context.event(game.ContextEvent.FUNCTION_OPEN,csv.FunctionsProxy.ENUMS.SHOU_CHONG);this.callLater(this.onInitHandler);this.ani1.play(0,true);this.animationfabao.play(0,true)};t.prototype.onChongZhiHasChangedHandler=function(){this.listyeqian.selectedIndex=-1;activitytaren.ActivityTaRenModel.getIns().getInfoByActID(this.actVo.actid,new Laya.Handler(this,this.onShouChongEvt))};t.prototype.onShouChongEvt=function(){this.onInitHandler();this.listyeqian.refresh()};t.prototype.onInitHandler=function(){if(this.functionid){this.onEndHandler()}};t.prototype.onEndHandler=function(){guide.GuideModel.getIns().boOpen=true;this.listyeqian.array=this.tabs;var t=i.ShouChongModel.getIns().getIndex(this.actVo);this.listyeqian.selectedIndex=t;this.listyeqian.refresh()};t.prototype.onUnDisplay=function(){app.SoundManager.getIns().playSound("functionclose");this.midview.onUnDisplay();this.listyeqian.selectedIndex=-1;this.ani1.stop();this.animationfabao.stop()};t.SINGLE_KEY="shouchonghaoli.ShouChongView";return t}(ui.shouchongjiangli.shouchong6yuanlibaoUI);i.ShouChongView=t})(shouchonghaoli||(shouchonghaoli={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var guard;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){app.ViewManager.regist(i.GuardView,"shouhu.atlas");game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.GUARD,i.GuardView)};e.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.GuardInfoAck,this,this.onGuardInfoAck);this.addMsgListener(app.ProtocolResponse.GuardEquipAck,this,this.onGuardEquipAck);this.addMsgListener(app.ProtocolResponse.GuardOverDueNotice,this,this.onGuardOverDueNotice);this.addMsgListener(app.ProtocolResponse.GuardSellAck,this,this.onGuardSellAck);this.addMsgListener(app.ProtocolResponse.GuardRenewAck,this,this.onGuardRenewAck);this.addMsgListener(app.ProtocolResponse.GuardFollowAck,this,this.onGuardFollowAck);csv.FunctionsProxy.getIns().on(csv.FunctionsProxy.EVENTS.CHANGE,this,this.onRedDotChange)};e.prototype.onRedDotChange=function(){Laya.timer.callLater(this,this.onUpdateRedDot)};e.prototype.onUpdateRedDot=function(){i.GuardModel.getIns().checkRedDot()};e.prototype.onGuardFollowAck=function(t,e){if(e.success){}};e.prototype.onGuardSellAck=function(t,e){if(e.success==1){i.GuardModel.getIns().onGuardSellAck(e.uniqueId)}};e.prototype.onGuardRenewAck=function(t,e){if(e.success==1){i.GuardModel.getIns().onGuardRenewAck(e.uniqueId)}};e.prototype.onGuardInfoAck=function(t,e){i.GuardModel.getIns().guardListUpdate(e.uniqueId,e.guardList,e.equipGuardList);this.onRedDotChange()};e.prototype.onGuardEquipAck=function(t,e){if(e.success==1){}};e.prototype.onGuardOverDueNotice=function(t,e){i.GuardModel.getIns().pastListUpdate(e.guardList)};e.SINGLE_KEY="guard.GuardModule";return e}(app.ModuleBase);i.GuardModule=t})(guard||(guard={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var guard;(function(s){var t=function(){function t(){}return t}();s.GuardVO=t;var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){this.guardList=[];this.pastList=[];this.equipGuardList=[]};e.prototype.checkGuardRecord=function(){return this.pastList.length==0&&this.guardList.length==0};e.prototype.checkIfOwnById=function(t){for(var e in this.guardList){if(this.guardList[e].GuardId==t){return true}}return false};e.prototype.guardListUpdate=function(t,e,i){this.uniqueId=t;this.guardList=e;this.equipGuardList=i;this.pastList=[];for(var n=0;n<e.length;n++){if(e[n].endTime>0){var a=e[n].endTime-game.Context.getServerTime();if(a<=0){this.pastList.push(e[n].uniqueId)}}}this.event(s.GuardView.UPDATE_GUARD_LIST)};e.prototype.pastListUpdate=function(t){for(var e=0;e<t.length;e++){if(this.pastList.indexOf(t[e])==-1){this.pastList.push(t[e])}}if(t.indexOf(this.uniqueId)>=0){this.uniqueId=0}for(var e=0;e<this.pastList.length;e++){var i=this.getGuardDataByUniqueId(this.pastList[e]);if(i){if(i.IsTip==0){main.HintUIView.getIns().addHintMsg(csv.FunctionsProxy.ENUMS.GUARD);break}}}this.event(s.GuardView.UPDATE_GUARD_LIST)};e.prototype.getInUseGuard=function(t){var e;var i=this.getGuardEquipData(t);if(i){for(var n in this.guardList){if(this.guardList[n].uniqueId==i.uniqueId){e=this.guardList[n];break}}}return e};e.prototype.getGuardDataByUniqueId=function(t){var e;if(t>0){for(var i in this.guardList){if(this.guardList[i].uniqueId==t){e=this.guardList[i];break}}}return e};e.prototype.onGuardSellAck=function(n){this.guardList.forEach(function(t,e,i){if(t.uniqueId==n){i.splice(e,1)}});this.pastList.forEach(function(t,e,i){if(t==n){i.splice(e,1)}});this.event(s.GuardView.UPDATE_GUARD_LIST)};e.prototype.onGuardRenewAck=function(n){this.pastList.forEach(function(t,e,i){if(t==n){i.splice(e,1)}});this.event(s.GuardView.UPDATE_GUARD_LIST)};e.prototype.checkRedDot=function(){var t=false;for(var e in this.guardList){var i=this.pastList.indexOf(this.guardList[e].uniqueId)>=0;if(!i){for(var n=0;n<game.Context.roleList.length;n++){if(this.getRedDot(this.guardList[e].GuardId,n)){t=true;break}}if(t){break}}}if(t){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.GUARD)}else{game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.GUARD)}return t};e.prototype.getRedDot=function(t,e){var i=this.getInUseGuard(e);var n=csv.GuardProxy.getIns().getCfg(t);var a=-1;if(i){var o=csv.GuardProxy.getIns().getCfg(i.GuardId);var s=[];s=s.concat(Attributes.decode(o.attr).baseList);a=Attributes.getAllRoleScore(s)}var r=[];r=r.concat(Attributes.decode(n?n.attr:Attributes.EMPTY).baseList);var l=Attributes.getAllRoleScore(r);if(l>a){for(var h=0;h<this.equipGuardList.length;h++){if(this.equipGuardList[h].pos==e){continue}var p=this.getGuardDataByUniqueId(this.equipGuardList[h].uniqueId);if(p&&t==p.GuardId){return false}}return true}return false};e.prototype.getGuardList=function(t,e,i){var n=this.guardList;var a=this.getInUseGuard(i);var o=csv.GuardProxy.getIns().getArray();if(t){}else if(a){n=n.filter(function(t){return t.uniqueId!=a.uniqueId})}var s=[];var r=[];for(var l in n){var h=this.pastList.indexOf(n[l].uniqueId);if(h>=0){s.push(n[l])}else{r.push(n[l])}}var p=[];for(var l=o.length-1;l>=0;l--){var u=false;for(var c=0;c<r.length;c++){if(o[l].guardid==r[c].GuardId){u=true;break}}if(!u){p.push(o[l])}}p.sort(this.sortCfg);if(e){for(var l=0;l<s.length;l++){r.push(s[l])}}r.sort(this.sortEquiped);for(var l=0;l<p.length;l++){if(a){if(!t){if(a.GuardId!=p[l].item){r.push(p[l])}}else{r.push(p[l])}}else{r.push(p[l])}}return r};e.prototype.sortCfg=function(t,e){if(t.type==1&&e.type==2){return-1}if(t.type==2&&e.type==1){return 1}if(t.priority<e.priority){return-1}if(t.priority>e.priority){return 1}};e.prototype.sortEquiped=function(t,e){var i=s.GuardModel.getIns().pastList.indexOf(t.uniqueId);var n=s.GuardModel.getIns().pastList.indexOf(e.uniqueId);if(i<0&&n>=0){return-1}if(i>=0&&n<0){return 1}var a=csv.GuardProxy.getIns().getCfg(t.GuardId);var o=csv.GuardProxy.getIns().getCfg(e.GuardId);if(a.type==1&&o.type==2){return-1}if(a.type==2&&o.type==1){return 1}if(a.priority<o.priority){return-1}if(a.priority>o.priority){return 1}if(t.endTime>e.endTime){return-1}if(t.endTime<e.endTime){return 1}if(t.GuardId>e.GuardId){return-1}if(t.GuardId<e.GuardId){return 1}return 0};e.prototype.onGuardFollowReq=function(t){var e=this.getGuardEquipData(t);if(e&&e.uniqueId!=this.uniqueId){app.ProtocolRequest.GuardFollowReq(e.uniqueId)}};e.prototype.getGuardEquipData=function(t){var e;for(var i=0;i<this.equipGuardList.length;i++){if(this.equipGuardList[i].pos==t){e=this.equipGuardList[i];break}}return e};e.prototype.getGuardEquipPos=function(t){var e=-1;for(var i=0;i<this.equipGuardList.length;i++){if(this.equipGuardList[i].uniqueId==t){e=this.equipGuardList[i].pos;break}}return e};e.SINGLE_KEY="guard.GuardModel";return e}(app.ModelBase);s.GuardModel=e})(guard||(guard={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("guard.csv");this.cfgMap=t.getMap("guardid");this.cfgMapArray=t.getArray()};e.prototype.getCfg=function(t){return this.cfgMap[t]};e.prototype.getArray=function(){return this.cfgMapArray};e.SINGLE_KEY="csv.GuardProxy";return e}(app.ModelBase);t.GuardProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var guard;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){this.labeljiacheng.text=Attributes.getPropName(t.propId);this.labeljiachengnum.text=Attributes.getPropValue(t.propId,t.value,t.formula)};e.SINGLE_KEY="guard.GuardAttrItem";return e}(ui.shouhu.shouhuitem03UI);t.GuardAttrItem=e})(guard||(guard={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var guard;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listjiacheng.itemRender=i.GuardAttrItem;this.listjiacheng.renderHandler=new Laya.Handler(this,this.onRenderHandler);this.listjiacheng.vScrollBarSkin=" ";this.listjiacheng.array=[];this.imgyiguoqi.visible=false;this.boxzhuangbei.visible=false;this.boxyiguoqi.visible=false;this.btngoumai.clickHandler=new Laya.Handler(this,this.onGuardItemBuy);this.boxgoumai.visible=true};e.prototype.onGuardItemBuy=function(){if(game.GridsModel.getIns().hasEnoughItems(this._data.trueprice,false,true)){shop.ShopModel.getIns().buy(this._data,1)}};e.prototype.onRenderHandler=function(t){t.setData(t.dataSource)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){this._data=t;var e=csv.GuardProxy.getIns().getCfg(t.item);this.listjiacheng.array=Attributes.decode(e.attr).baseList;this.itemdaoju.setData(e.guardid);this.labelname.text=csv.ItemProxy.getName(e.guardid);this.imgmoney.parserIcon(this._data.trueprice,this.labelmoney)};e.SINGLE_KEY="guard.GuardBuyItem";return e}(ui.shouhu.shouhuitem01UI);i.GuardBuyItem=t})(guard||(guard={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var guard;(function(r){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listjiacheng.itemRender=ui.shouhu.shouhuitem03UI;this.listjiacheng.renderHandler=new Laya.Handler(this,this.onRenderHandler);this.listjiacheng.array=[];this.btnzhuangbei.clickHandler=new Laya.Handler(this,this.onGuardEquipReq);this.btnxiexia.clickHandler=new Laya.Handler(this,this.onGuardEquipReq);this.btnxufei.clickHandler=new Laya.Handler(this,this.onGuardRenewReq);this.btnchushou.clickHandler=new Laya.Handler(this,this.onGuardSellReq);this.btngoumai.clickHandler=new Laya.Handler(this,this.onGuardItemBuy)};e.prototype.onGuardItemBuy=function(){if(this._shopItem&&game.GridsModel.getIns().hasEnoughItems(this._shopItem.trueprice,false,true)){shop.ShopModel.getIns().buy(this._shopItem,1)}};e.prototype.onRenderHandler=function(t){t.labeljiachengnum.visible=false;t.labeljiacheng.text=Attributes.getShowLabel(t.dataSource,"{0} +{1}")};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){this.cleanTime();this._data=null;this._shopItem=null};e.prototype.refreshAll=function(){this.listjiacheng.height=this.listjiacheng.array.length*35};e.prototype.setData=function(t,e){this._data=null;this._shopItem=null;this.imgyiguoqi.visible=false;this.boxzhuangbei.visible=false;this.boxyiguoqi.visible=false;this.boxgoumai.visible=false;this.labelhuoqutujing.visible=false;this.cleanTime();this._roleIndex=e;if(t instanceof GuardData){this._data=t;var i=csv.GuardProxy.getIns().getCfg(t.GuardId);var n=r.GuardModel.getIns().pastList.indexOf(t.uniqueId)>=0;this.listjiacheng.array=Attributes.decode(i.attr).baseList;this.itemdaoju.setData(i.guardid);this.labelname.text=csv.ItemProxy.getName(i.guardid);if(n){this.imgyiguoqi.visible=true;this.boxyiguoqi.visible=true;this.itemmoney.parserIcon(i.price,this.labelmoney01)}else{var a=r.GuardModel.getIns().getInUseGuard(this._roleIndex);this.listtishijuese.visible=false;this.boxzhuangbei.visible=true;if(a&&a.uniqueId==t.uniqueId){this.btnxiexia.visible=true;this.btnzhuangbei.visible=false}else{var o=r.GuardModel.getIns().getGuardEquipPos(t.uniqueId);this.btnxiexia.visible=false;this.btnzhuangbei.visible=true;if(o>=0&&o!=this._roleIndex){this.listtishijuese.text=app.getLang("hecheng_2",o+1);this.listtishijuese.visible=true}}}if(i.lasttime>0){var s=this._data.endTime-game.Context.getServerTime();if(s>0){this.listtishi.text=app.getLang("guard_tips1",util.TimeUtil.getCoolDown(s));this.startLoop()}else{this.listtishi.text=app.getLang("guard_tips2",i.lasttime)}}else{this.listtishi.text=app.getLang("guard_tips6")}game.RedDotView.removeFrom(this.btnzhuangbei);if(!n&&r.GuardModel.getIns().getRedDot(t.GuardId,this._roleIndex)){game.RedDotView.addTo(this.btnzhuangbei)}}else{this.imgyiguoqi.visible=false;this.boxzhuangbei.visible=false;this.boxyiguoqi.visible=false;this.boxgoumai.visible=true;this.listjiacheng.array=Attributes.decode(t.attr).baseList;this.itemdaoju.setData(t.guardid);this.labelname.text=csv.ItemProxy.getName(t.guardid);this._shopItem=csv.MallProxy.getIns().getCfgByItemID(csv.MallProxy.ENUM_TYPE.GUARD,t.guardid);if(this._shopItem){this.imgmoney.parserIcon(this._shopItem.trueprice,this.labelmoney)}if(t.type==2){this.boxgoumai.visible=false;this.labelhuoqutujing.text=app.getLang(t.lang);this.labelhuoqutujing.visible=true}}};e.prototype.startLoop=function(){Laya.timer.loop(1e3,this,this.loopFreshTime)};e.prototype.loopFreshTime=function(){var t=this._data.endTime-game.Context.getServerTime();if(t>0){this.listtishi.text=app.getLang("guard_tips1",util.TimeUtil.getCoolDown(t))}else{this.cleanTime();this.listtishi.text=app.getLang("guard_tips1","00:00:00")}};e.prototype.cleanTime=function(){Laya.timer.clear(this,this.loopFreshTime)};e.prototype.onGuardEquipReq=function(){var t=r.GuardModel.getIns().getInUseGuard(this._roleIndex);if(t&&this._data.uniqueId==t.uniqueId){app.ProtocolRequest.GuardEquipReq(0,this._roleIndex)}else{var e=void 0;var i=-1;for(var n=0;n<game.Context.roleList.length;n++){if(n==this._roleIndex)continue;e=r.GuardModel.getIns().getInUseGuard(n);if(e&&this._data.uniqueId==e.uniqueId){i=n;break}}if(i>=0){game.Alert.show(app.getLang("guard_tips5",i+1),new Laya.Handler(this,this.onGuardEquipCallBack,[this._data.uniqueId,this._roleIndex]),new Laya.Handler)}else{this.onGuardEquipCallBack(this._data.uniqueId,this._roleIndex)}}};e.prototype.onGuardEquipCallBack=function(t,e){app.ProtocolRequest.GuardEquipReq(t,e)};e.prototype.onGuardSellReq=function(){app.ProtocolRequest.GuardSellReq(this._data.uniqueId)};e.prototype.onGuardRenewReq=function(){app.ProtocolRequest.GuardRenewReq(this._data.uniqueId)};e.SINGLE_KEY="guard.GuardItem";return e}(ui.shouhu.shouhuitem02UI);r.GuardItem=t})(guard||(guard={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var guard;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.SINGLE_KEY="guard.GuardPastTipView";return e}(ui.shouhu.shouhutipUI);t.GuardPastTipView=e})(guard||(guard={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var guard;(function(n){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listbeibao.itemRender=n.GuardItem;this.listbeibao.renderHandler=new Laya.Handler(this,this.onRenderHandler);this.listbeibao.vScrollBarSkin=" ";this.inUseItem.visible=false;this.listbeibao.array=[];this.imgweizhuangbei.visible=false;guide.GuideModel.getIns().register(csv.GuideProxy.ENUM_VIEW.SHOUHU_SELECT,this,this.getGuideItemBtn);this.roleMediator=new common.RoleListMediator(this.itemxuanze.xuanzelist,equip.RoleItem,new Laya.Handler(this,this.roleSelectChange));this.roleMediator.setData(0);this.btntiaozhuan.clickHandler=new Laya.Handler(this,this.onGuardFollowReq)};e.prototype.onGuardFollowReq=function(){n.GuardModel.getIns().onGuardFollowReq(this.roleMediator.selectedIndex)};e.prototype.roleSelectChange=function(){this.onUpdateView()};e.prototype.getGuideItemBtn=function(t){var e=n.GuardModel.getIns().getGuardList(false,true,this.roleMediator.selectedIndex);this.listbeibao.array=e;this.listbeibao.scrollTo(0);var i=this.listbeibao.cells[0];if(i){return i.btnzhuangbei}return null};e.prototype.onRenderHandler=function(t){t.setData(t.dataSource,this.roleMediator.selectedIndex)};e.prototype.onDisplay=function(){n.GuardModel.getIns().on(e.UPDATE_GUARD_LIST,this,this.onUpdateView);app.ProtocolRequest.GuardInfoReq();this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){n.GuardModel.getIns().off(e.UPDATE_GUARD_LIST,this,this.onUpdateView)};e.prototype.onUpdateView=function(){var t=n.GuardModel.getIns().getInUseGuard(this.roleMediator.selectedIndex);this.setInUseItem(t);this.btntiaozhuan.label=app.getLang("btn_follow");if(t){if(n.GuardModel.getIns().uniqueId==t.GuardId){this.btntiaozhuan.label=app.getLang("btn_following")}this.btntiaozhuan.disabled=false}else{this.btntiaozhuan.disabled=true}var e=n.GuardModel.getIns().getGuardList(false,true,this.roleMediator.selectedIndex);this.listbeibao.array=e};e.prototype.refreshAll=function(){if(this.dataSource&&this.dataSource.length==1){}else{this.setRoleData(true)}this.onUpdateView()};e.prototype.setRoleData=function(t){var e=this.roleMediator.selectedIndex;var i=[];for(var n=0;n<game.Context.roleList.length;n++){i[n]=false}if(!i[e]&&t){for(var a=0;a<i.length;a++){if(i[a]){e=a;break}}}this.roleMediator.setData(e,i)};e.prototype.setInUseItem=function(t){if(t){this.inUseItem.setData(t,this.roleMediator.selectedIndex);this.inUseItem.visible=true}else{this.inUseItem.visible=false}this.imgweizhuangbei.visible=!this.inUseItem.visible};e.SINGLE_KEY="guard.GuardView";e.UPDATE_GUARD_LIST="UPDATE_GUARD_LIST";return e}(ui.shouhu.shouhuviewnewUI);n.GuardView=t})(guard||(guard={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var shoujibanding;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){app.ViewManager.regist(i.Shoujibangdingview,"shoujibangding.atlas");app.ViewManager.regist(i.LingqujianglitipsView,"shoujibangding.atlas");game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.SHOUJI_BANDDING,i.Shoujibangdingview)};e.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.GainBanPhoneAck,this,this.onGainBanPhoneAck)};e.prototype.onGainBanPhoneAck=function(t,e){if(e.flag==1){i.ShoujibandingModel.getIns().openRewardView()}};return e}(app.ModuleBase);i.ShoujibandingModule=t})(shoujibanding||(shoujibanding={}));var shoujibanding;(function(t){function s(t,e,i,n,a){app.Http.request(t,i,n,e,a,"json")}var e=function(){function t(t,e,i,n,a,o){this.xianyu_id=e;this.is_channel=t;this.server_id=i;this.server_name=n;this.role_name=a;this.role_id=o;console.log("BindMoblie >>>>>>>>>>is_channel(%s),xianyu_id(%s),server_id(%s),server_name(%s),role_name(%s),role_id:(%s)",t,e,i,n,a,o)}Object.defineProperty(t.prototype,"url",{get:function(){if(window["appConfig"]&&window["appConfig"]["hlw_mobile"]){return window["appConfig"]["hlw_mobile"]}return""},enumerable:true,configurable:true});t.prototype.isBind=function(t,e){s(this.url+"isBindMobile","xianyu_id="+this.xianyu_id,t,e,"post")};t.prototype.sendnum=function(t,e,i){var n=window["md5"];var a=n(t+"e32c36ea311bff152efc73508b6fd8f8");var o="mobile="+t+"&sign="+a;s(this.url+"sendCode"+"?"+o,"",e,i,"get")};t.prototype.bindnum=function(t,e,i,n){var a="xianyu_id="+this.xianyu_id+"&mobile="+t+"&code="+e+"&is_channel="+this.is_channel+"&server_id="+this.server_id+"&server_name="+this.server_name+"&role_id="+this.role_id+"&role_name="+this.role_name;s(this.url+"bindMobile",a,i,n,"post")};return t}();t.BindMoblie=e})(shoujibanding||(shoujibanding={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var shoujibanding;(function(n){var t=function(t){__extends(i,t);function i(){return t!==null&&t.apply(this,arguments)||this}i.getIns=function(){return app.Singleton.getInstance(i)};Object.defineProperty(i.prototype,"moblie",{get:function(){if(!this._moblie){this._moblie=new n.BindMoblie(game.Context.webCfg.is_channel||1,game.AccountModel.accountId,game.Context.serverId,game.Context.serverName,game.Context.clearPlayerName(game.Context.mainRole.playername),game.Context.mainRoleId.toNumber().toString())}return this._moblie},enumerable:true,configurable:true});i.prototype.init=function(){};i.prototype.getItemStr=function(){var t="";for(var e=0;e<4;e++){var i=game.Config.getParams(905+e);t+=i+";"}if(t.length>0){t=t.substr(0,t.length-1)}return t};i.prototype.openRewardView=function(){var t=i.getIns().getItemStr();var e=game.ItemUtil.parserList(t);app.ViewManager.toggleDialog(n.LingqujianglitipsView,1,0,game.ItemUtil.hebingItems(e))};i.SINGLE_KEY="shoujibanding.ShoujibandingModel";return i}(app.ModelBase);n.ShoujibandingModel=t})(shoujibanding||(shoujibanding={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var shoujibanding;(function(i){var t=function(t){__extends(e,t);function e(){return t.call(this)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.quedingbtn.clickHandler=new Laya.Handler(this,this.close);this.daojulist.itemRender=grids.GridView;this.daojulist.renderHandler=grids.GridView.CommonItemRender};e.prototype.onDisplay=function(){this.callLater(this.onCallLaterHandler)};e.prototype.onCallLaterHandler=function(){this.daojulist.array=this.dataSource};e.prototype.onUnDisplay=function(){};return e}(ui.shoujibangding.lingqujianglitipsUI);i.LingqujianglitipsView=t;var e=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.END_TIME=30;t.ticket=t.END_TIME;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listgezi.renderHandler=grids.GridView.CommonItemRender;this.listgezi.itemRender=grids.GridView;this.listgezi.hScrollBarSkin=" ";this.btndaojishi.clickHandler=new Laya.Handler(this,this.onDaojiShiHandler);this.btnbangdig.clickHandler=new Laya.Handler(this,this.onBindClickHandler);this.btndaojishi.label=app.getLang("shouji_bangding01");this.btnhuoquyanzheng.removeSelf();this.textshuru2.on(Laya.Event.FOCUS,this,gamesdk.onTomatoForceHandler,[this.textshuru2]);this.textshuru1.on(Laya.Event.FOCUS,this,gamesdk.onTomatoForceHandler,[this.textshuru1])};Object.defineProperty(t.prototype,"moblie",{get:function(){return i.ShoujibandingModel.getIns().moblie},enumerable:true,configurable:true});t.prototype.onDaojiShiHandler=function(){if(this.textshuru2.text!=""){if(this.ticket<this.END_TIME){console.log(">>>>>>> 验证码倒计时未结束!")}else{this.onTickHander();Laya.timer.once(1e3,this,this.onTickHander);this.moblie.sendnum(this.textshuru2.text,this,this.onSendNumHandler)}}else{manager.FlowManager.instance.flowByStyle1(app.getLang("shouji_bangding05"))}};t.prototype.isBindHandler=function(t){console.log(t);if(t.status==0){this.setLock(false)}else{this.setLock(true)}};t.prototype.onSendNumHandler=function(t){console.log(t);if(t.status==1){}else{manager.FlowManager.instance.flowByStyle1(t.msg)}};t.prototype.onTickHander=function(){this.ticket--;if(this.ticket>=0){this.btndaojishi.label=this.ticket+"s";Laya.timer.once(1e3,this,this.onTickHander)}else{this.ticket=this.END_TIME;this.btndaojishi.label=app.getLang("shouji_bangding01")}};t.prototype.onBindClickHandler=function(){if(this.textshuru2.text!=""&&this.textshuru1.text!=""){this.moblie.bindnum(this.textshuru2.text,this.textshuru1.text,this,this.onBindCallBack)}else{manager.FlowManager.instance.flowByStyle1(app.getLang("shouji_bangding04"))}};t.prototype.onBindCallBack=function(t){console.log(t);if(t.status==1){console.log(">>>>>>>>>>>>>>>>>>>>>> 验证成功");this.setLock(true);app.ProtocolRequest.GainBanPhone()}else{manager.FlowManager.instance.flowByStyle1(t.msg)}};t.prototype.setLock=function(t){if(t){this.btnbangdig.gray=true;this.btnbangdig.mouseEnabled=false;this.btndaojishi.gray=true;this.btndaojishi.mouseEnabled=false}else{this.btnbangdig.gray=false;this.btnbangdig.mouseEnabled=true;this.btndaojishi.gray=false;this.btndaojishi.mouseEnabled=true}};t.prototype.onDisplay=function(){this.reset();this.labelmiaoshu.text=app.getLang("shouji_bangding");var t=i.ShoujibandingModel.getIns().getItemStr();var e=game.ItemUtil.parserList(t);this.listgezi.array=game.ItemUtil.hebingItems(e);gamesdk.onTomatoForceHandler(this.textshuru1);gamesdk.onTomatoForceHandler(this.textshuru2);this.moblie.isBind(this,this.isBindHandler)};t.prototype.reset=function(){this.textshuru2.text="";this.textshuru2.prompt=app.getLang("shouji_bangding02");this.textshuru1.text="";this.textshuru1.prompt=app.getLang("shouji_bangding03")};t.prototype.onUnDisplay=function(){};t.SINGLE_KEY="shoujibanding.Shoujibangdingview";return t}(ui.shoujibangding.shoujibangdingviewUI);i.Shoujibangdingview=e})(shoujibanding||(shoujibanding={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var sixBox;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){app.ViewManager.regist(i.SixBoxMainView,"liuheyin.atlas");app.ViewManager.regist(i.SixBoxBagView,"liuheyin.atlas");app.ViewManager.regist(i.SixBoxHeChengView,"liuheyin.atlas");app.ViewManager.regist(i.SixBoxChooseView,"liuheyin.atlas");app.ViewManager.regist(i.SixBoxAllView,"liuheyin.atlas");game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.SIX_BOX,i.SixBoxMainView);game.FuncDotAdapter.registRedFunc(csv.FunctionsProxy.ENUMS.SIX_BOX,i.SixBoxModel.getIns(),i.SixBoxModel.getIns().onRedDotChange);game.FuncDotAdapter.registRedFunc(csv.FunctionsProxy.ENUMS.SIX_BOX_BAG,i.SixBoxModel.getIns(),i.SixBoxModel.getIns().onRedDotChange);game.FuncDotAdapter.registRedFunc(csv.FunctionsProxy.ENUMS.SIX_BOX_HECHENG,i.SixBoxModel.getIns(),i.SixBoxModel.getIns().onRedDotChange);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.SIX_BOX_BAG,i.SixBoxBagView);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.SIX_BOX_HECHENG,i.SixBoxHeChengView)};e.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.LuheInfoAck,this,this.onLuheInfoAck);this.addMsgListener(app.ProtocolResponse.LuheMoveAck,this,this.onLuheMoveAck);this.addMsgListener(app.ProtocolResponse.LuheModifyNtf,this,this.onLuheModifyNtf);this.addMsgListener(app.ProtocolResponse.LuheUpdateAck,this,this.onLuheUpdateAck);this.addMsgListener(app.ProtocolResponse.LuheSynthesisAck,this,this.onLuheSynthesisAck);this.addMsgListener(app.ProtocolResponse.LuheDecomposeAck,this,this.onLuheDecomposeAck);this.addMsgListener(app.ProtocolResponse.LuheAutoDecomposeAck,this,this.onLuheAutoDecomposeReq)};e.prototype.onLuheAutoDecomposeReq=function(t,e){if(e.result){}};e.prototype.onLuheDecomposeAck=function(t,e){if(e.result){app.ViewManager.toggleDialog(i.SixBoxDecomposeView,-1,0);i.SixBoxModel.getIns().event(i.SixBoxBagView.DECOMPOSE_SUCCESS);i.SixBoxModel.getIns().onRedDotChange()}};e.prototype.onLuheSynthesisAck=function(t,e){if(e.result){i.SixBoxModel.getIns().event(i.SixBoxHeChengView.LUHE_SYNTHES_SUCCESS)}};e.prototype.onLuheUpdateAck=function(t,e){if(e.result){i.SixBoxModel.getIns().onLuheUpgradeSuccess(e.lv)}};e.prototype.onLuheModifyNtf=function(t,e){};e.prototype.onLuheMoveAck=function(t,e){if(e.result){i.SixBoxModel.getIns().event(i.SixBoxChooseView.SIXBOX_MOVE_SUCCESS)}};e.prototype.onLuheInfoAck=function(t,e){i.SixBoxModel.getIns().onLuheInfoUpdate(e.items,e.autodec,e.decquality)};e.SINGLE_KEY="sixBox.SixBoxModule";return e}(app.ModuleBase);i.SixBoxModule=t})(sixBox||(sixBox={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var sixBox;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listshuxing.itemRender=game.ComAttrItem7;this.listshuxing.renderHandler=new Laya.Handler(this,this.onRenderHandler)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.onRenderHandler=function(t){var e=t.dataSource;t.setTextColor(game.STYLES.DESC_TXT_COLOR);t.setData(e)};e.prototype.setData=function(t,e,i){this.txtName.text=t;this.txtLevel.text=app.getLang("zuoqi_11")+e;this.listshuxing.array=i;this.txtLevel.x=this.txtName.x+this.txtName.textField.textWidth};e.SINGLE_KEY="sixBox.AttrTipsItem";return e}(ui.liuheyin.shuxingitemUI);t.AttrTipsItem=e})(sixBox||(sixBox={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var sixBox;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){this.shuxing.text=t.label};e.SINGLE_KEY="sixBox.ListItem";return e}(ui.liuheyin.liuheyinxuanzexialalitemUI);t.ListItem=e})(sixBox||(sixBox={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var sixBox;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.gezi.locktip=false;this.gezi.clickHandler=new Laya.Handler(this,this.clickHandler)};e.prototype.clickHandler=function(){if(this._data instanceof items.ItemVO){if(this._data.itemCfg.type==3){tip.TipManager.show(this._data)}else{tip.TipManager.showSixBox(this._data)}}};e.prototype.getRedDot=function(){};e.SINGLE_KEY="sixBox.SixBoxHechengItem";return e}(t.SixBoxItem);t.SixBoxHechengItem=e})(sixBox||(sixBox={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var sixBox;(function(r){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.imgxuanzhong.visible=false;this.imgyiyoushuxing.visible=false;this.on(Laya.Event.CLICK,this,this.onClick);this.listshuxing.itemRender=ui.common.commonattr8UI;this.listshuxing.renderHandler=new Laya.Handler(this,this.onAttrRender);this.liuheyin.locktip=true};e.prototype.onAttrRender=function(t){t.txtvalue.width=200;t.txtvalue.align="center";t.txtvalue.text=Attributes.getShowLabel(t.dataSource,"{0} +{1}")};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t,e){this.itemVO=t;this.liuheyin.setData(this.itemVO);this.liuheyin.shuzi.text=app.getLang("zuoqi_11")+t.getLevel();this.labelname.text=this.itemVO.getName();var i=r.SixBoxMainView.getIns().roleMediator.selectedRoleUid;var n=r.SixBoxModel.getIns().getCanEquipList(i,0);var a=r.SixBoxModel.getIns().canEquip(n,this.itemVO,false);this.imgyiyoushuxing.visible=!a;var o=csv.SixBoxProxy.getIns().getCfg(this.itemVO.getItemId(),this.itemVO.getLevel());var s=Attributes.decode(o?o.prop:"").baseList;this.attrLen=s.length;this.listshuxing.array=s};e.prototype.onClick=function(){if(this.clickHandler){this.clickHandler.runWith(this)}};e.SINGLE_KEY="sixBox.SixBoxItemBag";return e}(ui.liuheyin.liuheyinitemUI);r.SixBoxItemBag=t})(sixBox||(sixBox={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var sixBox;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.on(Laya.Event.CLICK,this,this.clickHandler);this.imgxuanzhong.visible=false};e.prototype.onDisplay=function(){this.callLater(this.refreshAll);game.GridsModel.getIns().on(game.GridsModel.EVENTS.UPDATE,this,this.setRed)};e.prototype.onUnDisplay=function(){game.GridsModel.getIns().off(game.GridsModel.EVENTS.UPDATE,this,this.setRed)};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){if(t.needjyid&&dailytask.DailyTaskModel.getIns().eliteChallengeId<t.needjyid){this.disabled=true;this.suo.visible=true;this.labelwenzi.text=app.getLang(t.subtype)+"   "+app.getLang("synthesis_tips1",t.needjyid)}else{this.disabled=false;this.suo.visible=false;this.labelwenzi.text=app.getLang(t.subtype)}this.setRed()};e.prototype.setRed=function(){var t=synthesis.HechengModel.getIns().getSynthesisRed(this.dataSource);game.RedDotView.removeFrom(this);if(t){game.RedDotView.addTo(this)}};e.prototype.clickHandler=function(){i.SixBoxHeChengView.getIns().updateView(this.dataSource,this)};e.SINGLE_KEY="sixBox.SixHechengSubTypeItem";return e}(ui.liuheyin.rongheyeqianitemUI);i.SixHechengSubTypeItem=t})(sixBox||(sixBox={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var sixBox;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll);game.GridsModel.getIns().on(game.GridsModel.EVENTS.UPDATE,this,this.setRed)};e.prototype.onUnDisplay=function(){game.GridsModel.getIns().off(game.GridsModel.EVENTS.UPDATE,this,this.setRed)};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){var e=csv.HechengProxy.getIns().getTypeName(t);this.btnName.text=app.getLang(e);this.setRed()};e.prototype.setRed=function(){var t=synthesis.HechengModel.getIns().getTypeRed(this.dataSource);if(t){game.RedDotView.addTo(this,this.width-20,8)}else{game.RedDotView.removeFrom(this)}};e.SINGLE_KEY="sixBox.SixHechengTypeItem";return e}(ui.liuheyin.ronghebtnitemUI);t.SixHechengTypeItem=e})(sixBox||(sixBox={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var sixBox;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listliuheyin.itemRender=i.TotalSubItem;this.listliuheyin.renderHandler=new Laya.Handler(this,this.onListRender);this.listliuheyin.hScrollBarSkin=" "};e.prototype.onListRender=function(t){t.setData(t.dataSource)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){this.labelmiaoshu.text="";this.listliuheyin.array=t};e.SINGLE_KEY="sixBox.TotalItem";return e}(ui.liuheyin.liuheyinzonglanitem02UI);i.TotalItem=t;var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.imgxuanzhong.visible=false};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){var e=game.ItemUtil.createVO(t.id);this.liuheyin.setData(e);this.labelname.text=e.getName()};e.SINGLE_KEY="sixBox.TotalSubItem";return e}(ui.liuheyin.liuheyinzonglanitem01UI);i.TotalSubItem=e})(sixBox||(sixBox={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var sixBox;(function(u){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){this.items=[];this.selectedRoleUid=Uint64.ZERO};e.prototype.onLuheUpgradeSuccess=function(t){this.onRedDotChange();this.event(u.SixBoxMainView.LUHE_UPGRADE,[t])};e.prototype.onLuheInfoUpdate=function(t,e,i){this.items=t;this.autodec=e;this.decquality=i;this.onRedDotChange();this.event(u.SixBoxMainView.LUHEINFO_UPDATE)};e.prototype.getLuheItemDataByRoleUid=function(t){var e=[];for(var i=0,n=this.items;i<n.length;i++){var a=n[i];if(Uint64.equal(a.id,t)){e=a.items}}return e};e.prototype.getEquipItem=function(t,e){var i=[];for(var n=0,a=e;n<a.length;n++){var o=a[n];if(Uint64.equal(o.id,t)){for(var s=0,r=o.items;s<r.length;s++){var l=r[s];i.push(game.ItemUtil.createVO(l.itemData[0].itemId,l.itemData[0]))}}}return i};e.prototype.getLuheItemData=function(t,e){var i=this.getLuheItemDataByRoleUid(t);var n;if(i&&i.length>0){for(var a=0,o=i;a<o.length;a++){var s=o[a];if(s.part==e){n=game.ItemUtil.createVO(s.itemData[0].itemId,s.itemData[0]);break}}}return n};e.prototype.isEmptyByPart=function(t,e){var i=this.getLuheItemDataByRoleUid(t);if(i&&i.length>0){for(var n=0,a=i;n<a.length;n++){var o=a[n];if(o.part==e){return false}}}return true};e.prototype.onRedDotChange=function(){var t=this.getRedDotArr();var e=false;for(var i=0;i<t.length;i++){if(t[i]){e=true;break}}if(e){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.SIX_BOX)}else{game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.SIX_BOX)}var n=game.GridsModel.getIns().getGridByType(game.GridsModel.SIX_BOX);var a=n.itemList.length;var o=[];game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.SIX_BOX_BAG);if(a>0){for(var s=0,r=n.itemList;s<r.length;s++){var l=r[s];if(l.getLevel()==1&&l.getQuality()<5){var h=csv.SixBoxProxy.getIns().getCfg(l.getItemId(),l.getLevel());if(h&&!(h.prop.indexOf(";")>=0)){o.push(l)}}}if(o.length>0){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.SIX_BOX_BAG)}}};e.prototype.getRedDotArr=function(){var t=[];var e=false;for(var i=0;i<game.Context.TOTAL_ROLE_NUM;i++){e=false;if(game.Context.roleList[i]){for(var n=1;n<=equip.EquipStatic.SIXBOX_NUM;n++){var a=csv.SixBoxProxy.getIns().isLock(game.Context.roleList[i].level,n);if(!a){e=this.getUpgradeReddot(game.Context.roleList[i].insId,n);if(!e){e=this.getCanEquipList(game.Context.roleList[i].insId,n).length>0}if(e){break}}else{break}}}t.push(e)}return t};e.prototype.getUpgradeReddot=function(t,e){var i=game.Context.roleMap[t.toString()].level;var n=csv.SixBoxProxy.getIns().isLock(i,e);var a=false;if(!n){var o=this.getLuheItemData(t,e);a=this.canUpgrade(o,false)}return a};e.prototype.canUpgrade=function(t,e){var i=false;if(t instanceof items.ItemVO){var n=csv.SixBoxProxy.getIns().getMaxLevel(t.getItemId());i=t.getLevel()<n;if(!i){if(e){manager.FlowManager.instance.flowByStyle1(app.getLang("lotus_8"))}}if(i){var a=csv.SixBoxProxy.getIns().getCfg(t.getItemId(),t.getLevel()+1);var o=game.ItemUtil.parserList(a.exp)[0];i=game.GridsModel.getIns().hasEnoughItems(o,false,e)}}return i};e.prototype.canEquip=function(t,e,i){var n=false;for(var a=0,o=t;a<o.length;a++){var s=o[a];if(s.getItemId()==e.getItemId()){n=true;break}}if(!n&&i){manager.FlowManager.instance.flowByStyle1(app.getLang("liuhe_warn_msg_1"))}return n};e.prototype.showSixBoxChooseView=function(t,e,i,n){var a=game.GridsModel.getIns().getGridByType(game.GridsModel.SIX_BOX).itemList;app.ViewManager.toggleDialog(u.SixBoxChooseView,1,0,[t,a,e,i,n])};e.prototype.getCanEquipList=function(t,e){var i=game.GridsModel.getIns().getGridByType(game.GridsModel.SIX_BOX);var n=i.itemList;var a=[];var o;for(var s=1;s<=7;s++){var r=u.SixBoxModel.getIns().getLuheItemData(t,s);if(s==e){if(r){o=r}}if(r){a.push(r.itemCfg.subtype)}}var l=[];for(var h=0,p=n;h<p.length;h++){var r=p[h];if(o){if(r.itemCfg.subtype==o.itemCfg.subtype){if(r.getQuality()>o.getQuality()){l.push(r)}else if(r.getQuality()==o.getQuality()){if(r.getLevel()>o.getLevel()){l.push(r)}}}else if(a.indexOf(r.itemCfg.subtype)==-1){if(r.getQuality()>o.getQuality()){l.push(r)}else if(r.getQuality()==o.getQuality()){if(r.getLevel()>o.getLevel()){l.push(r)}}}}else if(a.indexOf(r.itemCfg.subtype)==-1){l.push(r)}}return l};e.prototype.onLuheInfoReq=function(){app.ProtocolRequest.LuheInfoReq()};e.prototype.onLuheMoveReq=function(t,e,i,n){if(i==game.GridsModel.SIX_BOX){var a=game.GridsModel.getIns().getGridByType(game.GridsModel.SIX_BOX);var o=a.itemList.length;var s=game.Config.getIntParams(game.ConfigID.BAG_LIMIT);if(o>=s){manager.FlowManager.instance.flowByStyle1(app.getLang("liuhe_warn_msg_3"));return}}app.ProtocolRequest.LuheMoveReq(t,e,i,n)};e.prototype.onLuheDecomposeReq=function(t){app.ProtocolRequest.LuheDecomposeReq(t)};e.prototype.onLuheUpdateReq=function(t,e,i){app.ProtocolRequest.LuheUpdateReq(t,e,i)};e.prototype.onLuheSynthesisReq=function(t){app.ProtocolRequest.LuheSynthesisReq(t,1,[])};e.prototype.onLuheAutoDecomposeReq=function(t,e){this.autodec=t;this.decquality=e;app.ProtocolRequest.LuheAutoDecomposeReq(t,e)};e.SINGLE_KEY="sixBox.SixBoxModel";return e}(app.ModelBase);u.SixBoxModel=t})(sixBox||(sixBox={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("liuhe.csv");this.cfgMap=t.getMapList("itemid","level");var e=app.Config.getResById("liuhe_chuandai.csv");this.cfgEquip=e.getMap("id")};e.prototype.getCfg=function(t,e){return this.cfgMap[t]?this.cfgMap[t][e][0]:null};e.prototype.getMaxLevel=function(t){var e=this.cfgMap[t]?Object.keys(this.cfgMap[t]):[];return e.length};e.prototype.getEquipCfg=function(t){return this.cfgEquip[t]};e.prototype.isLock=function(t,e){var i=this.getEquipCfg(e);var n=i.openlevel;var a=game.GridsModel.LOCKED;if(i.type==0){if(t<n){a=game.GridsModel.LOCKED}else{a=game.GridsModel.EMPTY}}else if(i.type==1){if(vipcode.VipModel.getIns().vipLvl<n){a=game.GridsModel.LOCKED}else{a=game.GridsModel.EMPTY}}return a==game.GridsModel.LOCKED};e.SINGLE_KEY="csv.SixBoxProxy";return e}(app.ModelBase);t.SixBoxProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var sixBox;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listzonglan.itemRender=i.TotalItem;this.listzonglan.renderHandler=new Laya.Handler(this,this.onListRender);this.listzonglan.vScrollBarSkin=" "};e.prototype.onListRender=function(t){t.setData(t.dataSource)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){var t=csv.ItemProxy.getIns().getArrayByType();this.listzonglan.array=t};e.SINGLE_KEY="sixBox.SixBoxAllView";return e}(ui.liuheyin.liuheyinzonglantipUI);i.SixBoxAllView=t})(sixBox||(sixBox={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var sixBox;(function(i){var t=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.attrTipsItems=[];for(var t=0;t<7;t++){this.attrTipsItems.push(new i.AttrTipsItem)}};t.prototype.onDisplay=function(){this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){this.clear()};t.prototype.refreshAll=function(){var t=0;this.currH=0;this.callHandler=this.dataSource[1];var e=this.dataSource[0];for(var i=0;i<e.length;i++){if(e[i]){var n=csv.SixBoxProxy.getIns().getCfg(e[i].getItemId(),e[i].getLevel());var a=Attributes.decode(n?n.prop:"").baseList;this.attrTipsItems[i].setData(e[i].getName(),e[i].getLevel(),a);this.box.addChild(this.attrTipsItems[i]);t++;if(a.length>1){this.currH+=this.attrTipsItems[i].height+20}else{this.currH+=this.attrTipsItems[i].height+10}}}this.currH+=tip.TipManager.GAPS.GAP_BOTTOM;this.totalHeight=this.box.y+this.currH;this.tipsbg.height=this.totalHeight;this.zhuangshiimg04.y=this.totalHeight-tip.TipManager.GAPS.GAP_ICON;this.txtScore.value=this.dataSource[2];if(this.callHandler)this.callHandler.run()};t.prototype.clear=function(){for(var t=0;t<this.attrTipsItems.length;t++){this.attrTipsItems[t].txtName.text="";this.attrTipsItems[t].txtLevel.text="";this.attrTipsItems[t].listshuxing.array=[];this.attrTipsItems[t].removeSelf()}};t.prototype.getTipX=function(){return this.tipsbg.x};t.prototype.getTipH=function(){return this.tipsbg.height};t.prototype.getTipW=function(){return this.tipsbg.width};t.prototype.getBottomX=function(){return this.tipsbg.x+this.tipsbg.width};t.prototype.getBottomY=function(){return this.tipsbg.y+this.tipsbg.height};t.prototype.addView=function(t){this.addChild(t)};t.SINGLE_KEY="sixBox.SixBoxAttrTips";return t}(ui.liuheyin.leijishuxingtipsUI);i.SixBoxAttrTips=t})(sixBox||(sixBox={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var sixBox;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listgezi.itemRender=i.SixBoxItemBag;this.listgezi.renderHandler=new Laya.Handler(this,this.onBagItemForShowRender);this.listgezi.hScrollBarSkin="";this.listgezi.vScrollBarSkin=" ";this.btnguanbi.clickHandler=new Laya.Handler(this,this.onBtnClick);this.moneyIcon.parserIconByItemId(game.ItemUtil.ENUMS.SIX_BOX);game.HelperViewHandler.registerStr([this.btntishi,this.labeltishi02],"func86t","liuhe_secondinterface_1")};e.prototype.onBtnClick=function(){app.ViewManager.toggleDialog(i.SixBoxDecomposeView,1,0,[this._decomposeList])};e.prototype.onBagItemForShowRender=function(t){t.setData(t.dataSource,false);t.clickHandler=new Laya.Handler(this,this.onSelectHandler)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll);i.SixBoxModel.getIns().on(i.SixBoxBagView.DECOMPOSE_SUCCESS,this,this.refreshAll)};e.prototype.onUnDisplay=function(){i.SixBoxModel.getIns().off(i.SixBoxBagView.DECOMPOSE_SUCCESS,this,this.refreshAll)};e.prototype.refreshAll=function(){var t=game.GridsModel.getIns().getGridByType(game.GridsModel.SIX_BOX);var e=t.itemList.length;var i=[];this.imgtishi.visible=true;game.RedDotView.removeFrom(this.btnguanbi);this._decomposeList=[];if(e>0){i=i.concat(t.itemList);for(var n=0,a=i;n<a.length;n++){var o=a[n];if(o.getLevel()==1&&o.getQuality()<5){var s=csv.SixBoxProxy.getIns().getCfg(o.getItemId(),o.getLevel());if(s&&!(s.prop.indexOf(";")>=0)){this._decomposeList.push(o)}}}i.sort(this.sort);this.imgtishi.visible=false;if(this._decomposeList.length>0){game.RedDotView.addTo(this.btnguanbi)}}this.listgezi.array=i;this.labelwenzi.text=game.MoneyModel.format(game.GridsModel.getIns().getItemCount(game.ItemUtil.ENUMS.SIX_BOX))};e.prototype.sort=function(t,e){if(t.getQuality()>e.getQuality()){return-1}if(t.getQuality()<e.getQuality()){return 1}if(t.getItemId()>e.getItemId()){return 1}if(t.getItemId()<e.getItemId()){return-1}return 0};e.prototype.onSelectHandler=function(t){var e=[];if(t.attrLen>1||t.itemVO.getLevel()>1){e=[tip.TipManager.TIP_BTN_TYPE.SIXBOX_WEAR,tip.TipManager.TIP_BTN_TYPE.SIXBOX_RESOLVE_0]}else{e=[tip.TipManager.TIP_BTN_TYPE.SIXBOX_WEAR,tip.TipManager.TIP_BTN_TYPE.SIXBOX_RESOLVE_1]}this.selectItemId=t.itemVO.getInstId();tip.TipManager.showSixBox(t.itemVO,e,new Laya.Handler(this,this.btnClickHandler))};e.prototype.btnClickHandler=function(t){if(app.ViewManager.DisplayedInStage(i.SixBoxBagView.SINGLE_KEY)){if(t==tip.TipManager.TIP_BTN_TYPE.SIXBOX_WEAR){game.ClosureManager.callFunction(csv.FunctionsProxy.ENUMS.SIX_BOX,true,true)}else{i.SixBoxModel.getIns().onLuheDecomposeReq([this.selectItemId])}}};e.SINGLE_KEY="sixBox.SixBoxBagView";e.DECOMPOSE_SUCCESS="sixBox.onLuheDecomposeAck";return e}(ui.liuheyin.liuhebeibaobaoviewUI);i.SixBoxBagView=t})(sixBox||(sixBox={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var sixBox;(function(l){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.showArrow=false;t._dataArr=[];return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listgezi.itemRender=l.SixBoxItemBag;this.listgezi.renderHandler=new Laya.Handler(this,this.onRenderHandler)};t.prototype.onRenderHandler=function(t){t.setData(t.dataSource,this._atciton==5);t.clickHandler=new Laya.Handler(this,this.onSelectHandler)};t.prototype.onDisplay=function(){this.callLater(this.refreshAll);l.SixBoxModel.getIns().on(l.SixBoxChooseView.SIXBOX_MOVE_SUCCESS,this,this.onMoveAct)};t.prototype.onUnDisplay=function(){l.SixBoxModel.getIns().off(l.SixBoxChooseView.SIXBOX_MOVE_SUCCESS,this,this.onMoveAct)};t.prototype.refreshAll=function(){this.roleFlag=this.dataSource[0];var t=this.dataSource[1];this.position=this.dataSource[2];this.uid=this.dataSource[3];this._atciton=this.dataSource[4];this._dataArr=[];t.sort(this.itemsort);this.listgezi.array=t;this.imgzanweihuode.visible=t.length==0};t.prototype.itemsort=function(t,e){var i=l.SixBoxModel.getIns().getCanEquipList(this.uid,this.position);var n=l.SixBoxModel.getIns().canEquip(i,t,false);var a=l.SixBoxModel.getIns().canEquip(i,e,false);if(n==true&&a==false){return-1}if(n==false&&a==true){return 1}if(t.getQuality()>e.getQuality()){return-1}if(t.getQuality()<e.getQuality()){return 1}if(t.getLevel()>e.getLevel()){return-1}if(t.getLevel()<e.getLevel()){return 1}if(t.getItemId()>e.getItemId()){return 1}if(t.getItemId()<e.getItemId()){return-1}return 0};t.prototype.onSelectHandler=function(t){var e=false;var i=l.SixBoxMainView.getIns().selectItem.getItemData();if(i instanceof items.ItemVO){var n=l.SixBoxModel.getIns().getCanEquipList(this.uid,l.SixBoxMainView.getIns().selectItem.position);e=l.SixBoxModel.getIns().canEquip(n,t.itemVO,false)}else{var n=l.SixBoxModel.getIns().getCanEquipList(this.uid,0);e=l.SixBoxModel.getIns().canEquip(n,t.itemVO,false)}if(e){l.SixBoxModel.getIns().onLuheMoveReq(game.GridsModel.SIX_BOX,t.itemVO.getInstId(),this.roleFlag,this.position)}else{var a=[];for(var o=1;o<=7;o++){var s=l.SixBoxModel.getIns().getLuheItemData(this.uid,o);if(s){a.push(s.itemCfg.subtype)}}if(l.SixBoxMainView.getIns().selectItem){var r=l.SixBoxMainView.getIns().selectItem.getItemData();if(r instanceof items.ItemVO&&t.itemVO.itemCfg.subtype==r.itemCfg.subtype){if(t.itemVO.getQuality()<r.getQuality()){manager.FlowManager.instance.flowByStyle1(app.getLang("liuhe_warn_msg_4"));return}if(t.itemVO.getQuality()==r.getQuality()){if(t.itemVO.getLevel()<=r.getLevel()){manager.FlowManager.instance.flowByStyle1(app.getLang("liuhe_warn_msg_5"));return}}}else if(a.indexOf(t.itemVO.itemCfg.subtype)>=0){manager.FlowManager.instance.flowByStyle1(app.getLang("liuhe_warn_msg_1"));return}}}};t.prototype.onMoveAct=function(){app.ViewManager.toggleDialog(l.SixBoxChooseView,-1)};t.SINGLE_KEY="sixBox.SixBoxChooseView";t.SIXBOX_MOVE_SUCCESS="sixBox.onLuheMoveAck";return t}(ui.liuheyin.xuanzeliuheyintipsUI);l.SixBoxChooseView=t})(sixBox||(sixBox={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var sixBox;(function(i){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.curExp=0;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listgezi.itemRender=i.SixBoxItemBag;this.listgezi.renderHandler=new Laya.Handler(this,this.onBagItemForShowRender);this.listgezi.hScrollBarSkin="";this.listgezi.vScrollBarSkin=" ";this.liastxiala.itemRender=i.ListItem;this.liastxiala.repeatX=1;this.liastxiala.repeatY=3;this.liastxiala.renderHandler=new Laya.Handler(this,this.onSeletListRender);this.liastxiala.selectEnable=true;this.liastxiala.selectHandler=new Laya.Handler(this,this.onSeletListSelected);this.liastxiala.hScrollBarSkin=" ";this.liastxiala.array=[{label:app.getLang("liuhe_fenjie_2"),qua:2},{label:app.getLang("liuhe_fenjie_3"),qua:3},{label:app.getLang("liuhe_fenjie_4"),qua:4}];this.bntxiala.on(Laya.Event.CLICK,this,this.onShowList);this.on(Laya.Event.CLICK,this,this.hideList);this.btnguanbi.clickHandler=new Laya.Handler(this,this.onBtnClick);this.boxxuanze.clickHandler=new Laya.Handler(this,this.onCheckBoxChange);this.selectUids=[];this.moneyIcon.parserIconByItemId(game.ItemUtil.ENUMS.SIX_BOX)};t.prototype.onBagItemForShowRender=function(t){t.setData(t.dataSource,false);t.clickHandler=new Laya.Handler(this,this.onSelectHandler,[t]);t.imgxuanzhong.visible=true};t.prototype.onCheckBoxChange=function(){i.SixBoxModel.getIns().onLuheAutoDecomposeReq(this.boxxuanze.selected?1:0,this.liastxiala.selectedItem.qua)};t.prototype.onBtnClick=function(){if(this.selectUids.length>0){i.SixBoxModel.getIns().onLuheDecomposeReq(this.selectUids)}};t.prototype.onDisplay=function(){this.callLater(this.refreshAll);i.SixBoxModel.getIns().on(i.SixBoxBagView.DECOMPOSE_SUCCESS,this,this.onSuccess)};t.prototype.onUnDisplay=function(){i.SixBoxModel.getIns().off(i.SixBoxBagView.DECOMPOSE_SUCCESS,this,this.onSuccess)};t.prototype.onSuccess=function(){app.ViewManager.toggleDialog(i.SixBoxDecomposeView,-1,0)};t.prototype.refreshAll=function(){this.clean();this.hideList();if(this.liastxiala.selectedIndex==-1){var t=0;if(i.SixBoxModel.getIns().decquality==1){t=0}else if(i.SixBoxModel.getIns().decquality==3){t=1}else if(i.SixBoxModel.getIns().decquality==4){t=2}this.liastxiala.selectedIndex=t}this.boxxuanze.selected=i.SixBoxModel.getIns().autodec==1?true:false;this.showItem()};t.prototype.showItem=function(){var t=this.dataSource[0];var e=[];this.imgtishi.visible=true;if(t.length>0){this.imgtishi.visible=false;for(var i in t){if(t[i].getQuality()<=this.liastxiala.selectedItem.qua){this.selectUids.push(t[i].getInstId());var n=csv.SixBoxProxy.getIns().getCfg(t[i].getItemId(),t[i].getLevel());var a=n?n.returnexp:0;this.curExp+=a;e.push(t[i])}}}this.listgezi.array=e;this.updateMoney()};t.prototype.onSelectHandler=function(t){t.imgxuanzhong.visible=!t.imgxuanzhong.visible;if(t.imgxuanzhong.visible){this.addVO(t.itemVO)}else{this.delVO(t.itemVO)}};t.prototype.addVO=function(t){var e=false;for(var i=0,n=this.selectUids;i<n.length;i++){var a=n[i];if(Uint64.equal(t.getInstId(),a)){e=true;break}}if(!e){this.selectUids.push(t.getInstId());var o=csv.SixBoxProxy.getIns().getCfg(t.getItemId(),t.getLevel());var s=o?o.returnexp:0;this.curExp+=s;this.updateMoney()}};t.prototype.delVO=function(n){var a=false;this.selectUids.forEach(function(t,e,i){if(Uint64.equal(t,n.getInstId())){i.splice(e,1);a=true}});if(a){var t=csv.SixBoxProxy.getIns().getCfg(n.getItemId(),n.getLevel());var e=t?t.returnexp:0;this.curExp-=e;this.updateMoney()}};t.prototype.updateMoney=function(){var t=game.MoneyModel.format(game.GridsModel.getIns().getItemCount(game.ItemUtil.ENUMS.SIX_BOX));if(this.curExp>0){this.labelwenzi.text=t+"<span color='"+game.STYLES.ITEM_QUALITY_S[4]+"'>+"+game.MoneyModel.format(this.curExp)+"</span>"}else{this.labelwenzi.text=t}};t.prototype.clean=function(){this.selectUids.length=0;this.curExp=0};t.prototype.onSeletListRender=function(t){t.setData(t.dataSource)};t.prototype.onSeletListSelected=function(){this.labelmiaoshu.text=this.liastxiala.selectedItem.label;if(this.boxxuanze.selected){i.SixBoxModel.getIns().onLuheAutoDecomposeReq(this.boxxuanze.selected?1:0,this.liastxiala.selectedItem.qua)}this.clean();this.showItem()};t.prototype.hideList=function(){this.liastxiala.visible=false};t.prototype.onShowList=function(t){t.stopPropagation();this.liastxiala.visible=!this.liastxiala.visible};t.SINGLE_KEY="sixBox.SixBoxDecomposeView";return t}(ui.liuheyin.liuhebeibaobaofenjieviewUI);i.SixBoxDecomposeView=t})(sixBox||(sixBox={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var sixBox;(function(s){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.list=new component.SimpleGroupList;this.list.groupRender=s.SixHechengTypeItem;this.list.itemRender=s.SixHechengSubTypeItem;this.list.itemRenderHandler=new Laya.Handler(this,this.onSubTypeRenderHandler);this.list.groupRenderHandler=new Laya.Handler(this,this.onTypeRenderHandler);this.list.vScrollBarSkin=" ";this.list.groupKey="totaltype";this.list.boOpenOne=false;this.addChild(this.list);this.list.width=this.panelanniu.width;this.list.height=this.panelanniu.height;this.list.x=this.panelanniu.x;this.list.y=this.panelanniu.y;this.costItemArr=[this.gezi3,this.gezi4,this.gezi1];this.clean(this.gezi1);this.clean(this.gezi2);this.clean(this.gezi3);this.clean(this.gezi4);this.listshuxing.itemRender=ui.common.commonattr8UI;this.listshuxing.renderHandler=new Laya.Handler(this,this.onAttrRender);this.btnUpgrade.clickHandler=new Laya.Handler(this,this.onUpgrade);game.HelperViewHandler.registerStr([this.btntishi,this.labelguizeshuom],"func86t","liuhe_thirdinterface_1")};e.prototype.onUpgrade=function(){var t=game.ItemUtil.parserList(this.ele.synthesis_materials1);var e=true;for(var i=0,n=t;i<n.length;i++){var a=n[i];var o=game.GridsModel.getIns().getItemCount(a.getItemId());if(o<a.count){manager.FlowManager.instance.flowByStyle1(app.getLang("item_not_enough",a.getName()));e=false;break}}if(e){s.SixBoxModel.getIns().onLuheSynthesisReq(this.ele.id)}};e.prototype.onAttrRender=function(t){t.txtvalue.align="center";t.txtvalue.text=Attributes.getShowLabel(t.dataSource,"{0} +{1}")};e.prototype.clean=function(t){t.setData(game.GridsModel.LOCKED);t.jiahao.visible=false};e.prototype.onTypeRenderHandler=function(t,e){t.setData(t.dataSource)};e.prototype.onSubTypeRenderHandler=function(t,e){t.setData(t.dataSource)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll);s.SixBoxModel.getIns().on(e.LUHE_SYNTHES_SUCCESS,this,this.onSynthesAct)};e.prototype.onUnDisplay=function(){s.SixBoxModel.getIns().off(e.LUHE_SYNTHES_SUCCESS,this,this.onSynthesAct)};e.prototype.onSynthesAct=function(){var t=game.ItemUtil.parserList(this.ele?this.ele.synthesis_materials1:"");for(var e=0;e<3;e++){this.costItemArr[e].setData(t[e]||game.GridsModel.LOCKED);this.costItemArr[e].setItemCount()}var i=game.GridsModel.getIns().getEnoughNum(t);if(i==0){this.btnUpgrade.gray=true;this.btnUpgrade.mouseEnabled=false;game.RedDotView.removeFrom(this.btnUpgrade)}else{this.btnUpgrade.gray=false;this.btnUpgrade.mouseEnabled=true;game.RedDotView.addTo(this.btnUpgrade)}if(this.ele){var n=game.ItemUtil.createVO(this.ele.synthesis_item);this.gezi2.setData(n,0,1);var a=csv.SixBoxProxy.getIns().getCfg(n.getItemId(),1);this.listshuxing.array=Attributes.decode(a?a.prop:"").baseList;this.labelimiaoshu1.text=app.getLang(n.itemCfg.clientget)}else{this.gezi2.setData(game.GridsModel.LOCKED);this.listshuxing.array=[];this.labelimiaoshu1.text=""}};e.prototype.refreshAll=function(){var t=csv.HechengProxy.getIns().getArr(csv.HechengProxy.ENUM.SIXBOX);this.list.dataSource=t;var e=0;for(var i=0,n=t.length;i<n;++i){if(synthesis.HechengModel.getIns().getSynthesisRed(t[i])){e=i;break}}this.list.selectedIndex=e;this.list.scrollToIndex(e);this.list.selectedItem=t[e];this.updateView(t[e],this.list.getSubItem(t[e].totaltype,t[e]))};e.prototype.updateView=function(t,e){this.ele=t;if(this.selectItem){this.selectItem.imgxuanzhong.visible=false}if(e){e.imgxuanzhong.visible=true}this.selectItem=e;this.hechengType=2;this.onSynthesAct()};e.SINGLE_KEY="sixBox.SixBoxHeChengView";e.LUHE_SYNTHES_SUCCESS="sixBox.LuheSynthesisAck";return e}(ui.liuheyin.rongheviewnewUI);s.SixBoxHeChengView=t})(sixBox||(sixBox={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var sixBox;(function(h){var t=function(i){__extends(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){i.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.roleMediator=new common.RoleListMediator(this.itemxuanze.xuanzelist,equip.RoleItem,new Laya.Handler(this,this.roleSelectChange));this.roleMediator.setData(0);this.equipArr=[];for(var t=1;t<=equip.EquipStatic.SIXBOX_NUM;t++){var e=this["item"+t];e.position=t;this.equipArr.push(e)}this.aniNone.play(0,false);this.aniReplace.stop();this.aniMax.stop();this.btnShow.clickHandler=new Laya.Handler(this,this.showListView);this.btnAttr.clickHandler=new Laya.Handler(this,this.showTotalAttr);this.btnUpgrade.clickHandler=new Laya.Handler(this,this.onBtnClick,[3]);this.btnReplace.clickHandler=new Laya.Handler(this,this.onBtnClick,[4]);this.btnEquip.clickHandler=new Laya.Handler(this,this.onBtnClick,[5]);this.listshuxing.itemRender=game.ComAttrItem9;this.listshuxing.renderHandler=new Laya.Handler(this,this.onAttrRender);this.skillGrid.clickHandler=new Laya.Handler(this,this.onSkillGridClick);this.costItem.parserIconByItemId(game.ItemUtil.ENUMS.SIX_BOX);game.HelperViewHandler.registerStr([this.btnTips,this.txtTips],"func86t","liuhe_firstinterface_1")};t.prototype.onSkillGridClick=function(){if(this.skillGrid.data instanceof items.ItemVO){tip.TipManager.showSixBox(this.skillGrid.data,[])}};t.prototype.onAttrRender=function(t){t.setData(t.dataSource,true);if(this.selectItem.isOther){t.txtNext.visible=false}else{t.txtNext.visible=true}};t.prototype.showListView=function(){app.ViewManager.toggleDialog(h.SixBoxAllView,1,0)};t.prototype.showTotalAttr=function(){var t=h.SixBoxModel.getIns().getEquipItem(this.roleMediator.selectedRoleUid,h.SixBoxModel.getIns().items);app.ViewManager.toggleDialog(tip.TipSimpleMeiator,1,0,[h.SixBoxAttrTips,t,this.txtScore.value])};t.prototype.onBtnClick=function(t){var e=this.selectItem?this.selectItem.getItemData():null;var i="";if(e===game.GridsModel.LOCKED){i=this.unLockDesc()}if(i.length>0){manager.FlowManager.instance.flowByStyle1(this.unLockDesc())}else if(t==3){if(e instanceof items.ItemVO){var n=h.SixBoxModel.getIns().canUpgrade(e,true);if(n){h.SixBoxModel.getIns().onLuheUpdateReq(this.roleMediator.selectedRoleUid,this.selectItem.position,e.getInstId())}}else{manager.FlowManager.instance.flowByStyle1(app.getLang("liuhe_warn_msg_2"))}}else{var a=game.GridsModel.SixBoxEnums[this.roleMediator.selectedIndex];h.SixBoxModel.getIns().showSixBoxChooseView(a,this.selectItem.position,this.roleMediator.selectedRoleUid,t)}};t.prototype.onDisplay=function(){this.onOpen=true;h.SixBoxModel.getIns().on(h.SixBoxMainView.LUHEINFO_UPDATE,this,this.refreshAll);h.SixBoxModel.getIns().on(h.SixBoxMainView.LUHE_UPGRADE,this,this.setLevel);h.SixBoxModel.getIns().onLuheInfoReq()};t.prototype.onUnDisplay=function(){h.SixBoxModel.getIns().off(h.SixBoxMainView.LUHEINFO_UPDATE,this,this.refreshAll);h.SixBoxModel.getIns().off(h.SixBoxMainView.LUHE_UPGRADE,this,this.setLevel)};t.prototype.refreshAll=function(){if(this.dataSource&&this.dataSource.length==1){this.roleMediator.setData(this.dataSource[0])}else{this.setRoleData(this.onOpen)}this.onOpen=false;this.onUpdateView()};t.prototype.onUpdateView=function(){h.SixBoxModel.getIns().selectedRoleUid=this.roleMediator.selectedRoleUid;var t=game.Context.roleMap[this.roleMediator.selectedRoleUid.toString()];this.setEquips();var e=false;var i=0;for(var n=1;n<=equip.EquipStatic.SIXBOX_NUM;n++){var a=csv.SixBoxProxy.getIns().isLock(t.level,n);if(!a){e=h.SixBoxModel.getIns().getCanEquipList(t.insId,n).length>0;if(e){i=n-1;break}}}if(!e){for(var n=1;n<=equip.EquipStatic.SIXBOX_NUM;n++){var a=csv.SixBoxProxy.getIns().isLock(t.level,n);if(!a){e=h.SixBoxModel.getIns().getUpgradeReddot(t.insId,n);if(e){i=n-1;break}}}}this.updateItem(this.equipArr[i])};t.prototype.roleSelectChange=function(){this.onUpdateView()};t.prototype.setRoleData=function(t){var e=this.roleMediator.selectedIndex;var i=h.SixBoxModel.getIns().getRedDotArr();if(t){for(var n=0;n<i.length;n++){if(i[n]){e=n;break}}}this.roleMediator.setData(e,i)};t.prototype.setEquips=function(){var t=game.GridsModel.SixBoxEnums[this.roleMediator.selectedIndex];var e=0;var i=[];var n=false;for(var a=1;a<=equip.EquipStatic.SIXBOX_NUM;a++){var o=h.SixBoxModel.getIns().getLuheItemData(this.roleMediator.selectedRoleUid,a);if(o){this.equipArr[a-1].setData(o,t,1,this.roleMediator.selectedRoleUid);this.equipArr[a-1].setLevel(o.getLevel());var s=csv.SixBoxProxy.getIns().getCfg(o.getItemId(),o.getLevel());var r=Attributes.decode(s?s.prop:"").baseList;i=i.concat(r)}else{var l=csv.SixBoxProxy.getIns().isLock(this.roleMediator.selectedRoleVo.level,a);var s=game.GridsModel.EMPTY;if(l){s=game.GridsModel.LOCKED}this.equipArr[a-1].setData(s,t,0,this.roleMediator.selectedRoleUid);this.equipArr[a-1].clean()}}this.txtScore.value=""+Attributes.getScore(this.roleMediator.selectedRoleVo.level,i)};t.prototype.updateItem=function(t){var e=false;if(this.selectItem){this.selectItem.xuanzhong.visible=false;e=this.selectItem.position==t.position}t.xuanzhong.visible=true;this.selectItem=t;this.showNext();return e};t.prototype.updateBtn=function(t){game.RedDotView.removeFrom(this.btnUpgrade);game.RedDotView.removeFrom(this.btnReplace);game.RedDotView.removeFrom(this.btnEquip);if(t instanceof items.ItemVO){var e=csv.SixBoxProxy.getIns().getMaxLevel(t.getItemId());if(t.getLevel()<e){this.aniReplace.play(0,false);this.listshuxing.visible=true;this.btnUpgrade.visible=true;this.txtView.y=this.listshuxing.y}else{this.aniMax.play(0,false);this.listshuxing.visible=false;this.imgyimanji.visible=true}if(h.SixBoxModel.getIns().canUpgrade(t,false)){game.RedDotView.addTo(this.btnUpgrade)}if(h.SixBoxModel.getIns().getCanEquipList(this.roleMediator.selectedRoleUid,this.selectItem.position).length>0){game.RedDotView.addTo(this.btnReplace)}}else{this.aniNone.play(0,false);this.btnEquip.visible=true;this.lblNone.visible=true;this.btnUpgrade.visible=true;if(t===game.GridsModel.LOCKED){this.lblNone.text=this.unLockDesc()}else if(t===game.GridsModel.EMPTY){this.lblNone.text=app.getLang("liuhe_ui_1");if(h.SixBoxModel.getIns().getCanEquipList(this.roleMediator.selectedRoleUid,this.selectItem.position).length>0){game.RedDotView.addTo(this.btnEquip)}}}};t.prototype.unLockDesc=function(){var t=csv.SixBoxProxy.getIns().getEquipCfg(this.selectItem.position);var e="";if(t){if(t.type===0){e=app.getLang("liuhe_ui_2",t.openlevel)}else if(t.type===1){e=app.getLang("liuhe_ui_3",t.openlevel)}}return e};t.prototype.setLevel=function(t){if(this.selectItem){this.selectItem.setLevel(t)}this.setEquips();this.setRoleData(false);this.showNext()};t.prototype.showNext=function(){var t=this.selectItem.getItemData();var e=0;if(t instanceof items.ItemVO){var i=t.getLevel();var n=i+1;e=csv.SixBoxProxy.getIns().getMaxLevel(t.getItemId());if(n>=e){n=e;this.labelxiaohao.text=app.getLang("liuhe_ui_4",game.MoneyModel.format(game.GridsModel.getIns().getItemCount(game.ItemUtil.ENUMS.SIX_BOX)))}this.skillGrid.setData(t);this.skillGrid.shuzi.text=app.getLang("zuoqi_11")+i;this.txtName.text=t.getName();var a=csv.SixBoxProxy.getIns().getCfg(t.getItemId(),n);if(a){var o=game.ItemUtil.parserList(a.exp)[0];var s=game.GridsModel.getIns().getItemCount(o.getItemId());var r=o.count;var l=s<r?game.STYLES.RED_COLOR_S:game.STYLES.GREEN_COLOR_S;this.txtMoney.text=app.getLang("<span color='{2}'>{0}/{1}</span>",game.MoneyModel.format(s),r,l);var h=csv.SixBoxProxy.getIns().getCfg(t.getItemId(),i);var p=Attributes.decode(h.prop);var u=Attributes.decode(a.prop);var c=[];var g=void 0;for(g=0;g<p.baseList.length;g++){var f={};f.curAttr=p.baseList[g];f.nextAttr=u.baseList[g];c.push(f)}this.listshuxing.array=c}}this.updateBtn(t)};t.SINGLE_KEY="sixBox.SixBoxMainView";t.LUHEINFO_UPDATE="sixBox.onLuheInfoUpdate";t.LUHE_UPGRADE="sixBox.onLuheUpdateAck";return t}(ui.liuheyin.liuheyinviewUI);h.SixBoxMainView=t})(sixBox||(sixBox={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var skin;(function(n){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){app.ViewManager.regist(n.SkinView,"shizhuang.atlas","chenghao.atlas");game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.SKIN,n.SkinNewView);csv.FunctionsProxy.getIns().on(csv.FunctionsProxy.EVENTS.CHANGE,this,this.onRedDotChange);game.GridObserver.getIns().onItemType(csv.ItemProxy.TYPES.SKIN,this,this.onRedDotChange);game.RoleModel.getIns().on(game.RoleModel.EVENTS.PLAYER_NUM_MODIFY,this,this.onRedDotChange)};e.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.SkinInfoAck,this,this.onSkinInfoAck);this.addMsgListener(app.ProtocolResponse.SkinEquipAck,this,this.onSkinEquipAck);this.addMsgListener(app.ProtocolResponse.SkinActiveAck,this,this.onSkinActiveAck);this.addMsgListener(app.ProtocolResponse.SkinReceiveAck,this,this.onSkinReceiveAck);this.addMsgListener(app.ProtocolResponse.SkinUpStarAck,this,this.onSkinUpStarAck)};e.prototype.onSkinUpStarAck=function(t,e){if(e.success){var i=n.SkinModel.getIns().getSkinDataById(e.skinId);i.star=e.star;n.SkinModel.getIns().event(n.SkinModel.UPDATE_SKIN_STAR);n.SkinModel.getIns().updataRed()}};e.prototype.onRedDotChange=function(){Laya.timer.callLater(this,this.onUpdateRedDot)};e.prototype.onUpdateRedDot=function(){n.SkinModel.getIns().updataRed()};e.prototype.onSkinReceiveAck=function(t,e){if(e.success==1){}};e.prototype.onSkinActiveAck=function(t,e){if(e.success==1){n.SkinModel.getIns().onSkinActiveAck(e.skinId,e.role);app.ViewManager.toggleView(n.SkinActView,app.AppContainer.flowLayer,1,[e.skinId])}};e.prototype.onSkinEquipAck=function(t,e){if(e.success==1){n.SkinModel.getIns().onSkinEquipAck(e.skinId,e.role,e.opeate);this.onUpdateRedDot()}};e.prototype.onSkinInfoAck=function(t,e){n.SkinModel.getIns().updateSkinInfo(e);this.onUpdateRedDot()};e.SINGLE_KEY="skin.SkinModule";return e}(app.ModuleBase);n.SkinModule=t})(skin||(skin={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var skin;(function(t){var e=function(e){__extends(o,e);function o(){var t=e!==null&&e.apply(this,arguments)||this;t.receiveArr=[];t._skinIdNew=[];return t}o.getIns=function(){return app.Singleton.getInstance(o)};o.prototype.init=function(){};o.prototype.updateSkinInfo=function(t){this.skinList=t.skinList;this.skinlv=t.skinlv;this.exp=t.exp;this.event(o.UPDATE_SKIN_VIEW)};o.prototype.updataRed=function(){var t=this.getRedDotArr();game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.SKIN);game.ClosureManager.removeXin(csv.FunctionsProxy.ENUMS.SKIN);for(var e in game.Context.roleList){if(t[e]==1){game.ClosureManager.addXin(csv.FunctionsProxy.ENUMS.SKIN);break}else if(t[e]==2){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.SKIN);break}}};o.prototype.getRedDotArr=function(){var t=[];var e;var i=[];var n=0;var a=[];for(var o=0;o<game.Context.TOTAL_ROLE_NUM;o++){var s=o+1;n=0;i=[];a=[];if(game.Context.roleList[o]){i=csv.SkinProxy.getIns().getSkinList(game.Context.roleList[o].prof)}for(var r=0;r<i.length;r++){e=this.getSkinDataById(parseInt(i[r].id),s);if(e){a.push(e)}}if(n==0){var l=false;var h=false;for(var p=0;p<a.length;p++){if(a[p].isEquip==1){l=true}var u=csv.SkinProxy.getIns().getSkinUpdateCfg(a[p].skinId,a[p].star+1);if(u){var c=game.ItemUtil.parserList(u.cost)[0];if(game.GridsModel.getIns().hasEnoughItems(c)){h=true;break}}}if(h||a.length>0&&!l){n=2}}t.push(n)}return t};o.prototype.getSkinDataById=function(t,e){if(e===void 0){e=0}var i;for(var n in this.skinList){if(t==this.skinList[n].skinId){i=this.skinList[n];break}}return i};o.prototype.onSkinEquipAck=function(t,e,i){var n;for(var a in this.skinList){if(this.skinList[a].role==e){n=this.skinList[a];if(t==this.skinList[a].skinId){if(i==1){n.isEquip=1}else if(i==2){n.isEquip=0}}else{n.isEquip=0}}}this.event(o.UPDATE_SKIN_VIEW,[false])};Object.defineProperty(o.prototype,"skinIdNew",{get:function(){return this._skinIdNew},set:function(t){this._skinIdNew=t;this.updataRed()},enumerable:true,configurable:true});o.prototype.onSkinActiveAck=function(t,e){var i=this.getSkinDataById(t,e);var n=this.skinIdNew;n.push(t);this.skinIdNew=n;if(i){i.activeCount+=1}else{i=new SkinData;i.skinId=t;i.role=e;i.activeCount=1;i.isEquip=0;this.skinList.push(i)}this.event(o.UPDATE_SKIN_VIEW,[false]);this.event(o.ACTIVE_SKIN_ACT,t)};o.prototype.getEquipSkinId=function(t){var e=0;for(var i in this.skinList){var n=this.skinList[i];if(n.role==t){if(n.isEquip==1){e=n.skinId;break}}}return e};o.SINGLE_KEY="skin.SkinModel";o.UPDATE_SKIN_STAR="UPDATE_SKIN_STAR";o.UPDATE_SKIN_VIEW="UPDATE_SKIN_VIEW";o.ACTIVE_SKIN_ACT="ACTIVE_SKIN_ACT";o.SKIN_RECYCLE_REDDOT="SKIN_RECYCLE_REDDOT";return o}(app.ModelBase);t.SkinModel=e})(skin||(skin={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("skin.csv");this.cfgMap=t.getMap("id");this._array=t.getArray();var e=app.Config.getResById("skin_update.csv");this.skinLvMap=e.getMapList("skinid")};e.prototype.getSkinList=function(t){if(t===void 0){t=0}var e=[];for(var i=0;i<this._array.length;i++){if(t==0||this._array[i].type==t){e.push(this._array[i])}}return e};e.prototype.getCfg=function(t){return this.cfgMap[t]};e.prototype.getSkinUpdateCfg=function(t,e){var i=this.skinLvMap[t];if(i){return this.skinLvMap[t][e-1]}return null};e.prototype.getMaxLv=function(t){var e=this.skinLvMap[t];return e?e.length:0};e.SINGLE_KEY="csv.SkinProxy";return e}(app.ModelBase);t.SkinProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var skin;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.on(Laya.Event.CLICK,this,this.btnquereHandler);this.x=(Laya.stage.width-this.width)/2;this.y=(Laya.stage.height-this.height)/2;this.imgdiban.width=Laya.stage.width;this.imgdiban.height=Laya.stage.height};e.prototype.btnquereHandler=function(){app.ViewManager.toggleView(i.SkinActView,app.AppContainer.flowLayer,-1)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){this.skt&&this.skt.stop();this.ani1.stop();this.ani2.stop()};e.prototype.refreshAll=function(){var t=csv.SkinProxy.getIns().getCfg(this.dataSource[0]);this.setAvatar(t.modelres);this.ani1.play(0,false);this.ani2.play(0,true)};e.prototype.setAvatar=function(t){if(this.skt&&this.skt.parent){this.skt.removeSelf()}else{this.skt=new common.CSkt}this.skt.init(role.RoleVO.getSkinSkt(t));this.shizhuang.addChild(this.skt)};e.SINGLE_KEY="skin.SkinActView";return e}(ui.jiesuan.gongxihuodejiesuanUI);i.SkinActView=t})(skin||(skin={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var skin;(function(y){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.imglock.visible=false;this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.updateLayout)};e.prototype.onUnDisplay=function(){};e.prototype.updateLayout=function(){};e.prototype.setData=function(t){this.imgqichengzhong.visible=false;game.RedDotView.removeFrom(this);if(!t){return}var e=y.SkinModel.getIns().getSkinDataById(t.id);this.labelname.text=app.getLang(t.name);this.imgtouxiang.skin="res/icon/item/item_"+t.skinid+".png";if(e){if(e.isEquip==1){this.imgqichengzhong.visible=true}this.box.gray=false;var i=csv.SkinProxy.getIns().getSkinUpdateCfg(t.id,e.star+1);if(i){if(game.GridsModel.getIns().hasEnoughItems(i.cost)){game.RedDotView.addTo(this,121,7)}}}else{this.box.gray=true;if(game.GridsModel.getIns().hasEnoughItems(t.skinid)){game.RedDotView.addTo(this,121,7)}}};e.SINGLE_KEY="skin.SkinCell";return e}(ui.shizhuang.shizhuangitemnewUI);y.SkinCell=t;var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.roleMediator=new common.RoleListMediator(this.touxianglist.xuanzelist,equip.RoleItem,new Laya.Handler(this,this.roleSelectChange));this.skinList=new common.CommonListMediator(this.listzuoqi,y.SkinCell,new Laya.Handler(this,this.onSkinRenderHandler));this.skinList.setHSkin();this.skinList.on(common.CommonListMediator.LIST_ITEM_SELECT,this,this.onSelectHandler);this.shengjiani.visible=false;this.dipanani.visible=false;this.shengjiani.on(Laya.Event.COMPLETE,this,this.onShengjiAniEnd);this.listshuxing.itemRender=ui.shizhuang.shizhuangitemnew2UI;this.listshuxing.renderHandler=new Laya.Handler(this,this.onAttatRenderHandler);this.listAttrNext.itemRender=ui.shizhuang.shizhuangitemnew2UI;this.listAttrNext.renderHandler=new Laya.Handler(this,this.onAttatRenderHandler);this.btnjihuo.clickHandler=new Laya.Handler(this,this.onBtnJihuoClick);this.btnzuoqi.clickHandler=new Laya.Handler(this,this.onBtnzuoqiClick);this.btnCancel.clickHandler=new Laya.Handler(this,this.onBtnzuoqiClick)};e.prototype.roleSelectChange=function(){this.onUpdateView(true)};e.prototype.onShengjiAniEnd=function(){this.shengjiani.visible=false;this.shengjiani.stop()};e.prototype.onBtnJihuoClick=function(){var t=y.SkinModel.getIns().getSkinDataById(this.skinList.list.selectedItem.id);if(t){if(t){app.ProtocolRequest.SkinUpStarReq(this.skinList.list.selectedItem.id)}else{app.ProtocolRequest.SkinActiveReq(this.skinList.list.selectedItem.id)}}};e.prototype.onBtnzuoqiClick=function(){var t=y.SkinModel.getIns().getSkinDataById(this.skinList.list.selectedItem.id);if(t){var e=csv.SkinProxy.getIns().getCfg(this.skinList.list.selectedItem.id);app.ProtocolRequest.SkinEquipReq(t.skinId,e.type,t.isEquip?2:1)}};e.prototype.onAttatRenderHandler=function(t){t.jinengname.text=app.getLang("title_tips1")+Attributes.getPropName(t.dataSource.propId);t.lblNext.text="+"+Attributes.getPropValue(t.dataSource.propId,t.dataSource.value,t.dataSource.formula)};e.prototype.onSkinRenderHandler=function(t,e){if(e==this.skinList.list.selectedIndex){t.imgxuanzhong.visible=true}else{t.imgxuanzhong.visible=false}t.setData(t.dataSource)};e.prototype.actBack=function(){this.shengjiani.visible=true;this.shengjiani.play(0,false);this.onSelectHandler()};e.prototype.onStarChange=function(){this.roleMediatorReddotUpdate();this.skinList.list.refresh();this.actBack()};e.prototype.onSkinUpdate=function(){this.roleMediatorReddotUpdate();this.skinList.list.refresh();this.onSelectHandler()};e.prototype.onSelectHandler=function(){var t=this.skinList.list.selectedItem;if(!t)return;var e=game.ItemUtil.parserList(t.cost)[0];this.setAvatar(t.modelres);this.updateSelectSkin()};e.prototype.updateSelectSkin=function(){var t=this.skinList.list.selectedItem;var e=false;var i=y.SkinModel.getIns().getSkinDataById(t.id);var n=csv.SkinProxy.getIns().getMaxLv(t.id);var a;if(i){this.btnjihuo.label=app.getLang("zuoqi_8");this.dipanani.visible=true;this.dipanani.play(0);if(i.isEquip==1){this.btnzuoqi.visible=false}else{this.btnzuoqi.visible=true}this.btnCancel.visible=!this.btnzuoqi.visible;this.zhanlibox.visible=false;if(i.star<n){this.ani1.gotoAndStop(0)}else{this.manjiimg.skin="public/bg_yimanji.png";this.ani1.gotoAndStop(1)}var o=csv.SkinProxy.getIns().getSkinUpdateCfg(t.id,i.star);var s=csv.SkinProxy.getIns().getSkinUpdateCfg(t.id,i.star+1);var r="";if(o){r=o.attributes}else{r=t.attrfirst}this.wujiaoxing.value=i.star;this.wujiaoxing.visible=true;if(s){a=game.ItemUtil.parserList(s.cost)[0]}var l=Attributes.decode(r);var h=Attributes.decode(s?s.attributes:"");if(!l){for(var p=0;p<h.baseList.length;p++){l.baseList[p]=new PropValue;l.baseList[p].propId=h.baseList[p].propId;l.baseList[p].flag=h.baseList[p].flag;l.baseList[p].formula=h.baseList[p].formula;l.baseList[p].value=0}}this.listshuxing.array=l.baseList;this.listAttrNext.array=h.baseList;e=a?game.GridsModel.getIns().hasEnoughItems(a):false;if(e){this.btnjihuo.disabled=false}else{this.btnjihuo.disabled=true}this.zhanlishuzhi.value=o?o.addbattery:t.addbattery+""}else{this.ani1.gotoAndStop(2);this.wujiaoxing.visible=false;this.btnjihuo.label=app.getLang("zuoqi_6");this.dipanani.visible=false;this.dipanani.stop();a=game.ItemUtil.parserList(t.skinid+"-"+1)[0];e=game.GridsModel.getIns().hasEnoughItems(a);this.manjiimg.skin="public/bg_weijihuo.png";if(e){this.btnjihuo.disabled=false;this.btnzuoqi.visible=false;this.btnCancel.visible=false}else{this.btnjihuo.disabled=true;this.btnzuoqi.visible=false;this.btnCancel.visible=false}this.zhanlibox.visible=true;var u=Attributes.decode(t.attrfirst);var c=Attributes.decode("");for(var p=0;p<u.baseList.length;p++){c.baseList[p]=new PropValue;c.baseList[p].propId=u.baseList[p].propId;c.baseList[p].flag=u.baseList[p].flag;c.baseList[p].formula=u.baseList[p].formula;c.baseList[p].value=0}this.listshuxing.array=u.baseList;this.listAttrNext.array=u.baseList;this.zhanlishuzhi.value=t.addbattery+""}this.zhanlibox.visible=!this.zhanlibox.visible;this.daoju.setData(t.skinid);if(a&&t.skinid>0){var g=game.GridsModel.getIns().getItemCount(t.skinid);game.ItemShowUtil.showLabelColor(this.daoju.shuzi,a.count,g);this.daoju.shuzi.text=game.MoneyModel.format(g)+"/"+a.count}if(e){game.RedDotView.addTo(this.btnjihuo)}else{game.RedDotView.removeFrom(this.btnjihuo)}if(i&&i.activeCount>0){var f=y.SkinModel.getIns().skinIdNew.indexOf(i.skinId);if(f>=0){var d=y.SkinModel.getIns().skinIdNew;d.splice(f,1);y.SkinModel.getIns().skinIdNew=d;this.roleMediatorReddotUpdate()}}};e.prototype.setAvatar=function(t){if(this.skt&&this.skt.parent){this.skt.removeSelf()}else{this.skt=new common.CSkt}this.skt.init(role.RoleVO.getSkinSkt(t));this.skt.scale(.8,.8);this.weizhi.addChild(this.skt)};e.prototype.onDisplay=function(){y.SkinModel.getIns().on(y.SkinModel.UPDATE_SKIN_VIEW,this,this.onSkinUpdate);y.SkinModel.getIns().on(y.SkinModel.UPDATE_SKIN_STAR,this,this.onStarChange);app.ProtocolRequest.SkinInfoReq();this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){y.SkinModel.getIns().off(y.SkinModel.UPDATE_SKIN_VIEW,this,this.onSkinUpdate);y.SkinModel.getIns().off(y.SkinModel.UPDATE_SKIN_STAR,this,this.onStarChange);this.skt&&this.skt.stop();this.dipanani.visible=false;this.dipanani.stop()};e.prototype.refreshAll=function(){if(this.dataSource&&this.dataSource.length==1){this.roleMediator.setData(this.dataSource[0],[])}else{this.onUpdateView()}};e.prototype.roleMediatorReddotUpdate=function(){var t=y.SkinModel.getIns().getRedDotArr();var e=[],i=[];for(var n=0;n<t.length;n++){if(t[n]==1){e.push(true);i.push(false)}else if(t[n]==2){e.push(false);i.push(true)}else{e.push(false);i.push(false)}}this.roleMediator.setRedArr(i);this.roleMediator.setXinArr(e)};e.prototype.onUpdateView=function(t){if(t===void 0){t=true}this.setRoleData(t);if(t){this._skinList=csv.SkinProxy.getIns().getSkinList(this.roleMediator.selectedRoleVo.prof);this._skinList.sort(this.sortHToL);var e=t?this.getDefaultIndex():this.skinList.list.selectedIndex;if(e<0){e=0}this.skinList.setData(e,this._skinList)}else{this.skinList.list.refresh();this.updateSelectSkin()}};e.prototype.setRoleData=function(t){var e=this.roleMediator.selectedIndex>=0?this.roleMediator.selectedIndex:0;var i=-1;var n=y.SkinModel.getIns().getRedDotArr();var a=[],o=[];for(var s=0;s<n.length;s++){if(n[s]==1){a.push(true);o.push(false)}else if(n[s]==2){a.push(false);o.push(true)}else{a.push(false);o.push(false)}}if(t){for(var s=0;s<a.length;s++){if(a[s]){i=s;break}}if(i==-1){for(var s=0;s<o.length;s++){if(o[s]){i=s;break}}}}if(i>=0){e=i}this.roleMediator.setData(e,o,a)};e.prototype.getRoleIndex=function(){return this.roleMediator.selectedIndex+1};e.prototype.getDefaultIndex=function(){var t=0;for(var e in this._skinList){var i=y.SkinModel.getIns().getSkinDataById(parseInt(this._skinList[e].id),this.getRoleIndex());var n=game.GridsModel.getIns().getItemCount(parseInt(this._skinList[e].skinid));if(n>0){if(!i||i.activeCount<2){t=parseInt(e);break}}}if(t==0){for(var e in this._skinList){var i=y.SkinModel.getIns().getSkinDataById(parseInt(this._skinList[e].id),this.getRoleIndex());if(i&&i.isEquip==1){t=parseInt(e);break}}}if(t==0){for(var e in this._skinList){var i=y.SkinModel.getIns().getSkinDataById(parseInt(this._skinList[e].id),this.getRoleIndex());if(i&&i.activeCount>0){t=parseInt(e);break}}}return t};e.prototype.sortHToL=function(t,e){var i=y.SkinView.getIns().getRoleIndex();var n=y.SkinModel.getIns().getSkinDataById(parseInt(t.id),i);var a=y.SkinModel.getIns().getSkinDataById(parseInt(e.id),i);if(n&&!a)return-1;if(!n&&a)return 1;if(n&&a){if(n.isEquip>a.isEquip){return-1}if(n.isEquip<a.isEquip){return 1}if(n.activeCount>a.activeCount){return-1}if(n.activeCount<a.activeCount){return 1}}if(parseInt(t.id)<parseInt(e.id)){return-1}if(parseInt(t.id)>parseInt(e.id)){return 1}return 0};e.SINGLE_KEY="skin.SkinNewView";return e}(ui.shizhuang.shizhuangviewnewUI);y.SkinNewView=e})(skin||(skin={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var skin;(function(r){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t._currentIndex=0;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.roleMediator=new common.RoleListMediator(this.itemxuanze.xuanzelist,equip.RoleItem,new Laya.Handler(this,this.roleSelectChange));this.initButton();this.initSkinList();this.shuxinglist.itemRender=game.ComAttrItem10;this.shuxinglist.renderHandler=game.ComAttrItem10.CommonRender;this.tiaojianlab.text=""};t.prototype.setAvatar=function(t){if(this.skt&&this.skt.parent){this.skt.removeSelf()}else{this.skt=new common.CSkt}this.skt.init(role.RoleVO.getSkinSkt(t));this.skt.scale(.8,.8);this.weizhi.addChild(this.skt)};t.prototype.initButton=function(){this.btnEquip.on(Laya.Event.CLICK,this,this.onEquip)};t.prototype.initSkinList=function(){this.skinList=new common.CommonListMediator(this.shizhuanglist,r.SkinItem);this.skinList.setHSkin()};t.prototype.onDisplay=function(){r.SkinModel.getIns().on(r.SkinModel.UPDATE_SKIN_VIEW,this,this.onUpdateView);this.skinList.on(common.CommonListMediator.LIST_ITEM_SELECT,this,this.onTabBarSelect);app.ProtocolRequest.SkinInfoReq();this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){r.SkinModel.getIns().off(r.SkinModel.UPDATE_SKIN_VIEW,this,this.onUpdateView);this.skinList.off(common.CommonListMediator.LIST_ITEM_SELECT,this,this.onTabBarSelect);this.skt&&this.skt.stop()};t.prototype.refreshAll=function(){if(this.dataSource&&this.dataSource.length==1){this.roleMediator.setData(this.dataSource[0],[])}};t.prototype.setRoleData=function(t){var e=this.roleMediator.selectedIndex>=0?this.roleMediator.selectedIndex:0;var i=-1;var n=r.SkinModel.getIns().getRedDotArr();var a=[],o=[];for(var s=0;s<n.length;s++){if(n[s]==1){a.push(true);o.push(false)}else if(n[s]==2){a.push(false);o.push(true)}else{a.push(false);o.push(false)}}if(t){for(var s=0;s<a.length;s++){if(a[s]){i=s;break}}if(i==-1){for(var s=0;s<o.length;s++){if(o[s]){i=s;break}}}}if(i>=0){e=i}this.roleMediator.setData(e,o,a)};t.prototype.roleMediatorReddotUpdate=function(){var t=r.SkinModel.getIns().getRedDotArr();var e=[],i=[];for(var n=0;n<t.length;n++){if(t[n]==1){e.push(true);i.push(false)}else if(t[n]==2){e.push(false);i.push(true)}else{e.push(false);i.push(false)}}this.roleMediator.setRedArr(i);this.roleMediator.setXinArr(e)};t.prototype.onUpdateView=function(t){if(t===void 0){t=true}this.setRoleData(t);if(t){this._skinList=csv.SkinProxy.getIns().getSkinList(this.roleMediator.selectedRoleVo.prof);this._skinList.sort(this.sortHToL);var e=t?this.getDefaultIndex():this.skinList.list.selectedIndex;if(e<0){e=0}this.skinList.setData(e,this._skinList)}else{this.skinList.list.refresh();this.onTabBarSelect(this.skinList.selecItemData)}};t.prototype.getDefaultIndex=function(){var t=0;for(var e in this._skinList){var i=r.SkinModel.getIns().getSkinDataById(parseInt(this._skinList[e].id),this.getRoleIndex());var n=game.GridsModel.getIns().getItemCount(parseInt(this._skinList[e].skinid));if(n>0){if(!i||i.activeCount<2){t=parseInt(e);break}}}if(t==0){for(var e in this._skinList){var i=r.SkinModel.getIns().getSkinDataById(parseInt(this._skinList[e].id),this.getRoleIndex());if(i&&i.isEquip==1){t=parseInt(e);break}}}if(t==0){for(var e in this._skinList){var i=r.SkinModel.getIns().getSkinDataById(parseInt(this._skinList[e].id),this.getRoleIndex());if(i&&i.activeCount>0){t=parseInt(e);break}}}return t};t.prototype.onTabBarSelect=function(t){this.btnEquip.label=app.getLang("title_load");var e=this.roleMediator.selectedIndex+1;var i=r.SkinModel.getIns().getSkinDataById(parseInt(t.id),e);this.weihuodeiomg.visible=false;if(i){if(i.activeCount>0&&i.isEquip){this.btnEquip.label=app.getLang("title_upload")}}else{this.weihuodeiomg.visible=true}this.btnEquip.visible=!this.weihuodeiomg.visible;this.setAvatar(t.modelres);this.setAttr(t.attrfirst);this._currentIndex=this.skinList.list.selectedIndex;if(i&&i.activeCount>0){var n=r.SkinModel.getIns().skinIdNew.indexOf(i.skinId);if(n>=0){var a=r.SkinModel.getIns().skinIdNew;a.splice(n,1);r.SkinModel.getIns().skinIdNew=a;this.roleMediatorReddotUpdate()}}};t.prototype.setAttr=function(t){var e=Attributes.decode(t);this.shuxinglist.array=e.baseList};t.prototype.onEquip=function(){var t=r.SkinModel.getIns().getSkinDataById(parseInt(this.skinList.selecItemData.id),this.roleMediator.selectedIndex+1);if(t){app.ProtocolRequest.SkinEquipReq(t.skinId,this.roleMediator.selectedIndex+1,t.isEquip?2:1)}};t.prototype.roleSelectChange=function(){this.onUpdateView(true)};t.prototype.getRoleIndex=function(){return this.roleMediator.selectedIndex+1};t.prototype.sortHToL=function(t,e){var i=r.SkinView.getIns().getRoleIndex();var n=r.SkinModel.getIns().getSkinDataById(parseInt(t.id),i);var a=r.SkinModel.getIns().getSkinDataById(parseInt(e.id),i);if(n&&!a)return-1;if(!n&&a)return 1;if(n&&a){if(n.isEquip>a.isEquip){return-1}if(n.isEquip<a.isEquip){return 1}if(n.activeCount>a.activeCount){return-1}if(n.activeCount<a.activeCount){return 1}}if(parseInt(t.id)<parseInt(e.id)){return-1}if(parseInt(t.id)>parseInt(e.id)){return 1}return 0};t.SINGLE_KEY="skin.SkinView";return t}(ui.shizhuang.shizhuangviewUI);r.SkinView=t})(skin||(skin={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var skin;(function(o){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){o.SkinModel.getIns().on(o.SkinModel.UPDATE_SKIN_VIEW,this,this.refreshflag);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){o.SkinModel.getIns().off(o.SkinModel.UPDATE_SKIN_VIEW,this,this.refreshflag)};e.prototype.refreshAll=function(){};e.prototype.setData=function(t,e){this._data=t;var i=csv.SkinProxy.getIns().getCfg(t.id);var n=game.ItemUtil.createVO(t.skinid);if(n){this.imgtouxiang.skin=n.getIconUrl()}else{this.imgtouxiang.skin=""}this._skinData=o.SkinModel.getIns().getSkinDataById(t.id,o.SkinView.getIns().roleMediator.selectedIndex+1);if(this._skinData&&this._skinData.activeCount>0){this.imgbg.gray=false;this.imgtouxiang.gray=false;this.imgtouxiangbg.gray=false}else{this.imgbg.gray=true;this.imgtouxiang.gray=true;this.imgtouxiangbg.gray=true}this.refreshflag();this.imgname.skin="res/static/skin/"+i.title+".png";this.imgbgxuanzhong.visible=false;this.imghuisebgxuanzhong.visible=false;if(e&&e.id==t.id){this.imgbgxuanzhong.visible=this._skinData&&this._skinData.activeCount>0?true:false;this.imghuisebgxuanzhong.visible=!this.imgbgxuanzhong.visible}game.RedDotView.removeFrom(this);if(o.SkinModel.getIns().skinIdNew.indexOf(t.skinid)>=0){game.RedDotView.addTo(this,this.width-10,30,1,1,game.RedDotView.ENUM_TYPE.XIN)}else if(this._skinData){var a=o.SkinModel.getIns().getRedDotArr();if(a[o.SkinView.getIns().getRoleIndex()-1]==2){if(this._skinData.isEquip!=1){game.RedDotView.addTo(this,this.width,30,1,1)}}}};e.prototype.refreshflag=function(){this.imgyipeidai.visible=false;if(this._skinData&&this._skinData.isEquip==1){this.imgyipeidai.visible=true}};e.SINGLE_KEY="skin.SkinItem";return e}(ui.shizhuang.shizhuangitem01UI);o.SkinItem=t})(skin||(skin={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var social;(function(o){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){app.ViewManager.regist(o.MailMainView,"youjian.atlas");game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.MAIL,o.MailMainView)};e.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.MailBoxAck,this,this.onMailBoxAck);this.addMsgListener(app.ProtocolResponse.MailBoxInfAck,this,this.onMailBoxInfAck);this.addMsgListener(app.ProtocolResponse.MailAnnexAck,this,this.onMailAnnexAck);this.addMsgListener(app.ProtocolResponse.MailDeleteAck,this,this.onMailDeleteAck);this.addMsgListener(app.ProtocolResponse.NewMailAck,this,this.onNewMailAck)};e.prototype.onMailBoxAck=function(t,e){o.MailModel.getIns().mailSimpleData=e.mail;o.MailModel.getIns().event(o.MailConst.EVENT.CHANGE_MAILDATA);if(!e.mail.length){game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.MAIL)}};e.prototype.onMailBoxInfAck=function(t,e){if(e.result==1){o.MailModel.getIns().mailData=e.mail[0];for(var i=0;i<o.MailModel.getIns().mailSimpleData.length;i++){if(o.MailModel.getIns().mailSimpleData[i].mailId==e.mail[0].mailId){o.MailModel.getIns().mailSimpleData[i].mailState=e.mail[0].mailState;break}}o.MailModel.getIns().event(o.MailConst.EVENT.CHANGE_MAILDATA)}};e.prototype.onMailDeleteAck=function(t,e){if(e.result==1){for(var i=0;i<o.MailModel.getIns().mailSimpleData.length;i++){var n=o.MailModel.getIns().mailSimpleData[i].mailId;for(var a=0;a<e.mailid.length;a++){if(n==e.mailid[a]){o.MailModel.getIns().mailSimpleData.splice(i,1);break}}}o.MailModel.getIns().event(o.MailConst.EVENT.CHANGE_MAILDATA);app.ProtocolRequest.MailBoxReq()}};e.prototype.onMailAnnexAck=function(t,e){if(e.result==1){for(var i=0;i<e.MailChange.length;i++){if(o.MailModel.getIns().mailData&&o.MailModel.getIns().mailData.mailId==e.MailChange[i].mailID){o.MailModel.getIns().mailData.mailState=e.MailChange[i].mailState}for(var n=0;n<o.MailModel.getIns().mailSimpleData.length;n++){var a=o.MailModel.getIns().mailSimpleData[n];if(a.mailId==e.MailChange[i].mailID){a.mailState=e.MailChange[i].mailState;break}}}o.MailModel.getIns().event(o.MailConst.EVENT.CHANGE_MAILDATA)}};e.prototype.onNewMailAck=function(t,e){o.MailModel.getIns().mailCount=e.mailCount;if(e.mailCount>0){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.MAIL)}else{game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.MAIL)}};e.SINGLE_KEY="social.SocialModule";return e}(app.ModuleBase);o.SocialModule=t})(social||(social={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var social;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.on(Laya.Event.CLICK,this,this.onClick)};e.prototype.onDisplay=function(){this.callLater(this.updateLayout)};e.prototype.onUnDisplay=function(){};e.prototype.onClick=function(){if(!this._data){return}app.ViewManager.toggleDialog(i.MailContentView,1,0,this._data.mailId)};e.prototype.updateLayout=function(){};e.prototype.setData=function(t){if(!t){return}this._data=t;var e=csv.MailTempProxy.getIns().getCfg(t.mailType);if(e==undefined){return}this.jianglilab.text=t.mailTitle&&t.mailTitle.length>0?t.mailTitle:app.getLang(e.theme);this.shijianlab.text=util.TimeUtil.formatDate(t.sendTime,true,true);if((t.mailState&1)==0){this.xinfengimg.skin="youjian/bg_youjian_youjian1.png";this.xinimg.visible=true;this.lingquimg.skin=""}else{this.xinfengimg.skin="youjian/bg_youjian_youjian2.png";this.xinimg.visible=false;this.lingquimg.skin="youjian/bg_youjian_yiyuedu.png"}if((t.mailState>>1&1)==1){if((t.mailState>>2&1)==1){this.lingquimg.skin="youjian/bg_youjian_yilingqu.png";this.heziiimg.visible=false}else{this.lingquimg.skin="";this.heziiimg.visible=true}}else{this.heziiimg.visible=false}};e.SINGLE_KEY="social.MailMainCell";return e}(ui.youjian.youjianitemUI);i.MailMainCell=t})(social||(social={}));var social;(function(t){var e=function(){function t(){}t.EVENT={CHANGE_MAILDATA:"CHANGE_MAILDATA"};return t}();t.MailConst=e;var i;(function(t){t[t["HULUDAO"]=52]="HULUDAO"})(i=t.E_MAIL_TYPE||(t.E_MAIL_TYPE={}))})(social||(social={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var social;(function(t){var e=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.mailSimpleData=[];return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.init=function(){};t.prototype.isAllGet=function(){for(var t=0;t<this.mailSimpleData.length;t++){if((this.mailSimpleData[t].mailState>>1&1)==1){if((this.mailSimpleData[t].mailState>>2&1)==0){return true}}}return false};t.prototype.getMailItemList=function(t){var e=[];for(var i=0;i<t.length;++i){var n=game.ItemUtil.createVO(t[i].itemData[0].itemId);if(n.itemCfg.type==5){n.setCount(t[i].number)}else{n.setCount(t[i].itemData[0].count)}e.push(n)}return e};t.SINGLE_KEY="social.MailModel";return t}(app.ModelBase);t.MailModel=e})(social||(social={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("mailtemp.csv");this.cfgMap=t.getMap("tempID")};e.prototype.getCfg=function(t){return this.cfgMap[t]};e.SINGLE_KEY="csv.MailTempProxy";return e}(app.ModelBase);t.MailTempProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var social;(function(r){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this._model=r.MailModel.getIns();this.quedingbtn.clickHandler=new Laya.Handler(this,this.onClickGetBtn);this.gezilist.itemRender=grids.GridView;this.gezilist.renderHandler=grids.GridView.CommonItemRender;this.label03.mouseEnabled=true;this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this._model.on(r.MailConst.EVENT.CHANGE_MAILDATA,this,this.onUpdataView);this.label03.on(Laya.Event.LINK,this,this.onLinkHanlder);this.wenben.vScrollBarSkin="";this.callLater(this.updateLayout)};e.prototype.onLinkHanlder=function(t){if(t!=""){app.SDK.openLink(t)}};e.prototype.onUnDisplay=function(){this._model.off(r.MailConst.EVENT.CHANGE_MAILDATA,this,this.onUpdataView)};e.prototype.updateLayout=function(){app.ProtocolRequest.MailBoxInfReq(parseInt(this.dataSource))};e.prototype.onUpdataView=function(){var t=csv.MailTempProxy.getIns().getCfg(this._model.mailData.mailType);if(!t){this.label03.innerHTML=this._model.mailData.mailType+"";this.gezilist.array=[];return}if(this._model.mailData.mailType==0){this.label03.innerHTML=this._model.mailData.mailContent}else if(this._model.mailData.mailType==r.E_MAIL_TYPE.HULUDAO){var e=this._model.mailData.mailContent.split(";");if(e.length>=2){var i=guardisland.GuardIslandsModel.getStarStr(parseInt(e[1])-1);this.label03.innerHTML=app.getLang(t.text,e[0],i)}}else if(this._model.mailData.mailType==200){var e=app.str2Array(this._model.mailData.mailContent,";","-");this.label03.innerHTML=app.getLang(t.text,util.TimeUtil.formatTime(parseInt(e[0])),e[1])}else if(this._model.mailData.mailType==201){var e=app.str2Array(this._model.mailData.mailContent,";","-");this.label03.innerHTML=app.getLang(t.text,game.Context.getSerName(parseInt(e[0][3]))+e[0][0],util.TimeUtil.formatTime(parseInt(e[1])),e[2])}else if(this._model.mailData.mailType==202){var e=this._model.mailData.mailContent.split(";");var n=csv.DefclassProxy.getIns().getCfg(parseInt(e[0])).rolename;if(e.length>=2){this.label03.innerHTML=app.getLang(t.text,app.getLang(n),util.TimeUtil.formatTime(parseInt(e[1])),e[2])}}else if(this._model.mailData.mailType==205){var e=app.str2Array(this._model.mailData.mailContent,";","-");this.label03.innerHTML=app.getLang(t.text,game.Context.getSerName(parseInt(e[0][3]))+e[0][0],util.TimeUtil.formatTime(parseInt(e[1])))}else if(this._model.mailData.mailType==206){var e=app.str2Array(this._model.mailData.mailContent,";");this.label03.innerHTML=app.getLang(t.text,util.TimeUtil.formatTime(parseInt(e[0])))}else if(this._model.mailData.mailType==207){var e=app.str2Array(this._model.mailData.mailContent,";");this.label03.innerHTML=app.getLang(t.text,util.TimeUtil.formatTime(parseInt(e[0])))}else{if(this._model.mailData.mailContent==""){if(ent.DebugConfig.isDebugger){var a=app.getLang(t.text);if(a.indexOf("{")!=-1){game.Alert.show("邮件语言包["+a+"].mailData.mailType = "+this._model.mailData.mailType+",mailData.mailContent无参数数据")}}this.label03.innerHTML=app.getLang(t.text)}else{var e=this._model.mailData.mailContent.split(";");var o=[];for(var s=0;s<e.length;s++){o.push(app.getLang(e[s]))}this.label03.innerHTML=app.getLang.apply(null,[t.text].concat(o))}}this.label03.y=5;this.gezilist.array=game.ItemUtil.hebingItems(this._model.getMailItemList(this._model.mailData.itemData));this.fujianlab.visible=this.gezilist.array.length>0;this.updateBtnState()};e.prototype.updateBtnState=function(){if((r.MailModel.getIns().mailData.mailState>>1&1)==0){this.quedingbtn.label=app.getLang("mail_button2")}else{if((r.MailModel.getIns().mailData.mailState>>2&1)==0){this.quedingbtn.label=app.getLang("mail_button1")}else{this.quedingbtn.label=app.getLang("mail_button2")}}};e.prototype.onClickGetBtn=function(){if((r.MailModel.getIns().mailData.mailState>>1&1)==0){app.ProtocolRequest.MailDeleteReq([this._model.mailData.mailId]);this.close(null,false)}else{if((r.MailModel.getIns().mailData.mailState>>2&1)==0){var t=csv.MapProxy.getIns().getMapType(game.Context.mainRole.mapId);if(t==csv.MapProxy.MAP_TYPE.KUAFU_BOSS_OUT||t==csv.MapProxy.MAP_TYPE.KUAFU_BOSS_IN){manager.FlowManager.instance.flowByStyle1(app.getLang("跨服副本中，无法领取邮件"))}app.ProtocolRequest.MailAnnexReq(this._model.mailData.mailId)}else{app.ProtocolRequest.MailDeleteReq([this._model.mailData.mailId]);this.close(null,false)}}};e.SINGLE_KEY="social.MailContentView";return e}(ui.youjian.youjiantipUI);r.MailContentView=t})(social||(social={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var social;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this._model=i.MailModel.getIns();this.youjianlist.itemRender=i.MailMainCell;this.youjianlist.renderHandler=new Laya.Handler(this,this.onRenderHandler);this.yijianshiyongbtn.clickHandler=new Laya.Handler(this,this.onYijianshiyongbtnClick);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this._model.on(i.MailConst.EVENT.CHANGE_MAILDATA,this,this.onUpdataView);app.ProtocolRequest.MailBoxReq();this.callLater(this.updateLayout)};e.prototype.onUnDisplay=function(){this._model.off(i.MailConst.EVENT.CHANGE_MAILDATA,this,this.onUpdataView)};e.prototype.onYijianshiyongbtnClick=function(){if(this._model.isAllGet()){if(csv.MapProxy.isInKuaFuMap()){manager.FlowManager.instance.flowByStyle1(app.getLang("跨服副本中，无法领取邮件"));return}app.ProtocolRequest.MailAnnexReq(0)}else{manager.FlowManager.instance.flowByStyle1(app.getLang("mail_errorinfo1"))}};e.prototype.onUpdataView=function(){var t=this._model.mailSimpleData;t=t.sort(this.mailSort);this.youjianlist.array=t;this.imgweishoudao.visible=Boolean(t.length==0)};e.prototype.mailSort=function(t,e){if((t.mailState&1)==0&&(e.mailState&1)==1)return-1;if((t.mailState&1)==1&&(e.mailState&1)==0)return 1;if(t.sendTime>e.sendTime)return-1;if(t.sendTime<e.sendTime)return 1};e.prototype.onRenderHandler=function(t,e){t.setData(t.dataSource)};e.prototype.updateLayout=function(){};e.SINGLE_KEY="social.MailMainView";return e}(ui.youjian.youjianviewUI);i.MailMainView=t})(social||(social={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var soul;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){app.ViewManager.regist(i.SoulBagView,"yuanshenzhenshen.atlas");app.ViewManager.regist(i.SoulBagDecomposeView,"yuanshenzhenshen.atlas");app.ViewManager.regist(i.SoulIntensifyView,"yuanshenzhenshen.atlas");app.ViewManager.regist(i.SoulMainCompoundView,"yuanshenzhenshen.atlas");app.ViewManager.regist(i.SoulHechengCommonView,"yuanshenzhenshen.atlas");app.ViewManager.regist(i.SoulHechengSelectBagView,"yuanshenzhenshen.atlas");app.ViewManager.regist(i.MateriaSelectView,"yuanshenzhenshen.atlas")};e.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.SoulInfoAck,this,this.onSoulInfoAck);this.addMsgListener(app.ProtocolResponse.SoulUpdateeAck,this,this.onSoulUpdateeAck);this.addMsgListener(app.ProtocolResponse.SoulDecomposeAck,this,this.onSoulDecomposeAck)};e.prototype.onSoulInfoAck=function(t,e){i.SoulBodyModel.getIns().updataSoulData(e.items)};e.prototype.onSoulDecomposeAck=function(t,e){if(e.result){i.SoulBodyModel.getIns().event(i.SoulBodyModel.SOUL_DECOMPOSE)}};e.prototype.onSoulUpdateeAck=function(t,e){if(e.result){i.SoulBodyModel.getIns().updataSoulUpdate(e.roleid,e.part,e.lv)}};e.SINGLE_KEY="soul.SoulBodyModule";return e}(app.ModuleBase);i.SoulBodyModule=t})(soul||(soul={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var soul;(function(s){var t=function(t){__extends(a,t);function a(){return t!==null&&t.apply(this,arguments)||this}a.getIns=function(){return app.Singleton.getInstance(a)};a.prototype.updataSoulData=function(t){this.items=t};a.prototype.updataSoulUpdate=function(t,e,i){var n=this.getSoulItemData(t,e);if(n){n.lv=i}s.SoulBodyModel.getIns().event(a.SOUL_ITEM_LEVEL_UP,t)};a.prototype.init=function(){};a.prototype.checkRedDot=function(){var t=[];for(var e=0;e<game.Context.TOTAL_ROLE_NUM;e++){t.push(false)}for(var e=0;e<game.Context.roleList.length;e++){t[e]=this.getRedDot(e)}return t};a.prototype.getRedDot=function(t){var e=false;var i=game.Context.roleList[t].uplv;var n=null;if(!n){var a=game.GridsModel.SoulEnums[t];for(var o=1;o<=equip.EquipStatic.SOUL_NUM;o++){var s=game.GridsModel.getIns().getSoulEquipByTypeAndPos(a,o);if(s){var r=game.Context.roleList[t].insId;var l=game.Context.roleList[t].level;e=this.canQianghua(r,s);if(!e&&this.canReplace(s,o,l)){e=true}}else{var l=game.Context.roleList[t].level;var h=this.getSoulItemsByPos(o,l);if(h.length>0){e=true}}if(e){break}}}return e};a.prototype.canQianghua=function(t,e){var i=false;var n=s.SoulBodyModel.getIns().getSoulLevelByPos(t,e.pos);if(n<csv.SoulBodyProxy.getIns().maxLevel()){var a=csv.SoulBodyProxy.getIns().getIntensifyAttr(n+1);var o=game.ItemUtil.parserList(a.cost)[0];i=game.GridsModel.getIns().hasEnoughItems(o,false,false)}return i};a.prototype.canReplace=function(t,e,i){var n=this.getSoulItemsByPos(e,i);for(var a in n){if(n[a].getQuality()>t.getQuality()){return true}else if(n[a].getQuality()==t.getQuality()){var o=parseInt(csv.SoulBodyProxy.getIns().getSoulCfg(n[a].itemCfg.id).starlevel);var s=parseInt(csv.SoulBodyProxy.getIns().getSoulCfg(t.itemCfg.id).starlevel);if(o>s){return true}}}return false};a.prototype.getSoulItemsByPos=function(t,e){var i=game.GridsModel.getIns().getGridByType(game.GridsModel.BAG_SOUL).itemList;var n=[];for(var a=0;a<i.length;a++){var o=s.SoulBodyModel.getIns().canEquip(i[a].getItemId(),t,e);if(o){n.push(i[a])}}return n};a.prototype.canEquip=function(t,e,i){var n=csv.SoulBodyProxy.getIns().getSoulCfg(t);if(n){if(n.position==e){if(i>0){return i>=n.level}return true}}return false};a.prototype.getSoulItemData=function(t,e){var i;var n;for(var a in this.items){if(Uint64.equal(this.items[a].id,t)){i=this.items[a];break}}if(i){for(var a in i.items){if(i.items[a].part==e){n=i.items[a]}}if(!n){n=new SoulItemData;n.lv=0;n.part=e;i.items.push(n)}}return n};a.prototype.getSoulLevelByPos=function(t,e){var i;for(var n in this.items){if(Uint64.equal(this.items[n].id,t)){i=this.items[n];break}}if(i){for(var n in i.items){if(i.items[n].part==e){return i.items[n].lv}}}return 0};a.prototype.soulSort=function(t,e){if(t.getQuality()>e.getQuality()){return-1}if(t.getQuality()<e.getQuality()){return 1}var i=parseInt(csv.SoulBodyProxy.getIns().getSoulCfg(t.itemCfg.id).score);var n=parseInt(csv.SoulBodyProxy.getIns().getSoulCfg(e.itemCfg.id).score);if(i>n){return-1}if(i<n){return 1}return 0};a.prototype.onSoulUpdateReq=function(t,e){if(t&&t.pos>0){var i=this.getSoulLevelByPos(e,t.pos);if(i<csv.SoulBodyProxy.getIns().maxLevel()){var n=csv.SoulBodyProxy.getIns().getIntensifyAttr(i+1);if(game.GridsModel.getIns().hasEnoughItems(n.cost,false,true)){app.ProtocolRequest.SoulUpdateReq(e,t.pos)}}else{manager.FlowManager.instance.flowByStyle1(app.getLang("lotus_8"))}}};a.prototype.canSynthesis=function(){var t=csv.HechengProxy.getIns().getArr(csv.HechengProxy.ENUM.SOUL);var e=false;for(var i=0;i<t.length;i++){e=synthesis.HechengModel.getIns().getTypeRed(t[i].totaltype);if(e){break}}return e};a.prototype.canDecompose=function(t){var e=t.subtype;var i=t.qua;var n=csv.SoulBodyProxy.getIns().getSoulCfg(t.id).starlevel;var a=false;var o=100;var s={};for(var r=0;r<game.GridsModel.SoulEnums.length;r++){var l=game.GridsModel.SoulEnums[r];a=false;for(var h=1;h<=equip.EquipStatic.SOUL_NUM;h++){var p=game.GridsModel.getIns().getSoulEquipByTypeAndPos(l,h);if(p&&p.itemCfg.subtype==e){var u=p.getQuality();if(u<o){o=u}var c=s[u];if(!c){c=100}var g=csv.SoulBodyProxy.getIns().getSoulCfg(p.itemCfg.id).starlevel;if(g<c){s[u]=g}a=true;break}}if(!a){break}}if(a){if(i>o){a=false}else if(i==o&&n>s[i]){a=false}}else{}return a};a.SINGLE_KEY="soul.SoulBodyModel";a.SOUL_ITEM_LEVEL_UP="soul.SoulItemLevelUp";a.SOUL_DECOMPOSE="soul.Decompose";return a}(app.ModelBase);s.SoulBodyModel=t})(soul||(soul={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t._modelMap={};return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.init=function(){var t=app.Config.getResById("soulspirit.csv");this.cfgMap=t.getMapList("job");var e=app.Config.getResById("soulattr.csv");this.attrMap=e.getMap("id");var i=app.Config.getResById("soulattrenhance.csv");this.intensifyMap=i.getMap("id")};t.prototype.maxLevel=function(){return Object.keys(this.intensifyMap).length};t.prototype.getCfg=function(t,e){var i=this.cfgMap[t];for(var n=0;n<i.length;n++){if(e<i[n].stars){if(n==0){return{curCfg:null,nextCfg:i[n]}}else{return{curCfg:i[n-1],nextCfg:i[n]}}}}return{curCfg:i[i.length-1],nextCfg:null}};t.prototype.getSoulCfg=function(t){return this.attrMap[t]};t.prototype.getIntensifyAttr=function(t){return this.intensifyMap[t]};t.prototype.getModel=function(t,e){var i=t+"_"+e;if(this._modelMap[i]){return this._modelMap[i]}var n="";var a=this.cfgMap[t];for(var o=0;o<a.length;o++){var s=a[o];if(e<s.stars){break}n=s.model}this._modelMap[i]=n;return n};t.SINGLE_KEY="csv.SoulBodyProxy";return t}(app.ModelBase);t.SoulBodyProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var soul;(function(h){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t._selectedValue=0;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listbeibao.itemRender=h.SoulBagItem;this.listbeibao.renderHandler=new Laya.Handler(this,this.onItemRender);this.listbeibao.hScrollBarSkin="";this.listbeibao.vScrollBarSkin=" ";this.listxiala.itemRender=h.ListItem;this.listxiala.repeatX=1;this.listxiala.repeatY=3;this.listxiala.renderHandler=new Laya.Handler(this,this.onSeletListRender);this.listxiala.selectEnable=true;this.listxiala.selectHandler=new Laya.Handler(this,this.onSeletListSelected);this.listxiala.hScrollBarSkin=" ";this.listxiala.array=[app.getLang("soultips_22"),app.getLang("soultips_21"),app.getLang("soultips_20")];this.btnguanbi.clickHandler=new Laya.Handler(this,this.onSoulDecompose);this.boxxuanze.clickHandler=new Laya.Handler(this,this.onCheckBoxChange);this.btnxiala.on(Laya.Event.CLICK,this,this.onShowList);this.on(Laya.Event.CLICK,this,this.hideList);this.btnguanbi.label=app.getLang("button_name12");this.moneyIcon.parserIcon("8011-1")};t.prototype.hideList=function(){this.listxiala.visible=false};t.prototype.onSeletListRender=function(t){t.setData(t.dataSource)};t.prototype.onShowList=function(t){t.stopPropagation();this.listxiala.visible=true};t.prototype.autoChooes=function(){this.listbeibao.refresh();var t=2-this.listxiala.selectedIndex;for(var e=0,i=this._list;e<i.length;e++){var n=i[e];if(n instanceof items.EquipSoulVO){var a=parseInt(csv.SoulBodyProxy.getIns().getSoulCfg(n.itemCfg.id).starlevel);if(a<=t){var o=csv.SoulBodyProxy.getIns().getSoulCfg(n.getItemId()).stars;this.onItemAction(this.boxxuanze.selected,n.serverData.instId,parseInt(o))}}}};t.prototype.onSeletListSelected=function(){this.labeltishi01.text=this.listxiala.selectedItem;this.clean();this.showItem()};t.prototype.onCheckBoxChange=function(){this.clean();this.autoChooes()};t.prototype.onItemRender=function(t,e){t.setData(t.dataSource);if(this.boxxuanze.selected){t.autoSelect(2-this.listxiala.selectedIndex)}else{t.clean()}};t.prototype.onSoulDecompose=function(){if(this.selectedList.length>0){app.ProtocolRequest.SoulDecomposeReq(this.selectedList)}};t.prototype.onDisplay=function(){h.SoulBodyModel.getIns().on(h.SoulBodyModel.SOUL_DECOMPOSE,this,this.refreshAll);this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){h.SoulBodyModel.getIns().off(h.SoulBodyModel.SOUL_DECOMPOSE,this,this.refreshAll);this.listxiala.visible=false};t.prototype.refreshAll=function(){this.clean();this.hideList();if(this.listxiala.selectedIndex==-1){this.listxiala.selectedIndex=2}this.showItem()};t.prototype.showItem=function(){var t=game.GridsModel.getIns().getGridByType(game.GridsModel.BAG_SOUL);this._list=[];t.itemList.sort(h.SoulBodyModel.getIns().soulSort);var e=2-this.listxiala.selectedIndex;for(var i=0,n=t.itemList;i<n.length;i++){var a=n[i];if(a instanceof items.EquipSoulVO){var o=parseInt(csv.SoulBodyProxy.getIns().getSoulCfg(a.itemCfg.id).starlevel);if(o<=e){if(h.SoulBodyModel.getIns().canDecompose(a.itemCfg)){this._list.push(a)}}}}var s=this._list.length;if(s>0){if(s<=40){for(var r=s;r<40;r++){this._list.push(game.GridsModel.EMPTY)}}else{var l=s%5;for(var r=l;r<5;r++){this._list.push(game.GridsModel.EMPTY)}}this.listbeibao.array=this._list;if(this.boxxuanze.selected){this.autoChooes()}this.listbeibao.visible=true;this.imgtishi.visible=false}else{this.listbeibao.visible=false;this.imgtishi.visible=true}};t.prototype.onItemAction=function(t,n,e){var a=false;if(t){if(this.selectedList.indexOf(n)<0){this.selectedList.push(n);a=true}}else{this.selectedList.forEach(function(t,e,i){if(Uint64.equal(t,n)){i.splice(e,1);a=true}})}if(a){this.setValue(t,e)}};t.prototype.setValue=function(t,e){var i=game.GridsModel.getIns().getItemCount(app.str2Array(csv.SoulBodyProxy.getIns().getIntensifyAttr(1).cost,"-")[0]);if(t){this._selectedValue+=e}else{this._selectedValue-=e}this.labelwenzi.text=i+"（+"+this._selectedValue+"）"};t.prototype.clean=function(){this.selectedList=[];this._selectedValue=0;var t=game.GridsModel.getIns().getItemCount(app.str2Array(csv.SoulBodyProxy.getIns().getIntensifyAttr(1).cost,"-")[0]);this.labelwenzi.text=t+"（+"+this._selectedValue+"）"};t.SINGLE_KEY="soul.SoulBagDecomposeView";return t}(ui.yuanshenzhenshen.hunpofenjiebaoviewUI);h.SoulBagDecomposeView=t})(soul||(soul={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var soul;(function(o){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listbeibaokuang01.itemRender=o.SoulBagItemForShow;this.listbeibaokuang01.renderHandler=new Laya.Handler(this,this.onSoulBagItemForShowRender);this.listbeibaokuang01.hScrollBarSkin="";this.listbeibaokuang01.vScrollBarSkin=" ";this.btnpiliangfenjie.clickHandler=new Laya.Handler(this,this.onShowBagDecomposeView);this.moneyIcon.parserIcon("8011-1")};e.prototype.onSoulBagItemForShowRender=function(t){t.setData(t.dataSource)};e.prototype.onShowBagDecomposeView=function(){app.ViewManager.toggleDialog(o.SoulBagDecomposeView,1,-1)};e.prototype.onDisplay=function(){o.SoulBodyModel.getIns().on(o.SoulBodyModel.SOUL_DECOMPOSE,this,this.refreshAll);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){o.SoulBodyModel.getIns().off(o.SoulBodyModel.SOUL_DECOMPOSE,this,this.refreshAll)};e.prototype.refreshAll=function(){var t=game.GridsModel.getIns().getGridByType(game.GridsModel.BAG_SOUL);var e=t.itemList.length;var i=[];t.itemList.sort(o.SoulBodyModel.getIns().soulSort);i=i.concat(t.itemList);if(e<=40){for(var n=e;n<40;n++){i.push(game.GridsModel.EMPTY)}}else{var a=e%5;for(var n=a;n<5;n++){i.push(game.GridsModel.EMPTY)}}this.listbeibaokuang01.array=i;this.labelwenzi.text=""+game.GridsModel.getIns().getItemCount(app.str2Array(csv.SoulBodyProxy.getIns().getIntensifyAttr(1).cost,"-")[0])};e.SINGLE_KEY="soul.SoulBagView";return e}(ui.yuanshenzhenshen.hunpobeibaotipUI);o.SoulBagView=t})(soul||(soul={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var soul;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.onRenderHandler=function(t,e){t.setData(t.dataSource);t.clickHandler=new Laya.Handler(this,this.onSelectHandler)};e.prototype.refreshAll=function(){var t=this.dataSource[0];this.selectHandler=this.dataSource[1];this.tuijianBox.visible=false;if(t.length>0){var e=t.length;if(e<=40){for(var i=e;i<40;i++){t.push(game.GridsModel.EMPTY)}}else{var n=e%5;for(var i=n;i<5;i++){t.push(game.GridsModel.EMPTY)}}this.listbeibao.visible=true;this._dataArr=[];this._selectedIndex=-1;this.listbeibao.selectedIndex=this._selectedIndex;for(var i=0,a=t.length;i<a;i++){var o=t[i];var s={data:o,select:Boolean(this._selectedIndex==i)};this._dataArr.push(s)}this.listbeibao.array=this._dataArr}else{this.listbeibao.visible=false}};e.SINGLE_KEY="soul.SoulHechengSelectBagView";return e}(t.SoulSelectBagView);t.SoulHechengSelectBagView=e})(soul||(soul={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var soul;(function(n){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.jiahao.visible=false;this.buwei.visible=false;this.gezi.shuzi.visible=false;this.starMediator=new common.StarClipMediator([this.gezi.xing1,this.gezi.xing2,this.gezi.xing3,this.gezi.xing4,this.gezi.xing5]);this.starMediator.value=0};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.initSoulVO=function(t,e,i){this.gezi.setData(t);this.xuanzhong.visible=e;this.updateView(t,i)};e.prototype.updateView=function(t,e){if(t instanceof items.EquipSoulVO){var i=parseInt(csv.SoulBodyProxy.getIns().getSoulCfg(t.itemCfg.id).starlevel);this.starMediator.value=i;game.RedDotView.removeFrom(this);if(n.SoulBodyModel.getIns().canQianghua(e,t)){game.RedDotView.addTo(this)}}else{game.RedDotView.removeFrom(this)}};e.prototype.setSelect=function(t){this.xuanzhong.visible=t};e.prototype.setClickHandler=function(t){this.gezi.clickHandler=t};e.SINGLE_KEY="soul.SoulIntensifyItem";return e}(equip.RoleEquipItem);n.SoulIntensifyItem=t})(soul||(soul={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var soul;(function(_){var t=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.starMediator=new common.StarClipMediator([this.itemdaoju01.xing1,this.itemdaoju01.xing2,this.itemdaoju01.xing3,this.itemdaoju01.xing4,this.itemdaoju01.xing5]);this.starMediator.value=0;this.itemdaoju01.shuzi.visible=false;this.itemdaoju02.shuzi.visible=false;this.roleMediator=new common.RoleListMediator(this.itemxuanze.xuanzelist,equip.RoleItem,new Laya.Handler(this,this.roleSelectChange));this.roleMediator.setData(0);this.listattr.itemRender=game.ComAttrItem3;this.listattr.renderHandler=new Laya.Handler(this,this.onAttrRender);this.btnqianghua.clickHandler=new Laya.Handler(this,this.onSoulUpdateReq);this.items=[this.item0,this.item1,this.item2,this.item3,this.item4,this.item5];for(var t=0;t<this.items.length;t++){this.items[t].setClickHandler(new Laya.Handler(this,this.onSelectItemHandler,[this.items[t]]))}};t.prototype.onSoulUpdateReq=function(){_.SoulBodyModel.getIns().onSoulUpdateReq(this.itemdaoju01.data,this.roleMediator.selectedRoleUid)};t.prototype.onSelectItem=function(){if(!this.selectedItem)return;var t=this.selectedItem.gezi.data;var e=this.roleMediator.selectedRoleUid;this.selectedItem.updateView(t,e);if(t&&t.pos>0){this.itemdaoju01.setData(t);this.labelhunshihunpo.text=t.getName();var i=parseInt(csv.SoulBodyProxy.getIns().getSoulCfg(t.getItemId()).starlevel);this.starMediator.value=i;var n=_.SoulBodyModel.getIns().getSoulLevelByPos(e,t.pos);var a=void 0,o=void 0;var s=csv.SoulBodyProxy.getIns().maxLevel();if(n<s){a=csv.SoulBodyProxy.getIns().getIntensifyAttr(n);o=csv.SoulBodyProxy.getIns().getIntensifyAttr(n+1);this.labelshuxing01.text="+"+n;this.labelshuxing02.text="+"+(n+1);this.imgjiantouheng.visible=true;this.btnqianghua.visible=true;this.imgyimanji01.visible=false;this.boxqianghuaxiaohao.visible=true;this.labelshuxing01.visible=true;this.labelshuxing02.visible=true;this.labeldangqianshuxing.visible=false}else{a=csv.SoulBodyProxy.getIns().getIntensifyAttr(n);o=csv.SoulBodyProxy.getIns().getIntensifyAttr(n);this.labelshuxing01.text="+"+n;this.labelshuxing02.text="+"+n;this.labeldangqianshuxing.text="+"+n;this.imgjiantouheng.visible=false;this.btnqianghua.visible=false;this.imgyimanji01.visible=true;this.boxqianghuaxiaohao.visible=false;this.labelshuxing01.visible=false;this.labelshuxing02.visible=false;this.labeldangqianshuxing.visible=true}var r=Attributes.decode(a?a.attr:"").baseList;var l=Attributes.decode(o?o.attr:"").baseList;var h=l.length;var p=[];for(var u=0;u<h;u++){var c={};var g=new PropValue;var f=r[u]?r[u].value:0;var d=l[u]?l[u].value:r[u].value;g.propId=r[u]?r[u].propId:l[u].propId;g.value=d-f;g.formula=r[u]?r[u].formula:l[u].formula;c.curAttr=r[u];c.nextAttr=g;p.push(c)}this.listattr.array=p;var y=game.ItemUtil.parserList(o.cost)[0];this.itemdaoju02.setData(y);var v=game.STYLES.GREEN_COLOR_S;if(!game.GridsModel.getIns().hasEnoughItems(y,false,false)){v=game.STYLES.RED_COLOR_S}this.labelnum.color=v;this.labelnum.text=game.GridsModel.getIns().getItemCount(y.getItemId())+"/"+y.count}};t.prototype.onAttrRender=function(t){t.setData(t.dataSource,true)};t.prototype.onDisplay=function(){_.SoulBodyModel.getIns().on(_.SoulBodyModel.SOUL_ITEM_LEVEL_UP,this,this.onSoulItemLevelUp);this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){_.SoulBodyModel.getIns().off(_.SoulBodyModel.SOUL_ITEM_LEVEL_UP,this,this.onSoulItemLevelUp)};t.prototype.onSoulItemLevelUp=function(t){this.setRoleData(false);this.setEquips()};t.prototype.refreshAll=function(){if(this.dataSource&&this.dataSource.length==1){var t=[];for(var e=0;e<game.Context.roleList.length;e++){var i=game.GridsModel.SoulEnums[e];t[e]=false;for(var n=1;n<=equip.EquipStatic.SOUL_NUM;n++){var a=game.GridsModel.getIns().getSoulEquipByTypeAndPos(i,n);if(a){var o=game.Context.roleList[e].insId;if(_.SoulBodyModel.getIns().canQianghua(o,a)){t[e]=true;break}}}}this.roleMediator.setData(this.dataSource[0],t)}else{this.setRoleData(true)}this.onUpdateView()};t.prototype.setRoleData=function(t){var e=this.roleMediator.selectedIndex;var i=[];for(var n=0;n<game.Context.roleList.length;n++){var a=game.GridsModel.SoulEnums[n];for(var o=1;o<=equip.EquipStatic.SOUL_NUM;o++){var s=game.GridsModel.getIns().getSoulEquipByTypeAndPos(a,o);if(s){var r=game.Context.roleList[n].insId;if(_.SoulBodyModel.getIns().canQianghua(r,s)){i[n]=true;break}}}}if(!i[e]&&t){for(var o=0;o<i.length;o++){if(i[o]){e=o;break}}}this.roleMediator.setData(e,i)};t.prototype.onUpdateView=function(){this.selectedItem=null;this.setEquips()};t.prototype.setEquips=function(){var t=game.GridsModel.SoulEnums[this.roleMediator.selectedIndex];var e=[];var i=false;for(var n=1;n<=equip.EquipStatic.SOUL_NUM;n++){var a=game.GridsModel.getIns().getSoulEquipByTypeAndPos(t,n);if(a){e.push(a);i=true;if(this.selectedItem==null){this.selectedItem=this.items[n-1]}}else{e.push(null)}}this.boxqianghua.visible=i;this.imgtishi.visible=!i;for(var n=0;n<e.length;n++){this.items[n].initSoulVO(e[n],this.items[n]==this.selectedItem,this.roleMediator.selectedRoleUid)}this.onSelectItem()};t.prototype.onSelectItemHandler=function(t){if(this.selectedItem==t)return;if(t.gezi.data){this.selectedItem.setSelect(false);t.setSelect(true);this.selectedItem=t;this.onSelectItem()}else{this.selectedItem=t}};t.prototype.roleSelectChange=function(){this.onUpdateView()};t.SINGLE_KEY="soul.SoulIntensifyView";return t}(ui.yuanshenzhenshen.hunpoqianghuatipnewUI);_.SoulIntensifyView=t})(soul||(soul={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var soul;(function(a){var t=function(i){__extends(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){i.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._dataArr=[];this.costItemArr=[];for(var t=1;t<=synthesis.HechengModel.SOUL_COST_NUM;t++){var e=this["gezi"+t];e.position=t;this.costItemArr.push(e)}this.listdaoju.itemRender=a.SoulMateriaBagItem;this.listdaoju.renderHandler=new Laya.Handler(this,this.onRenderHandler);this.listdaoju.vScrollBarSkin=" ";this.btnquxiao.clickHandler=new Laya.Handler(this,this.closeDialog);this.btnqueren.clickHandler=new Laya.Handler(this,this.onBtnSelect)};t.prototype.onRenderHandler=function(t){t.setData(t.dataSource);if(t.dataSource instanceof items.EquipSoulVO){for(var e=0;e<this.choosedList.length;e++){if(Uint64.equal(this.choosedList[e].getInstId(),t.dataSource.getInstId())){break}}}};t.prototype.onBtnSelect=function(){this.closeDialog()};t.prototype.closeDialog=function(){app.ViewManager.toggleDialog(t,-1,0)};t.prototype.onDisplay=function(){this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){for(var t=0;t<this.costItemArr.length;t++){var e=this.costItemArr[t];if(e.costItem instanceof items.ItemVO){e.selectItem=null}}};t.prototype.refreshAll=function(){for(var t=0;t<this.costItemArr.length;t++){var e=this.costItemArr[t];e.setData(game.GridsModel.EMPTY)}this.labelshuzi.text=this.getRate()+"%";var i=this.dataSource[0];var n=this.dataSource[1];var a=[];this._dataArr=[];this._selectedIndex=-1;this.listdaoju.selectedIndex=this._selectedIndex;this.choosedList=[];var o=game.ItemUtil.parserList(i.synthesis_materials1)[0];var s=game.ItemUtil.parserList(i.itemaddrate);this._vos=s;for(var t in s){var r=game.GridsModel.getIns().getSoulItemsByItemid(s[t].getItemId(),[]);if(s[t].getItemId()==o.getItemId()){if(r.length>=o.count){for(var l=0;l<o.count;l++){r.pop()}}else{r=[]}}if(r.length>0){a=a.concat(r)}}this._arr=a;this._arr.sort(this.itemSort);if(n){this.autoChoose(a)}else{this._autoList=this._dataSource[2]}if(a&&a.length>0){var h=a.length;if(h<=10){for(var t=h;t<10;t++){a.push(game.GridsModel.EMPTY)}}else{var p=h%5;for(var t=p;t<5;t++){a.push(game.GridsModel.EMPTY)}}this.listdaoju.visible=true;this.imgtishi.visible=false;this.imgtishi.visible=false;for(var t=0;t<this._autoList.length;t++){for(var u=0;u<a.length;u++){if(Uint64.equal(this._autoList[t].getInstId(),a[u].getInstId())){this.onItemAction(true,a[u]);break}}}this.listdaoju.array=a}else{this.listdaoju.visible=false;this.imgtishi.visible=true}};t.prototype.autoChoose=function(t){var e=this.dataSource[0];var i=parseInt(e.baserate)*.01;this._autoList=[];var n=0;for(var a=0;a<t.length;a++){i+=this.getRateByItemid(t[a].getItemId());if(i<100){this._autoList.push(t[a])}else{n=a;break}}this._autoList.push(t[n]);this.checkRate(i)};t.prototype.checkRate=function(t){var e=0;if(t>100){e=this.getRateByItemid(this._autoList[0].getItemId());if(t-e>100){this._autoList.shift();t-=e;this.checkRate(t)}}};t.prototype.canAdd=function(t){var e=this.choosedList.length<synthesis.HechengModel.SOUL_COST_NUM;var i=this.getRate()<100;if(i==false){manager.FlowManager.instance.flowByStyle1(app.getLang("soulerror_1"))}return e&&i};t.prototype.onItemAction=function(t,n){if(t){var e=false;for(var i in this.choosedList){if(Uint64.equal(this.choosedList[i].serverData.instId,n.serverData.instId)){e=true;break}}if(!e){this.choosedList.push(n);this.updateCostItem()}}else{this.choosedList.forEach(function(t,e,i){if(Uint64.equal(t.serverData.instId,n.serverData.instId)){i.splice(e,1)}});this.updateCostItem()}};t.prototype.updateCostItem=function(){for(var t=0;t<this.costItemArr.length;t++){var e=this.costItemArr[t];e.setSelect(this.choosedList[t]||game.GridsModel.EMPTY)}this.labelshuzi.text=this.getRate()+"%"};t.prototype.getRate=function(t){if(t===void 0){t=null}var e=this.dataSource[0];var i=game.ItemUtil.parserList(e.itemaddrate);var n=parseInt(e.baserate)*.01;if(t==null){t=this.choosedList}for(var a in t){for(var o=0;o<i.length;o++){if(t[a].getItemId()==i[o].getItemId()){n+=i[o].count*.01;break}}}return n>100?100:n};t.prototype.getRateByItemid=function(t){var e=0;var i=this.dataSource[0];var n=game.ItemUtil.parserList(i.itemaddrate);for(var a=0;a<n.length;a++){if(t==n[a].getItemId()){e=n[a].count*.01;break}}return e};t.prototype.itemSort=function(t,e){var i=a.MateriaSelectView.getIns().getRateByItemid(t.getItemId());var n=a.MateriaSelectView.getIns().getRateByItemid(e.getItemId());if(i>n){return 1}if(i<n){return-1}return 0};t.SINGLE_KEY="soul.MateriaSelectView";return t}(ui.yuanshenzhenshen.xuanzecailiaotipUI);a.MateriaSelectView=t})(soul||(soul={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var soul;(function(t){var e=function(i){__extends(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){i.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.costItemArr=[];for(var t=1;t<=synthesis.HechengModel.SOUL_COMMON_COST_NUM;t++){var e=this["gezi"+t];this.costItemArr.push(e)}this.hecheng.clickHandler=new Laya.Handler(this,this.onHecheng);game.HelperViewHandler.registerStr([this.btntishi,this.labelguizeishuoming],"func86t","soultips_3");this.numChoose=new game.NumChoose(this.jianbtn,this.jiabtn,this.shuzhi,this.zuidabtn);this.numChoose.on(game.NumChoose.VALUE_CHANGE,this,this.onValueChange);this.numChoose.init(1,1,1,1)};t.prototype.onValueChange=function(){};t.prototype.onHecheng=function(){if(this.checkSelectItem()){app.ProtocolRequest.SynthesisReq(this.dataSource.id,this.numChoose.currValue,[])}};t.prototype.onDisplay=function(){synthesis.HechengModel.getIns().on(synthesis.HechengModel.SYNTHESIS_ACK,this,this.refreshAll);this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){synthesis.HechengModel.getIns().off(synthesis.HechengModel.SYNTHESIS_ACK,this,this.refreshAll);for(var t=0;t<this.costItemArr.length;t++){var e=this.costItemArr[t];e.clean()}};t.prototype.refreshAll=function(){var t=this.dataSource;var e=game.ItemUtil.createVO(t.synthesis_item);this.temdaoju.setData(e);if(t.type==csv.HechengProxy.ENUM.SOUL){this.hecheng.visible=true;var i=game.ItemUtil.parserList(t.synthesis_materials1);for(var n=0;n<synthesis.HechengModel.SOUL_COMMON_COST_NUM;n++){this.costItemArr[n].clean();this.costItemArr[n].setData(i[n]||game.GridsModel.LOCKED)}game.RedDotView.removeFrom(this.hecheng);var a=1;var o=game.GridsModel.getIns().getEnoughNum(i);if(o==0){a=0;this.hecheng.gray=true;this.hecheng.mouseEnabled=false}else{this.hecheng.gray=false;this.hecheng.mouseEnabled=true;game.RedDotView.addTo(this.hecheng)}this.numChoose.init(a,1,1,o)}};t.prototype.checkSelectItem=function(){var t=this.numChoose.currValue;var e=game.ItemUtil.parserList(this.dataSource.synthesis_materials1);for(var i=0;i<e.length;i++){var n=e[i].getItemId()+"-"+e[i].count*t;var a=game.GridsModel.getIns().hasEnoughItems(n,false,true);if(!a){return false}}return true};t.SINGLE_KEY="soul.SoulHechengCommonView";return t}(ui.yuanshenzhenshen.hechnegtip03UI);t.SoulHechengCommonView=e})(soul||(soul={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var soul;(function(n){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.starMediator=new common.StarClipMediator([this.gezi.xing1,this.gezi.xing2,this.gezi.xing3,this.gezi.xing4,this.gezi.xing5]);this.starMediator.value=0;this.gezi.clickHandler=this.clickHandler};e.prototype.onSelectHandler=function(t,e,i){if(t>0){this.setSelect(e);app.ViewManager.toggleDialog(n.SoulHechengSelectBagView,-1,0)}};e.prototype.setSelect=function(t){if(t instanceof items.EquipSoulVO){this.selectItem=t;this.shuliang.visible=false;this.wenzi.visible=false;this.gezi.setData(t);var e=parseInt(csv.SoulBodyProxy.getIns().getSoulCfg(t.getItemId()).starlevel);this.starMediator.value=e}else{this.shuliang.visible=false;this.gezi.setData(t);this.starMediator.value=0}this.gezi.shuzi.visible=false};e.prototype.setData=function(t){this.costItem=t;if(t instanceof items.EquipSoulVO){this.gezi.setData(t)}else{this.gezi.setData(game.GridsModel.EMPTY);this.starMediator.value=0}this.boPush=false;this.shuliang.visible=false;this.gezi.shuzi.visible=false;this.wenzi.visible=false;this.selectItem=null};e.prototype.onClickHandler=function(){if(this.selectItem instanceof items.EquipSoulVO){tip.TipManager.show(this.selectItem)}};e.SINGLE_KEY="soul.SoulHechengCostItem";return e}(synthesis.HechengCostItem);n.SoulHechengCostItem=t})(soul||(soul={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var soul;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.starMediator=new common.StarClipMediator([this.gezi.xing1,this.gezi.xing2,this.gezi.xing3,this.gezi.xing4,this.gezi.xing5]);this.starMediator.value=0;this.gezi.clickHandler=this.clickHandler};e.prototype.setSelect=function(t){if(t instanceof items.EquipSoulVO){this.selectItem=t;this.shuliang.visible=true;this.wenzi.visible=false;this.gezi.setData(t);game.ItemShowUtil.showType2(t,this.gezi,this.shuliang,1,1)}else{this.shuliang.visible=false;this.gezi.setData(t)}};e.prototype.setData=function(t){this.costItem=t;this.gezi.setData(t);if(t instanceof items.EquipSoulVO){var e=parseInt(csv.SoulBodyProxy.getIns().getSoulCfg(t.getItemId()).starlevel);this.starMediator.value=e}else{this.starMediator.value=0}this.boPush=false;this.shuliang.visible=false;this.wenzi.visible=false;this.selectItem=null};e.prototype.onClickHandler=function(){};e.SINGLE_KEY="soul.SoulHechengCostItem2";return e}(synthesis.HechengCostItem);t.SoulHechengCostItem2=e})(soul||(soul={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var soul;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.list=new component.SimpleGroupList;this.list.groupRender=synthesis.HechengTypeItem;this.list.itemRender=i.SoulHechengSubTypeItem;this.list.itemRenderHandler=new Laya.Handler(this,this.onSubTypeRenderHandler);this.list.groupRenderHandler=new Laya.Handler(this,this.onTypeRenderHandler);this.list.vScrollBarSkin=" ";this.list.groupKey="totaltype";this.list.boOpenOne=false;this.addChild(this.list);this.list.width=this.panelhecheng.width;this.list.height=this.panelhecheng.height;this.list.x=this.panelhecheng.x;this.list.y=this.panelhecheng.y};e.prototype.onTypeRenderHandler=function(t,e){t.setData(t.dataSource)};e.prototype.onSubTypeRenderHandler=function(t,e){t.setData(t.dataSource)};e.prototype.onDisplay=function(){synthesis.HechengModel.getIns().on(synthesis.HechengModel.SYNTHESIS_ACK,this,this.refreshAll);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){synthesis.HechengModel.getIns().off(synthesis.HechengModel.SYNTHESIS_ACK,this,this.refreshAll)};e.prototype.refreshAll=function(){this.list.dataSource=csv.HechengProxy.getIns().getArr(csv.HechengProxy.ENUM.SOUL);var t=-1;if(this.dataSource.length>0){var e=this.dataSource[0];if(typeof e=="number"){t=e-1}else if(e&&e.synthesistype){t=parseInt(e.synthesistype)-1}}if(t!=-1){this.list.selectedIndex=t;this.list.scrollToIndex(t)}};e.SINGLE_KEY="soul.SoulMainCompoundView";return e}(ui.yuanshenzhenshen.hechnegtip01UI);i.SoulMainCompoundView=t})(soul||(soul={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var soul;(function(e){var t=function(a){__extends(t,a);function t(){var t=a!==null&&a.apply(this,arguments)||this;t.level=0;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){a.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.starMediator=new common.StarClipMediator([this.gezi.xing1,this.gezi.xing2,this.gezi.xing3,this.gezi.xing4,this.gezi.xing5]);this.isOther=false};t.prototype.onDisplay=function(){this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){};t.prototype.refreshAll=function(){};t.prototype.setData=function(t,e,i){if(i===void 0){i=0}a.prototype.setData.call(this,t,e,i);this.buwei.visible=false;if(t instanceof items.EquipSoulVO){var n=parseInt(csv.SoulBodyProxy.getIns().getSoulCfg(t.itemCfg.id).starlevel);this.starMediator.value=n}if(this.isOther){this.jiahao.visible=false}};t.prototype.setLevel=function(t){this.level=t;this.gezi.qianghualv.value=this.level>0?"+"+this.level:"";this.gezi.qianghualv.visible=this.level>0};t.prototype.clickHandler=function(){if(!this.isOther){if(this._data instanceof items.ItemVO){tip.TipManager.showEquipSoulWithLevel([this._data,this.level])}else{var t=e.SoulBodyModel.getIns().getSoulItemsByPos(this.position,0);t.sort(e.SoulBodyModel.getIns().soulSort)}}else{if(this._data instanceof items.ItemVO){app.ViewManager.toggleDialog(tip.TipMeiator,1,0,[tip.TipSoulEquipView,[this._data,this.level],[]])}}};t.SINGLE_KEY="soul.EquipSoulBodyItem";return t}(equip.RoleEquipItem);e.EquipSoulBodyItem=t})(soul||(soul={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var soul;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){this.shuxing.text=t};e.SINGLE_KEY="soul.ListItem";return e}(ui.yuanshenzhenshen.xuanzexialalitemUI);t.ListItem=e})(soul||(soul={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var soul;(function(t){var e=function(n){__extends(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){n.prototype.initialize.call(this);this.starMediator=new common.StarClipMediator([this.xing1,this.xing2,this.xing3,this.xing4,this.xing5])};t.prototype.setData=function(t,e){if(e===void 0){e=""}n.prototype.setData.call(this,t);if(t instanceof items.EquipSoulVO){var i=parseInt(csv.SoulBodyProxy.getIns().getSoulCfg(t.itemCfg.id).starlevel);this.starMediator.value=i}};t.SINGLE_KEY="soul.SoulBagItemForShow";return t}(grids.GridView);t.SoulBagItemForShow=e})(soul||(soul={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var soul;(function(n){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.selectHandler=new Laya.Handler(this,this.onSelectHandler);this.gezi.clickHandler=new Laya.Handler(this,this.onClickHandler);this.shengjiani.stop();this.tihuanani.visible=false;this.shengjiani.visible=false;this.buwei.visible=false;this.xuanzhong.visible=false;this.starMediator=new common.StarClipMediator([this.gezi.xing1,this.gezi.xing2,this.gezi.xing3,this.gezi.xing4,this.gezi.xing5]);this.starMediator.value=0};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){this.starMediator.value=0;this.selectItem=t;if(t instanceof items.EquipSoulVO){this.gezi.setData(t);this.jiahao.visible=false;var e=parseInt(csv.SoulBodyProxy.getIns().getSoulCfg(t.getItemId()).starlevel);this.starMediator.value=e;this.gezi.clickHandler=undefined;this.gezi.shuzi.visible=true;game.ItemShowUtil.showType1(t,this.gezi,this.gezi.shuzi)}else if(t instanceof items.ItemVO){this.gezi.setData(t);this.jiahao.visible=false;this.gezi.clickHandler=undefined;this.gezi.shuzi.visible=true;game.ItemShowUtil.showType1(t,this.gezi,this.gezi.shuzi)}else{this.jiahao.visible=false;this.gezi.setData(game.GridsModel.LOCKED);this.gezi.shuzi.visible=false}};e.prototype.onClickHandler=function(){if(this.selectItem instanceof items.EquipSoulVO){tip.TipManager.show(this.selectItem)}};e.prototype.onSelectHandler=function(t,e,i){if(t==0){this.selectItem=undefined}else{this.selectItem=e;this.setData(e)}app.ViewManager.toggleDialog(n.SoulHechengSelectBagView,-1,0)};e.prototype.clean=function(){this.selectItem=null;this.costItem=null;this.starMediator.value=0};e.SINGLE_KEY="soul.SoulHeChengComItem";return e}(ui.zhuangbei.zhuangbeiitem2UI);n.SoulHeChengComItem=t})(soul||(soul={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var soul;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.clickHandler=function(){app.ViewManager.toggleDialog(i.SoulHechengCommonView,1,0,this.dataSource)};e.SINGLE_KEY="soul.SoulHechengSubTypeItem";return e}(synthesis.HechengSubTypeItem);i.SoulHechengSubTypeItem=t})(soul||(soul={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var soul;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.onClick=function(t){if(this.data instanceof items.EquipSoulVO){}};e.prototype.autoSelect=function(){};e.SINGLE_KEY="soul.SoulMateriaBagItem";return e}(t.SoulBagItem);t.SoulMateriaBagItem=e})(soul||(soul={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var soul;(function(t){var e=function(r){__extends(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){r.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.starMediator=new common.StarClipMediator([this.itemView.xing1,this.itemView.xing2,this.itemView.xing3,this.itemView.xing4,this.itemView.xing5]);this.arrow=new Laya.Image;this.arrow.skin="public/bg_jiantou_xia.png";this.arrow.x=this.width-this.arrow.width;this.arrow.y=this.height-this.arrow.height;this.arrow.anchorX=this.arrow.anchorY=.5;this.itemView.addChild(this.arrow)};t.prototype.onDisplay=function(){this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){};t.prototype.refreshAll=function(){};t.prototype.setData=function(t,e,i){r.prototype.setData.call(this,t);if(t.data instanceof items.EquipSoulVO){var n=parseInt(csv.SoulBodyProxy.getIns().getSoulCfg(t.data.itemCfg.id).starlevel);var a=parseInt(csv.SoulBodyProxy.getIns().getSoulCfg(t.data.itemCfg.id).score);var o=0;var s=i instanceof items.EquipSoulVO;if(s){o=parseInt(csv.SoulBodyProxy.getIns().getSoulCfg(i.getItemId()).score)}this.starMediator.value=n;this.arrow.skin="public/bg_jiantou_xia.png";e=e?e:false;this.arrow.visible=e;if(e){if(!s||a>o){this.arrow.skin="public/bg_jiantou_shang.png"}else if(o==a){this.arrow.visible=false}}}else{this.arrow.visible=false}};t.SINGLE_KEY="soul.SoulSelectBagItem";return t}(equip.EquipSelectBagItem);t.SoulSelectBagItem=e})(soul||(soul={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var soul;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.labelArr=[];this.txtContent.text="";this.txtContent.color="#d8f6f1";this.txtContent.fontSize=18;this.txtContent.bold=true;this.txtContent.font="SimHei";this.txtContent.leading=18;this.daojubox.vScrollBarSkin="";this.daojubox.vScrollBar.isVertical=true;this.daojubox.vScrollBar.elasticBackTime=0;this.daojubox.vScrollBar.elasticDistance=0};e.prototype.getTipX=function(){return this.tipsbg.x};e.prototype.getTipH=function(){return this.tipsbg.height};e.prototype.getTipW=function(){return this.tipsbg.width};e.prototype.getBottomX=function(){return this.tipsbg.x+this.tipsbg.width};e.prototype.getBottomY=function(){return this.tipsbg.y+this.tipsbg.height};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){this.clear()};e.prototype.refreshAll=function(){this.callHandler=this.dataSource[1];this.currH=0;this.labelmiaoshu04.text=this.dataSource[0][0];this.updateContent();this.zhuangshiimg04.y=this.tipsbg.height-tip.TipManager.GAPS.GAP_ICON;this.height=this.totalHeight;this.callHandler.run()};e.prototype.updateContent=function(t,e){if(t===void 0){t=20}if(e===void 0){e=240}if(this.dataSource[0][1]instanceof Array){this.txtContent.text="";var i=this.dataSource[0][1];for(var n=0;n<i.length;n++){if(n==3){this.currH+=tip.TipManager.GAPS.GAP_SUIT;this.currH+=tip.TipManager.GAPS.GAP_V_BUTTON;continue}var a=Attributes.getPropName(i[n].propId)+" +"+Attributes.getPropValue(i[n].propId,i[n].value,i[n].formula);var o=this.addAttr(this.daojubox,a,t);if(n%2>0){this.currH+=tip.TipManager.GAPS.GAP_SUIT;this.currH+=tip.TipManager.GAPS.GAP_V_BUTTON;o.x=e}}this.currH+=tip.TipManager.GAPS.GAP_V_LABLE}else{this.txtContent.text=this.dataSource[0][1];this.currH+=this.txtContent.height}this.totalHeight=this.currH+this.daojubox.y;this.totalHeight+=tip.TipManager.GAPS.GAP_V_LABLE+tip.TipManager.GAPS.GAP_BOTTOM;this.tipsbg.height=this.totalHeight};e.prototype.addAttr=function(t,e,i,n,a,o){if(i===void 0){i=40}if(n===void 0){n=20}if(a===void 0){a="#c3f4e0"}if(o===void 0){o=342}var s=Laya.Pool.getItemByClass("TipLabel",Laya.Label);s.x=i;s.y=this.currH+4;s.font="SimHei";s.fontSize=n;s.color=a;s.text=e;s.width=o;s.leading=10;s.wordWrap=true;t.addChild(s);this.labelArr.push(s);return s};e.prototype.clear=function(){while(this.labelArr.length>0){var t=this.labelArr.shift();t.x=0;t.y=0;if(t){t.removeSelf();Laya.Pool.recover("TipLabel",t)}}};e.SINGLE_KEY="soul.TipSoulAttrsInfoView";return e}(ui.yuanshenzhenshen.hunposhuxingtipsUI);t.TipSoulAttrsInfoView=e})(soul||(soul={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var talent;(function(n){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){app.ViewManager.regist(n.TalentTreeView,"tianfu.atlas");game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.TALENT_TREE,n.TalentTreeView);csv.FunctionsProxy.getIns().on(csv.FunctionsProxy.EVENTS.CHANGE,this,this.onRedDotChange)};e.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.ClearTreeAck,this,this.onClearTreeAck);this.addMsgListener(app.ProtocolResponse.LearnSkillTreeAck,this,this.onLearnSkillTreeAck);this.addMsgListener(app.ProtocolResponse.SkillTreeListNoti,this,this.onSkillTreeListNoti);this.addMsgListener(app.ProtocolResponse.ModitySkillTreeNtf,this,this.onModitySkillTreeNtf)};e.prototype.onClearTreeAck=function(t,e){if(e.result){n.TalentModel.getIns().onClearTree();this.onRedDotChange()}};e.prototype.onLearnSkillTreeAck=function(t,e){if(e.result){}};e.prototype.onSkillTreeListNoti=function(t,e){n.TalentModel.getIns().onSkillTreeListNoti(e.roleid,e.extpoint,e.data);this.onRedDotChange()};e.prototype.onModitySkillTreeNtf=function(t,e){n.TalentModel.getIns().onModitySkillTreeNtf(e.roleid,e.data);this.onRedDotChange()};e.prototype.onRedDotChange=function(){Laya.timer.callLater(this,this.onUpdateRedDot)};e.prototype.onUpdateRedDot=function(){var t=n.TalentModel.getIns().getRedDotArr();var e=false;for(var i=0;i<t.length;i++){e=t[i];if(e){break}}if(e){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.TALENT_TREE)}else{game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.TALENT_TREE)}};e.SINGLE_KEY="talent.TalentTreeModule";return e}(app.ModuleBase);n.TalentTreeModule=t})(talent||(talent={}));var talent;(function(t){var e=function(){function t(t,e){if(t===void 0){t=10}if(e===void 0){e=3}this.row=t;this.column=e;this.init()}t.prototype.init=function(){var t=[];for(var e=0;e<this.row;e++){var i=t[e]=[];for(var n=0;n<this.column;n++){i.push(null)}}this.cells=t};t.prototype.insertTile=function(t){this.cells[t.x][t.y]=t};t.prototype.removeTile=function(){this.init()};t.prototype.eachCell=function(t){for(var e=0;e<this.row;e++){for(var i=0;i<this.column;i++){t(e,i,this.cells[e][i])}}};t.SINGLE_KEY="talent.Grid";return t}();t.Grid=e})(talent||(talent={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var talent;(function(g){var a=function(){function t(){}t.prototype.onModitySkill=function(t){var e=this.getSkillById(t.treeid);if(e){e.lv=t.lv}else{this.skillList.push(t)}};t.prototype.getSkillById=function(t){var e;for(var i=0,n=this.skillList;i<n.length;i++){var a=n[i];if(a.treeid==t){e=a;break}}return e};return t}();g.TalenData=a;var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){this.dataList=[]};e.prototype.getRedDotArr=function(){var t=[];var e=false;var i=game.Context.roleList.length;for(var n=0;n<i;n++){e=this.getPoint(game.Context.roleList[n])>0;t.push(e)}return t};e.prototype.onClearTree=function(){var t=this.getData(this.selectedRoleVo.insId);if(t){t.skillList.length=0;g.TalentModel.getIns().event(g.TalentModel.TALENT_TREE_CHANGE)}};e.prototype.onSkillTreeListNoti=function(t,e,i){var n=this.getData(t);if(!n){n=new a;this.dataList.push(n)}n.roleid=t;n.extpoint=e;n.skillList=i};e.prototype.getData=function(t){var e;for(var i=0,n=this.dataList;i<n.length;i++){var a=n[i];if(Uint64.equal(t,a.roleid)){e=a;break}}return e};e.prototype.onModitySkillTreeNtf=function(t,e){var i=this.getData(t);if(!i){i=new a;i.roleid=t;i.skillList=[];i.extpoint=0;this.dataList.push(i)}i.onModitySkill(e[0]);g.TalentModel.getIns().event(g.TalentModel.TALENT_TREE_CHANGE,[e[0].treeid])};e.prototype.onTalentReset=function(t,e){if(game.GridsModel.getIns().hasEnoughItems(e,false,true)){app.ProtocolRequest.ClearTreeReq(t)}};e.prototype.getPoint=function(t){var e=this.getData(t.insId);var i=0;if(e){i=e.extpoint}var n=csv.LevelProxy.getIns().getCfg(t.level);if(n&&n.masterskillpoints){i+=n.masterskillpoints}var a=g.TalentModel.getIns().getAllLevByClass(t.insId,0);return i-a};e.prototype.getEquipName=function(t){return app.getLang("equip_pos_"+t)};e.prototype.getEquipVO=function(t){var e=game.Context.roleList.indexOf(this.selectedRoleVo);var i=game.GridsModel.EquipEnums[e];var n=game.GridsModel.getIns().getEquipByTypeAndPos(i,t);return n};e.prototype.onTalentAction=function(t,e){var i=this.getData(this.selectedRoleVo.insId);var n=t.cfg.class;if(i&&i.skillList.length>0){var a=csv.TalentProxy.getIns().getCfg(i.skillList[0].treeid);if(a){if(a.class==n){this.onLearnSkillTree(t,this.selectedRoleVo.insId)}else{manager.FlowManager.instance.flowByStyle1(app.getLang("talent_error_7"))}}}else{var o=app.getLang("talent_button"+n,"");game.Alert.show(app.getLang("talent_error_6",o),new Laya.Handler(this,this.onLearnSkillTree,[t,this.selectedRoleVo.insId]),new Laya.Handler)}};e.prototype.onLearnSkillTree=function(t,e){var i=this.getTalentLevel(t.cfg.masterid);var n=this.canUpgrade(t,i,true);if(n){app.ProtocolRequest.LearnSkillTreeReq(t.cfg.masterid,e)}};e.prototype.canUpgrade=function(t,e,i){if(e===void 0){e=-1}if(i===void 0){i=false}var n=false;if(t.isMax()==false){if(e<0){e=t.getLevel()}n=g.TalentModel.getIns().getPoint(this.selectedRoleVo)>0;if(n){if(e>0){n=true}else{n=g.TalentModel.getIns().checkFront(t,i)}if(n){n=g.TalentModel.getIns().checkEquip(t.cfg.limit,e,i)}}else{if(i){manager.FlowManager.instance.flowByStyle1(app.getLang("talent_error_4"))}}}return n};e.prototype.checkFront=function(t,e){if(e===void 0){e=true}if(t.cfg.frontlevel&&t.cfg.frontlevel.length>0){var i=parseInt(app.str2Array(t.cfg.frontlevel,"-")[0]);var n=parseInt(app.str2Array(t.cfg.frontlevel,"-")[1]);var a=g.TalentModel.getIns().getTalentLevel(i);if(a<n){if(e){manager.FlowManager.instance.flowByStyle1(app.getLang("talent_error_1"))}return false}}return true};e.prototype.checkEquip=function(t,e,i){if(t===void 0){t=""}if(i===void 0){i=true}var n=app.str2Array(t,";","-");var a=[];var o=[];var s=true;for(var r=0;r<n.length;r++){if(n[r][0]==1){var l=parseInt(n[r][1]);var h=parseInt(n[r][2]);var p=this.getAllLevByClass(this.selectedRoleVo.insId,l);if(p<h){if(l>0){if(i){var u=app.getLang("talent_button"+l,app.getLang("talent_error_2"));manager.FlowManager.instance.flowByStyle1(u)}}return false}}else if(n[r][0]==2){o=n[n.length-1];if(n[r][1]){var c=g.TalentModel.getIns().getEquipVO(n[r][1]);if(c){if(c.getQuality()>=parseInt(n[r][2])){a=n[r]}}else{if(i){manager.FlowManager.instance.flowByStyle1(app.getLang("talent_error_5"))}return false}}}}if(o&&o.length>0){if(a&&a.length>0){if(e>=a[3]){if(i){manager.FlowManager.instance.flowByStyle1(app.getLang("talent_error_3"))}s=false}}}return s};e.prototype.getAllLevByClass=function(t,e){var i=0;var n=this.getData(t);if(n&&n.skillList){for(var a=0,o=n.skillList;a<o.length;a++){var s=o[a];var r=csv.TalentProxy.getIns().getCfg(s.treeid);if(e==0){i+=s.lv}else if(r.class==e){i+=s.lv}}}return i};e.prototype.getTalentLevel=function(t){var e=0;var i=this.getData(this.selectedRoleVo.insId);if(i&&i.skillList){for(var n=0,a=i.skillList;n<a.length;n++){var o=a[n];if(o.treeid==t){e=o.lv;break}}}return e};e.SINGLE_KEY="talent.TalentModel";e.TALENT_TREE_CHANGE="talent.onModitySkillTree";return e}(app.ModelBase);g.TalentModel=t})(talent||(talent={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("masterskilltree.csv");this.cfgMap=t.getMap("masterid");this.masterMap=t.getMapList("job","class")};e.prototype.getCfg=function(t){return this.cfgMap[t]};e.prototype.getMasterCfg=function(t,e){return this.masterMap[t]?this.masterMap[t][e]:[]};e.prototype.getTotal=function(t,e){var i=this.getMasterCfg(t,e);var n=0;for(var a=0,o=i;a<o.length;a++){var s=o[a];n+=s.maxlevel}return n};e.SINGLE_KEY="csv.TalentProxy";return e}(app.ModelBase);t.TalentProxy=e})(csv||(csv={}));var talent;(function(t){var e=function(){function i(){}i.decode=function(t){var e=new i;e.id=t["id"];e.type=t["type"];return e};return i}();t.TalentVO=e})(talent||(talent={}));var talent;(function(h){var t=function(){function t(){}t.prototype.init=function(t,e,i){this.x=t;this.y=e;this.cfg=i;this.frontId=0;this.frontLev=0;this.path=[];if(this.cfg&&this.cfg.frontlevel.length>0){var n=app.str2Array(this.cfg.frontlevel,"-");this.frontId=parseInt(n[0]);this.frontLev=parseInt(n[1])}};t.prototype.addPath=function(t){if(this.frontId&&this.frontId>0){var e=csv.TalentProxy.getIns().getCfg(this.frontId);var i=app.str2Array(e.coordinate,"-");var n=parseInt(i[0]);var a=parseInt(i[1]);var o=t.cells[n][a];this.findPath(this,o,this.path,t)}};t.prototype.findPath=function(t,e,i,n){var a=n.cells[t.x][t.y];if(t.x==e.x&&t.y==e.y){var o=i[i.length-1];if(o.x==t.x){if(o.y<t.y){i.push({x:t.x,y:t.y,direction:[h.LineDirection.Left]})}else if(o.y>t.y){i.push({x:t.x,y:t.y,direction:[h.LineDirection.Right]})}}else if(o.y==t.y){i.push({x:t.x,y:t.y,direction:[h.LineDirection.Down]})}}else if(t.x>e.x){if(t.y==e.y){var s=this.getDirection(i,t);s.push(1);i.push({x:t.x,y:t.y,direction:s});t.x-=1;this.findPath(t,e,i,n)}else{var r=n.cells[t.x-1][t.y];var s=this.getDirection(i,t);if(r==null){s.push(h.LineDirection.Up);i.push({x:t.x,y:t.y,direction:s});t.x-=1;this.findPath(t,e,i,n)}else{if(e.y>t.y){s.push(h.LineDirection.Right);i.push({x:t.x,y:t.y,direction:s});t.y+=1;this.findPath(t,e,i,n)}else{s.push(h.LineDirection.Left);i.push({x:t.x,y:t.y,direction:s});t.y-=1;this.findPath(t,e,i,n)}}}}else{var s=this.getDirection(i,t);var l=void 0;if(t.y>e.y){s.push(h.LineDirection.Left);l=t.y-1}else if(t.y<e.y){s.push(h.LineDirection.Right);l=t.y+1}i.push({x:t.x,y:t.y,direction:s});t.y=l;this.findPath(t,e,i,n)}};t.prototype.getDirection=function(t,e){var i=[];if(t&&t.length>0){var n=t[t.length-1];if(n.y==e.y){i.push(h.LineDirection.Down)}else if(n.x==e.x){if(n.y>e.y){i.push(h.LineDirection.Left)}else if(n.y<e.y){i.push(h.LineDirection.Right)}}}return i};t.prototype.getLevel=function(){return h.TalentModel.getIns().getTalentLevel(this.cfg.masterid)};t.prototype.isMax=function(){return this.cfg?this.cfg.maxlevel==this.getLevel():false};return t}();h.Tile=t})(talent||(talent={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var talent;(function(t){var e=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.on(Laya.Event.CLICK,this,this.onShowTips);var t=new Laya.Sprite;t.graphics.drawCircle(this.imgneibu.width*.5,this.imgneibu.height*.5,45,"#ff0000");this.imgneibu.mask=t;this.imgxuanzhong.visible=false};t.prototype.onDisplay=function(){this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){};t.prototype.refreshAll=function(){};t.prototype.setData=function(t){this.tile=t};t.prototype.updateView=function(t){var e=this.tile.getLevel();this.labelname.text=this.tile.cfg.name;this.labelshuzi.text=app.getLang("{0}/{1}",e,this.tile.cfg.maxlevel);if(this.tile.cfg.icon.length>0){this.imgneibu.skin="res/icon/masterskill/"+this.tile.cfg.icon+".png"}else{this.imgneibu.skin=""}if(e>0){this.imgneibu.gray=false}else{this.imgneibu.gray=true}this.imgxuanzhong.visible=t};t.prototype.onShowTips=function(){if(this.tile.isMax()){tip.TipManager.showTalentTip(this.tile)}else if(this.tile.getLevel()<=0){tip.TipManager.showTalentTip(this.tile,tip.TipManager.TIP_BTN_TYPE.TALENT_GET)}else{tip.TipManager.showTalentTip(this.tile,tip.TipManager.TIP_BTN_TYPE.TALENT_UPGRADE)}};t.prototype.clean=function(){this.tile=null};t.SINGLE_KEY="talent.TalentItemView";return t}(ui.tianfu.tianfutubiaoitemUI);t.TalentItemView=e})(talent||(talent={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var talent;(function(t){var i;(function(t){t[t["Left"]=0]="Left";t[t["Up"]=1]="Up";t[t["Right"]=2]="Right";t[t["Down"]=3]="Down"})(i=t.LineDirection||(t.LineDirection={}));var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.lines=[];this.bgs=[];this.direction=[];this.lines.push(this.line0,this.line1,this.line2,this.line3,this.block);this.bgs.push(this.lineBg0,this.lineBg1,this.lineBg2,this.lineBg3,this.blockBg)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.show=function(t,e){this.hideAll();this.id=t;this.direction=e;for(var i=0;i<e.length;i++){var n=e[i];this["lineBg"+n].visible=true}this.setConrner(false)};e.prototype.setConrner=function(t){var e=this.direction;if(e.length>1){if(e.indexOf(i.Right)>=0&&e.indexOf(i.Down)>=0){this.block.skin="tianfu/bg_xian_guaijiao.png";this.blockBg.skin="tianfu/bg_xian_guaijiaodi.png"}else if(e.indexOf(i.Left)>=0&&e.indexOf(i.Down)>=0){this.block.skin="tianfu/bg_xian_guaijiao4.png";this.blockBg.skin="tianfu/bg_xian_guaijiaodi4.png"}else if(e.indexOf(i.Left)>=0&&e.indexOf(i.Up)>=0){this.block.skin="tianfu/bg_xian_guaijiao2.png";this.blockBg.skin="tianfu/bg_xian_guaijiaodi2.png"}else if(e.indexOf(i.Up)>=0&&e.indexOf(i.Right)>=0){this.block.skin="tianfu/bg_xian_guaijiao3.png";this.blockBg.skin="tianfu/bg_xian_guaijiaodi3.png"}else if(e.indexOf(i.Left)>=0&&e.indexOf(i.Right)>=0){this.block.skin="tianfu/bg_xian_zhongheng.png";this.blockBg.skin="tianfu/bg_xian_zhonghengdi.png"}else if(e.indexOf(i.Up)>=0&&e.indexOf(i.Down)>=0){this.block.skin="tianfu/bg_xian_zhong.png";this.blockBg.skin="tianfu/bg_xian_zhongdi.png"}this.block.visible=t;this.blockBg.visible=!t}};e.prototype.setselected=function(t){for(var e=0;e<this.direction.length;e++){var i=this.direction[e];this.lines[i].visible=t;this.bgs[i].visible=!t}this.setConrner(t)};e.prototype.hideAll=function(){for(var t=0;t<this.lines.length;t++){this.lines[t].visible=false;this.bgs[t].visible=false}};e.prototype.clean=function(){this.id=0;this.direction=[]};e.SINGLE_KEY="talent.TalentLine";return e}(ui.tianfu.xianUI);t.TalentLine=e})(talent||(talent={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var talent;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.quxiaobtn.clickHandler=new Laya.Handler(this,this.onCancel);this.quedingbtn.clickHandler=new Laya.Handler(this,this.onReset)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){this.label01.text=app.getLang(this.dataSource[1]);this.daoju.setData(this.dataSource[2])};e.prototype.onReset=function(){i.TalentModel.getIns().onTalentReset(this.dataSource[0],this.dataSource[2]);this.close()};e.prototype.onCancel=function(){this.close()};e.SINGLE_KEY="talent.TalentResetView";return e}(ui.alert.chongzhiquerenUI);i.TalentResetView=t})(talent||(talent={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var talent;(function(p){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t._selectType=1;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.views=[];this.lines=[];this.btns=[];this.btns.push(this.butyeqian1,this.butyeqian2,this.butyeqian3);this.butyeqian1.label=app.getLang("talent_button1","");this.butyeqian2.label=app.getLang("talent_button2","");this.butyeqian3.label=app.getLang("talent_button3","");this.labelguize.text=app.getLang("talent_label");this.labeltianfudian.text=app.getLang("talent_point");this.grid=new p.Grid;this.butyeqian1.clickHandler=new Laya.Handler(this,this.updateTree,[1]);this.butyeqian2.clickHandler=new Laya.Handler(this,this.updateTree,[2]);this.butyeqian3.clickHandler=new Laya.Handler(this,this.updateTree,[3]);game.HelperViewHandler.registerStr([this.buttishi,this.labelguize],"func86t","talent_rule");this.butchongzhi.clickHandler=new Laya.Handler(this,this.onTalentReset);this.roleMediator=new common.RoleListMediator(this.itemxuanze.xuanzelist,equip.RoleItem,new Laya.Handler(this,this.roleSelectChange));this.roleMediator.setData(0)};t.prototype.onDisplay=function(){p.TalentModel.getIns().on(p.TalentModel.TALENT_TREE_CHANGE,this,this.onModitySkillTree);this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){p.TalentModel.getIns().on(p.TalentModel.TALENT_TREE_CHANGE,this,this.onModitySkillTree)};t.prototype.onModitySkillTree=function(){var t=this.roleMediator.selectedIndex;var e=p.TalentModel.getIns().getRedDotArr();this.roleMediator.setData(t,e);this.updateButton(this._selectType);var i=this.views.length;for(var n=0;n<i;n++){var a=this.views[n];if(a instanceof p.TalentItemView){var o=p.TalentModel.getIns().canUpgrade(a.tile,-1,false);a.updateView(o);this.updateLine(a.tile,o)}}};t.prototype.refreshAll=function(){if(this.dataSource&&this.dataSource.length==1){this.roleMediator.setData(this.dataSource[0],[])}else{var t=this.roleMediator.selectedIndex;var e=p.TalentModel.getIns().getRedDotArr();this.roleMediator.setData(t,e)}this.onUpdateView()};t.prototype.roleSelectChange=function(){this.onUpdateView()};t.prototype.onUpdateView=function(){this._total1=csv.TalentProxy.getIns().getTotal(this.roleMediator.selectedRoleVo.prof,1);this._total2=csv.TalentProxy.getIns().getTotal(this.roleMediator.selectedRoleVo.prof,2);this._total3=csv.TalentProxy.getIns().getTotal(this.roleMediator.selectedRoleVo.prof,3);p.TalentModel.getIns().selectedRoleVo=this.roleMediator.selectedRoleVo;this.updateTree(1)};t.prototype.updateTree=function(t){var r=this;this._selectType=t;this.updateButton(t);var e=this.roleMediator.selectedRoleVo.prof;var i=csv.TalentProxy.getIns().getMasterCfg(e,t);this.clean();for(var n=0,a=i;n<a.length;n++){var o=a[n];var s=app.str2Array(o.coordinate,"-");var l=Laya.Pool.getItemByClass("talent.Tile",p.Tile);l.init(parseInt(s[0]),parseInt(s[1]),o);this.grid.insertTile(l)}this.grid.eachCell(function(t,e,i){if(i){i.addPath(r.grid)}});this.grid.eachCell(function(t,e,i){if(i){var n=Laya.Pool.getItemByClass("talent.TalentItemView",p.TalentItemView);n.setData(i);var a=p.TalentModel.getIns().canUpgrade(n.tile,-1,false);n.updateView(a);n.x=n.width*e;n.y=n.height*t;r.paneljineng.addChild(n);r.views.push(n);if(i.path&&i.path.length>0){for(var o=0;o<i.path.length;o++){var s=Laya.Pool.getItemByClass("talent.TalentLine",p.TalentLine);s.show(i.cfg.masterid,i.path[o].direction);s.x=s.width*i.path[o].y;s.y=s.height*i.path[o].x-38;r.paneljineng.addChildAt(s,0);r.lines.push(s)}}r.updateLine(n.tile,a)}})};t.prototype.updateLine=function(t,e){if(t.frontId>0){var i=true;if(t.getLevel()<t.cfg.maxlevel){i=e}for(var n=0;n<this.lines.length;n++){if(this.lines[n].id==t.cfg.masterid){this.lines[n].setselected(i)}}}};t.prototype.updateButton=function(t){var e=this.setPoint();var i=p.TalentModel.getIns().getAllLevByClass(this.roleMediator.selectedRoleUid,1);var n=p.TalentModel.getIns().getAllLevByClass(this.roleMediator.selectedRoleUid,2);var a=p.TalentModel.getIns().getAllLevByClass(this.roleMediator.selectedRoleUid,3);var o=[i,n,a];for(var s=0;s<this.btns.length;s++){var r=s+1;this.btns[s].label=app.getLang("talent_button"+r,o[s]);this.btns[s].selected=false;game.RedDotView.removeFrom(this.btns[s]);if(e>0){var l=p.TalentModel.getIns().getData(this.roleMediator.selectedRoleVo.insId);if(l&&l.skillList.length>0){var h=csv.TalentProxy.getIns().getCfg(l.skillList[0].treeid);if(h&&h.class==r){if(this["_total"+r]-o[r-1]>0){game.RedDotView.addTo(this.btns[r-1])}}}else{game.RedDotView.addTo(this.btns[r-1])}}}this.btns[t-1].selected=true};t.prototype.clean=function(){while(this.views.length>0){var t=this.views.pop();if(t){Laya.Pool.recover("talent.TalentItemView",t);t.clean();t.removeSelf()}}while(this.lines.length>0){var e=this.lines.pop();if(e){Laya.Pool.recover("talent.TalentLine",e);e.clean();e.removeSelf()}}this.grid.eachCell(function(t,e,i){if(i){Laya.Pool.recover("talent.Tile",i)}});this.grid.removeTile()};t.prototype.setPoint=function(){var t=p.TalentModel.getIns().getPoint(this.roleMediator.selectedRoleVo);this.labelshuliang.text=t+"";return t};t.prototype.onTalentReset=function(){var t=game.ItemUtil.parserList(game.Config.getParams(463))[0];app.ViewManager.toggleDialog(p.TalentResetView,1,0,[this.roleMediator.selectedRoleUid,"talent_reset_desc",t])};t.SINGLE_KEY="talent.TalentTreeView";return t}(ui.tianfu.tianfuviewUI);p.TalentTreeView=t})(talent||(talent={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var talk;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){app.ViewManager.regist(i.TalkHalfView,"duihua.atlas");app.ViewManager.regist(i.StartStoryView,"res/sound/cg01."+ent.Entry.soundSuffix)};e.prototype.initCommands=function(){i.TalkModel.getIns().on(i.TalkModel.STORY_TIGGER,this,this.onTigger)};e.prototype.onTigger=function(t){i.TalkModel.getIns().onTigger(t)};e.SINGLE_KEY="talk.TalkModule";return e}(app.ModuleBase);i.TalkModule=t})(talk||(talk={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("stories.csv");this.cfgMap=t.getMap("id");this.cfgArr=t.getArray();this.plotidMap={}};e.prototype.getCfg=function(t){return this.cfgMap[t]};e.prototype.getArr=function(){return this.cfgArr};e.prototype.getHalfUrl=function(t){if(t.sks==""){return csv.DefclassProxy.getIns().getCfg(game.Context.mainRole.prof).model}return t.sks};e.prototype.getSkScale=function(t){if(t.sks==""){return.6}else if(t.sksdes!=""){return t.sksdes}return 1};e.prototype.getSksmove=function(t){if(t.sksmove==""){return 0}return parseInt(t.sksmove)};e.prototype.getGroupByPlotid=function(t){if(this.plotidMap[t]){return this.plotidMap[t]}this.plotidMap[t]=[];for(var e=0,i=this.cfgArr.length;e<i;e++){var n=this.cfgArr[e];if(parseInt(n.plotid)==t){this.plotidMap[t].push(n)}}return this.plotidMap[t]||[]};e.prototype.getStory=function(t){var e=new p;e.tiggers=[];var i={};var n=this.getGroupByPlotid(t);for(var a=0,o=n.length;a<o;a++){var s=n[a];var r=parseInt(s.type);if(!i[r]){i[r]=[]}i[r].push(s)}for(var l in i){var h=new u;h.tigger=parseInt(l);h.steps=this.dellStep(i[l]);e.tiggers.push(h)}return e};e.prototype.dellStep=function(t){var e=[];var i;for(var n=0,a=t.length;n<a;n++){var o=t[n];var s=parseInt(o.command);if(n==0){i=s;var r=new l;r.command=s;r.group=[];r.group.push(o);e.push(r)}else{if(i==s){e[e.length-1].group.push(o)}else{i=s;var r=new l;r.command=s;r.group=[];r.group.push(o);e.push(r)}}}return e};e.SINGLE_KEY="csv.StoriesProxy";e.ENUM_TIGGER={TASK_GET:1,TASK_COMPELTE:2,BATTLE_START:3,BATTLE_LOOP:4,BATTLE_END:5,GET_NPC:6,STEP_SZJD:7,FU_YUAN_EVENT:9,INIT_BATTLE:10,WUXING_END:11};e.ENUM_COMMAND={HALF:1,BUBBLE:2,MOVE_POINT:3,VIDEO:4,SCENE_EFFECT:5,MANHUA:6,MV:7,ACT:8,HIDE:9,WUXING_GUIDE:10,NORMAL_GUIDE:11};e.ENUM_VIDEO={V1:"video1",V2:"video2",V3:"video3",V4:"video4"};return e}(app.ModelBase);t.StoriesProxy=e;var p=function(){function t(){}return t}();t.StoryVo=p;var u=function(){function t(){}return t}();t.StoryTiggerVo=u;var l=function(){function t(){}return t}();t.StoryStepVo=l})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var talk;(function(d){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t._aniMap={};return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.init=function(){this.stepHandler=new Laya.Handler(this,this.onStepHandler)};t.prototype.createPlotid=function(t){if(this.plotids==t){return}this.plotids=t;var e;if(typeof t=="string"){var i=app.str2Array(t,";","-");if(i[0]){if(i[0].length==1){e=parseInt(i[0][0])}else{for(var n=0,a=i.length;n<a;n++){if(game.Context.mainRole.prof==parseInt(i[n][0])){e=parseInt(i[n][1]);break}}}}}else{e=t}this.storyVo=csv.StoriesProxy.getIns().getStory(e)};t.prototype.getTiggerVo=function(t){var e;if(this.storyVo){for(var i=0,n=this.storyVo.tiggers.length;i<n;i++){var a=this.storyVo.tiggers[i];if(a.tigger==t){e=a;break}}}return e};t.prototype.onTigger=function(t){var e=this.getTiggerVo(t);if(e){guide.GuideModel.getIns().boOpen=false;this.step=0;this.subStep=0;this.stepArr=e.steps;this.playStep()}else{if(this.callBack){this.callBack.runWith(this.callData);this.callBack=null}}};t.prototype.playStep=function(){var t=this;game.SceneModel.clearAllScreenSp();var e=this.stepArr[this.step];if(!e){if(this.callBack){this.callBack.runWith(this.callData);this.callBack=null}if(this.npcVo){scene.SceneMediator.getInstance().removeSceneItem(this.npcVo.insId);this.npcVo=null}var i=this.stepArr[this.step-1];if(i){var n=i.group[i.group.length-1].func;if(n){game.ClosureManager.callFunction(n)}}guide.GuideModel.getIns().boOpen=true;return}var a=e.group[this.subStep];if(a.playone=="1"){var o=Laya.LocalStorage.getItem(game.AccountModel.accountId+"_story_"+a.id);if(o&&o=="1"){this.stepHandler.run();return}else{Laya.LocalStorage.setItem(game.AccountModel.accountId+"_story_"+a.id,"1")}}switch(e.command){case csv.StoriesProxy.ENUM_COMMAND.HALF:game.SceneModel.createAllScreenSp(game.SceneModel.ENUM_ALL_SCREEN.STORY,.5);app.ViewManager.toggleView(d.TalkHalfView,game.SceneModel.allScreenSp,1,[e.group,this.stepHandler]);break;case csv.StoriesProxy.ENUM_COMMAND.BUBBLE:this.playBubbles(e.group);break;case csv.StoriesProxy.ENUM_COMMAND.MOVE_POINT:game.SceneModel.createAllScreenSp(game.SceneModel.ENUM_ALL_SCREEN.STORY,0);var s=e.group[0];var r=app.str2Array(s.value2,";","-");var l=parseInt(s.sks);this.npcVo=csv.NpcProxy.getIns().getNpcVO(l);this.npcVo.posX=parseInt(r[0][0]);this.npcVo.posY=parseInt(r[0][1]);this.npcVo.dir=parseInt(r[0][2]);var h=scene.SceneMediator.getInstance().addSceneItem(this.npcVo);h.move(parseInt(r[1][0]),parseInt(r[1][1]),Laya.Handler.create(this,function(){t.npcVo.dir=parseInt(r[1][2]);t.onStepHandler()}));break;case csv.StoriesProxy.ENUM_COMMAND.VIDEO:game.SceneModel.createAllScreenSp(game.SceneModel.ENUM_ALL_SCREEN.STORY,.7);var p=e.group[0];this.playVideo(p.value2);break;case csv.StoriesProxy.ENUM_COMMAND.SCENE_EFFECT:game.SceneModel.createAllScreenSp(game.SceneModel.ENUM_ALL_SCREEN.STORY,.7);var u=e.group[0];d.TalkSceneEffect.getIns().cast(u.value2,this.stepHandler);break;case csv.StoriesProxy.ENUM_COMMAND.MANHUA:var c=e.group[this.subStep];var g=e.group.length>this.subStep+1;if(c.value2=="begin"){game.Context.birthing=true;app.ViewManager.toggleView(d.StartStoryView,app.AppContainer.zhezhaoLayer,1,[this.stepHandler,g])}else if(c.value2=="birth"){app.ViewManager.toggleView(d.BirthStoryView,app.AppContainer.zhezhaoLayer,1,[this.stepHandler,g])}else if(c.value2=="yuanshen"){Laya.Dialog.closeAll();app.ViewManager.toggleView(d.YuanshenStoryView,app.AppContainer.zhezhaoLayer,1,[this.stepHandler,g])}else if(c.value2=="battle"){Laya.Dialog.closeAll();app.ViewManager.toggleDialog(d.BattleStoryView,1,0,[this.stepHandler,g])}else if(c.value2=="fabao"){Laya.Dialog.closeAll();app.ViewManager.toggleView(d.FabaoStoryView,app.AppContainer.zhezhaoLayer,1,[this.stepHandler,g])}else if(c.value2=="battle1"||c.value2=="battle2"||c.value2=="battle3"){Laya.Dialog.closeAll();app.ViewManager.toggleDialog(d.BattleStoryView,1,0,[this.stepHandler,g,c.value2])}break;case csv.StoriesProxy.ENUM_COMMAND.MV:game.SceneModel.createAllScreenSp(game.SceneModel.ENUM_ALL_SCREEN.STORY,.7);var f=e.group[this.subStep];app.VideoManager.getIns().play(f.value2,this.stepHandler);break;case csv.StoriesProxy.ENUM_COMMAND.ACT:this.playAct(e.group);break;case csv.StoriesProxy.ENUM_COMMAND.HIDE:this.playHide(e.group);break;case csv.StoriesProxy.ENUM_COMMAND.WUXING_GUIDE:this.playWuxingGuide(e.group);break;case csv.StoriesProxy.ENUM_COMMAND.NORMAL_GUIDE:this.playNormalGuide(e.group);break}};t.prototype.onStepHandler=function(t){if(t){this.subStep++;this.playStep()}else{this.step++;this.playStep()}};t.prototype.playWuxingGuide=function(a,o){var s=this;if(o===void 0){o=0}var t=a[o];if(!t){this.onStepHandler();return}var r=app.str2Array(t.value2,"-");if(r[0]=="1"){Laya.timer.once(300,this,function(){Laya.Dialog.closeAll();var t=app.str2Array(game.Config.getParams(r[1]),"-");var e=parseInt(t[0]);var i=parseInt(t[1]);var n=battle.BattleWuxingView.getIns().getMineWxPosById(e);tip.TipWuxingBuffView.openEffect(e,i,n,Laya.Handler.create(s,s.playWuxingGuide,[a,++o]))})}else if(r[0]=="2"){if(app.ViewManager.DisplayedInStage(tip.TipWuxingBuffView.SINGLE_KEY)){tip.TipWuxingBuffView.getIns().showGuide(Laya.Handler.create(this,this.playWuxingGuide,[a,++o]),this.stepHandler)}else{this.playWuxingGuide(a,++o)}}else if(r[0]=="3"){if(app.ViewManager.DisplayedInStage(tip.TipWuxingBuffView.SINGLE_KEY)){tip.TipWuxingBuffView.closeEffect(Laya.Handler.create(this,this.playWuxingGuide,[a,++o]))}else{this.playWuxingGuide(a,++o)}}};t.prototype.playNormalGuide=function(t,e){if(e===void 0){e=0}var i=t[e];if(!i){this.onStepHandler();return}if(i.value2==1){if(app.ViewManager.DisplayedInStage(main.BattleSpeedView.SINGLE_KEY)){main.BattleSpeedView.getIns().showGuide(Laya.Handler.create(this,this.playNormalGuide,[t,++e]),this.stepHandler)}else{this.playNormalGuide(t,++e)}}};t.prototype.playHide=function(t,e){if(e===void 0){e=0}var i=t[e];if(!i){this.onStepHandler();return}var n=parseInt(i.seconds)*1e3;var a;if(i.value2!=""){var o=app.str2Array(i.value2,"-");var s=parseInt(o[0]);a=battle.BattleModel.getIns().getMonsterByPos(s);if(a){a.visible=false}}e++;Laya.timer.once(n,this,this.playHide,[t,e])};t.prototype.playAct=function(t,e){if(e===void 0){e=0}var i=t[e];if(!i){this.onStepHandler();return}var n;var a=app.str2Array(i.value2,"-");var o=parseInt(a[0]);n=battle.BattleModel.getIns().getMonsterByPos(o);if(n){n.visible=true;n.avatar.visible=false;n.setRoleAni(a[1],n.vo.dir);n.avatar.on(Laya.Event.COMPLETE,this,this.onAniComplete,[n,t,++e])}else{this.playAct(t,++e)}};t.prototype.onAniComplete=function(t,e,i){t.avatar.off(Laya.Event.COMPLETE,this,this.onAniComplete);t.setRoleAni(avatar.AvatarAnimation.ANI_ENUMS.IDLE,t.vo.dir);this.playAct(e,++i)};t.prototype.playBubbles=function(t,e){if(e===void 0){e=0}var i=t[e];if(!i){this.onStepHandler();return}var n=parseInt(i.seconds)*1e3;var a;if(i.value2==""){a=role.LeadingRoleView.getIns()}else{var o=app.str2Array(i.value2,"-");var s=parseInt(o[0]);if(s==1){var r=parseInt(o[1]);var l=csv.NpcProxy.getIns().getNpcVO(r);a=scene.SceneMediator.getInstance().getViewById(l.insId)}else if(s==2){var h=parseInt(o[1]);a=battle.BattleModel.getIns().getMonsterByPos(h)}}if(a){a.addBubble(i.words,n)}e++;Laya.timer.once(n,this,this.playBubbles,[t,e])};t.prototype.playVideo=function(t){var e=this;switch(t){case csv.StoriesProxy.ENUM_VIDEO.V1:var i=void 0;if(game.Context.mainRole.prof==2){i=["res/static/bg_dujie_chengggong_wa_2.png","res/static/donghua/hulu03.png","res/static/donghua/hulu01a.png","res/static/donghua/hulu02a.png","res/static/donghua/hulu05a.png"]}else if(game.Context.mainRole.prof==4){i=["res/static/bg_dujie_chengggong_wa_4.png","res/static/donghua/hulu03.png","res/static/donghua/hulu01b.png","res/static/donghua/hulu02b.png","res/static/donghua/hulu05b.png"]}else{i=["res/static/bg_dujie_chengggong_wa_1.png","res/static/donghua/hulu03.png","res/static/donghua/hulu01.png","res/static/donghua/hulu02.png","res/static/donghua/hulu05.png"]}Laya.loader.load(i,Laya.Handler.create(this,function(){e.loadAni("res/static/donghua/kaichangdonghua01_"+game.Context.mainRole.prof+".ani",20)}));break;case csv.StoriesProxy.ENUM_VIDEO.V2:Laya.loader.load(["res/static/donghua/donghua07.png","res/static/donghua/donghua08.png"],Laya.Handler.create(this,function(){e.loadAni("res/static/donghua/kaichangdonghua02.ani",16)}));break;case csv.StoriesProxy.ENUM_VIDEO.V3:Laya.loader.load(["res/static/donghua/bf1.png","res/static/donghua/bf2.png","res/static/donghua/bf3.png","res/static/donghua/donghua10.png","res/static/donghua/donghua09.png"],Laya.Handler.create(this,function(){e.loadAni("res/static/donghua/kaichangdonghua03.ani",16)}));break;case csv.StoriesProxy.ENUM_VIDEO.V4:Laya.loader.load(["res/static/donghua/huluteng.png","res/static/donghua/huluteng_da.png","res/static/donghua/huluteng_er.png","res/static/donghua/huluteng_liu.png","res/static/donghua/huluteng_qi.png","res/static/donghua/huluteng_san.png","res/static/donghua/huluteng_si.png","res/static/donghua/huluteng_wu.png","res/static/donghua/yeye.png"],Laya.Handler.create(this,function(){e.loadAni("res/static/donghua/huluteng.ani",24)}));break}};t.prototype.loadAni=function(t,e){if(!this._aniMap[t]){this._aniMap[t]=new Laya.Animation}var i=this._aniMap[t];i.interval=2e3/e;i.loadAnimation(t,Laya.Handler.create(this,this.onVideoLoaded,[i]));i.x=Laya.stage.width/2;i.y=Laya.stage.height/2;game.SceneModel.allScreenSp.addChild(i);var n=1;if(Laya.stage.width>750){n=Laya.stage.width/750}i.scale(n,n)};t.prototype.onVideoLoaded=function(t){t.on(Laya.Event.COMPLETE,this,this.onVideoComplete,[t]);t.play(0,false)};t.prototype.onVideoComplete=function(t){t.stop();t.removeSelf();this.onStepHandler()};t.SINGLE_KEY="talk.TalkModel";t.STORY_TIGGER="story_tigger";return t}(app.ModelBase);d.TalkModel=t})(talk||(talk={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var talk;(function(t){var e=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.fullScreen="fullScreen";t.battleTypeMap={battle1:[new ui.sigemanhua.sigemanhuaview14UI,new ui.sigemanhua.sigemanhuaview15UI,new ui.sigemanhua.sigemanhuaview16UI],battle2:[new ui.sigemanhua.sigemanhuaview17UI,new ui.sigemanhua.sigemanhuaview18UI,new ui.sigemanhua.sigemanhuaview19UI],battle3:[new ui.sigemanhua.sigemanhuaview20UI,new ui.sigemanhua.sigemanhuaview21UI,new ui.sigemanhua.sigemanhuaview22UI]};t.profMap={1:[new ui.sigemanhua.sigemanhuaview05UI,new ui.sigemanhua.sigemanhuaview06UI,new ui.sigemanhua.sigemanhuaview07UI],2:[new ui.sigemanhua.sigemanhuaview08UI,new ui.sigemanhua.sigemanhuaview09UI,new ui.sigemanhua.sigemanhuaview10UI],4:[new ui.sigemanhua.sigemanhuaview11UI,new ui.sigemanhua.sigemanhuaview12UI,new ui.sigemanhua.sigemanhuaview13UI]};t.rt=0;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.bg=new Laya.Sprite;this.addChildAt(this.bg,0);this.bg.graphics.drawRect((750-Laya.stage.width)/2,(1334-Laya.stage.height)/2,Laya.stage.width,Laya.stage.height,game.STYLES.BLACK_COLOR);this.items=[];this.on(Laya.Event.CLICK,this,this.onPass)};t.prototype.onPass=function(){if(this.boClick){this.aniEnd()}};t.prototype.onClose=function(){app.ViewManager.toggleDialog(t,-1,0)};t.prototype.onDisplay=function(){this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){Laya.timer.clearAll(this);for(var t=0;t<this.items.length;t++){this.items[t].removeSelf()}this.off(Laya.Event.CLICK,this,this.onClose);this.callLater(this.callBack)};t.prototype.callBack=function(){if(this.dataSource[0]){this.dataSource[0].runWith(this.dataSource[1])}};t.prototype.refreshAll=function(){if(this.dataSource&&this.dataSource[2]&&this.dataSource[2].length>0){this.items=this.battleTypeMap[this.dataSource[2]]}else{this.items=this.profMap[game.Context.mainRole.prof]}var t=[313,667,1021];var e=this.getChildIndex(this.imgbg)+1;for(var i=2;i>=0;i--){this.items[i].y=t[i];this.items[i].anchorX=this.items[i].anchorY=.5;this.addChildAt(this.items[i],e);this.items[i].alpha=0;this.items[i].ani1.gotoAndStop(0)}this.btndianjijixu.visible=false;this.playEnter();this.dex=0;Laya.timer.once(1e3,this,this.playPics);Laya.timer.once(5e3,this,this.allEnd)};t.prototype.playRotation=function(){this.rt+=5;this.imgzhuangshizuoshang03.rotation=-this.rt;this.imgzhuangshizuoshang02.rotation=this.rt};t.prototype.playEnter=function(){var t=this;var e=(1334-Laya.stage.height)/2;var i=(750-Laya.stage.width)/2;var n=Laya.stage.width+(750-Laya.stage.width)/2;this.box1.x=i-this.box1.width;this.box1.y=e;Laya.Tween.to(this.box1,{x:i},500,null,Laya.Handler.create(this,function(){t.ani1.on(Laya.Event.COMPLETE,t,function(){Laya.timer.frameLoop(1,t,t.playRotation)});t.ani1.play(0,false)}));this.box2.x=n+this.box2.width;this.box2.y=e;Laya.Tween.to(this.box2,{x:n},500,null,Laya.Handler.create(this,function(){t.ani2.play(0,false)}),100);this.box3.x=i-this.box3.width;this.box3.y=1334-e;Laya.Tween.to(this.box3,{x:i},500,null,Laya.Handler.create(this,function(){t.ani3.play(0,false)}),300);this.box4.x=n+this.box4.width;this.box4.y=1334-e;Laya.Tween.to(this.box4,{x:n},500,null,Laya.Handler.create(this,function(){t.ani4.play(0,false)}),200)};t.prototype.playPics=function(){this.boClick=true;Laya.Tween.to(this.items[this.dex],{x:375,alpha:1},500,null,Laya.Handler.create(this,this.playAni))};t.prototype.playAni=function(){this.items[this.dex].ani1.on(Laya.Event.COMPLETE,this,this.aniEnd);this.items[this.dex].ani1.play(0,false)};t.prototype.aniEnd=function(){this.boClick=false;this.items[this.dex].x=375;this.items[this.dex].alpha=1;this.items[this.dex].ani1.off(Laya.Event.COMPLETE,this,this.aniEnd);this.items[this.dex].ani1.gotoAndStop(this.items[this.dex].ani1["_count"]);Laya.Tween.clearAll(this.items[this.dex]);this.dex++;if(this.dex>=this.items.length){this.allEnd();return}this.playPics()};t.prototype.allEnd=function(){this.btndianjijixu.visible=true;this.on(Laya.Event.CLICK,this,this.onClose)};t.SINGLE_KEY="talk.BattleStoryView";return t}(ui.sigemanhua.sigemanhuaUI);t.BattleStoryView=e})(talk||(talk={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var talk;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.bg=new Laya.Sprite;this.addChildAt(this.bg,0);this.bg.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,game.STYLES.BLACK_COLOR);this.bg.alpha=.7;this.width=Laya.stage.width;this.height=Laya.stage.height;this.box.x=(this.width-750)/2;this.box.y=(this.height-1334)/2};e.prototype.onClose=function(){this.ani5.stop();app.ViewManager.toggleView(e,app.AppContainer.zhezhaoLayer,-1)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){if(this.dataSource[0]){this.dataSource[0].runWith(this.dataSource[1])}game.Context.birthing=false};e.prototype.refreshAll=function(){this.chuchang01.skin="res/static/donghua/hulu0"+game.Context.mainRole.prof+".png";this.zuohulu.skin="res/static/donghua/hulu0"+game.Context.mainRole.prof+"L.png";this.youhulu.skin="res/static/donghua/hulu0"+game.Context.mainRole.prof+"R.png";this.dawa.skin="res/static/bg_dujie_chengggong_wa_"+game.Context.mainRole.prof+".png";this.imgmeishuzi.skin="res/static/donghua/meishuizi_"+game.Context.mainRole.prof+".png";this.hanhua01.visible=this.youhulu.visible=this.zuohulu.visible=this.bg_guang.visible=this.dawa.visible=this.tishiyu.visible=false;this.chuchang01.visible=true;this.liefeng.visible=false;this.baozha.visible=false;this.ani1.on(Laya.Event.COMPLETE,this,this.ani1End);this.ani1.play()};e.prototype.ani1End=function(){this.youhulu.visible=this.zuohulu.visible=this.bg_guang.visible=this.dawa.visible=false;this.chuchang01.visible=this.hanhua01.visible=this.tishiyu.visible=true;this.ani1.off(Laya.Event.COMPLETE,this,this.ani1End);this.ani1.stop();this.ani2.play();this.ani6.play();this.on(Laya.Event.CLICK,this,this.onOpenClick)};e.prototype.onOpenClick=function(t){this.ani2.gotoAndStop(0);this.liefeng.visible=true;this.liefeng.play();manager.EffectManager.playStageEffectByPos("skill_dianjishuiwen01",this,Laya.stage.mouseX,Laya.stage.mouseY);this.ani7.on(Laya.Event.COMPLETE,this,this.ani7End);this.ani7.play();this.off(Laya.Event.CLICK,this,this.onOpenClick)};e.prototype.ani3End=function(){this.youhulu.visible=this.zuohulu.visible=false;this.bg_guang.visible=true;this.ani3.off(Laya.Event.COMPLETE,this,this.ani3End);this.ani3.stop()};e.prototype.ani7End=function(){var t=this;this.ani7.off(Laya.Event.COMPLETE,this,this.ani7End);this.chuchang01.visible=this.hanhua01.visible=this.tishiyu.visible=this.dawa.visible=this.bg_guang.visible=false;this.youhulu.visible=this.zuohulu.visible=true;this.liefeng.stop();this.liefeng.visible=false;this.ani6.stop();this.ani3.on(Laya.Event.COMPLETE,this,this.ani3End);this.ani3.play();Laya.timer.once(100,this,function(){t.dawa.visible=true;t.baozha.visible=true;t.baozha.on(Laya.Event.COMPLETE,t,t.boomEnd);t.baozha.play(0,false);t.ani4.on(Laya.Event.COMPLETE,t,t.ani4End);t.ani4.play();Laya.timer.once(500,t,function(){t.bg_guang.visible=true;t.ani5.play()})})};e.prototype.boomEnd=function(){this.baozha.visible=false};e.prototype.ani4End=function(){this.ani4.off(Laya.Event.COMPLETE,this,this.ani4End);this.ani4.gotoAndStop(this.ani4["_count"]);Laya.Tween.to(this.bg_guang,{alpha:0},300);Laya.Tween.to(this.bg,{alpha:0},500);Laya.Tween.to(this.dawa,{alpha:0},500,null,Laya.Handler.create(this,this.onClose))};e.SINGLE_KEY="talk.BirthStoryView";return e}(ui.donghua.kaichangdonghua01UI);t.BirthStoryView=e})(talk||(talk={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var talk;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.bg=new Laya.Sprite;this.addChildAt(this.bg,0);this.bg.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,game.STYLES.BLACK_COLOR);this.width=Laya.stage.width;this.height=Laya.stage.height;this.fabao=new ui.fabao2.fabaohuode01UI;this.fabao.x=(this.width-this.fabao.width)/2;this.fabao.y=(this.height-this.fabao.height)/2;this.addChild(this.fabao);this.fabao.visible=false};e.prototype.onClose=function(){app.ViewManager.toggleView(e,app.AppContainer.zhezhaoLayer,-1)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){this.fabao.ani1.stop();if(this.dataSource[0]){this.dataSource[0].runWith(this.dataSource[1])}};e.prototype.refreshAll=function(){this.bg.alpha=.7;var t=csv.NpcProxy.getIns().getNpcVO(7003);var e=scene.SceneMediator.getInstance().getViewById(t.insId);var i=e.parent.localToGlobal(new Laya.Point(e.x,e.y));this.img=new Laya.Image;this.fabao.imgicon.skin=this.img.skin="res/icon/magicweapon/bg_fabao_bg_60117.png";this.img.width=this.img.height=0;this.img.anchorX=this.img.anchorY=.5;this.img.x=i.x;this.img.y=i.y;this.addChild(this.img);var n=this.fabao.imgicon.parent.localToGlobal(new Laya.Point(this.fabao.imgicon.x,this.fabao.imgicon.y));Laya.Tween.to(this.img,{x:n.x,y:n.y,width:this.fabao.imgicon.width*this.fabao.imgicon.scaleX,height:this.fabao.imgicon.height*this.fabao.imgicon.scaleY},1e3,null,Laya.Handler.create(this,this.flyEnd))};e.prototype.flyEnd=function(){this.img.visible=false;this.fabao.visible=true;this.fabao.ani1.play();this.on(Laya.Event.CLICK,this,this.onClose)};e.SINGLE_KEY="talk.FabaoStoryView";return e}(Laya.View);t.FabaoStoryView=e})(talk||(talk={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var talk;(function(t){var e=function(i){__extends(t,i);function t(){var t=i!==null&&i.apply(this,arguments)||this;t.fullScreen="fullScreen";t.y1=397;t.y2=667;t.y3=937;t.rt=0;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){i.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.bg=new Laya.Sprite;this.addChildAt(this.bg,0);this.bg.graphics.drawRect((750-Laya.stage.width)/2,(1334-Laya.stage.height)/2,Laya.stage.width,Laya.stage.height,game.STYLES.BLACK_COLOR);this.items=[new ui.sigemanhua.sigemanhuaview01UI,new ui.sigemanhua.sigemanhuaview02UI,new ui.sigemanhua.sigemanhuaview03UI,new ui.sigemanhua.sigemanhuaview04UI];var t=this.getChildIndex(this.imgbg)+1;for(var e=3;e>=0;e--){this.items[e].x=375;this.items[e].anchorX=this.items[e].anchorY=.5;this.addChildAt(this.items[e],t);this.items[e].alpha=0;this.items[e].ani1.gotoAndStop(0)}this.close=null;this.btndianjijixu.name="";this.btndianjijixu.clickHandler=new Laya.Handler(this,this.onClose);this.items[3].on(Laya.Event.CLICK,this,this.onClose);this.on(Laya.Event.CLICK,this,this.onPass)};t.prototype.onPass=function(){if(this.boClick){this.flyEnd()}};t.prototype.onClose=function(){Laya.Dialog.manager.doClose(this)};t.prototype.onDisplay=function(){this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){Laya.timer.clearAll(this);if(this.dataSource[0]){this.dataSource[0].runWith(this.dataSource[1])}this.items[3].ani2.stop()};t.prototype.refreshAll=function(){this.items[3].mouseEnabled=false;this.btndianjijixu.visible=false;this.playEnter();this.dex=0;this.boClick=false;Laya.timer.once(1e3,this,this.playPics);this.items[3].ani2.gotoAndStop(0)};t.prototype.playRotation=function(){this.rt+=5;this.imgzhuangshizuoshang03.rotation=-this.rt;this.imgzhuangshizuoshang02.rotation=this.rt};t.prototype.playEnter=function(){var t=this;var e=(1334-Laya.stage.height)/2;var i=(750-Laya.stage.width)/2;var n=Laya.stage.width+(750-Laya.stage.width)/2;this.box1.x=i-this.box1.width;this.box1.y=e;Laya.Tween.to(this.box1,{x:i},500,null,Laya.Handler.create(this,function(){t.ani1.on(Laya.Event.COMPLETE,t,function(){Laya.timer.frameLoop(1,t,t.playRotation)});t.ani1.play(0,false)}));this.box2.x=n+this.box2.width;this.box2.y=e;Laya.Tween.to(this.box2,{x:n},500,null,Laya.Handler.create(this,function(){t.ani2.play(0,false)}),100);this.box3.x=i-this.box3.width;this.box3.y=1334-e;Laya.Tween.to(this.box3,{x:i},500,null,Laya.Handler.create(this,function(){t.ani3.play(0,false)}),300);this.box4.x=n+this.box4.width;this.box4.y=1334-e;Laya.Tween.to(this.box4,{x:n},500,null,Laya.Handler.create(this,function(){t.ani4.play(0,false)}),200)};t.prototype.playPics=function(){this.items[this.dex].y=this.y2;this.items[this.dex].scale(0,0);Laya.Tween.to(this.items[this.dex],{scaleX:1.1,scaleY:1.1,alpha:1},500,null,Laya.Handler.create(this,this.playAni))};t.prototype.playAni=function(){this.boClick=true;this.items[this.dex].ani1.on(Laya.Event.COMPLETE,this,this.aniEnd);this.items[this.dex].ani1.play(0,false)};t.prototype.aniEnd=function(){Laya.Tween.to(this.items[this.dex],{scaleX:1,scaleY:1,y:this.dex%2==0?this.y1:this.y3},500,null,Laya.Handler.create(this,this.flyEnd))};t.prototype.flyEnd=function(){this.items[this.dex].ani1.off(Laya.Event.COMPLETE,this,this.aniEnd);this.items[this.dex].ani1.gotoAndStop(this.items[this.dex].ani1["_count"]);Laya.Tween.clearAll(this.items[this.dex]);this.items[this.dex].scale(1,1);this.items[this.dex].y=this.dex%2==0?this.y1:this.y3;this.dex++;this.boClick=false;if(this.dex>=this.items.length){this.allEnd();return}if(this.dex%2==0){for(var t=0;t<this.dex;t++){Laya.Tween.to(this.items[t],{alpha:0},700,null,null,300)}Laya.timer.once(1e3,this,this.playPics)}else{this.playPics()}};t.prototype.allEnd=function(){this.items[3].ani2.play(0,true);this.btndianjijixu.visible=true;this.items[3].mouseEnabled=true};t.SINGLE_KEY="talk.LoadingStoryView";return t}(ui.sigemanhua.sigemanhuaUI);t.LoadingStoryView=e})(talk||(talk={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var talk;(function(t){var e=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.x=(Laya.stage.width-this.width)/2;this.y=(Laya.stage.height-this.height)/2;this.juanzhoushang.y=-this.y;var t=Laya.stage.height-this.juanzhouxia.height+5;this.juanzhouxia.y=t<1460?1460:t;this.sj=new common.CSkt;this.sj.x=this.sheijing.x;this.sj.y=this.sheijing.y-300;this.sj.init("res/sks/shejing01.sk");this.sks_sj.addChild(this.sj);this.sz=new common.CSkt;this.sz.x=this.xiezi.x;this.sz.y=this.xiezi.y;this.sz.init("res/sks/xiezijing01.sk");this.sk_xz.addChild(this.sz);this.sbf1=new common.CSkt;this.sbf1.x=this.bf1.x+80;this.sbf1.y=this.bf1.y+60;this.sbf1.init("res/sks/bianfu01.sk");this.sk_bf1.addChild(this.sbf1);this.sbf2=new common.CSkt;this.sbf2.x=this.bf2.x+80;this.sbf2.y=this.bf2.y+60;this.sbf2.init("res/sks/bianfu01.sk");this.sk_bf2.addChild(this.sbf2);this.tiaoguo.on(Laya.Event.CLICK,this,this.onJumpHandler)};t.prototype.onJumpHandler=function(){login.CoverModel.getIns().playAnim(login.EAnimStatus.SKIP);this.ani1End()};t.prototype.onDisplay=function(){this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){if(this.dataSource[0]){this.dataSource[0].runWith(this.dataSource[1])}game.Context.birthing=false;app.SoundManager.getIns().resumeMapBgm()};t.prototype.refreshAll=function(){app.SoundManager.getIns().stopMapBgm();Laya.SoundManager.setMusicVolume(1);app.SoundManager.getIns().playBgm("cg01");this.ani1.on(Laya.Event.COMPLETE,this,this.onAnimComplete);this.ani1.play(0,false);this.onFrameHandler()};t.prototype.onFrameHandler=function(){if(this.ani1.isPlaying){var t=this.ani1.index/(this.ani1.count-1);login.CoverModel.getIns().playAnim(login.EAnimStatus.HALF,t.toFixed(2));Laya.timer.once(1e3,this,this.onFrameHandler)}};t.prototype.onAnimComplete=function(){login.CoverModel.getIns().playAnim(login.EAnimStatus.END);this.ani1End()};t.prototype.ani1End=function(){this.ani1.stop();this.ani1.off(Laya.Event.COMPLETE,this,this.ani1End);app.ViewManager.toggleView(t,app.AppContainer.zhezhaoLayer,-1)};t.SINGLE_KEY="talk.StartStoryView";return t}(ui.donghua.newkaichangUI);t.StartStoryView=e})(talk||(talk={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var talk;(function(t){var i=function(){function s(t){this.isEnd=false;this.wordIndex=0;this.hualab=t;this.hualab.text=""}s.prototype.show=function(){this.isEnd=true;Laya.timer.clear(this,this.updateTime);this.hualab.text=this.getDes(this.curStr.length)};s.prototype.play=function(t){this.wordIndex=0;this.curStr="";this.colorDexArr=[];var e=0;var i=t.split(s.COLOR_REGEXP);var n=t.match(s.COLOR_REGEXP);for(var a=0,o=i.length;a<o;++a){this.curStr+=i[a];if(n&&n[a]){e=this.curStr.length;this.colorDexArr.push(e);this.curStr+=n[a].substring(1,n[a].length-1);e=this.curStr.length;this.colorDexArr.push(e)}}if(s.Close){this.show()}else{this.isEnd=false;Laya.timer.once(s.TimeDelay,this,this.updateTime)}};s.prototype.updateTime=function(){if(this.wordIndex>this.curStr.length-1){this.isEnd=true}else{this.hualab.text=this.getDes(this.wordIndex+1);this.wordIndex++;Laya.timer.once(s.TimeDelay,this,this.updateTime)}};s.prototype.getDes=function(t){var e=0;var i="";var n=this.colorDexArr.length;if(n){for(var a=0;a<n;a+=2){var o=this.colorDexArr[a];var s=this.colorDexArr[a+1];if(t<o){i+=this.curStr.substring(e,t);break}i+=this.curStr.substring(e,o);if(o<=t&&t<=s){i+="<span color='"+game.STYLES.YELLOW_COLOR_S+"'>"+this.curStr.substring(o,t)+"</span>";break}i+="<span color='"+game.STYLES.YELLOW_COLOR_S+"'>"+this.curStr.substring(o,s)+"</span>";e=s+1}var r=this.colorDexArr[n-1];if(t>r){i+=this.curStr.substring(r,t)}}else{i=this.curStr.substring(e,t)}return i};s.prototype.clear=function(){this.isEnd=false;this.hualab.text="";Laya.timer.clear(this,this.updateTime)};s.COLOR_REGEXP=new RegExp("#.*?#","g");s.Close=false;s.TimeDelay=50;return s}();t.TalkPlay=i;var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.talkPlay=new i(this.hualab);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){this.talkPlay.clear()};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){if(t.npcname==""){this.mingzilab.text=game.Context.clearPlayerName(game.Context.mainRole.playername)}else{this.mingzilab.text=app.getLang(t.npcname)}var e=app.getLang(t.words,game.Context.mainRole.playername);this.talkPlay.play(e)};e.prototype.setArrow=function(t){if(t){this.box.visible=true;this.ani1.play(0,true)}else{this.box.visible=false;this.ani1.stop()}};e.SINGLE_KEY="talk.TalkHalfLeftItem";return e}(ui.duihua.duihuaitem2UI);t.TalkHalfLeftItem=e})(talk||(talk={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var talk;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.talkPlay=new i.TalkPlay(this.hualab);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){this.talkPlay.clear()};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){if(t.npcname==""){this.mingzilab.text=game.Context.clearPlayerName(game.Context.mainRole.playername)}else{this.mingzilab.text=app.getLang(t.npcname)}var e=app.getLang(t.words,game.Context.mainRole.playername);this.talkPlay.play(e)};e.prototype.setArrow=function(t){if(t){this.box.visible=true;this.ani1.play(0,true)}else{this.box.visible=false;this.ani1.stop()}};e.SINGLE_KEY="talk.TalkHalfRightItem";return e}(ui.duihua.duihuaitem1UI);i.TalkHalfRightItem=t})(talk||(talk={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var talk;(function(h){var t=function(e){__extends(l,e);function l(){var t=e!==null&&e.apply(this,arguments)||this;t.leftItemArr=[];t.rightItemArr=[];return t}l.getIns=function(){return app.Singleton.getInstance(l)};l.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.on(Laya.Event.CLICK,this,this.onClick);this.bg=new Laya.Sprite;this.addChildAt(this.bg,0);this.bg.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,game.STYLES.BLACK_COLOR);this.bg.alpha=.5;this.banshen1.x=0;this.banshen1.y=Laya.stage.height;this.banshen2.x=Laya.stage.width;this.banshen2.y=Laya.stage.height;this.banshen1.skewY=180;this.width=Laya.stage.width;this.height=Laya.stage.height;this.lSkt=new common.CSkt;this.lSkt.x=this.banshen1.width/2;this.lSkt.y=256;this.banshen1.addChild(this.lSkt);this.rSkt=new common.CSkt;this.rSkt.x=this.banshen2.width/2;this.rSkt.y=256;this.banshen2.addChild(this.rSkt)};l.prototype.onClick=function(t){t.stopPropagation();var e=this.allItemArr[this.allItemArr.length-1];var i;if(e){i=e["talkPlay"]}if(i&&i.isEnd==false){i.show()}else{this.talkDex++;this.createTalkItem()}app.SoundManager.getIns().playSound("button")};l.prototype.onDisplay=function(){this.callLater(this.refreshAll)};l.prototype.onUnDisplay=function(){this.clearAll();this.dataSource[1].run();this.lSkt.reset();this.rSkt.reset()};l.prototype.refreshAll=function(){this.allItemArr=[];this.clearAll();this.talkDex=0;this.talkArr=this.dataSource[0];this.banshen1.visible=this.banshen2.visible=false;this.createTalkItem()};l.prototype.createTalkItem=function(){var t=this;if(this.lastChannel){this.lastChannel.stop()}var e=this.talkArr[this.talkDex];if(e){if(e.dubin!=""){this.lastChannel=app.SoundManager.getIns().playCv(e.dubin)}var i=e.leftright==1;var n=this.allItemArr[this.allItemArr.length-1];if(n){n["setArrow"](false)}var a=void 0;if(i){var o=role.RoleVO.getSkinSkt(csv.StoriesProxy.getIns().getHalfUrl(e));var s=csv.StoriesProxy.getIns().getSkScale(e);this.lSkt.scale(s,s);if(this.lSkt.url==""){this.lSkt.init(o)}else{if(this.lSkt.url!=o){Laya.Tween.to(this.banshen1,{x:-404},100,null,Laya.Handler.create(this,function(){t.lSkt.init(o);Laya.Tween.to(t.banshen1,{x:0},100)}))}}this.lSkt.x=this.banshen1.width/2+csv.StoriesProxy.getIns().getSksmove(e);this.banshen1.visible=true;Laya.Tween.to(this.banshen1,{scaleX:1.2,scaleY:1.2},200);Laya.Tween.to(this.banshen2,{scaleX:.8,scaleY:.8},200);this.addChild(this.banshen1);this.addChildAt(this.banshen2,0);a=Laya.Pool.getItemByClass("TalkHalfLeftItem",h.TalkHalfLeftItem);a.x=50;a.setData(e);this.addChild(a);this.leftItemArr.push(a);this.allItemArr.push(a)}else{var r=role.RoleVO.getSkinSkt(csv.StoriesProxy.getIns().getHalfUrl(e));var s=csv.StoriesProxy.getIns().getSkScale(e);this.rSkt.scale(s,s);if(this.rSkt.url==""){this.rSkt.init(r)}else{if(this.rSkt.url!=r){Laya.Tween.to(this.banshen2,{x:Laya.stage.width+404},100,null,Laya.Handler.create(this,function(){t.rSkt.init(r);Laya.Tween.to(t.banshen2,{x:Laya.stage.width},100)}))}}this.rSkt.x=this.banshen2.width/2+csv.StoriesProxy.getIns().getSksmove(e);this.banshen2.visible=true;Laya.Tween.to(this.banshen1,{scaleX:.8,scaleY:.8},200);Laya.Tween.to(this.banshen2,{scaleX:1.2,scaleY:1.2},200);this.addChildAt(this.banshen1,0);this.addChild(this.banshen2);a=Laya.Pool.getItemByClass("TalkHalfRightItem",h.TalkHalfRightItem);a.x=Laya.stage.width-a.width-50;a.setData(e);this.addChild(a);this.rightItemArr.push(a);this.allItemArr.push(a)}a.setArrow(true);a.alpha=0;a.y=Laya.stage.height-this.banshen1.height;Laya.Tween.to(a,{alpha:1},200);this.layout()}else{app.ViewManager.toggleView(l,game.SceneModel.allScreenSp,-1)}};l.prototype.layout=function(){this.currY=Laya.stage.height-this.banshen1.height;var t=this.allItemArr.length;for(var e=t-1;e>=0;e--){var i=this.allItemArr[e];this.currY-=i.height;Laya.Tween.to(i,{y:this.currY},200)}};l.prototype.clearAll=function(){while(this.leftItemArr.length>0){var t=this.leftItemArr.shift();if(t){t.removeSelf();Laya.Pool.recover("TalkHalfLeftItem",t)}}while(this.rightItemArr.length>0){var t=this.rightItemArr.shift();if(t){t.removeSelf();Laya.Pool.recover("TalkHalfRightItem",t)}}};l.SINGLE_KEY="talk.TalkHalfView";return l}(ui.duihua.duihuaviewUI);h.TalkHalfView=t})(talk||(talk={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var talk;(function(t){var e=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t.aniEffect=new game.AniView;t.isoDisplay.addChild(t.aniEffect);t.aniEffect.on(Laya.Event.COMPLETE,t,t.onAniComplete);return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.cast=function(t,e){this.call=e;var i=app.str2Array(t,";");var n=i[0];var a=parseInt(i[1]);var o=parseInt(i[2]);var s=parseInt(i[3]);var r=parseInt(i[4]);this.isoPos=new isometric.Point3D(a*32,0,o*32);this.x+=s;this.y+=r;this.aniEffect.load(n);this.aniEffect.play(0);scene.SceneMediator.getInstance().addSkill(this)};t.prototype.onAniComplete=function(){this.aniEffect.stop();scene.SceneMediator.getInstance().removeSkill(this);this.call.run()};t.prototype.updateFrame=function(t){};t.prototype.clearAll=function(){};t.prototype.recycle=function(){};return t}(skill.SkillEffect);t.TalkSceneEffect=e})(talk||(talk={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var talk;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.bg=new Laya.Sprite;this.addChildAt(this.bg,0);this.bg.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,game.STYLES.BLACK_COLOR);this.width=Laya.stage.width;this.height=Laya.stage.height};e.prototype.onClose=function(){app.ViewManager.toggleView(e,app.AppContainer.zhezhaoLayer,-1)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){this.ysani.stop();this.ysani.removeSelf();this.skt&&this.skt.stop();role.LeadingRoleView.getIns().setRoleAni(avatar.AvatarAnimation.ANI_ENUMS.IDLE,game.Context.mainRole.dir,true);if(this.dataSource[0]){this.dataSource[0].runWith(this.dataSource[1])}};e.prototype.refreshAll=function(){this.bg.alpha=.7;this.setAvatar();this.setYs();this.playYs()};e.prototype.setAvatar=function(){var t=csv.DefclassProxy.getIns().getCfg(game.Context.mainRole.prof);if(this.skt&&this.skt.parent){this.skt.removeSelf()}else{this.skt=new common.CSkt}this.skt.init(role.RoleVO.getSkinSkt(t.model));this.skt.x=this.width/2;this.skt.y=this.height/2;this.skt.scale(.6,.6);this.addChild(this.skt)};e.prototype.setYs=function(){var t=csv.DefclassProxy.getIns().getCfg(game.Context.mainRole.prof);this.ysani=new game.AniView;this.boom=new game.AniView;this.boom.x=this.ysani.x=this.width/2;this.boom.y=this.ysani.y=this.height/2;this.boom.load("skill_jihuoyuanshen",game.AniView.FILE_NAME.UI);this.ysani.scale(1.5,1.5);this.ysani.load(t.soulmodel,game.AniView.FILE_NAME.UI);this.ysani.scale(0,0)};e.prototype.playYs=function(){var t=this;this.addChild(this.ysani);this.addChild(this.boom);var e=role.LeadingRoleView.getIns();if(!e||!e.parent){this.onClose();return}var i=e.parent.localToGlobal(new Laya.Point(e.x,e.y));this.boom.on(Laya.Event.COMPLETE,this,function(){t.boom.removeSelf();Laya.Tween.to(t.ysani,{y:t.height/2-500,scaleX:1,scaleY:1},1e3,null,Laya.Handler.create(t,function(){t.skt.removeSelf();t.bg.alpha=0;Laya.Tween.to(t.ysani,{scaleX:0,scaleY:0,x:i.x,y:i.y-game.Context.mainRole.getModelHeight()+20},1e3,null,Laya.Handler.create(t,t.onClose),500)}))});this.boom.play(0,false);this.ysani.play(0,true)};e.SINGLE_KEY="talk.YuanshenStoryView";return e}(Laya.View);t.YuanshenStoryView=e})(talk||(talk={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var game;(function(l){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t._isPlayTaskCompleteAni=true;return t}t.prototype.init=function(){app.ViewManager.regist(task.TaskMainView,"zhuxianrenwu.atlas");l.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.TASK_MAIN,task.TaskMainView,null,2);app.ViewManager.regist(task.TaskMainView2,"zhuxianrenwu.atlas");l.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.HLXD_JINGYING,task.TaskMainView2,null,2);this._weekIndex=0};t.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.TaskInfoNtf,this,this.onTaskInfoNtf);this.addMsgListener(app.ProtocolResponse.TaskRecordNtf,this,this.onTaskRecordNtf);this.addMsgListener(app.ProtocolResponse.UpdateTaskRecordNtf,this,this.onUpdateTaskRecordNtf);this.addMsgListener(app.ProtocolResponse.TaskSubmitAck,this,this.onTaskSubmitAck);this.addMsgListener(app.ProtocolResponse.TaskGiveUpAck,this,this.onTaskGiveUpAck);this.addMsgListener(app.ProtocolResponse.SubQuestItemAck,this,this.onSubQuestItemAck);guide.GuideModel.getIns().on(guide.GuideModel.GUIDE_TASK_END,this,this.onTaskGuideEnd)};t.prototype.onTaskGuideEnd=function(t){var e=l.TaskModel.getIns().getTaskData(t);if(e&&e.subType==csv.TaskProxy.SUBTYPE.CLIENT){app.ProtocolRequest.GuideTaskReq(t)}};t.prototype.onSubQuestItemAck=function(t,e){if(e.result){}};t.prototype.onTaskInfoNtf=function(t,e){l.TaskModel.getIns().setList(e.taskList);l.TaskModel.getIns().totalWeek=e.totalWeek;l.TaskModel.getIns().weekIndex=e.weekIndex+1;if(this._weekIndex!=l.TaskModel.getIns().weekIndex){this._weekIndex=l.TaskModel.getIns().weekIndex}csv.FunctionsProxy.getIns().initTaskState();l.TaskModel.getIns().setMainTask();l.TaskModel.getIns().event(l.TaskModel.EVENTS.TASK_REFRESH);manager.LoadingManager.instance.removeGameLoading("onTaskInfoNtf")};t.prototype.onTaskRecordNtf=function(t,e){for(var i=0,n=e.taskList.length;i<n;++i){var a=e.taskList[i];l.TaskModel.getIns().setRecordList(a.questIndex,a.questCount)}};t.prototype.onUpdateTaskRecordNtf=function(t,e){l.TaskModel.getIns().setRecordList(e.taskInf[0].questIndex,e.taskInf[0].questCount)};t.prototype.onTaskSubmitAck=function(t,e){if(csv.FunctionsProxy.getIns().taskMap[e.taskIndex]){var i=csv.FunctionsProxy.getIns().taskMap[e.taskIndex];if(i){var n=[];for(var a=0;a<i.length;a++){var o=i[a];if(csv.FunctionsProxy.getIns().isOpen(o)){n.push(o)}}l.Context.funcOpenIds=n;main.FuncOpenView.onshowFuncOpenView()}}if(this._isPlayTaskCompleteAni){}this._isPlayTaskCompleteAni=true;var s=csv.TaskProxy.getIns().getCfg(e.taskIndex);if(s){if(s.type==csv.TaskProxy.TYPE.SILVER||s.type==csv.TaskProxy.TYPE.LILIAN_DAILY){achievement.AchievementView.getIns().onAwardAchieveAck(e.taskIndex)}if(csv.FunctionsProxy.getIns().isOpen(csv.FunctionsProxy.ENUMS.SHOU_CHONG)){var r=csv.TaskProxy.getIns().getCfg(s.next_id);if(r&&r.task_id==l.Config.getIntParams(1210)){l.ClosureManager.callFunction(csv.FunctionsProxy.ENUMS.SHOU_CHONG)}}}};t.prototype.onTaskGiveUpAck=function(t,e){};t.SINGLE_KEY="game.TaskModule";return t}(app.ModuleBase);l.TaskModule=t})(game||(game={}));var task;(function(t){var e=function(){function t(){}return t}();t.DailyTaskAwardVo=e})(task||(task={}));var task;(function(t){var e=function(){function t(){}return t}();t.DailyTaskViewVo=e})(task||(task={}));var task;(function(i){var t=function(){function t(){}t.jump=function(t,e){switch(t){case 1:app.ViewManager.toggleDialog(i.PopStoneView,1,1,e);break}};return t}();i.MiniGameControl=t})(task||(task={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var task;(function(i){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.fullScreen="fullScreen";t.noCloseAll="noCloseAll";t.boNext=false;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.quedingbtn.on(Laya.Event.CLICK,this,this.onLeaveClick);this.closebtn.on(Laya.Event.CLICK,this,this.onLeaveClick);this.xiacengbtn.on(Laya.Event.CLICK,this,this.onNextClick);this.daojulist.itemRender=grids.GridView;this.daojulist.renderHandler=grids.GridView.RenderWithoutGetWay;this.touxiang.on(Laya.Event.COMPLETE,this,this.aniStop);this.aniStop();this.manager=battle.BattleManager.getIns()};t.prototype.aniStop=function(){this.touxiang.stop();this.touxiang.visible=false};t.prototype.onLeaveClick=function(){this.leave(false)};t.prototype.onNextClick=function(){this.leave(this.boNext)};t.prototype.leave=function(t){app.ViewManager.toggleDialog(i.PopStoneView,-1,0);Laya.timer.clear(this,this.loopFreshTime);app.ViewManager.toggleDialog(i.MiniGameResultView,-1,0);if(t){app.ProtocolRequest.TaskTowerReq();main.RoundPassView.getIns().show()}else{if(this.miniGame){i.MiniGameControl.jump(this.miniGame,this._nextZxrwCfg)}}};t.prototype.onDisplay=function(){app.ViewManager.showDialogMask();util.SkUtil.setWinSkt(this.imgwofang);util.AniUtil.startCircle(this.beijingguang);app.SoundManager.getIns().playSound("win");this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){app.ViewManager.closeDialogMask();util.AniUtil.stopCircle(this.beijingguang);Laya.timer.clearAll(this);guide.GuideItem2.getIns().hide();this.aniStop()};t.prototype.onTweenEnd=function(t,e){this.dengjilab.text=app.getLang("family_build_1",game.Context.teamLv);this.touxiang.play(0,false);this.touxiang.visible=true;this.jindutiao.value=0;Laya.Tween.to(this.jindutiao,{value:t,update:new Laya.Handler(this,this.onExpUpdate,[e,0])},1e3,Laya.Ease.quartOut);if(game.Context.teamlvOld>0){game.Context.teamlvOld=0}};t.prototype.onExpUpdate=function(t,e){var i,n;if(e>0){i=Math.floor(this.jindutiao.value*e);n=e}else{i=Math.floor(this.jindutiao.value*t);n=t}this.shuzhilab.text=i+"/"+n};t.prototype._creatAwardArr=function(){var n=[];var t=this.dataSource.award_item.split(";");t.map(function(t){var e=t.split("-");var i=new ItemData;i.itemID=+e[0];i.value=+e[1];n.push(i)});return n};t.prototype.refreshAll=function(){var t=0,e=0;this.txtAdd.text="";this.touxingimg.skin=csv.MyTeamProxy.getIns().getTeamIcon(game.Context.teamAvatar);this.touxiangkuangimg.skin=game.RoleModel.getIns().getHeadFrameIcon();var i=game.ItemUtil.hebingItems(this._creatAwardArr());var n=[];for(var a=0,o=i.length;a<o;a++){if(i[a].itemID==game.ItemUtil.ENUMS.PET_EXP_ITEM){continue}n.push(i[a])}if(csv.FunctionsProxy.getIns().isOpen(csv.FunctionsProxy.ENUMS.PET_LIST)){game.ItemUtil.flowMsg(i,game.ItemUtil.ENUMS.PET_EXP_ITEM)}var s=0;for(var a=0;a<n.length;a++){if(n[a].itemID==8024&&n[a].value>0){s=n[a].value;this.txtAdd.text=app.getLang("+{0}",n[a].value);break}}t=csv.MyTeamProxy.getIns().getTeamMaxExp(game.Context.teamLv);var r=game.Context.teamExp/t;if(game.Context.teamlvOld==0){this.dengjilab.text=app.getLang("family_build_1",game.Context.teamLv);this.jindutiao.value=(game.Context.teamExp-s)/t;Laya.Tween.to(this.jindutiao,{value:r,update:new Laya.Handler(this,this.onExpUpdate,[t,e])},1e3,Laya.Ease.quartOut)}else{this.dengjilab.text=app.getLang("family_build_1",game.Context.teamLv-1);e=csv.MyTeamProxy.getIns().getTeamMaxExp(game.Context.teamLv-1);this.jindutiao.value=(e-s+game.Context.teamExp)/e;Laya.Tween.to(this.jindutiao,{value:1,update:new Laya.Handler(this,this.onExpUpdate,[t,e])},1e3,Laya.Ease.quartOut,new Laya.Handler(this,this.onTweenEnd,[r,t]))}if(this.dataSource.bigaward){var l=this.dataSource.bigaward.split("-");n.push({itemID:+l[0],value:+l[1]})}this.daojulist.array=game.ItemUtil.getAwardItem([],n);var h=this.dataSource.id;this.labeltiaojian.text="";this.updateHLXDView(h);this.startLoop()};t.prototype.updateHLXDView=function(t){var e=csv.DungeonProxy.getIns().getZxrwCfg(t);this._nextZxrwCfg=csv.DungeonProxy.getIns().getZxrwCfg(t+1);if(e.type==1){this.tongguanlab.text=app.getLang("jiesuan_zhuxian_1",e.chapter,e.title,e.round)}else{this.tongguanlab.text=app.getLang("jiesuan_zhuxian_2",e.chapter,e.title,e.round)}var i=csv.DungeonProxy.getIns().getZxrwCfg(t+1);if(i){var n=game.Context.isTeamLvReach(i.teamlevel,false);this.miniGame=i.battletype;this.boNext=this.miniGame==0&&i.chapter==e.chapter&&n}else{this.boNext=false;this.miniGame=0}if(this.boNext){this.quedingbtn.label=app.getLang("jiesuan_queding2");this.xiacengbtn.label=app.getLang("jiesuan_yongzhe_2",this.manager.currControl.closeCd);this.quedingbtn.visible=true;this.xiacengbtn.x=412;if(i.id<=game.Config.getIntParams(915)){Laya.timer.once(300,this,this.showGuide)}}else{this.xiacengbtn.label=app.getLang("jiesuan_queding",this.manager.currControl.closeCd);this.quedingbtn.visible=false;this.xiacengbtn.x=293;if(i){var n=game.Context.isTeamLvReach(i.teamlevel,false);if(!n){this.labeltiaojian.text=app.getLang("zhuxian_2",i.teamlevel)}}}if(dailytask.DailyTaskModel.getIns().taskMainId==csv.DungeonProxy.getIns().maxOpenNum-1){var a=csv.FunctionsProxy.getIns().getCfg(csv.FunctionsProxy.ENUMS.HLXD_JINGYING);main.FuncOpenView.add(a)}if(e.bigaward!=""){var o=game.ItemUtil.parserList(e.bigaward)[0];game.NoticeManager.getIns().flowMsg(csv.ItemProxy.getTipHtmlName(o.getItemId())+"<span>x"+o.count+"</span>",o.getIconUrl())}};t.prototype.showGuide=function(){var t=this.xiacengbtn.parent.localToGlobal(new Laya.Point(this.xiacengbtn.x,this.xiacengbtn.y));guide.GuideItem2.getIns().add(this.xiacengbtn,2,t.x,t.y,this.xiacengbtn.width,this.xiacengbtn.height,true)};t.prototype.startLoop=function(){this._startTime=5;Laya.timer.loop(1e3,this,this.loopFreshTime);this.loopFreshTime()};t.prototype.loopFreshTime=function(){this._startTime-=1;if(this._startTime>0){if(this.boNext){this.xiacengbtn.label=app.getLang("jiesuan_yongzhe_2",this._startTime)}else{this.xiacengbtn.label=app.getLang("jiesuan_queding",this._startTime)}}else{this.leave(this.boNext)}};t.SINGLE_KEY="task.MiniGameResultView";return t}(ui.jiesuan.zhuxianrenwujiesuannewUI);i.MiniGameResultView=t})(task||(task={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var task;(function(n){var t=function(i){__extends(t,i);function t(){var t=i!==null&&i.apply(this,arguments)||this;t.fullScreen="fullScreen";return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){i.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);var t=+game.Config.getParams(2e3);var e=+game.Config.getParams(2001);this._powerBar=new n.PowerBar(this.zhezhao,this.img2,this.hege,e,t,new Laya.Handler(this,this._endCallBack));this.beijin.on(Laya.Event.CLICK,this,this.onClick);this.anniu1.on(Laya.Event.CLICK,this,this.onClick1);this.anniu2.on(Laya.Event.CLICK,this,this.onClick2);this.fanhui.on(Laya.Event.CLICK,this,this.onClick1)};t.prototype.onDisplay=function(){guide.GuideModel.getIns().boOpen=false;this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){guide.GuideModel.getIns().boOpen=true;Laya.timer.clearAll(this);Laya.timer.clear(this,this._timeLoopHander);this.ani1.stop();this.ani2.stop();this.ani2_0.stop();this.ani2_1.play(0);this.playGuildEff(false)};t.prototype.refreshAll=function(){var t=this;this.img1.visible=true;this._cfg=this.dataSource;this.ani3.play(0);this.ani4.play(0);this.menimg.skin="res/static/xiaoyouxi/bg_game_bg_3.png";this._powerBar.init();this.gameTime=60;this.zhezhao.height=404;var e=+game.Config.getParams(2e3);this.hege.y=477+(404*e-30/2);this.daojishi.text=this.gameTime+"秒";this.beijin.mouseEnabled=false;this.daojishi.visible=false;Laya.timer.once(500,this,function(){t._flowerTime()})};t.prototype._flowerTime=function(){var t=this;Laya.timer.callLater(this,function(){t.ani1.play(0,false)});this.anniu1.visible=false;this.anniu2.visible=false;Laya.timer.once(3e3,this,this._startGame)};t.prototype._startGame=function(){var t=this;Laya.timer.loop(1e3,this,this._timeLoopHander);this._powerBar.start();var e=+game.Config.getParams(2e3);Laya.timer.once(500,this,function(){t.playGuildEff(true);t.aniEff.visible=false;Laya.timer.loop(300,t,function(){if(t.zhezhao.height<=t.img2.height*e){t.aniEff.visible=true}else{if(t.aniEff){t.aniEff.visible=false}}})});this.beijin.mouseEnabled=true};t.prototype._timeLoopHander=function(){this.anniu2.mouseEnabled=true;this.gameTime-=1;if(this.gameTime<=0){this.daojishi.visible=false;Laya.timer.clear(this,this._timeLoopHander);this._powerBar.init();this.anniu1.visible=true;this.anniu2.visible=true;this.ani2_1.stop();this.dengjiu.visible=true;this.ani2_2.play(0,false);this.beijin.mouseEnabled=false}else{this.daojishi.visible=true;this.daojishi.text=this.gameTime+"秒"}};t.prototype._endCallBack=function(){var t=this;this.anniu2.mouseEnabled=true;this.ani2_1.stop();this.img1.visible=false;var e=+game.Config.getParams(2e3);if(this.zhezhao.height<=this.img2.height*e){this.chengogngimg.visible=true;this.ani2.play(0,false);this.win()}else{this.ani2_0.play(0,false);this.lose();Laya.timer.once(2e3,this,function(){t.anniu1.visible=true;t.anniu2.visible=true})}};t.prototype.win=function(){var t=this;app.ProtocolRequest.TaskTowerReq();Laya.timer.once(3e3,this,function(){app.ViewManager.toggleDialog(n.MiniGameResultView,1,0,t.dataSource)})};t.prototype.lose=function(){};t.prototype.onClick=function(){this.playGuildEff(false);this._powerBar.end();this.daojishi.visible=false;this.beijin.mouseEnabled=false;Laya.timer.clear(this,this._timeLoopHander)};t.prototype.onClick1=function(){app.ViewManager.toggleDialog(n.PopStoneView,-1,0)};t.prototype.onClick2=function(){this.zhezhaoimg.alpha=100;this.zhezhaoimg.visible=true;this.anniu2.mouseEnabled=false;Laya.Tween.to(this.zhezhaoimg,{alpha:0},1500,null,new Laya.Handler(this,this._againStartGame))};t.prototype._againStartGame=function(){Laya.timer.clear(this,this._timeLoopHander);this.ani1.stop();this.ani2.stop();this.ani2_0.stop();this.ani2_1.play(0);this.refreshAll()};t.prototype.playGuildEff=function(t){if(!this.aniEff){this.aniEff=new game.AniView;this.aniEff.x=this.width/2;this.aniEff.y=this.height/2;this.aniEff.load("skill_xuanzhong01",game.AniView.FILE_NAME.UI);this.aniEff.mouseEnabled=false}if(t){this.aniEff.play();this.aniEff.visible=true;this.addChild(this.aniEff)}else{this.aniEff.stop();this.aniEff.visible=false;this.aniEff.removeSelf()}};t.SINGLE_KEY="task.PopStoneView";return t}(ui.xiaoyouxi.zhuxianxiaoyouxiUI);n.PopStoneView=t;var e=function(r){__extends(t,r);function t(t,e,i,n,a,o){var s=r.call(this)||this;s.speedTime=1;s.ratioValue=.5;s.zhezhao=t;s.barImage=e;s.rule=i;s.callBack=o;s.speedTime=n;s.ratioValue=a;return s}t.prototype.init=function(){Laya.Tween.clearTween(this.zhezhao);this.zhezhao.height=this.barImage.height;this.rule.y=this.barImage.y+(this.barImage.height*this.ratioValue-this.rule.height/2)};t.prototype.start=function(){this.init();this.imgTween1()};t.prototype.end=function(){Laya.Tween.clearTween(this.zhezhao);if(this.callBack){this.callBack.run()}};t.prototype.imgTween1=function(){Laya.Tween.to(this.zhezhao,{height:this.barImage.height},this.speedTime,null,new Laya.Handler(this,this.imgTween2))};t.prototype.imgTween2=function(){Laya.Tween.to(this.zhezhao,{height:0},this.speedTime,null,new Laya.Handler(this,this.imgTween1))};return t}(Laya.EventDispatcher);n.PowerBar=e})(task||(task={}));var task;(function(t){var e=function(){function t(){}t.doTask=function(t){switch(t.subType){case csv.TaskProxy.SUBTYPE.TALK:if(battle.BattleModel.getIns().checkBattleState(true)){return}if(t.cfg.npc_id=="0"){app.ProtocolRequest.TaskNpcTalk(t.cfg.npc_id,t.cfg.task_id)}else{role.LeadingRoleView.getIns().aiTalk(csv.NpcProxy.getIns().getNpcVO(t.cfg.npc_id),ai.NpcTalkAI.ENUM_TYPE.STORY,t)}break;case csv.TaskProxy.SUBTYPE.MONSTER_KILL:case csv.TaskProxy.SUBTYPE.MONSTER_KILL_2:case csv.TaskProxy.SUBTYPE.MONSTER_KILL_3:app.ProtocolRequest.QuestKillReq(t.cfg.task_id);break;case csv.TaskProxy.SUBTYPE.MONSTERKILL_GET_ITEM:if(battle.BattleModel.getIns().checkBattleState(true)){return}if(t.cfg.client_params==""){return}var e=csv.GuajiProxy.getIns().getCfg(t.cfg.client_params);var i=app.str2Array(e.level,"-");if(e&&game.Context.isRoleReach(true,i[0],i[1],"dujie_open_error")&&csv.GuajiProxy.getIns().isDungeonReach(e.sceneid,true)){app.ProtocolRequest.GuajiReq(e.sceneid)}break;case csv.TaskProxy.SUBTYPE.SUBMIT_ITEM:break;case csv.TaskProxy.SUBTYPE.ZHUAN_ZHI:if(battle.BattleModel.getIns().checkBattleState(true)){return}var n=csv.NpcProxy.getIns().getNpcVO(parseInt(t.cfg.npc_id));role.LeadingRoleView.getIns().aiTalk(n,ai.NpcTalkAI.ENUM_TYPE.DIALOG,rebirth.ReBirthTeamView,[t.cfg.task_id]);Laya.Dialog.closeAll();break;case csv.TaskProxy.SUBTYPE.CLIENT:if(!t.cfg.client_submit){app.ProtocolRequest.GuideTaskReq(t.cfg.task_id)}break;case csv.TaskProxy.SUBTYPE.CHAT:Laya.Dialog.closeAll();app.ViewManager.toggleDialog(chat.ChatView,1,0,[app.getLang(game.Config.getParams(641))]);break;default:this.showView(t.cfg.client_params);break}};t.showView=function(t){if(t.indexOf("-")>=0){var e=parseInt(app.str2Array(t,"-")[0]);game.ClosureManager.callFunction(e,true,false,app.str2Array(t,"-")[1])}else{game.ClosureManager.callFunction(parseInt(t))}};t.taskGetHandler=new Laya.Handler(t,t.doTask);return t}();t.TaskManager=e})(task||(task={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var game;(function(u){var t=function(t){__extends(s,t);function s(){return t!==null&&t.apply(this,arguments)||this}s.getIns=function(){return app.Singleton.getInstance(s)};s.prototype.init=function(){this.recordList=[];this.taskNpcs=[]};s.prototype.setList=function(t){this.list=[];this.listLilian=[];var e=this.taskNpcs;var i=this.taskNpcs={};for(var n=0;n<t.length;++n){var a=csv.TaskProxy.getIns().getCfg(t[n].questIndex);if(!a){console.error("配置表task中没有id = "+t[n].questIndex+"的数据!")}var o=task.TaskDataAdapter.init(t[n]);if(o.type==csv.TaskProxy.TYPE.SILVER||o.type==csv.TaskProxy.TYPE.LILIAN_DAILY){this.listLilian.push(o)}this.list.push(o);if(o.data.questSate===1){if(csv.TaskProxy.getSubType(o.cfg)===task.NpcTalkAdapter.SUB_TYPE){if(!i[csv.TaskProxy.getCompleteNpcId(o.cfg)]&&csv.TaskProxy.getCompleteNpcId(o.cfg)){i[csv.TaskProxy.getCompleteNpcId(o.cfg)]=o.data.questSate}}else if(csv.TaskProxy.getActiveNpcId(o.cfg)){if(!i[csv.TaskProxy.getActiveNpcId(o.cfg)]){i[csv.TaskProxy.getActiveNpcId(o.cfg)]=o.data.questSate}}}if(o.data.questSate===2&&csv.TaskProxy.getCompleteNpcId(o.cfg)){i[csv.TaskProxy.getCompleteNpcId(o.cfg)]=o.data.questSate}}for(var s in e){if(!i.hasOwnProperty(s)){this.event(u.TaskModel.EVENTS.TASK_NPC_STATE_CHANGE,s)}}for(var s in i){if(i[s]!=e[s]){this.event(u.TaskModel.EVENTS.TASK_NPC_STATE_CHANGE,s)}}if(this.awardExp==1){var r=new TaskData;r.questIndex=99999;var l=new task.TaskDataAdapter(r);l.awardType=1;this.list.push(l)}if(this.awardSilver==1){var h=new TaskData;h.questIndex=99998;var p=new task.TaskDataAdapter(h);p.awardType=2;this.list.push(p)}this.list.sort(this.sortTask);this.listLilian.sort(this.lilianSort)};s.prototype.setMainTask=function(){var t=s.getIns();var e=t.getTasksByType(csv.TaskProxy.TYPE.MAIN);var i;for(var n=0,a=e.length;n<a;n++){i=e[n];if(e[n].data.questSate!=3){break}}if(i&&this.currMainTask&&i.data.questSate==2&&this.currMainTask.data.questSate!=i.data.questSate){if(!app.ViewManager.DisplayedInStage(main.TaskMainEnterView.SINGLE_KEY)){var o=app.getLang(i.cfg.name)+app.getLang('<span color = "{0}">（已完成）</span>',u.STYLES.GREEN_COLOR_S);app.ViewManager.toggleView(main.TaskMainCompleteView,app.AppContainer.zhezhaoLayer,1,o)}}this.currMainTask=i;if(i&&(i.data.questSate==2||i.data.questSate==1&&!i.cfg.action)){this.event(u.TaskModel.EVENTS.TASK_MAIN_GUIDE)}this.event(u.TaskModel.EVENTS.TASK_MAIN_REFRESH)};s.prototype.getTasksByType=function(e){return this.list.filter(function(t){return t.type==e})};s.prototype.getLilianTask=function(){return this.listLilian};s.prototype.lilianSort=function(t,e){if(t.data.questSate==2&&e.data.questSate!=2){return-1}if(t.data.questSate!=2&&e.data.questSate==2){return 1}if(t.cfg.sign>e.cfg.sign){return-1}if(t.cfg.sign<e.cfg.sign){return 1}if(t.data.questIndex<e.data.questIndex){return-1}if(t.data.questIndex>e.data.questIndex){return 1}return 0};s.prototype.getCompleteTask=function(t){var e=this.getTasksByType(t);for(var i in e){if(e[i].data.questSate==2){return true}}return false};s.prototype.sortTask=function(t,e){if(t.type==e.type){return 0}if(t.type==1){return-1}if(e.type==1){return 1}if(t.type==2){return-1}if(e.type==2){return 1}if(t.type==3){return-1}if(e.type==3){return 1}if(t.type==4){return-1}if(e.type==4){return 1}if(t.type==6){return-1}if(e.type==6){return 1}if(t.type==7){return-1}if(e.type==7){return 1}return t.type-e.type<0?-1:1};s.prototype.getTaskData=function(t){for(var e=0;e<this.list.length;++e){if(this.list[e].data.questIndex==t){return this.list[e]}}return undefined};s.prototype.setRecordList=function(t,e){this.recordList[t]=e};s.prototype.hasCompleteTask=function(t){return!!this.recordList[t]};s.prototype.getTaskGroupIndex=function(t){var e=csv.TaskProxy.getIns().getCfg(t);var i=1;while(e.front_id!=0){e=csv.TaskProxy.getIns().getCfg(e.front_id);i++}return i};s.SINGLE_KEY="game.TaskModel";s.EVENTS={TASK_REFRESH:"task_refresh",TASK_NPC_STATE_CHANGE:"TASK_NPC_STATE_CHANGE",TASK_PANE_SELECTINDEX:"TASK_PANE_SELECTINDEX",TASK_LIAN_REFRESH:"TASK_LIAN_REFRESH",TASK_MAIN_REFRESH:"TASK_MAIN_REFRESH",TASK_MAIN_GUIDE:"TASK_MAIN_GUIDE"};return s}(app.ModelBase);u.TaskModel=t})(game||(game={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("task.csv");var e=t.getArray();this.firstId=parseInt(e[0].task_id);this.cfgMap=t.getMap("task_id");this.taskCfgList=e};e.prototype.getTaskCfgByType=function(t){var e=[];for(var i=0;i<this.taskCfgList.length;i++){if(this.taskCfgList[i].type==parseInt(t)){e.push(this.taskCfgList[i])}}return e};e.prototype.getCfg=function(t){return this.cfgMap[t]};e.prototype.getNextCfg=function(t){var e=this.getCfg(t);if(e&&e.next_id){return this.getCfg(e.next_id)}return null};e.prototype.getShowOneSubType=function(){if(!this._showOneSubTypeArr){var t=game.Config.getParams(game.ConfigID.TASK_TYPE_NO_COUNT);this._showOneSubTypeArr=app.str2Array(t,";")}return this._showOneSubTypeArr};e.formatCfg=function(t){if(typeof t=="number"){t=e.getIns().getCfg(t)}else if(typeof t=="string"){t=e.getIns().getCfg(parseInt(t))}return t};e.getSubType=function(t){t=e.formatCfg(t);return parseInt(t.subtype)};e.getCompleteNpcId=function(t){t=e.formatCfg(t);return parseInt(t.complete_npc_id)};e.getActiveNpcId=function(t){t=e.formatCfg(t);return parseInt(t.dialogue_npcid)};e.getType=function(t){t=e.formatCfg(t);return parseInt(t.type)};e.getTaskName=function(t){t=e.formatCfg(t);if(!t){console.log("任务配置没取到");return""}return app.getLang(t.name)};e.prototype.getShowMainTask=function(t){var e=this.getCfg(t);if(e.itemshow==""){if(e.next_id){return this.getShowMainTask(e.next_id)}}return e};e.prototype.getShowMainTaskCount=function(t,e){if(e===void 0){e=1}var i=this.getCfg(t);if(i.itemshow==""){if(i.next_id){e++;return this.getShowMainTaskCount(i.next_id,e)}}else{var n=app.str2Array(i.itemshow,";");if(n.length<3){if(i.next_id){e++;return this.getShowMainTaskCount(i.next_id,e)}}}return e};e.SINGLE_KEY="csv.TaskProxy";e.SUBTYPE={TALK:1,MONSTER_KILL:2,SUBMIT_ITEM:3,MAIN_TASK:4,ROLE_NUM:5,TANRS_LVL:6,TOTAL_LVL:7,ALIVE_SKILL_NUM:8,UP_SKILL_NUM:9,TOTAL_STREN:10,TODAY_STREN:11,WEAR_QUA_EQUIP:12,TOTAL_SMELT:13,TODAY_SMELT:14,CHAT:42,CLIENT:48,MONSTERKILL_GET_ITEM:49,ZHUAN_ZHI:59,GET_GOLD:122,GET_MONEY:123,GET_POSTION:170,MONSTER_KILL_2:188,MONSTER_KILL_3:243};e.TYPE={MAIN:1,GUILD:2,SILVER:3,LILIAN_DAILY:4,TANRS:5,HUANXING:6,MEDAL:7,ZHAN_LIN:9};return e}(app.ModelBase);t.TaskProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var task;(function(i){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.blackArr=[];t.selectArr=[];t.lineArr=[];t.titleArr=[];return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.dituMask=new Laya.Sprite;this.shoucilist.itemRender=grids.GridView;this.shoucilist.renderHandler=grids.GridView.CommonItemRender;this.centerMediator=new game.CenterLayoutMediator(this.shoucilist,this.tiaozhanbox,96,10);this.tiaozhanbtn.on(Laya.Event.CLICK,this,this.onBattle);this.lblGoto.on(Laya.Event.LINK,this,this.onHandler);this.lblGoto.color="#ff0000";var t=app.str2Array(game.Config.getParams(1286),";");this.state=parseInt(t[0]);this.cd=parseInt(t[1]);this.loop=parseInt(t[2]);this.huluxiongdi.imgwa.on(Laya.Event.CLICK,this,this.onRoleClick);this.hitArea=new Laya.Rectangle(this.huluxiongdi.x,this.huluxiongdi.y,this.width-this.huluxiongdi.x,this.height-this.huluxiongdi.y);guide.GuideModel.getIns().register(csv.GuideProxy.ENUM_VIEW.ZXRW_BATTLE,this.tiaozhanbtn);guide.GuideModel.getIns().register(csv.GuideProxy.ENUM_VIEW.ZHUXIAN_LEFT_ROLE,this.huluxiongdi)};t.prototype.onHandler=function(t){if(t){chat.ChatStatic.dellLink(t)}};t.prototype.onBattle=function(){if(battle.BattleModel.getIns().checkBattleState(true)){return}if(this.currEle.battletype){i.MiniGameControl.jump(this.currEle.battletype,this.currEle);return}app.ProtocolRequest.TaskTowerReq()};t.prototype.playGuildEff=function(t){if(!this.aniEff){this.aniEff=new game.AniView;this.aniEff.x=this.tiaozhanbtn.x+this.tiaozhanbtn.width/2;this.aniEff.y=this.tiaozhanbtn.y+this.tiaozhanbtn.height/2;this.aniEff.load("skill_xuanzhong01",game.AniView.FILE_NAME.UI)}if(t){this.aniEff.play();this.aniEff.visible=true;this.tiaozhanbox.addChild(this.aniEff)}else{this.aniEff.stop();this.aniEff.visible=false;this.aniEff.removeSelf()}};t.prototype.onDisplay=function(){this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){this.clearAll();this.playGuildEff(false);this.huluxiongdi.dianji.stop();Laya.timer.clear(this,this.closeTip);Laya.timer.clear(this,this.openTip)};t.prototype.refreshAll=function(){if(this.dataSource[0]=="levelup"){this.playGuildEff(true)}var t;var e;var i;var n=dailytask.DailyTaskModel.getIns().taskMainId;i=csv.DungeonProxy.getIns().getZxrwTypeCfg(1,n+1);if(!i){i=csv.DungeonProxy.getIns().getZxrwTypeCfg(1,csv.DungeonProxy.getIns().maxOpenNum-1);t=parseInt(i.chapter);e=parseInt(i.round)+1}else{t=parseInt(i.chapter);e=parseInt(i.round)}this.guanshulab.text=app.getLang("dungeon_title",i.chapter,app.getLang(i.title));var a="res/static/zhuxianrenwu/"+i.film+".jpg";this.ditu.skin=this.dituhui.skin=a;var o=csv.DungeonProxy.getIns().getZxrwTypeArr(1,t);Laya.loader.load(a,Laya.Handler.create(this,this.createZhe,[e,o]));var s;for(var r=0,l=o.length;r<l;r++){var h=o[r];var p=parseInt(h.round);if(e==p){s=h;break}}this.currEle=s;if(s){this.tiaozhanbox.visible=true;this.tongguanimg.visible=false;var u=true;var c=[];var g=game.ItemUtil.parserList(s.award_item);for(var r=0,l=g.length;r<l;r++){if(g[r].getItemId()==88001){continue}c.push(g[r])}this.centerMediator.array=c;if(game.Context.isTeamLvReach(s.teamlevel,false)){if(parseInt(s.taskid)){if(game.TaskModel.getIns().hasCompleteTask(s.taskid)){u=true}else{u=false;this.lblGoto.text=app.getLang("func_er_6",csv.TaskProxy.getTaskName(s.taskid))}}}else{u=false;this.lblGoto.text=app.getLang("huluxiongdi_needlevel",s.teamlevel)}this.lblGoto.visible=!u;this.tiaozhanbtn.visible=u;var f=o[o.length-1];if(f){var d=game.ItemUtil.parserList(f.bigaward)[0];this.imgdaoju.setData(d)}}else{this.tiaozhanbox.visible=false;this.tongguanimg.visible=true}this.showUnlock()};t.prototype.showUnlock=function(){var t=game.Context.roleList.length;if(t<7){var e=t+1;var i=csv.DefclassProxy.getIns().getCfg(e);this.huluxiongdi.imgwa.skin="res/static/zhuxianrenwu/bg_huluxiongdi_"+i.createname+".png";if(game.RoleModel.getIns().checkAddRoleCondiion(e)){this.huluxiongdi.dianji.play();this.huluxiongdi.dianji.visible=true;this.qipao.dawa.visible=false;this.qipao.imgkejiesuo.visible=true;this.roleState=1}else{this.huluxiongdi.dianji.stop();this.huluxiongdi.dianji.visible=false;this.qipao.dawa.visible=true;this.qipao.imgkejiesuo.visible=false;this.qipao.tishi1.skin="res/static/zhuxianrenwu/bg_tips_"+i.createname+".png";var n=csv.DefclassProxy.getIns().getCfgCreate(e);if(n&&n.type==1){var a=csv.DungeonProxy.getIns().getZxrwCfg(n.value);this.qipao.jibie1.value=a.teamlevel;this.qipao.zhangjie1.value=a.chapter}this.roleState=2}this.openTip()}else{this.huluxiongdi.visible=false;this.qipao.visible=false;this.huluxiongdi.dianji.stop();this.huluxiongdi.dianji.visible=false;this.roleState=0}};t.prototype.onRoleClick=function(){if(this.roleState==1){app.ViewManager.toggleView(role.RoleCreateView,app.AppContainer.talkLayer,1)}else if(this.roleState==2){game.RoleModel.getIns().onShowRoleUnlockView()}};t.prototype.openTip=function(){this.qipao.ani2.play(0,false);if(this.state){Laya.timer.once(this.loop,this,this.closeTip)}};t.prototype.closeTip=function(){this.qipao.ani1.play(0,false);if(this.state){Laya.timer.once(this.cd,this,this.openTip)}};t.prototype.createZhe=function(t,e){this.dituMask.graphics.clear();for(var i=0,n=e.length;i<n;i++){var a=e[i];var o=parseInt(a.round);var s=this.getPoints(a.cutline);this.drawLines(s);if(o<t){this.createTitle(a,s[0],s[1])}else if(o==t){this.createTitle(a,s[0],s[1],true);this.drawShines(s);this.playShine()}else{this.createTitle(a,s[0],s[1]);continue}this.dituMask.graphics.drawPoly(0,0,s,0)}this.ditu.mask=this.dituMask};t.prototype.createTitle=function(t,e,i,n){if(n===void 0){n=false}var a=new ui.zhuxianrenwu.guanshuitemUI;a.x=this.ditu.x+e+5;a.y=this.ditu.y+i+5;a.guanshuclip.value=t.chapter+"-"+t.round;a.xinimg.visible=n;this.addChild(a);this.titleArr.push(a)};t.prototype.drawLines=function(t){var e=t.length/2;for(var i=0;i<e-1;i++){var n=Math.atan2(t[(i+1)*2+1]-t[i*2+1],t[(i+1)*2]-t[i*2])/Math.PI*180;var a=new Laya.Point(t[i*2],t[i*2+1]).distance(t[(i+1)*2],t[(i+1)*2+1]);var o=new Laya.Image;o.anchorY=.5;o.skin="zhuxianrenwu/bg_zhuxianrenwu_fenge.png";o.x=this.ditu.x+t[i*2];o.y=this.ditu.y+t[i*2+1];o.width=a;o.rotation=n;this.lineArr.push(o);this.addChild(o)}};t.prototype.drawShines=function(t){var e=t.length/2;for(var i=0;i<e-1;i++){var n=Math.atan2(t[(i+1)*2+1]-t[i*2+1],t[(i+1)*2]-t[i*2])/Math.PI*180;var a=new Laya.Point(t[i*2],t[i*2+1]).distance(t[(i+1)*2],t[(i+1)*2+1]);var o=new Laya.Image;o.anchorY=1;o.skin="zhuxianrenwu/bg_zhuxianrenwu_zhezhao.png";o.sizeGrid="0,60,0,60";o.x=this.ditu.x+t[i*2];o.y=this.ditu.y+t[i*2+1];o.width=a;o.rotation=n;this.selectArr.push(o);this.addChild(o)}};t.prototype.getPoints=function(t){var e=[];var i=app.str2Array(t,";","-");for(var n=0;n<i.length;n++){var a=i[n];e.push(parseInt(a[0])/100*this.ditu.width);e.push(parseInt(a[1])/100*this.ditu.height)}return e};t.prototype.playShine=function(){var t=function(t,e){var i=n.selectArr[t];i.alpha=1;Laya.Tween.to(i,{alpha:.5},500,null,Laya.Handler.create(n,function(){Laya.Tween.to(i,{alpha:1},500)}))};var n=this;for(var e=0,i=this.selectArr.length;e<i;e++){t(e,i)}Laya.timer.once(1e3,this,this.playShine)};t.prototype.clearAll=function(){for(var t=0;t<this.blackArr.length;t++){this.blackArr[t].removeSelf()}this.blackArr=[];for(var t=0;t<this.selectArr.length;t++){this.selectArr[t].removeSelf()}this.selectArr=[];for(var t=0;t<this.lineArr.length;t++){this.lineArr[t].removeSelf()}this.lineArr=[];for(var t=0;t<this.titleArr.length;t++){this.titleArr[t].removeSelf()}this.titleArr=[]};t.SINGLE_KEY="task.TaskMainView";return t}(ui.zhuxianrenwu.zhuxianrenwuviewUI);i.TaskMainView=t})(task||(task={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var task;(function(t){var e=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.blackArr=[];t.selectArr=[];t.lineArr=[];t.titleArr=[];return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.dituMask=new Laya.Sprite;this.shoucilist.itemRender=grids.GridView;this.shoucilist.renderHandler=grids.GridView.CommonItemRender;this.centerMediator=new game.CenterLayoutMediator(this.shoucilist,this.tiaozhanbox,96,10);this.tiaozhanbtn.on(Laya.Event.CLICK,this,this.onBattle);guide.GuideModel.getIns().register(csv.GuideProxy.ENUM_VIEW.ZXRW_BATTLE,this.tiaozhanbtn);this.lblGoto.on(Laya.Event.LINK,this,this.onHandler);this.huluxiongdi.visible=false;this.qipao.visible=false};t.prototype.onHandler=function(t){chat.ChatStatic.dellLink(t)};t.prototype.onBattle=function(){if(battle.BattleModel.getIns().checkBattleState(true)){return}app.ProtocolRequest.TaskTowerReq()};t.prototype.onDisplay=function(){this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){this.clearAll()};t.prototype.refreshAll=function(){var t;var e;var i;var n=dailytask.DailyTaskModel.getIns().taskMainId;i=csv.DungeonProxy.getIns().getZxrwTypeCfg(2,n+1);if(!i){i=csv.DungeonProxy.getIns().getZxrwTypeCfg(2,n);t=parseInt(i.chapter);e=parseInt(i.round)+1}else{t=parseInt(i.chapter);e=parseInt(i.round)}this.guanshulab.text=app.getLang("dungeon_title",i.chapter,app.getLang(i.title));var a="res/static/zhuxianrenwu/"+i.film+".jpg";this.ditu.skin=this.dituhui.skin=a;var o=csv.DungeonProxy.getIns().getZxrwTypeArr(2,t);Laya.loader.load(a,Laya.Handler.create(this,this.createZhe,[e,o]));var s;for(var r=0,l=o.length;r<l;r++){var h=o[r];var p=parseInt(h.round);if(e==p){s=h;break}}if(s){this.tiaozhanbox.visible=true;this.tongguanimg.visible=false;var u=[];var c=game.ItemUtil.parserList(s.award_item);for(var r=0,l=c.length;r<l;r++){if(c[r].getItemId()==88001){continue}u.push(c[r])}this.centerMediator.array=u;var g=game.Context.isTeamLvReach(s.teamlevel,false);this.lblGoto.visible=!g;this.tiaozhanbtn.visible=g;if(!g){this.lblGoto.text=app.getLang("huluxiongdi_needlevel",s.teamlevel)}var f=o[o.length-1];if(f){var d=game.ItemUtil.parserList(f.bigaward)[0];this.imgdaoju.setData(d)}}else{this.tiaozhanbox.visible=false;this.tongguanimg.visible=true}};t.prototype.createZhe=function(t,e){this.dituMask.graphics.clear();for(var i=0,n=e.length;i<n;i++){var a=e[i];var o=parseInt(a.round);var s=this.getPoints(a.cutline);this.drawLines(s);if(o<t){this.createTitle(a,s[0],s[1])}else if(o==t){this.createTitle(a,s[0],s[1],true);this.drawShines(s);this.playShine()}else{this.createTitle(a,s[0],s[1]);continue}this.dituMask.graphics.drawPoly(0,0,s,0)}this.ditu.mask=this.dituMask};t.prototype.createTitle=function(t,e,i,n){if(n===void 0){n=false}var a=new ui.zhuxianrenwu.guanshuitemUI;a.x=this.ditu.x+e+5;a.y=this.ditu.y+i+5;a.guanshuclip.value=t.chapter+"-"+t.round;a.xinimg.visible=n;this.addChild(a);this.titleArr.push(a)};t.prototype.drawLines=function(t){var e=t.length/2;for(var i=0;i<e-1;i++){var n=Math.atan2(t[(i+1)*2+1]-t[i*2+1],t[(i+1)*2]-t[i*2])/Math.PI*180;var a=new Laya.Point(t[i*2],t[i*2+1]).distance(t[(i+1)*2],t[(i+1)*2+1]);var o=new Laya.Image;o.anchorY=.5;o.skin="zhuxianrenwu/bg_zhuxianrenwu_fenge.png";o.x=this.ditu.x+t[i*2];o.y=this.ditu.y+t[i*2+1];o.width=a;o.rotation=n;this.lineArr.push(o);this.addChild(o)}};t.prototype.drawShines=function(t){var e=t.length/2;for(var i=0;i<e-1;i++){var n=Math.atan2(t[(i+1)*2+1]-t[i*2+1],t[(i+1)*2]-t[i*2])/Math.PI*180;var a=new Laya.Point(t[i*2],t[i*2+1]).distance(t[(i+1)*2],t[(i+1)*2+1]);var o=new Laya.Image;o.anchorY=1;o.skin="zhuxianrenwu/bg_zhuxianrenwu_zhezhao.png";o.sizeGrid="0,60,0,60";o.x=this.ditu.x+t[i*2];o.y=this.ditu.y+t[i*2+1];o.width=a;o.rotation=n;this.selectArr.push(o);this.addChild(o)}};t.prototype.getPoints=function(t){var e=[];var i=app.str2Array(t,";","-");for(var n=0;n<i.length;n++){var a=i[n];e.push(parseInt(a[0])/100*this.ditu.width);e.push(parseInt(a[1])/100*this.ditu.height)}return e};t.prototype.playShine=function(){var t=function(t,e){var i=n.selectArr[t];i.alpha=1;Laya.Tween.to(i,{alpha:.5},500,null,Laya.Handler.create(n,function(){Laya.Tween.to(i,{alpha:1},500)}))};var n=this;for(var e=0,i=this.selectArr.length;e<i;e++){t(e,i)}Laya.timer.once(1e3,this,this.playShine)};t.prototype.clearAll=function(){for(var t=0;t<this.blackArr.length;t++){this.blackArr[t].removeSelf()}this.blackArr=[];for(var t=0;t<this.selectArr.length;t++){this.selectArr[t].removeSelf()}this.selectArr=[];for(var t=0;t<this.lineArr.length;t++){this.lineArr[t].removeSelf()}this.lineArr=[];for(var t=0;t<this.titleArr.length;t++){this.titleArr[t].removeSelf()}this.titleArr=[]};t.SINGLE_KEY="task.TaskMainView2";return t}(ui.zhuxianrenwu.zhuxianrenwuviewUI);t.TaskMainView2=e})(task||(task={}));var styles;(function(t){var e=function(){function t(){}t.COLORS={TITLE:"#406376",TEXT:"#6092a4",NPC:"#009944",ERROR:"#f67600",COMPLETE:"#00FF00",DEFAULT:"#6092a4"};return t}();t.Task=e})(styles||(styles={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var task;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.getTaskDoingText=function(){return'<span color = "'+e.STYLES.COLOR_ERROR+'">'+app.getLang("task_pane_lvl",this.cfg.param)+"</span>"};e.prototype.doingTrack=function(){};return e}(t.TaskDataAdapter);t.LevelUpAdapter=e;t.TaskDataAdapter.regist(7,e)})(task||(task={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var task;(function(t){var e=function(n){__extends(t,n);function t(t){var e=n.call(this,t)||this;var i=app.str2Array(e.cfg.param,"-");return e}t.prototype.doingTrack=function(){};t.prototype.getTaskDoingText=function(){var t="";return this.cfg.param};return t}(t.TaskDataAdapter);t.MainTaskAdapter=e;t.TaskDataAdapter.regist(4,e)})(task||(task={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var task;(function(t){var e=function(e){__extends(t,e);function t(t){return e.call(this,t)||this}t.prototype.doingTrack=function(){};t.prototype.getTaskDoingText=function(){return""};return t}(t.TaskDataAdapter);t.MonsterKillAdapter=e;t.TaskDataAdapter.regist(2,e)})(task||(task={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var task;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.getTaskDoingText=function(){var t=csv.TaskProxy.getCompleteNpcId(this.cfg);if(t){var e=csv.NpcProxy.getIns().getCfg(t);var i=app.getLang('<span color = "{0}" href=" ">{1}</span>',game.STYLES.GREEN_COLOR_S,csv.NpcProxy.getName(e));return app.getLang("task_pane_talk",i)}else{return""}};e.prototype.doingTrack=function(){var t=csv.TaskProxy.getCompleteNpcId(this.cfg)};e.prototype.getMainViewText=function(){var t;if(this.getNum()>=1){t=game.STYLES.GREEN_COLOR_S}else{t=game.STYLES.YELLOW_COLOR_S}var e=app.getLang(this.cfg.name)+app.getLang('<span color = "{0}"> ({1}/{2})</span>',t,this.getNum(),1);return e};e.SUB_TYPE=1;return e}(t.TaskDataAdapter);t.NpcTalkAdapter=e;t.TaskDataAdapter.regist(e.SUB_TYPE,e)})(task||(task={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var team;(function(o){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){app.ViewManager.regist(o.TeamListView);app.ViewManager.regist(o.TeamInviteView);app.ViewManager.regist(o.TeamMineView);app.ViewManager.regist(o.TeamInviteMemberView);app.ViewManager.regist(o.TeamApplyView);this._model=o.TeamModel.getIns()};e.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.MyTeamDataAck,this,this.onMyTeamDataAck);this.addMsgListener(app.ProtocolResponse.TeamListAck,this,this.onTeamListAck);this.addMsgListener(app.ProtocolResponse.TeamInviteListAck,this,this.onTeamInviteListAck);this.addMsgListener(app.ProtocolResponse.TeamInviteNotice,this,this.onTeamInviteNotice);this.addMsgListener(app.ProtocolResponse.TeamApplyListAck,this,this.onTeamApplyListAck);this.addMsgListener(app.ProtocolResponse.TeamCreateAck,this,this.onTeamCreateAck);this.addMsgListener(app.ProtocolResponse.TeamApplyAcceptAck,this,this.onTeamApplyAcceptAck);this.addMsgListener(app.ProtocolResponse.TeamEnterCopyNotice,this,this.onTeamEnterCopyNotice);this.addMsgListener(app.ProtocolResponse.TeamAcceptEnterCopyAck,this,this.onTeamAcceptEnterCopyAck)};e.prototype.onMyTeamDataAck=function(t,e){this._model.dellMyTeam(e.myTeamId.toNumber(),e.teamInfo[0],e.member);if(app.ViewManager.DisplayedInStage(o.TeamReadyView)){app.ViewManager.toggleDialog(o.TeamReadyView,-1,0)}if(o.TeamModel.getIns().hasTeam){if(app.ViewManager.DisplayedInStage(o.TeamListView.SINGLE_KEY)){app.ViewManager.toggleDialog(o.TeamListView,-1,0)}else if(app.ViewManager.DisplayedInStage(o.TeamInviteView.SINGLE_KEY)){app.ViewManager.toggleDialog(o.TeamInviteView,-1,0)}else if(app.ViewManager.DisplayedInStage(o.TeamApplyView.SINGLE_KEY)){return}if(!app.ViewManager.DisplayedInStage(o.TeamMineView.SINGLE_KEY)){app.ViewManager.toggleDialog(o.TeamMineView,1,0)}}else{if(app.ViewManager.DisplayedInStage(o.TeamMineView)){app.ViewManager.toggleDialog(o.TeamMineView,-1,0)}}};e.prototype.onTeamListAck=function(t,e){if(e.noTeam==1){this._model.dellTeamList()}else{this._model.dellTeamList(e.teamInfo,e.applyTeamId)}};e.prototype.onTeamInviteListAck=function(t,e){if(e.count==0){this._model.dellInviteMemberList([])}else{this._model.dellInviteMemberList(e.inviteList)}};e.prototype.onTeamInviteNotice=function(t,e){this._model.dellInviteTeamList(e.teamInfo)};e.prototype.onTeamApplyListAck=function(t,e){if(e.count==0){this._model.dellApplyList([])}else{this._model.dellApplyList(e.applyMember)}};e.prototype.onTeamApplyAcceptAck=function(t,e){if(e.success==1){app.ProtocolRequest.TeamApplyListReq()}};e.prototype.onTeamCreateAck=function(t,e){if(e.success==1){app.ViewManager.toggleDialog(o.TeamListView,-1,0)}};e.prototype.onTeamEnterCopyNotice=function(t,e){app.ViewManager.toggleDialog(o.TeamReadyView,1,0,e.startTime);this._model.clearReadyIds()};e.prototype.onTeamAcceptEnterCopyAck=function(t,e){if(e.type==0){for(var i=0,n=this._model.myMembers.length;i<n;i++){var a=this._model.myMembers[i];if(Uint64.equal(a.playerID,e.player_id)){app.ViewManager.toggleDialog(o.TeamReadyView,-1,0);manager.FlowManager.instance.flowByStyle1(app.getLang("玩家{0}拒绝进入副本",a.playerName));app.ViewManager.toggleDialog(o.TeamMineView,1,0);break}}}else{this._model.dellReadyIds(e.player_id)}};e.SINGLE_KEY="team.TeamModule";return e}(app.ModuleBase);o.TeamModule=t})(team||(team={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var team;(function(t){var e=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t._myTeamId=0;t.myMembers=[];t._readMenbers=[];t._teamList=[];t._applyTeamIds=[];t._applyList=[];t._inviteMemberList=[];t._inviteTeamList=[];return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.init=function(){};t.prototype.openTeam=function(t){Laya.Dialog.closeAll();if(this.hasTeam){app.ViewManager.toggleDialog(team.TeamMineView,1,0)}else{app.ViewManager.toggleDialog(team.TeamListView,1,0,[t])}};Object.defineProperty(t.prototype,"myTeamId",{get:function(){return this._myTeamId},set:function(t){this._myTeamId=t},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"hasTeam",{get:function(){return this._myTeamId!=0},enumerable:true,configurable:true});t.prototype.dellMyTeam=function(t,e,i){this.myTeamInfo=e;this.myMembers=i;this.myTeamId=t;this.event(s.MY_TEAM_CHANGE)};t.prototype.getMemberByUid=function(t){var e;for(var i in this.myMembers){if(Uint64.equal(t,this.myMembers[i].playerID)){e=this.myMembers[i];break}}return e};t.prototype.dellReadyIds=function(t){this._readMenbers.push(t);this.event(s.READY_CHANGE)};t.prototype.clearReadyIds=function(){this._readMenbers=[]};t.prototype.getReadyIds=function(){return this._readMenbers};t.prototype.boCaptain=function(t){var e=false;if(this.myTeamInfo){e=Uint64.equal(this.myTeamInfo.captainId,t)}return e};t.prototype.checkIsApplyed=function(t){for(var e=0,i=this._applyTeamIds.length;e<i;e++){if(Uint64.equal(t,this._applyTeamIds[e])){return true}}return false};t.prototype.dellTeamList=function(t,e){if(t===void 0){t=[]}if(e===void 0){e=[]}this._teamList=t;this._applyTeamIds=e;this.event(s.TEAM_LIST_CHANGE)};t.prototype.getTeamList=function(t){var e=[];for(var i=0,n=this._teamList.length;i<n;i++){var a=this._teamList[i];if(a.copyId==t){e.push(a)}}return e};t.prototype.dellApplyList=function(t){this._applyList=t;this.event(s.APPLY_LIST_CHANGE);var e=3-this.myTeamInfo.count;if(e>0){if(this.boAutoSet){var i=this.getAutoApplyScore()*1e4;for(var n=0,a=t.length;n<a;n++){var o=t[n];if(o.swordScore.toNumber()>=i){app.ProtocolRequest.TeamApplyAcceptReq(1,o.playerID);e--}}}}};t.prototype.deleteApplyPlayer=function(t){for(var e=0;e<this._applyList.length;e++){var i=this._applyList[e];if(Uint64.equal(t,i.playerID)){this._applyList.splice(e,1);break}}this.event(s.APPLY_LIST_CHANGE)};t.prototype.getApplyList=function(){return this._applyList};Object.defineProperty(t.prototype,"boApply",{get:function(){return this._applyList.length>0},enumerable:true,configurable:true});t.prototype.setAutoApplyScore=function(t){Laya.LocalStorage.setItem(game.AccountModel.accountId+"_team_apply_score",t)};t.prototype.clearAutoApplyScore=function(){Laya.LocalStorage.removeItem(game.AccountModel.accountId+"_team_apply_score")};t.prototype.getAutoApplyScore=function(){var t=Laya.LocalStorage.getItem(game.AccountModel.accountId+"_team_apply_score");if(t&&t!=""){return parseInt(t)}return 100};Object.defineProperty(t.prototype,"boAutoSet",{get:function(){var t=Laya.LocalStorage.getItem(game.AccountModel.accountId+"_team_apply");if(t&&t!=""){return true}return false},enumerable:true,configurable:true});t.prototype.setAutoApply=function(t){if(t){Laya.LocalStorage.setItem(game.AccountModel.accountId+"_team_apply","1")}else{Laya.LocalStorage.removeItem(game.AccountModel.accountId+"_team_apply")}};t.prototype.dellInviteMemberList=function(t){this._inviteMemberList=t;this.event(s.INVITE_MEMBER_CHANGE)};t.prototype.getInviteMemberList=function(){return this._inviteMemberList};t.prototype.dellInviteTeamList=function(t){this._inviteTeamList=t;this.event(s.INVITE_TEAM_CHANGE)};t.prototype.deleteInviteTeam=function(t){for(var e=0;e<this._inviteTeamList.length;e++){var i=this._inviteTeamList[e];if(Uint64.equal(t,i.id)){this._inviteTeamList.splice(e,1);break}}this.event(s.INVITE_TEAM_CHANGE)};t.prototype.getInviteTeamList=function(){return this._inviteTeamList};Object.defineProperty(t.prototype,"boInvite",{get:function(){return this._inviteTeamList.length>0},enumerable:true,configurable:true});t.SINGLE_KEY="team.TeamModel";return t}(app.ModelBase);t.TeamModel=e;var s=function(){function t(){}t.TEAM_LIST_CHANGE="team_list_change";t.MY_TEAM_CHANGE="my_team_change";t.APPLY_LIST_CHANGE="apply_list_change";t.INVITE_MEMBER_CHANGE="invite_member_change";t.INVITE_TEAM_CHANGE="invite_team_change";t.READY_CHANGE="ready_change";return t}();t.TeamEvent=s})(team||(team={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("teamroom.csv");this.cfgMap=t.getMap("id");this.cfgArr=t.getArray()};e.prototype.getCfg=function(t){return this.cfgMap[t]};e.prototype.getArr=function(){return this.cfgArr};e.prototype.getCopyByFunc=function(t){if(this.copyIdMap){return this.copyIdMap[t]}this.copyIdMap={};var e=this.getArr();for(var i=0;i<e.length;i++){var n=e[i];this.copyIdMap[n.functionid]=n}return this.copyIdMap[t]};e.SINGLE_KEY="csv.TeamProxy";e.TYPE={REBIRTH:1,YAODONG:2};return e}(app.ModelBase);t.TeamProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var team;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.btntongyi.on(Laya.Event.CLICK,this,this.onAgree);this.btnjujue.on(Laya.Event.CLICK,this,this.onRefuse)};e.prototype.onAgree=function(){app.ProtocolRequest.TeamApplyAcceptReq(1,this.dataSource.playerID)};e.prototype.onRefuse=function(){app.ProtocolRequest.TeamApplyAcceptReq(0,this.dataSource.playerID)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){this.labelname.text=t.playerName;this.imgtouxiang.skin=role.RoleVO.getHeadIconUrl(t.classSkin);this.imgHead.skin=csv.TitleProxy.getIns().getNobleSkin(t.headtitle);this.imgframe.skin=csv.HeadFrameProxy.getIns().getIcon(t.headframeId);var e=csv.ReBirthProxy.getIns().getTransIdByLvl(t.level);var i=csv.ReBirthProxy.getIns().getTransIcon(e);if(i==""){i=csv.DefclassProxy.getIns().getNameRes(t.classSkin)}this.imgdujie.skin=i;this.labellv.text=csv.ReBirthProxy.getIns().getTransLvl(t.level)+""};e.SINGLE_KEY="team.TeamApplyItem";return e}(ui.zudui.zuduishenqingitemUI);t.TeamApplyItem=e})(team||(team={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var team;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listhaoyoushenqing.itemRender=i.TeamApplyItem;this.listhaoyoushenqing.renderHandler=new Laya.Handler(this,this.onRender);this._model=i.TeamModel.getIns();this.input.text=this._model.getAutoApplyScore()+"";this.checkboxgouxuan.selected=this._model.boAutoSet;this.checkboxgouxuan.on(Laya.Event.CHANGE,this,this.onChange);this.input.on(Laya.Event.INPUT,this,this.onChange)};e.prototype.onChange=function(){if(this.input.text==""){this.input.text="0";return}this.input.text=parseInt(this.input.text).toString();if(this.checkboxgouxuan.selected){this._model.setAutoApplyScore(this.input.text)}else{this._model.clearAutoApplyScore()}this._model.setAutoApply(this.checkboxgouxuan.selected)};e.prototype.onRender=function(t,e){t.setData(t.dataSource)};e.prototype.onDisplay=function(){app.ViewManager.showDialogMask();this._model.on(i.TeamEvent.APPLY_LIST_CHANGE,this,this.refreshAll);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){app.ViewManager.closeDialogMask();this._model.off(i.TeamEvent.APPLY_LIST_CHANGE,this,this.refreshAll)};e.prototype.refreshAll=function(){this.listhaoyoushenqing.array=this._model.getApplyList();this.imgshenqingtishi.visible=this.listhaoyoushenqing.array.length==0};e.SINGLE_KEY="team.TeamApplyView";return e}(ui.zudui.zuduishenqingviewUI);i.TeamApplyView=t})(team||(team={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var team;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.on(Laya.Event.CLICK,this,this.onClick)};e.prototype.onClick=function(){};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){this.yeqianbtn.label=app.getLang(t.roomname)};e.prototype.setSelect=function(t){this.yeqianbtn.selected=t};e.SINGLE_KEY="pet.TeamCopyTab";return e}(ui.zudui.zuduiliebiaoitemUI);t.TeamCopyTab=e})(team||(team={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var team;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.on(Laya.Event.CLICK,this,this.onClick)};e.prototype.onClick=function(){};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){this.shuxing.text=app.getLang(t.roomname)};e.SINGLE_KEY="pet.TeamCopyTypeItem";return e}(ui.zudui.mubiaofubenitemUI);t.TeamCopyTypeItem=e})(team||(team={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var team;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.btnchahao.on(Laya.Event.CLICK,this,this.onRefuse);this.btnduihao.on(Laya.Event.CLICK,this,this.onAgree)};e.prototype.onRefuse=function(){var t=this.dataSource;app.ProtocolRequest.TeamMemberAcceptReq(t.id,0);i.TeamModel.getIns().deleteInviteTeam(t.id)};e.prototype.onAgree=function(){if(i.TeamModel.getIns().hasTeam){manager.FlowManager.instance.flowByStyle1(app.getLang("teamin_tip"));return}var t=this.dataSource;app.ProtocolRequest.TeamMemberAcceptReq(t.id,1);i.TeamModel.getIns().deleteInviteTeam(t.id)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){this.labelname.text=t.captainName;this.labelzhanli.text=t.captainbattle.toNumber()+"";this.labelnum.text=t.count.toString()+"/3"};e.SINGLE_KEY="team.TeamInviteItem";return e}(ui.zudui.duiwuyaoqingitemUI);i.TeamInviteItem=t})(team||(team={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var team;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.btnyiyaoqing.on(Laya.Event.CLICK,this,this.onInvite)};e.prototype.onInvite=function(){this.dataSource.time=Laya.timer.currTimer/1e3;this.btnyiyaoqing.gray=true;this.btnyiyaoqing.mouseEnabled=false;this.btnyiyaoqing.label=app.getLang("已邀请");app.ProtocolRequest.TeamInviteReq(this.dataSource.playerID)};e.prototype.onDisplay=function(){i.TeamModel.getIns().on(i.TeamEvent.INVITE_MEMBER_CHANGE,this,this.onInviteHandler);this.callLater(this.refreshAll)};e.prototype.onInviteHandler=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){i.TeamModel.getIns().off(i.TeamEvent.INVITE_MEMBER_CHANGE,this,this.onInviteHandler)};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){this.imgtouxiang.skin=role.RoleVO.getHeadIconUrl(t.classSkin);this.imgHead.skin=csv.TitleProxy.getIns().getNobleSkin(t.headtitle);this.imgframe.skin=csv.HeadFrameProxy.getIns().getIcon(t.headframeId);this.labelname02.text=t.playerName;if(game.Context.getServerTime()-t.time<=game.Config.getIntParams(581)){this.btnyiyaoqing.gray=true;this.btnyiyaoqing.mouseEnabled=false;this.btnyiyaoqing.label=app.getLang("已邀请")}else{this.btnyiyaoqing.gray=false;this.btnyiyaoqing.mouseEnabled=true;this.btnyiyaoqing.label=app.getLang("邀请")}var e=csv.ReBirthProxy.getIns().getTransIdByLvl(t.level);var i=csv.ReBirthProxy.getIns().getTransIcon(e);if(i==""){i=csv.DefclassProxy.getIns().getNameRes(t.classSkin)}this.imgzhezhao.skin=i;this.labellv.text=csv.ReBirthProxy.getIns().getTransLvl(t.level)+""};e.SINGLE_KEY="team.TeamInviteMemberItem";return e}(ui.zudui.yaoqingitemUI);i.TeamInviteMemberItem=t})(team||(team={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var team;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listhaoyoushenqing.itemRender=i.TeamInviteMemberItem;this.listhaoyoushenqing.renderHandler=new Laya.Handler(this,this.onRender);this._model=i.TeamModel.getIns()};e.prototype.onRender=function(t,e){t.setData(t.dataSource)};e.prototype.onDisplay=function(){app.ViewManager.showDialogMask();this._model.on(i.TeamEvent.APPLY_LIST_CHANGE,this,this.refreshAll);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){app.ViewManager.closeDialogMask()};e.prototype.refreshAll=function(){this.listhaoyoushenqing.array=this._model.getInviteMemberList()};e.SINGLE_KEY="team.TeamInviteMemberView";return e}(ui.zudui.yaoqingviewUI);i.TeamInviteMemberView=t})(team||(team={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var team;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listduiwu.itemRender=i.TeamInviteItem;this.listduiwu.renderHandler=new Laya.Handler(this,this.onRender);this._model=i.TeamModel.getIns()};e.prototype.onRender=function(t,e){t.setData(t.dataSource)};e.prototype.onDisplay=function(){app.ViewManager.showDialogMask();this._model.on(i.TeamEvent.INVITE_TEAM_CHANGE,this,this.refreshAll);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){app.ViewManager.closeDialogMask();this._model.off(i.TeamEvent.INVITE_TEAM_CHANGE,this,this.refreshAll)};e.prototype.refreshAll=function(){this.listduiwu.array=this._model.getInviteTeamList()};e.SINGLE_KEY="team.TeamInviteView";return e}(ui.zudui.duiwuyaoqingliebiaoviewUI);i.TeamInviteView=t})(team||(team={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var team;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.btnshenqingrudui.on(Laya.Event.CLICK,this,this.onClick)};e.prototype.onClick=function(){var t=this.dataSource;app.ProtocolRequest.TeamApplyReq(t.id)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){this.labelname.text=t.captainName;this.labelzhanli.text=t.captainbattle.toNumber()+"";this.labelnum.text=t.count.toString()+"/3";if(i.TeamModel.getIns().checkIsApplyed(t.id)){this.btnshenqingrudui.disabled=true;this.btnshenqingrudui.label=app.getLang("已申请")}else{this.btnshenqingrudui.disabled=false;this.btnshenqingrudui.label=app.getLang("申请入队")}};e.SINGLE_KEY="team.TeamListItem";return e}(ui.zudui.duiwuliebiaoitemUI);i.TeamListItem=t})(team||(team={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var team;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=i.TeamModel.getIns();this.listduiwu.itemRender=i.TeamListItem;this.listduiwu.renderHandler=new Laya.Handler(this,this.onTeamRender);this.listfuben.itemRender=i.TeamCopyTab;this.listfuben.renderHandler=new Laya.Handler(this,this.onTabHandler);this.listfuben.selectHandler=new Laya.Handler(this,this.onTabSelect);this.listfuben.selectEnable=true;this.listfuben.array=csv.TeamProxy.getIns().getArr();this.btnchuangjianduiwu.on(Laya.Event.CLICK,this,this.onCreate);this.btnshuaxin.on(Laya.Event.CLICK,this,this.onRefresh)};e.prototype.onTeamRender=function(t,e){t.setData(t.dataSource)};e.prototype.onTabHandler=function(t,e){t.setData(t.dataSource)};e.prototype.onTabSelect=function(t){if(this._lastSelectCell){this._lastSelectCell.setSelect(false)}var e=this.listfuben.getCell(t);if(e){e.setSelect(true);this._lastSelectCell=e}this.setTeamList()};e.prototype.onCreate=function(){if(this.listfuben.selectedItem){if(this.listfuben.selectedItem.id==3){if(i.TeamZhanyouModel.getIns().checkInCD()){manager.FlowManager.instance.flowByStyle1(app.getLang("zy_Error_CDTime"))}else{app.ProtocolRequest.TeamCreateReq(this.listfuben.selectedItem.id)}}else{app.ProtocolRequest.TeamCreateReq(this.listfuben.selectedItem.id)}}};e.prototype.onRefresh=function(){app.ProtocolRequest.TeamListReq();this.startLoop()};e.prototype.startLoop=function(){this.btnshuaxin.gray=true;this.btnshuaxin.mouseEnabled=false;this._recodeTime=5;this.btnshuaxin.label=app.getLang("刷新({0})秒",this._recodeTime);Laya.timer.loop(1e3,this,this.loopFreshTime)};e.prototype.loopFreshTime=function(){this._recodeTime--;if(this._recodeTime>0){this.btnshuaxin.label=app.getLang("刷新({0})秒",this._recodeTime)}else{this.btnshuaxin.label=app.getLang("刷新",this._recodeTime);this.btnshuaxin.gray=false;this.btnshuaxin.mouseEnabled=true;Laya.timer.clear(this,this.loopFreshTime)}};e.prototype.onDisplay=function(){app.ViewManager.showDialogMask();app.ProtocolRequest.TeamListReq();this._model.on(i.TeamEvent.TEAM_LIST_CHANGE,this,this.refreshAll);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){app.ViewManager.closeDialogMask();this._model.off(i.TeamEvent.TEAM_LIST_CHANGE,this,this.refreshAll)};e.prototype.refreshAll=function(){var t=0;if(this.dataSource.length>0){var e=csv.TeamProxy.getIns().getCopyByFunc(this.dataSource[0]);var i=csv.TeamProxy.getIns().getArr();t=i.indexOf(e)}this.listfuben.selectedIndex=t;this.setTeamList()};e.prototype.setTeamList=function(){var t=this.listfuben.selectedItem;if(t){this.listduiwu.array=this._model.getTeamList(parseInt(t.id));this.imgduiwutishi.visible=this.listduiwu.array.length==0}};e.SINGLE_KEY="team.TeamListView";return e}(ui.zudui.duiwuliebiaoviewUI);i.TeamListView=t})(team||(team={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var team;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.btntuichu.on(Laya.Event.CLICK,this,this.onTuichu);this.btnyaoqing.on(Laya.Event.CLICK,this,this.onInvite);this.btnyaoqingrudui.on(Laya.Event.CLICK,this,this.onInvite);this.btnKick.on(Laya.Event.CLICK,this,this.onKick);this.on(Laya.Event.CLICK,this,this.onClick)};e.prototype.onClick=function(){if(this.dataSource){if(Uint64.equal(this.dataSource.playerID,game.Context.mainRoleId)){return}var t=[];t.push(friend.FriendConst.MENU.chakan);if(i.TeamModel.getIns().boCaptain(game.Context.mainRoleId)){t.push(friend.FriendConst.MENU.team_change)}friend.FriendModel.getIns().setFriendMenu(t,this.dataSource.playerID,this.dataSource.playerName,this.dataSource.level,this.dataSource.classSkin,this.dataSource.headframeId)}};e.prototype.onTuichu=function(t){t.stopPropagation();app.ProtocolRequest.TeamExitReq(this.dataSource.playerID);if(Uint64.equal(this.dataSource.playerID,game.Context.mainRoleId)){app.ViewManager.toggleDialog(i.TeamMineView,-1,0)}};e.prototype.onInvite=function(t){t.stopPropagation();app.ProtocolRequest.TeamInviteListReq();app.ViewManager.toggleDialog(i.TeamInviteMemberView,1,0)};e.prototype.onKick=function(t){t.stopPropagation();app.ProtocolRequest.TeamExitReq(this.dataSource.playerID)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){if(t){this.btnyaoqing.visible=false;this.btnyaoqingrudui.visible=false;this.imgtouxiang.skin=role.RoleVO.getHeadIconUrl(t.classSkin);this.labelname.text=t.playerName;this.imgHead.skin=csv.TitleProxy.getIns().getNobleSkin(t.headtitle);if(Uint64.equal(t.playerID,game.Context.mainRoleId)){this.btntuichu.visible=true;this.btnKick.visible=false;this.imgframe.skin=game.RoleModel.getIns().getHeadFrameIcon()}else{this.btntuichu.visible=false;if(i.TeamModel.getIns().boCaptain(game.Context.mainRoleId)){this.btnKick.visible=true}else{this.btnKick.visible=false}this.imgframe.skin=csv.HeadFrameProxy.getIns().getIcon(t.headframeId)}this.imgduizhang.visible=i.TeamModel.getIns().boCaptain(t.playerID)}else{this.btnyaoqing.visible=true;this.btntuichu.visible=false;this.btnKick.visible=false;this.btnyaoqingrudui.visible=true;this.imgtouxiang.skin="";this.labelname.text=app.getLang("暂无");this.imgHead.skin="";this.imgduizhang.visible=false;this.imgframe.skin=csv.HeadFrameProxy.getIns().getIcon(0)}};e.SINGLE_KEY="team.TeamMineItem";return e}(ui.zudui.zuduiduiwuitemUI);i.TeamMineItem=t})(team||(team={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var team;(function(i){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.worldStart=0;t.familyStart=0;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.btnduiwu01.on(Laya.Event.CLICK,this,this.onShowApplyView);this.btnduiwu04.on(Laya.Event.CLICK,this,this.onEnterCopy);this.btnduiwu02.on(Laya.Event.CLICK,this,this.onWorldAsk);this.btnduiwu03.on(Laya.Event.CLICK,this,this.onFamliyAsk);this.listduiwu.itemRender=i.TeamMineItem;this.listduiwu.renderHandler=new Laya.Handler(this,this.onRender);this.listMediator=new common.ListSelectMediator(this.listxiala,this.btnxiala,this.labelfuben,i.TeamCopyTypeItem,new Laya.Handler(this,this.onListSelectHandler),31,124,["id","roomname"]);this.listMediator.array=csv.TeamProxy.getIns().getArr();this._model=i.TeamModel.getIns();this._copyChangeHandler=new Laya.Handler(this,this.onCopyChange);this._copyCancleHandler=new Laya.Handler(this,this.onCopyCancle);this.singleEnterHandler=new Laya.Handler(this,this.onSingleEnterHandler);this.btnvip.visible=false};t.prototype.onListSelectHandler=function(t){var e=csv.TeamProxy.getIns().getCfg(t);if(this._model.myTeamInfo.copyId==parseInt(e.id)){return}game.Alert.show(app.getLang("zudui_team_wenben2",app.getLang(e.roomname)),this._copyChangeHandler,this._copyCancleHandler)};t.prototype.onTeamMemberClick=function(){manager.FlowManager.instance.flowByStyle1(app.getLang("zudui_team_wenben3",game.STYLES.RED_COLOR_S))};t.prototype.onCopyChange=function(){app.ProtocolRequest.TeamSetCopyIdReq(this.listMediator.selectId)};t.prototype.onCopyCancle=function(){this.listMediator.setSelectId(this._model.myTeamInfo.copyId)};t.prototype.onShowApplyView=function(){app.ViewManager.toggleDialog(i.TeamApplyView,1,0)};t.prototype.onJoinBcMapReq=function(){var t=i.TeamModel.getIns().myTeamInfo;if(!t){manager.FlowManager.instance.flowByStyle1(app.getLang("zy_noteam_notic"));return}if(Uint64.equal(t.captainId,game.Context.mainRoleId)){if(i.TeamZhanyouModel.getIns().bcid>0){manager.FlowManager.instance.flowByStyle1(app.getLang("zy_team_join"))}else if(t.count==3){i.TeamZhanyouModel.getIns().onJoinBcMapReq()}else{manager.FlowManager.instance.flowByStyle1(app.getLang("zy_warning_notic"))}}else{manager.FlowManager.instance.flowByStyle1(app.getLang("zy_wait_notic"))}};t.prototype.onEnterCopy=function(){if(this._model.myTeamInfo.copyId==3){this.onJoinBcMapReq()}else if(this._model.myTeamInfo.copyId==2){if(this._model.myTeamInfo.count==1){game.Alert.show(app.getLang("endless_1"),this.singleEnterHandler)}else{app.ProtocolRequest.TeamEnterCopyReq()}}else{app.ProtocolRequest.TeamEnterCopyReq()}};t.prototype.onSingleEnterHandler=function(){app.ProtocolRequest.TeamEnterCopyReq()};t.prototype.onWorldAsk=function(){this.worldStart=game.Context.getServerTime();this.checkWorld();chat.ChatModel.getIns().setTeamMsg(this._model.myTeamInfo,chat.ChatModel.CHANNEL.WORLD)};t.prototype.checkWorld=function(){var t=game.Context.getServerTime()-this.worldStart;if(t>30){this.btnduiwu02.mouseEnabled=true;this.btnduiwu02.gray=false;this.btnduiwu02.label=app.getLang("zudui_team_wenben4")}else{this.btnduiwu02.mouseEnabled=false;this.btnduiwu02.gray=true;this.startWorldLoop()}};t.prototype.startWorldLoop=function(){this.onWorldLoop();Laya.timer.loop(1e3,this,this.onWorldLoop)};t.prototype.onWorldLoop=function(){var t=game.Context.getServerTime()-this.worldStart;if(t>30){this.checkWorld()}else{this.btnduiwu02.label=app.getLang("zudui_team_wenben5",30-t)}};t.prototype.onFamliyAsk=function(){this.familyStart=game.Context.getServerTime();this.checkFamily();chat.ChatModel.getIns().setTeamMsg(this._model.myTeamInfo,chat.ChatModel.CHANNEL.FAMILY)};t.prototype.checkFamily=function(){if(!guild.GuildModel.getIns().guildVO){this.btnduiwu03.mouseEnabled=false;this.btnduiwu03.gray=true;return}var t=game.Context.getServerTime()-this.familyStart;if(t>30){this.btnduiwu03.mouseEnabled=true;this.btnduiwu03.gray=false;this.btnduiwu03.label=app.getLang("zudui_team_wenben1")}else{this.btnduiwu03.mouseEnabled=false;this.btnduiwu03.gray=true;this.startFamilyLoop()}};t.prototype.startFamilyLoop=function(){this.onFamilyLoop();Laya.timer.loop(1e3,this,this.onFamilyLoop)};t.prototype.onFamilyLoop=function(){var t=game.Context.getServerTime()-this.familyStart;if(t>30){this.checkFamily()}else{this.btnduiwu03.label=app.getLang("zudui_team_wenben6",30-t)}};t.prototype.onRender=function(t,e){t.setData(t.dataSource)};t.prototype.onDisplay=function(){this._model.on(i.TeamEvent.MY_TEAM_CHANGE,this,this.refreshAll);this._model.on(i.TeamEvent.APPLY_LIST_CHANGE,this,this.setApplyRed);this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){this._model.off(i.TeamEvent.MY_TEAM_CHANGE,this,this.refreshAll);this._model.off(i.TeamEvent.APPLY_LIST_CHANGE,this,this.setApplyRed)};t.prototype.refreshAll=function(){this.listMediator.init();var t=[];for(var e=0;e<3;e++){t.push(this._model.myMembers[e])}this.listduiwu.array=t;var i=this._model.boCaptain(game.Context.mainRoleId);if(!i){this.btnduiwu04.disabled=true;this.btnduiwu01.disabled=true;this.btnxiala.offAll();this.btnxiala.on(Laya.Event.CLICK,this,this.onTeamMemberClick)}else{this.btnduiwu04.disabled=false;this.btnduiwu01.disabled=false;this.listMediator.setButtonClick();if(this._model.myTeamInfo.copyId==csv.TeamProxy.TYPE.REBIRTH){this.btnduiwu04.disabled=!game.Context.roleRebirthTaskState()}}if(this._model.myTeamInfo){this.listMediator.setSelectId(this._model.myTeamInfo.copyId)}this.checkWorld();this.checkFamily();this.setApplyRed()};t.prototype.setApplyRed=function(){var t=this._model.getApplyList();if(t.length>0){game.RedDotView.addTo(this.btnduiwu01)}else{game.RedDotView.removeFrom(this.btnduiwu01)}};t.SINGLE_KEY="team.TeamMineView";return t}(ui.zudui.zuduiduiwuviewUI);i.TeamMineView=t})(team||(team={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var team;(function(n){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){if(t){this.imgtouxiang.skin=role.RoleVO.getHeadIconUrl(t.classSkin);this.labelname.text=t.playerName;this.imgHead.skin=csv.TitleProxy.getIns().getNobleSkin(t.headtitle);this.imgframe.skin=csv.HeadFrameProxy.getIns().getIcon(t.headframeId);this.imgduizhang.visible=n.TeamModel.getIns().boCaptain(t.playerID);var e=n.TeamModel.getIns().getReadyIds();this.labelyizhunbei.visible=false;for(var i=0;i<e.length;i++){if(Uint64.equal(e[i],t.playerID)){this.labelyizhunbei.visible=true;break}}}else{this.imgtouxiang.skin="";this.labelname.text=app.getLang("暂无");this.imgHead.skin="";this.imgduizhang.visible=false;this.labelyizhunbei.visible=false;this.imgframe.skin=""}};e.SINGLE_KEY="team.TeamReadyItem";return e}(ui.zudui.zuduiquerenjinruitemUI);n.TeamReadyItem=t})(team||(team={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var team;(function(c){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.TEAM_ZHANYOU_INVITE,c.TeamZhanyouInviteView,new Laya.Handler(this,this.goFunView,[csv.FunctionsProxy.ENUMS.TEAM_ZHANYOU_INVITE]));game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.TEAM_ZHANYOU_INFO,c.TeamZhanyouInfoView,new Laya.Handler(this,this.goFunView));game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.TEAM_ZHANYOU_AWARDS,c.TeamZhanyouAwardView);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.TEAM_ZHANYOU_SHOP,c.TeamZhanyouShopView)};e.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.BtCompanionNtf,this,this.onBtCompanionNtf);this.addMsgListener(app.ProtocolResponse.BtCompanionModifyNtf,this,this.onBtCompanionModifyNtf);this.addMsgListener(app.ProtocolResponse.NoBtCompanionNtf,this,this.onNoBtCompanionNtf);this.addMsgListener(app.ProtocolResponse.AwardBcActAck,this,this.onAwardBcActAck);this.addMsgListener(app.ProtocolResponse.JoinBcMapAck,this,this.onJoinBcMapAck);this.addMsgListener(app.ProtocolResponse.StartBcAck,this,this.onStartBcAck);this.addMsgListener(app.ProtocolResponse.AskBcReq,this,this.onAskBcReq);this.addMsgListener(app.ProtocolResponse.AskBcResultNtf,this,this.onAskBcResultNtf);this.addMsgListener(app.ProtocolResponse.LeaveBcAck,this,this.onLeaveBcAck);this.addMsgListener(app.ProtocolResponse.OpenBcInfAck,this,this.onOpenBcInfAck);this.addMsgListener(app.ProtocolResponse.ChangeBcNtf,this,this.onChangeBcNtf);this.addMsgListener(app.ProtocolResponse.ChangeBcNameAck,this,this.onChangeBcNameAck);this.addMsgListener(app.ProtocolResponse.TransfLeaderBcAck,this,this.onTransfLeaderBcAck)};e.prototype.onTransfLeaderBcAck=function(t,e){if(e.result){}};e.prototype.onChangeBcNameAck=function(t,e){if(e.result){}};e.prototype.onChangeBcNtf=function(t,e){c.TeamZhanyouModel.getIns().onChangeBcNtf(e.cflag,e.bcname)};e.prototype.onOpenBcInfAck=function(t,e){c.TeamZhanyouModel.getIns().onOpenBcInfAck(e.result)};e.prototype.onLeaveBcAck=function(t,e){if(e.result){}};e.prototype.onAskBcResultNtf=function(t,e){var i=c.TeamModel.getIns().getReadyIds();if(e.aflag==1){for(var n=0,a=e.result;n<a.length;n++){var o=a[n];if(o.result==1){var s=false;for(var r=0;r<i.length;r++){if(Uint64.equal(i[r],o.roleid)){s=true;break}}if(s==false){c.TeamModel.getIns().dellReadyIds(o.roleid)}}}}var l=true;for(var h=0,p=e.result;h<p.length;h++){var o=p[h];if(o.result==0){l=false;var u=c.TeamModel.getIns().getMemberByUid(o.roleid);app.ViewManager.toggleDialog(c.TeamZhanyouReadyView,-1,0);app.ViewManager.toggleView(c.TeamTipsView,app.AppContainer.talkLayer,-1);manager.FlowManager.instance.flowByStyle1(app.getLang("玩家{0}还在考虑中，考虑好再来找我吧",u?u.playerName:""));app.ViewManager.toggleDialog(c.TeamMineView,1,0);break}}if(e.result.length==3&&l){if(e.aflag==1){app.ViewManager.toggleDialog(c.TeamZhanyouReadyView,-1,0);app.ViewManager.toggleDialog(c.TeamMineView,-1,0);c.TeamZhanyouModel.getIns().onStartBcReq()}else if(e.aflag==2){app.ViewManager.toggleDialog(c.TeamZhanyouSuccessView,1,0)}}};e.prototype.onAskBcReq=function(t,e){if(e.aflag==1){app.ViewManager.toggleDialog(c.TeamZhanyouReadyView,1,0,e.endtime);c.TeamModel.getIns().clearReadyIds()}else if(e.aflag==2){app.ViewManager.toggleView(c.TeamTipsView,app.AppContainer.talkLayer,1,[e.aflag,e.endtime])}};e.prototype.onStartBcAck=function(t,e){if(e.result==0){app.ViewManager.toggleDialog(c.TeamZhanyouReadyView,-1,0);app.ViewManager.toggleDialog(c.TeamMineView,1,0)}};e.prototype.onJoinBcMapAck=function(t,e){if(e.result){}};e.prototype.onAwardBcActAck=function(t,e){if(e.result){c.TeamZhanyouModel.getIns().onAwardBcActAck(e.roleid,e.actgain);c.TeamZhanyouModel.getIns().onRedDotChange()}};e.prototype.onNoBtCompanionNtf=function(t,e){c.TeamZhanyouModel.getIns().onNoBtCompanionNtf(e.leavecd)};e.prototype.onBtCompanionModifyNtf=function(t,e){c.TeamZhanyouModel.getIns().onBtCompanionModifyNtf(e.roleid,e.act,e.totalact,e.record);c.TeamZhanyouModel.getIns().onRedDotChange()};e.prototype.onBtCompanionNtf=function(t,e){c.TeamZhanyouModel.getIns().onBtCompanionNtf(e.bcid,e.bcinf,e.ctime,e.totalact,e.bcname,e.bntf,e.record);c.TeamZhanyouModel.getIns().onRedDotChange()};e.prototype.goFunView=function(){if(battle.BattleModel.getIns().checkBattleState(true)){return}if(c.TeamZhanyouModel.getIns().teamList.length>0){game.ClosureManager.callFunction(csv.FunctionsProxy.ENUMS.TEAM_ZHANYOU_INFO,true,true)}else{app.ViewManager.toggleDialog(c.TeamZhanyouInviteView,1,0)}};e.SINGLE_KEY="team.TeamZhanyouModule";return e}(app.ModuleBase);c.TeamZhanyouModule=t})(team||(team={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("battlecompanion.csv");this.cfgMap=t.getMap("id");this.cfgMapByType=t.getMap("type");this.arr=t.getArray();var e=app.Config.getResById("battlecompanionaward.csv");this.awards=e.getArray();var i=app.Config.getResById("battlecompanionname.csv");this.bcnams=i.getArray()};e.prototype.getActivityMax=function(){var t=0;for(var e in this.cfgMapByType){t+=this.cfgMapByType[e].activity_max}return t};e.prototype.getArray=function(){return this.arr};e.prototype.getCfg=function(t){return this.cfgMap[t]};e.prototype.getCfgByType=function(t){return this.cfgMapByType[t]};e.prototype.getAwards=function(){return this.awards};e.prototype.getBcnams=function(){return this.bcnams};e.SINGLE_KEY="csv.TeamZhangyouProxy";return e}(app.ModelBase);t.TeamZhangyouProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var team;(function(c){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){this.teamList=[];this.record=[];this.result=[];this.bcname="";this.bntf="";this.bcid=0};e.prototype.checkInCD=function(){var t=game.Config.getIntParams(606);if(game.Context.getServerTime()-this.leavecd<t){return true}return false};e.prototype.onRedDotChange=function(){game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.TEAM_ZHANYOU_AWARDS);var t=false;var e=csv.TeamZhangyouProxy.getIns().getAwards();for(var i=0,n=e;i<n.length;i++){var a=n[i];for(var o=0;o<this.teamList.length;o++){var s=this.teamList[o].actgain>>a.id&1;if(this.teamList[o].act>=a.activity&&s==0){t=true;break}}if(t){break}}if(t){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.TEAM_ZHANYOU_AWARDS)}};e.prototype.onBtCompanionNtf=function(t,e,i,n,a,o,s){this.bcid=t;this.teamList=e;this.totalact=n;this.ctime=i;this.bcname=a;this.bntf=o;this.record=s;var r=[];for(var l=0,h=e;l<h.length;l++){var p=h[l];for(var u=0;u<this.result.length;u++){if(Uint64.equal(p.roleid,this.result[u].id)){r.push(this.result[u]);break}}}this.result=r;this.event(c.TeamZhanyouModel.ZHANYOU_INFO_UPDATE)};e.prototype.onAwardBcActAck=function(t,e){var i=this.getBtComInfo(t);if(i){i.actgain=e;this.event(c.TeamZhanyouModel.ZHANYOU_SIGLE_INFO)}};e.prototype.onNoBtCompanionNtf=function(t){this.leavecd=t;this.teamList=[];this.record=[];this.result=[];this.bcname="";this.bntf="";if(this.bcid>0){manager.FlowManager.instance.flowByStyle1(app.getLang("战友已解散"));if(app.ViewManager.DisplayedInStage(c.TeamZhanyouInfoView.SINGLE_KEY)){app.ViewManager.toggleDialog(common.CommonWindow,-1,0)}else if(app.ViewManager.DisplayedInStage(c.TeamZhanyouAwardView.SINGLE_KEY)){app.ViewManager.toggleDialog(common.CommonWindow,-1,0)}else if(app.ViewManager.DisplayedInStage(c.TeamZhanyouShopView.SINGLE_KEY)){app.ViewManager.toggleDialog(common.CommonWindow,-1,0)}}else{this.event(c.TeamZhanyouModel.ZHANYOU_CD_TIME_CHANGE,[this.leavecd])}this.bcid=0};e.prototype.onBtCompanionModifyNtf=function(t,e,i,n){var a=this.getBtComInfo(t);this.totalact=i;this.record=this.record.concat(n);if(a){a.act=e}this.event(c.TeamZhanyouModel.ZHANYOU_SIGLE_INFO,[t,e])};e.prototype.onChangeBcNtf=function(t,e){if(t==1){this.bcname=e}else if(t==2){this.bntf=e}this.event(c.TeamZhanyouModel.ZHANYOU_BCNAME_CHANGE)};e.prototype.onOpenBcInfAck=function(t){this.result=t;this.event(c.TeamZhanyouModel.ZHANYOU_INFO_UPDATE)};e.prototype.getBtComInfo=function(t){var e;for(var i in this.teamList){if(Uint64.equal(t,this.teamList[i].roleid)){e=this.teamList[i];break}}return e};e.prototype.onAwardBcActReq=function(t,e){app.ProtocolRequest.AwardBcActReq(t,e)};e.prototype.onJoinBcMapReq=function(){if(this.checkInCD()){manager.FlowManager.instance.flowByStyle1(app.getLang("zy_Error_CDTime"));return}app.ProtocolRequest.JoinBcMapReq()};e.prototype.onAskBcAgree=function(t,e){app.ProtocolRequest.AskBcAgree(t,e)};e.prototype.onLeaveBcReq=function(){app.ProtocolRequest.LeaveBcReq()};e.prototype.onOpenBcInfReq=function(){app.ProtocolRequest.OpenBcInfReq()};e.prototype.onStartBcReq=function(){app.ProtocolRequest.StartBcReq()};e.prototype.onChangeTeamNameReq=function(t){this.onChangeBcNameReq(1,t)};e.prototype.onChangeGuildNcReq=function(t){this.onChangeBcNameReq(2,t)};e.prototype.onChangeBcNameReq=function(t,e){app.ProtocolRequest.ChangeBcNameReq(t,e)};e.prototype.onTransfLeaderBcReq=function(t){app.ProtocolRequest.TransfLeaderBcReq(t)};e.SINGLE_KEY="team.TeamZhanyouModel";e.ZHANYOU_INFO_UPDATE="teamZhanyou.onBtCompanionNtf";e.ZHANYOU_SIGLE_INFO="teamZhanyou.onBtCompanionModifyNtf";e.ZHANYOU_CD_TIME_CHANGE="teamZhanyou.onNoBtCompanionNtf";e.ZHANYOU_BCNAME_CHANGE="teamZhanyou.onChangeBcNtf";return e}(app.ModelBase);c.TeamZhanyouModel=t})(team||(team={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var team;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.btnduizhang.clickHandler=new Laya.Handler(this,this.captainHandler);this.btnsiliao.clickHandler=new Laya.Handler(this,this.siliaoHandler);this.btntuichu.clickHandler=new Laya.Handler(this,this.onQuite);this.btnchakan.clickHandler=new Laya.Handler(this,this.chakanHandler)};e.prototype.onQuite=function(){game.Alert.show(app.getLang("zy_tishi_quit"),new Laya.Handler(this,this.onOKLeaveHandler),new Laya.Handler)};e.prototype.onOKLeaveHandler=function(){i.TeamZhanyouModel.getIns().onLeaveBcReq()};e.prototype.captainHandler=function(){var t=i.TeamZhanyouModel.getIns().result[0];if(t){if(Uint64.equal(game.Context.mainRoleId,t.id)){if(Uint64.equal(this.uid,game.Context.mainRoleId)){manager.FlowManager.instance.flowByStyle1(app.getLang("zy_caption_1"))}else{game.Alert.show(app.getLang("zy_caption_2",this.name),new Laya.Handler(this,this.onOKCaptainHandler,[this.uid]),new Laya.Handler)}}else{manager.FlowManager.instance.flowByStyle1(app.getLang("zy_caption_3"))}}};e.prototype.onOKCaptainHandler=function(t){i.TeamZhanyouModel.getIns().onTransfLeaderBcReq(t)};e.prototype.chakanHandler=function(){if(!Uint64.equal(this.uid,game.Context.mainRoleId)){app.ProtocolRequest.GetShowPlayerReq(this.uid)}else{manager.FlowManager.instance.flowByStyle1(app.getLang("zy_check"))}};e.prototype.siliaoHandler=function(){if(!Uint64.equal(this.uid,game.Context.mainRoleId)){chat.ChatModel.getIns().showSiLiaoAlert([this.uid,this.uname])}else{manager.FlowManager.instance.flowByStyle1(app.getLang("zy_talk"))}};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t,e){this.uid=t.id;this.uname=t.name;this.labelname.text=t.name;this.clipzhandoushuzi.value=t.score.toString10();var i=e==0;this.imgduizhang.visible=i;this.imgrenwu.skin="";this.resetBtns();this.setAvatar(t.fashion,t.setskin>0?t.setskin:t.classSkin)};e.prototype.resetBtns=function(){var t=Uint64.equal(game.Context.mainRoleId,this.uid);if(t){this.btntuichu.visible=true;this.btnduizhang.visible=false;this.btnsiliao.visible=false;this.btnchakan.visible=false}else{this.btntuichu.visible=false;this.btnduizhang.visible=false;this.btnsiliao.visible=true;this.btnchakan.visible=true;if(i.TeamZhanyouModel.getIns().result.length>0){var e=i.TeamZhanyouModel.getIns().result[0].id;if(Uint64.equal(game.Context.mainRoleId,e)){this.btnduizhang.visible=true}}}};e.prototype.setAvatar=function(t,e){var i;var n=csv.SkinProxy.getIns().getCfg(t);if(n){i=n.modelres}else{i=csv.DefclassProxy.getIns().getCfg(e).model}if(this.skt&&this.skt.parent){this.skt.removeSelf()}else{this.skt=new common.CSkt}this.skt.init(role.RoleVO.getSkinSkt(i));this.skt.x=this.imgrenwu.width*.5;this.skt.y=this.imgrenwu.height*.5;this.skt.scale(.6,.6);this.imgrenwu.addChild(this.skt)};e.SINGLE_KEY="team.TeamRoleItem";return e}(ui.zhanyou.zhanyouitemUI);i.TeamRoleItem=t})(team||(team={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var team;(function(a){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listhuoyuedu.itemRender=a.ZhanyouHuoYueItem;this.listhuoyuedu.renderHandler=new Laya.Handler(this,this.onRenderHandler);this.listhuoyuedu.scrollRectOffY=20;this.listhuoyuedu.spaceY=15;this.listhuoyuedu.array=csv.TeamZhangyouProxy.getIns().getArray();this.lishilist.scrollRectOffY=10;this.lishilist.renderHandler=new Laya.Handler(this,this.onHistoryRenderHandler);this.lishilist.spaceY=10;this.views=[this.jiangli1,this.jiangli2,this.jiangli3]};e.prototype.onShowTips=function(){app.ViewManager.toggleDialog(a.TeamHuoyueShuomTips,1,0)};e.prototype.onHistoryRenderHandler=function(t){var e=t.dataSource;t.txtmiaoshu.text="";var i=csv.TeamZhangyouProxy.getIns().getCfgByType(e.acttype);if(i){t.txtmiaoshu.text=app.getLang("zy_tishi_list",e.name,app.getLang(i.name),i.activity);var n=new Date(e.acttime*1e3);t.labelriqi.text=n.getMonth()+1+"-"+n.getDate();var a=n.getMinutes();var o=a<10?"0"+a:a.toString();var s=n.getHours();var r=s<10?"0"+s:s.toString();t.labelshijian.text=r+":"+o}};e.prototype.onRenderHandler=function(t){t.setDate(t.dataSource)};e.prototype.onDisplay=function(){a.TeamZhanyouModel.getIns().on(a.TeamZhanyouModel.ZHANYOU_SIGLE_INFO,this,this.refreshAll);a.TeamZhanyouModel.getIns().on(a.TeamZhanyouModel.ZHANYOU_INFO_UPDATE,this,this.refreshAll);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){a.TeamZhanyouModel.getIns().off(a.TeamZhanyouModel.ZHANYOU_SIGLE_INFO,this,this.refreshAll);a.TeamZhanyouModel.getIns().off(a.TeamZhanyouModel.ZHANYOU_INFO_UPDATE,this,this.refreshAll)};e.prototype.refreshAll=function(){var t=a.TeamZhanyouModel.getIns().totalact;this.shuliangimg.text=t+"";this.lishilist.array=a.TeamZhanyouModel.getIns().record;this.imgbg.skin="public/bg_jiugong_05.png";var e=csv.TeamZhangyouProxy.getIns().getBcnams();for(var i=e.length-1;i>=0;i--){if(t>=e[i].activity){this.imgbg.skin="res/static/zhanyouzhanmu/"+e[i].show+".png";break}}var n=a.TeamZhanyouModel.getIns().result;for(var i=0;i<e.length;i++){this.views[i].setData(n[i])}};e.SINGLE_KEY="team.TeamZhanyouAwardView";return e}(ui.zhanyou.zhanyouhuoyuejiangliviewUI);a.TeamZhanyouAwardView=t})(team||(team={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var team;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.btnxiugai1.clickHandler=new Laya.Handler(this,this.changeTeamName);this.btnxiugai2.clickHandler=new Laya.Handler(this,this.changeTeamNotice);this.listrenwu.itemRender=i.TeamRoleItem;this.listrenwu.renderHandler=new Laya.Handler(this,this.onItemRenderHandler);this.labelwenzi.overflow="hidden"};e.prototype.onItemRenderHandler=function(t,e){t.setData(t.dataSource,e)};e.prototype.changeTeamName=function(){app.ViewManager.toggleDialog(i.TeamZhanyouModifyName,1,0)};e.prototype.changeTeamNotice=function(){app.ViewManager.toggleDialog(i.TeamNoticeEditView,1,0)};e.prototype.onDisplay=function(){i.TeamZhanyouModel.getIns().on(i.TeamZhanyouModel.ZHANYOU_INFO_UPDATE,this,this.refreshAll);i.TeamZhanyouModel.getIns().on(i.TeamZhanyouModel.ZHANYOU_CD_TIME_CHANGE,this,this.onTimeChange);i.TeamZhanyouModel.getIns().on(i.TeamZhanyouModel.ZHANYOU_BCNAME_CHANGE,this,this.updateNotic);i.TeamZhanyouModel.getIns().onOpenBcInfReq();this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){i.TeamZhanyouModel.getIns().off(i.TeamZhanyouModel.ZHANYOU_INFO_UPDATE,this,this.refreshAll);i.TeamZhanyouModel.getIns().off(i.TeamZhanyouModel.ZHANYOU_CD_TIME_CHANGE,this,this.onTimeChange);i.TeamZhanyouModel.getIns().off(i.TeamZhanyouModel.ZHANYOU_BCNAME_CHANGE,this,this.updateNotic)};e.prototype.onTimeChange=function(t){if(t>0){Laya.Dialog.closeAll()}};e.prototype.refreshAll=function(){this.listrenwu.array=i.TeamZhanyouModel.getIns().result;this.updateNotic();this.imgwernzikuang.skin="public/bg_jiugong_05.png";var t=csv.TeamZhangyouProxy.getIns().getBcnams();for(var e=t.length-1;e>=0;e--){if(i.TeamZhanyouModel.getIns().totalact>=t[e].activity){this.imgwernzikuang.skin="res/static/zhanyouzhanmu/"+t[e].show+".png";break}}};e.prototype.updateNotic=function(){var t=i.TeamZhanyouModel.getIns().bcname;var e=i.TeamZhanyouModel.getIns().bntf;this.namelab1.text=t.length>0?t:app.getLang("zy_team_name");this.labelwenzi.text=e.length>0?e:app.getLang("zy_team_notic")};e.SINGLE_KEY="team.TeamZhanyouInfoView";return e}(ui.zhanyou.zhanyouviewUI);i.TeamZhanyouInfoView=t})(team||(team={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var team;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.btnzudui.clickHandler=new Laya.Handler(this,this.openTeam);this.btnxuanshi.clickHandler=new Laya.Handler(this,this.onJoinBcMapReq)};e.prototype.openTeam=function(){i.TeamModel.getIns().openTeam(csv.FunctionsProxy.ENUMS.TEAM_ZHANYOU_INVITE)};e.prototype.onJoinBcMapReq=function(){var t=i.TeamModel.getIns().myTeamInfo;if(!t){manager.FlowManager.instance.flowByStyle1(app.getLang("队伍不存在"));return}if(Uint64.equal(t.captainId,game.Context.mainRoleId)){if(t.copyId==3){if(t.count==3){i.TeamModel.getIns().openTeam(csv.FunctionsProxy.ENUMS.TEAM_ZHANYOU_INVITE)}else{manager.FlowManager.instance.flowByStyle1(app.getLang("人数不足"))}}else{manager.FlowManager.instance.flowByStyle1(app.getLang("zy_team_type"))}}else{manager.FlowManager.instance.flowByStyle1(app.getLang("请等待队长操作"))}};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.SINGLE_KEY="team.TeamZhanyouInviteView";return e}(ui.zhanyou.zhanyouzhaomuviewUI);i.TeamZhanyouInviteView=t})(team||(team={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var team;(function(i){var t=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.baglist.itemRender=i.TeamZhanyouShopItem;this.baglist.renderHandler=new Laya.Handler(this,this.onRenderHandler);this.baglist.vScrollBarSkin=" ";var t=csv.MallProxy.getIns().getArrayByType(shop.ShopModel.ENNUMS.ZHANYOU_SHOP);this.baglist.array=t;this.jiabtn.clickHandler=new Laya.Handler(this,this.showTips)};t.prototype.showTips=function(){var t=game.ItemUtil.createVO(game.ItemUtil.ENUMS.ZHANYOU_MONEY);tip.TipManager.show(t,true)};t.prototype.onRenderHandler=function(t){t.setData(t.dataSource)};t.prototype.onDisplay=function(){mall.MallModel.getIns().on(mall.MallModel.UPDATE_MALL_BUY_RECORD_DATA,this,this.onRefreshHandle);this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){mall.MallModel.getIns().on(mall.MallModel.UPDATE_MALL_BUY_RECORD_DATA,this,this.onRefreshHandle)};t.prototype.onRefreshHandle=function(){this.refreshAll()};t.prototype.refreshAll=function(){this.imgyuanbao.parserIconByItemId(game.ItemUtil.ENUMS.ZHANYOU_MONEY);var t=game.GridsModel.getIns().getItemCount(game.ItemUtil.ENUMS.ZHANYOU_MONEY);this.shuliangimg.text=game.MoneyModel.format(t);this.shuliangimg.text=""+game.GridsModel.getIns().getItemCount(game.ItemUtil.ENUMS.ZHANYOU_MONEY);this.baglist.refresh()};t.SINGLE_KEY="team.TeamZhanyouShopView";return t}(ui.shangcheng.zhanyoushangdianUI);i.TeamZhanyouShopView=t})(team||(team={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var team;(function(h){var t=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listbaoxiang.itemRender=h.ZhanyouAwardItem;this.listbaoxiang.renderHandler=new Laya.Handler(this,this.onRenderHandler);var t=csv.TeamZhangyouProxy.getIns().getAwards();this.labelshuzi1.text=t[0].activity+"";this.labelshuzi2.text=t[1].activity+"";this.labelshuzi3.text=t[2].activity+"";this.labelshuzi4.text=t[3].activity+"";this.labelshuzi5.text=t[4].activity+""};t.prototype.onRenderHandler=function(t,e){t.setData(t.dataSource,this._data.id,e)};t.prototype.onDisplay=function(){this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){};t.prototype.refreshAll=function(){};t.prototype.setData=function(t){if(t){this._data=t;this.imgtouxiang.skin=role.RoleVO.getHeadIconUrl(t.setskin>0?t.setskin:t.classSkin);this.labelname.text=t.name;var e=csv.TeamZhangyouProxy.getIns().getAwards();this.listbaoxiang.array=e;this.setRwd();this.jindutiao1.visible=false;this.jindutiao2.visible=false;if(Uint64.equal(game.Context.mainRoleId,t.id)){this.jindutiao2.visible=true}else{this.jindutiao1.visible=true}this.imgframe.skin=csv.HeadFrameProxy.getIns().getIcon(t.headframeId)}};t.prototype.setRwd=function(){var t=csv.TeamZhangyouProxy.getIns().getAwards();var e=h.TeamZhanyouModel.getIns().getBtComInfo(this._data.id).act;this.labelnum.text=e+"";var i=[.18,.37,.55,.74,.93,1];var n=0,a=0,o=1;for(var s=0;s<i.length;s++){if(t[s]){if(e<=t[s].activity){n=s;break}}else{n=s}}var r=0;var l=0;if(n>0){r=t[n-1].activity;if(t[n]){a=t[n].activity-r}else{a=csv.TeamZhangyouProxy.getIns().getActivityMax()-r}l=i[n-1]}else{a=t[n].activity}if(a>0){o=(e-r)/a}else{o=1}this.jindutiao1.value=l+(i[n]-l)*o;this.jindutiao2.value=l+(i[n]-l)*o};t.SINGLE_KEY="team.ZhanyouActiveView";return t}(ui.zhanyou.zhanyoutouxiangitemUI);h.ZhanyouActiveView=t})(team||(team={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var team;(function(l){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.on(Laya.Event.CLICK,this,this.onClickHandler)};e.prototype.onClickHandler=function(){var t=l.TeamZhanyouModel.getIns().getBtComInfo(this._uid);var e=t.actgain>>this._index&1;if(t.act>=this._cfg.activity&&e==0){l.TeamZhanyouModel.getIns().onAwardBcActReq(this._uid,this._cfg.id)}else{tip.TipManager.show(this._vo)}};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t,e,i){var n=l.TeamZhanyouModel.getIns().getBtComInfo(e);var a=app.str2Array(t.item,"-");var o=a[0];var s=game.ItemUtil.createVO(o);this.imgbaoxiang.skin=s.getIconUrl();this._vo=s;this._uid=e;this._cfg=t;this._index=i+1;this.onStop();var r=n.actgain>>this._index&1;if(n.act>=t.activity){if(r==0){this.onPlay()}}this.yilingqu.visible=false;if(r==1){this.yilingqu.visible=true}if(parseInt(o)==game.ItemUtil.ENUMS.TONGBI){this.labelnum.text=game.MoneyModel.format(a[1])}else{this.labelnum.text=a[1]}};e.prototype.onPlay=function(){this.animationjihuo.play(0,true);this.animationjihuo.visible=true};e.prototype.onStop=function(){this.animationjihuo.stop();this.animationjihuo.visible=false};e.SINGLE_KEY="team.ZhanyouAwardItem";return e}(ui.zhanyou.zhanyouhuoyuedubaoxiangitemUI);l.ZhanyouAwardItem=t})(team||(team={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var team;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.on(Laya.Event.CLICK,this,this.onHandler)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setDate=function(t){this.labelqiandao.text=app.getLang(t.name);this.labelshuzhi.text="+"+t.activity;this._fid=t.function};e.prototype.onHandler=function(){if(csv.FunctionsProxy.getIns().isOpen(this._fid,true)){game.WindowsResigter.call(this._fid)}};e.SINGLE_KEY="team.ZhanyouHuoYueItem";return e}(ui.zhanyou.zhanyouhuoyueduitemUI);t.ZhanyouHuoYueItem=e})(team||(team={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var team;(function(t){var e=function(i){__extends(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){i.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.lbls=[this.labelzhi1,this.labelzhi2,this.labelzhi3];this.imgs=[this.imgkuang1,this.imgkuang2,this.imgkuang3];var t=csv.TeamZhangyouProxy.getIns().getBcnams();for(var e=0;e<t.length;e++){this.lbls[e].text=t[e].activity+"";this.imgs[e].skin="res/static/zhanyouzhanmu/"+t[e].show+".png"}};t.prototype.onDisplay=function(){this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){};t.prototype.refreshAll=function(){};t.SINGLE_KEY="team.TeamHuoyueShuomTips";return t}(ui.zhanyou.zhanyouhuoyuedutipsUI);t.TeamHuoyueShuomTips=e})(team||(team={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var team;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.txtgonggao.maxChars=parseInt(app.str2Array(game.Config.getParams(609),";")[1])};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){var t=i.TeamZhanyouModel.getIns().bntf;if(!t||t.length==0){this.txtgonggao.text=app.getLang("zy_team_notic")}else{this.txtgonggao.text=t}};e.prototype.onChangeGuildNcReq=function(){var t=app.str2Array(game.Config.getParams(609),";")[1];if(this.txtgonggao.text.length>t){manager.FlowManager.instance.flowByStyle1(app.getLang("公告{0}字以内",t));return}if(this.txtgonggao.text==app.getLang("zy_team_notic")){manager.FlowManager.instance.flowByStyle1(app.getLang("zy_team_notic"));return}if(this.txtgonggao.text==""){game.Alert.show(app.getLang("zy_team_notic"));return}i.TeamZhanyouModel.getIns().onChangeGuildNcReq(this.txtgonggao.text);this.close()};e.SINGLE_KEY="team.TeamNoticeEditView";return e}(guild.GuildNoticeEditView);i.TeamNoticeEditView=t})(team||(team={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var team;(function(n){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.quxiaobtn.clickHandler=new Laya.Handler(this,this.onAgree,[0]);this.quedingbtn.clickHandler=new Laya.Handler(this,this.onAgree,[1]);this.closebtn.clickHandler=new Laya.Handler(this,this.close);this.x=(Laya.stage.width-this.width)/2;this.y=(Laya.stage.height-this.height)/2};e.prototype.onAgree=function(t){if(t==1&&this.aflag==2){if(!game.GridsModel.getIns().hasEnoughItems(game.Config.getParams(617),false,true)){return}}n.TeamZhanyouModel.getIns().onAskBcAgree(this.aflag,t);this.flag=true;this.close()};e.prototype.onDisplay=function(){game.Context.on(game.ContextEvent.CHANGE_MAP,this,this.onChangeMap);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){game.Context.off(game.ContextEvent.CHANGE_MAP,this,this.onChangeMap);Laya.timer.clear(this,this.loopFreshTime);if(this.flag){return}n.TeamZhanyouModel.getIns().onAskBcAgree(this.aflag,0)};e.prototype.onChangeMap=function(t){var e=csv.MapProxy.getIns().getMapType(t);var i=false;if(e==csv.MapProxy.MAP_TYPE.HOME||e==csv.MapProxy.MAP_TYPE.GUAJI){i=true}if(!i){app.ViewManager.toggleView(n.TeamTipsView,app.AppContainer.talkLayer,-1)}};e.prototype.refreshAll=function(){this.flag=false;this.aflag=this.dataSource[0];this.endtime=this.dataSource[1];var t=this.endtime-game.Context.getServerTime();this.quxiaobtn.label=app.getLang("再想想({0}s)",t);if(this.aflag==1){this.label.text=app.getLang("zy_changeMap_alert");this.quedingbtn.label=app.getLang("zy_btn_1")}else if(this.aflag==2){this.label.text=app.getLang("zy_jiemeng_alert");this.quedingbtn.label=app.getLang("zy_btn_2")}this.gezi.setData(game.ItemUtil.parserList(game.Config.getParams(617))[0]);this.startLoop()};e.prototype.startLoop=function(){Laya.timer.loop(1e3,this,this.loopFreshTime)};e.prototype.loopFreshTime=function(){var t=this.endtime-game.Context.getServerTime();this.quxiaobtn.label=app.getLang("再想想({0}s)",t);if(t<=0){this.close()}};e.prototype.close=function(){app.ViewManager.toggleView(n.TeamTipsView,app.AppContainer.talkLayer,-1)};e.SINGLE_KEY="team.TeamTipsView";return e}(ui.zhanyou.zhanyoutishiUI);n.TeamTipsView=t})(team||(team={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var team;(function(i){var t=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);var t=app.str2Array(game.Config.getParams(608),";")[1];this.quming.maxChars=parseInt(t);this.shuoming.text=app.getLang("zy_team_namenumber",t);this.itemmoney.parserIcon(game.Config.getParams(607),this.labelmoney)};t.prototype.onDisplay=function(){this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){};t.prototype.refreshAll=function(){};t.prototype.checkChange=function(){if(this.quming.text==""){game.Alert.show(app.getLang("zy_team_name"));return}if(game.GridsModel.getIns().hasEnoughItems(game.Config.getParams(202),false,true)){i.TeamZhanyouModel.getIns().onChangeTeamNameReq(this.quming.text);this.close()}};t.SINGLE_KEY="team.TeamZhanyouModifyName";return t}(guild.GuildModifyName);i.TeamZhanyouModifyName=t})(team||(team={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var team;(function(i){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.action=false;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this)};t.prototype.refreshAll=function(){if(this._model.myTeamInfo){var t=[];for(var e=0;e<3;e++){t.push(this._model.myMembers[e])}this.listduiwu.array=t;this.startLoopTime();this.setBtnState();var i=csv.TeamProxy.getIns().getCfg(this._model.myTeamInfo.copyId);this.labeltongyi.text=app.getLang("队长发起进入{0}，是否同意？",app.getLang(i.roomname))}else{this.onCancle()}};t.prototype.onUnDisplay=function(){if(this.action){this.action=false;return}i.TeamZhanyouModel.getIns().onAskBcAgree(1,0);this._model.off(i.TeamEvent.READY_CHANGE,this,this.onReadyChange);this._model.off(i.TeamEvent.MY_TEAM_CHANGE,this,this.refreshAll)};t.prototype.onReady=function(){this.btnqueren.disabled=true;this.btnquxiao.disabled=true;if(this.action==false){this.action=true;i.TeamZhanyouModel.getIns().onAskBcAgree(1,1)}};t.prototype.onCancle=function(){Laya.timer.clear(this,this.loopFreshTime);this.close()};t.prototype.startLoopTime=function(){var t=this.dataSource-game.Context.getServerTime();this.labeldaojishi.text=app.getLang("倒计时:")+t;Laya.timer.loop(1e3,this,this.loopFreshTime)};t.prototype.loopFreshTime=function(){var t=this.dataSource-game.Context.getServerTime();if(t>0){this.labeldaojishi.text=app.getLang("倒计时:")+t}else{this.onCancle()}};t.SINGLE_KEY="team.TeamZhanyouReadyView";return t}(i.TeamReadyView);i.TeamZhanyouReadyView=t})(team||(team={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var team;(function(t){var e=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};t.prototype.onDisplay=function(){this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){};t.prototype.refreshAll=function(){};t.prototype.setData=function(t){e.prototype.setData.call(this,t);this.itemdaoju.shuzi.text=game.MoneyModel.format(t.num)};t.prototype.onMouseUpHandler=function(){tip.TipManager.showNumChooseItemTip(this.itemdaoju.data,this.data,true,[tip.TipManager.TIP_BTN_TYPE.BUY_ZHANYOU_SHOP])};t.SINGLE_KEY="team.TeamZhanyouShopItem";return t}(shop.ShopRongYuItem);t.TeamZhanyouShopItem=e})(team||(team={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var team;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.zujianchenggong.on(Laya.Event.COMPLETE,this,this.onComplete)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){this.zujianchenggong.stop()};e.prototype.refreshAll=function(){this.zujianchenggong.play(0,false)};e.prototype.onComplete=function(){this.close()};e.SINGLE_KEY="team.TeamZhanyouSuccessView";return e}(ui.zhanyou.zhanyoujieyiitemUI);t.TeamZhanyouSuccessView=e})(team||(team={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tip;(function(t){var u=Laya.Point;var e=laya.net.Loader;var c=laya.utils.Tween;var g=function(){function a(){}a.vecToAngle=function(t,e){var i=a.convertNormalVec(t,e);return-this.getRotateAngle(i.x,i.y,1,0)};a.getRotateAngle=function(t,e,i,n){var a=1e-6;var o=Math.acos(-1);var s,r,l,h;s=Math.sqrt(t*t+e*e);t/=s;e/=s;s=Math.sqrt(i*i+n*n);i/=s;n/=s;r=t*i+e*n;if(Math.abs(r-1)<=a)h=0;else if(Math.abs(r+1)<=a)h=o;else{var p=void 0;h=Math.acos(r);p=t*n-i*e;if(p<0){h=2*o-h}}l=h*180/o;return l};a.distance=function(t,e){return Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y))};a.convertNormalVec=function(t,e){var i=new u(e.x-t.x,e.y-t.y);var n=a.distance(t,e);i.x/=n;i.y/=n;return i};return a}();var a=function(i){__extends(t,i);function t(t,e){if(e===void 0){e=""}return i.call(this,t,e,false)||this}return t}(game.AniView);var i=function(){function n(t){this.curIndex=0;this.isLoop=false;this.parent=t||app.AppContainer.flowLayer}Object.defineProperty(n.prototype,"rotation",{set:function(t){if(this.aniEffect){this.aniEffect.rotation=t}},enumerable:true,configurable:true});n.prototype.load=function(t,e,i,n,a,o){if(t===void 0){t=0}if(e===void 0){e=0}if(i===void 0){i="skill_tuowei01"}if(n===void 0){n=false}this.x=t;this.y=e;this.removeCallBack=o;this.url=i;this.checkTime=a||0;this.isLoop=n;this.key=Math.random();if(this.beforehand==undefined){this.beforehand="skill_tuowei01;skill_tuowei02"}var s=this.beforehand.split(";");this.resList=s;this.startLoad()};n.prototype.startLoad=function(){if(this.resList.length>0){var e=this.resList.pop();if(n.cacheList.indexOf(e)==-1){n.cacheList.push(e);var i=Laya.Pool.getItemByClass("fly_effect_"+e,a);i.once(game.AniView.EVENTS.ANI_COMPLETE,this,function t(){Laya.Pool.recover("fly_effect_"+e,i);this.startLoad()});i.load(e,game.AniView.FILE_NAME.UI)}else{this.startLoad()}}else{var t=Laya.Pool.getItemByClass("fly_effect_"+this.url,a);this.aniEffect=t;this.aniEffect.visible=true;this.curTime=Laya.timer.currTimer;t.x=this.x;t.y=this.y;this.parent.addChild(t);Laya.timer.once(t.interval,this,this.ef);t.load(this.url);this.rotation=this.curAngle||0;if(this.loadEnd){this.loadEnd.run()}t.play(0,false)}};n.prototype.dispose=function(){var t=Laya.timer.currTimer-this.curTime;console.log(this.url+","+this.key+"播放完成 销毁资源! 消耗时间:"+t+"毫秒");this.aniEffect.removeSelf();Laya.Pool.recover("fly_effect_"+this.url,this.aniEffect);if(this.removeCallBack){this.removeCallBack.run()}};n.prototype.stop=function(){this.aniEffect.visible=false;this.isLoop=false};n.prototype.ef=function(){var t=Laya.timer.currTimer-this.curTime;if(this.isLoop){if(this.checkTime!=0&&t>this.checkTime){this.dispose()}else{Laya.timer.once(this.aniEffect.interval,this,this.ef);if(this.curIndex>=this.aniEffect.count-1){this.curIndex=0}this.aniEffect.gotoAndStop(this.curIndex)}}else{if(this.curIndex>=this.aniEffect.count-1){this.dispose()}else{Laya.timer.once(this.aniEffect.interval,this,this.ef)}this.aniEffect.gotoAndStop(this.curIndex)}this.curIndex++};n.cacheList=[];return n}();var n=function(){function t(){}t.prototype.play=function(t,e,i){if(i===void 0){i=800}this.s=t;this.e=e;new o(app.AppContainer.flowLayer,t,e)};t.prototype.onRemoveCallBack=function(){};t.prototype.onComplete=function(t){var e=t.aniEffect;Laya.Tween.to(e,{x:this.e.x,y:this.e.y},this.time,Laya.Ease.linearNone,new Laya.Handler(this,this.endHandler,[t]))};t.prototype.endHandler=function(t){t.stop()};return t}();t.FlyIconMan=n;var o=function(){function t(t,e,i){this.style=1;this.time=1500;this.partPtah="res/static/particle/flyParticle.part";this.s=e;this.e=i;this.parent=t;this.onDisplay()}t.prototype.onDisplay=function(){Laya.loader.load(this.partPtah,Laya.Handler.create(this,this.onLoadEnd),null,e.JSON)};t.prototype.onLoadEnd=function(){var t=Laya.loader.getRes(this.partPtah);var e=new u;var i=new Float32Array(4);i[0]=i[1]=i[2]=i[3]=1;i[2]=0;var n=new Float32Array(4);n[0]=n[1]=n[2]=n[3]=0;t.maxStartColor=i;var a=new Float32Array(4);a[0]=a[1]=a[3]=1;a[2]=0;t.minStartColor=a;t.maxPartices=500;t.minEndColor=i;t.maxEndColor=i;var o=new Float32Array(4);if(this.style==1){t.minStartSize=0;t.maxStartSize=7.94;t.minEndSize=5.59;t.maxEndSize=25;var s=g.distance(this.s,this.e);var r=g.convertNormalVec(this.s,this.e);var l=.75;e.x=this.s.x+r.x*s*l;e.y=this.s.y+r.y*s*l;r.x*=1e4;r.y*=-1e4;o[0]=r.x;o[1]=r.y;o[2]=0}else{o[0]=o[1]=o[2]=0}t.gravity=o;t.textureName="res/static/particle/texture.png";var h=Laya.Particle2D;var p=new h(t);this.partIns=p;this.parent.addChild(p);p.x=this.s.x;p.y=this.s.y;p.emitter.start();p.play();if(this.style==1){Laya.timer.once(this.time,this,this.endHandler)}else{c.to(p,{x:this.e.x,y:this.e.y},this.time,Laya.Ease.linearNone,new Laya.Handler(this,this.endHandler))}};t.prototype.endHandler=function(){this.partIns.destroy()};return t}()})(tip||(tip={}));var TipTitleView=tip.TipTitleView;var TipFengeView=tip.TipFengeView;var TipMeiator=tip.TipMeiator;var tip;(function(r){var t=function(){function t(t){this.withNumchoose=true;this.skin=t;this.buyCompont=new ui.tips.banghuishangdiantipUI;t.addChild(this.buyCompont);this._numChoose=new game.NumChoose(this.buyCompont.btnjian,this.buyCompont.btnjia,this.buyCompont.labelnum,this.buyCompont.btnmax);this._numChoose.init();this._numChoose.on(game.NumChoose.VALUE_CHANGE,this,this.onValueChange)}t.prototype.onValueChange=function(){var t=parseInt(app.str2Array(this.price,"-")[1]);var e=this._numChoose.currValue;this.buyCompont.labelnum.text=e+"";this.buyCompont.labelmoneynum.text=e*t+"";this.refreshTextColor()};t.prototype.refreshTextColor=function(){var t=this.getNeedMoneyVO(this.price,this._numChoose.currValue);var e="#ffffff";var i=game.GridsModel.getIns().hasEnoughItems(t);if(!i){e="#ff0000"}this.buyCompont.labelmoneynum.color=e};t.prototype.getNeedMoneyVO=function(t,e){if(e===void 0){e=1}var i=t.split("-");var n=game.ItemUtil.createVO(parseInt(i[0]));n.setCount(parseInt(i[1])*e);return n};t.prototype.getNumChoose=function(){return this._numChoose.currValue};t.prototype.updateByMaxValue=function(t,e,i,n,a){this.price=n;var o=app.str2Array(n,"-");if(a!=-1){this.buyCompont.labelnum.text="1";this.buyCompont.labelmoneynum.text=o[1];this.buyCompont.x=e;this.buyCompont.y=i;this.buyCompont.labelshuliang.visible=this.withNumchoose;this.buyCompont.btnjian.visible=this.withNumchoose;this.buyCompont.btnjia.visible=this.withNumchoose;this.buyCompont.imgnum.visible=this.withNumchoose;this.buyCompont.labelnum.visible=this.withNumchoose;this.buyCompont.btnmax.visible=this.withNumchoose;this._numChoose.currValue=this._numChoose.minValue;this._numChoose.maxValue=a;this.refreshTextColor();var s=this.buyCompont.height;if(!this.withNumchoose){s*=.5;this.buyCompont.y=i-s}this.buyCompont.moneyIcon.parserIcon(this.price);t+=s+r.TipManager.GAPS.GAP_ICON;this.skin.addChild(this.buyCompont)}else{this._numChoose.currValue=this._numChoose.minValue;t+=r.TipManager.GAPS.GAP_ICON;this.buyCompont.removeSelf()}return t};return t}();r.ShopNumChoose=t})(tip||(tip={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tip;(function(t){var s=laya.maths.Point;var e=laya.display.Sprite;var d=function(){function o(){}o.Normalsize=function(t){var e=Math.sqrt(t.x*t.x+t.y*t.y);return new s(t.x/e,t.y/e)};o.RotateAngle=function(t,e){e=e/180*Math.PI;var i=o.Normalsize(t);var n=i.x;var a=i.y;return new s(Math.cos(e)*n-Math.sin(e)*a,Math.sin(e)*n+Math.cos(e)*a)};return o}();var r=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t.seconds=1;t.randomR=7.5;t.custScale=1;t.img=new Laya.Image;t.addChild(t.img);return t}t.prototype.init=function(t,e){if(t===void 0){t=1.5}if(e===void 0){e="res/static/par.png"}this.img.skin=e;this.custScale=t;this.graphics.clear();this.scaleX=this.scaleY=Math.random()*this.custScale;this.alpha=Math.random()};t.prototype.initXY=function(){var t=this.randomR;var e=t*(Math.random()>.5?1:-1);var i=d.RotateAngle(new s(0,1),Math.random()*360);var n=i.x*Math.random()*e;var a=i.y*Math.random()*e;this.x=n;this.y=a};t.prototype.play=function(t,e,i){var a=this;var n=d.Normalsize(new s(t.x-this.x,t.y-this.y));this.target=t;this._tarDic=d.Normalsize(this.target);this.initXY();this.distance=t.distance(this.x,this.y);this.speed=this.distance/20;var o=.1;o=.25*this.seconds*Math.random();Laya.Tween.to(this,{x:e,y:i},o*1e3,Laya.Ease.quadIn,new Laya.Handler(this,function(){var t=d.RotateAngle(new s(0,1),Math.random()*360);var e=a.randomR*(Math.random()>.5?1:-1);var i=a.target.x+t.x*Math.random()*e;var n=a.target.y+t.y*Math.random()*e;Laya.Tween.to(a,{x:i,y:n},500*a.seconds,null,new Laya.Handler(a,function(){a.removeSelf();Laya.Pool.recover("SmallParicel",a)}))}))};return t}(e);var i=function(e){__extends(f,e);function f(){var t=e.call(this)||this;t.iconURL="";t.seconds=1;t.delayTime=1*t.seconds;return t}f.prototype.startPlay=function(t,e,i,n,a,o,s){if(o===void 0){o="res/static/par.png"}if(s===void 0){s=1}this.seconds=s;this.iconURL=o;t.addChild(this);this.x=e;this.y=i;var r=f.Cnt;var l=new Laya.Point(n,a);var h=l.distance(0,0);var p=h/2;this.drawTest(l,"#0000ff",h);var u=f.Angle;var c=d.RotateAngle(l,-u);var g=d.RotateAngle(l,u);this.drawTest(c,"#00ff00",p);this.drawTest(g,"#00ff00",p);this.createParicel(l,r,u,p)};f.prototype.createParicel=function(t,e,i,n){this.__target=t;this.__angle=i;this.__len=n;this.__cnt=e;this.__index=0;Laya.timer.once(this.delayTime,this,this.play)};f.prototype.play=function(){if(this.__index<this.__cnt){for(var t=0;t<this.__cnt/20;t++){this.emit(this.__target,this.__angle,this.__len);this.__index++}Laya.timer.once(this.delayTime,this,this.play)}};f.prototype.emit=function(t,e,i){var n=Math.random()*e*(Math.random()<.5?-1:1);var a=Math.random()*i;var o=d.RotateAngle(t,n);var s=Laya.Pool.getItemByClass("SmallParicel",r);s.seconds=this.seconds;s.init(undefined,this.iconURL);s.play(t,o.x*a,o.y*a);this.addChild(s)};f.prototype.drawTest=function(t,e,i){if(e===void 0){e="#00ff00"}if(i===void 0){i=100}t=d.Normalsize(t)};f.Cnt=350;f.Angle=25;return f}(Laya.Sprite);t.SmallParicelStage=i})(tip||(tip={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tip;(function(l){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.imgArr=[];t.labelArr=[];t.titleArr=[];t.fengeArr=[];t.currH=0;t.totalHeight=0;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};t.prototype.onDisplay=function(){this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){this.clear()};t.prototype.clear=function(){while(this.labelArr.length>0){var t=this.labelArr.shift();t.x=0;t.y=0;if(t&&t.parent){t.parent.removeChild(t);Laya.Pool.recover("TipLabel",t)}}this.currH=0;this.totalHeight=0};t.prototype.refreshAll=function(){var t=this.dataSource[0];this.callHandler=this.dataSource[1];var e=this.addAttr(this,t.title,this.width*.5,26);e.x=this.width*.5-e.width*.5;e.y=l.TipManager.GAPS.GAP_ICON;if(t.curLv>0){var i=this.addAttr(this.daojubox,app.getLang("tip_des_9")+app.getLang("monstersoul_attr1",t.title.split("")[0]),10);var n=new Laya.Point(i.x+i.width+l.TipManager.GAPS.GAP_V_LABLE,i.y);this.addAttr(this.daojubox,app.getLang("zhanling_text03",t.curLv),35,20,game.STYLES.GREEN_COLOR,false,n);var a=this.addAttr(this.daojubox,app.getLang("monstersoul_attr2",t.title),35);n=new Laya.Point(a.x+a.width+l.TipManager.GAPS.GAP_V_LABLE,a.y);this.addAttr(this.daojubox,"+"+t.attr1+"%",35,20,game.STYLES.GREEN_COLOR,false,n)}else{this.addAttr(this.daojubox,app.getLang("tip_des_9"),10);this.addAttr(this.daojubox,app.getLang("family_4"),35)}if(t.curLv==t.nextNeedLv){this.addAttr(this.daojubox,app.getLang("tip_des_16"),10);this.addAttr(this.daojubox,app.getLang("family_4"),35)}else{var o=this.addAttr(this.daojubox,app.getLang("tip_des_16")+app.getLang("monstersoul_attr1",t.title.split("")[0]),10);var n=new Laya.Point(o.x+o.width+l.TipManager.GAPS.GAP_V_LABLE,o.y);this.addAttr(this.daojubox,app.getLang("zhanling_text03",t.nextNeedLv),35,20,game.STYLES.GREEN_COLOR,false,n);var s=this.addAttr(this.daojubox,app.getLang("monstersoul_attr2",t.title),35);n=new Laya.Point(s.x+s.width+l.TipManager.GAPS.GAP_V_LABLE,s.y);this.addAttr(this.daojubox,"+"+t.attr2+"%",35,20,game.STYLES.GREEN_COLOR,false,n)}this.totalHeight=this.currH+this.daojubox.y;this.totalHeight+=l.TipManager.GAPS.GAP_BOTTOM;this.tipsbg.height=this.totalHeight;this.zhuangshiimg02.y=this.totalHeight-l.TipManager.GAPS.GAP_ICON;this.height=this.totalHeight;this.callHandler.run()};t.prototype.addAttr=function(t,e,i,n,a,o,s){if(i===void 0){i=53}if(n===void 0){n=20}if(a===void 0){a=game.STYLES.DESC_TXT_COLOR}if(o===void 0){o=true}if(s===void 0){s=null}var r=Laya.Pool.getItemByClass("TipLabel",Laya.Label);r.x=i;r.y=this.currH+4;r.font="SimHei";r.fontSize=n;r.color=a;r.text=e;t.addChild(r);this.labelArr.push(r);if(o){this.currH+=l.TipManager.GAPS.GAP_SUIT;this.currH+=l.TipManager.GAPS.GAP_V_BUTTON}if(s){r.x=s.x;r.y=s.y}return r};t.prototype.getTipX=function(){return this.tipsbg.x};t.prototype.getTipH=function(){return this.tipsbg.height};t.prototype.getTipW=function(){return this.tipsbg.width};t.prototype.getBottomX=function(){return this.tipsbg.x+this.tipsbg.width};t.prototype.getBottomY=function(){return this.tipsbg.y+this.tipsbg.height};t.SINGLE_KEY="tip.TipAttrCompareView";return t}(ui.tips.taozhuangtipsUI);l.TipAttrCompareView=t})(tip||(tip={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tip;(function(i){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.imgArr=[];t.labelArr=[];t.titleArr=[];t.fengeArr=[];return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.mouseEnabled=true;this.mouseThrough=false};t.prototype.onDisplay=function(){this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){this.clear()};t.prototype.getTipX=function(){return this.tipsbg.x};t.prototype.getTipH=function(){return this.tipsbg.height};t.prototype.getTipW=function(){return this.tipsbg.width};t.prototype.getBottomX=function(){return this.tipsbg.x+this.tipsbg.width};t.prototype.getBottomY=function(){return this.tipsbg.y+this.tipsbg.height};t.prototype.refreshAll=function(){this.currH=0;this.currH+=i.TipManager.TIP_INIT_GAP;this.tipData=this.dataSource[0];this.callHandler=this.dataSource[1];this.itemjineng.setData(this.tipData.id.toString(),this.tipData.lv);var t=csv.StatusProxy.getIns().getCfg(this.tipData.id,this.tipData.lv);this.labeljineng.text=t.name;if(this.tipData["alive"]){this.imgjihuo.visible=true}else{this.imgjihuo.visible=false}this.labelxiaoguo.text=app.getLang(t.explain);this.totalHeight=this.height;this.callHandler.run()};t.prototype.clear=function(){while(this.labelArr.length>0){var t=this.labelArr.shift();t.x=0;t.y=0;if(t&&t.parent){t.parent.removeChild(t);Laya.Pool.recover("TipLabel",t)}}while(this.imgArr.length>0){var e=this.imgArr.shift();if(e&&e.parent){e.parent.removeChild(e);Laya.Pool.recover("TipSuitImage",e)}}while(this.fengeArr.length>0){var i=this.fengeArr.shift();if(i&&i.parent){i.parent.removeChild(i);Laya.Pool.recover("TipFengeView",i)}}while(this.titleArr.length>0){var n=this.titleArr.shift();if(n&&n.parent){n.parent.removeChild(n);Laya.Pool.recover("TipTitleView",n)}}};t.SINGLE_KEY="tip.TipBuffView";return t}(ui.tips.bufftipsUI);i.TipBuffView=t})(tip||(tip={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tip;(function(s){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.labelArr=[];return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.titleArr=[];this.fengeArr=[];this.labelArr=[];this.daojubox.vScrollBarSkin="";this.daojubox.vScrollBar.isVertical=true;this.daojubox.vScrollBar.elasticBackTime=0;this.daojubox.vScrollBar.elasticDistance=0};t.prototype.getTipX=function(){return this.tipsbg.x};t.prototype.getTipH=function(){return this.tipsbg.height};t.prototype.getTipW=function(){return this.tipsbg.width};t.prototype.getBottomX=function(){return this.tipsbg.x+this.tipsbg.width};t.prototype.getBottomY=function(){return this.tipsbg.y+this.tipsbg.height};t.prototype.onDisplay=function(){this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){this.clear()};t.prototype.refreshAll=function(){this.callHandler=this.dataSource[1];this.currH=0;var t=this.dataSource[0];for(var e=0,i=t.length;e<i;e++){var n=t[e];var a=Laya.Pool.getItemByClass("TipTitleView",s.TipTitleView);a.y=this.currH;a.dataSource=app.getLang(n.title);this.daojubox.addChild(a);this.titleArr.push(a);this.currH+=a.height;this.currH+=s.TipManager.GAPS.GAP_V_LABLE;var o=Laya.Pool.getItemByClass("TipLabel",Laya.Label);o.y=this.currH;o.width=this.daojubox.width;o.font="SimHei";o.fontSize=20;o.color=game.STYLES.DESC_TXT_COLOR;o.text=app.getLang(n.txt);o.align="center";this.daojubox.addChild(o);this.labelArr.push(o);this.currH+=o.height;this.currH+=s.TipManager.GAPS.GAP_V_LABLE}this.currH+=s.TipManager.GAPS.GAP_BOTTOM;this.tipsbg.height=this.totalHeight=this.currH+this.daojubox.y;this.zhuangshiimg02.y=this.tipsbg.height-s.TipManager.GAPS.GAP_ICON;this.height=this.totalHeight;this.callHandler.run()};t.prototype.clear=function(){while(this.fengeArr.length>0){var t=this.fengeArr.shift();if(t&&t.parent){t.parent.removeChild(t);Laya.Pool.recover("TipFengeView",t)}}while(this.titleArr.length>0){var e=this.titleArr.shift();if(e&&e.parent){e.parent.removeChild(e);Laya.Pool.recover("TipTitleView",e)}}while(this.labelArr.length>0){var i=this.labelArr.shift();i.x=0;i.y=0;if(i){i.removeSelf();Laya.Pool.recover("TipLabel",i)}}};t.SINGLE_KEY="tip.TipDesView";return t}(ui.tips.normaltipsUI);s.TipDesView=t})(tip||(tip={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tip;(function(l){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.labelArr=[];this.weizhi.vScrollBarSkin="";this.weizhi.vScrollBar.isVertical=true;this.weizhi.vScrollBar.elasticBackTime=0;this.weizhi.vScrollBar.elasticDistance=0;this.labelmiaoshu02.text=app.getLang("cuilian_text4")};e.prototype.getTipX=function(){return this.tipsbg.x};e.prototype.getTipH=function(){return this.tipsbg.height};e.prototype.getTipW=function(){return this.tipsbg.width};e.prototype.getBottomX=function(){return this.tipsbg.x+this.tipsbg.width};e.prototype.getBottomY=function(){return this.tipsbg.y+this.tipsbg.height};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){this.clear()};e.prototype.refreshAll=function(){this.tipData=this.dataSource[0];this.callHandler=this.dataSource[1];var t=this.dataSource[2];this.currH=0;var e=this.tipData.quench[t-1];var i=csv.EquipProxy.getIns().getCuilianExtAddArr(this.tipData.pos,this.tipData.grade,t,e);for(var n=0,a=i.length;n<a;n++){var o=i[n].ele;var s=Laya.Pool.getItemByClass("TipLabel",Laya.Label);s.x=0;s.y=this.currH;s.font="SimHei";s.fontSize=20;s.color=e<o.index?game.STYLES.GRAY_COLOR:game.STYLES.YELLOW_COLOR;s.text=app.getLang("cuilian_text5",app.getLang("cuilian_grade"+o.grade+"_1"));s.align="left";this.weizhi.addChild(s);this.labelArr.push(s);this.currH+=s.height;this.currH+=l.TipManager.GAPS.GAP_V_LABLE;var r=Laya.Pool.getItemByClass("TipLabel",Laya.Label);r.x=0;r.y=this.currH;r.font="SimHei";r.fontSize=20;r.color=e<o.index?game.STYLES.GRAY_COLOR:game.STYLES.YELLOW_COLOR;r.text=Attributes.getShowLabels(i[n].props,"{0}+{1}");r.align="left";this.weizhi.addChild(r);this.labelArr.push(r);this.currH+=s.height;this.currH+=l.TipManager.GAPS.GAP_V_LABLE}this.weizhi.height=this.currH;this.currH+=l.TipManager.GAPS.GAP_BOTTOM;this.totalHeight=this.currH+this.weizhi.y;this.tipsbg.height=this.totalHeight;this.zhuangshiimg04.y=this.totalHeight-l.TipManager.GAPS.GAP_ICON;this.height=this.totalHeight;this.callHandler.run()};e.prototype.clear=function(){while(this.labelArr.length>0){var t=this.labelArr.shift();t.x=0;t.y=0;if(t){t.removeSelf();Laya.Pool.recover("TipLabel",t)}}};e.SINGLE_KEY="tip.TipEquipCuilianView";return e}(ui.zhuangbei.jinglianzhilitipUI);l.TipEquipCuilianView=t})(tip||(tip={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tip;(function(s){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.labelArr=[];this.weizhi.vScrollBarSkin="";this.weizhi.vScrollBar.isVertical=true;this.weizhi.vScrollBar.elasticBackTime=0;this.weizhi.vScrollBar.elasticDistance=0};e.prototype.getTipX=function(){return this.tipsbg.x};e.prototype.getTipH=function(){return this.tipsbg.height};e.prototype.getTipW=function(){return this.tipsbg.width};e.prototype.getBottomX=function(){return this.tipsbg.x+this.tipsbg.width};e.prototype.getBottomY=function(){return this.tipsbg.y+this.tipsbg.height};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){this.clear()};e.prototype.refreshAll=function(){this.tipData=this.dataSource[0];this.callHandler=this.dataSource[1];this.currH=0;var t=csv.EquipProxy.getIns().getRefines(this.tipData.pos,this.tipData.grade);for(var e=0,i=t.length;e<i;e++){var n=t[e];var a=Laya.Pool.getItemByClass("TipLabel",Laya.Label);a.x=0;a.y=this.currH;a.font="SimHei";a.fontSize=20;a.color=n.level>this.tipData.refineLv?game.STYLES.GRAY_COLOR:game.STYLES.YELLOW_COLOR;a.text=app.getLang("equip_refiningtips5",n.level)+":";a.align="left";this.weizhi.addChild(a);this.labelArr.push(a);this.currH+=a.height;this.currH+=s.TipManager.GAPS.GAP_V_LABLE;var o=Laya.Pool.getItemByClass("TipLabel",Laya.Label);o.x=0;o.y=this.currH;o.font="SimHei";o.fontSize=20;o.color=n.level>this.tipData.refineLv?game.STYLES.GRAY_COLOR:game.STYLES.YELLOW_COLOR;o.text=csv.EquipProxy.getIns().getAddRefineDes(n);o.align="left";this.weizhi.addChild(o);this.labelArr.push(o);this.currH+=a.height;this.currH+=s.TipManager.GAPS.GAP_V_LABLE}this.weizhi.height=this.currH;this.currH+=s.TipManager.GAPS.GAP_BOTTOM;this.totalHeight=this.currH+this.weizhi.y;this.tipsbg.height=this.totalHeight;this.zhuangshiimg04.y=this.totalHeight-s.TipManager.GAPS.GAP_ICON;this.height=this.totalHeight;this.callHandler.run()};e.prototype.clear=function(){while(this.labelArr.length>0){var t=this.labelArr.shift();t.x=0;t.y=0;if(t){t.removeSelf();Laya.Pool.recover("TipLabel",t)}}};e.SINGLE_KEY="tip.TipEquipJinglianView";return e}(ui.zhuangbei.jinglianzhilitipUI);s.TipEquipJinglianView=t})(tip||(tip={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tip;(function(o){var t=function(a){__extends(t,a);function t(){var t=a.call(this)||this;var e=t.graphics;var i=100;var n=o.TipManager.TIP_INIT_GAP;t.width=i;t.height=n;t.mouseEnabled=false;return t}t.prototype.draw=function(t,e){this.alpha=.1;var i=this.graphics;i.clear();i.drawRect(0,0,t,e,"#ff0000")};t.prototype.drawLine=function(t,e){};return t}(laya.display.Sprite);o.TipGap=t})(tip||(tip={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tip;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}Object.defineProperty(e.prototype,"getList",{get:function(){if(!this._getList){this._getList=new i.TipGetListView}return this._getList},enumerable:true,configurable:true});e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){var e=this;t.prototype.initialize.call(this);this.name=i.TipGetWayMeiator.SINGLE_KEY;this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.tipMask=new Laya.Box;this.tipMask.on(Laya.Event.CLICK,this,function(t){if(t.currentTarget==e.tipMask){e.close()}})};e.prototype.onDisplay=function(){this.height=0;this.getList.y=0;this.on(Laya.Event.RESIZE,this,this.onResize);this.on(app.ViewManager.EVENT_DATASOURCE_CHANGE,this,this.onDatasourceChange);this.callLater(this.refreshAll)};e.prototype.onDatasourceChange=function(){this.refreshAll()};e.prototype.onUnDisplay=function(){this.closeGetList()};e.prototype.refreshAll=function(){this.openGetList()};e.prototype.layout=function(){this.onResize()};e.prototype.resetWH=function(){this.tipMask.width=this.getList.width;this.tipMask.height=this.getList.height};e.prototype.onResize=function(){this.resetWH();this.x=(Laya.stage.width-this.width)/2;this.y=(Laya.stage.height-this.height)/2};e.prototype.openGetList=function(){this.addChild(this.getList);this.getList.setData(this.dataSource[0])};e.prototype.closeGetList=function(){if(this.getList&&this.getList.parent){this.removeChild(this.getList)}};e.SINGLE_KEY="tip.TipGetWayMeiator";return e}(Laya.Dialog);i.TipGetWayMeiator=t})(tip||(tip={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tip;(function(t){var e=function(e){__extends(o,e);function o(){var t=e!==null&&e.apply(this,arguments)||this;t.imgArr=[];t.labelArr=[];t.titleArr=[];t.fengeArr=[];return t}o.getIns=function(){return app.Singleton.getInstance(o)};o.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.mouseEnabled=true;this.mouseThrough=false;this.btnclose.name="";this.maskSpr=new Laya.Sprite;this.addChildAt(this.maskSpr,0);this.maskSpr.graphics.clear();this.maskSpr.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,UIConfig.popupBgColor);this.maskSpr.x=this.width/2-Laya.stage.width/2;this.maskSpr.y=this.height/2-Laya.stage.height/2;this.hitArea=new Laya.Rectangle(this.maskSpr.x,this.maskSpr.y,Laya.stage.width,Laya.stage.height);this.btnclose.on(Laya.Event.CLICK,this,this.onClick);this.on(Laya.Event.CLICK,this,this.onClick)};o.prototype.onClick=function(){o.closeEffect()};o.openEffect=function(t,e,i,n){this.pos=i;game.SceneModel.createAllScreenSp(0,0);app.ViewManager.toggleView(o,app.AppContainer.zhezhaoLayer,1,[t,e]);var a=o.getIns();a.x=i.x;a.y=i.y;a.maskSpr.alpha=0;a.maskSpr.mouseEnabled=false;a.scale(0,0);Laya.Tween.to(a,{x:(Laya.stage.width-a.width)/2,y:(Laya.stage.height-a.height)/2,scaleX:1,scaleY:1},300,Laya.Ease.linearNone,Laya.Handler.create(this,this.onOpenEffectEnd,[n]))};o.onOpenEffectEnd=function(t){game.SceneModel.clearAllScreenSp();t&&t.run();o.getIns().maskSpr.alpha=UIConfig.popupBgAlpha};o.closeEffect=function(t){var e=o.getIns();o.getIns().maskSpr.alpha=0;e.maskSpr.mouseEnabled=true;Laya.Tween.to(e,{x:this.pos.x,y:this.pos.y,scaleX:0,scaleY:0},300,Laya.Ease.linearNone,Laya.Handler.create(this,this.onCloseEffectEnd,[t]))};o.onCloseEffectEnd=function(t){t&&t.run();app.ViewManager.toggleView(o,app.AppContainer.zhezhaoLayer,-1)};o.prototype.onDisplay=function(){this.callLater(this.refreshAll)};o.prototype.onUnDisplay=function(){this.clear()};o.prototype.getTipX=function(){return this.tipsbg.x};o.prototype.getTipH=function(){return this.tipsbg.height};o.prototype.getTipW=function(){return this.tipsbg.width};o.prototype.getBottomX=function(){return this.tipsbg.x+this.tipsbg.width};o.prototype.getBottomY=function(){return this.tipsbg.y+this.tipsbg.height};o.prototype.refreshAll=function(){this.currH=0;this.currH+=tip.TipManager.TIP_INIT_GAP;var t=this.dataSource[0];var e=this.dataSource[1];this.itemjineng.setData(t,e);var i=csv.StatusProxy.getIns().getCfg(t,e);this.labeljineng.text=i.name;this.labelxiaoguo.text=app.getLang(i.explain);this.totalHeight=this.height};o.prototype.clear=function(){while(this.labelArr.length>0){var t=this.labelArr.shift();t.x=0;t.y=0;if(t&&t.parent){t.parent.removeChild(t);Laya.Pool.recover("TipLabel",t)}}while(this.imgArr.length>0){var e=this.imgArr.shift();if(e&&e.parent){e.parent.removeChild(e);Laya.Pool.recover("TipSuitImage",e)}}while(this.fengeArr.length>0){var i=this.fengeArr.shift();if(i&&i.parent){i.parent.removeChild(i);Laya.Pool.recover("TipFengeView",i)}}while(this.titleArr.length>0){var n=this.titleArr.shift();if(n&&n.parent){n.parent.removeChild(n);Laya.Pool.recover("TipTitleView",n)}}};o.SINGLE_KEY="tip.TipLevelBuffView";return o}(ui.tips.bufftipsUI);t.TipLevelBuffView=e})(tip||(tip={}));var tip;(function(h){var t=function(){function l(){}l.showEquipSoulWithLevel=function(t,e){if(e===void 0){e=false}var i=[h.TipManager.TIP_BTN_TYPE.SOUL_REPLACE,h.TipManager.TIP_BTN_TYPE.SOUL_UNLOAD];app.ViewManager.toggleDialog(h.TipMeiator,1,0,[h.TipSoulEquipView,t,e,i])};l.show=function(t,e,i,n){if(e===void 0){e=false}if(i===void 0){i=false}if(n===void 0){n=false}if(!t){return}var a;var o;switch(t.itemCfg.type){case csv.ItemProxy.TYPES.EQUIP:o=h.TipEquipView;break;case csv.ItemProxy.TYPES.SOUL_EQUIP:o=h.TipSoulEquipView;break;case csv.ItemProxy.TYPES.XIN_FA:o=h.TipXinFaView;break;case csv.ItemProxy.TYPES.FA_BAO:o=h.TipWuXingView;break;default:o=h.TipItemView}if(!i){a=this.getBtnTypeArr(t)}else{a=[]}if(a.indexOf(this.TIP_BTN_TYPE.USE)!=-1&&t.itemCfg&&t.getBatchuse()){l.showNumChooseItemTip(t,t.itemCfg,true,a);return}if(t.itemCfg.type==csv.ItemProxy.TYPES.FA_BAO){if(a.indexOf(this.TIP_BTN_TYPE.PINGLUN)==-1){a.push(this.TIP_BTN_TYPE.PINGLUN)}}app.ViewManager.toggleDialog(h.TipMeiator,1,0,[o,t,e,a,i,n])};l.showOnly=function(t){if(!t){return}var e;switch(t.itemCfg.type){case csv.ItemProxy.TYPES.EQUIP:e=h.TipEquipView;break;case csv.ItemProxy.TYPES.SOUL_EQUIP:e=h.TipSoulEquipView;break;case csv.ItemProxy.TYPES.XIN_FA:e=h.TipXinFaView;break;case csv.ItemProxy.TYPES.FA_BAO:e=h.TipWuXingView;break;default:e=h.TipItemView}app.ViewManager.toggleDialog(h.TipMeiator,1,0,[e,t,false,[],true])};l.showGetWay=function(t){if(t==""){manager.FlowManager.instance.flowByStyle1(app.getLang("guaji_des_3"));return}app.ViewManager.toggleDialog(h.TipGetWayMeiator,1,0,[t])};l.showHecheng=function(t,e){var i;switch(t.itemCfg.type){case csv.ItemProxy.TYPES.EQUIP:i=h.TipEquipView;break;case csv.ItemProxy.TYPES.SOUL_EQUIP:i=h.TipSoulEquipView;break;case csv.ItemProxy.TYPES.XIN_FA:i=h.TipXinFaView;break;case csv.ItemProxy.TYPES.FA_BAO:i=h.TipWuXingView;if(e.indexOf(this.TIP_BTN_TYPE.PINGLUN)==-1){e.push(this.TIP_BTN_TYPE.PINGLUN)}break;default:i=h.TipItemView}app.ViewManager.toggleDialog(h.TipMeiator,1,0,[i,t,true,e])};l.showxinfa=function(t,e,i){app.ViewManager.toggleDialog(h.TipMeiator,1,0,[h.TipXinFaView,t,false,e,i])};l.showGuardIslandbufferTips=function(t){app.ViewManager.toggleDialog(h.TipMeiator,1,0,[h.TipsGuardislandView,t,[]])};l.showNumChooseItemTip=function(t,e,i,n){if(i===void 0){i=false}if(!t){return}h.TipSpecialMediator.getIns().buyCfg=e;h.TipNumChooseView.getIns().withNumchoose=i;app.ViewManager.toggleDialog(h.TipSpecialMediator,1,0,[h.TipNumChooseView,t,n])};l.showTalentTip=function(t,e){if(e===void 0){e=0}if(e==h.TipManager.TIP_BTN_TYPE.TALENT_GET){app.ViewManager.toggleDialog(h.TipMeiator,1,0,[h.TipTalentView,t,[e]])}else if(e==h.TipManager.TIP_BTN_TYPE.TALENT_UPGRADE){app.ViewManager.toggleDialog(h.TipMeiator,1,0,[h.TipTalentView,t,[e]])}else{app.ViewManager.toggleDialog(h.TipMeiator,1,0,[h.TipTalentView,t,[]])}};l.showWuXingTip=function(t){app.ViewManager.toggleDialog(h.TipMeiator,1,0,[boss.BossCaveTreasureTips,t])};l.normalShop=function(t,e,i,n,a){if(n===void 0){n=999}if(!t){if(ent.DebugConfig.isDebugger)console.error("#################### normalShop.itemVO = null!");return}var o={price:e,max:n,buyHandle:i};var s=[];if(a){for(var r=0;r<a.length;r++){s.push(a[r])}}s.push(l.TIP_BTN_TYPE.BUY);app.ViewManager.toggleDialog(h.TipsShopBuyMediator,1,0,[t.isEquip()?h.TipsEquipBuyView:h.TipsShopBuyItemView,s,t,o])};l.getCanBuyCount=function(t){var e=app.str2Array(t,"-");var i=game.ItemUtil.createVO(parseInt(e[0]));var n=game.GridsModel.getIns().getItemCount(i.getItemId());var a=n/parseInt(e[1]);if(a<1){return 1}return Math.floor(a)};l.showFabaoTips=function(t,e,i,n){var a=game.ItemUtil.createVO(t);var o=csv.ChouKaProxy.getIns().getBaseCfg(t);if(o){var s={};s.star=i;s.level=e;s.source=fabaonew.EFabaoSource.Chat;s.ownerName=n;a.ext=s;h.TipManager.show(a,true,true)}};l.showByBtnType=function(t,e,i){var n=[];for(var a=3;a<arguments.length;a++){n[a-3]=arguments[a]}var o;switch(t.itemCfg.type){case csv.ItemProxy.TYPES.EQUIP:o=h.TipEquipView;break;case csv.ItemProxy.TYPES.SOUL_EQUIP:o=h.TipSoulEquipView;break;case csv.ItemProxy.TYPES.XIN_FA:o=h.TipXinFaView;break;case csv.ItemProxy.TYPES.FA_BAO:o=h.TipWuXingView;if(e){if(e.indexOf(this.TIP_BTN_TYPE.PINGLUN)==-1){e.push(this.TIP_BTN_TYPE.PINGLUN)}}else{e=[this.TIP_BTN_TYPE.PINGLUN]}break;default:o=h.TipItemView}app.ViewManager.toggleDialog(h.TipSpecialMediator,1,0,[o,t,e,i,n])};l.showSixBox=function(t,e,i){var n=[];for(var a=3;a<arguments.length;a++){n[a-3]=arguments[a]}app.ViewManager.toggleDialog(h.TipSixBoxMediator,1,0,[h.TipSixBoxView,t,e,i,n])};l.showPet=function(t,e,i){if(e){app.ViewManager.toggleDialog(h.TipSpecialMediator,1,0,[h.TipPetView,t,e,i])}else{app.ViewManager.toggleDialog(h.TipSimpleMeiator,1,0,[h.TipPetView,t])}};l.showFightPet=function(t,e,i){if(e){app.ViewManager.toggleDialog(h.TipSpecialMediator,1,0,[h.TipPetView,t.data,e,i,null,t])}else{}};l.showSkill=function(t){app.ViewManager.toggleDialog(h.TipSimpleMeiator,1,0,[h.TipSkillView,t])};l.onTipShow=function(t){var e;if(game.MoneyModel.MONEY_ENUM.GOLD==t){if(game.Context.disableIosRecharge()){shop.ShopModel.getIns().moneyTips()}else{shop.ShopModel.getIns().openChongZhiShop()}}else if(game.MoneyModel.MONEY_ENUM.RONGYU==t){e=game.ItemUtil.createVO(8008)}else if(game.MoneyModel.MONEY_ENUM.SILVER==t){e=game.ItemUtil.createVO(8e3)}if(e){h.TipManager.show(e,true)}};l.bindMoneyTips=function(t,e){t.on(Laya.Event.CLICK,this,this.onTipShow,[e])};l.showBuff=function(t,e){var i={id:t,lv:e};app.ViewManager.toggleDialog(h.TipSimpleMeiator,1,0,[h.TipBuffView,i])};l.showEquipJinglianTip=function(t){app.ViewManager.toggleDialog(h.TipSimpleMeiator,1,0,[h.TipEquipJinglianView,t])};l.showEquipCuilianTip=function(t,e){app.ViewManager.toggleDialog(h.TipSimpleMeiator,1,0,[h.TipEquipCuilianView,t,e])};l.showDes=function(t){app.ViewManager.toggleDialog(h.TipSimpleMeiator,1,0,[h.TipDesView,t])};l.getBtnTypeArr=function(t,e){var i=[];if(t.serverData){if(t.itemCfg.type==csv.ItemProxy.TYPES.EQUIP){i.push(this.TIP_BTN_TYPE.EQUIP_PEIYANG);i.push(this.TIP_BTN_TYPE.RONGLIAN);if(t.flag==game.GridsModel.BAG_ITEM||t.showFlag==game.GridsModel.BAG_ITEM){}else{i.push(this.TIP_BTN_TYPE.REPLACE);i.push(this.TIP_BTN_TYPE.UNLOAD)}}if(t.itemCfg.type==csv.ItemProxy.TYPES.CAI_LIAO&&t.itemCfg.subtype==csv.ItemProxy.SUB_TYPES.SEED&&t.itemCfg.p6==1){i.push(this.TIP_BTN_TYPE.ZHONGZHI)}else if(csv.ItemProxy.getIns().canUse(t.itemCfg.type)){if(csv.ItemProxy.TYPES.CAI_LIAO==t.itemCfg.type){if(t.itemCfg.clientUse>0||t.itemCfg.activityuse>0){i.push(this.TIP_BTN_TYPE.USE)}}else if(t.itemCfg.type==csv.ItemProxy.TYPES.SEVEN_GOLD){if(t.sevenCanUse()){i.push(this.TIP_BTN_TYPE.USE)}}else if(t.itemCfg.type==csv.ItemProxy.TYPES.HULU_FULI_PACKAGE){if(t.hulufuliCanUse()){i.push(this.TIP_BTN_TYPE.USE)}}else if(t.itemCfg.type==csv.ItemProxy.TYPES.LIBAO&&t.itemCfg.subtype==csv.ItemProxy.XH_SUB_TYPES.SUB_3){var n=game.GridsModel.getIns().isOverdue(t.itemCfg.endtime);if(!n){i.push(this.TIP_BTN_TYPE.USE)}}else if(!t.boExpired){i.push(this.TIP_BTN_TYPE.USE)}}if(csv.ItemProxy.getIns().canGoldChange(t.getItemId())){i.push(this.TIP_BTN_TYPE.GOLDE_CHANGE)}if(csv.ItemProxy.TYPES.CAOYAO==t.itemCfg.type&&t.itemCfg.p6==1){i.push(this.TIP_BTN_TYPE.LIANDAN)}}if(t.itemCfg.type==csv.ItemProxy.TYPES.FA_BAO_PIECE){i.push(this.TIP_BTN_TYPE.FA_BAO_SUIPIAN_PREVIEW)}if(t.flag==game.GridsModel.BAG_ITEM&&t.itemCfg.type!=csv.ItemProxy.TYPES.EQUIP&&t.canThrow){if(t.itemCfg.type==csv.ItemProxy.TYPES.LIBAO&&t.itemCfg.subtype==csv.ItemProxy.XH_SUB_TYPES.SUB_3){var n=game.GridsModel.getIns().isOverdue(t.itemCfg.endtime);if(n){i.push(this.TIP_BTN_TYPE.SALE)}}else{i.push(this.TIP_BTN_TYPE.SALE)}}if(t.flag==game.GridsModel.BAG_ITEM||t.showFlag==game.GridsModel.BAG_ITEM){i.push(this.TIP_BTN_TYPE.SHOW)}if(t.flag==game.GridsModel.BAG_ITEM&&t.itemCfg.synthesis){i.push(this.TIP_BTN_TYPE.BAG_HECHENG)}return i};l.showAttrCompare=function(t,e){if(e===void 0){e=""}var i=Math.floor(t.compoundattr*.01);var n=Math.floor(t.nextattr*.01);var a={attr1:i,attr2:n,nextNeedLv:t.nextNeedLv,curLv:t.lv,title:e};app.ViewManager.toggleDialog(h.TipSimpleMeiator,1,0,[h.TipAttrCompareView,a])};l.showHelpInfoTip=function(){var t=[];for(var e=0;e<arguments.length;e++){t[e]=arguments[e]}app.ViewManager.toggleDialog(h.TipSimpleMeiator,1,0,[guild.TipHelpInfoView,t])};l.createDescLabel=function(t,e,i,n,a){if(t===void 0){t=""}if(e===void 0){e=game.STYLES.DESC_TXT_COLOR}if(i===void 0){i=18}if(n===void 0){n="left"}if(a===void 0){a=false}var o=Laya.Pool.getItemByClass("TipLabel",Laya.Label);o.font="SimHei";o.fontSize=i;o.color=e;o.bold=a;o.text=t;o.align=n;return o};l.createRichDescLabel=function(t,e,i,n,a,o){if(t===void 0){t=""}if(e===void 0){e=game.STYLES.DESC_TXT_COLOR}if(i===void 0){i=18}if(n===void 0){n="left"}if(a===void 0){a=false}if(o===void 0){o=0}var s=Laya.Pool.getItemByClass("TipRichText",Laya.RichText);s.font="SimHei";s.fontSize=i;s.color=e;s.bold=a;s.align=n;if(o>0){s.width=o}s.text=t;return s};l.getQualityIcon=function(t){return t==0?"":"public/bg_daoju_0"+t+".png"};l.getTipIcon=function(t){return t==0?"":"res/static/tips/bg_tip_0"+t+".png"};l.TIP_INIT_GAP=18;l.GAPS={GAP_V_LABLE:10,GAP_V_BUTTON:5,GAP_ICON:20,GAP_BOTTOM:32,GAP_PANEL:10,GAP_SUIT:26,GAP_TEXT:20,GAP_ARROW:5};l.TIP_BTN_TYPE={GET:1,USE:2,SHOW:3,SALE:4,WEAR:5,UNLOAD:6,REPLACE:7,RONGLIAN:8,FANGRU:10,PET_LEVELUP:11,PET_STARUP:12,BUY:13,HULU_JINGLIAN:14,FUMO_UP:15,FUMO_DOWN:16,SOUL_WEAR:17,SOUL_UNLOAD:18,SOUL_REPLACE:19,SOUL_QIANGHUA:20,XIN_FA_REPLACE:21,XIN_FA_UPLOAD:22,XIN_FA_FENJIE:23,BAG_HECHENG:24,BUY_GUILD_SHOP:26,BUY_MEDAL_SHOP:27,CHOOSE_GIFT_BAG:28,XING_FA_FANG_RU:29,FUMO_SWITCH:30,PET_FAME:31,TALENT_GET:32,TALENT_UPGRADE:33,SIXBOX_WEAR:34,SIXBOX_REPLACE:35,SIXBOX_UNWEAR:36,SIXBOX_RESOLVE_0:37,SIXBOX_RESOLVE_1:38,SEVEN_SOUL_JIHUO:39,SEVEN_SOUL_RESET:40,EQUIP_SUIT_UP:41,EQUIP_SUIT_SPLICE:42,BUY_ZHANYOU_SHOP:43,NIN_YUN:46,ZHU_NIN:47,EQUIP_PEIYANG:48,LANG_HUAN_UPDOWN:49,LANG_HUAN_REPLACE:50,LANG_HUAN_EQUIP:51,FABAO_EQUIP:52,FABAO_NEW_REPLACE:53,FABAO_NEW_UNLOAD:54,FABAO_NEW_JUEXING:55,GARDEN_56:56,GARDEN_57:57,GARDEN_58:58,GOLDE_CHANGE:59,UP_HECHENG:60,PREVIEW:61,FA_BAO_SUIPIAN_PREVIEW:62,ZHONGZHI:63,LIANDAN:64,PINGLUN:65,REPLACE_ZHIJIE:66,REPLACE_JICHENG:67,PET_SHOW:68,PET_CHANGE:69,PET_GOAWAY:70,PET_CHANGE_GUARD:71,PET_GOAWAY_GUARD:72,FABAO_YUANSHEN_EQUIP:73,FABAO_JIGUANSHOU_EQUIP:74};return l}();h.TipManager=t})(tip||(tip={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tip;(function(f){var t=function(g){__extends(t,g);function t(){var t=g!==null&&g.apply(this,arguments)||this;t.withNumchoose=true;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){g.prototype.initialize.call(this);this.buyCompont=new ui.tips.banghuishangdiantipUI;this.addChild(this.buyCompont);this._numChoose=new game.NumChoose(this.buyCompont.btnjian,this.buyCompont.btnjia,this.buyCompont.labelnum,this.buyCompont.btnmax);this._numChoose.init(1,1,1,1);this._numChoose.on(game.NumChoose.VALUE_CHANGE,this,this.onValueChange)};t.prototype.onValueChange=function(){var t=f.TipSpecialMediator.getIns().buyCfg;var e=t.price?t.price:t.trueprice;var i=1;if(e){i=parseInt(app.str2Array(e,"-")[1])}var n=this._numChoose.currValue;this.buyCompont.labelnum.text=n+"";this.buyCompont.labelmoneynum.text=n*i+""};t.prototype.getNumChoose=function(){return this._numChoose.currValue};t.prototype.refreshAll=function(){g.prototype.refreshAll.call(this);var t=f.TipSpecialMediator.getIns().buyCfg;this._numChoose.currValue=1;this.buyCompont.labelnum.text="1";var e=t.price?t.price:t.trueprice;if(e){this.buyCompont.moneyIcon.parserIcon(e);var i=app.str2Array(e,"-")[1];this.buyCompont.labelmoneynum.text=this._numChoose.currValue*parseInt(i)+"";this.buyCompont.costBox.visible=true;if(t.shopid>0){var n=0;for(var a=0,o=guild.GuildModel.getIns().recordList;a<o.length;a++){var s=o[a];if(s.mallID==t.id){n=mall.MallModel.getIns().getCnt(s);break}}var r=game.GridsModel.getIns().getItemCount(parseInt(app.str2Array(e,"-")[0]));var l=Math.floor(r/parseInt(i));var h=t.count;var p=h>0?h-n:l;if(l>0&&p>0)this._numChoose.maxValue=l>=p?p:l;else this._numChoose.maxValue=1}else if(t.timesforever>0){var n=medal.MedalModel.getIns().getBuyCount(t.id);var h=t.timesforever;var p=h-n;var r=game.GridsModel.getIns().getItemCount(parseInt(app.str2Array(e,"-")[0]));var l=Math.floor(r/parseInt(i));this._numChoose.maxValue=l>=p?p:l;if(l>0&&p>0)this._numChoose.maxValue=l>=p?p:l;else this._numChoose.maxValue=1}else if(t.times>0){var u=mall.MallModel.getIns().getBuyRecord(t.id);var p=t.times;if(u){p=t.times-mall.MallModel.getIns().getCnt(u)}var r=game.GridsModel.getIns().getItemCount(parseInt(app.str2Array(e,"-")[0]));var l=Math.floor(r/parseInt(i));if(l>0&&p>0)this._numChoose.maxValue=l>=p?p:l;else this._numChoose.maxValue=1}}else{var u=this.dataSource[0];var s=game.GridsModel.getIns().getVOByInsId(u.getInstId());if(s&&u.itemCfg.originalnum==0){this._numChoose.init(s.count,1,1,s.count)}else{this._numChoose.init(1,1,1,s.count)}this.buyCompont.costBox.visible=false}this.buyCompont.x=this.daojubox.x;this.buyCompont.y=this.getBottomY();this.buyCompont.labelshuliang.visible=this.withNumchoose;this.buyCompont.btnjian.visible=this.withNumchoose;this.buyCompont.btnjia.visible=this.withNumchoose;this.buyCompont.imgnum.visible=this.withNumchoose;this.buyCompont.labelnum.visible=this.withNumchoose;this.buyCompont.btnmax.visible=this.withNumchoose;var c=this.buyCompont.height;if(!this.withNumchoose){c*=.5;this.buyCompont.y=this.getBottomY()-c}this.totalHeight+=c+f.TipManager.GAPS.GAP_ICON;if(!this.buyCompont.costBox.visible){this.totalHeight-=this.buyCompont.costBox.height}this.tipsbg.height=this.totalHeight;this.zhuangshiimg02.y=this.totalHeight-f.TipManager.GAPS.GAP_ICON;this.height=this.totalHeight;this.callHandler&&this.callHandler.run()};t.SINGLE_KEY="tip.TipNumChooseView";return t}(f.TipItemView);f.TipNumChooseView=t})(tip||(tip={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tip;(function(n){var t=function(e){__extends(i,e);function i(){var t=e!==null&&e.apply(this,arguments)||this;t.imgArr=[];t.labelArr=[];t.titleArr=[];t.fengeArr=[];return t}i.getIns=function(){return app.Singleton.getInstance(i)};Object.defineProperty(i.prototype,"textWidth",{get:function(){return this.neirongbox.width-n.TipManager.TIP_INIT_GAP},enumerable:true,configurable:true});i.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.mouseEnabled=true;this.mouseThrough=false;this.txtOffsetX=i.OFFSET_X;this._lblSkillDes=game.MenuHelper.initDesc("",this.textWidth);var t=this.neirongbox.width-this.txtOffsetX-n.TipManager.TIP_INIT_GAP;this._lblDes=game.MenuHelper.initDesc("",t);this._model=pet.PetModel.getIns();this.stars=new common.StarListMediator(this.listxingxing,null,game.ComStarItem.W);this.listshuxing.renderHandler=new Laya.Handler(this,this.onAttrRender)};i.prototype.onAttrRender=function(t){var e=t.dataSource;var i=Attributes.decode(csv.PetProxy.getIns().getBaseAttr(e.rand)).baseList[0];t.shuxing.text=app.getLang(Attributes.getPropName(i.propId));var n=this.tipData.getPropValue(e);var a=parseInt(csv.PetProxy.getIns().getTalent(i.propId));var o=this.tipData.getPropValue(e,0,a);t.labelshuzi.text=n+"";t.imgtubiao.skin="chongwu/bg_0"+e.tal+".png";t.labelshuzhi.text=e.val+"/"+a;t.jindutiao.value=e.val/a};i.prototype.onDisplay=function(){this.callLater(this.refreshAll)};i.prototype.onUnDisplay=function(){this.clear()};i.prototype.getTipX=function(){return this.tipsbg.x};i.prototype.getTipH=function(){return this.tipsbg.height};i.prototype.getTipW=function(){return this.tipsbg.width};i.prototype.getBottomX=function(){return this.tipsbg.x+this.tipsbg.width};i.prototype.getBottomY=function(){return this.tipsbg.y+this.tipsbg.height};i.prototype.refreshAll=function(){this.currH=0;this.currH+=n.TipManager.TIP_INIT_GAP;this.tipData=this.dataSource[0];this.callHandler=this.dataSource[1];this.pinzhiimg.skin=n.TipManager.getTipIcon(this.tipData.qua);this.pinzhikuangimg.skin=n.TipManager.getQualityIcon(this.tipData.qua);this.daojuimg.skin="res/icon/item/pet_"+this.tipData.petid+".png";var t=this.tipData.petCfg?app.getLang(this.tipData.petCfg.namelang):"";this.namelabel.text=t;this.namelabel.color=game.STYLES.ITEM_QUALITY[this.tipData.qua];if(this.tipData.star>0){this.stars.setStar(this.tipData.star,this.tipData.petCfg.star);this.listxingxing.visible=true}else{this.listxingxing.visible=false}var e=this.tipData.getScoreValue();this.imgshuxing.skin="res/static/bg_sx_"+this.tipData.petCfg.supportelements+".png";this.laneldengji.text=app.getLang("zuoqi_11")+this.tipData.plevel;this.labelpingfen.text=app.getLang("仙兽评分：{0}",e);var i=app.getLang("newpet_quality00")+app.getLang("magic_quality_"+this.tipData.qua);if(this.tipData.petCfg.qualityshow==1){this.labepinzhi.text=i+"+"}else if(this.tipData.petCfg.qualityshow==2){this.labepinzhi.text=i+"++"}else{this.labepinzhi.text=i}if(this.tipData.isBattle()){this.imgtouxiang.skin=role.RoleVO.getHeadIconUrl(this.tipData.pos);this.labelwa.text=app.getLang(csv.DefclassProxy.getIns().getCfg(this.tipData.pos).rolename);this.boxinBattle.visible=true}else{this.boxinBattle.visible=false;this.labelwa.text=""}this.addDesc();this.setBaseProp();this.setSkill();this.imgwuxing.skin="res/static/wuxingzhandou/bg_wuxing_zhandou_wx"+this.tipData.petCfg.supportelements+".png";this.labelshuzhi.text=this.tipData.getValueWuXing()+"";if(this.tipData.petCfg.addattr.length>0){this.addTitleView(app.getLang("辅助技能"));this._lblSkillDes.y=this.currH;this._lblSkillDes.text=this.tipData.getaddattr();this.neirongbox.addChild(this._lblSkillDes);this.currH+=this._lblSkillDes.contextHeight;this.currH+=n.TipManager.GAPS.GAP_V_LABLE}if(this.tipData.petCfg.monid>0){this.addTitleView(app.getLang("仙兽志"));this.createDescLabel(app.getLang(csv.MonsterBookProxy.getIns().getCfg(this.tipData.petCfg.monid).mondesc))}this.currH+=n.TipManager.GAPS.GAP_BOTTOM;this.totalHeight=this.currH+this.neirongbox.y;this.tipsbg.height=this.totalHeight;this.zhuangshiimg02.y=this.totalHeight-n.TipManager.GAPS.GAP_ICON;this.height=this.totalHeight;this.callHandler.run()};i.prototype.addDesc=function(){var t=app.getLang("item_desc_"+this.tipData.petid);this.miaoshutxt.text=t};i.prototype.setBaseProp=function(){this.listshuxing.array=this.tipData.prop};i.prototype.setSkill=function(){this.jinnegtxt.text="";this.chongwu.visible=false;if(this.tipData.skillId>0){this.chongwu.setData(csv.SkillProxy.getIns().getSkillByKey(this.tipData.skillId+"-"+this.tipData.getSkillLevel()),false,false,false);this.chongwu.starMediator.value=0;this.jinnegtxt.text=csv.SkillProxy.getSkillDes(this.tipData.skillId,this.tipData.getSkillLevel());this.chongwu.visible=true}};i.prototype.addTitleView=function(t){var e=Laya.Pool.getItemByClass("TipTitleView",n.TipTitleView);e.y=this.currH;e.dataSource=t;this.neirongbox.addChild(e);this.titleArr.push(e);this.currH+=e.height;this.currH+=n.TipManager.GAPS.GAP_V_LABLE};i.prototype.createDescLabel=function(t,e){if(e===void 0){e=game.STYLES.DESC_TXT_COLOR}var i=n.TipManager.createDescLabel(t,e);i.x=this.txtOffsetX;i.y=this.currH;i.wordWrap=true;i.width=this.neirongbox.width;this.neirongbox.addChild(i);this.labelArr.push(i);this.currH+=i.height;this.currH+=n.TipManager.GAPS.GAP_V_BUTTON;return i};i.prototype.clear=function(){if(this._lblSkillDes&&this._lblSkillDes.parent){this.neirongbox.removeChild(this._lblSkillDes)}if(this._lblDes&&this._lblDes.parent){this.neirongbox.removeChild(this._lblDes)}while(this.labelArr.length>0){var t=this.labelArr.shift();t.x=0;t.y=0;if(t&&t.parent){t.parent.removeChild(t);Laya.Pool.recover("TipLabel",t)}}while(this.imgArr.length>0){var e=this.imgArr.shift();if(e&&e.parent){e.parent.removeChild(e);Laya.Pool.recover("TipSuitImage",e)}}while(this.fengeArr.length>0){var i=this.fengeArr.shift();if(i&&i.parent){i.parent.removeChild(i);Laya.Pool.recover("TipFengeView",i)}}while(this.titleArr.length>0){var n=this.titleArr.shift();if(n&&n.parent){n.parent.removeChild(n);Laya.Pool.recover("TipTitleView",n)}}};i.SINGLE_KEY="tip.TipPetView";i.OFFSET_X=0;return i}(ui.tips.chongwutipsnewUI);n.TipPetView=t})(tip||(tip={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tip;(function(c){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.labelArr=[];t.lblRichArr=[];return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.mouseEnabled=true;this.mouseThrough=false;this.daojubox.vScrollBarSkin=""};t.prototype.onDisplay=function(){this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){this.clear()};t.prototype.getTipX=function(){return this.tipsbg.x};t.prototype.getTipH=function(){return this.tipsbg.height};t.prototype.getTipW=function(){return this.tipsbg.width};t.prototype.getBottomX=function(){return this.tipsbg.x+this.tipsbg.width};t.prototype.getBottomY=function(){return this.tipsbg.y+this.tipsbg.height};t.prototype.refreshAll=function(){};t.prototype.setData=function(t){this.daojubox.scrollTo(0,0);this.currH=5;var e=app.str2Array(t,";","-");for(var i=0,n=e.length;i<n;i++){var a=e[i];for(var o=0,s=a.length;o<s;o++){var r=csv.ItemProxy.getIns().boxRateShowMap[a[o]];if(r.num){var l=Laya.Pool.getItemByClass("TipLabel",Laya.Label);l.x=0;l.y=this.currH;l.font="SimHei";l.fontSize=20;l.color=game.STYLES.ITEM_QUALITY[r.qua];l.text=app.getLang(r.name)+" * "+r.num+"  ";l.align="left";this.daojubox.addChild(l);this.labelArr.push(l);var h=Laya.Pool.getItemByClass("TipLabel",Laya.Label);h.x=l.width;h.y=this.currH;h.font="SimHei";h.fontSize=20;h.color=game.STYLES.DESC_TXT_COLOR;h.text="";var p=220-h.x;while(h.width<=p){h.text+="-"}h.align="left";this.daojubox.addChild(h);this.labelArr.push(h);var u=Laya.Pool.getItemByClass("TipLabel",Laya.Label);u.x=240;u.y=this.currH;u.font="SimHei";u.fontSize=20;u.color=game.STYLES.DESC_TXT_COLOR;u.text=r.prop/100+"%";u.align="left";this.daojubox.addChild(u);this.labelArr.push(u);this.currH+=l.height;this.currH+=c.TipManager.GAPS.GAP_V_LABLE}else{var l=Laya.Pool.getItemByClass("TipRich",Laya.RichText);l.x=0;l.y=this.currH;l.width=300;l.font="SimHei";l.fontSize=20;l.color=game.STYLES.DESC_TXT_COLOR;l.text=app.getLang(r.name);l.align="left";this.daojubox.addChild(l);this.lblRichArr.push(l);this.currH+=l.contextHeight;this.currH+=c.TipManager.GAPS.GAP_V_LABLE}}this.currH+=c.TipManager.GAPS.GAP_TEXT}this.updateBg()};t.prototype.updateBg=function(){this.currH+=c.TipManager.GAPS.GAP_BOTTOM;this.totalHeight=this.currH+this.daojubox.y;var t=this.daojubox.y+this.daojubox.height+this.daojubox.x;var e=t-this.totalHeight;if(e>=0){}else{this.totalHeight=t}this.tipsbg.height=this.totalHeight;this.zhuangshiimg02.y=this.totalHeight-c.TipManager.GAPS.GAP_ICON;this.height=this.totalHeight};t.prototype.clear=function(){while(this.lblRichArr.length>0){var t=this.lblRichArr.shift();if(t&&t.parent){t.removeSelf();Laya.Pool.recover("TipRich",t)}}while(this.labelArr.length>0){var t=this.labelArr.shift();t.x=0;t.y=0;t.underline=false;t.wordWrap=false;t.align="left";if(t&&t.parent){t.parent.removeChild(t);Laya.Pool.recover("TipLabel",t)}}};t.SINGLE_KEY="tip.TipRateView";return t}(ui.tips.daojuratetipsUI);c.TipRateView=t})(tip||(tip={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tip;(function(o){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){this.daojubox.scrollTo(0,0);this.currH=0;this.currH+=o.TipManager.TIP_INIT_GAP;var t=this.dataSource[0];o.TipBtnListView.getIns().setRefreshcost(t.refreshcost);this.callHandler=this.dataSource[1];var e=this.dataSource[2];var i="";var n="";var a="";if(e==1){n=app.getLang(t.powerdes1);a=t.powericon1;i=t.powername1}else{n=app.getLang(t.powerdes2);a=t.powericon2;i=t.powername2}if(a.length>0){this.daojuimg.skin="res/icon/masterskill/"+a+".png"}this.namelabel.text=app.getLang(i);this.xianzhilabel.visible=false;this.addDesc(n);this.updateBg()};e.SINGLE_KEY="tip.TipSevenSoulView";return e}(o.TipItemView);o.TipSevenSoulView=t})(tip||(tip={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tip;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.daojubox.vScrollBarSkin=""};Object.defineProperty(e.prototype,"curData",{get:function(){return this.dataSource[0]},enumerable:true,configurable:true});e.prototype.refreshAll=function(){this.daojubox.scrollTo(0,0);this.currH=0;this.currH+=i.TipManager.TIP_INIT_GAP;var t=this.curData;this.callHandler=this.dataSource[1];this.daojuimg.skin="res/icon/item/"+t.icon+".png";this.namelabel.text=app.getLang(t.buffname||"未填");this.namelabel.color=game.STYLES.ITEM_QUALITY[t.quality||1];this.xianzhilabel.visible=false;var e=app.getLang(t.des||"未写描述");this.addDesc(e);this.updateBg()};e.SINGLE_KEY="tip.TipsGuardislandView";return e}(i.TipItemView);i.TipsGuardislandView=t})(tip||(tip={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tip;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){var e=this;t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.tipMask=new Laya.Box;this.tipMask.on(Laya.Event.CLICK,this,function(t){if(t.currentTarget==e.tipMask){e.close()}});this.backHandler=new Laya.Handler(this,this.createComplete)};e.prototype.onDisplay=function(){this.on(Laya.Event.RESIZE,this,this.onResize);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){var t=this.dataSource[0];this.off(Laya.Event.RESIZE,this,this.onResize);app.ViewManager.toggleView(t,this,-1)};e.prototype.refreshAll=function(){var t=this.dataSource[0];if(!app.ViewManager.DisplayedInStage(t.SINGLE_KEY)){if(this.dataSource[2]){app.ViewManager.toggleView(t,this,1,[this.dataSource[1],this.backHandler,this.dataSource[2]],null,null,0)}else{app.ViewManager.toggleView(t,this,1,[this.dataSource[1],this.backHandler],null,null,0)}this.tipView=app.Singleton.getInstance(t)}};e.prototype.createComplete=function(){this.addChildAt(this.tipMask,0);this.layout()};e.prototype.layout=function(){this.resetWH();this.onResize()};e.prototype.resetWH=function(){this.width=this.tipView.getTipW();this.height=this.tipView.getTipH();this.tipMask.width=this.width;this.tipMask.height=this.height};e.prototype.onResize=function(){this.x=(Laya.stage.width-this.width)/2;this.y=(Laya.stage.height-this.height)/2};e.SINGLE_KEY="tip.TipSimpleMeiator";return e}(Laya.Dialog);t.TipSimpleMeiator=e})(tip||(tip={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tip;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.refreshAll=function(){var t=this.dataSource[0];this.itemVo=this.dataSource[1];this.btnTypeArr=this.dataSource[2];this.specialHandler=this.dataSource[3];if(!app.ViewManager.DisplayedInStage(t.SINGLE_KEY)){app.ViewManager.toggleView(t,this,1,[this.itemVo,this.backHandler,this.dataSource[4]],null,null,0);this.tipView=app.Singleton.getInstance(t)}if(this.btnTypeArr&&this.btnTypeArr.length>0){this.addBtnList()}};e.prototype.onBtnClick=function(t){if(this.specialHandler){this.specialHandler.runWith(t)}this.close()};e.SINGLE_KEY="tip.TipSixBoxMediator";return e}(t.TipMeiator);t.TipSixBoxMediator=e})(tip||(tip={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tip;(function(s){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.refreshAll=function(){this.daojubox.scrollTo(0,0);this.currH=0;this.currH+=s.TipManager.TIP_INIT_GAP;this.tipData=this.dataSource[0];this.callHandler=this.dataSource[1];this.daojuimg.skin=this.tipData.getIconUrl();this.pinzhiimg.skin=s.TipManager.getTipIcon(this.tipData.getQuality());this.pinzhikuangimg.skin=s.TipManager.getQualityIcon(this.tipData.getQuality());this.namelabel.color=game.STYLES.ITEM_QUALITY[this.tipData.getQuality()];this.namelabel.text=this.tipData.getName();var t=this.tipData.getLevel()==0?1:this.tipData.getLevel();this.xianzhilabel.color=game.STYLES.GREEN_COLOR;this.xianzhilabel.text=app.getLang("zuoqi_11")+t;var e=this.tipData.getItemId();this.addAttrView(app.getLang("tip_des_9"),e,t);if(t<100){this.addAttrView(app.getLang("talent_tips_title_3"),e,t+1)}else{this.addTitleView(app.getLang("talent_tips_title_3"));var i=csv.SixBoxProxy.getIns().getCfg(e,t);var n=Attributes.decode(i?i.prop:"").baseList;for(var a=0;a<n.length;a++){this.createMax(n[a],"{0} {1}")}}this.addAttrView(app.getLang("talent_tips_title_4"),e,100);this.setGetWay();this.updateBg()};e.prototype.addAttrView=function(t,e,i){this.addTitleView(t);var n=csv.SixBoxProxy.getIns().getCfg(e,i);var a=Attributes.decode(n?n.prop:"").baseList;for(var o=0;o<a.length;o++){this.createAttrLabel(a[o],"{0} +{1}")}};e.prototype.createMax=function(t,e,i,n){if(e===void 0){e="{0} {1}"}if(i===void 0){i=game.STYLES.DESC_TXT_COLOR}if(n===void 0){n=s.TipItemView.OFFSET_X}var a=Attributes.getPropName(t.propId);var o=s.TipManager.createDescLabel(app.getLang(e,a,app.getLang("lotus_8")),i);o.x=n;o.y=this.currH;this.daojubox.addChild(o);this.labelArr.push(o);this.currH+=o.height;this.currH+=s.TipManager.GAPS.GAP_V_BUTTON};e.prototype.createAttrLabel=function(t,e,i,n){if(e===void 0){e="{0} {1}"}if(i===void 0){i=game.STYLES.DESC_TXT_COLOR}if(n===void 0){n=s.TipItemView.OFFSET_X}var a=s.TipManager.createDescLabel(Attributes.getShowLabel(t,e),i);a.x=n;a.y=this.currH;this.daojubox.addChild(a);this.labelArr.push(a);this.currH+=a.height;this.currH+=s.TipManager.GAPS.GAP_V_BUTTON};e.SINGLE_KEY="tip.TipSixBoxView";return e}(s.TipItemView);s.TipSixBoxView=t})(tip||(tip={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tip;(function(h){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.richtTxtArr=[];t.titleArr=[];t.fengeArr=[];return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.mouseEnabled=true;this.mouseThrough=false};t.prototype.onDisplay=function(){this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){this.clear()};t.prototype.getTipX=function(){return this.tipsbg.x};t.prototype.getTipH=function(){return this.tipsbg.height};t.prototype.getTipW=function(){return this.tipsbg.width};t.prototype.getBottomX=function(){return this.tipsbg.x+this.tipsbg.width};t.prototype.getBottomY=function(){return this.tipsbg.y+this.tipsbg.height};t.prototype.refreshAll=function(){this.currH=0;this.currH+=h.TipManager.TIP_INIT_GAP;this.tipData=this.dataSource[0];this.callHandler=this.dataSource[1];this.xingShowSp=this.dataSource[2];this.itemjineng.setData(this.tipData);this.itemjineng.starMediator.value=0;var t=csv.SkillProxy.getIns().getCfg(this.tipData.id,this.tipData.lv);this.labeljineng.text=t.name;if(this.tipData["alive"]){this.imgjihuo.visible=true}else{this.imgjihuo.visible=false}if(csv.SkillProxy.NO_SHOW_CD_ORIGIN.indexOf(t.skillorigin)!=-1){this.lblCd.text=""}else{var e=parseInt(t.coldtime);if(e==0){this.lblCd.text=app.getLang("冷却：无")}else{this.lblCd.text=app.getLang("冷却：{0}秒",e/1e3)}}var i=Laya.Pool.getItemByClass("TipTitleView",h.TipTitleView);this.titleArr.push(i);i.y=this.currH;i.dataSource=app.getLang("levelup_12");this.daojubox.addChild(i);this.currH+=i.height;this.currH+=h.TipManager.GAPS.GAP_V_LABLE;var n=Laya.Pool.getItemByClass("TipRichTextLabel",Laya.RichText);n.x=0;n.y=this.currH;n.style.fontSize=18;n.style.width=this.daojubox.width-n.style.fontSize;n.style.leading=5;n.style.wordWrap=true;n.color=game.STYLES.DESC_TXT_COLOR;n.text=csv.SkillProxy.getSkillDes(this.tipData.id,this.tipData.lv,0,false);this.daojubox.addChild(n);this.richtTxtArr.push(n);this.currH+=n.contextHeight;this.currH+=h.TipManager.GAPS.GAP_V_BUTTON;if(this.tipData["alive"]){var a=csv.SkillProxy.getIns().getCfg(this.tipData.id,this.tipData.lv+1);if(a){var o=Laya.Pool.getItemByClass("TipTitleView",h.TipTitleView);this.titleArr.push(o);o.y=this.currH;o.dataSource=app.getLang("levelup_13");this.daojubox.addChild(o);this.currH+=o.height;this.currH+=h.TipManager.GAPS.GAP_V_LABLE;var s=Laya.Pool.getItemByClass("TipRichTextLabel",Laya.RichText);s.x=0;s.y=this.currH;s.style.fontSize=18;s.style.width=this.daojubox.width-s.style.fontSize;s.style.leading=5;s.style.wordWrap=true;s.color=game.STYLES.DESC_TXT_COLOR;s.text=csv.SkillProxy.getSkillDes(this.tipData.id,this.tipData.lv+1,0,false);this.daojubox.addChild(s);this.richtTxtArr.push(s);this.currH+=s.contextHeight;this.currH+=h.TipManager.GAPS.GAP_V_BUTTON}}if(!this.tipData["alive"]&&this.tipData["alive_des"]){var r=Laya.Pool.getItemByClass("TipTitleView",h.TipTitleView);this.titleArr.push(r);r.y=this.currH;r.dataSource=app.getLang("levelup_11");this.daojubox.addChild(r);this.currH+=r.height;this.currH+=h.TipManager.GAPS.GAP_V_LABLE;var l=Laya.Pool.getItemByClass("TipRichTextLabel",Laya.RichText);l.x=0;l.y=this.currH;l.style.width=this.daojubox.width;l.style.fontSize=18;l.style.leading=5;l.style.wordWrap=true;l.color=game.STYLES.DESC_TXT_COLOR;l.text=this.tipData["alive_des"];this.daojubox.addChild(l);this.richtTxtArr.push(l);this.currH+=l.contextHeight;this.currH+=h.TipManager.GAPS.GAP_V_BUTTON}this.daojubox.height=this.currH;this.currH+=h.TipManager.GAPS.GAP_BOTTOM;this.totalHeight=this.currH+this.daojubox.y;this.tipsbg.height=this.totalHeight;this.zhuangshiimg04.y=this.totalHeight-h.TipManager.GAPS.GAP_ICON;this.height=this.totalHeight;this.callHandler.run()};t.prototype.clear=function(){while(this.richtTxtArr.length>0){var t=this.richtTxtArr.shift();t.x=0;t.y=0;if(t&&t.parent){t.parent.removeChild(t);Laya.Pool.recover("TipRichTextLabel",t)}}while(this.fengeArr.length>0){var e=this.fengeArr.shift();if(e&&e.parent){e.parent.removeChild(e);Laya.Pool.recover("TipFengeView",e)}}while(this.titleArr.length>0){var i=this.titleArr.shift();if(i&&i.parent){i.parent.removeChild(i);Laya.Pool.recover("TipTitleView",i)}}};t.SINGLE_KEY="tip.TipSkillView";return t}(ui.tips.jinengtipsUI);h.TipSkillView=t})(tip||(tip={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tip;(function(t){var e=function(a){__extends(t,a);function t(){return a!==null&&a.apply(this,arguments)||this}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){a.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);var t=new Laya.Image;t.skin="public/bg_wujiaoxing1.png";t.x=this.star.x+10;t.y=this.star.y;this.addChild(t);var e=new Laya.Image;e.skin="public/bg_wujiaoxing1.png";e.x=t.x+10;e.y=t.y;this.addChild(e);var i=new Laya.Image;i.skin="public/bg_wujiaoxing1.png";i.x=e.x+10;i.y=e.y;this.addChild(i);var n=new Laya.Image;n.skin="public/bg_wujiaoxing1.png";n.x=i.x+10;n.y=i.y;this.addChild(n);this.starMediator.value=0};t.prototype.onDisplay=function(){this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){this.clear()};t.SINGLE_KEY="tip.TipSoulEquipView";return t}(t.TipEquipView);t.TipSoulEquipView=e})(tip||(tip={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tip;(function(a){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.refreshAll=function(){var t=this.dataSource[0];this.itemVo=this.dataSource[1];this.btnTypeArr=this.dataSource[2];this.specialHandler=this.dataSource[3];this.ext=this.dataSource[4];this.otherData=this.dataSource[5];if(!app.ViewManager.DisplayedInStage(t.SINGLE_KEY)){app.ViewManager.toggleView(t,this,1,[this.itemVo,this.backHandler],null,null,0);this.tipView=app.Singleton.getInstance(t);this.tipView.mediator=this}if(this.btnTypeArr&&this.btnTypeArr.length>0){this.addBtnList()}if(this.itemVo instanceof items.ItemVO){if(this.itemVo.itemCfg.clientget!=""){this.openGetList()}}};e.prototype.btnSelectHandler=function(t){if(t==a.TipManager.TIP_BTN_TYPE.PET_CHANGE_GUARD){app.ViewManager.toggleDialog(garden.PetChoicesView,1,0,[this.otherData])}else if(t==a.TipManager.TIP_BTN_TYPE.PET_GOAWAY_GUARD){garden.GardenModel.getIns().c2sSetPetReq(0,this.itemVo.instid)}};e.prototype.buyItem=function(t){var e=a.TipNumChooseView.getIns().getNumChoose();var i=parseInt(this.buyCfg.id);if(t==a.TipManager.TIP_BTN_TYPE.BUY_GUILD_SHOP){var n=guild.GuildModel.getIns().guildVO.getShopLevel();if(this.buyCfg.shopid>n){manager.FlowManager.instance.flowByStyle1(app.getLang("family_94"))}else{guild.GuildController.getIns().onBuyGuildMallNumReq(i,e,this.buyCfg.price,this.buyCfg.count)}}else if(t==a.TipManager.TIP_BTN_TYPE.BUY_MEDAL_SHOP){medal.MedalModel.getIns().onBuyMallNumReq(i,e,this.buyCfg.trueprice,this.buyCfg.timesforever)}else if(t==a.TipManager.TIP_BTN_TYPE.BUY_ZHANYOU_SHOP){shop.ShopModel.getIns().buyItem(shop.ShopModel.ENNUMS.ZHANYOU_SHOP,this.buyCfg,e)}};e.prototype.useItem=function(t){var e=a.TipNumChooseView.getIns().getNumChoose();game.ItemUtil.use(t,Uint64.ZERO,e)};e.SINGLE_KEY="tip.TipSpecialMediator";return e}(a.TipMeiator);a.TipSpecialMediator=t})(tip||(tip={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tip;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.snChoose=new i.ShopNumChoose(this)};Object.defineProperty(e.prototype,"shopVo",{get:function(){return this.dataSource[2]},enumerable:true,configurable:true});e.prototype.getNumChoose=function(){return this.snChoose.getNumChoose()};e.prototype.refreshAll=function(){t.prototype.refreshAll.call(this);this.totalHeight=this.snChoose.updateByMaxValue(this.totalHeight,this.daojubox.x,this.getBottomY(),this.shopVo.price,this.shopVo.max);this.tipsbg.height=this.totalHeight;this.zhuangshiimg02.y=this.totalHeight-i.TipManager.GAPS.GAP_ICON;this.height=this.totalHeight;this.callHandler.run()};return e}(i.TipItemView);i.TipsShopBuyItemView=t;var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.snChoose=new i.ShopNumChoose(this)};Object.defineProperty(e.prototype,"shopVo",{get:function(){return this.dataSource[2]},enumerable:true,configurable:true});e.prototype.refreshAll=function(){t.prototype.refreshAll.call(this);this.totalHeight=this.snChoose.updateByMaxValue(this.totalHeight,this.daojubox.x,this.getBottomY(),this.shopVo.price,this.shopVo.max);this.tipsbg.height=this.totalHeight;this.zhuangshiimg02.y=this.totalHeight-i.TipManager.GAPS.GAP_ICON;this.height=this.totalHeight;this.callHandler.run()};e.prototype.getNumChoose=function(){return this.snChoose.getNumChoose()};return e}(i.TipEquipView);i.TipsEquipBuyView=e})(tip||(tip={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tip;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};Object.defineProperty(e.prototype,"shopVo",{get:function(){return this.dataSource[3]},enumerable:true,configurable:true});e.prototype.refreshAll=function(){var t=this.dataSource[0];this.btnTypeArr=this.dataSource[1];this.itemVo=this.dataSource[2];if(!app.ViewManager.DisplayedInStage(t.SINGLE_KEY)){app.ViewManager.toggleView(t,this,1,[this.itemVo,this.backHandler,this.shopVo],null,null,0);this.tipView=app.Singleton.getInstance(t)}if(this.btnTypeArr&&this.btnTypeArr.length>0){this.addBtnList()}};e.prototype.buyItem=function(){var t=this.shopVo.buyHandle;var e=this.tipView;var i=this.shopVo.price;var n=e.getNumChoose();var a=app.str2Array(i,"-");var o=parseInt(a[0]);var s=game.GridsModel.getIns().getItemCount(o);if(o==game.ItemUtil.ENUMS.YUANBAO&&s<parseInt(a[1])*n){shop.ShopModel.getIns().askChongZhi();return}t.runWith(n)};e.SINGLE_KEY="tip.TipsShopBuyMediator";return e}(t.TipMeiator);t.TipsShopBuyMediator=e})(tip||(tip={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tip;(function(g){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.imgArr=[];t.labelArr=[];t.titleArr=[];t.fengeArr=[];t.currH=0;t.totalHeight=0;t.leftOff=5;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.daojubox.width+=10};t.prototype.onDisplay=function(){talent.TalentModel.getIns().on(talent.TalentModel.TALENT_TREE_CHANGE,this,this.onTreeChange);this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){talent.TalentModel.getIns().off(talent.TalentModel.TALENT_TREE_CHANGE,this,this.onTreeChange);this.clear()};t.prototype.clear=function(){while(this.labelArr.length>0){var t=this.labelArr.shift();t.x=0;t.y=0;if(t&&t.parent){t.parent.removeChild(t);Laya.Pool.recover("TipRichTextLabel",t)}}while(this.fengeArr.length>0){var e=this.fengeArr.shift();if(e&&e.parent){e.parent.removeChild(e);Laya.Pool.recover("TipFengeView",e)}}this.currH=0;this.totalHeight=0};t.prototype.onTreeChange=function(t){if(this.data.cfg.masterid==t){this.refreshAll();var e=g.TipMeiator.getIns().btnList.getChildAt(0);if(e){e.label=app.getLang("tip_btn_33")}}};t.prototype.getMasterskillid=function(t){if(t.indexOf("-")>=0){t=app.str2Array(t,"-")[0]}return parseInt(t)};t.prototype.refreshAll=function(){this.clear();this.data=this.dataSource[0];this.callHandler=this.dataSource[1];var t=this.data.getLevel();if(this.data.cfg.icon.length>0){this.daojuimg.skin="res/icon/masterskill/"+this.data.cfg.icon+".png"}else{this.daojuimg.skin=""}this.namelabel.text=this.data.cfg.name;this.xianzhilabel.color=game.STYLES.YELLOW_COLOR;if(this.data.isMax()){this.xianzhilabel.text=app.getLang("lotus_8");g.TipMeiator.getIns().delButton()}else{this.xianzhilabel.text=app.getLang("zhanling_text12",t+"/"+this.data.cfg.maxlevel);if(t>0){this.addLimit(this.data.cfg.limit);var e=csv.SkillProxy.getIns().getMasterCfg(this.getMasterskillid(this.data.cfg.masterskillid),t);var i=e.name;this.addAttr(this.daojubox,app.getLang("talent_tips_title_7"),this.leftOff);this.addAttr(this.daojubox,app.getLang(i),this.leftOff)}else{var n=this.data.cfg;var a=app.str2Array(n.limit,";","-");if(n.frontlevel&&n.frontlevel.length>0){var o=app.str2Array(n.frontlevel,"-")[0];var s=app.str2Array(n.frontlevel,"-")[1];var r=csv.TalentProxy.getIns().getCfg(o).name;var l=talent.TalentModel.getIns().getTalentLevel(this.data.frontId);var h=game.STYLES.RED_COLOR;if(l>=s){h=game.STYLES.GREEN_COLOR}this.addAttr(this.daojubox,app.getLang("talent_tips_title_1",h,r,l,s),this.leftOff);if(a.length==0){this.addLine()}}this.addLimit(this.data.cfg.limit,t);var p=csv.SkillProxy.getIns().getMasterCfg(this.getMasterskillid(this.data.cfg.masterskillid),t+1);this.addAttr(this.daojubox,app.getLang("talent_tips_title_3"),this.leftOff);var i=p.name;this.addAttr(this.daojubox,app.getLang(i),this.leftOff)}this.addLine()}var u=csv.SkillProxy.getIns().getMasterCfg(this.getMasterskillid(this.data.cfg.masterskillid),this.data.cfg.maxlevel);var c=u.name;this.addAttr(this.daojubox,app.getLang("talent_tips_title_4"),this.leftOff);this.addAttr(this.daojubox,app.getLang(c),this.leftOff);this.totalHeight=this.currH+this.daojubox.y;this.totalHeight+=g.TipManager.GAPS.GAP_BOTTOM;this.tipsbg.height=this.totalHeight;this.zhuangshiimg02.y=this.totalHeight-g.TipManager.GAPS.GAP_ICON;this.height=this.totalHeight;this.callHandler.run()};t.prototype.addLimit=function(t,e){if(t===void 0){t=""}if(e===void 0){e=0}var i=app.str2Array(t,";","-");var n=-1;for(var a=0;a<i.length;a++){if(i[a][0]==1){var o=i[a][1];var s=i[a][2];var r=game.STYLES.RED_COLOR;var l=talent.TalentModel.getIns().getAllLevByClass(talent.TalentModel.getIns().selectedRoleVo.insId,o);if(l>=s){r=game.STYLES.GREEN_COLOR}this.addAttr(this.daojubox,app.getLang("talent_class_"+o,r,l,s),this.leftOff);this.addLine()}else if(i[a][0]==2){var h=parseInt(i[a][1]);var p=parseInt(i[a][2]);if(h){var u=talent.TalentModel.getIns().getEquipVO(h);if(u){if(u.getQuality()>=p){n=a}}}}}if(i[0][0]==2){var c=i.length-1;var g={part:i[c][1],qua:i[c][2],lvlimit:i[c][3]};var p=g.qua;var f=g.lvlimit;if(n>=0){var d={part:i[n][1],qua:i[n][2],lvlimit:i[n][3]};var u=talent.TalentModel.getIns().getEquipVO(d.part);var y=u.getQuality();var r=game.STYLES.ITEM_QUALITY[y];var v=app.getLang("qua_name_"+y);var _=app.getLang("talent_tips_title_5",r,v,d.lvlimit);this.addAttr(this.daojubox,_,this.leftOff);if(n<c){p=i[n+1][2];f=i[n+1][3]}}else{this.addAttr(this.daojubox,app.getLang("talent_tips_title_2"),this.leftOff);p=i[0][2];f=i[0][3]}var m=app.getLang("qua_name_"+p)+talent.TalentModel.getIns().getEquipName(g.part);this.addAttr(this.daojubox,app.getLang("talent_tips_title_6",m,f),this.leftOff);this.addLine()}};t.prototype.addLine=function(){var t=Laya.Pool.getItemByClass("TipFengeView",g.TipFengeView);t.y=this.currH;this.daojubox.addChild(t);this.fengeArr.push(t);this.currH+=t.height;this.currH+=g.TipManager.GAPS.GAP_V_LABLE};t.prototype.addAttr=function(t,e,i,n,a,o,s){if(i===void 0){i=53}if(n===void 0){n=20}if(a===void 0){a="#c3f4e0"}if(o===void 0){o=true}if(s===void 0){s=null}var r=Laya.Pool.getItemByClass("TipRichTextLabel",Laya.RichText);r.x=i;r.y=this.currH+4;r.style.width=t.width;r.style.leading=5;r.font="SimHei";r.fontSize=n;r.color=a;r.text=e;t.addChild(r);this.labelArr.push(r);this.currH+=r.contextHeight;this.currH+=g.TipManager.GAPS.GAP_V_LABLE;if(s){r.x=s.x;r.y=s.y}return r};t.prototype.getTipX=function(){return this.tipsbg.x};t.prototype.getTipH=function(){return this.tipsbg.height};t.prototype.getTipW=function(){return this.tipsbg.width};t.prototype.getBottomX=function(){return this.tipsbg.x+this.tipsbg.width};t.prototype.getBottomY=function(){return this.tipsbg.y+this.tipsbg.height};t.SINGLE_KEY="tip.TipTalentView";return t}(ui.tips.daojutipsUI);g.TipTalentView=t})(tip||(tip={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tip;(function(t){var e=function(e){__extends(o,e);function o(){var t=e!==null&&e.apply(this,arguments)||this;t.imgArr=[];t.labelArr=[];t.titleArr=[];t.fengeArr=[];return t}o.getIns=function(){return app.Singleton.getInstance(o)};o.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.mouseEnabled=true;this.mouseThrough=false;this.btnclose.name="";this.maskSpr=new Laya.Sprite;this.addChildAt(this.maskSpr,0);this.maskSpr.graphics.clear();this.maskSpr.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,UIConfig.popupBgColor);this.maskSpr.x=this.width/2-Laya.stage.width/2;this.maskSpr.y=this.height/2-Laya.stage.height/2;this.hitArea=new Laya.Rectangle(this.maskSpr.x,this.maskSpr.y,Laya.stage.width,Laya.stage.height);this.btnclose.on(Laya.Event.CLICK,this,this.onClick);this.on(Laya.Event.CLICK,this,this.onClick)};o.prototype.onClick=function(){o.closeEffect()};o.prototype.showGuide=function(t,e){this.guideHandler=t;var i=this.parent.localToGlobal(new Laya.Point(this.x,this.y));guide.GuideBubbleItem2.getIns().jumpHandler=e;guide.GuideBubbleItem2.getIns().add(app.getLang("yindao_text2"),i.x,i.y,this.width,this.height,2,t)};o.openEffect=function(t,e,i,n){this.pos=i;game.SceneModel.createAllScreenSp(0,0);app.ViewManager.toggleView(o,app.AppContainer.zhezhaoLayer,1,[t,e]);var a=o.getIns();a.x=i.x;a.y=i.y;a.maskSpr.alpha=0;a.maskSpr.mouseEnabled=false;a.scale(0,0);Laya.Tween.to(a,{x:(Laya.stage.width-a.width)/2,y:(Laya.stage.height-a.height)/2,scaleX:1,scaleY:1},300,Laya.Ease.linearNone,Laya.Handler.create(this,this.onOpenEffectEnd,[n]))};o.onOpenEffectEnd=function(t){game.SceneModel.clearAllScreenSp();t&&t.run();o.getIns().maskSpr.alpha=UIConfig.popupBgAlpha};o.closeEffect=function(t){var e=o.getIns();o.getIns().maskSpr.alpha=0;e.maskSpr.mouseEnabled=true;Laya.Tween.to(e,{x:this.pos.x,y:this.pos.y,scaleX:0,scaleY:0},300,Laya.Ease.linearNone,Laya.Handler.create(this,this.onCloseEffectEnd,[t]))};o.onCloseEffectEnd=function(t){t&&t.run();app.ViewManager.toggleView(o,app.AppContainer.zhezhaoLayer,-1)};o.prototype.onDisplay=function(){this.callLater(this.refreshAll)};o.prototype.onUnDisplay=function(){this.clear()};o.prototype.getTipX=function(){return this.tipsbg.x};o.prototype.getTipH=function(){return this.tipsbg.height};o.prototype.getTipW=function(){return this.tipsbg.width};o.prototype.getBottomX=function(){return this.tipsbg.x+this.tipsbg.width};o.prototype.getBottomY=function(){return this.tipsbg.y+this.tipsbg.height};o.prototype.refreshAll=function(){this.currH=0;this.currH+=tip.TipManager.TIP_INIT_GAP;var t=this.dataSource[0];var e=this.dataSource[1];this.itemjineng.setData(t,e);var i=csv.StatusProxy.getIns().getCfg(t,e);this.labeljineng.text=i.name;this.labelxiaoguo.text=app.getLang(i.explain);this.totalHeight=this.height};o.prototype.clear=function(){while(this.labelArr.length>0){var t=this.labelArr.shift();t.x=0;t.y=0;if(t&&t.parent){t.parent.removeChild(t);Laya.Pool.recover("TipLabel",t)}}while(this.imgArr.length>0){var e=this.imgArr.shift();if(e&&e.parent){e.parent.removeChild(e);Laya.Pool.recover("TipSuitImage",e)}}while(this.fengeArr.length>0){var i=this.fengeArr.shift();if(i&&i.parent){i.parent.removeChild(i);Laya.Pool.recover("TipFengeView",i)}}while(this.titleArr.length>0){var n=this.titleArr.shift();if(n&&n.parent){n.parent.removeChild(n);Laya.Pool.recover("TipTitleView",n)}}};o.SINGLE_KEY="tip.TipWuxingBuffView";return o}(ui.tips.bufftipsUI);t.TipWuxingBuffView=e})(tip||(tip={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tip;(function(s){var a=function(){function t(t){this.label=t.labelshuliang;this.img=t.shuxing;this.ani=t.xuanzhong}t.prototype.setData=function(t,e,i){this.label.text=e.toString();this.img.skin="public/bg_wuxing_"+(t+1)+".png";if(i){this.ani.visible=true;this.ani.play(0,true)}else{this.ani.visible=false;this.ani.stop()}};return t}();s.WuxiAttrItem=a;var i=function(n){__extends(t,n);function t(){var t=n!==null&&n.apply(this,arguments)||this;t.curHeight=0;t.GAP=10;return t}t.prototype.initialize=function(){n.prototype.initialize.call(this);this.itemList=[];var t=[1,5,4,3,2];for(var e=0;e<5;e++){var i=t[e];this.itemList.push(new a(this["shuxing"+i]))}this.labelmiaoshu3.autoSize=true;this.labelmiaoshu3.wordWrap=true;this.labelmiaoshu7.autoSize=true;this.labelmiaoshu7.wordWrap=true;this.labelmiaoshu5.autoSize=true;this.labelmiaoshu5.wordWrap=true};t.prototype.setGetDesc=function(t){var e=fabaonew.FaBaoNewModel.getIns().getMagicCfgById(t.id);if(csv.ItemProxy.getIns().getItemCfgById(t.id).clientget!=""||e&&e.isActive==1){this.taitou5.visible=false;this.labelmiaoshu8.visible=false}else{this.taitou5.titlelabel.text=app.getLang("itemtipe_info");this.labelmiaoshu8.text=app.getLang("item_get_"+t.id);this.taitou5.y=this.curHeight+this.GAP*2;this.labelmiaoshu8.y=this.taitou5.y+this.GAP+this.taitou5.height;this.curHeight=this.labelmiaoshu8.y+this.labelmiaoshu8.contextHeight;this.taitou5.visible=true;this.labelmiaoshu8.visible=true}};t.prototype.setSkillEffect=function(t,e,i,n){this.taitou6.visible=this.taitou1.visible=false;this.labelmiaoshu3.visible=this.labelmiaoshu6.visible=false;this.curHeight=this.wuxingbox.y+this.wuxingbox.height;this.labelmiaoshu2.text="";var a=csv.MagicidProxy.getIns().getSkillParam(t.id,e,i,n);var o=0;if(a.isInitiative){if(a.attrlist.length>=o+1){this.taitou1.titlelabel.text=app.getLang("magiclisttag3_17");this.labelmiaoshu3.text=a.attrlist[o].desc;this.taitou1.visible=this.labelmiaoshu3.visible=true;this.taitou1.y=this.curHeight;this.labelmiaoshu3.y=this.taitou1.y+this.GAP+this.taitou1.height;this.curHeight=this.labelmiaoshu3.contextHeight+this.labelmiaoshu3.y;o++}}var s="";for(var r=o;r<a.attrlist.length;r++){s+=a.attrlist[r].desc+"<br>"}if(s!=""){this.taitou6.visible=this.labelmiaoshu6.visible=true;this.taitou6.titlelabel.text=app.getLang("magiclisttag3_18");this.labelmiaoshu6.text=s;this.taitou6.y=this.curHeight+this.GAP*2;this.labelmiaoshu6.y=this.taitou6.y+this.GAP+this.taitou6.height;this.curHeight=this.labelmiaoshu6.contextHeight+this.labelmiaoshu6.y}};t.prototype.setData=function(t,e,i,n){this.curHeight=0;if(!this._fiveStar){this._fiveStar=new chouka.FiveStar;this._fiveStar.x=this.imgdizuo.x;this._fiveStar.y=this.imgdizuo.y}var a=chouka.ChouKaModel.getIns().getWuXinAttr(this.itemList,csv.FaBaoNewProxy.getIns().getStarAttr(t.id,i).split(";"),t);var o=app.getLang("magic_color_in").split(":");this._fiveStar.draw(a,csv.ChouKaProxy.getIns().getLen,o[0],parseFloat(o[1]));this.wuxingbox.addChild(this._fiveStar);this.setSkillEffect(t,e,i,n);var s=csv.ChouKaProxy.getIns().getNingYun(t,i);if(s&&chouka.ChouKaModel.getIns().isSpecial(t.id)){this.taitou2.visible=true;this.taitou2.y=this.curHeight+this.GAP;this.taitou2.titlelabel.text=app.getLang("magiclisttag3_16");this.labelmiaoshu5.y=this.taitou2.y+this.taitou2.height+this.GAP*2;this.labelmiaoshu5.text=app.getLang(s.desc,s.showValue);this.curHeight=this.labelmiaoshu5.y+this.labelmiaoshu5.contextHeight}else{this.taitou2.visible=false;this.labelmiaoshu5.text=""}this.taitou3.y=this.curHeight+this.GAP*2;this.taitou3.titlelabel.text=app.getLang("magiclisttag3_7");this.labelmiaoshu7.y=this.taitou3.y+this.GAP+this.taitou3.height;this.labelmiaoshu7.text=csv.ItemProxy.getItemDes(t.id);this.curHeight=this.labelmiaoshu7.y+this.labelmiaoshu7.contextHeight;this.setGetDesc(t);this.taitou4.visible=false;this.labelchuandai.visible=false;this.curHeight+=this.GAP};return t}(ui.tips.wuxingshuxingviewUI);var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.wuxin=new i;this.wuxin.y=20;this.daojubox.addChild(this.wuxin)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};Object.defineProperty(e.prototype,"itemVo",{get:function(){return this.tipData},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"curSource",{get:function(){if(this.itemVo){var t=this.itemVo.ext;if(t){return t.source}}},enumerable:true,configurable:true});e.prototype.addRightHead=function(){if(this.touxiang){this.touxiang.visible=false;if(this.curSource==fabaonew.EFabaoSource.Chat){}else{if(app.ViewManager.DisplayedInStage(fabaonew.FabaoSelectBagView.SINGLE_KEY)||this.curSource==fabaonew.EFabaoSource.Liebiao){var t=chouka.ChouKaModel.getIns().getIsEquiped(this._magicBaseXCfg.id);if(t){var e=game.Context.roleList[t.combatPos-1];this.imgtouxiang.skin=e.getHeadIconUrl();this.touxiang.visible=true}}}}};e.prototype.refreshAll=function(){this.daojubox.scrollTo(0,0);this.tipData=this.dataSource[0];var t=this.itemVo.ext;this._magicBaseXCfg=csv.ChouKaProxy.getIns().getBaseCfg(this.itemVo.itemCfg.id);this.pinzhiimg.skin=s.TipManager.getTipIcon(this.itemVo.itemCfg.qua);if(!this._magicBaseXCfg){console.log("itemid:"+this.itemVo.itemCfg.id+"not a magic!!");return}this.addRightHead();if(t&&t.ownerName){}else{}var e=chouka.ChouKaModel.getIns().getFabaoByEquip(this.itemVo.itemCfg.id);this.daoju.skin="res/icon/magicweapon_s/"+e.cfg.res+".png";if(this.itemVo.itemCfg.p1){this.labelpinzhi.text="品质："+app.getLang("magic_quality_"+this.itemVo.itemCfg.qua)+app.getLang("magic_qualitysub_1")}else{this.labelpinzhi.text="品质："+app.getLang("magic_quality_"+this.itemVo.itemCfg.qua)}var i=0;var n=0;if(t&&t.level!=undefined){i=t.level;n=t.star}else{i=e.level;n=e.star}var a=false;if(this.curSource==fabaonew.EFabaoSource.TuJian){a=true}else{a=n>=this._magicBaseXCfg.star+1}if(chouka.ChouKaModel.getIns().isSpecial(this._magicBaseXCfg.id)){a=false}this.juexing.visible=a;this._updateStarLevel(n,i,this._magicBaseXCfg);this.callHandler=this.dataSource[1];this.namelabel.text=app.getLang(this._magicBaseXCfg.namelang);this.namelabel.color=game.STYLES.ITEM_QUALITY[csv.ChouKaProxy.getIns().getQuality(this._magicBaseXCfg.id)];this.zhanlilabel.text=csv.ChouKaProxy.getIns().getTypeDesc(this._magicBaseXCfg);this.xianzhilabel.text=app.getLang("magiclisttag3_5")+csv.ChouKaProxy.getIns().getAllPoint(this._magicBaseXCfg.id,n,i);this.wuxin.setData(this._magicBaseXCfg,i,n,this.curSource==fabaonew.EFabaoSource.TuJian);this.daojubox.height=this.wuxin.curHeight+this.wuxin.y;this.tipsbg.height=this.daojubox.y+this.wuxin.curHeight+35;var o=fabaonew.FaBaoNewModel.getIns().getMagicCfgById(this.itemVo.itemCfg.id);this.closeGetList();if(o&&o.isActive==1||this.itemVo.itemCfg.clientget==""){}else{this.openGetList()}this.updateBg()};e.prototype._updateStarLevel=function(t,e,i){var n=[];for(var a=0;a<6;a++){if(a<t){n.push(1)}else{}}this.liststars.array=n;this.qianghua.visible=false;if(e>0){this.qianghua.visible=true;this.qianghua.value="+"+e.toString()}};e.prototype.closeGetList=function(){if(this.getList&&this.getList.parent){this.removeChild(this.getList)}};e.prototype.openGetList=function(){if(!this.getList){this.getList=new s.TipGetListView}this.addChild(this.getList);this.getList.setData(this.itemVo.itemCfg.clientget,this.itemVo.itemCfg)};e.prototype.onCloseLayer=function(){if(s.TipWuXingView.itemList.length>0){var t=s.TipWuXingView.itemList.pop();if(t.ext&&t.ext){var e=t.ext;if(e.shop){if(e.shop.callBackHandler){e.shop.callBackHandler.run()}}if(e.btnType==s.TipManager.TIP_BTN_TYPE.FA_BAO_SUIPIAN_PREVIEW){s.TipManager.show(e.sourceTarget,true)}}}};e.prototype.onUnDisplay=function(){this.closeGetList();this.clear();Laya.timer.once(250,this,this.onCloseLayer)};e.prototype.clear=function(){};e.prototype.getTipX=function(){return this.tipsbg.x};e.prototype.getTipH=function(){if(this.getList&&this.getList.parent){return this.tipsbg.height+this.getList.height}return this.tipsbg.height};e.prototype.getTipW=function(){return this.tipsbg.width};e.prototype.getBottomX=function(){return this.tipsbg.x+this.tipsbg.width};e.prototype.getBottomY=function(){return this.tipsbg.y+this.tipsbg.height};e.prototype.updateBg=function(){if(this.callHandler){this.callHandler.run()}if(this.getList){this.getList.x=this.getTipX();this.getList.y=this.getBottomY()}this.zhuangshiimg02.y=this.getTipH()-s.TipManager.GAPS.GAP_ICON;this.hitArea=new Laya.Rectangle(0,0,this.getTipW(),this.getTipH())};e.SINGLE_KEY="tip.TipWuXingView";e.itemList=[];return e}(ui.tips.fabaoitipsnewUI);s.TipWuXingView=t})(tip||(tip={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tip;(function(s){var p=xinfa.XinFaModel;var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.daojubox.vScrollBarSkin="";this.daojubox.vScrollBar.isVertical=true;this.daojubox.vScrollBar.elasticBackTime=0;this.daojubox.vScrollBar.elasticDistance=0};Object.defineProperty(e.prototype,"vo",{get:function(){return this.tipData},enumerable:true,configurable:true});e.prototype.addAttr=function(){var t=this.tipData.itemCfg.id;this.xinfaCfg=csv.XinFanProxy.getIns().cfgMap[t];this.addWuXing();this.baseProp();this.levelProp();this.gongming();this.fenjie();this.currH+=s.TipManager.GAPS.GAP_BOTTOM};e.prototype.baseProp=function(){this.addTitleView(app.getLang("xinfa_text_3"));this.addAttrList(Attributes.decode(this.xinfaCfg.attr).baseList,"{0}: {1}")};e.prototype.levelProp=function(){if(!this.vo.xinfa){return}if(this.vo.xinfa.data){var t=p.getIns().getLvProps(this.vo.xinfa.data.lv);if(t.length){this.addTitleView(app.getLang("xinfa_text_4"));this.addAttrList(t,"{0}: {1}")}}};e.prototype.addSkillDes=function(t,e,i){if(t.suitskill&&t.suitskill.length>0){var n=t.suitskill.split("-");var a=csv.SkillProxy.getIns().getCfg(n[0],parseInt(n[1])).explain;if(a&&a.length>0){var o=this.createLabel(e);o.text=app.getLang(a);o.wordWrap=true;o.width=this.daojubox.width-i;this.daojubox.addChild(o);o.color=e;o.x=i;o.y=this.currH;this.currH+=o.height;this.currH+=s.TipManager.GAPS.GAP_V_BUTTON}}};e.prototype.gongming=function(){if(!this.vo.xinfa){return}this.addTitleView(app.getLang("xinfa_text_5"));var t=csv.XinFanProxy.getIns().getSuitArrByItem(this.xinfaCfg.id.toString());var e=p.getIns().getSuitCntByCfgList(this.vo.xinfa.role,t[0]);var i=csv.XinFanProxy.getIns().getSuitName(this.xinfaCfg.id);if(i){this.addTitle2View(i.nameame,game.STYLES.ITEM_QUALITY[i.quality]);var n=80;for(var a=0;a<t.length;a++){var o=t[a];var s=parseInt(o.neednum);var r=game.STYLES.GRAY_COLOR;if(e>=s){r=game.STYLES.GREEN_COLOR}var l=this.createLabel(r);l.text=app.getLang("xinfa_text_6",s);this.daojubox.addChild(l);l.x=0;l.y=this.currH;l.align="left";var h=Attributes.decode(o.suitprop).baseList;this.addAttrList(h,"{0}+{1}",r,n);this.addSkillDes(o,r,n)}}else{if(ent.DebugConfig.isDebugger){game.Alert.show("xinfasuit.csv id="+this.xinfaCfg.id)}}};e.prototype.fenjie=function(){this.addTitleView(app.getLang("xinfa_text_7"));var t=app.str2Array(this.xinfaCfg.recovery,"-");var e=game.ItemUtil.createVO(parseInt(t[0]));var i=this.createLabel();i.text=e.getName()+" +"+t[1];this.daojubox.addChild(i);i.y=this.currH;this.currH+=i.height};e.prototype.addWuXing=function(){var t=this.createLabel();t.x=this.xianzhilabel.x;var e=this.xianzhilabel.y;if(this.xianzhilabel.visible){e=this.xianzhilabel.y+this.xianzhilabel.textField.textHeight}t.y=e;t.text=app.getLang("xinfa_text_2")+app.getLang("xinfa_text_attr"+parseInt(this.xinfaCfg.type))};e.SINGLE_KEY="tip.TipXinFaView";return e}(s.TipItemView);s.TipXinFaView=t})(tip||(tip={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tip;(function(d){var t=function(e){__extends(n,e);function n(){var t=e!==null&&e.apply(this,arguments)||this;t._btnMap={};return t}n.getIns=function(){return app.Singleton.getInstance(n)};n.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};n.prototype.onClick=function(t){t.stopPropagation();var e;for(var i in this._btnMap){if(this._btnMap[i]==t.currentTarget){e=parseInt(i);break}}this.event(n.CLICK_TYPE,e)};n.prototype.onDisplay=function(){this.callLater(this.refreshAll)};n.prototype.onUnDisplay=function(){};n.prototype.refreshAll=function(){};n.prototype.setData=function(t,e,i){while(this.numChildren>0){this.removeChildAt(0)}var n=t.length;var a=[];var o=0;for(var s=0;s<n;++s){var r=t[s];var l=this._btnMap[r];if(!l){l=new Laya.Button;this._btnMap[r]=l;l.on(Laya.Event.CLICK,this,this.onClick);if(r==d.TipManager.TIP_BTN_TYPE.SEVEN_SOUL_RESET){var h=new game.ComMiniIcon;h.name="miniIcon";h.x=5;h.y=10;var p=new Laya.Label;p.font="SimHei";p.fontSize=20;p.color=game.STYLES.DESC_TXT_COLOR_S;p.name="moneyValue";p.y=18;p.x=h.x+h.width;l.addChild(h);l.addChild(p)}}this.addChild(l);var u=false;if(r==d.TipManager.TIP_BTN_TYPE.EQUIP_PEIYANG){var c=game.GridsModel.EquipEnums.indexOf(i.flag);if(c==-1){}else{u=equip.EquipModel.getIns().getPeiyangByPos(c+1,i.pos)}this.setBtnRed(l,u);guide.GuideModel.getIns().register(csv.GuideProxy.ENUM_VIEW.EQUIP_PEYANG,l)}else if(r==d.TipManager.TIP_BTN_TYPE.WEAR){guide.GuideModel.getIns().register(csv.GuideProxy.ENUM_VIEW.EQUIP_PER_WEAR,l)}else if(r==d.TipManager.TIP_BTN_TYPE.NIN_YUN){guide.GuideModel.getIns().register(csv.GuideProxy.ENUM_VIEW.FABAO_NINGYUN,l)}else if(r==d.TipManager.TIP_BTN_TYPE.RONGLIAN){guide.GuideModel.getIns().register(csv.GuideProxy.ENUM_VIEW.TIP_SMELT,l)}else if(r==d.TipManager.TIP_BTN_TYPE.USE){guide.GuideModel.getIns().register(csv.GuideProxy.ENUM_VIEW.TIP_USE,l)}else if(r==d.TipManager.TIP_BTN_TYPE.REPLACE){var c=game.GridsModel.EquipEnums.indexOf(i.flag);if(c!=-1){u=equip.EquipModel.getIns().checkEquipReplace(c+1,i.pos)}this.setBtnRed(l,u);guide.GuideModel.getIns().register(csv.GuideProxy.ENUM_VIEW.TIP_REPLACE,l)}else if(r==d.TipManager.TIP_BTN_TYPE.GARDEN_58){guide.GuideModel.getIns().register(csv.GuideProxy.ENUM_VIEW.LIZHI_GET,l)}else if(r==d.TipManager.TIP_BTN_TYPE.BUY){guide.GuideModel.getIns().register(csv.GuideProxy.ENUM_VIEW.SHOP_BUY,l)}else if(r==d.TipManager.TIP_BTN_TYPE.ZHU_NIN){guide.GuideModel.getIns().register(csv.GuideProxy.ENUM_VIEW.FABAO_ZHULIN,l)}else if(r==d.TipManager.TIP_BTN_TYPE.BUY_GUILD_SHOP){guide.GuideModel.getIns().register(csv.GuideProxy.ENUM_VIEW.BANGHUI_SHOP_ITEM_BUY,l)}a.push(l);if(s==0){l.skin="public/btn_green.png";l.labelColors=game.STYLES.BLUE_BTN_COLOR_S}else{l.skin="public/btn_orange.png";l.labelColors=game.STYLES.YELLOW_BTN_COLOR_S}l.labelFont="SimHei";l.labelSize=26;l.labelPadding="0,0,1,0";l.y=(57+d.TipManager.GAPS.GAP_V_BUTTON)*o;var g="tip_btn_"+r;if(r==d.TipManager.TIP_BTN_TYPE.BUY_MEDAL_SHOP||r==d.TipManager.TIP_BTN_TYPE.BUY_GUILD_SHOP){g="tip_btn_"+d.TipManager.TIP_BTN_TYPE.BUY}else if(r==d.TipManager.TIP_BTN_TYPE.SEVEN_SOUL_RESET){l.labelPadding="0,0,1,25"}l.label=app.getLang(g);o++}if(e){for(var f=0;f<e.length;f++){if(e[f]){game.RedDotView.addTo(a[f])}else{game.RedDotView.removeFrom(a[f])}}}};n.prototype.setBtnRed=function(t,e){if(e){game.RedDotView.addTo(t,165)}else{game.RedDotView.removeFrom(t)}};n.prototype.setRefreshcost=function(t){var e=this._btnMap[d.TipManager.TIP_BTN_TYPE.SEVEN_SOUL_RESET];if(e){var i=e.getChildByName("moneyValue");var n=e.getChildByName("miniIcon");n.parserIcon(t,i,"",true)}};n.SINGLE_KEY="tip.TipBtnListView";n.CLICK_TYPE="CLICK_TYPE";return n}(Laya.View);d.TipBtnListView=t})(tip||(tip={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tip;(function(g){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.btnrukou.on(Laya.Event.CLICK,this,this.onClick)};e.prototype.onClick=function(){if(battle.BattleModel.getIns().checkBattleState(true)){return}while(g.TipWuXingView.itemList.length>0){g.TipWuXingView.itemList.pop()}Laya.Dialog.closeAll();if(this._funcId==csv.FunctionsProxy.ENUMS.REFINE_HOUSE){game.ClosureManager.callFunction(csv.FunctionsProxy.ENUMS.REFINE_HOUSE,true,false,"1")}else if(this._funcId==csv.FunctionsProxy.ENUMS.MOUNTAIN_NEW){var t=this.cfg.id;var e=app.str2Array(game.Config.getParams(1011),";");var i=[];var n=mountain.MountainModel.getIns().mountainId;var a=csv.MountainProxy.getIns().getArr().length;var o=n-parseInt(e[0]);var s=n+1+parseInt(e[1]);o=o<0?0:o;s=s>a?a:s;for(var r=o;r<s;r++){i.push(csv.MountainProxy.getIns().getCfg(r+1))}var l=fabaonew.FaBaoNewModel.getIns().getPlayMode(fabaonew.Etask_type.SevenColorMountain);var h=-1,p=void 0;for(var r=0;r<i.length;r++){if(game.Context.teamLv>=i[r].teamlevel-l){if(i[r].id>n){if(i[r].award_item.length>0&&t==game.ItemUtil.parserList(i[r].award_item)[0].getItemId()||i[r].clear_item.length>0&&t==game.ItemUtil.parserList(i[r].clear_item)[0].getItemId()){h=i[r].id}}else{p=game.ItemUtil.parserList(i[r].clear_item)[0];if(p&&t==p.getItemId()){h=i[r].id}}}}if(h>0){game.ClosureManager.callFunction(csv.FunctionsProxy.ENUMS.MOUNTAIN_NEW,true,false,h+"")}else{manager.FlowManager.instance.flowByStyle1(app.getLang("mountain_tips18"))}}else if(this._funcId==csv.FunctionsProxy.ENUMS.MJING_ITEM){var u=guaji.GuajiModel.getIns().passId;var i=csv.GuajiProxy.getIns().getMijingArray();var c=void 0;for(var r=i.length-1;r>=0;r--){if(game.Context.teamLv>=i[r].teamlevel){if(guaji.GuajiModel.getIns().passId>=i[r].guanqia){if(this.findItem(i[r].rewardway)){u=csv.GuajiProxy.getIns().getGuanqiaByMijingId(i[r].id);c=i[r];break}}}}game.ClosureManager.callFunction(csv.FunctionsProxy.ENUMS.PASS,true,false,u+"");if(c){guaji.GuajiModel.getIns().updateReddotDict(c);if(c.type==1){app.ViewManager.toggleDialog(guaji.MijingInfoView,1,0,[c])}else if(c.type==2){app.ViewManager.toggleDialog(guaji.DongInfoView,1,0,[c])}}}else{var i=app.str2Array(this.dataSource,"-");if(i[2]){game.ClosureManager.callFunction(this._funcId,true,false,i[2])}else{game.ClosureManager.callFunction(this._funcId)}}app.ViewManager.toggleDialog(g.TipMeiator,-1,0)};e.prototype.findItem=function(t){var e=false;if(t.length>0){var i=game.ItemUtil.parserList(t);for(var n=0;n<i.length;n++){if(i[n].getItemId()==this.cfg.id){e=true;break}}}return e};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){var t=app.str2Array(this.dataSource,"-");this.imgtuijian.visible=Boolean(t[1]=="1");this._funcId=parseInt(t[0]);var e=csv.FunctionsProxy.getIns().getCfg(this._funcId);if(this._funcId==csv.FunctionsProxy.ENUMS.GUILD_PK_SHOP){var i=guild.GuildPkModel.getIns().info;if(i){var n=csv.CycleActivityFunction.getIns().getCfg(i.actid);if(n&&n.type==2){this.btnrukou.skin="res/static/mainicon/btn_sub_kuafuzhengba.png";return}}}if(this._funcId==csv.FunctionsProxy.ENUMS.TASK_MAIN){var a=game.Context.roleList.length;if(a<7){var o=a+1;this.btnrukou.skin="res/static/mainicon/btn_sub_huluxiongdi_"+o+".png"}else{this.btnrukou.skin="res/static/mainicon/btn_sub_huluxiongdi_1.png"}return}if(e){if(e.bigicon==""){game.Alert.show("function id:"+e.id+" bigicon字段 未配置数据")}else{this.btnrukou.skin=csv.FunctionsProxy.getIns().getUrl(e.bigicon,e.resident)}}};e.SINGLE_KEY="tip.TipGetBtnView";e.BTN_WIDTH=97;e.BTN_HEIGHT=94;return e}(ui.tips.tipitemdaojuUI);g.TipGetBtnView=t})(tip||(tip={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tip;(function(h){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.titlelabel.text=app.getLang("itemtipe_info1")};e.prototype.getGuideItem=function(t){for(var e=0;e<this.daojubox.numChildren;e++){var i=this.daojubox.getChildAt(e);if(i&&i.dataSource==t){return i}}return null};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t,e){if(e===void 0){e=null}while(this.daojubox.numChildren){this.daojubox.removeChildAt(0)}var i=app.str2Array(t,";");var n=i.length;var a=n*h.TipGetBtnView.BTN_WIDTH+(n-1)*20;var o=(this.daojubox.width-a)/2;for(var s=0;s<n;s++){var r=i[s];var l=new h.TipGetBtnView;this.daojubox.addChild(l);l.dataSource=r;l.cfg=e;l.x=o;o+=h.TipGetBtnView.BTN_WIDTH+20}};e.SINGLE_KEY="tip.TipGetListView";return e}(ui.tips.tipgetlistview01UI);h.TipGetListView=t})(tip||(tip={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tip;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){this._role=t.role;if(this._role){this.labelnum.visible=true;this.imglock.visible=false;this.imgtouxiang.visible=true;this.imgtouxiang.skin=this._role.getHeadIconUrl();this.labelnum.text=csv.ReBirthProxy.getIns().getTransLvl(this._role.level).toString();this.imglock.visible=false}else{this.labelnum.visible=false;this.imglock.visible=true;this.imgtouxiang.visible=false}this.imgxuanzhong.visible=t.select;if(t.boRed){game.RedDotView.addTo(this)}else{game.RedDotView.removeFrom(this)}};e.SINGLE_KEY="tip.TipRoleItem";return e}(ui.tips.tipitemzhuangbeiUI);t.TipRoleItem=e})(tip||(tip={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tip;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.mediator=new common.RoleListMediator2(this.listzhuangbei,i.TipRoleItem);this.listzhuangbei.scrollRectOffX=2;this.listzhuangbei.scrollRectOffY=2};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){this.redArr=[]};e.prototype.refreshAll=function(){this.mediator.setData(-1,game.Context.roleList);if(this.redArr){this.mediator.setRedArr(this.redArr)}};e.SINGLE_KEY="tip.TipRoleListView";return e}(ui.tips.tipgetlistview02UI);i.TipRoleListView=t})(tip||(tip={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var title;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){app.ViewManager.regist(i.TitleNameView,"chenghao.atlas");game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.TITLE_NAME,i.TitleNameView);app.ViewManager.regist(i.TitleHeadView,"touxian.atlas");game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.TITLE_HEAD,i.TitleHeadView);csv.FunctionsProxy.getIns().on(csv.FunctionsProxy.EVENTS.CHANGE,this,this.onUpdataTitleNameRedDot);csv.FunctionsProxy.getIns().on(csv.FunctionsProxy.EVENTS.CHANGE,this,this.onRedDotChange);game.GridObserver.getIns().onItemId(54001,this,this.onRedDotChange);game.GridObserver.getIns().onItemId(54002,this,this.onRedDotChange);game.GridObserver.getIns().onItemId(54003,this,this.onRedDotChange)};e.prototype.onRedDotChange=function(){Laya.timer.callLater(this,this.onUpdateRedDot)};e.prototype.onUpdateRedDot=function(){i.TitleModel.getIns().checkRedDot()};e.prototype.onUpdataTitleNameRedDot=function(){this.reddotTitleName()};e.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.TitleInfoAck,this,this.onTitleInfoAck);this.addMsgListener(app.ProtocolResponse.TitleActiveNotice,this,this.onTitleActiveNotice);this.addMsgListener(app.ProtocolResponse.TitlePastDueNotice,this,this.onTitlePastDueNotice);this.addMsgListener(app.ProtocolResponse.TitleEquipAck,this,this.onTitleEquipAck);this.addMsgListener(app.ProtocolResponse.HeadTitleInfoAck,this,this.onHeadTitleInfoAck);this.addMsgListener(app.ProtocolResponse.HeadTitleUpgradeAck,this,this.onHeadTitleUpgradeAck)};e.prototype.onHeadTitleInfoAck=function(t,e){game.Context.mainRole.headTitle=i.TitleModel.getIns().headTitleId=e.headTitleId;i.TitleModel.getIns().event(i.TitleEvent.TITLE_HEAD_UPDATE)};e.prototype.onHeadTitleUpgradeAck=function(t,e){if(e.success==1){if(i.TitleModel.getIns().headTitleId!=e.headTitleId){game.Context.mainRole.headTitle=i.TitleModel.getIns().headTitleId=e.headTitleId;i.TitleModel.getIns().event(i.TitleEvent.TITLE_HEAD_UPDATE);i.TitleModel.getIns().event(i.TitleEvent.TITLE_HEAD_UPGRADE_ACK)}}};e.prototype.onTitleInfoAck=function(t,e){i.TitleModel.getIns().updateTitleInfo(e.titleList,e.equipedTitle);this.reddotTitleName()};e.prototype.reddotTitleName=function(){i.TitleModel.getIns().checkTitleNameRedDot()};e.prototype.onTitleActiveNotice=function(t,e){if(game.Context.disableIosRecharge()&&csv.TitleProxy.getIns().getCfg(e.titleId).ios==1){return}i.TitleModel.getIns().titleAction(e.titleId,true);app.ViewManager.toggleDialog(i.AlertGetTitleView,1,0,e.titleId)};e.prototype.onTitlePastDueNotice=function(t,e){i.TitleModel.getIns().onTitlePastDueNotice(e.titleId);app.ViewManager.toggleDialog(i.AlertPastDueView,1,0,e.titleId);main.HintUIView.getIns().addHintMsg(csv.FunctionsProxy.ENUMS.TITLE_NAME)};e.prototype.onTitleEquipAck=function(t,e){if(e.success==1){game.Context.mainRole.usetitle=i.TitleModel.getIns().equipedTitle=e.equipedTitle;i.TitleModel.getIns().event(i.TitleEvent.TITLE_EQUIP_INFO_UPDATE);i.TitleModel.getIns().checkTitleNameRedDot()}};e.SINGLE_KEY="title.TitleModule";return e}(app.ModuleBase);i.TitleModule=t})(title||(title={}));var title;(function(s){var t=function(){function t(){}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.c2sTitleInfoReq=function(){app.ProtocolRequest.TitleInfoReq()};t.prototype.c2sTitleEquipReq=function(t){if(t&&t.state==1){if(t.titleId==s.TitleModel.getIns().equipedTitle){app.ProtocolRequest.TitleEquipReq(0)}else{app.ProtocolRequest.TitleEquipReq(t.titleId)}}};t.prototype.c2sHeadTitleInfoReq=function(){app.ProtocolRequest.HeadTitleInfoReq()};t.prototype.c2sHeadTitleUpgradeReq=function(){var t=parseInt(csv.TitleProxy.getIns().maxnobleLv.id);if(s.TitleModel.getIns().headTitleId<t){var e=this.checkMountainId(mountain.MountainModel.getIns().mountainId);if(e.length>0){manager.FlowManager.instance.flowByStyle1(e)}else{var i=csv.TitleProxy.getIns().getNobleCfg(s.TitleModel.getIns().headTitleId+1).cost;if(game.GridsModel.getIns().hasEnoughItems(i,false,true)){app.ProtocolRequest.HeadTitleUpgradeReq(s.TitleModel.getIns().headTitleId)}}}else{manager.FlowManager.instance.flowByStyle1(app.getLang("lotus_8"))}};t.prototype.checkMountainId=function(t){var e="";if(t>0){var i=parseInt(csv.TitleProxy.getIns().maxnobleLv.id);var n=s.TitleModel.getIns().headTitleId+1;if(n>=i){n=i}var a=csv.TitleProxy.getIns().getNobleCfg(n);var o=csv.MountainProxy.getIns().getCfg(a.needtowers);if(t<parseInt(a.needtowers)){e=app.getLang("需通关{0}",app.getLang(o.towername))}}else{var o=csv.MountainProxy.getIns().getCfg(1);e=app.getLang("需通关{0}",app.getLang(o.towername))}return e};t.prototype.goToMountain=function(){game.ClosureManager.callFunction(csv.FunctionsProxy.ENUMS.MOUNTAIN_NEW,true,true)};t.SINGLE_KEY="titleName.TitleController";return t}();s.TitleController=t})(title||(title={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var title;(function(s){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.titleList=[];t._titleIdNew=[];t.equipedTitle=0;t.headTitleId=0;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.init=function(){};t.prototype.checkRedDot=function(){var t=false;var e=this.headTitleId;var i=parseInt(csv.TitleProxy.getIns().maxnobleLv.id);game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.TITLE_HEAD);game.ClosureManager.removeXin(csv.FunctionsProxy.ENUMS.TITLE_HEAD);if(e<i){var n=mountain.MountainModel.getIns().mountainId;var a=s.TitleController.getIns().checkMountainId(n);if(a.length>0){t=false}else{var o=csv.TitleProxy.getIns().getNobleCfg(e+1).cost;t=game.GridsModel.getIns().hasEnoughItems(o)}if(t){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.TITLE_HEAD)}}return t};Object.defineProperty(t.prototype,"titleIdNew",{get:function(){return this._titleIdNew},set:function(t){this._titleIdNew=t;this.checkTitleNameRedDot()},enumerable:true,configurable:true});t.prototype.checkTitleNameRedDot=function(){var t=false;game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.TITLE_NAME);game.ClosureManager.removeXin(csv.FunctionsProxy.ENUMS.TITLE_NAME);if(this._titleIdNew.length>0){t=true;if(t){game.ClosureManager.addXin(csv.FunctionsProxy.ENUMS.TITLE_NAME)}}else if(this.equipedTitle<=0){for(var e in this.titleList){if(this.titleList[e].state==1){t=true;break}}if(t){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.TITLE_NAME)}}return t};t.prototype.onCompareScore=function(t){var e=csv.TitleProxy.getIns().getCfg(t);var i=e?Attributes.decode(e.useattr):Attributes.EMPTY;var n=e?Attributes.decode(e.activationattr):Attributes.EMPTY;var a=csv.TitleProxy.getIns().getCfg(this.equipedTitle);var o=a?Attributes.decode(a.useattr):Attributes.EMPTY;var s=a?Attributes.decode(a.activationattr):Attributes.EMPTY;var r=[];r=r.concat(o.baseList);r=r.concat(s.baseList);var l=Attributes.getAllRoleScore(r);var h=[];h=h.concat(i.baseList);h=h.concat(n.baseList);return Attributes.getAllRoleScore(h)>l};t.prototype.check=function(t){var e=[];for(var i=0;i<t.length;i++){var n=csv.TitleProxy.getIns().getCfg(t[i].titleId);var a=true;if(game.Context.disableIosRecharge()&&n.ios==1){a=false}if(a){e.push(t[i])}}return e};t.prototype.updateTitleInfo=function(t,e){this.titleList=this.check(t);this.equipedTitle=e;this.event(r.TITLE_LIST_UPDATE)};t.prototype.titleAction=function(t,e){var i=this.titleIdNew;i.push(t);this.titleIdNew=i;for(var n=0,a=this.titleList;n<a.length;n++){var o=a[n];if(o.titleId==t){if(e){o.state=1;o.activeTime=game.Context.getServerTime()}else{o.state=0}this.event(r.TITLE_LIST_UPDATE);break}}};t.prototype.onTitlePastDueNotice=function(t){if(this.equipedTitle==t){this.equipedTitle=0}this.titleAction(t,false)};t.prototype.getActiveAttributes=function(){var t=[];if(this.titleList){for(var e=0;e<this.titleList.length;e++){var i=this.titleList[e];if(i.state==1){var n=csv.TitleProxy.getIns().getCfg(i.titleId);var a=Attributes.decode(n.activationattr);t=t.concat(a.baseList)}}}return Attributes.hebingAttributes(t)};t.SINGLE_KEY="titleName.TitleModel";return t}(app.ModelBase);s.TitleModel=t;var r=function(){function t(){}t.TITLE_LIST_UPDATE="titleName.updataTitleNameList";t.TITLE_EQUIP_INFO_UPDATE="titleName.updataTitleNameEquipInfo";t.TITLE_HEAD_UPDATE="titleName.HeadTitleUpdate";t.TITLE_HEAD_UPGRADE_ACK="titleName.HeadTitleUpgradeAck";return t}();s.TitleEvent=r})(title||(title={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("title.csv");this.cfgMap=t.getMap("id");this.titleArray=t.getArray();var e=app.Config.getResById("noble.csv");this.nobleMap=e.getMap("id");var i=e.getArray();this.maxnobleLv=i[e.getArray().length-1]};e.prototype.getCfg=function(t){return this.cfgMap[t]};e.prototype.getArray=function(){return this.titleArray};e.prototype.getNobleCfg=function(t){return this.nobleMap[t]};e.prototype.getNobleSkin=function(t){if(typeof t=="number"){var e=this.getNobleCfg(t);if(e){return"res/icon/noble/"+e.rankres+".png"}return""}else if(t){return"res/icon/noble/"+t.rankres+".png"}return""};e.prototype.getTitleUrl=function(t){var e=this.getCfg(t);if(e){return"res/chenghao/"+e.titleeffect+".png"}return""};e.prototype.getBigTitleUrl=function(t){var e=this.getCfg(t);if(e){return"res/static/chenghaozhanshi/"+e.titleshow+".png"}return""};e.prototype.getRankTitleUrl=function(t,e){if(e===void 0){e=1}if(!this.rankTitleMap){this.rankTitleMap={};for(var i=0,n=this.titleArray.length;i<n;i++){var a=this.titleArray[i];if(parseInt(a.ranktype)!=0){if(!this.rankTitleMap[parseInt(a.ranktype)]){this.rankTitleMap[parseInt(a.ranktype)]={}}this.rankTitleMap[parseInt(a.ranktype)][parseInt(a.param)]=parseInt(a.id)}}}if(this.rankTitleMap[t]){return this.getBigTitleUrl(this.rankTitleMap[t][e])}return""};e.SINGLE_KEY="csv.TitleProxy";return e}(app.ModelBase);t.TitleProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var title;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.btnqianwangpeidai.clickHandler=new Laya.Handler(this,this.onClickHandler)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){var t=csv.TitleProxy.getIns().getCfg(this.dataSource);if(t.effect==""){this.imgchenghao.skin="res/static/chenghaozhanshi/"+t.titleshow+".png";if(this.titleEff){this.titleEff.removeSelf();this.titleEff.stop()}}else{this.imgchenghao.skin="";if(!this.titleEff){this.titleEff=new game.AniView;this.titleEff.x=this.imgchenghao.width/2;this.titleEff.y=this.imgchenghao.height/2+20}this.titleEff.load(t.effect,game.AniView.FILE_NAME.UI);this.imgchenghao.addChild(this.titleEff);this.titleEff.play()}};e.prototype.onClickHandler=function(){Laya.Dialog.manager.closeAll();game.ClosureManager.callFunction(csv.FunctionsProxy.ENUMS.TITLE_NAME,true,true)};e.SINGLE_KEY="titleName.AlertGetTitleView";return e}(ui.alert.chenghaojihuotipUI);t.AlertGetTitleView=e})(title||(title={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var title;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){var t=csv.TitleProxy.getIns().getCfg(this.dataSource);if(t.effect==""){this.imgchenghao.skin="res/static/chenghaozhanshi/"+t.titleshow+".png";if(this.titleEff){this.titleEff.removeSelf();this.titleEff.stop()}}else{this.imgchenghao.skin="";if(!this.titleEff){this.titleEff=new game.AniView;this.titleEff.x=this.imgchenghao.width/2;this.titleEff.y=this.imgchenghao.height/2+20}this.titleEff.load(t.effect,game.AniView.FILE_NAME.UI);this.imgchenghao.addChild(this.titleEff);this.titleEff.play()}};e.SINGLE_KEY="titleName.AlertPastDueView";return e}(ui.alert.chenghaoguoqitipUI);t.AlertPastDueView=e})(title||(title={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var title;(function(f){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.xiangxi.clickHandler=new Laya.Handler(this,this.onHeadTitleUpgrade);this.qianwangbtn.clickHandler=new Laya.Handler(this,this.onGoto);this.centerLayout=new game.CenterLayoutMediator(this.gezilist,this,100,this.gezilist.spaceX);this.shuxinglist.itemRender=ui.common.commonattr3UI;this.shuxinglist.renderHandler=new Laya.Handler(this,this.onComAttrItemRender);this.gezilist.renderHandler=new Laya.Handler(this,this.onRenderHandler);guide.GuideModel.getIns().register(csv.GuideProxy.ENUM_VIEW.HEAD_TITLE_UP,this.xiangxi)};e.prototype.setAvatar=function(){var t;var e=skin.SkinModel.getIns().getEquipSkinId(1);var i=csv.SkinProxy.getIns().getCfg(e);if(i){t=i.modelres}else{t=csv.DefclassProxy.getIns().getCfg(game.Context.roleList[0].prof).model}if(this.skt&&this.skt.parent){this.skt.removeSelf()}else{this.skt=new common.CSkt}this.skt.init(role.RoleVO.getSkinSkt(t));this.skt.scale(.4,.4);this.skt.x=this.width*.5;this.skt.y=300;this.boxlonggu.addChild(this.skt)};e.prototype.onComAttrItemRender=function(t){var e=t.dataSource;var i=e.curAttr;var n=e.nextAttr;t.txtName.text=Attributes.getPropName(n.propId);t.txtValue.text="+0";var a=0;if(i){t.txtValue.text="+"+Attributes.getPropValue(i.propId,i.value,i.formula);a=i.value}var o=n.value-a;t.txtNext.text="(+"+Attributes.getPropValue(n.propId,o,n.formula)+")";t.txtNext.visible=o>0};e.prototype.onRenderHandler=function(t){t.showBagCount(1);t.setData(t.dataSource)};e.prototype.onDisplay=function(){this.setAvatar();f.TitleModel.getIns().on(f.TitleEvent.TITLE_HEAD_UPDATE,this,this.updateHeadInfo);f.TitleModel.getIns().on(f.TitleEvent.TITLE_HEAD_UPGRADE_ACK,this,this.onUpgradeAck);f.TitleController.getIns().c2sHeadTitleInfoReq();this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){f.TitleModel.getIns().off(f.TitleEvent.TITLE_HEAD_UPDATE,this,this.updateHeadInfo);f.TitleModel.getIns().off(f.TitleEvent.TITLE_HEAD_UPGRADE_ACK,this,this.onUpgradeAck);this.skt&&this.skt.stop()};e.prototype.refreshAll=function(){};e.prototype.onUpgradeAck=function(){var t=f.TitleModel.getIns().headTitleId;var e=csv.TitleProxy.getIns().getNobleCfg(t);if(e){var i="res/icon/noble_big/"+e.rankres+".png";var n=this.touxianbg.parent.localToGlobal(new Laya.Point(this.touxianbg.x,this.zhandouliclip.y));app.ViewManager.toggleDialog(game.JiHuoSuccessView,1,0,[game.Config.ENUM_TYPE.IMG,i,n.x,n.y,null,null,1])}};e.prototype.updateHeadInfo=function(){var t=f.TitleModel.getIns().headTitleId;var e=parseInt(csv.TitleProxy.getIns().maxnobleLv.id);this.aniMax.stop();this.aniNormal.stop();var i=csv.TitleProxy.getIns().getNobleCfg(t);if(i){this.touxianbg.skin="res/icon/noble_big/"+i.rankres+".png";this.touxianbg.gray=false}else{this.touxianbg.skin="res/icon/noble_big/"+csv.TitleProxy.getIns().getNobleCfg(1).rankres+".png";this.touxianbg.gray=true}if(t<e){this.aniNormal.play(0,false);var n=csv.TitleProxy.getIns().getNobleCfg(t+1);var a=csv.MountainProxy.getIns().getCfg(n.needtowers);this.tiaojian3.text=app.getLang("nobel_need",app.getLang(a.towername));var o=mountain.MountainModel.getIns().mountainId;var s=f.TitleController.getIns().checkMountainId(o);var r=s.length>0?game.STYLES.RED_COLOR:game.STYLES.GREEN_COLOR_S;var l='<span color="'+r+'">'+o+'</span><span color="'+game.STYLES.GREEN_COLOR_S+'">/'+n.needtowers+"</span>";this.missionCur.innerTEXT=l;var h=Attributes.decode(n.attr).baseList;var p=Attributes.decode(i?i.attr:"").baseList;var u=[];for(var c=0,g=h.length;c<g;c++){u.push({curAttr:p[c],nextAttr:h[c]})}this.shuxinglist.array=u;this.shuxinglist.width=306;this.centerLayout.array=game.ItemUtil.parserList(n.cost);this.zhandouliclip.value=Attributes.getAllRoleScore(p)+"";if(f.TitleModel.getIns().checkRedDot()){game.RedDotView.addTo(this.xiangxi)}else{game.RedDotView.removeFrom(this.xiangxi)}}else{this.aniMax.play(0,false);this.labelyimanji.visible=true;this.imgyimanji.visible=true;var a=csv.MountainProxy.getIns().getCfg(i.needtowers);this.tiaojian3.text=app.getLang("nobel_need",app.getLang(a.towername));var o=mountain.MountainModel.getIns().mountainId;var s=f.TitleController.getIns().checkMountainId(o);var r=s.length>0?game.STYLES.RED_COLOR:game.STYLES.GREEN_COLOR_S;var l='<span color="'+r+'">'+o+'</span><span color="'+game.STYLES.GREEN_COLOR_S+'">/'+i.needtowers+"</span>";this.missionCur.innerTEXT=l;var p=Attributes.decode(i?i.attr:"").baseList;var u=[];for(var c=0,g=p.length;c<g;c++){u.push({curAttr:p[c],nextAttr:p[c]})}this.zhandouliclip.value=Attributes.getAllRoleScore(p)+"";this.shuxinglist.array=u;this.shuxinglist.width=220}};e.prototype.onHeadTitleUpgrade=function(){f.TitleController.getIns().c2sHeadTitleUpgradeReq()};e.prototype.onGoto=function(){f.TitleController.getIns().goToMountain()};e.SINGLE_KEY="title.TitleHeadView";return e}(ui.touxian.touxianviewUI);f.TitleHeadView=t})(title||(title={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var title;(function(l){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.opended=false;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.titleList=new common.CommonListMediator(this.listyeqianpaizi,l.TitleNameItem);this.titleList.setHSkin();this.btnshuaxin.clickHandler=new Laya.Handler(this,this.onClickHandler);this.imgyongjiu.visible=false;this.zhanshi01.visible=false;this.jihuo01.visible=false;this.zhanshi01.stop();this.jihuo01.stop();this.jihuo01.on(Laya.Event.COMPLETE,this,this.onAniEnd);this.ani1.stop();this.shuxinglist.itemRender=game.ComAttrItem10;this.shuxinglist.renderHandler=game.ComAttrItem10.CommonRender;this.lbl.on(Laya.Event.CLICK,this,this.onShowAttr)};t.prototype.onShowAttr=function(){app.ViewManager.toggleDialog(common.ComAttrTip,1,0,l.TitleModel.getIns().getActiveAttributes())};t.prototype.onAniEnd=function(){this.jihuo01.visible=false;this.jihuo01.stop()};t.prototype.onDisplay=function(){this.titleList.on(common.CommonListMediator.LIST_ITEM_SELECT,this,this.onTitleSelect);l.TitleModel.getIns().on(l.TitleEvent.TITLE_LIST_UPDATE,this,this.onUpdateList);l.TitleModel.getIns().on(l.TitleEvent.TITLE_EQUIP_INFO_UPDATE,this,this.onUpdateEquipInfo);this.labelhuodetujing.on(Laya.Event.CLICK,this,this.onOpenWin);l.TitleController.getIns().c2sTitleInfoReq();this.callLater(this.refreshAll);this.zhanshi01.play(0);this.zhanshi01.visible=true;this.ani1.play(0,true)};t.prototype.onUnDisplay=function(){this.titleList.off(common.CommonListMediator.LIST_ITEM_SELECT,this,this.onTitleSelect);l.TitleModel.getIns().off(l.TitleEvent.TITLE_LIST_UPDATE,this,this.onUpdateList);l.TitleModel.getIns().off(l.TitleEvent.TITLE_EQUIP_INFO_UPDATE,this,this.onUpdateEquipInfo);this.labelhuodetujing.off(Laya.Event.CLICK,this,this.onOpenWin);this.zhanshi01.stop();this.jihuo01.stop();this.zhanshi01.visible=false;this.jihuo01.visible=false;this.ani1.stop()};t.prototype.refreshAll=function(){if(this.opended==false){this.onUpdateList();this.opended=true}};t.prototype.onOpenWin=function(){var t=this.titleList.selecItemData;var e=csv.TitleProxy.getIns().getCfg(t.titleId);var i=parseInt(e.window);if(i>0){game.ClosureManager.callFunction(parseInt(e.window),true,true)}};t.prototype.clean=function(){this._endTime=0;Laya.timer.clear(this,this.coolDown)};t.prototype.coolDown=function(){var t=this._endTime-game.Context.getServerTime();if(t>0){this.labelyouxiaoshijian.text=app.getLang("title_limit",util.TimeUtil.sec2Str(t))}else{this.labelyouxiaoshijian.text=app.getLang("title_limit",util.TimeUtil.sec2Str(0));this.clean()}};t.prototype.onTitleSelect=function(){var t=this.titleList.selecItemData;var e=l.TitleModel.getIns().titleIdNew.indexOf(t.titleId);if(e>=0){var i=l.TitleModel.getIns().titleIdNew;i.splice(e,1);l.TitleModel.getIns().titleIdNew=i}var n=csv.TitleProxy.getIns().getCfg(t.titleId);if(n.activationattr!=""){var a=Attributes.decode(n.activationattr);this.shuxinglist.array=a.baseList;this.box.visible=true}else{this.box.visible=false}this.labelhuodetujing.text=app.getLang(n.conditiontext);var o=parseInt(n.window);this.labelhuodetujing.underline=false;if(o>0){this.labelhuodetujing.underline=true}if(n.effect==""){this.imgchenghao.visible=true;this.imgchenghao.skin="res/static/chenghaozhanshi/"+n.titleshow+".png";if(this.titleEff){this.titleEff.removeSelf();this.titleEff.stop()}}else{this.imgchenghao.visible=false;if(!this.titleEff){this.titleEff=new game.AniView;this.titleEff.x=this.ch.width/2;this.titleEff.y=this.ch.height/2+20;this.titleEff.scale(1.3,1.3)}this.titleEff.load(n.effect,game.AniView.FILE_NAME.UI);this.ch.addChild(this.titleEff);this.titleEff.play()}this.clean();var s=parseInt(n.limittime?n.limittime:"0")*3600;if(s>0){if(t.state==1){var r=t.activeTime+s-game.Context.getServerTime();this.labelyouxiaoshijian.text=app.getLang("title_limit",util.TimeUtil.sec2Str(r));this._endTime=t.activeTime+s;Laya.timer.loop(1e3,this,this.coolDown)}else{this.labelyouxiaoshijian.text=app.getLang("title_limit",util.TimeUtil.sec2Str(s))}this.labelyouxiaoshijian.visible=true}else{this.labelyouxiaoshijian.visible=false}this.imgyongjiu.visible=!this.labelyouxiaoshijian.visible;this.refreshBtn(t)};t.prototype.refreshBtn=function(t){this.btnshuaxin.disabled=t.state?false:true;var e="";this.weihuodeimg.visible=false;if(t.state==0){e=app.getLang("magicweapon_des6");this.weihuodeimg.visible=true}else if(t.titleId==l.TitleModel.getIns().equipedTitle){e=app.getLang("title_upload")}else{e=app.getLang("title_load")}this.btnshuaxin.visible=!this.weihuodeimg.visible;this.btnshuaxin.label=e};t.prototype.onClickHandler=function(){l.TitleController.getIns().c2sTitleEquipReq(this.titleList.selecItemData);if(this.titleList.selecItemData.titleId!=l.TitleModel.getIns().equipedTitle){this.jihuo01.visible=true;this.jihuo01.play(0,false)}};t.prototype.onUpdateEquipInfo=function(){this.refreshBtn(this.titleList.selecItemData)};t.prototype.onUpdateList=function(){var t=l.TitleModel.getIns().titleList;var e=0;t.sort(this.sortHToL);this.titleList.setData(e,t)};t.prototype.sortHToL=function(t,e){if(t.titleId==l.TitleModel.getIns().equipedTitle){return-1}if(e.titleId==l.TitleModel.getIns().equipedTitle){return 1}if(t.state>e.state){return-1}if(t.state<e.state){return 1}if(t.titleId<e.titleId){return-1}else if(t.titleId>e.titleId){return 1}return 0};t.SINGLE_KEY="titleName.TitleNameView";return t}(ui.chenghao.chenghaoUI);l.TitleNameView=t})(title||(title={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var title;(function(n){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){n.TitleModel.getIns().on(n.TitleEvent.TITLE_EQUIP_INFO_UPDATE,this,this.refreshflag);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){n.TitleModel.getIns().off(n.TitleEvent.TITLE_EQUIP_INFO_UPDATE,this,this.refreshflag)};e.prototype.refreshAll=function(){};e.prototype.setData=function(t,e){this._data=t;var i=csv.TitleProxy.getIns().getCfg(t.titleId);if(!i){game.Alert.show("title.csv id "+t.titleId+" did not exist!");return}this.imgbg.gray=t.state?false:true;this.refreshflag();this.imgname.skin="res/static/skin/"+i.titleword+".png";if(e&&e.titleId==t.titleId){this.imgbgxuanzhong.visible=t.state?true:false;this.imghuisebgxuanzhong.visible=!this.imgbgxuanzhong.visible}else{this.imgbgxuanzhong.visible=false;this.imghuisebgxuanzhong.visible=false}game.RedDotView.removeFrom(this);if(n.TitleModel.getIns().titleIdNew.indexOf(t.titleId)>=0){game.RedDotView.addTo(this,this.width-10,30,1,1,game.RedDotView.ENUM_TYPE.XIN)}};e.prototype.refreshflag=function(){this.imgyipeidai.visible=false;if(this._data&&this._data.state==1&&this._data.titleId==n.TitleModel.getIns().equipedTitle){this.imgyipeidai.visible=true}};e.SINGLE_KEY="titleName.TitleNameItem";return e}(ui.chenghao.chenghaoitem01UI);n.TitleNameItem=t})(title||(title={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tongtiange;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){app.ViewManager.regist(i.TongTianGeView);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.TONGTIANGE,i.TongTianGeView,null,game.ECommonType.COMMON_TYPE_TONGTIANGE);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.TONGTIANGE_CHALLENGE,i.TongTianGeChallengeView,null,game.ECommonType.COMMON_TYPE_TONGTIANGE);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.TONGTIANGE_SHOP,i.TongtianGeShopView,null,game.ECommonType.COMMON_TYPE_TONGTIANGE);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.TONGTIANGE_SHOP_PAIHANG,i.TongTianGePaiHangView,null,game.ECommonType.COMMON_TYPE_TONGTIANGE);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.TONGTIANGE_EXCHANGE,i.TongTianGeExchangeView,null,game.ECommonType.COMMON_TYPE_TONGTIANGE)};e.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.TongtiangeNtf,this,this.onTongtiangeNtf);this.addMsgListener(app.ProtocolResponse.TongtiangeBuildResp,this,this.onTongtiangeBuildResp);this.addMsgListener(app.ProtocolResponse.TongtiangeExchangeResp,this,this.onTongtiangeExchangeResp)};e.prototype.onTongtiangeExchangeResp=function(t,e){if(e.ret==1){}};e.prototype.onTongtiangeNtf=function(t,e){i.TongTianGeModel.getIns().updateData(e)};e.prototype.onTongtiangeBuildResp=function(t,e){if(e.ret==1){}};e.SINGLE_KEY="tongtiange.TongTianGeModule";return e}(app.ModuleBase);i.TongTianGeModule=t})(tongtiange||(tongtiange={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tongtiange;(function(r){var t=function(t){__extends(c,t);function c(){return t!==null&&t.apply(this,arguments)||this}c.getIns=function(){return app.Singleton.getInstance(c)};c.prototype.init=function(){this.exchangeNoticeArr=[];guaji.GuajiModel.getIns().on(guaji.GuajiModel.GUAJIPASS_DATA_UPDATE,this,this.onUpdateGuajiData)};c.prototype.updateData=function(t){this.serverData=t.serverData[0];this.playerData=t.playerData[0];if(this.exchangeNoticeArr.length==0){var e=this.getCanExchangeArr();for(var i=0;i<e.length;i++){var n=csv.TtgRenwuProxy.getIns().getExchangeArray(this.playerData.activityId,e[i]);for(var a=0;a<n.length;a++){if(n[a].remind==1){qiYu.QiYuModel.getIns().exchangeNoticeArr.push(n[a].id)}}}}this.updateRedDot();this.event(c.EVENTS.UPDATE_DATA)};c.prototype.onUpdateGuajiData=function(){this.updateRedDot()};c.prototype.updateRedDot=function(){var t=this.getSurpFreeNum();var e=this.getActCfg();if(!e){return}var i=game.ItemUtil.parserList(e.p3)[0];var n=game.GridsModel.getIns().getItemCount(i.getItemId());var a=guaji.GuajiModel.getIns().getGujiPassId();var o=e.p6.split("-");var s=this.playerData?this.playerData.recvXy:0;var r=Math.floor((a-s)/parseInt(o[0]))*parseInt(o[2]);if(t>0||n>0||r>0){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.TONGTIANGE)}else{game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.TONGTIANGE)}var l=this.getRewardTypeDot();if(l.length>0){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.TONGTIANGE_CHALLENGE)}else{game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.TONGTIANGE_CHALLENGE)}this.updateExchangeEntryDot()};c.prototype.onGetInfo=function(t){if(t){var e=false;var i=activitytaren.ActivityTaRenModel.getIns().iconMan.getActVoByActid(t.actID);if(i&&i.curCfg.client_type==activitytaren.ActivityTaRenType.TONGTIANGE_SHOP){var n=i.cfgList;for(var a=0;a<n.length;a++){var o=n[a];var s=i.getSubInfo(o.id);if(s){if(parseInt(o.p3)==r.ShopType.GoldBuy){if(s.num>0){e=true;break}}}}}if(e){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.TONGTIANGE_SHOP)}else{game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.TONGTIANGE_SHOP)}}};c.prototype.getExchangeData=function(t){var e=0;if(this.playerData){for(var i=0;i<this.playerData.exchangeData.length;i++){if(this.playerData.exchangeData[i].id==t){e=this.playerData.exchangeData[i].value;break}}}return e};c.prototype.isExchangeDot=function(t){var e=game.ItemUtil.parserList(t.consume)[0];var i=this.getExchangeData(t.id);var n=this.exchangeNoticeArr.indexOf(t.id);if(n!=-1&&i<t.value&&game.GridsModel.getIns().hasEnoughItems(e)){return true}return false};c.prototype.updateExchangeEntryDot=function(){var t=false;var e;for(var i=0;i<this.exchangeNoticeArr.length;i++){e=csv.TtgRenwuProxy.getIns().getExchangeCfg(this.exchangeNoticeArr[i]);if(this.isExchangeDot(e)){t=true;break}}if(t){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.TONGTIANGE_EXCHANGE)}else{game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.TONGTIANGE_EXCHANGE)}};c.prototype.getRewardTypeDot=function(){var t=[];var e=game.Config.getIntParams(2014);var i=[];var n=this.getTotalBuild(c.TYPES.PERSON_TYPE);var a=this.getTotalBuild(c.TYPES.SERVER_TYPE);var o=this.playerData?this.playerData.recvBid:[];var s;var r;for(var l=0;l<e;l++){r=l+1;i=csv.TtgRenwuProxy.getIns().getCfgArr(c.TYPES.PERSON_TYPE,r);for(var h=0;h<i.length;h++){s=o.indexOf(i[h].id);if(s==-1&&n>=i[h].value&&t.indexOf(c.TYPES.PERSON_TYPE)==-1){t.push(c.TYPES.PERSON_TYPE);break}}var p=this.getDotRound(r);if(p!=-1&&t.indexOf(c.TYPES.ROUND_TYPE)==-1){t.push(c.TYPES.ROUND_TYPE)}i=csv.TtgRenwuProxy.getIns().getCfgArr(c.TYPES.SERVER_TYPE,0);for(var u=0;u<i.length;u++){s=o.indexOf(i[u].id);if(s==-1&&a>=i[u].value&&t.indexOf(c.TYPES.SERVER_TYPE)==-1){t.push(c.TYPES.SERVER_TYPE);break}}}return t};c.prototype.getDotRound=function(t){var e=game.Config.getIntParams(2014);var i=csv.TtgRenwuProxy.getIns().getCfgArr(c.TYPES.ROUND_TYPE);if(t<=0||t>e||i.length==0){return-1}var n=this.playerData?this.playerData.recvBid:[];var a=this.getTotalBuild(c.TYPES.ROUND_TYPE);var o=[];var s=csv.TtgRenwuProxy.getIns().getCfgArr(c.TYPES.PERSON_TYPE,t);o=o.concat(s);o.push(i[t][0]);for(var r=0;r<o.length;r++){if(n.indexOf(o[r].id)==-1&&a>=o[r].value){return o[r].rounds}}return-1};c.prototype.getRankLabel=function(t){var e=t.rangk.split("-");var i=parseInt(e[0]);var n=parseInt(e[1]);if(i==n){return i.toString()}return i+"~"+n};c.prototype.getMyReward=function(t){if(t==0){return""}var e=c.getIns().getActCfg();var i=csv.TtgRenwuProxy.getIns().ttg_paihangbangArr;for(var n=0;n<i.length;n++){var a=i[n];if(e&&e.activityid==a.activityid){var o=a.rangk.split("-");var s=parseInt(o[0]);var r=parseInt(o[1]);if(t>=s&&t<=r){return a.reward}}}return""};c.prototype.getChallengeArr=function(t,e){var i=csv.TtgRenwuProxy.getIns().getCfgArr(t,e);if(t==c.TYPES.PERSON_TYPE&&!this.playerData||t==c.TYPES.SERVER_TYPE&&!this.serverData){return i}var n=[];var a=[];var o=[];var s=[];var r=this.getTotalBuild(t);for(var l=0;l<i.length;l++){var h=this.playerData?this.playerData.recvBid:[];var p=h.indexOf(i[l].id);if(p!=-1){s.push(i[l])}else{if(r>=i[l].value){a.push(i[l])}else{o.push(i[l])}}}n=a.concat(o).concat(s);return n};c.prototype.getSurpFreeNum=function(){var t=0;var e=this.getActCfg();if(!e){return 0}var i=this.playerData;if(i){t=e.p2-i.todayBuild;t=t>0?t:0}else{t=Number(e.p2)}return t};c.prototype.getActCfg=function(){var t=c.getIns();if(t.playerData){var e=t.playerData.activityId;var i=csv.ActivityTarenProxy.getIns().getCfgByActivityid(e);return i}return csv.ActivityTarenProxy.getIns().getCfgByActivityid(this.getOpenActid())};c.prototype.getTotalBuild=function(t){var e=0;if(t==c.TYPES.PERSON_TYPE||t==c.TYPES.ROUND_TYPE){var i=c.getIns().playerData;if(i){e=i.totalBuild}}else if(t==c.TYPES.SERVER_TYPE){var n=c.getIns().serverData;if(n){e=n.totalBuild}}return e};c.prototype.getOpenActid=function(){var t=activitytaren.ActivityTaRenModel.getIns().getActivityID_By_functionid(csv.FunctionsProxy.ENUMS.TONGTIANGE);if(t){return t.actid}return 0};c.prototype.getCanExchangeArr=function(){var t=[];var e=this.getNextOpenFloor();for(var i=1;i<=e;i++){var n=csv.TtgRenwuProxy.getIns().getExchangeArray(this.playerData.activityId,i);for(var a=0;a<n.length;a++){var o=qiYu.QiYuModel.getIns().getExchangeData(n[a].id);var s=game.ItemUtil.parserList(n[a].consume)[0];if(o<n[a].value&&game.GridsModel.getIns().hasEnoughItems(s)){t.push(i);break}}}return t};c.prototype.getNextOpenFloor=function(){if(this.playerData&&this.playerData.exchangeData.length){var t=this.playerData.exchangeData[this.playerData.exchangeData.length-1].id;var e=csv.TtgRenwuProxy.getIns().getExchangeCfg(t);var i=csv.TtgRenwuProxy.getIns().getExchangeArray(this.playerData.activityId,e.layer+1);if(e&&(i&&i.length>0)){return e.layer+1}return e.layer}return 1};c.SINGLE_KEY="tongtiange.TongTianGeModel";c.EXCHANGE_FLOOR_NUM=5;c.TYPES={PERSON_TYPE:1,ROUND_TYPE:2,SERVER_TYPE:3};c.EVENTS={UPDATE_DATA:"UPDATE_DATA"};return c}(app.ModelBase);r.TongTianGeModel=t})(tongtiange||(tongtiange={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("ttg_jianzaojiangli.csv");this.cfgMap=t.getMap("type","activityid")};e.prototype.getCfg=function(t,e){return this.cfgMap[t][e]};e.prototype.getRewardshow=function(t,e){var i=this.getCfg(t,e);var n=i.rewardshow;return n};e.SINGLE_KEY="csv.TtgjianzaojiangliProxy";return e}(app.ModelBase);t.TtgjianzaojiangliProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("ttg_renwu.csv");this.cfgMap=t.getMap("id");this.cfgMapList=t.getMapList("activityid","type","rounds");t=app.Config.getResById("ttg_paihangbang.csv");this.ttg_paihangbangArr=t.getArray();t=app.Config.getResById("ttg_duihuan.csv");var e=t.getArray()[0];this.ttg_duihuan_itemID=parseInt(app.str2Array(e.consume,"-")[0]);this.ttg_duihuan=t.getMapList("activityid","layer");this.duihuanCfgMap=t.getMap("id")};e.prototype.getExchangeItemID=function(){return this.ttg_duihuan_itemID};e.prototype.getExchangeCfg=function(t){return this.duihuanCfgMap[t]};e.prototype.getExchangeArray=function(t,e){return this.ttg_duihuan[t][e]};e.prototype.getCfg=function(t){return this.cfgMap[t]};e.prototype.getCfgArr=function(t,e){if(e===void 0){e=-1}var i=tongtiange.TongTianGeModel.getIns().getOpenActid();if(i==0){return[]}var n=this.cfgMapList[i][t][e];if(e!=-1){n=this.cfgMapList[i][t][e]}else{n=this.cfgMapList[i][t]}return n};e.prototype.nextFloor=function(t,e){var i=tongtiange.TongTianGeModel.getIns().getOpenActid();if(i==0){return-1}var n=this.cfgMapList[i][t][0];for(var a=n.length-1;a>=0;a--){if(e>=n[a].value){if(n[a+1]){return n[a+1].value}return-1}}return n[0].value};e.SINGLE_KEY="csv.TtgRenwuProxy";return e}(app.ModelBase);t.TtgRenwuProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tongtiange;(function(n){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.activityTimeView=new activitytaren.ActivityTimeView(this.daojishi,new Laya.Handler(this,this.endTimeCallBack),"miaosha_time_1");this.yeqian1.clickHandler=new Laya.Handler(this,this.onClickBtn1);this.yeqian2.clickHandler=new Laya.Handler(this,this.onClickBtn2);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){n.TongTianGeModel.getIns().on(n.TongTianGeModel.EVENTS.UPDATE_DATA,this,this.onUpdateData);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){n.TongTianGeModel.getIns().off(n.TongTianGeModel.EVENTS.UPDATE_DATA,this,this.onUpdateData)};e.prototype.getInfo=function(){};e.prototype.refreshAll=function(){var t=activitytaren.ActivityTaRenModel.getIns().iconMan.getActVOlist_by_client_type(activitytaren.ActivityTaRenType.TONGTIANGE);if(t.length>0){var e=t[0];this.activityTimeView.start(e.timeVo.endTime);if(this.canGetPerson()||!this.canGetServer()){this.onClickBtn1()}else{this.onClickBtn2()}this.updateRedDot()}};e.prototype.onClickBtn1=function(){this.yeqian1.selected=true;this.yeqian2.selected=false;this.clearBox();this.jiemian.addChild(n.TongTianGeChallengePersonView.getIns())};e.prototype.onClickBtn2=function(){this.yeqian1.selected=false;this.yeqian2.selected=true;this.clearBox();this.jiemian.addChild(n.TongTianGeChallengeServerView.getIns())};e.prototype.clearBox=function(){while(this.jiemian.numChildren>0){this.jiemian.removeChildAt(0)}};e.prototype.endTimeCallBack=function(){this.activityTimeView.stop();this.daojishi.text=""};e.prototype.onUpdateData=function(){this.callLater(this.updateRedDot)};e.prototype.updateRedDot=function(){if(this.canGetPerson()){game.RedDotView.addTo(this.yeqian1)}else{game.RedDotView.removeFrom(this.yeqian1)}if(this.canGetServer()){game.RedDotView.addTo(this.yeqian2)}else{game.RedDotView.removeFrom(this.yeqian2)}};e.prototype.canGetPerson=function(){var t=n.TongTianGeModel.getIns().getRewardTypeDot();var e=t.indexOf(n.TongTianGeModel.TYPES.PERSON_TYPE);var i=t.indexOf(n.TongTianGeModel.TYPES.ROUND_TYPE);return e!=-1||i!=-1};e.prototype.canGetServer=function(){var t=n.TongTianGeModel.getIns().getRewardTypeDot();var e=t.indexOf(n.TongTianGeModel.TYPES.SERVER_TYPE);return e!=-1};e.SINGLE_KEY="tongtiange.TongTianGeChallengeView";return e}(ui.tongtiangeui.tongtiangeview2UI);n.TongTianGeChallengeView=t})(tongtiange||(tongtiange={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tongtiange;(function(a){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.liebiao.itemRender=grids.GridView;this.liebiao.renderHandler=grids.GridView.CommonItemRender;this.qianwangbtn.clickHandler=new Laya.Handler(this,this.onClickGotoBtn);this.lingqubtn.clickHandler=new Laya.Handler(this,this.onClickGetBtn);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){this._data=t;var e=a.TongTianGeModel.getIns().getTotalBuild(this._data.type);this.tiaojian.text=app.getLang(t.text);this.shuzhi.text=e+"/"+t.value;this.jindutiao.value=e/t.value;var i=game.ItemUtil.parserList(t.reward);this.liebiao.array=i;this.updateBtnState(e)};e.prototype.updateBtnState=function(t){var e=a.TongTianGeModel.getIns().playerData;var i=e?e.recvBid:[];var n=i.indexOf(this._data.id);game.RedDotView.removeFrom(this.lingqubtn);if(n!=-1){this.yilingqu.visible=true;this.lingqubtn.visible=false;this.qianwangbtn.visible=false}else{this.yilingqu.visible=false;if(t>=this._data.value){this.lingqubtn.visible=true;this.qianwangbtn.visible=false;game.RedDotView.addTo(this.lingqubtn)}else{this.qianwangbtn.visible=true;this.lingqubtn.visible=false}}};e.prototype.onClickGotoBtn=function(){game.ClosureManager.callFunction(csv.FunctionsProxy.ENUMS.TONGTIANGE)};e.prototype.onClickGetBtn=function(){app.ProtocolRequest.TongtiangeAwardReq(1,this._data.id)};e.SINGLE_KEY="tongtiange.TongTianGeChallengeItem";return e}(ui.tongtiangeui.ttgpaimingitem1UI);a.TongTianGeChallengeItem=t})(tongtiange||(tongtiange={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tongtiange;(function(h){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.liebiao.itemRender=h.TongTianGeChallengeItem;this.liebiao.renderHandler=new Laya.Handler(this,this.onRenderHandler);this.daoju.itemRender=grids.GridView;this.daoju.renderHandler=grids.GridView.CommonItemRender;this.lingqubtn.clickHandler=new Laya.Handler(this,this.onClickBtn);this.zuo.clickHandler=new Laya.Handler(this,this.onClickLeftBtn);this.you.clickHandler=new Laya.Handler(this,this.onClickRightBtn);this.zuo.mouseEnabled=this.you.mouseEnabled=true;this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){h.TongTianGeModel.getIns().on(h.TongTianGeModel.EVENTS.UPDATE_DATA,this,this.onUpdateData);this.curRounds=this.getInitRoundNum();this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){h.TongTianGeModel.getIns().off(h.TongTianGeModel.EVENTS.UPDATE_DATA,this,this.onUpdateData)};e.prototype.onUpdateData=function(){this.callLater(this.refreshAll)};e.prototype.refreshAll=function(){var t=h.TongTianGeModel.getIns().getChallengeArr(h.TongTianGeModel.TYPES.PERSON_TYPE,this.curRounds);var e=csv.TtgRenwuProxy.getIns().getCfgArr(h.TongTianGeModel.TYPES.ROUND_TYPE,this.curRounds);var i=game.Config.getIntParams(2014);this.lunci.text=app.getLang("当前轮次{0}/{1}",this.curRounds,i);var n=game.ItemUtil.parserList(e[0].reward);this.daoju.array=n;this.liebiao.array=t;this.updateBtnState(e[0]);if(this.curRounds<=1){this.zuo.visible=false;this.you.visible=true}else if(this.curRounds>=i){this.zuo.visible=true;this.you.visible=false}else{this.zuo.visible=true;this.you.visible=true}var a=this.curRounds;var o=a-1;var s=a+1;var r=h.TongTianGeModel.getIns().getDotRound(o);var l=h.TongTianGeModel.getIns().getDotRound(s);if(r!=-1){game.RedDotView.addTo(this.zuo)}else{game.RedDotView.removeFrom(this.zuo)}if(l!=-1){game.RedDotView.addTo(this.you)}else{game.RedDotView.removeFrom(this.you)}};e.prototype.updateBtnState=function(t){var e=-1;var i=h.TongTianGeModel.getIns().playerData;if(i){e=i.recvBid.indexOf(t.id)}game.RedDotView.removeFrom(this.lingqubtn);if(e!=-1){this.lingqubtn.visible=false;this.weiwanchegnimg.visible=false;this.yilingquimg.visible=true}else{this.yilingquimg.visible=false;if(i&&i.totalBuild>=t.value){this.lingqubtn.visible=true;this.weiwanchegnimg.visible=false;game.RedDotView.addTo(this.lingqubtn)}else{this.lingqubtn.visible=false;this.weiwanchegnimg.visible=true}}};e.prototype.onRenderHandler=function(t,e){t.setData(t.dataSource)};e.prototype.onClickBtn=function(){var t=csv.TtgRenwuProxy.getIns().getCfgArr(h.TongTianGeModel.TYPES.ROUND_TYPE,this.curRounds);app.ProtocolRequest.TongtiangeAwardReq(1,t[0].id)};e.prototype.onClickLeftBtn=function(){if(this.curRounds>1){this.curRounds--}this.refreshAll()};e.prototype.onClickRightBtn=function(){var t=game.Config.getIntParams(2014);if(this.curRounds<t){this.curRounds++}this.refreshAll()};e.prototype.getInitRoundNum=function(){var t=csv.TtgRenwuProxy.getIns().getCfgArr(h.TongTianGeModel.TYPES.ROUND_TYPE);var e=h.TongTianGeModel.getIns().playerData;var i=0;var n=[];if(e){n=e.recvBid}var a=1;while(t[a]){var o=[];var s=csv.TtgRenwuProxy.getIns().getCfgArr(h.TongTianGeModel.TYPES.PERSON_TYPE,a);o=o.concat(s);o.push(t[a][0]);for(var r=0;r<o.length;r++){if(n.indexOf(o[r].id)==-1){return o[r].rounds}}a++}return 1};e.SINGLE_KEY="tongtiange.TongTianGeChallengePersonView";return e}(ui.tongtiangeui.tongtiangephview1UI);h.TongTianGeChallengePersonView=t})(tongtiange||(tongtiange={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tongtiange;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.liebiao.itemRender=i.TongTianGeChallengeItem;this.liebiao.renderHandler=new Laya.Handler(this,this.onRenderHandler);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){i.TongTianGeModel.getIns().on(i.TongTianGeModel.EVENTS.UPDATE_DATA,this,this.onUpdateData);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){i.TongTianGeModel.getIns().off(i.TongTianGeModel.EVENTS.UPDATE_DATA,this,this.onUpdateData)};e.prototype.onUpdateData=function(){this.callLater(this.refreshAll)};e.prototype.refreshAll=function(){var t=i.TongTianGeModel.getIns().getChallengeArr(i.TongTianGeModel.TYPES.SERVER_TYPE,0);this.liebiao.array=t};e.prototype.onRenderHandler=function(t,e){t.setData(t.dataSource)};e.SINGLE_KEY="tongtiange.TongTianGeChallengeServerView";return e}(ui.tongtiangeui.tongtiangephview2UI);i.TongTianGeChallengeServerView=t})(tongtiange||(tongtiange={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tongtiange;(function(a){var n=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.imgxuanzhong.visible=false;this.duihuanbtn.clickHandler=new Laya.Handler(this,this.onClick);this.tixing.on(Laya.Event.CHANGE,this,this.onChangeHandler)};e.prototype.onSelected=function(t){this.imgxuanzhong.visible=t};e.prototype.onChangeHandler=function(){var t=a.TongTianGeModel.getIns().getCanExchangeArr();if(t.indexOf(this.data.layer)!=-1){if(this.tixing.selected){if(a.TongTianGeModel.getIns().exchangeNoticeArr.indexOf(this.data.id)==-1){a.TongTianGeModel.getIns().exchangeNoticeArr.push(this.data.id)}}else{var e=a.TongTianGeModel.getIns().exchangeNoticeArr.indexOf(this.data.id);if(e!=-1){a.TongTianGeModel.getIns().exchangeNoticeArr.splice(e,1)}}}this.updateNoticeDot();a.TongTianGeModel.getIns().updateExchangeEntryDot()};e.prototype.updateNoticeDot=function(){var t=a.TongTianGeModel.getIns().isExchangeDot(this.data);if(t){game.RedDotView.addTo(this.duihuanbtn)}else{game.RedDotView.removeFrom(this.duihuanbtn)}};e.prototype.onClick=function(){if(game.SystemSetModel.getInstance().alertViewCheck(csv.FunctionsProxy.ENUMS.TONGTIANGE_EXCHANGE)){this.onTongtiangeExchangeReq()}else{var t=game.ItemUtil.parserList(this.data.consume)[0];game.Alert.show(app.getLang("ttg_tips14",game.STYLES.ITEM_QUALITY_S[t.getQuality()],t.getName(),t.count),new Laya.Handler(this,this.onTongtiangeExchangeReq),new Laya.Handler,0,"","","center","center",csv.FunctionsProxy.ENUMS.TONGTIANGE_EXCHANGE)}};e.prototype.onTongtiangeExchangeReq=function(){app.ProtocolRequest.TongtiangeExchangeReq(this.data.id,1)};e.prototype.setData=function(t){this.data=t;this.xiangoulab.text=app.getLang("限购"+t.value+"次");var e=game.ItemUtil.parserList(t.item)[0];this.daojugezi.setData(e);this.daojuname.color=game.STYLES.ITEM_QUALITY_S[e.getQuality()];this.daojuname.text=e.getName();this.huobi.parserIcon(t.consume,this.shuzhi,"",true);var i=a.TongTianGeModel.getIns().exchangeNoticeArr.indexOf(this.data.id);if(!this.tixing.selected&&i!=-1){this.tixing.selected=true}var n=a.TongTianGeModel.getIns().getExchangeData(this.data.id);if(n>=t.value){this.shouqinimg.visible=true;this.duihuanbtn.disabled=true}else{this.shouqinimg.visible=false;this.duihuanbtn.disabled=false}};return e}(ui.tongtiangeui.ttgduihuanitemUI);a.ExchangeItem=n;var t=function(i){__extends(t,i);function t(){var t=i!==null&&i.apply(this,arguments)||this;t.selectedFloor=1;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){i.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.liebiao.itemRender=n;this.liebiao.renderHandler=new Laya.Handler(this,this.onListRenderHandler);this.liebiao.selectEnable=true;this.liebiao.selectHandler=new Laya.Handler(this,this.onSelectedRenderHandler);this.liebiao.scrollRectOffX=10;this.liebiao.scrollRectOffY=10;for(var t=1;t<=a.TongTianGeModel.EXCHANGE_FLOOR_NUM;t++){this["ceng"+t].donghua.stop();this["ceng"+t].donghua.visible=false;this["ceng"+t].anniu.skin="res/static/tongtiange/btn_ttg_ceng_"+t+".png";this["ceng"+t].anniu.clickHandler=new Laya.Handler(this,this.onBtnClick,[t])}var e=csv.TtgRenwuProxy.getIns().getExchangeItemID();this.wuping.parserIconByItemId(e);this.wuping.on(Laya.Event.CLICK,this,this.onTipShow,[e])};t.prototype.onTipShow=function(t){var e=game.ItemUtil.createVO(t);if(e){tip.TipManager.show(e,true)}};t.prototype.onBtnClick=function(t){for(var e=1;e<=a.TongTianGeModel.EXCHANGE_FLOOR_NUM;e++){if(e==t){this["ceng"+e].xuanzhong.visible=true;this["ceng"+e].anniu.selected=true}else{this["ceng"+e].xuanzhong.visible=false;this["ceng"+e].anniu.selected=false}}this.selectedFloor=t;this.updateView()};t.prototype.onSelectedRenderHandler=function(t){if(this.selectedItem){this.selectedItem.onSelected(false)}var e=this.liebiao.getCell(t);if(e){e.onSelected(true);this.selectedItem=e}};t.prototype.onListRenderHandler=function(t){t.setData(t.dataSource)};t.prototype.onDisplay=function(){this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){for(var t=1;t<=a.TongTianGeModel.EXCHANGE_FLOOR_NUM;t++){this["ceng"+t].donghua.stop();this["ceng"+t].donghua.visible=false}};t.prototype.refreshAll=function(){var t=a.TongTianGeModel.getIns().getCanExchangeArr();var e=t.length>0?t[t.length-1]:1;for(var i=1;i<=a.TongTianGeModel.EXCHANGE_FLOOR_NUM;i++){var n=this["ceng"+i].donghua;if(n&&t.indexOf(i)!=-1){n.play(0,true);n.visible=true;this["ceng"+i].anniu.gray=false}else{n.stop();n.visible=false;this["ceng"+i].anniu.gray=true}}this.onBtnClick(e)};t.prototype.updateView=function(){this.shuliang.text=game.MoneyModel.format(game.GridsModel.getIns().getItemCount(csv.TtgRenwuProxy.getIns().getExchangeItemID()));if(a.TongTianGeModel.getIns().playerData){var t=csv.TtgRenwuProxy.getIns().getExchangeArray(a.TongTianGeModel.getIns().playerData.activityId,this.selectedFloor);this.liebiao.array=t;if(t.length>0){var e=game.ItemUtil.parserList(t[0].reward)[0];this.daojishilab.text=app.getLang("ttg_tips13",game.STYLES.ITEM_QUALITY_S[e.getQuality()],e.getName())}}else{this.liebiao.array=[]}};t.SINGLE_KEY="tongtiange.TongTianGeExchangeView";return t}(ui.tongtiangeui.tongtiangeview5UI);a.TongTianGeExchangeView=t})(tongtiange||(tongtiange={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tongtiange;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.touxiangimg.on(Laya.Event.CLICK,this,this.onClickHead);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){this.playerData=t;if(t){this.touxiangimg.skin=csv.MyTeamProxy.getIns().getTeamIcon(t.teamavatar);this.wanjianame.text=t.roleName;this.cengshu.text=app.getLang("{0}楼",t.floor);if(t.floorType==1){this.lou1.skin="res/static/tongtiange/bg_tongtiange2.png"}else{this.lou1.skin="res/static/tongtiange/bg_tongtiange1.png"}}else{this.touxiangimg.skin="";this.wanjianame.text=app.getLang("rank_empty");this.cengshu.text="";this.lou1.skin="res/static/tongtiange/bg_tongtiange1.png"}};e.prototype.onClickHead=function(){if(!this.playerData||Uint64.equal(this.playerData.roleId,game.Context.mainRoleId)){return}var t=friend.FriendModel.getCommonTypeArr(this.playerData.roleId);friend.FriendModel.getIns().setFriendMenu(t,this.playerData.roleId,this.playerData.roleName,this.playerData.teamLevel,this.playerData.classSkin,this.playerData.headframeId)};e.SINGLE_KEY="tongtiange.TongTianGeItem";return e}(ui.tongtiangeui.tongtianggitemUI);t.TongTianGeItem=e})(tongtiange||(tongtiange={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tongtiange;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.listdaoju.itemRender=grids.GridView;this.listdaoju.renderHandler=grids.GridView.CommonItemRender;this.model=i.TongTianGeModel.getIns();this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){};e.prototype.onUnDisplay=function(){};e.prototype.setData=function(t){this.cfg=t;this.labelpaiming.text=app.getLang("ttg_tips4",this.model.getRankLabel(t));var e=game.ItemUtil.parserList(t.reward);var i=e.length*(98+this.listdaoju.spaceX);this.listdaoju.x=this.width-i*this.listdaoju.scaleX-20;this.listdaoju.width=i;this.listdaoju.array=e};return e}(ui.tongtiangeui.ttgpaihangjiangliitemUI);i.TongtiangePaiHangItemView=t})(tongtiange||(tongtiange={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tongtiange;(function(i){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.curType=rank.RankModel.TYPE_ENUM.TONGTIAN_GE_PAIHANG;return t}t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.model=i.TongTianGeModel.getIns();this._rankmodel=rank.RankModel.getIns();this.listpaiming.itemRender=i.TongtiangePaiHangItemView;this.listpaiming.renderHandler=new Laya.Handler(this,this.renderHandler);this.listdaoju.itemRender=grids.GridView;this.listdaoju.renderHandler=grids.GridView.CommonItemRender};t.prototype.renderHandler=function(t,e){t.setData(t.dataSource)};t.prototype.onDisplay=function(){this.callLater(this.onCallterHandler)};t.prototype.onDataChange=function(){this.labeltishi.text=app.getLang("ttg_tips8");var t=rank.RankModel.getIns().getRankInfo(this.curType);var e=[];if(t.rank==0){this.labeljifenjianglicishu.text=app.getLang("ttg_tips7");this.labelcishunum.text="";this.listdaoju.array=e}else{this.labeljifenjianglicishu.text=app.getLang("ttg_tips5");this.labelcishunum.text=t.rank.toString();e=game.ItemUtil.parserList(this.model.getMyReward(t.rank));this.listdaoju.array=e}var i=e.length*(98+this.listdaoju.spaceX);this.listdaoju.x=this.width-i*this.listdaoju.scaleX-100;this.listdaoju.width=i;this.listpaiming.array=this.listpaiming.array=this.getList()};t.prototype.getList=function(){var t=[];var e=this.model.getActCfg();if(e){var i=csv.TtgRenwuProxy.getIns().ttg_paihangbangArr;for(var n=0;n<i.length;n++){var a=i[n];if(a.activityid==e.activityid){t.push(a)}}}return t};t.prototype.onCallterHandler=function(){app.ProtocolRequest.GetRankListReq(this.curType);this._rankmodel.on(rank.RankModel.RANK_DATA_CHANGE,this,this.onDataChange)};t.prototype.onUnDisplay=function(){this._rankmodel.off(rank.RankModel.RANK_DATA_CHANGE,this,this.onDataChange)};return t}(ui.tongtiangeui.ttgpaihangjiangliUI);i.TongTiangePaiHangJiangliView=t})(tongtiange||(tongtiange={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tongtiange;(function(i){var n=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.control=new rank.RankItemNewControl;this.control.setSkin(this)};return e}(ui.tongtiangeui.ttgpaihangbangitemUI);var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.rankControl=new rank.RankControl;this.rankControl.setSkin(this,n,rank.RankModel.TYPE_ENUM.TONGTIAN_GE_PAIHANG);this.jianglibtn.clickHandler=new Laya.Handler(this,this.onJiangliHandler)};e.prototype.onJiangliHandler=function(){app.ViewManager.toggleDialog(i.TongTiangePaiHangJiangliView,1,0)};return e}(ui.tongtiangeui.tongtiangeview4UI);i.TongTianGePaiHangView=t})(tongtiange||(tongtiange={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tongtiange;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){var e=t.split("-");var i=game.ItemUtil.createVO(parseInt(e[0]));i.setCount(parseInt(e[1]));this.daojuegezi.setData(i);this.daojuname.text=i.getName();this.shuzhi.text=parseInt(e[2])*.01+"%"};return e}(ui.tongtiangeui.ttgjiangliyulanitemUI);t.TongTianGeRewardPreItem=e})(tongtiange||(tongtiange={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tongtiange;(function(o){var s=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.clsKey="ui.tongtiangeui.ttgjiangliyulanitem2UI";return t}t.prototype.createNode=function(t){var e=Laya.Pool.getItemByClass(this.clsKey,ui.tongtiangeui.ttgjiangliyulanitem2UI);e.x=t*e.width;e.y=this.y;e.zi.text=this.list[t];return e};return t}(list.RowMoveBaseNode);var r=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.clsKey="tongtiange.TongTianGeRewardPreItem";return t}t.prototype.createNode=function(t){var e=Laya.Pool.getItemByClass(this.clsKey,o.TongTianGeRewardPreItem);e.x=t*e.width;e.y=this.y;e.setData(this.list[t]);return e};return t}(list.RowMoveBaseNode);var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.listCustom=new list.JListCustom;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};t.prototype.onDisplay=function(){this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){this.listCustom.clear()};t.prototype.refreshAll=function(){var t=o.TongTianGeModel.getIns().getOpenActid();if(t==0){return}var e=csv.TtgjianzaojiangliProxy.getIns().getRewardshow(1,t);var i=csv.TtgjianzaojiangliProxy.getIns().getRewardshow(2,t);this.listCustom.init(this.jiemian);this.listCustom.clear();var n=[app.getLang("ttg_tips9")];this.listCustom.split(n,s,46);this.listCustom.split(i.split(";"),r,170,0,3);var a=[app.getLang("ttg_tips10")];this.listCustom.split(a,s,46);this.listCustom.split(e.split(";"),r,170,0,3);this.listCustom.end()};t.SINGLE_KEY="tongtiange.TongTianGeRewardPreView";return t}(ui.tongtiangeui.ttgjiangliyulanUI);o.TongTianGeRewardPreView=t})(tongtiange||(tongtiange={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tongtiange;(function(t){var l;(function(t){t[t["GoldBuy"]=1]="GoldBuy";t[t["ChongZhi"]=2]="ChongZhi"})(l=t.ShopType||(t.ShopType={}));var i=function(){function t(){}t.prototype.parseTaren=function(t){var e=t.split(";");this.showicon=e[0];this.res=e[1];this.subscript=e[2]};t.prototype.parseRecharge=function(t){this.showicon=t.showicon;this.res=t.res;this.subscript=t.subscript};return t}();t.ParseIcon=i;var e=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.iconT=new i;return t}t.prototype.initialize=function(){e.prototype.initialize.call(this);this.gezilist.itemRender=grids.GridView;this.gezilist.renderHandler=new Laya.Handler(this,this.onItemRender);this.newscModel=newshangcheng.NewShangChengModel.getIns();this.imgxuanzhong.removeSelf();this.on(Laya.Event.CLICK,this,this.onClickHandler)};t.prototype.onWidthChange=function(){this.refreshmoney(this.shuzhi1,this.yuanbox,this.yuan)};t.prototype.onWidthChange3=function(){this.refreshmoney(this.shuzhi3,this.yuanbaobox,this.yuanbaoimg)};t.prototype.refreshmoney=function(t,e,i){t.x=(this.yuanbox.width-t.width-i.width)/2;i.x=t.x+t.width+10};t.prototype.clear=function(){this.daoju.skin="";game.RedDotView.removeFrom(this);this.shouqinimg.visible=false;this.shuzhi2.visible=false;this.yuanbaobox.visible=false;this.yuanbox.visible=false;this.jiyuanbox.visible=false};t.prototype.setData=function(t,e){this.cfg=t;var i=e.getSubInfo(t.id);if(i){this.info=i;this.actVo=e;this.clear();var n=void 0;var a=this.cutType;var o=0;var s=void 0;if(a==l.GoldBuy){this.iconT.parseTaren(t.p6);n=t.p5;o=this.cfg.p1;if(o==0){this.jiyuanbox.visible=true}else{this.yuanbaobox.visible=true;this.shuzhi3.value=o.toString();this.shuzhi3.on(Laya.Event.RESIZE,this,this.onWidthChange3);s=t.p4}if(i.num>0){game.RedDotView.addTo(this,this.width-20,20)}}else{var r=csv.RechargeProxy.getIns().cfgMap[parseInt(t.p1)];if(r){s=r.limit;this.iconT.parseRecharge(r);o=r.recharge;n=r.reward;if(o==0){this.jiyuanbox.visible=true}else{this.yuanbox.visible=true;this.shuzhi1.value=app.convert_Yuan(o).toString();this.shuzhi1.on(Laya.Event.RESIZE,this,this.onWidthChange)}}else{console.error("recharge id "+t.p1+" 未找到")}}if(this.newscModel.isSellout(this.actVo,t.id)){this.shouqinimg.visible=true}else{if(o==0){game.RedDotView.addTo(this)}}if(this.iconT.showicon!=""){this.imgdaoju.skin=csv.ItemProxy.getUrl(this.iconT.showicon)}this.daoju.skin=this.iconT.res;this.imgjiaobiao.skin=this.iconT.subscript;this.xiangoulab.text=app.getLang("xinshangcheng_01",i.num,s);if(n){this.newscModel.setListVaule(this.gezilist,n)}}};Object.defineProperty(t.prototype,"cutType",{get:function(){return this.cfg.p3},enumerable:true,configurable:true});t.prototype.onItemRender=function(t){t.locktip=true;t.setData(t.dataSource);t.setCntScale(this.gezilist.scaleX)};t.prototype.onClickHandler=function(){var t=this.cutType;if(t==l.ChongZhi){this.newscModel.onLiBaoAction(this.actVo,this.cfg)}else if(t==l.GoldBuy){var e=this.actVo.getSubInfo(this.cfg.id);if(e.status==activitytaren.ActivityTaRenLingQuStatus.IS_ALREADY_LING_QU){return}var i=this.cfg.p1;if(game.MoneyModel.getIns().getMoney(game.MoneyModel.MONEY_ENUM.GOLD)<i){shop.ShopModel.getIns().askChongZhi()}else{game.Alert.show(app.getLang("ttg_tips12",i),new Laya.Handler(this,this.onOkHandler))}}};t.prototype.onOkHandler=function(){app.ProtocolRequest.RecvActPrizeReq(this.cfg.id,1)};return t}(ui.tongtiangeui.ttgxianshilibaoitemUI);t.TongtianGeShopItemView=e})(tongtiange||(tongtiange={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tongtiange;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.newscModel=newshangcheng.NewShangChengModel.getIns();this.tarenModel=activitytaren.ActivityTaRenModel.getIns();this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.liebiao.itemRender=i.TongtianGeShopItemView;this.liebiao.renderHandler=new Laya.Handler(this,this.onRenderHander);this.timec=new activitytaren.ActivityTimeView(this.daojishilab,new Laya.Handler(this,this.endHandler),app.getLang("huodong_text05"))};e.prototype.endHandler=function(){this.daojishilab.text=""};e.prototype.onRenderHander=function(t,e){t.setData(t.dataSource,this.actVo)};e.prototype.onDisplay=function(){this.tarenModel.on(activitytaren.ActivityTaRenModel.ACTIVIT_TAREN_EVENT.GET_MAIN_PANEL_INFO,this,this.onGetMainPanel);this.tarenModel.on(activitytaren.ActivityTaRenModel.ACTIVIT_TAREN_EVENT.UPDATE_ACTIVIT_DATA,this,this.onGetMainPanel);game.RoleModel.getIns().on(game.RoleModel.EVENTS.KUAI_TIAN,this,this.onKuaTianEvt);this.callLater(this.onCallLater)};e.prototype.onKuaTianEvt=function(){activitytaren.ActivityTaRenModel.getIns().getInfoByActID(this.actVo.actid,new Laya.Handler(this,this.onGetMainPanel))};e.prototype.onGetMainPanel=function(){this.onCallLater()};e.prototype.onCallLater=function(){this.timec.start(this.actVo.timeVo.endTime);var t=this.actVo.curCfg;this.shangditu.skin=t.cp1;this.liebiao.array=this.newscModel.sortList(this.actVo)};e.prototype.onUnDisplay=function(){this.tarenModel.off(activitytaren.ActivityTaRenModel.ACTIVIT_TAREN_EVENT.GET_MAIN_PANEL_INFO,this,this.onGetMainPanel);this.tarenModel.off(activitytaren.ActivityTaRenModel.ACTIVIT_TAREN_EVENT.UPDATE_ACTIVIT_DATA,this,this.onGetMainPanel);game.RoleModel.getIns().off(game.RoleModel.EVENTS.KUAI_TIAN,this,this.onKuaTianEvt);this.timec.stop()};e.SINGLE_KEY="tongtiange.TongtianGeShopView";return e}(ui.tongtiangeui.tongtiangeview3UI);i.TongtianGeShopView=t})(tongtiange||(tongtiange={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tongtiange;(function(m){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);game.HelperViewHandler.registerStr([this.wenhaobtn],"ttg_tips1","ttg_tips2");this.yundi.visible=true;this.weizhi.vScrollBarSkin="";this.weizhi.vScrollBar.isVertical=true;this.yundi.vScrollBarSkin="";this.yundi.vScrollBar.isVertical=true;this.curFloorNum=0;this.tiaozhuanlab.text=app.getLang("ttg_tips11");this.daojubox.on(Laya.Event.CLICK,this,this.onClickItemHandler);this.tiaozhuanlab.on(Laya.Event.LINK,this,this.onLinkHandler);this.daoju.clickHandler=new Laya.Handler(this,this.onClickReward);this.jzbtn3.clickHandler=new Laya.Handler(this,this.onClickBuildBtn,[1]);this.jzbtn2.clickHandler=new Laya.Handler(this,this.onClickBuildBtn,[5]);this.yulanbtn.clickHandler=new Laya.Handler(this,this.onClickPreBtn);this.ani1.on(Laya.Event.COMPLETE,this,this.aniEnd);this.activityTimeView=new activitytaren.ActivityTimeView(this.daojishi,new Laya.Handler(this,this.endTimeCallBack),"miaosha_time_1");this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){m.TongTianGeModel.getIns().on(m.TongTianGeModel.EVENTS.UPDATE_DATA,this,this.onUpdateData);this.yun.y=0;this.yun2.y=0;this.yun2.alpha=0;this.yundi.vScrollBar.value=0;this.isInit=true;app.ProtocolRequest.TongtiangeDataReq()};e.prototype.onUnDisplay=function(){m.TongTianGeModel.getIns().off(m.TongTianGeModel.EVENTS.UPDATE_DATA,this,this.onUpdateData);Laya.Tween.clearAll(this)};e.prototype.onUpdateData=function(){this.refreshAll();this.playBuildAni()};e.prototype.refreshAll=function(){var t=m.TongTianGeModel.getIns().serverData;var e=m.TongTianGeModel.getIns().playerData;var i=this.getCostItem();if(i){this.wuping.skin=i.getIconUrl();this.wuping.width=37;this.wuping.height=32;this.shuliang.text=game.GridsModel.getIns().getItemCount(i.getItemId())+""}this.activityTimeView.start(this.actVo.timeVo.endTime);var n=t?t.totalBuild:0;var a=csv.TtgRenwuProxy.getIns().nextFloor(m.TongTianGeModel.TYPES.SERVER_TYPE,n);if(a==-1){this.cengshulab.text=app.getLang("ttg_text8")}else{var o=a-n;this.cengshulab.text=app.getLang("ttg_text1",o)}var s=m.TongTianGeModel.getIns().getActCfg();var r=s.p6.split("-");var l=guaji.GuajiModel.getIns().getGujiPassId();var h=game.ItemUtil.createVO(parseInt(r[1]));var p=e?e.recvXy:0;var u=Math.floor((l-p)/parseInt(r[0]))*parseInt(r[2]);h.setCount(u);this.daoju.setData(h);var c=parseInt(s.p6.split("-")[0]);var g=e?e.recvXy+c:c;this.shuliang1.text=l+"/"+g;if(u>0){game.RedDotView.addTo(this.daoju)}else{game.RedDotView.removeFrom(this.daoju)}var f=e?e.goldBuild:0;var d=parseInt(s.p4)-f;var y=m.TongTianGeModel.getIns().getSurpFreeNum();this.cishuclip.value=d+"";this.cishunum.text=y+"/"+s.p2;var v=game.ItemUtil.parserList(s.p3)[0];var _=game.GridsModel.getIns().getItemCount(v.getItemId());if(y>0||_<5){this.jzbtn3.visible=true;this.jzbtn2.visible=false;this.jzbtn3.x=287;this.jzbtn3.label=app.getLang("建造{0}次",1)}else{this.jzbtn3.visible=true;this.jzbtn2.visible=true;this.jzbtn3.x=125;this.jzbtn3.label=app.getLang("建造{0}次",1);this.jzbtn2.label=app.getLang("建造{0}次",5)}game.RedDotView.removeFrom(this.jzbtn2);game.RedDotView.removeFrom(this.jzbtn3);if(y>0){game.RedDotView.addTo(this.jzbtn3)}else{if(_>0&&_<5){game.RedDotView.addTo(this.jzbtn3)}else if(_>=5){game.RedDotView.addTo(this.jzbtn2)}else{}}this.updateFloorView()};e.prototype.updateFloorView=function(){while(this.weizhi.numChildren){this.weizhi.removeChildAt(0)}var t=m.TongTianGeModel.getIns().serverData;var e=[];if(t&&t.buildData&&t.buildData.length){e=t.buildData;if(this.curFloorNum==0){this.curFloorNum=t.totalBuild}if(e.length==1){e.push(null)}}else{e=[null,null]}for(var i=0;i<e.length;i++){var n=new m.TongTianGeItem;n.setData(e[i]);this.weizhi.addChild(n);n.y=(e.length-1-i)*n.height;if(i==e.length-1&&e[i]){this.maxFloorView=n}}};e.prototype.playBuildAni=function(){var t=m.TongTianGeModel.getIns().serverData;var e=t?t.totalBuild:0;var i=e-this.curFloorNum;if(t&&t.buildData.length>0&&this.isInit==false){if(this.maxFloorView){this.maxFloorView.visible=false}this.dongxiao.setData(this.maxFloorView.playerData);if(t.buildData.length==1){this.ani1.play(0,false)}else{var n=this.maxFloorView?i*this.maxFloorView.height:0;this.weizhi.vScrollBar.value=n;Laya.Tween.to(this.weizhi.vScrollBar,{value:0},500);Laya.timer.once(100,this,this.onTimeEnd)}}this.curFloorNum=t?t.totalBuild:0;this.isInit=false};e.prototype.onTimeEnd=function(){this.ani1.play(0,false);Laya.timer.once(600,this,function(){this.yanqi.play(0,false)})};e.prototype.aniEnd=function(){this.maxFloorView.visible=true;this.ani1.gotoAndStop(0)};e.prototype.onClickItemHandler=function(){var t=this.getCostItem();if(t){tip.TipManager.show(t,true,true)}};e.prototype.endTimeCallBack=function(){this.activityTimeView.stop();this.daojishi.text="";Laya.Dialog.manager.closeAll()};e.prototype.onClickReward=function(){if(this.daoju.data.count>0){var t=m.TongTianGeModel.getIns().playerData?m.TongTianGeModel.getIns().playerData.activityId:this.actVo.actid;app.ProtocolRequest.TongtiangeAwardReq(0,t)}else{tip.TipManager.show(this.daoju.data,true,true)}};e.prototype.onLinkHandler=function(t){Laya.Dialog.closeAll();if(csv.FunctionsProxy.getIns().isOpen(csv.FunctionsProxy.ENUMS.PASS,true)){guaji.GuajiModel.getIns().changeMap()}};e.prototype.onClickBuildBtn=function(t){var e=this.actVo.timeVo.endTime-game.Context.getServerTime();if(e<=0){manager.FlowManager.instance.flowByStyle1(app.getLang("gourddefend_tips36"));return}var i=m.TongTianGeModel.getIns().playerData;var n=m.TongTianGeModel.getIns().getSurpFreeNum();var a=i?i.activityId:m.TongTianGeModel.getIns().getOpenActid();if(n>0){app.ProtocolRequest.TongtiangeBuildReq(a,t)}else{var o=m.TongTianGeModel.getIns().getActCfg();var s=o.p3.split("-");var r=parseInt(s[1])*t;var l=s[0]+"-"+r;if(!game.GridsModel.getIns().hasEnoughItems(l,false,true)){return}app.ProtocolRequest.TongtiangeBuildReq(a,t)}};e.prototype.setBtnCD=function(){this.jzbtn2.mouseEnabled=this.jzbtn3.mouseEnabled=false;Laya.timer.once(1500,this,function(){this.jzbtn2.mouseEnabled=this.jzbtn3.mouseEnabled=true})};e.prototype.onClickPreBtn=function(){app.ViewManager.toggleDialog(m.TongTianGeRewardPreView,1,0)};e.prototype.getCostItem=function(){var t=m.TongTianGeModel.getIns().getActCfg();if(t){var e=game.ItemUtil.parserList(t.p3)[0];return e}return null};e.SINGLE_KEY="tongtiange.TongTianGeView";return e}(ui.tongtiangeui.tongtiangeview1UI);m.TongTianGeView=t})(tongtiange||(tongtiange={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var touzilic;(function(n){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){if(newshangcheng.NewShangChengModel.getIns().cztcStyle==1){var t=csv.FunctionsProxy.ENUMS.TOUZI_LICAI;game.WindowsResigter.registFunctionOpenCheck(t,new Laya.Handler(this,this.openCheck,[t]));game.RoleModel.getIns().on(game.RoleModel.EVENTS.KUAI_TIAN,this,this.onKuaTianEvt);game.RoleModel.getIns().on(game.RoleModel.EVENTS.LEVEL_CHANGE,this,this.onLevelChange);game.RoleModel.getIns().on(game.RoleModel.EVENTS.TEAM_LEVEL_CHANGE,this,this.onLevelChange)}};e.prototype.onKuaTianEvt=function(){n.TouZiLiCaiModel.getIns().redRefresh()};e.prototype.onLevelChange=function(){n.TouZiLiCaiModel.getIns().redRefresh()};e.prototype.openCheck=function(t){var e=n.TouZiLiCaiModel.getIns().isFinish();if(e){manager.FlowManager.instance.flowByStyle1(app.getLang("huodong_text06"));return false}else{game.ClosureManager.callFunction(t,true,true);return true}};e.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.TouziNtf,this,this.onTouziNtfHandler);this.addMsgListener(app.ProtocolResponse.DayAwardTouziAck,this,this.onDayAwardTouziAckHandler);this.addMsgListener(app.ProtocolResponse.AwardTouziAck,this,this.onAwardTouziAckHandler)};e.prototype.onTouziNtfHandler=function(t,e){n.TouZiLiCaiModel.getIns().info=e;n.TouZiLiCaiModel.getIns().event(n.TouZiLiCaiModel.EVENT_INFO_REFRESH);n.TouZiLiCaiModel.getIns().redRefresh()};e.prototype.onDayAwardTouziAckHandler=function(t,e){if(e.result){var i=n.TouZiLiCaiModel.getIns().info;if(i){if(!i.dayaward){i.dayaward=[]}if(i.dayaward.indexOf(e.tid)==-1){i.dayaward.push(e.tid)}}n.TouZiLiCaiModel.getIns().info.tzgettime=e.tzgettime;if(ent.DebugConfig.isDebugger){}n.TouZiLiCaiModel.getIns().event(n.TouZiLiCaiModel.EVENT_TOUZI_LINGQU_CALLBACK);n.TouZiLiCaiModel.getIns().event(n.TouZiLiCaiModel.EVENT_INFO_REFRESH);n.TouZiLiCaiModel.getIns().redRefresh()}else{}};e.prototype.onAwardTouziAckHandler=function(t,e){if(e.result){var i=n.TouZiLiCaiModel.getIns().info;if(i){if(!i.award){i.award=[]}if(i.award.indexOf(e.tid)==-1){i.award.push(e.tid)}}n.TouZiLiCaiModel.getIns().info.ltgettime=e.ltgettime;if(ent.DebugConfig.isDebugger){}chengzhanjijing.ChengZhanJiJingModel.getIns().event(chengzhanjijing.ChengZhanJiJingModel.EVENT_LING_QU_SUCCEED);n.TouZiLiCaiModel.getIns().event(n.TouZiLiCaiModel.EVENT_INFO_REFRESH);n.TouZiLiCaiModel.getIns().redRefresh()}else{console.warn("###########################成长基金领取失败!")}};e.SINGLE_KEY="touzilic.TouZiLiCaiModule";return e}(app.ModuleBase);n.TouZiLiCaiModule=t})(touzilic||(touzilic={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("investment.csv");this.array=t.getArray();this.map=t.getMap("id")};e.prototype.getAllCfgid=function(t){var e=[];for(var i=0;i<this.array.length;i++){var n=this.array[i];if(n.cfgid==t){e.push(n)}}return e};e.SINGLE_KEY="csv.TouZiLiCaiProxy";return e}(app.ModelBase);t.TouZiLiCaiProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var touzilic;(function(n){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.quedingbtn.clickHandler=new Laya.Handler(this,this.onOkHandler);this.closebtn.clickHandler=new Laya.Handler(this,this.onCancelHandler);this.quxiaobtn.clickHandler=new Laya.Handler(this,this.onCancelHandler)};e.prototype.onCancelHandler=function(){app.ViewManager.toggleDialog(e,-1,0)};e.prototype.onOkHandler=function(){var t=game.GridsModel.getIns().getItemCount(game.ItemUtil.ENUMS.YUANBAO);if(t<this.money){shop.ShopModel.getIns().askChongZhi(true);return}this.onCancelHandler()};Object.defineProperty(e.prototype,"money",{get:function(){return n.TouZiLiCaiModel.getIns().moneyValue},enumerable:true,configurable:true});e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.refreshAll=function(){var t=this.money;var e=csv.TouZiLiCaiProxy.getIns().array.length;var i=n.TouZiLiCaiModel.getIns().percent/100*t;i=Math.floor(i);this.label.text=app.getLang("touzilc_text2",t,e,i);this.quedingbtn.label=app.getLang("touzilc_text8",t)};e.prototype.onUnDisplay=function(){};return e}(ui.alert.touzialertUI);n.Touzialert=t})(touzilic||(touzilic={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var touzilic;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.imgbuqian.removeSelf()};e.prototype.onDisplay=function(){};e.prototype.onUnDisplay=function(){this.redpoint=false;this.effect=false};Object.defineProperty(e.prototype,"status",{get:function(){return i.TouZiLiCaiModel.getIns().getLingQuStatus(this.cfg)},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"redpoint",{set:function(t){this.imgxuanzhong.visible=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"effect",{set:function(t){this.imgyilingqu.visible=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"model",{get:function(){return i.TouZiLiCaiModel.getIns()},enumerable:true,configurable:true});e.prototype.setData=function(){this.cfg=this.dataSource;this.clipnum.value=util.convertToChinaNum(this.cfg.id);this.itemdaoju.setData(game.ItemUtil.parserList(this.cfg.reward)[0]);this.imgyilingqu.visible=false;var t=this.status;switch(t){case i.ETouZi_STATUS.CanLinQu:this.redpoint=true;this.effect=true;break;case i.ETouZi_STATUS.AlreadyTouziCantLingQu:if(this.model.getDay()>=this.cfg.id){this.effect=true;this.redpoint=true}else{this.redpoint=false;this.effect=false}break;case i.ETouZi_STATUS.IsAlreadyLingQu:this.redpoint=false;this.effect=false;this.imgyilingqu.visible=true;break}};e.prototype.onClickHandler=function(){switch(this.status){case i.ETouZi_STATUS.AlreadyTouziCantLingQu:break;case i.ETouZi_STATUS.CanLinQu:i.TouZiLiCaiModel.getIns().lingQu(this.cfg,new Laya.Handler(this,this.onUpdateHandler));break}};e.prototype.onUpdateHandler=function(){this.setData()};return e}(ui.xinshangcheng2.touzilicaiitem2UI);i.TouZiLiCaiItemView=t})(touzilic||(touzilic={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var touzilic;(function(p){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.model=newshangcheng.NewShangChengModel.getIns();this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listtouzilicai=this.listbaoxiang;this.listtouzilicai.itemRender=p.TouZiLiCaiItemView;this.listtouzilicai.renderHandler=new Laya.Handler(this,this.onRenderHandle);this.listtouzilicai.vScrollBarSkin=" ";this.btngoumai=this.btnlingqu;this.btngoumai.label=app.getLang("touzilc_text6")};e.prototype.onLiJiClickHandler=function(){var t=csv.RechargeProxy.getIns().getCfgByType(csv.IRechargeType.TouZiLiCai);if(t){shop.ShopModel.getIns().chongzhi(t.id)}};e.prototype.onLinQuClickHandler=function(){app.ProtocolRequest.DayAwardTouziReq(0)};e.prototype.onLingQuSucceed=function(){};e.prototype.onRenderHandle=function(t,e){t.setData()};e.prototype.onDisplay=function(){p.TouZiLiCaiModel.getIns().on(p.TouZiLiCaiModel.EVENT_TOUZI_LINGQU_CALLBACK,this,this.onUpdateHandler);p.TouZiLiCaiModel.getIns().on(p.TouZiLiCaiModel.EVENT_INFO_REFRESH,this,this.onRefreshHandler);game.RoleModel.getIns().on(game.RoleModel.EVENTS.KUAI_TIAN,this,this.onKuaTianEvt);this.callLater(this.onInit)};e.prototype.onKuaTianEvt=function(){this.callLater(this.onInit)};e.prototype.onUpdateHandler=function(){this.refreshAll()};e.prototype.onRefreshHandler=function(){this.refreshAll()};e.prototype.onInit=function(){if(!csv.FunctionsProxy.getIns().isOpen(csv.FunctionsProxy.ENUMS.TOUZI_LICAI)){this.model.updateView();return}this.refreshAll()};e.prototype.onUnDisplay=function(){p.TouZiLiCaiModel.getIns().off(p.TouZiLiCaiModel.EVENT_INFO_REFRESH,this,this.onRefreshHandler);p.TouZiLiCaiModel.getIns().off(p.TouZiLiCaiModel.EVENT_TOUZI_LINGQU_CALLBACK,this,this.onUpdateHandler);game.RoleModel.getIns().off(game.RoleModel.EVENTS.KUAI_TIAN,this,this.onKuaTianEvt)};e.prototype.sortHandler=function(t){var e=[];var i=[];var n=0;for(n=0;n<t.length;n++){var a=t[n];var o=p.TouZiLiCaiModel.getIns().getLingQuStatus(a);if(o==p.ETouZi_STATUS.CanLinQu){i.push(a)}}var s=[];for(n=0;n<t.length;n++){var a=t[n];var r=p.TouZiLiCaiModel.getIns().getLingQuStatus(a);if(r==p.ETouZi_STATUS.AlreadyTouziCantLingQu){s.push(a)}}var l=[];for(n=0;n<t.length;n++){var a=t[n];var h=p.TouZiLiCaiModel.getIns().getLingQuStatus(a);if(h==p.ETouZi_STATUS.IsAlreadyLingQu){l.push(a)}}e=e.concat(i);e=e.concat(s);e=e.concat(l);return e};e.prototype.refreshAll=function(){this.listtouzilicai.array=csv.TouZiLiCaiProxy.getIns().array;game.RedDotView.removeFrom(this.btngoumai);if(p.TouZiLiCaiModel.getIns().isBuyed){if(p.TouZiLiCaiModel.getIns().isCanLingQu()){this.btngoumai.visible=true;this.btngoumai.mouseEnabled=true;this.btngoumai.gray=false;this.btngoumai.label=app.getLang("touzilc_text4");this.btngoumai.clickHandler=new Laya.Handler(this,this.onLinQuClickHandler);game.RedDotView.addTo(this.btngoumai)}else{this.btngoumai.visible=true;this.btngoumai.mouseEnabled=false;this.btngoumai.gray=true;this.btngoumai.label=app.getLang("meirithui03");this.btngoumai.clickHandler=null}}else{this.btngoumai.clickHandler=new Laya.Handler(this,this.onLiJiClickHandler);this.btngoumai.visible=true;this.btngoumai.mouseEnabled=true;this.btngoumai.gray=false;var t=0;if(this.rechargeCfg){t=app.convert_Yuan(this.rechargeCfg.recharge)}this.btngoumai.label=app.getLang("touzilc_text10",t)}this.labelmoney04.text=csv.RechargeProxy.getIns().getCfgByType(csv.IRechargeType.TouZiLiCai).reward.split("-")[1];this.labelmoney02.text=game.Config.getParams(1182);huodong.HuoDongShangChengModel.getIns().event(huodong.HuoDongEvent.EVENT_RED_CHECK)};Object.defineProperty(e.prototype,"rechargeCfg",{get:function(){var t=csv.RechargeProxy.getIns().getCfgListByType(csv.IRechargeType.TouZiLiCai);if(t.length>0){return t[t.length-1]}},enumerable:true,configurable:true});e.prototype.hideSubTime=function(){};return e}(ui.xinshangcheng2.touzilicai2UI);p.TouZiLiCaiView=t})(touzilic||(touzilic={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tower;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){app.ViewManager.regist(i.TowerMonsterView,"jiuchongyaota.atlas");app.ViewManager.regist(i.TowerBossMapView,"jiuchongyaota.atlas");app.ViewManager.regist(i.BossDetailedInfoView,"jiuchongyaota.atlas");app.ViewManager.regist(i.NineTowerBattleTitle,"jiuchongyaota.atlas");app.ViewManager.regist(i.AmuletView,"jiuchongyaota.atlas");game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.TOWER_MONSTER,i.TowerMonsterView)};e.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.DgnNineTowerNtf,this,this.onDgnNineTowerNtf);this.addMsgListener(app.ProtocolResponse.DgnNineTowerAck,this,this.onDgnNineTowerAck);this.addMsgListener(app.ProtocolResponse.AwardNineTowerAck,this,this.onAwardNineTowerAck);this.addMsgListener(app.ProtocolResponse.SweepNineTowerAck,this,this.onSweepNineTowerAck);this.addMsgListener(app.ProtocolResponse.NineTowerBuyAck,this,this.onNineTowerBuyAck)};e.prototype.onDgnNineTowerNtf=function(t,e){i.TowerMonsterModel.getIns().onDgnNineTowerNtf(e.record,e.layeraward)};e.prototype.onSweepNineTowerAck=function(t,e){if(e.result){i.TowerMonsterView.getIns().checkTime()}};e.prototype.onAwardNineTowerAck=function(t,e){if(e.result){i.TowerMonsterModel.getIns().event(i.TowerMonsterModel.TOWER_NINE_AWARD_SUCCESS)}};e.prototype.onDgnNineTowerAck=function(t,e){if(e.result){}};e.prototype.onNineTowerBuyAck=function(t,e){if(e.result){app.ViewManager.toggleView(i.AmuletView,app.AppContainer.uiLayer,-1);game.Context.event(i.TowerMonsterModel.NINE_BUFF_BUY_Ack,[e.spellid])}};e.SINGLE_KEY="tower.TowerMonsterModule";return e}(app.ModuleBase);i.TowerMonsterModule=t})(tower||(tower={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tower;(function(g){var t=function(t){__extends(i,t);function i(){return t!==null&&t.apply(this,arguments)||this}i.getIns=function(){return app.Singleton.getInstance(i)};i.prototype.init=function(){};i.prototype.onDgnNineTowerNtf=function(t,e){this.record=t;this.layeraward=e;this.event(i.TOWER_NINE_NTF)};i.prototype.checkPerfect=function(){if(!this.record||this.record.length==0){return false}var t=true;var e=this.record[this.record.length-1];if(e.stage==9&&e.order==10){for(var i=0,n=this.record;i<n.length;i++){var a=n[i];var o=this.pareseStars(a?a.stars:0);if(o<3){t=false;break}}}else{t=false}return t};i.prototype.getTowerInfo=function(t,e){var i;if(t>0){for(var n in this.record){if(this.record[n].stage==t&&this.record[n].order==e){i=this.record[n];break}}}return i};i.prototype.autoFindStage=function(){if(!this.record||this.record.length==0){return 1}var t=this.record[this.record.length-1];if(t.order<10){return t.stage}var e=t.stage+1;return e>9?9:e};i.prototype.getStarsByStage=function(t){var e=0;for(var i in this.record){if(this.record[i].stage==t){e+=this.pareseStars(this.record[i]?this.record[i].stars:0)}}return e};i.prototype.pareseStars=function(t){var e=0;for(var i=0;i<3;i++){if(t>>i&1){e++}}return e};i.prototype.getOrderByStage=function(t){var e=0;for(var i in this.record){if(this.record[i].stage==t){if(this.record[i].order>e){e=this.record[i].order}}}return e};i.prototype.onSweepNineTowerReq=function(){dailytask.DailyTimeUtil.buyTime(csv.DailyTimeProxy.ENUM_TYPE.NINE_TOWER)};i.prototype.onAwardNineTowerReq=function(t,e){if(!this.isGetted(t,e)){app.ProtocolRequest.AwardNineTowerReq(t,e/10)}};i.prototype.isGetted=function(t,e){var i=0;for(var n in this.layeraward){if(this.layeraward[n].stage==t){i=this.layeraward[n].starsaward;break}}var a=false;if(i>0){var o=i>>0&1;var s=i>>1&1;var r=i>>2&1;if(o&&e==10){a=true}else if(s&&e==20){a=true}else if(r&&e==30){a=true}}return a};i.prototype.canBattle=function(t,e,i){var n=false;var a=csv.TowerMonsterProxy.getIns().getBossByType(t,e-1);if(game.Context.isRoleReach(i,a.open)){var o=void 0,s=void 0,r=void 0;if(e==1){s=t-1;r=10;o=this.getTowerInfo(s,r)}else{s=t;r=e-1;o=this.getTowerInfo(s,r)}if(o||t==1&&e==1){var l=this.getStarsByStage(t);if(l>=a.starlimit){n=true}else{if(i){manager.FlowManager.instance.flowByStyle1(app.getLang("{0}星开启",a.starlimit))}}}else{if(i){g.TowerBossMapView.getIns().onAlert()}}}return n};i.prototype.onDgnNineTowerReq=function(t,e){if(this.canBattle(t,e,true)){app.ProtocolRequest.DgnNineTowerReq(t,e)}};i.prototype.canFreeScouring=function(){var t=0;if(this.record&&this.record.length>0){var e=boss.BossModel.getIns().getDailyTime(csv.DailyTimeProxy.ENUM_TYPE.NINE_TOWER);var i=e.fnum+e.gnum;if(e&&i>0){t=1}else{t=-1}}return t};i.prototype.getAwards=function(){var t=g.TowerMonsterModel.getIns().record;var e;var i;var n=[];for(var a=0,o=t;a<o.length;a++){var s=o[a];if(s.stars>>2&1){var r=csv.TowerMonsterProxy.getIns().getBossByType(s.stage,s.order-1).threestaraward;i=game.ItemUtil.parserList(r);e=[];var l=false;for(var h=0;h<i.length;h++){if(n.length>0){for(var p=0,u=n;p<u.length;p++){var c=u[p];if(c.getItemId()==i[h].getItemId()){c.setCount(c.count+i[h].count);l=true;break}}if(!l){e.push(i[h])}}else{e.push(i[h])}}if(e.length>0){n=n.concat(e)}}}return n};i.SINGLE_KEY="tower.TowerMonsterModel";i.TOWER_NINE_NTF="TOWER_NINE_NTF";i.NINE_BUFF_BUY_Ack="NINE_BUFF_BUY_Ack";i.TOWER_NINE_AWARD_SUCCESS="TOWER_NINE_AWARD_SUCCESS";return i}(app.ModelBase);g.TowerMonsterModel=t})(tower||(tower={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("challengearea.csv");this.cfgMap=t.getMap("id");this.layers=t.getArray();var e=app.Config.getResById("challengeboss.csv");this.cfgBossType=e.getMapList("area");var i=app.Config.getResById("challengespell.csv");this.cfgSpellMap=i.getMap("id")};e.prototype.getCfg=function(t){return this.cfgMap[t]};e.prototype.getTotalOrder=function(t){return this.cfgBossType[t].length};e.prototype.getBossByType=function(t,e){return this.cfgBossType[t]?this.cfgBossType[t][e]:null};e.prototype.getSpellCfg=function(t){return this.cfgSpellMap[t]};e.SINGLE_KEY="csv.TowerMonsterProxy";return e}(app.ModelBase);t.TowerMonsterProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tower;(function(t){var e=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t._startY=0;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.x=(Laya.stage.width-this.width)/2;this.y=(Laya.stage.height-this.height)/2;this.alpha=0;this._startY=this.y;this.text.wordWrap=true};t.prototype.onDisplay=function(){this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){};t.prototype.refreshAll=function(){this.x=(Laya.stage.width-this.width)/2;this.y=(Laya.stage.height-this.height)/2;this.alpha=0;this._startY=this.y};t.prototype.play=function(t){var e=csv.TowerMonsterProxy.getIns().getSpellCfg(t);this.text.text=app.getLang("{0}：{1}",e.name,e.des);this.imgfuzhou.skin="jiuchongyaota/bg_fuzhou_"+t+".png";game.NoticeManager.getIns().flowImg(this,this._startY)};t.SINGLE_KEY="tower.AmuletGettedNotice";return t}(ui.jiuchongyaota.fuzhoushuomingitemUI);t.AmuletGettedNotice=e})(tower||(tower={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tower;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){this.data=t;this.labelwenzi.text=app.getLang(t.name);this.labelmiaoshu2.text=app.getLang(t.des);this.imgfuzhou.skin="jiuchongyaota/"+t.res+".png";this.benkuang.selected=false};e.SINGLE_KEY="tower.AmuletItem";return e}(ui.jiuchongyaota.fuzhuitemUI);t.AmuletItem=e})(tower||(tower={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tower;(function(e){var t=function(i){__extends(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){i.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.x=(Laya.stage.width-this.width)/2;this.y=(Laya.stage.height-this.height)/2;for(var t=1;t<=3;t++){var e=csv.TowerMonsterProxy.getIns().getSpellCfg(t);this["viewkuang"+t].setData(e);this["viewkuang"+t].benkuang.clickHandler=new Laya.Handler(this,this.onSelected,[e])}this.btnclose.clickHandler=new Laya.Handler(this,this.onClose);this.btngoumai.clickHandler=new Laya.Handler(this,this.onBtnBuy)};t.prototype.onClose=function(){app.ViewManager.toggleView(e.AmuletView,app.AppContainer.uiLayer,-1)};t.prototype.onBtnBuy=function(){if(parseInt(this.id)>0){var t=game.Config.getParams(game.ConfigID.TOWER_ITEM_PRICE);if(game.GridsModel.getIns().hasEnoughItems(t,false,true)){app.ProtocolRequest.NineTowerBuyReq(parseInt(this.id))}}else{manager.FlowManager.instance.flowByStyle1(app.getLang("请选择一个符咒"))}};t.prototype.onSelected=function(t){for(var e=1;e<=3;e++){this["viewkuang"+e].benkuang.selected=false}this["viewkuang"+t.id].benkuang.selected=true;this.id=t.id};t.prototype.onDisplay=function(){this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){for(var t=1;t<=3;t++){this["viewkuang"+t].benkuang.selected=false}this.id=0};t.prototype.refreshAll=function(){this.imghuobi.parserIcon(game.Config.getParams(game.ConfigID.TOWER_ITEM_PRICE),this.labelshuzi)};t.SINGLE_KEY="tower.AmuletView";return t}(ui.jiuchongyaota.buffgoumaitipUI);e.AmuletView=t})(tower||(tower={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tower;(function(o){var t=function(t){__extends(i,t);function i(){return t!==null&&t.apply(this,arguments)||this}i.getIns=function(){return app.Singleton.getInstance(i)};i.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listdaoju1.itemRender=grids.GridView;this.listdaoju2.itemRender=grids.GridView;this.listdaoju3.itemRender=grids.GridView;this.listdaoju1.renderHandler=grids.GridView.CommonItemRender;this.listdaoju2.renderHandler=grids.GridView.CommonItemRender;this.listdaoju3.renderHandler=grids.GridView.CommonItemRender;this.btndatingshengji.clickHandler=new Laya.Handler(this,this.onDgnNineTowerReq);this.imgwanmeitongguan.visible=false};i.prototype.onDgnNineTowerReq=function(){var t=parseInt(this.dataSource.area);var e=parseInt(this.dataSource.order);o.TowerMonsterModel.getIns().onDgnNineTowerReq(t,e);app.ViewManager.toggleDialog(i,-1,0)};i.prototype.onDisplay=function(){this.callLater(this.refreshAll)};i.prototype.onUnDisplay=function(){};i.prototype.isPerfect=function(t){if(t){this.btndatingshengji.visible=false;this.labelmiaoshu1.visible=false;this.imgwanmeitongguan.visible=true}else{this.btndatingshengji.visible=true;this.labelmiaoshu1.visible=true;this.imgwanmeitongguan.visible=false}};i.prototype.refreshAll=function(){var t=this.dataSource;var e=parseInt(this.dataSource.area);var i=parseInt(this.dataSource.order);this.labeltitle.text=this.dataSource.levelname;var n=o.TowerMonsterModel.getIns().getTowerInfo(e,i);var a=o.TowerMonsterModel.getIns().pareseStars(n?n.stars:0);this.isPerfect(a==3);this.imgtouxiang.skin=csv.MonsterProxy.getMonsterHeadUrl(t.monsterbase);this.labelboss.text=app.getLang(t.name);this.labelmiaoshu2.text=app.getLang(t.bossdesc);this.labelmiaoshu3.color=game.STYLES.GRAY_COLOR_S;this.labelmiaoshu4.color=game.STYLES.GRAY_COLOR_S;this.labelmiaoshu5.color=game.STYLES.GRAY_COLOR_S;this.viewxingxing1.imgxingxing.gray=true;this.viewxingxing2.imgxingxing.gray=true;this.viewxingxing3.imgxingxing.gray=true;if(n&&n.stars>>0&1){this.labelmiaoshu3.color=game.STYLES.GREEN_COLOR_S;this.viewxingxing1.imgxingxing.gray=false}if(n&&n.stars>>1&1){this.labelmiaoshu4.color=game.STYLES.GREEN_COLOR_S;this.viewxingxing2.imgxingxing.gray=false}if(n&&n.stars>>2&1){this.labelmiaoshu5.color=game.STYLES.GREEN_COLOR_S;this.viewxingxing3.imgxingxing.gray=false}this.labelmiaoshu3.text=app.getLang("jiesuan_jiuchong_2");this.labelmiaoshu4.text=app.getLang("jiesuan_jiuchong_3",t.limittime);this.labelmiaoshu5.text=app.getLang("jiesuan_jiuchong_4",t.limitpeo);this.listdaoju1.array=game.ItemUtil.parserList(t.threestaraward);this.listdaoju2.array=game.ItemUtil.parserList(t.twostaraward);this.listdaoju3.array=game.ItemUtil.parserList(t.onestaraward);this.boxtongguanjiangli.visible=true;this.imgtishi.visible=false};i.SINGLE_KEY="tower.BossDetailedInfoView";return i}(ui.jiuchongyaota.bossxinxiviewUI);o.BossDetailedInfoView=t})(tower||(tower={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tower;(function(s){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.starMediator=new common.StarClipMediator([this.imgxingxing1,this.imgxingxing2,this.imgxingxing3]);this.starMediator.setStar(0);this.imgxuanzhong.visible=false};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){this.data=t;this.labelboss.text=app.getLang(t.name);this.imgtouxiang.skin=csv.MonsterProxy.getMonsterHeadUrl(t.monsterbase);this.setSelect(false);if(game.Context.isRoleReach(false,t.open)){this.boxboss.gray=false;this.labelmiaoshu.text="";var e=s.TowerMonsterModel.getIns().getStarsByStage(t.area);if(e>=t.starlimit){var i=s.TowerMonsterModel.getIns().getTowerInfo(t.area,t.order);var n=s.TowerMonsterModel.getIns().pareseStars(i?i.stars:0);this.starMediator.setStar(n)}else{this.starMediator.setStar(0);this.boxboss.gray=true;this.labelmiaoshu.color=game.STYLES.YELLOW_COLOR_S;this.labelmiaoshu.text=app.getLang("{0}星开启",t.starlimit)}}else{this.boxboss.gray=true;this.labelmiaoshu.color=game.STYLES.YELLOW_COLOR_S;var a=app.str2Array(t.open,"-")[0];var o=app.str2Array(t.open,"-")[1];this.labelmiaoshu.text=app.getLang("level_reward_txt_02",a,csv.ReBirthProxy.getIns().getLvlDes(o))}};e.prototype.setSelect=function(t){this.imgxuanzhong1.visible=t};e.SINGLE_KEY="tower.BossItemTower";return e}(ui.jiuchongyaota.guanqiaitemUI);s.BossItemTower=t})(tower||(tower={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tower;(function(a){var o=game.RedDotView;var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onBtnClose=function(){if(this.quedingbtn.label==app.getLang("领取")){var t=a.TowerMonsterView.getIns().curSelectId;a.TowerMonsterModel.getIns().onAwardNineTowerReq(t,this.dataSource[1])}app.ViewManager.toggleDialog(e,-1,0)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){var t=this.dataSource[0];this.daojulist.array=t;var e=this.dataSource[1];this.label01.text=app.getLang("{0}星宝箱",e);this.quedingbtn.label=app.getLang("领取");this.updateBtn(e)};e.prototype.updateBtn=function(t){var e=a.TowerMonsterView.getIns().curSelectId;var i=a.TowerMonsterModel.getIns().getStarsByStage(e);this.quedingbtn.disabled=false;o.removeFrom(this.quedingbtn);var n=a.TowerMonsterModel.getIns().isGetted(e,t);if(i>=t){if(n){this.quedingbtn.label=app.getLang("已领取");this.quedingbtn.disabled=true}else{this.quedingbtn.label=app.getLang("领取");o.addTo(this.quedingbtn)}}else{this.quedingbtn.disabled=true}};e.SINGLE_KEY="tower.MissionAwardView";return e}(items.ItemGettedView);a.MissionAwardView=t})(tower||(tower={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tower;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){this.update(this.dataSource);this.x=(Laya.stage.width-this.width)*.5;this.y=battle.BattleLimitTimeView.getIns().y-this.height};e.prototype.update=function(t){this.clipchongshu.value=util.TimeUtil.getChineseNum(t[0]);this.clipguanqia.value=t[1]+""};e.SINGLE_KEY="tower.NineTowerBattleTitle";return e}(ui.jiuchongyaota.guanqiatishiitemUI);t.NineTowerBattleTitle=e})(tower||(tower={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tower;(function(r){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t._order=1;t.startY=0;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.btnxingxing1.clickHandler=new Laya.Handler(this,this.onShowAward,[3]);this.btnxingxing2.clickHandler=new Laya.Handler(this,this.onShowAward,[2]);this.btnxingxing3.clickHandler=new Laya.Handler(this,this.onShowAward,[1]);this._boxList=[];this._needList=[30,20,10];this._boxSkin=["jiuchongyaota/bg_xingjibaoxiang_5.png","jiuchongyaota/bg_xingjibaoxiang_3.png","jiuchongyaota/bg_xingjibaoxiang_1.png"];this._opendSkin=["jiuchongyaota/bg_xingjibaoxiang_6.png","jiuchongyaota/bg_xingjibaoxiang_4.png","jiuchongyaota/bg_xingjibaoxiang_2.png"];this._boxList.push(this.box1,this.box2,this.box3);this.mapList.itemRender=r.TowerMapItem;this.mapList.renderHandler=new Laya.Handler(this,this.onMapRender);this.mapList.repeatY=1;this.mapList.vScrollBarSkin=" ";this.mapList.scrollBar.changeHandler=new Laya.Handler(this,this.onScrollBarChange);this.startY=this.imgtishi.y;this.imgjiantoushang.on(Laya.Event.CLICK,this,this.onNext);this.imgjiantouxia.on(Laya.Event.CLICK,this,this.onPre);this.btndatingshengji.clickHandler=new Laya.Handler(this,this.onBattle)};t.prototype.onScrollBarChange=function(){if(this.mapList.scrollBar.value==0){this.mapList.selectedIndex=0}if(this.mapList.scrollBar.value==this.mapList.scrollBar.height){this.mapList.selectedIndex=1}this.updateArrow()};t.prototype.onBattle=function(){var t=parseInt(this._selectItem.data.area);var e=parseInt(this._selectItem.data.order);r.TowerMonsterModel.getIns().onDgnNineTowerReq(t,e)};t.prototype.onNext=function(){if(this.mapList.selectedIndex>0){this.mapList.selectedIndex--;this.mapList.tweenTo(this.mapList.selectedIndex,350)}this.updateArrow()};t.prototype.onPre=function(){if(this.mapList.selectedIndex<this.mapList.length-1){this.mapList.selectedIndex++;this.mapList.tweenTo(this.mapList.selectedIndex,350)}this.updateArrow()};t.prototype.updateArrow=function(){if(this.mapList.selectedIndex==0){this.imgjiantoushang.gray=true;this.imgjiantouxia.gray=false}else{this.imgjiantoushang.gray=false;this.imgjiantouxia.gray=true}};t.prototype.selectHandler=function(t){this._selectItem=t};t.prototype.onMapRender=function(t,e){var i=this.dataSource[0]?parseInt(this.dataSource[0]):1;t.setData(t.dataSource,i,this._order,e)};t.prototype.onPanelClick=function(t){app.ViewManager.toggleDialog(r.BossDetailedInfoView,1,0,t.data)};t.prototype.onShowAward=function(t){var e=this.dataSource[0]?parseInt(this.dataSource[0]):1;var i=csv.TowerMonsterProxy.getIns().getCfg(e);var n="firstaward";var a=10;if(t==1){n="firstaward";a=10}else if(t==2){n="secondaward";a=20}else if(t==3){n="thirdaward";a=30}var o=game.ItemUtil.parserList(i[n]);app.ViewManager.toggleDialog(r.MissionAwardView,1,0,[o,a])};t.prototype.reddotUpdate=function(){var t=this.dataSource[0]?parseInt(this.dataSource[0]):1;var e=r.TowerMonsterModel.getIns().getStarsByStage(t);game.RedDotView.removeFrom(this.box1);game.RedDotView.removeFrom(this.box2);game.RedDotView.removeFrom(this.box3);for(var i=0;i<3;i++){var n=this._needList[i];var a=r.TowerMonsterModel.getIns().isGetted(t,n);if(e>=n&&!a){game.RedDotView.addTo(this._boxList[i])}if(a){this._boxList[i].skin=this._opendSkin[i]}else{this._boxList[i].skin=this._boxSkin[i]}}};t.prototype.onDisplay=function(){r.TowerMonsterModel.getIns().on(r.TowerMonsterModel.TOWER_NINE_AWARD_SUCCESS,this,this.reddotUpdate);this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){r.TowerMonsterModel.getIns().off(r.TowerMonsterModel.TOWER_NINE_AWARD_SUCCESS,this,this.reddotUpdate);Laya.Tween.clearAll(this.imgtishi)};t.prototype.refreshAll=function(){this.imgtishi.alpha=0;this.startY=this.height*.5;var t=this.dataSource[0]?parseInt(this.dataSource[0]):1;this.clip2.value=util.TimeUtil.getChineseNum(t);this._order=r.TowerMonsterModel.getIns().getOrderByStage(t);this.clip1.value=this._order+"";var e=[],i=[];for(var n=0;n<10;n++){var a=csv.TowerMonsterProxy.getIns().getBossByType(t,n);if(n<5){e.push(a)}else{i.push(a)}}this.mapList.array=[i,e];if(this._selectItem){this._selectItem.setSelect(false)}if(this._order<10){this.mapList.selectedIndex=this._order>=5?0:1;this.mapList.scrollTo(this.mapList.selectedIndex)}this.updateArrow();this.reddotUpdate();this.btndatingshengji.visible=true;var o=r.TowerMonsterModel.getIns().getTowerInfo(t,9);if(o){var s=r.TowerMonsterModel.getIns().pareseStars(o.stars);if(s>0){this.btndatingshengji.visible=false}}};t.prototype.onAlert=function(){game.NoticeManager.getIns().flowImg(this.imgtishi,this.startY)};t.prototype.doRemove=function(){Laya.Tween.to(this.imgtishi,{alpha:0},500,null,new Laya.Handler(this,this.onComplete))};t.prototype.onComplete=function(){};t.SINGLE_KEY="tower.TowerBossMapView";return t}(ui.jiuchongyaota.guanqiatipUI);r.TowerBossMapView=t})(tower||(tower={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tower;(function(a){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);a.TowerMonsterModel.getIns().on(a.TowerMonsterModel.TOWER_NINE_AWARD_SUCCESS,this,this.checkGetted);this._needList=[30,20,10]};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){this.playAni(false)};e.prototype.refreshAll=function(){};e.prototype.setData=function(t,e){this.index=t;this.imgceng.skin="jiuchongyaota/bg_jiuchongyaota_name_"+t+".png";this.di.visible=e;this.isPerfect(false);this.playAni(false)};e.prototype.isPerfect=function(t){this.imgkaimen.visible=t};e.prototype.playAni=function(t){this.kaimentexiao.visible=t;if(t){this.kaimentexiao.play(0,true)}else{this.kaimentexiao.stop()}};e.prototype.checkGetted=function(){this.imgbaoxiang.visible=false;var t=a.TowerMonsterModel.getIns().getStarsByStage(this.index);for(var e=0;e<3;e++){var i=this._needList[e];var n=a.TowerMonsterModel.getIns().isGetted(this.index,i);if(t>=i&&!n){this.imgbaoxiang.visible=true;break}}};e.SINGLE_KEY="tower.TowerItem";return e}(ui.jiuchongyaota.taxuanzhongitemnewUI);a.TowerItem=t})(tower||(tower={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tower;(function(r){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.items=[];this.items.push(this.boss0,this.boss1,this.boss2,this.boss3,this.boss4)};e.prototype.onDisplay=function(){for(var t=0;t<5;t++){this.items[t].on(Laya.Event.CLICK,this,this.onItemClick)}this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){for(var t=0;t<5;t++){this.items[t].off(Laya.Event.CLICK,this,this.onItemClick)}};e.prototype.onItemClick=function(t){var e=t.currentTarget;if(e){r.TowerBossMapView.getIns().onPanelClick(e)}};e.prototype.refreshAll=function(){};e.prototype.setData=function(t,e,i,n){var a=csv.TowerMonsterProxy.getIns().getCfg(e);this.imgditu.skin="res/static/jiuchongyaota/"+a.res+".jpg";for(var o=0;o<5;o++){this["boss"+o].setData(t[o])}var s=i>=5?0:1;if(s==n){r.TowerBossMapView.getIns().selectHandler(this["boss"+i%5]);this["boss"+i%5].setSelect(true)}else{this["boss"+i%5].setSelect(false)}};e.SINGLE_KEY="tower.TowerMapItem";return e}(ui.jiuchongyaota.jiuchongyaotacengitem1UI);r.TowerMapItem=t})(tower||(tower={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var tower;(function(s){var t=function(i){__extends(t,i);function t(){var t=i!==null&&i.apply(this,arguments)||this;t.curSelectId=1;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){i.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.btnquanjusaodang.clickHandler=new Laya.Handler(this,this.onQuickBattle);this.btnquanjusaodangmianfei.clickHandler=new Laya.Handler(this,this.onQuickBattle);this.btnFight.clickHandler=new Laya.Handler(this,this.onBattle);this.btnjinru.clickHandler=new Laya.Handler(this,this.onBattle);game.HelperViewHandler.registerStr([this.btntishi,this.labelguizeshuoming],"func86t","challenge_01");this.gezi.itemRender=grids.GridView;this.gezi.renderHandler=new Laya.Handler(this,this.onRenderHandler);this.gezi.hScrollBarSkin=" ";this.centerLayout=new game.CenterLayoutMediator(this.gezi,this.boxsaodang,100,this.gezi.spaceX);this.imgtishi1.visible=false;this.imgtishi2.visible=false;this.items=[];var t;for(var e=1;e<=9;e++){t=this.ta["t"+e];this.items.push(t);t.setData(e,false);t.on(Laya.Event.CLICK,this,this.onSelect)}};t.prototype.refresh=function(){for(var t=0;t<9;t++){this.onTowerLayerRender(this.items[t])}this.scrollTo()};t.prototype.scrollTo=function(){if(this.curSelectId>=6){this.panelta.scrollTo(0,0)}else{this.panelta.scrollTo(0,this.items[1].y)}};t.prototype.onTowerLayerRender=function(t){var e=this.curSelectId;t.di.visible=false;t.playAni(false);t.isPerfect(false);t.checkGetted();if(t.index==e){if(this.selectCell){this.selectCell.di.visible=false}t.di.visible=true;this.curSelectId=t.index;this.selectCell=t;t.playAni(true)}var i=csv.TowerMonsterProxy.getIns().getTotalOrder(t.index);if(s.TowerMonsterModel.getIns().getStarsByStage(t.index)>=i*3){t.isPerfect(true)}};t.prototype.onSelect=function(t){var e=t.currentTarget;if(e){if(this.selectCell){this.selectCell.di.visible=false}e.di.visible=true;this.curSelectId=e.index;this.selectCell=e;this.updateTitle();this.scrollTo()}};t.prototype.onRenderHandler=function(t){t.setData(t.dataSource)};t.prototype.onShowTips=function(){tip.TipManager.showHelpInfoTip(app.getLang("func86t"),app.getLang("challenge_01"))};t.prototype.onBattle=function(){var t=csv.TowerMonsterProxy.getIns().getCfg(this.curSelectId);var e=game.Context.checkLevLimit(t.open);if(e){app.ViewManager.toggleDialog(s.TowerBossMapView,1,0,this.curSelectId+"")}else{manager.FlowManager.instance.flowByStyle1(app.getLang("未开启"))}};t.prototype.onQuickBattle=function(){s.TowerMonsterModel.getIns().onSweepNineTowerReq()};t.prototype.onDisplay=function(){this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){};t.prototype.refreshAll=function(){this.checkTime();this.curSelectId=s.TowerMonsterModel.getIns().autoFindStage();this.updateTitle();var t=s.TowerMonsterModel.getIns().getAwards();this.centerLayout.array=t;this.refresh();if(t.length>0){this.boxjinru.visible=false}else{this.boxjinru.visible=true}this.boxsaodang.visible=!this.boxjinru.visible};t.prototype.checkTime=function(){var t=boss.BossModel.getIns().getDailyTime(csv.DailyTimeProxy.ENUM_TYPE.NINE_TOWER);var e=0;var i=csv.DailyTimeProxy.getIns().buytime(csv.DailyTimeProxy.ENUM_TYPE.NINE_TOWER);this.boxquanjusaodangmianfei.visible=false;this.boxquanjusaodang.visible=false;game.RedDotView.removeFrom(this.boxquanjusaodangmianfei);var n=t.fnum+t.gnum;if(n>0){this.boxquanjusaodangmianfei.visible=true;if(s.TowerMonsterModel.getIns().canFreeScouring()==1){var a=s.TowerMonsterModel.getIns().getAwards();if(a.length>0){game.RedDotView.addTo(this.boxquanjusaodangmianfei)}}}else{e=t.bnum;if(i>0){var o=void 0;if(e>=i){o=csv.DailyTimeProxy.getIns().buycost(csv.DailyTimeProxy.ENUM_TYPE.NINE_TOWER,i)}else{o=csv.DailyTimeProxy.getIns().buycost(csv.DailyTimeProxy.ENUM_TYPE.NINE_TOWER,e+1)}this.labelshuzi.text=o[1];this.boxquanjusaodang.visible=true}}this.labelcish.text=n+(i-e)+""};t.prototype.updateTitle=function(){var t=csv.TowerMonsterProxy.getIns().getCfg(this.curSelectId);var e=game.Context.checkLevLimit(t.open);var i=app.str2Array(t.open,"-")[0];var n=app.str2Array(t.open,"-")[1];this.imgcengshu.skin="jiuchongyaota/bg_jiuchongyaota_name_"+this.curSelectId+".png";if(!e){var a=app.getLang("level_reward_txt_02",i,csv.ReBirthProxy.getIns().getLvlDes(n));this.labelmiaoshu3.text=app.getLang("第{0}层\n",this.curSelectId)+a;this.labelmiaoshu3.visible=true;this.boxxingshu.visible=false}else{var o=csv.TowerMonsterProxy.getIns().getTotalOrder(this.curSelectId);this.labelmiaoshu2.text=app.getLang("{0}/{1}",s.TowerMonsterModel.getIns().getStarsByStage(this.curSelectId),o*3);this.labelmiaoshu3.visible=false;this.boxxingshu.visible=true}};t.SINGLE_KEY="tower.TowerMonsterView";return t}(ui.jiuchongyaota.jiuchongyaotaviewnewnewUI);s.TowerMonsterView=t})(tower||(tower={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var treasure;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){app.ViewManager.regist(i.TreasureView,"youjian.atlas","xingyunxunbao.atlas","lixianjingyan.atlas");app.ViewManager.regist(i.TurantableView,"qirimubiao.atlas");game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.TREASURE_NORMAL,i.TreasureView,new Laya.Handler(this,this.onTreaureNormal),3);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.TREASURE_SUPER,i.TreasureView,new Laya.Handler(this,this.onTreaureSuper),3);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.TURNTABLE,i.TurantableView,null,5)};e.prototype.onTreaureNormal=function(){i.TreasureModel.getIns().selectIndex=this.getIndex(csv.FunctionsProxy.ENUMS.TREASURE_NORMAL);game.WindowsResigter.call(csv.FunctionsProxy.ENUMS.TREASURE_NORMAL,true,true)};e.prototype.onTreaureSuper=function(){i.TreasureModel.getIns().selectIndex=this.getIndex(csv.FunctionsProxy.ENUMS.TREASURE_SUPER);game.WindowsResigter.call(csv.FunctionsProxy.ENUMS.TREASURE_SUPER,true,true)};e.prototype.getIndex=function(t){var e=[csv.FunctionsProxy.ENUMS.TREASURE_NORMAL,csv.FunctionsProxy.ENUMS.TREASURE_SUPER];var i=[];for(var n=0;n<e.length;n++){var a=e[n];if(csv.FunctionsProxy.getIns().isOpen(a)){i.push(n)}}var o=i.indexOf(t);if(o==-1){return 0}return o};e.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.TreasureHuntDataAck,this,this.onTreasureHuntDataAck);this.addMsgListener(app.ProtocolResponse.TreasureHuntRecordAck,this,this.onTreasureHuntRecordAck);this.addMsgListener(app.ProtocolResponse.TreasureHuntBuyAck,this,this.onTreasureHuntBuyAck);this.addMsgListener(app.ProtocolResponse.TreasureHuntDrawAck,this,this.onTreasureHuntDrawAck);this.addMsgListener(app.ProtocolResponse.TreasureHuntRefreshAck,this,this.onTreasureHuntRefreshAck);this.addMsgListener(app.ProtocolResponse.TreasureHuntReceiveLuckAck,this,this.onTreasureHuntReceiveLuckAck);this.addMsgListener(app.ProtocolResponse.ActDrawResp,this,this.onActDrawResp);this.addMsgListener(app.ProtocolResponse.ActDrawInfoResp,this,this.onActDrawInfoResp);this.addMsgListener(app.ProtocolResponse.ActDrawCountNtf,this,this.onActDrawCountNtf);game.GridsModel.getIns().on(game.GridsModel.EVENTS.UPDATE,this,this.onGoodUpdateHandler)};e.prototype.onActDrawCountNtf=function(t,e){i.TreasureModel.getIns().event(i.TreasureModel.TURNTABLE_COUNT,[e.cfgID,e.count])};e.prototype.onActDrawInfoResp=function(t,e){i.TreasureModel.getIns().event(i.TreasureModel.TURNTABLE_HISTORY,[e.cfgID,e.drawData])};e.prototype.onActDrawResp=function(t,e){if(e.ret){i.TreasureModel.getIns().event(i.TreasureModel.TURNTABLE_LIST,[e.cfgID,e.list])}};e.prototype.onTreasureHuntRefreshAck=function(t,e){if(e.success==1){i.TreasureModel.getIns().getDataByType(e.type).vo.vecTreasureHunt=e.vecTreasureHunt;i.TreasureModel.getIns().event(i.TreasureModel.EVENT_HUNT_REFRESH,[e])}i.TreasureModel.getIns().refreshMainRed()};e.prototype.onTreasureHuntReceiveLuckAck=function(t,e){if(e.success==1){i.TreasureModel.getIns().getDataByType(e.type).vo.luckData=e.luckData;i.TreasureModel.getIns().event(i.TreasureModel.EVENT_LINGQU_SUCCEED,[e])}i.TreasureModel.getIns().refreshMainRed()};e.prototype.onTreasureHuntDataAck=function(t,e){if(e.type==i.E_PET_TREASURE.NORMAL){i.TreasureModel.getIns().normalVo.vo=e}else{i.TreasureModel.getIns().superVo.vo=e}i.TreasureModel.getIns().refreshMainRed();i.TreasureModel.getIns().event(i.TreasureModel.EVENT_INFO)};e.prototype.onTreasureHuntRecordAck=function(t,e){if(e.type==i.E_PET_TREASURE.NORMAL){i.TreasureModel.getIns().normalVo.msg=e.vecTreasureHuntRecord}else{i.TreasureModel.getIns().superVo.msg=e.vecTreasureHuntRecord}i.TreasureModel.getIns().event(i.TreasureModel.EVENT_HUNT_RECORACK)};e.prototype.onTreasureHuntDrawAck=function(t,e){if(e.success==1){i.TreasureModel.getIns().event(i.TreasureModel.EVENT_TREASURE_SUCCEED,[e])}i.TreasureModel.getIns().refreshMainRed()};e.prototype.onTreasureHuntBuyAck=function(t,e){if(e.success==1){i.TreasureModel.getIns().event(i.TreasureModel.EVENT_BUY_SUCCEED,[e])}i.TreasureModel.getIns().refreshMainRed()};e.prototype.onGoodUpdateHandler=function(){i.TreasureModel.getIns().refreshMainRed()};e.SINGLE_KEY="treasure.TreasureModule";return e}(app.ModuleBase);i.TreasureModule=t})(treasure||(treasure={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var treasure;(function(l){var h;(function(t){t[t["NORMAL"]=1]="NORMAL";t[t["SUPER"]=2]="SUPER";t[t["TURNTABLE"]=3]="TURNTABLE"})(h=l.E_PET_TREASURE||(l.E_PET_TREASURE={}));var p;(function(t){t[t["Normal"]=0]="Normal";t[t["ItemNotEnough"]=1]="ItemNotEnough";t[t["VipLevel"]=2]="VipLevel"})(p=l.E_PET_TREASURE_STATE||(l.E_PET_TREASURE_STATE={}));var u;(function(t){t[t["IsLingQued"]=0]="IsLingQued";t[t["IsScoreNotEnough"]=1]="IsScoreNotEnough";t[t["CanLinqu"]=2]="CanLinqu"})(u=l.E_PET_TREASURE_LINQU_STATUS||(l.E_PET_TREASURE_LINQU_STATUS={}));var t=function(e){__extends(r,e);function r(){var t=e!==null&&e.apply(this,arguments)||this;t.selectIndex=0;return t}r.getIns=function(){return app.Singleton.getInstance(r)};r.prototype.init=function(){this.normalVo=new l.TreasurePetVO;this.superVo=new l.TreasurePetVO};r.prototype.initCommands=function(){};r.prototype.getDataByType=function(t){if(t==h.NORMAL){return this.normalVo}return this.superVo};r.prototype.getFuncTypeByFid=function(t){return t==csv.FunctionsProxy.ENUMS.TREASURE_NORMAL?h.NORMAL:h.SUPER};r.prototype.getMoreItemVo=function(t){var e=game.Config.getParams(t==h.NORMAL?455:456).split(";");var i=parseInt(e[0]);var n=game.Config.getParams(457).split(";")[t==h.NORMAL?0:1];return game.ItemUtil.parserList(n+"-"+i)[0]};r.prototype.getStatus=function(t,e,i){if(i===void 0){i=false}if(e==l.E_COUNT_TYPE.More){var n=csv.TreasureProxy.getIns().vipLevel;if(vipcode.VipModel.getIns().vipLvl<n){if(i){manager.FlowManager.instance.flowByStyle1(app.getLang("treasure_txt07",n))}return p.VipLevel}else{var a=this.getMoreItemVo(t);if(game.GridsModel.getIns().hasEnoughItems(a)==false){if(i){manager.FlowManager.instance.flowByStyle1(app.getLang("treasure_txt08"))}return p.ItemNotEnough}}}else{var o=game.Config.getParams(457).split(";")[t==h.NORMAL?0:1];var s=1;var a=game.ItemUtil.parserList(o+"-"+s)[0];if(game.GridsModel.getIns().hasEnoughItems(a)==false){if(i){manager.FlowManager.instance.flowByStyle1(app.getLang("treasure_txt08"))}return p.ItemNotEnough}}return p.Normal};r.prototype.lingquStatus=function(t,e){var i=t.receivedReward||[];if(i.indexOf(e.id)==-1){if(t.curLuck<e.luck){return u.IsScoreNotEnough}else{return u.CanLinqu}}else{return u.IsLingQued}};r.prototype.setRed=function(t){var e=[csv.FunctionsProxy.ENUMS.TREASURE_NORMAL,csv.FunctionsProxy.ENUMS.TREASURE_SUPER];for(var i=0;i<e.length;i++){var n=e[i];var a=csv.FunctionsProxy.getIns().isOpen(n);if(a){var o=n;if(t)game.ClosureManager.addDot(o);else game.ClosureManager.removeDot(o)}}};r.prototype.hasLuckLingQu=function(t){var e=this.getDataByType(t);if(e.vo){var i=e.vo.luckData[0];var n=csv.TreasureProxy.getIns().getCfgListByType(t);for(var a=0;a<n.length;a++){var o=n[a];var s=r.getIns().lingquStatus(i,o);if(s==u.CanLinqu){return true}}}return false};r.prototype.onCheckByType=function(t){if(this.getStatus(t,l.E_COUNT_TYPE.More)==p.Normal){return true}if(this.getStatus(t,l.E_COUNT_TYPE.One)==p.Normal){return true}return false};r.prototype.refreshMainRed=function(){this.setRed(this.onCheckByType(h.NORMAL)||this.onCheckByType(h.SUPER)||this.hasLuckLingQu(h.NORMAL)||this.hasLuckLingQu(h.SUPER))};r.SINGLE_KEY="treasure.TreasureModel";r.DEBUG=false;r.TURNTABLE_HISTORY="TURNTABLE_HISTORY";r.TURNTABLE_LIST="TURNTABLE_LIST";r.TURNTABLE_COUNT="TURNTABLE_COUNT";r.EVENT_INFO="EVENT_INFO";r.EVENT_TREASURE_SUCCEED="EVENT_TREASURE_SUCCEED";r.EVENT_BUY_SUCCEED="EVENT_BUY_SUCCEED";r.EVENT_HUNT_RECORACK="EVENT_HUNT_RECORACK";r.EVENT_HUNT_REFRESH="EVENT_HUNT_REFRESH";r.EVENT_LINGQU_SUCCEED="EVENT_LINGQU_SUCCEED";return r}(app.ModelBase);l.TreasureModel=t})(treasure||(treasure={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("treasurehunt.csv");this.treasureHuntMap=t.getMap("id");this.hurtList=t.getArray();t=app.Config.getResById("treasureluck.csv");this.treasureluckMap=t.getMap("id");this.treasureLuckArray=t.getArray();t=app.Config.getResById("treasureshop.csv");this.treasureshopArr=t.getArray()};e.prototype.getHuntList=function(t){var e=[];for(var i=0;i<this.hurtList.length;i++){var n=this.hurtList[i];if(n.showrate!=undefined&&n.showrate!=0&&t==n.category){e.push(this.hurtList[i])}}return e};e.prototype.getMaxValue=function(t){var e=Number.MIN_VALUE;var i=[];for(var n=0;n<this.treasureLuckArray.length;n++){var a=this.treasureLuckArray[n];if(a.type==t){i.push(a.luck)}}for(var n=0;n<i.length;n++){if(e<i[n]){e=i[n]}}return e};e.prototype.getProgress=function(t,e){var i=[];i.push(0);for(var n=0;n<this.treasureLuckArray.length;n++){var a=this.treasureLuckArray[n];if(a.type==t){i.push(a.luck)}}for(var n=0;n<i.length;n++){var o=i[n];if(n<i.length-1){var s=i[n+1];if(e>=o&&e<s){return n/(i.length-1)}}}return 1};e.prototype.getCfgListByType=function(t){var e=[];for(var i=0;i<this.treasureLuckArray.length;i++){if(t==this.treasureLuckArray[i].type){e.push(this.treasureLuckArray[i])}}return e};Object.defineProperty(e.prototype,"freeGold",{get:function(){return parseInt(game.Config.getParams(461))},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"vipLevel",{get:function(){var t=0;return t},enumerable:true,configurable:true});return e}(app.ModelBase);t.TreasureProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var treasure;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listdaojugezi.itemRender=grids.GridView;this.listdaojugezi.renderHandler=grids.GridView.CommonItemRender;this.listdaojugezi.vScrollBarSkin=" ";this.labeltitle.text=app.getLang("yunyinghuodong_choujiang_1");this.btnlijichongzhi.label=app.getLang("yunyinghuodong_choujiang_3");this.btnlijichongzhi.clickHandler=new Laya.Handler(this,this.close)};e.prototype.onDisplay=function(){app.SoundManager.getIns().playSound("openpack");this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){this.label01.text=app.getLang("yunyinghuodong_choujiang_2");this.listdaojugezi.array=this.dataSource;this.listdaojugezi.scrollTo(0)};e.SINGLE_KEY="treasure.ItemShowView";return e}(ui.yunyinghuodong.baoxianghongtipUI);t.ItemShowView=e})(treasure||(treasure={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var treasure;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listgailvgongshi.itemRender=ui.yunyinghuodong.gailvgongshihongitemUI;this.listgailvgongshi.renderHandler=new Laya.Handler(this,this.onProbabilitysgHandler)};e.prototype.convertNum=function(t){var e=t/100;return e};e.prototype.onProbabilitysgHandler=function(t,e){var i=t.dataSource;var n=game.ItemUtil.parserList(i.item)[0];t.labelname.text=n.getName();t.labelgailv.text=this.convertNum(i.showrate).toString()+"%"};e.prototype.onUnDisplay=function(){};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.refreshAll=function(){var t=csv.TreasureProxy.getIns().getHuntList(this.dataSource[0]);this.listgailvgongshi.array=t;if(t.length>0){this.listgailvgongshi.scrollTo(0)}};e.SINGLE_KEY="treasure.ProbabilityForTurnTableView";return e}(ui.yunyinghuodong.gailvgongshihongtipUI);t.ProbabilityForTurnTableView=e})(treasure||(treasure={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var treasure;(function(a){var n;(function(t){t[t["One"]=1]="One";t[t["More"]=2]="More"})(n=a.E_COUNT_TYPE||(a.E_COUNT_TYPE={}));var i=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){this.on(Laya.Event.MOUSE_UP,this,this.onMouseUpHandler);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.shouqingimg.visible=false;this.itemdaoju.locktip=true};e.prototype.onDisplay=function(){a.TreasureModel.getIns().on(a.TreasureModel.EVENT_BUY_SUCCEED,this,this.onSucceedHandler)};e.prototype.onSucceedHandler=function(){if(this.cfg)this.setData(this.cfg)};e.prototype.onUnDisplay=function(){a.TreasureModel.getIns().off(a.TreasureModel.EVENT_BUY_SUCCEED,this,this.onSucceedHandler)};e.prototype.onMouseUpHandler=function(){var t=-1;t=tip.TipManager.getCanBuyCount(this.cfg.cost);var e=game.ItemUtil.parserList(this.cfg.item);var i=e[0];tip.TipManager.normalShop(i,this.cfg.cost,new Laya.Handler(this,this.buyCallBack,[this.cfg]),t)};e.prototype.buyCallBack=function(t,e){app.ProtocolRequest.TreasureHuntBuyReq(t.id,e)};e.prototype.setData=function(t){this.cfg=t;var e=game.ItemUtil.parserList(t.item);var i=e[0];this.labelname.color=game.STYLES.ITEM_QUALITY_S[i.getQuality()];this.labelname.text=i.getName();this.itemdaoju.setData(i);this.refreshCost(t.cost)};e.prototype.refreshCost=function(t){var e=t.split("-");var i=game.ItemUtil.parserList(t);var n=i[0];this.imgmoney.icon.skin=csv.ItemProxy.getItemSmallIcon(n.getItemId());this.labelmoneynum.text=n.count.toString();var a=game.MoneyModel.getIns().getMoney(game.MoneyModel.MONEY_ENUM.DOUBAO_SHANG_CHENG)};return e}(ui.shangcheng.shangchengitem1UI);var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listshangcheng.itemRender=i;this.listshangcheng.renderHandler=new Laya.Handler(this,this.renderHandler);this.btnjiahao.clickHandler=new Laya.Handler(this,this.onTipsHandler)};e.prototype.onTipsHandler=function(){var t=game.ItemUtil.parserList(game.ItemUtil.ENUMS.TREASURE_PET_SCROE+"-1")[0];tip.TipManager.show(t)};e.prototype.renderHandler=function(t,e){t.setData(t.dataSource)};e.prototype.onDisplay=function(){app.ViewManager.showDialogMask();a.TreasureModel.getIns().on(a.TreasureModel.EVENT_BUY_SUCCEED,this,this.onSucceedHandler);game.MoneyModel.getIns().on(game.MoneyModel.EVENTS.MONEY_CHANGE,this,this.onMoneyRefreshHandle);this.callLater(this.onInit)};e.prototype.onInit=function(){this.refreshAll()};e.prototype.refreshAll=function(){this.listshangcheng.array=csv.TreasureProxy.getIns().treasureshopArr;this.onRefreshMoney()};e.prototype.onUnDisplay=function(){app.ViewManager.closeDialogMask();a.TreasureModel.getIns().off(a.TreasureModel.EVENT_BUY_SUCCEED,this,this.onSucceedHandler);game.MoneyModel.getIns().off(game.MoneyModel.EVENTS.MONEY_CHANGE,this,this.onMoneyRefreshHandle)};e.prototype.onMoneyRefreshHandle=function(){this.onRefreshMoney()};e.prototype.onSucceedHandler=function(){this.onRefreshMoney()};Object.defineProperty(e.prototype,"moneyId",{get:function(){return game.ItemUtil.ENUMS.TREASURE_PET_SCROE},enumerable:true,configurable:true});e.prototype.onRefreshMoney=function(){this.labelmoney.text=game.MoneyModel.format(game.MoneyModel.getIns().getMoney(game.MoneyModel.MONEY_ENUM.DOUBAO_SHANG_CHENG));this.itemmoney.icon.skin=csv.ItemProxy.getItemSmallIcon(this.moneyId)};return e}(ui.shangcheng.duobaoshangchengviewUI);var o=function(){function t(t){this.skin=t;t.mouseEnabled=true;this.skin.on(Laya.Event.MOUSE_UP,this,this.onMouseUpHandler)}t.prototype.onMouseUpHandler=function(){var t=a.TreasureModel.getIns().lingquStatus(this.luckVo,this.luckCfg);if(t==a.E_PET_TREASURE_LINQU_STATUS.CanLinqu){app.ProtocolRequest.TreasureHuntReceiveLuckReq(this.luckCfg.type,this.luckCfg.id)}else{var e=game.ItemUtil.parserList(this.luckCfg.reward)[0];tip.TipManager.show(e)}};Object.defineProperty(t.prototype,"gray",{set:function(t){this.skin.gray=t},enumerable:true,configurable:true});t.prototype.setKeLingQu=function(t){if(t){this.skin.animationlingqu.visible=true;this.skin.animationlingqu.play()}else{this.skin.animationlingqu.stop();this.skin.animationlingqu.visible=false}};t.prototype.setGray=function(t){this.skin.imgdaoju.gray=t};t.prototype.refresh=function(t,e){this.luckVo=t;this.luckCfg=e;this.skin.labelnum.text=e.luck.toString();var i=game.ItemUtil.parserList(e.reward)[0];this.skin.imgdaoju.skin=i.getIconUrl();var n=a.TreasureModel.getIns().lingquStatus(t,e);switch(n){case a.E_PET_TREASURE_LINQU_STATUS.IsScoreNotEnough:game.RedDotView.removeFrom(this.skin);this.skin.imgyilingqu.visible=false;this.setKeLingQu(false);break;case a.E_PET_TREASURE_LINQU_STATUS.CanLinqu:game.RedDotView.addTo(this.skin);this.skin.imgyilingqu.visible=false;this.setKeLingQu(true);break;case a.E_PET_TREASURE_LINQU_STATUS.IsLingQued:game.RedDotView.removeFrom(this.skin);this.skin.imgyilingqu.visible=true;this.setKeLingQu(false);break}};return t}();var s=function(){function t(t){this.skin=t;this.selected=false;this.skin.itemdaoju.clickHandler=new Laya.Handler(this,this.clickHandler)}t.prototype.empty=function(){this.skin.itemdaoju.setData(game.GridsModel.EMPTY);this.selected=false};t.prototype.isAlreadyGet=function(t,e){if(e.repeat==0){if(t.receivedCount>=1){return true}}return false};t.prototype.clickHandler=function(){var t=this.cfg.item;var e=t.split("-");var i=parseInt(e[0]);var n=csv.ItemProxy.getType(i);if(n==csv.ItemProxy.TYPES.PET){var a=csv.ItemProxy.getIns().getItemCfgById(i)}else{var o=game.ItemUtil.parserList(this.cfg.item)[0];tip.TipManager.show(o)}};t.prototype.setData=function(t){this.cfg=csv.TreasureProxy.getIns().treasureHuntMap[t.id];var e=game.ItemUtil.parserList(this.cfg.item)[0];this.skin.itemdaoju.setData(e);var i=false;if(this.cfg.repeat==0){if(this.isAlreadyGet(t,this.cfg)){i=true}else{}}else{}this.skin.imgyihuode.visible=i};Object.defineProperty(t.prototype,"selected",{set:function(t){this.skin.ywseleced.visible=t;if(t){this.skin.animationzoumadeng.visible=true;this.skin.animationzoumadeng.play()}else{this.skin.animationzoumadeng.visible=false;this.skin.animationzoumadeng.stop()}},enumerable:true,configurable:true});return t}();var r=function(){function t(t){this.curPlayIndex=0;this.delayTime=50;this.goldList=t}t.prototype.reset=function(){this.isPlaying=false};t.prototype.playEndByIndex=function(t,e){this.isPlaying=true;this.loopCnt=0;this.curPlayIndex=0;this.endIndex=t;this.endHander=e;Laya.timer.once(this.delayTime,this,this.updateTime)};t.prototype.updateTime=function(){this.onRefreshGoldBox();if(this.curPlayIndex>=this.goldList.length){this.loopCnt++;this.curPlayIndex=0}else{this.curPlayIndex++;if(this.loopCnt<=0){Laya.timer.once(this.delayTime,this,this.updateTime)}else{if(this.curPlayIndex<=this.endIndex){Laya.timer.once(this.delayTime,this,this.updateTime)}else{this.isPlaying=false;this.endHander.run()}}}if(this.loopCnt>0&&this.curPlayIndex<=this.endIndex){Laya.timer.once(this.delayTime,this,this.updateTime)}};t.prototype.onRefreshGoldBox=function(){for(var t=0;t<this.goldList.length;t++){var e=this.goldList[t];e.selected=this.curPlayIndex==t}};return t}();var l=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.list.itemRender=grids.GridView;this.list.renderHandler=grids.GridView.CommonItemRender;this.okbtn.clickHandler=new Laya.Handler(this,this.okHandler);this.againbtn.clickHandler=new Laya.Handler(this,this.onAgainHandler)};e.prototype.onAgainHandler=function(){this.close();var t=this.dataSource;var e=t.id||[];var i=e.length>1?n.More:n.One;if(a.TreasureModel.getIns().getStatus(t.type,i)==a.E_PET_TREASURE_STATE.Normal,true){app.ProtocolRequest.TreasureHuntDrawReq(t.type,i)}};e.prototype.okHandler=function(){this.close()};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.getCount=function(t){var e=game.Config.getParams(t.type==a.E_PET_TREASURE.NORMAL?455:456).split(";");var i=parseInt(e[1]);return t.id.length<=1?1:i};e.prototype.refreshAll=function(){var t=this.dataSource;var e=t.id||[];var i=[];i.push(game.ItemUtil.parserList(game.ItemUtil.ENUMS.TREASURE_PET_SCROE+"-"+t.score)[0]);var n=this.getCount(t);this.againbtn.label=app.getLang("treasure_txt11",n);for(var a=0;a<e.length;a++){var o=csv.TreasureProxy.getIns().treasureHuntMap[e[a]];i.push(game.ItemUtil.parserList(o.item)[0])}this.list.array=i;if(i.length>0){this.list.scrollTo(0)}};return e}(ui.xingyunxunbao.xingyunrewardUI);var h=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listgailvgongshi.itemRender=ui.xingyunxunbao.gailvgongshiitemUI;this.listgailvgongshi.renderHandler=new Laya.Handler(this,this.onProbabilitysgHandler)};e.prototype.convertNum=function(t){var e=t/100;return e};e.prototype.onProbabilitysgHandler=function(t,e){var i=t.dataSource;var n=game.ItemUtil.parserList(i.item)[0];t.labelname.text=n.getName();t.labelgailv.text=this.convertNum(i.showrate).toString()+"%"};e.prototype.onUnDisplay=function(){};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.refreshAll=function(){var t=csv.TreasureProxy.getIns().getHuntList(this.dataSource[0]);this.listgailvgongshi.array=t;if(t.length>0){this.listgailvgongshi.scrollTo(0)}};return e}(ui.xingyunxunbao.gailvgongshitipUI);a.ProbabilityView=h;var t=function(){function t(t,e){this.isCounterpoise=true;this.boxList=[];this.skin=t;this.type=e;for(var i=0;i<5;i++){this.boxList.push(new o(this.skin["itemxingyunzhi0"+(i+1)]))}this.goldList=[];for(var i=0;i<8;i++){this.goldList.push(new s(this.skin["itemdaoju0"+(i+1)]))}this.skin.btnduobaoshangcheng.clickHandler=new Laya.Handler(this,this.onShopMouseUpHandler);this.skin.btnshuaxin.clickHandler=new Laya.Handler(this,this.onFreeHander);this.skin.listchakangengduo.itemRender=ui.xingyunxunbao.xingyunmsgitemUI;this.skin.listchakangengduo.renderHandler=new Laya.Handler(this,this.msgRenderHander);this.skin.btnduobao01.clickHandler=new Laya.Handler(this,this.onOneHandler);this.skin.btnduobao02.clickHandler=new Laya.Handler(this,this.onMoreBtnHandler);this._needMoreItem=this.moreItemVo;this.playGoldBox=new r(this.goldList);this.skin.listchakangengduo.array=[];this.skin.labelgengduo.on(Laya.Event.MOUSE_UP,this,this.onSeeMoreHandler);this.skin.btnadd.clickHandler=new Laya.Handler(this,this.onAddHander)}Object.defineProperty(t.prototype,"data",{get:function(){return a.TreasureModel.getIns().getDataByType(this.type)},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"huntVo",{get:function(){return this.data.vo.vecTreasureHunt[0]},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"moreItemVo",{get:function(){return a.TreasureModel.getIns().getMoreItemVo(this.type)},enumerable:true,configurable:true});t.prototype.onAddHander=function(){if(csv.FunctionsProxy.getIns().isOpen(csv.FunctionsProxy.ENUMS.GROW_UP,true)){var t=game.Config.getParams(464).split("-");var e=parseInt(t[this.type==a.E_PET_TREASURE.NORMAL?0:1]);var i=csv.MallProxy.getIns().getCfgById(e);shop.ShopModel.getIns().buyItem(shop.ShopModel.ENNUMS.NORMAL_SHOP,i,shop.ShopModel.getIns().getTimes(i))}};t.prototype.onSeeMoreHandler=function(){app.ViewManager.toggleDialog(h,1,0,[this.type])};t.prototype.onMoreBtnHandler=function(){if(this.playGoldBox.isPlaying){return}if(a.TreasureModel.getIns().getStatus(this.type,n.More,true)==a.E_PET_TREASURE_STATE.Normal){app.ProtocolRequest.TreasureHuntDrawReq(this.type,n.More)}};t.prototype.onOneHandler=function(){if(this.playGoldBox.isPlaying){return}if(a.TreasureModel.getIns().getStatus(this.type,n.One,true)==a.E_PET_TREASURE_STATE.Normal){app.ProtocolRequest.TreasureHuntDrawReq(this.type,n.One)}};t.prototype.msgRenderHander=function(t,e){var i=t.dataSource;var n=csv.TreasureProxy.getIns().treasureHuntMap[i.treasehuntid];var a=game.ItemUtil.parserList(n.item)[0];t.msg.y=5;t.msg.text=app.getLang("treasure_txt06",i.nick,a.getHTMLName(),a.count)};t.prototype.onFreeHander=function(){if(this.playGoldBox.isPlaying){return}if(!this.huntVo){return}var t=1;this.subTime=this.getSubTime();if(this.huntVo.freeRefreshTime==0||this.subTime<=0){app.ProtocolRequest.TreasureHuntRefreshReq(this.type,t)}else{var e=game.GridsModel.getIns().getItemCount(game.ItemUtil.ENUMS.YUANBAO);if(e<csv.TreasureProxy.getIns().freeGold){shop.ShopModel.getIns().askChongZhi()}else{t=2;app.ProtocolRequest.TreasureHuntRefreshReq(this.type,t)}}};t.prototype.awake=function(){a.TreasureModel.getIns().on(a.TreasureModel.EVENT_TREASURE_SUCCEED,this,this.onTreasureSucceedHandler);a.TreasureModel.getIns().on(a.TreasureModel.EVENT_HUNT_REFRESH,this,this.onHuntRefresh);a.TreasureModel.getIns().on(a.TreasureModel.EVENT_LINGQU_SUCCEED,this,this.onLingQuHandler);a.TreasureModel.getIns().on(a.TreasureModel.EVENT_INFO,this,this.onInfoHandler);game.GridsModel.getIns().on(game.GridsModel.EVENTS.UPDATE,this,this.onGridsUpdata)};t.prototype.onGridsUpdata=function(t){if(t==game.GridsModel.BAG_ITEM){this.updateMoney()}};t.prototype.sleep=function(){a.TreasureModel.getIns().off(a.TreasureModel.EVENT_TREASURE_SUCCEED,this,this.onTreasureSucceedHandler);a.TreasureModel.getIns().off(a.TreasureModel.EVENT_HUNT_REFRESH,this,this.onHuntRefresh);a.TreasureModel.getIns().off(a.TreasureModel.EVENT_LINGQU_SUCCEED,this,this.onLingQuHandler);a.TreasureModel.getIns().off(a.TreasureModel.EVENT_INFO,this,this.onInfoHandler);game.GridsModel.getIns().off(game.GridsModel.EVENTS.UPDATE,this,this.onGridsUpdata);Laya.timer.clear(this,this.updateTime);this.playGoldBox.reset();for(var t=0;t<this.goldList.length;t++){var e=this.goldList[t];e.empty()}};t.prototype.onLingQuHandler=function(t){if(this.type==t.type){this.onRefreshLuck()}};t.prototype.onHuntRefresh=function(t){if(this.type==t.type){this.refreshByHuntVo()}};t.prototype.onTreasureSucceedHandler=function(t){var e=t.id;var i=e[e.length-1];var n=csv.TreasureProxy.getIns().treasureHuntMap[i];if(!n){n=csv.TreasureProxy.getIns().treasureHuntMap[1];console.error("treasureHuntMap找不到配置!"+i)}this.updateMoney();this.playGoldBox.playEndByIndex(n.grid,new Laya.Handler(this,this.playEnd,[t,this.goldList[n.grid]]))};t.prototype.playEnd=function(t,e){e.skin.ani1.on(Laya.Event.COMPLETE,this,this.onAniEnd,[t,e]);e.skin.ani1.play(0)};t.prototype.onAniEnd=function(t,e){e.skin.ani1.off(Laya.Event.COMPLETE,this,this.onAniEnd);e.skin.ani1.stop();app.ViewManager.toggleDialog(l,1,0,t)};t.prototype.onInfoHandler=function(){this.refreshAll()};t.prototype.onShopMouseUpHandler=function(){app.ViewManager.toggleDialog(e,1,0)};t.prototype.getInfo=function(){this.init();this.onRefreshLuck();this.updateMoney();this.logRefresh();this.refreshByHuntVo()};t.prototype.refreshAll=function(){this.getInfo()};t.prototype.init=function(){for(var t=0;t<this.goldList.length;t++){var e=this.goldList[t];e.empty()}};t.prototype.onRefreshLuck=function(){if(this.data.vo&&this.data.vo.luckData&&this.data.vo.luckData.length>0){var t=csv.TreasureProxy.getIns().getMaxValue(this.type);var e=this.data.vo.luckData[0];this.skin.labelxingyunzhinum.text=e.curLuck.toString()+"/"+t;for(var i=0;i<this.boxList.length;i++){this.boxList[i].skin.visible=false}var n=this.skin.barxingyunzhi;var a=csv.TreasureProxy.getIns().getCfgListByType(this.type);for(var i=0;i<a.length;i++){var o=this.boxList[i];o.skin.visible=true;if(o){o.skin.visible=true;var s=a[i];o.refresh(e,s);if(this.isCounterpoise){var r=n.x+i*n.width/a.length;o.skin.x=r+o.skin.width}else{var r=n.x+n.width*s.luck/t;if(r<=n.x){o.skin.x=r+o.skin.width/2}else{o.skin.x=r}}}}if(this.isCounterpoise){n.value=csv.TreasureProxy.getIns().getProgress(this.type,e.curLuck)}else{n.value=e.curLuck/csv.TreasureProxy.getIns().getMaxValue(this.type)}}};t.prototype.refreshByHuntVo=function(){this.onRefreshHunt(this.huntVo);this.updateTime()};t.prototype.onRefreshHunt=function(t){var e=t.unitList||[];for(var i=0;i<this.goldList.length;i++){var n=this.goldList[i];if(e.length-1>=i){n.setData(e[i])}else{n.empty()}}};t.prototype.getSubTime=function(){return(this.huntVo.freeRefreshTime||0)-game.Context.getServerTime()};t.prototype.setFreeStatus=function(){this.skin.labelshuaxin01.text="";this.skin.labelshuaxin02.text="";this.skin.btnshuaxin.label=app.getLang("treasure_txt02")};t.prototype.updateTime=function(){this.subTime=this.getSubTime();if(this.huntVo.freeRefreshTime==0||this.huntVo.freeRefreshTime!=0&&this.subTime<=0){Laya.timer.clear(this,this.updateTime);this.setFreeStatus()}else{this.skin.labelshuaxin01.text=app.getLang("treasure_txt01");this.skin.labelshuaxin02.text=util.TimeUtil.formatTime(this.subTime);Laya.timer.once(1e3,this,this.updateTime);this.skin.btnshuaxin.label=app.getLang("treasure_txt03",csv.TreasureProxy.getIns().freeGold)}};t.prototype.updateMoney=function(){var t=game.Config.getParams(457).split(";")[this.type==a.E_PET_TREASURE.NORMAL?0:1];this.skin.itemmoney.parserIcon(t);var e=game.GridsModel.getIns().getItemCount(parseInt(t));this.skin.labelmoneynum.text=e.toString();this.skin.itemmoney01.parserIcon(t);this.skin.itemmoney02.parserIcon(t);this.skin.btnduobao01.label=app.getLang("treasure_txt05",1);this.skin.labelduobao01.text="1";this.updateMoneyColor(this.skin.labelduobao01,e,1);var i=game.Config.getParams(this.type==a.E_PET_TREASURE.NORMAL?455:456).split(";");this.skin.btnduobao02.label=app.getLang("treasure_txt05",i[1]);this.skin.labelduobao02.text=i[0];this.updateMoneyColor(this.skin.labelduobao02,e,parseInt(i[0]))};t.prototype.updateMoneyColor=function(t,e,i){if(e<i){t.color=game.STYLES.RED_COLOR_S}else{t.color=game.STYLES.GREEN_COLOR_S}};t.prototype.logRefresh=function(){a.TreasureModel.getIns().on(a.TreasureModel.EVENT_HUNT_RECORACK,this,this.onRecorackHandler);app.ProtocolRequest.TreasureHuntRecordReq(this.type);if(a.TreasureModel.DEBUG){a.TreasureModel.getIns().event(a.TreasureModel.EVENT_HUNT_RECORACK)}};t.prototype.onRecorackHandler=function(){var t=this.data.msg||[];this.skin.listchakangengduo.array=t.reverse();if(t.length>0){this.skin.listchakangengduo.scrollTo(t.length-1)}else{this.skin.listchakangengduo.scrollTo(0)}};return t}();a.TreasureNormalView=t})(treasure||(treasure={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var treasure;(function(a){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listyeqian.itemRender=ui.xingyunxunbao.xingyunxunbaoitem03UI;this.listyeqian.renderHandler=new Laya.Handler(this,this.onListYeQianHandler);this.listyeqian.selectEnable=true;this.listyeqian.selectHandler=new Laya.Handler(this,this.onSelectHandler);this.normal=new a.TreasureNormalView(this.fanjiexunbaoview,a.E_PET_TREASURE.NORMAL);this.super=new a.TreasureNormalView(this.xianjiexunbaoview,a.E_PET_TREASURE.SUPER);game.HelperViewHandler.register(csv.FunctionsProxy.ENUMS.TREASURE_NORMAL,[this.btnwenhao])};e.prototype.onListYeQianHandler=function(t,e){var i=t.dataSource;t.imgxianjiexunbao.skin=i.type==a.E_PET_TREASURE.NORMAL?"xingyunxunbao/bg_yeqian_fanjiexunbao_xuanzhong.png":"xingyunxunbao/bg_yeqian_xianjiexunbao_xuanzhong.png";t.btnxingyunxunbao.selected=i.select;if(i.red){game.RedDotView.addTo(t)}else{game.RedDotView.removeFrom(t)}};e.prototype.onDisplay=function(){a.TreasureModel.getIns().on(a.TreasureModel.EVENT_TREASURE_SUCCEED,this,this.onInfoHandler);a.TreasureModel.getIns().on(a.TreasureModel.EVENT_HUNT_REFRESH,this,this.onInfoHandler);a.TreasureModel.getIns().on(a.TreasureModel.EVENT_LINGQU_SUCCEED,this,this.onInfoHandler);a.TreasureModel.getIns().on(a.TreasureModel.EVENT_INFO,this,this.onInfoHandler);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){a.TreasureModel.getIns().selectIndex=0;this.listyeqian.selectedIndex=-1;this.normal.sleep();this.super.sleep();a.TreasureModel.getIns().off(a.TreasureModel.EVENT_TREASURE_SUCCEED,this,this.onInfoHandler);a.TreasureModel.getIns().off(a.TreasureModel.EVENT_HUNT_REFRESH,this,this.onInfoHandler);a.TreasureModel.getIns().off(a.TreasureModel.EVENT_LINGQU_SUCCEED,this,this.onInfoHandler);a.TreasureModel.getIns().off(a.TreasureModel.EVENT_INFO,this,this.onInfoHandler)};e.prototype.onInfoHandler=function(){this.onRefreshTabHandler()};e.prototype.refreshAll=function(){var t=[];var e=[csv.FunctionsProxy.ENUMS.TREASURE_NORMAL,csv.FunctionsProxy.ENUMS.TREASURE_SUPER];for(var i=0;i<e.length;i++){var n=e[i];if(csv.FunctionsProxy.getIns().isOpen(n)){t.push({type:a.TreasureModel.getIns().getFuncTypeByFid(n),select:i==0,red:false})}}this.list=t;this.listyeqian.array=t;this.normal.awake();this.super.awake();this.listyeqian.selectedIndex=a.TreasureModel.getIns().selectIndex;this.onRefreshTabHandler()};e.prototype.onRefreshTabHandler=function(){var t=a.TreasureModel.getIns();for(var e=0;e<this.list.length;e++){var i=this.list[e];i.red=t.hasLuckLingQu(i.type)||t.onCheckByType(i.type)}this.listyeqian.refresh()};e.prototype.getInfoCalback=function(t){t.refreshAll()};e.prototype.onSelectHandler=function(t){if(t==-1){return}for(var e=0;e<this.list.length;e++){if(e==t){this.list[e].select=true}else{this.list[e].select=false}}this.listyeqian.refresh();var i=null;if(this.list[t].type==a.E_PET_TREASURE.NORMAL){this.normal.skin.visible=true;this.super.skin.visible=false;this.normal.awake();this.super.sleep();i=this.normal}else{this.super.skin.visible=true;this.normal.skin.visible=false;this.normal.sleep();this.super.awake();i=this.super}a.TreasureModel.getIns().once(a.TreasureModel.EVENT_INFO,this,this.getInfoCalback,[i]);app.ProtocolRequest.TreasureHuntDataReq(i.type)};return e}(ui.xingyunxunbao.xingyunxunbaoUI);a.TreasureView=t})(treasure||(treasure={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var treasure;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.itemdaoju.gezibg.visible=false;this.itemdaoju.effect.visible=false};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){this.data=t;this.itemdaoju.setData(t.item)};e.prototype.resetView=function(){this.ywseleced.visible=false};e.SINGLE_KEY="shouchonghaoli.TurantableItem";return e}(ui.yunyinghuodong.choujianggeziitemUI);t.TurantableItem=e})(treasure||(treasure={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var treasure;(function(a){var t=function(n){__extends(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){n.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.activityTimeView=new activitytaren.ActivityTimeView(this.shuaxinlab2,new Laya.Handler(this,this.endTimeCallBack),"{0}",new Laya.Handler(this,this.updateHandler));this.turns=3;this.getted=[];this.items=[];this.awardGrids=[];this.historyAward=[];for(var t=0;t<16;t++){this.items.push(this["item"+t])}var e=csv.TreasureProxy.getIns().getHuntList(a.E_PET_TREASURE.TURNTABLE);SortUtil.sortOnArr(e,["grid"],[SortUtil.NUMERIC]);this.awards=e;for(var t=0;t<this.items.length;t++){this.items[t].setData(e[t])}this.anniu1.clickHandler=new Laya.Handler(this,this.onStart,[0]);this.anniu2.clickHandler=new Laya.Handler(this,this.onStart,[1]);this.xinxilist.itemRender=ui.yunyinghuodong.choujiangxinxiitemUI;this.xinxilist.renderHandler=new Laya.Handler(this,this.msgRenderHander);this.xinxilist.vScrollBarSkin=" ";this.gailvlab.on(Laya.Event.MOUSE_UP,this,this.onSeeMoreHandler);this.tiaoguo.clickHandler=new Laya.Handler(this,this.onCheckClick);this.anniu1.label=app.getLang("yunyinghuodong_choujiang_4",1);this.anniu2.label=app.getLang("yunyinghuodong_choujiang_4",10);var i=csv.ActivityTarenProxy.getIns().getCfgListByActivityID(60);this.costItemId=parseInt(i[0].p1.split("-")[0]);this.huobi3.parserIconByItemId(this.costItemId);this.yuanbao1.parserIconByItemId(this.costItemId);this.yuanbao2.parserIconByItemId(this.costItemId);this.huobishuzhi.text="";this.xinxilist.array=[]};t.prototype.endTimeCallBack=function(){this.hideSubTime()};t.prototype.updateHandler=function(t){var e=util.TimeUtil.sec2Str(t);this.shuaxinlab2.text=e};t.prototype.hideSubTime=function(){this.activityTimeView.stop();this.shuaxinlab2.text="";this.shuaxinlab1.visible=false};t.prototype.onSeeMoreHandler=function(){app.ViewManager.toggleDialog(a.ProbabilityForTurnTableView,1,0,[3])};t.prototype.onStart=function(t){if(this.play)return;this.resetView();var e=csv.ActivityTarenProxy.getIns().getCfgListByActivityID(60);if(t==0){if(game.GridsModel.getIns().hasEnoughItems(e[0].p1,false,true)){app.ProtocolRequest.ActDrawReq(this.actVo.cfgList[0].id,1)}}else{if(game.GridsModel.getIns().hasEnoughItems(e[0].p2,false,true)){app.ProtocolRequest.ActDrawReq(this.actVo.cfgList[0].id,2)}}};t.prototype.onDisplay=function(){a.TreasureModel.getIns().on(a.TreasureModel.TURNTABLE_LIST,this,this.onTurnTableResult);a.TreasureModel.getIns().on(a.TreasureModel.TURNTABLE_HISTORY,this,this.onRecorackHandler);a.TreasureModel.getIns().on(a.TreasureModel.TURNTABLE_COUNT,this,this.onTurnCountHandler);app.ProtocolRequest.ActDrawInfoReq(this.actVo.cfgList[0].id);this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){a.TreasureModel.getIns().off(a.TreasureModel.TURNTABLE_LIST,this,this.onTurnTableResult);a.TreasureModel.getIns().off(a.TreasureModel.TURNTABLE_HISTORY,this,this.onRecorackHandler);a.TreasureModel.getIns().off(a.TreasureModel.TURNTABLE_COUNT,this,this.onTurnCountHandler);if(this.play==false){this.historyAward=[]}this.play=false;Laya.timer.clearAll(this);this.hideSubTime()};t.prototype.getItemByGrid=function(t){var e="";for(var i=0;i<this.awards.length;i++){if(this.awards[i].grid==t){e=this.awards[i].item;break}}return e};t.prototype.onTurnTableResult=function(t,e){if(this.actVo.cfgList[0].id==t){this.awardGrids=e;this.historyAward=[];for(var i=0;i<e.length;i++){this.historyAward.push(e[i])}if(this.tiaoguo.selected){this.showAward(e);app.ProtocolRequest.ActDrawInfoReq(this.actVo.cfgList[0].id)}else{this.getted=[];this.startTurn(0)}this.huobishuzhi.text=game.MoneyModel.format(game.GridsModel.getIns().getItemCount(this.costItemId));this.updateMoney()}};t.prototype.showAward=function(t){var e=[];for(var i=0;i<t.length;i++){e.push(this.getItemByGrid(t[i]))}app.ViewManager.toggleDialog(a.ItemShowView,1,0,e)};t.prototype.startTurn=function(t){if(this.awardGrids.length>0){this.cur=0;this.result=this.awardGrids.shift();if(this.result-6<0){this.count=(this.turns+1)*this.items.length+this.result-t-1}else{this.count=this.turns*this.items.length+this.result-t-1}this.nowCount=0;this.i=t;this.play=true;this.speed=20;this.doPlaying()}};t.prototype.refreshAll=function(){this.resetView();this.tiaoguo.selected=false;this.huobishuzhi.text=game.MoneyModel.format(game.GridsModel.getIns().getItemCount(this.costItemId));this.shuaxinlab1.visible=true;this.activityTimeView.start(this.actVo.timeVo.endTime);this.updateMoney();if(this.historyAward.length>0){this.showAward(this.historyAward)}};t.prototype.updateMoney=function(){var t=csv.ActivityTarenProxy.getIns().getCfgListByActivityID(60);game.ComMiniIcon.getIns().parserIcon(t[0].p1,this.jiage1,"",true);game.ComMiniIcon.getIns().parserIcon(t[0].p2,this.jiage2,"",true)};t.prototype.resetView=function(){for(var t=0;t<this.items.length;t++){this.items[t].resetView()}};t.prototype.onCheckClick=function(){if(this.tiaoguo.selected){}};t.prototype.showResult=function(){this.play=false;this.getted.push(this.result);this.items[this.result-1].ywseleced.visible=true;if(this.awardGrids.length>0){this.startTurn(this.result-1)}else{this.showAward(this.getted);this.getted=[];app.ProtocolRequest.ActDrawInfoReq(this.actVo.cfgList[0].id)}};t.prototype.doPlaying=function(){if(this.nowCount>this.count){Laya.timer.once(500,this,this.showResult)}else{this.nowCount+=1;if(this.i>15){this.cur+=1;if(this.cur==this.turns&&0==this.result-6){this.speed=300}this.i=0;this.items[this.i].ywseleced.visible=true;if(this.getted.indexOf(this.i-1+1)==-1){this.items[this.items.length-1].ywseleced.visible=false}}else{if(this.cur==this.turns){var t=this.result-6;if(t>=0){if(this.i==t){this.speed=300}}else{if(this.i==15+t){this.speed=300}}}this.items[this.i].ywseleced.visible=true;if(this.i>0&&this.getted.indexOf(this.i-1+1)==-1){this.items[this.i-1].ywseleced.visible=false}}this.i+=1;Laya.timer.once(this.speed,this,this.doPlaying)}};t.prototype.msgRenderHander=function(t){var e=t.dataSource;var i=e.name;if(Uint64.equal(game.Context.mainRoleId,e.uid)){i=app.getLang("treasure_txt10")}var n=game.ItemUtil.createVO(e.itemid);t.msg.text=app.getLang("treasure_txt06",i,n.getHTMLName(),e.num)};t.prototype.onRecorackHandler=function(t,e){if(this.actVo.cfgList[0].id==t){this.xinxilist.array=e;if(e.length>0){this.xinxilist.scrollTo(e.length-1)}else{this.xinxilist.scrollTo(0)}}};t.prototype.onTurnCountHandler=function(t,e){if(this.actVo.cfgList[0].id==t){var i=csv.ActivityTarenProxy.getIns().getCfgListByActivityID(60);this.yichoujianglab.text=app.getLang("treasure_txt15",e)}};t.SINGLE_KEY="treasure.TurantableView";return t}(ui.yunyinghuodong.choujiangviewUI);a.TurantableView=t})(treasure||(treasure={}));var treasure;(function(t){var e=function(){function t(){}return t}();t.TreasurePetVO=e})(treasure||(treasure={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var verifiedcode;(function(n){var t;(function(t){t[t["Disable"]=0]="Disable";t[t["Enable"]=1]="Enable"})(t=n.IAutuwnType||(n.IAutuwnType={}));var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){app.ViewManager.regist(n.VerfiedRewardView,"shimingrenzheng.atlas","huolangtehui.atlas");app.ViewManager.regist(n.VerfiedRegView,"shimingrenzheng.atlas");csv.MainIconProxy.registCustomOpen(53,this,this.onOpenCheck);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.FANGCHENMI_AWARD,n.VerfiedRewardView);game.ClosureManager.registClosure(csv.FunctionsProxy.ENUMS.FANGCHENMI_AWARD.toString(),new Laya.Handler(this,this.onClosureHandler))};e.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.IdentityAuthDataNoti,this,this.onIdentityAuthDataNoti);this.addMsgListener(app.ProtocolResponse.RecvIdentityPrizeResp,this,this.onRecvIdentityPrizeResp);this.addMsgListener(app.ProtocolResponse.IdentityAuthTimeNoti,this,this.onIdentityAuthTimeNoti);this.addMsgListener(app.ProtocolResponse.IdentityAuthKickNoti,this,this.onIdentityAuthKickNoti);this.addMsgListener(app.ProtocolResponse.RechargeInfoNtf,this,this.onRechargeInfoNtf)};e.prototype.onOpenCheck=function(){if(n.VerifiedModel.getIns().autuwn==n.IAutuwnType.Disable){return false}if(!n.VerifiedModel.getIns().verified){return false}if(n.VerifiedModel.getIns().verified.prize){return false}return true};e.prototype.onClosureHandler=function(){app.ViewManager.toggleDialog(n.VerfiedRewardView,1,0)};e.prototype.onIdentityAuthDataNoti=function(t,e){n.VerifiedModel.getIns().autuwn=e.authwn;n.VerifiedModel.getIns().verified=e;if(e.auth==0&&n.VerifiedModel.getIns().autuwn==n.IAutuwnType.Disable){n.VerfiedRegView.onTiYanHandler()}app.SDK.call_certification(true);n.VerifiedModel.getIns().event(n.VerifiedModel.EVENTS.IdentityAuthDataNoti)};e.prototype.onRecvIdentityPrizeResp=function(t,e){if(e.ret){n.VerifiedModel.getIns().verified.prize=1;csv.MainIconProxy.getIns().refreshListById(53);n.VerifiedModel.getIns().event(n.VerifiedModel.EVENTS.IdentityAuthDataNoti);app.ViewManager.toggleDialog(n.VerfiedRewardView,-1)}};e.prototype.onIdentityAuthTimeNoti=function(t,e){if(e.type==0||e.type==1||e.type==2||e.type==3||e.type==4){game.Alert.show(app.getLang("fangchenmi_tips2",Math.floor(e.minute/60)),new Laya.Handler(this,function(){if(e.type==4){n.VerfiedRegView.openVerFiedRegViewEnter(1,0,4)}else{if(n.VerifiedModel.getIns().verified.auth!=1){n.VerfiedRegView.openVerFiedRegViewEnter(1,0)}}}),app.EMPTY_HANDLER,0,"")}else{if(n.VerifiedModel.getIns().autuwn==n.IAutuwnType.Disable){}else{game.Alert.show(app.getLang("fangchenmi_tips3"),new Laya.Handler(this,function(){app.ViewManager.toggleDialog(n.VerfiedRegView,1,0)}),null,0,"")}}};e.prototype.exitGame=function(){app.SDK.logout()};e.prototype.onIdentityAuthKickNoti=function(t,e){n.VerfiedRegView.openVerFiedRegViewEnter(-1,0);var i="";if(e.type==0){i=app.getLang("fangchenmi_uitips5")}else if(e.type==1){i=app.getLang("fangchenmi_uitips6")}else if(e.type==2){i=app.getLang("fangchenmi_uitips7")}else if(e.type==3){i=app.getLang("fangchenmi_uitips8")}else if(e.type==4){i=app.getLang("fangchenmi_uitips12")}n.VerifiedModel.getIns().offLine=true;app.Protocol.stopConnect();app.AppContainer.uiLayer.visible=false;manager.LoadingManager.instance.removeGameLoading("onIdentityAuthKickNoti");game.Alert.show(i,new Laya.Handler(this,this.exitGame),new Laya.Handler(this,this.exitGame));console.log(">>>>>>>>>> onIdentityAuthKickNoti: type = ",e.type,Laya.timer.currTimer)};e.prototype.onRechargeInfoNtf=function(t,e){game.Context.total_recharge=e.total_recharge;bag.BagModel.getIns().updataDaojuRed()};e.SINGLE_KEY="verifiedcode.VerifiedModule";return e}(app.ModuleBase);n.VerifiedModule=e})(verifiedcode||(verifiedcode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var verifiedcode;(function(t){var e=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.platformNameRet=1;t.autuwn=0;t.offLine=false;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.init=function(){this.isVerifiedHandle=false};t.SINGLE_KEY="verifiedcode.VerifiedModel";t.EVENTS={};return t}(app.ModelBase);t.VerifiedModel=e})(verifiedcode||(verifiedcode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var verifiedcode;(function(a){var t=function(t){__extends(n,t);function n(){return t!==null&&t.apply(this,arguments)||this}n.getIns=function(){return app.Singleton.getInstance(n)};n.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.tijiaorenzhengbtn.clickHandler=new Laya.Handler(this,this.onClick);this.youketiyanbtn.clickHandler=new Laya.Handler(this,this.onClickTouristsBtn);this.labelxingming.on(Laya.Event.FOCUS,this,this.onFFocus);this.labelshenfenzheng.on(Laya.Event.FOCUS,this,this.onFFocus)};n.prototype.onFFocus=function(t){t.text="";t.off(Laya.Event.FOCUS,this,this.onFFocus)};n.prototype.onDisplay=function(){this.callLater(this.refreshAll)};n.prototype.onUnDisplay=function(){if(a.VerifiedModel.getIns().verified.auth==0){this.onClickTouristsBtn()}};n.prototype.refreshAll=function(){this.labelxingming.text="";this.labelshenfenzheng.text="";this.labelxingming.prompt=app.getLang("fangchenmi_3");this.labelshenfenzheng.prompt=app.getLang("fangchenmi_4")};n.prototype.onClick=function(){if(this.labelxingming.text==""){manager.FlowManager.instance.flowByStyle1(app.getLang("fangchenmi_uitips1"));return}if(!n.idcardReg.test(this.labelshenfenzheng.text)){manager.FlowManager.instance.flowByStyle1(app.getLang("fangchenmi_uitips2"));return}var t=this.labelshenfenzheng.text.substr(6,8);ent.GmDebug.getIns().cmd("auth "+t);a.VerifiedModel.getIns().verified.auth=1;n.openVerFiedRegViewEnter(-1)};n.prototype.onClickTouristsBtn=function(){if(this.dataSource==4){game.Alert.show02(app.getLang("fangchenmi_2"),new Laya.Handler(this,n.onRenZhengHandler),new Laya.Handler(this,this.onOfflineHandler),0,"","立即下线","fangchenmi_5")}else{game.Alert.show02(app.getLang("fangchenmi_2"),new Laya.Handler(this,n.onRenZhengHandler),new Laya.Handler(this,n.onTiYanHandler),0,"","fangchenmi_9","fangchenmi_5")}n.openVerFiedRegViewEnter(-1)};n.prototype.onOfflineHandler=function(){app.ProtocolRequest.CanelAuthReq()};n.onTiYanHandler=function(){app.ProtocolRequest.VisitorModelReq();a.VerifiedModel.getIns().verified.auth=2;a.VerifiedModel.getIns().isVerifiedHandle=true};n.onRenZhengHandler=function(){n.openVerFiedRegViewEnter(1);a.VerifiedModel.getIns().isVerifiedHandle=true};n.openVerFiedRegViewEnter=function(t,e,i){if(e===void 0){e=1}if(a.VerifiedModel.getIns().autuwn==a.IAutuwnType.Disable){}else{app.ViewManager.toggleDialog(n,t,e,i)}};n.SINGLE_KEY="verifiedcode.VerfiedRegView";n.idcardReg=/^[1-9]\d{7}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}$|^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}([0-9]|X)$/;return n}(ui.shimingrenzheng.shimingrenzhengUI);a.VerfiedRegView=t})(verifiedcode||(verifiedcode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var verifiedcode;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listdaoju.itemRender=grids.GridView;this.listdaoju.renderHandler=grids.GridView.CommonItemRender;this.listdaoju.array=game.ItemUtil.parserList(game.Config.getParams(513));this.btnlingqu.clickHandler=new Laya.Handler(this,this.onClickHandler);this.btnrenzheng.clickHandler=new Laya.Handler(this,this.onClickHandler2)};e.prototype.onDisplay=function(){guide.GuideModel.getIns().boOpen=false;this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){guide.GuideModel.getIns().boOpen=true};e.prototype.refreshAll=function(){if(i.VerifiedModel.getIns().verified.auth==1){this.btnrenzheng.visible=false;if(i.VerifiedModel.getIns().verified.prize==0){this.btnlingqu.visible=true}}else{this.btnrenzheng.visible=true;this.btnlingqu.visible=false}};e.prototype.onClickHandler=function(){app.ProtocolRequest.RecvIdentityPrizeReq()};e.prototype.onClickHandler2=function(){i.VerfiedRegView.openVerFiedRegViewEnter(1)};e.SINGLE_KEY="verifiedcode.VerfiedRewardView";return e}(ui.shimingrenzheng.renzhengviewUI);i.VerfiedRewardView=t})(verifiedcode||(verifiedcode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var vipcode;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){app.ViewManager.regist(i.VipView,"vip.atlas","res/static/vip/btn_close_huodong.png");game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.VIP,i.VipView,null,0)};e.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.VipDataAck,this,this.onVipDataAck);this.addMsgListener(app.ProtocolResponse.VipUseitemAck,this,this.onVipUseitemAck);i.VipModel.getIns().on(i.VipEvent.VIP_CHANGE,this,this.onRedDotChange);csv.FunctionsProxy.getIns().on(csv.FunctionsProxy.EVENTS.CHANGE,this,this.onRedDotChange);game.GridsModel.getIns().on(game.GridsModel.EVENTS.UPDATE,this,this.onRedDotChange)};e.prototype.onVipDataAck=function(t,e){i.VipModel.getIns().dellVip(e.vipData[0],e.vipMall)};e.prototype.onVipUseitemAck=function(t,e){if(e.success==1){}};e.prototype.onRedDotChange=function(){Laya.timer.callLater(this,this.onUpdateRedDot)};e.prototype.onUpdateRedDot=function(){i.VipModel.getIns().updataVipRed()};e.SINGLE_KEY="vipcode.VipModule";return e}(app.ModuleBase);i.VipModule=t})(vipcode||(vipcode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var vipcode;(function(t){var e=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.vipLvl=0;t.vipExp=0;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.init=function(){};t.prototype.dellVip=function(t,e){var i=t.lv>this.vipLvl;this.vipLvl=t.lv;this.vipExp=t.exp.toNumber();this.vipMall=e;this.event(n.VIP_CHANGE,[i])};t.prototype.canGet=function(t){var e=true;for(var i in this.vipMall){if(this.vipMall[i].mallID==t&&this.vipMall[i].buyCount>=1){e=false;break}}return e};t.prototype.maxExp=function(t){if(t===void 0){t=0}var e=csv.VipProxy.getIns().getCfg(this.vipLvl+1);if(t>0){e=csv.VipProxy.getIns().getCfg(t)}return e?e.exp:0};t.prototype.isMaxLevel=function(){var t=csv.VipProxy.getIns().getArr();var e=t[t.length-1];return this.vipLvl>=e.level};t.prototype.updataVipRed=function(){var t=false;if(this.vipLvl>0){for(var e=1;e<=this.vipLvl;e++){var i=csv.VipProxy.getIns().getCfg(e);t=this.canGet(i.vipgift);if(t){break}}}if(t){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.VIP)}else{game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.VIP)}return t};t.prototype.getAutoInspireTime=function(t){var e=Laya.LocalStorage.getItem(game.AccountModel.accountId+"_auto_inspire_time"+t);if(e&&e!=""){return parseInt(e)}return 5};t.prototype.setAutoInspireTime=function(t,e){Laya.LocalStorage.setItem(game.AccountModel.accountId+"_auto_inspire_time"+t,e.toString())};t.prototype.getAutoInspireYb=function(t){var e=Laya.LocalStorage.getItem(game.AccountModel.accountId+"_auto_inspire_yb"+t);if(e&&e!=""){return true}return false};t.prototype.setAutoInspireYb=function(t,e){if(e){Laya.LocalStorage.setItem(game.AccountModel.accountId+"_auto_inspire_yb"+t,"1")}else{Laya.LocalStorage.removeItem(game.AccountModel.accountId+"_auto_inspire_yb"+t)}};t.prototype.getAutoInspire=function(t){var e=Laya.LocalStorage.getItem(game.AccountModel.accountId+"_auto_inspire"+t);if(e&&e!=""){return true}return false};t.prototype.setAutoInspire=function(t,e){if(e){Laya.LocalStorage.setItem(game.AccountModel.accountId+"_auto_inspire"+t,"1")}else{Laya.LocalStorage.removeItem(game.AccountModel.accountId+"_auto_inspire"+t)}};t.SINGLE_KEY="vipcode.VipModel";t.PARAM_58=58;t.PARAM_59=59;t.PARAM_60=60;t.PARAM_61=61;t.PARAM_62=62;return t}(app.ModelBase);t.VipModel=e;var n=function(){function t(){}t.VIP_CHANGE="vip_change";return t}();t.VipEvent=n})(vipcode||(vipcode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e;(function(t){t[t["GUAJI_TIME_LIMIT"]=1]="GUAJI_TIME_LIMIT";t[t["GUAJI_EXT_EXP"]=2]="GUAJI_EXT_EXP";t[t["MIJING"]=3]="MIJING";t[t["BAG_COUNT"]=4]="BAG_COUNT";t[t["JJC_TIME"]=5]="JJC_TIME";t[t["BOSS_CAVE_TIME"]=6]="BOSS_CAVE_TIME";t[t["MOUNTAIN_TIME"]=7]="MOUNTAIN_TIME";t[t["GUILD_BUILD_TIME"]=8]="GUILD_BUILD_TIME";t[t["GARDEN_WATER_TIME"]=9]="GARDEN_WATER_TIME";t[t["QUICK_GUAJI_TIME"]=10]="QUICK_GUAJI_TIME";t[t["SSSL_TIME"]=11]="SSSL_TIME";t[t["SSJD_TIME"]=12]="SSJD_TIME";t[t["DONGFU"]=13]="DONGFU";t[t["TITLE_EXR"]=14]="TITLE_EXR";t[t["DONGFU_EXR"]=15]="DONGFU_EXR";t[t["MIJING_TIME_LIMIT"]=16]="MIJING_TIME_LIMIT";t[t["BATTLE_SPEED"]=17]="BATTLE_SPEED";t[t["CHART"]=18]="CHART";t[t["BATTLE_PASS"]=19]="BATTLE_PASS";t[t["REDPACK"]=20]="REDPACK";t[t["BOSSMONSTERBOOK"]=21]="BOSSMONSTERBOOK"})(e=t.PRI_TYPE||(t.PRI_TYPE={}));var i=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("vip.csv");this.cfgMap=t.getMap("level");this.cfgArr=t.getArray();this.maxVip=this.cfgArr[this.cfgArr.length-1].level;var e=app.Config.getResById("vippri.csv");this.priMap=e.getMap("type");this.priArr=e.getArray()};e.prototype.getCfg=function(t){return this.cfgMap[t]};e.prototype.getArr=function(){return this.cfgArr};e.prototype.getPriCount=function(){return this.priArr.length};e.prototype.getVipPri=function(t,e){var i=0;var n=this.priMap[t];if(n&&n["vip"+e]){i=parseInt(n["vip"+e]);if(n.resclient==1){i*=1e-4}}return i};e.prototype.getVipPriCfg=function(t){return this.priMap[t]};e.prototype.getVipList=function(t,e){var i=0;var n=this.priMap[t];if(n&&n["vip"+e]){i=parseInt(n["vip"+e]);if(i>0){return{type:n.type,order:n.order,desc:n.res,value:i,resclient:n.resclient,show:n.show}}}return null};e.prototype.getOpenLevel=function(t,e){var i=this.priMap[t];var n=0;if(i){var a=this.cfgArr.length;for(var o=0;o<a;o++){if(i["vip"+o]==e){n=o;break}}}return n};e.SINGLE_KEY="csv.VipProxy";return e}(app.ModelBase);t.VipProxy=i})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var vipcode;(function(l){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t,e,i){var n=l.VipModel.getIns().vipLvl;var a=game.STYLES.VIP_COLOR;var o=game.STYLES.VIP_COLOR;game.RedDotView.removeFrom(this);var s=t.value+"";if(t.resclient>0){s=t.value*.01+"%"}else if(t.type==15){s=app.getLang("xiulian_dongfuname_"+t.value)}else if(t.type==14){var r=csv.TitleProxy.getIns().getCfg(t.value);s=app.getLang(r.name)}else if(t.value==999){s=app.getLang("无限制")}if(t.isAdd){a=game.STYLES.GREEN_COLOR_S;o=game.STYLES.GREEN_COLOR_S}else if(t.valueChange){o=game.STYLES.GREEN_COLOR_S}this.labeltequan.text=app.getLang(t.desc,a,o,s);if(t.isAdd){game.RedDotView.addTo(this,this.labeltequan.x+this.labeltequan.contextWidth+40,5,.9,.9,game.RedDotView.ENUM_TYPE.XIN)}};e.SINGLE_KEY="vip.VipItem";return e}(ui.vip.vipnewitemUI);l.VipItem=t})(vipcode||(vipcode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var vipcode;(function(g){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.fullScreen="fullScreen";t._showLev=0;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=g.VipModel.getIns();this.listtequan.itemRender=g.VipItem;this.listtequan.renderHandler=new Laya.Handler(this,this.onVipItemRender);this.listtequan.scrollRectOffY=10;this.listviplibao.itemRender=grids.GridView;this.listviplibao.renderHandler=new Laya.Handler(this,this.onGiftItemRender);this.btnleft.clickHandler=new Laya.Handler(this,this.onLeft);this.btnright.clickHandler=new Laya.Handler(this,this.onRight);this.btnchongzhi.clickHandler=new Laya.Handler(this,this.onBtnchongzhi);this.btnchongzhi.visible=true;this.btngoumai.clickHandler=new Laya.Handler(this,this.buyItem);this.btntianmingchi.clickHandler=new Laya.Handler(this,this.openFateView);this.ani1.interval=24;this.clipvipnum.value="";this.clipvip.value="";this.clipvip01.value=""};t.prototype.buyItem=function(){var t=csv.VipProxy.getIns().getCfg(this._showLev);var e=csv.MallProxy.getIns().getCfgByID(shop.ShopModel.ENNUMS.VIP_SHOP,parseInt(t.vipgift));var i=g.VipModel.getIns().canGet(parseInt(t.vipgift));if(i){if(g.VipModel.getIns().vipLvl>=this._showLev){if(game.GridsModel.getIns().hasEnoughItems(e.trueprice,false,true)){var n=game.ItemUtil.parserList(e.trueprice)[0];var a=game.ItemUtil.createVO(e.item);game.Alert.show(app.getLang("family_102_1",n.getItemId(),n.count,a.getName()),new Laya.Handler(shop.ShopModel.getIns(),shop.ShopModel.getIns().buy,[e,1]),new Laya.Handler)}}else{manager.FlowManager.instance.flowByStyle1(app.getLang("vip_limit"))}}};t.prototype.onBtnchongzhi=function(){if(csv.FunctionsProxy.getIns().isOpen(csv.FunctionsProxy.ENUMS.NEW_SHANG_CHENG,true)){if(game.SystemSetModel.getInstance().settingData.data[game.SettingType.vipGotoBtn]==0){game.SystemSetModel.getInstance().setValueByType(1,game.SettingType.vipGotoBtn);game.RedDotView.removeFrom(this.btnchongzhi)}app.ViewManager.toggleDialog(g.VipView,-1,0);game.ClosureManager.callFunction(csv.FunctionsProxy.ENUMS.CHONGZHI_SHOP)}};t.prototype.onLeft=function(){if(this._showLev>1){--this._showLev;this.updataVipAward();this.updateExp()}};t.prototype.onRight=function(){var t=this.getMaxVip();if(this._showLev<t){var e=csv.VipProxy.getIns().getCfg(this._showLev+1);if(g.VipModel.getIns().vipLvl>=e.show_level){++this._showLev;this.updataVipAward();this.updateExp()}}};t.prototype.onGiftItemRender=function(t){t.setData(t.dataSource);t.scaleX=.9;t.scaleY=.9};t.prototype.onVipItemRender=function(t,e){t.setData(t.dataSource,e,this._showLev)};t.prototype.onDisplay=function(){this.ani1.gotoAndStop(0);guide.GuideModel.getIns().boOpen=false;this.ani1.play(0,false);app.ViewManager.showDialogMask();this._model.on(g.VipEvent.VIP_CHANGE,this,this.onVipChange);game.RoleModel.getIns().on(game.RoleModel.EVENTS.KUAI_TIAN,this,this.onKuaTianClear);this.callLater(this.refreshAll);this.onBtnReddot();this._initFateBanner()};t.prototype._initFateBanner=function(){var t=fatepool.FatePoolModel.getIns().getNowFateItem();this.imgname.skin=t.cfg.vipentrancename+".jpg";this.imgfabao.skin=t.cfg.show+".png";var e=fatepool.FatePoolModel.getIns().netData?fatepool.FatePoolModel.getIns().netData.fatePoint:0;this.barfabao.value=e/+t.cfg.limit;this.labelfabaojindu.text=e+"/"+t.cfg.limit;var i=+t.cfg.limit-e<=0?0:+t.cfg.limit-e;if(fatepool.FatePoolModel.getIns().isHaveFateItem(fatepool.FatePoolModel.getIns().netData.curStage)){this.labelkehuode01.text=app.getLang("fatename_tishi_4")}else{this.labelkehuode01.text="再获得"+i+"天命值可得"}this.animationfabao.play(0,true)};t.prototype.openFateView=function(){app.ViewManager.toggleDialog(g.VipView,-1,0);game.ClosureManager.callFunction(csv.FunctionsProxy.ENUMS.FATE_POOL)};t.prototype.onBtnReddot=function(){game.RedDotView.removeFrom(this.btnchongzhi);if(csv.FunctionsProxy.getIns().isOpen(csv.FunctionsProxy.ENUMS.NEW_SHANG_CHENG,false)&&game.SystemSetModel.getInstance().settingData.data[game.SettingType.vipGotoBtn]==0){game.RedDotView.addTo(this.btnchongzhi,150,-5)}};t.prototype.onUnDisplay=function(){guide.GuideModel.getIns().boOpen=true;app.ViewManager.closeDialogMask();this._model.off(g.VipEvent.VIP_CHANGE,this,this.onVipChange);game.RoleModel.getIns().off(game.RoleModel.EVENTS.KUAI_TIAN,this,this.onKuaTianClear)};t.prototype.onKuaTianClear=function(){game.SystemSetModel.getInstance().setValueByType(0,game.SettingType.vipGotoBtn);this.onBtnReddot()};t.prototype.refreshAll=function(){if(this._model.isMaxLevel()){this._showLev=this._model.vipLvl}else{this._showLev=this._model.vipLvl+1}this.updateExp();this.updataVipAward()};t.prototype.onVipChange=function(){this.updateExp();this.updataVipAward()};t.prototype.updateBanner=function(){var t=csv.VipProxy.getIns().getCfg(this._showLev)};t.prototype.updateExp=function(){var t=parseInt(game.Config.getParams(g.VipModel.PARAM_62));var e=this._model.maxExp()/t;if(this._showLev>g.VipModel.getIns().vipLvl){e=this._model.maxExp(this._showLev)/t}var i=this._model.vipExp/t;if(e>0){this.clipmoney.value=e-i+"";this.barvip.value=i/e;this.labelvipnum.text=i+"/"+e}else{var n=csv.VipProxy.getIns().getArr();var a=n[n.length-1];var o=csv.VipProxy.getIns().getCfg(a.level);this.barvip.value=1;this.labelvipnum.text=i+"/"+o.exp/t}if(this._model.isMaxLevel()){this.clipvip.value=this._model.vipLvl+"";this.clipvipnum.value=this._model.vipLvl+"";this.boxvip.visible=false}else{this.clipvip.value=this._model.vipLvl==0?"1":this._model.vipLvl+"";if(this._showLev>g.VipModel.getIns().vipLvl){this.clipvipnum.value=this._showLev+""}else{this.clipvipnum.value=this._model.vipLvl+1+""}this.boxvip.visible=true}};t.prototype.getMaxVip=function(){return csv.VipProxy.getIns().maxVip};t.prototype.updataVipAward=function(){this.updateBanner();this.clipvip01.value=this._showLev.toString();var t=this.getMaxVip();if(this._showLev==1){this.btnleft.disabled=true;this.btnright.disabled=false}else if(this._showLev==t){this.btnleft.disabled=false;this.btnright.disabled=true}else{this.btnleft.disabled=false;var e=csv.VipProxy.getIns().getCfg(this._showLev+1);if(g.VipModel.getIns().vipLvl>=e.show_level){this.btnright.disabled=false}else{this.btnright.disabled=true}}this.getbtnArrowRed();var i=[];var n=csv.VipProxy.getIns().getPriCount();for(var a=1;a<=n;a++){var o=false;var s=false;var r=0;var e=csv.VipProxy.getIns().getVipList(a,this._showLev-1);if(!e){o=true}else{r=e.value}e=csv.VipProxy.getIns().getVipList(a,this._showLev);if(e&&e.show==1){e.isAdd=o;if(r>0&&e.value-r>0){s=true}e.valueChange=s;i.push(e)}}i.sort(this.sortVip);this.listtequan.array=i;var l=csv.VipProxy.getIns().getCfg(this._showLev);var h=parseInt(l.vipgift);if(h>0){var p=csv.MallProxy.getIns().getItemCfgById(h);var u=game.ItemUtil.parserList(p.showitem);this.listviplibao.array=u;this.setGold(p.trueprice,this.labelmoneynum01,this.itemmoney01);this.setGold(p.showprice,this.labelmoneynum02,this.itemmoney02);game.RedDotView.removeFrom(this.btngoumai);this.imgyishouqing.visible=false;this.btngoumai.disabled=true;if(g.VipModel.getIns().vipLvl>=this._showLev){var c=g.VipModel.getIns().canGet(h);this.imgyishouqing.visible=!c;this.btngoumai.disabled=!c;if(c){game.RedDotView.addTo(this.btngoumai)}}}else{this.listviplibao.array=[]}};t.prototype.getbtnArrowRed=function(){game.RedDotView.removeFrom(this.btnleft);game.RedDotView.removeFrom(this.btnright);var t=g.VipModel.getIns().vipLvl;var e=false;var i=false;for(var n=1;n<=t;n++){var a=csv.VipProxy.getIns().getCfg(n).vipgift;var o=g.VipModel.getIns().canGet(a);if(o){if(!e&&n<this._showLev){e=true}else if(!i&&n>this._showLev){i=true}}}if(e){game.RedDotView.addTo(this.btnleft)}if(i){game.RedDotView.addTo(this.btnright)}};t.prototype.setGold=function(t,e,i){i.parserIcon(t,e)};t.prototype.sortVip=function(t,e){if(t.isAdd&&!e.isAdd)return-1;if(!t.isAdd&&e.isAdd)return 1;if(t.valueChange&&!e.valueChange)return-1;if(!t.valueChange&&e.valueChange)return 1;if(t.order<e.order)return-1;if(t.order>e.order)return 1;if(t.type<e.type)return-1;if(t.type>e.type)return 1;return 0};t.SINGLE_KEY="vipcode.VipView";return t}(ui.vip.vipnewview01UI);g.VipView=t})(vipcode||(vipcode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var waixiantegou;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){app.ViewManager.regist(i.WaiXianTeGouMainView,"waixiantegou.atlas","shangcheng.atlas");app.ViewManager.regist(i.WaiXianTeGouPhoenixMainView,"waixiantegou.atlas","shangcheng.atlas");game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.TEGOU,i.WaiXianTeGouMainView,null,0);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.TEGOU_PHOENIX,i.WaiXianTeGouPhoenixMainView,null,0)};e.prototype.initCommands=function(){};e.SINGLE_KEY="waixiantegou.WaiXianTeGouModule";return e}(app.ModuleBase);i.WaiXianTeGouModule=t})(waixiantegou||(waixiantegou={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var waixiantegou;(function(t){var e=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.iconTime=-1;t.functionId=103;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.init=function(){};t.prototype.isActOpen=function(t){if(activitytaren.ActivityTaRenModel.getIns().getActivityID_By_functionid(t)){return true}return false};t.SINGLE_KEY="waixiantegou.WaiXianTeGouModel";return t}(app.ModelBase);t.WaiXianTeGouModel=e})(waixiantegou||(waixiantegou={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){this.initActivityTaRen()};e.prototype.initActivityTaRen=function(){var t=app.Config.getResById("activity_taren.csv");this._activityTaRenMap=t.getMap("id");this._activityTaRenArr=t.getArray()};e.prototype.getActivityTaRenMapCell=function(t){return this._activityTaRenMap[t]};e.prototype.getActivityTaRenArr=function(){return this._activityTaRenArr};e.SINGLE_KEY="csv.WaiXianTeGouProxy";return e}(app.ModelBase);t.WaiXianTeGouProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var waixiantegou;(function(a){var t=function(n){__extends(t,n);function t(t,e){if(e===void 0){e=main.IconListBase.SIZE}var i=n.call(this,t)||this;i.width=125;i._modle=a.WaiXianTeGouModel.getIns();i.init();return i}t.prototype.init=function(){var t=this;this.setTimeLabel(105);this.activityTimeView=new activitytaren.ActivityTimeView(this.lblTime,new Laya.Handler(this,function(){t.activityTimeView.stop()}),"{0}",null,2);var e=activitytaren.ActivityTaRenModel.getIns().getActivityID_By_functionid(this._modle.functionId);this.activityTimeView.start(e.timeVo.endTime)};t.prototype.updateTime=function(){this.activityTimeView.start(this._modle.iconTime)};return t}(main.MainUIIcon);a.TeGouIcon=t})(waixiantegou||(waixiantegou={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var waixiantegou;(function(e){var t=function(t){__extends(o,t);function o(){return t!==null&&t.apply(this,arguments)||this}o.getIns=function(){return app.Singleton.getInstance(o)};o.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=e.WaiXianTeGouModel.getIns();this.activityTimeView=new activitytaren.ActivityTimeView(this.labelmiaoshu5,new Laya.Handler(this,this.endTimeCallBack),"{0}");this._mountAvatar=new avatar.AvatarAnimation;this.imgzuoqi.y=566;this.imgzuoqi.addChild(this._mountAvatar);this.imgzhezhao.centerY=0;this.imgzhezhao.anchorX=this.imgzhezhao.anchorY=.5;this.imgzhezhao.scaleX=this.imgzhezhao.scaleY=2.5};o.prototype.onDisplay=function(){app.SoundManager.getIns().playSound("functionopen");this.btngoumai.on(Laya.Event.CLICK,this,this.onClick);this.labelmiaoshu1.on(Laya.Event.CLICK,this,this.onClickMore);this.closebtn.on(Laya.Event.CLICK,this,this.onClickClose);activitytaren.ActivityTaRenModel.getIns().on(activitytaren.ActivityIconStatuManager.EVENT_ACRIVITY_SINGLE_VISIBLE,this,this.onShowHide);this.callLater(this.onGetInfo)};o.prototype.onUnDisplay=function(){app.SoundManager.getIns().playSound("functionclose");this.btngoumai.off(Laya.Event.CLICK,this,this.onClick);this.labelmiaoshu1.off(Laya.Event.CLICK,this,this.onClickMore);this.closebtn.off(Laya.Event.CLICK,this,this.onClickClose);activitytaren.ActivityTaRenModel.getIns().off(activitytaren.ActivityIconStatuManager.EVENT_ACRIVITY_SINGLE_VISIBLE,this,this.onShowHide)};o.prototype.onGetInfo=function(){if(this.functionid){this.actVo=activitytaren.ActivityTaRenModel.getIns().getActivityID_By_functionid(this.functionid);this._model.netData=this.actVo;this.refreshAll()}};o.prototype.refreshAll=function(){var t=this.actVo.timeVo;this.activityTimeView.start(t.endTime);this.labelmiaoshu5.visible=true;this.labelmiaoshu2.visible=true;this.setAvatar()};o.prototype.onAni1End=function(){};o.prototype.setAvatar=function(){var t=+this._model.netData.cfgList[0].p2;var e=csv.HorseattrProxy.getIns().getCfg(t);var i=new avatar.AvatarData;i.mountKey=e.horseres;this._mountAvatar.setAniData(i);this._mountAvatar.setAni(avatar.AvatarAnimation.ANI_ENUMS.IDLE,0);this._mountAvatar.scale(1.5,1.5);this._mountAvatar.play()};o.prototype.onClick=function(){var t=+this._model.netData.cfgList[0].p1;shop.ShopModel.getIns().chongzhi(t)};o.prototype.onClickMore=function(){app.ViewManager.toggleDialog(e.WaiXianTeGouShuXingView,1,0)};o.prototype.onClickClose=function(){app.ViewManager.toggleDialog(o,-1)};o.prototype.hideSubTime=function(){this.activityTimeView.stop();this.labelmiaoshu5.visible=false;this.labelmiaoshu2.visible=false;app.ViewManager.toggleDialog(o,-1)};o.prototype.endTimeCallBack=function(){this.hideSubTime()};o.prototype.onShowHide=function(t){if(t.actId==11&&!t.visible){var e=+this._model.netData.cfgList[0].p2;var i=csv.HorseattrProxy.getIns().getCfgArr()[e-1];var n=new avatar.AvatarData;n.mountKey=i.horseres;var a=this.imgzuoqi.parent.localToGlobal(new Laya.Point(this.imgzuoqi.x,this.imgzuoqi.y));app.ViewManager.toggleDialog(game.JiHuoSuccessView,1,0,[game.Config.ENUM_TYPE.AVATAR,n,a.x,a.y]);app.ViewManager.toggleDialog(o,-1)}};o.SINGLE_KEY="waixiantegou.WaiXianTeGouMainView";return o}(ui.waixiantegou.taotieviewUI);e.WaiXianTeGouMainView=t})(waixiantegou||(waixiantegou={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var waixiantegou;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=i.WaiXianTeGouModel.getIns();this.activityTimeView=new activitytaren.ActivityTimeView(this.labelmiaoshu2,new Laya.Handler(this,this.endTimeCallBack),"{0}")};e.prototype.onDisplay=function(){this.gumaibtn.on(Laya.Event.CLICK,this,this.onClick);this.btnclose.on(Laya.Event.CLICK,this,this.onClickClose);this.callLater(this.onGetInfo)};e.prototype.onUnDisplay=function(){this.gumaibtn.off(Laya.Event.CLICK,this,this.onClick);this.btnclose.off(Laya.Event.CLICK,this,this.onClickClose)};e.prototype.onGetInfo=function(){this.refreshAll()};e.prototype.refreshAll=function(){var t;if(this._model.netData){t=this._model.netData.timeVo}else{t=activitytaren.ActivityTaRenModel.getIns().getActivityID_By_functionid(103).timeVo}this.guwulab2.text=app.getLang("shenyingtegou_tips1");this.activityTimeView.start(t.endTime);this.labelmiaoshu2.visible=true;this.labelmiaoshu3.visible=true;this.daojuimg.setData(game.ItemUtil.parserList(this.dataSource.item+"-1")[0])};e.prototype.onClick=function(){app.ViewManager.toggleDialog(i.WaiXianTeGouMainView,1,1,null,null,null,true,103)};e.prototype.onClickClose=function(){app.ViewManager.toggleDialog(i.WaiXianTeGouMainView,-1)};e.prototype.onClickMore=function(){app.ViewManager.toggleDialog(i.WaiXianTeGouShuXingView,1,0)};e.prototype.hideSubTime=function(){this.activityTimeView.stop();this.labelmiaoshu3.visible=false;this.labelmiaoshu2.visible=false};e.prototype.endTimeCallBack=function(){this.hideSubTime()};e.SINGLE_KEY="waixiantegou.WaiXianTeGouShopTipView";return e}(ui.waixiantegou.qianwanggoumaitipUI);i.WaiXianTeGouShopTipView=t})(waixiantegou||(waixiantegou={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var waixiantegou;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listdaoju.itemRender=mount.MountSkillCell01;this.listdaoju.renderHandler=new Laya.Handler(this,this.onSkillRenderHandler);this.centerMediator=new game.CenterLayoutMediator(this.listdaoju,this,96,this.listdaoju.spaceX);this.listshuxing.itemRender=mount.MountHorseCell02;this.listshuxing.renderHandler=new Laya.Handler(this,this.onAttatRenderHandler);this._model=i.WaiXianTeGouModel.getIns();this._mountAvatar=new avatar.AvatarAnimation;this.imgzuoqi.addChild(this._mountAvatar)};e.prototype.onDisplay=function(){this.btndatingshengji.on(Laya.Event.CLICK,this,this.onClick);this.closebtn.on(Laya.Event.CLICK,this,this.onClickClose);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){this.btndatingshengji.off(Laya.Event.CLICK,this,this.onClick);this.closebtn.off(Laya.Event.CLICK,this,this.onClickClose)};e.prototype.refreshAll=function(){this.onCheckSetData()};e.prototype.onSkillRenderHandler=function(t){t.setData(t.dataSource)};e.prototype.onAttatRenderHandler=function(t){t.setData(t.dataSource)};e.prototype.onCheckSetData=function(){var t=+this._model.netData.cfgList[0].p2;var e=csv.HorseattrProxy.getIns().getCfg(t);if(!e)return;this.setAvatar();var i;var n=e.horseskill.split(";");var a=[];for(i=0;i<n.length;i++){var o=csv.SkillProxy.getIns().getSkillByKey(n[i]);a.push(o)}this.centerMediator.array=a;var s=csv.HorseattrProxy.getIns().getSkillMaxLevel(t);var r=csv.HorseattrProxy.getIns().getSkillByLevel(t,s);var l=Attributes.decode(r.attributes);var h=[];for(i=0;i<l.baseList.length;i++){h.push(l.baseList[i])}this.listshuxing.array=h};e.prototype.setAvatar=function(){var t=+this._model.netData.cfgList[0].p2;var e=csv.HorseattrProxy.getIns().getCfg(t);var i=new avatar.AvatarData;i.mountKey=e.horseres;this._mountAvatar.setAniData(i);this._mountAvatar.setAni(avatar.AvatarAnimation.ANI_ENUMS.IDLE,0);this._mountAvatar.play()};e.prototype.onClick=function(){app.ViewManager.toggleDialog(e,-1)};e.prototype.onClickClose=function(){app.ViewManager.toggleDialog(e,-1)};e.SINGLE_KEY="waixiantegou.WaiXianTeGouShuXingView";return e}(ui.waixiantegou.waixianshuxingtipUI);i.WaiXianTeGouShuXingView=t})(waixiantegou||(waixiantegou={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var waixiantegou;(function(e){var t=function(t){__extends(o,t);function o(){return t!==null&&t.apply(this,arguments)||this}o.getIns=function(){return app.Singleton.getInstance(o)};o.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=e.WaiXianTeGouModel.getIns();this.activityTimeView=new activitytaren.ActivityTimeView(this.labelmiaoshu5,new Laya.Handler(this,this.endTimeCallBack),"{0}");this._mountAvatar=new avatar.AvatarAnimation;this.imgzuoqi.y=566;this.imgzuoqi.addChild(this._mountAvatar);this.imgzhezhao.centerY=0;this.imgzhezhao.anchorX=this.imgzhezhao.anchorY=.5;this.imgzhezhao.scaleX=this.imgzhezhao.scaleY=2.5};o.prototype.onDisplay=function(){app.SoundManager.getIns().playSound("functionopen");this.btngoumai.on(Laya.Event.CLICK,this,this.onClick);this.labelmiaoshu1.on(Laya.Event.CLICK,this,this.onClickMore);this.closebtn.on(Laya.Event.CLICK,this,this.onClickClose);activitytaren.ActivityTaRenModel.getIns().on(activitytaren.ActivityIconStatuManager.EVENT_ACRIVITY_SINGLE_VISIBLE,this,this.onShowHide);this.callLater(this.onGetInfo)};o.prototype.onUnDisplay=function(){app.SoundManager.getIns().playSound("functionclose");this.btngoumai.off(Laya.Event.CLICK,this,this.onClick);this.labelmiaoshu1.off(Laya.Event.CLICK,this,this.onClickMore);this.closebtn.off(Laya.Event.CLICK,this,this.onClickClose);activitytaren.ActivityTaRenModel.getIns().off(activitytaren.ActivityIconStatuManager.EVENT_ACRIVITY_SINGLE_VISIBLE,this,this.onShowHide)};o.prototype.onGetInfo=function(){if(this.functionid){this.actVo=activitytaren.ActivityTaRenModel.getIns().getActivityID_By_functionid(this.functionid);this._model.netData=this.actVo;this.refreshAll()}};o.prototype.refreshAll=function(){var t=this.actVo.timeVo;this.activityTimeView.start(t.endTime);this.labelmiaoshu5.visible=true;this.labelmiaoshu2.visible=true;this.setAvatar()};o.prototype.onAni1End=function(){};o.prototype.setAvatar=function(){var t=+this._model.netData.cfgList[0].p2;var e=csv.HorseattrProxy.getIns().getCfg(t);var i=new avatar.AvatarData;i.mountKey=e.horseres;this._mountAvatar.setAniData(i);this._mountAvatar.setAni(avatar.AvatarAnimation.ANI_ENUMS.IDLE,0);this._mountAvatar.scale(1.5,1.5);this._mountAvatar.play()};o.prototype.onClick=function(){var t=+this._model.netData.cfgList[0].p1;shop.ShopModel.getIns().chongzhi(t)};o.prototype.onClickMore=function(){app.ViewManager.toggleDialog(e.WaiXianTeGouShuXingPhoenixView,1,0)};o.prototype.onClickClose=function(){app.ViewManager.toggleDialog(o,-1)};o.prototype.hideSubTime=function(){this.activityTimeView.stop();this.labelmiaoshu5.visible=false;this.labelmiaoshu2.visible=false;app.ViewManager.toggleDialog(o,-1)};o.prototype.endTimeCallBack=function(){this.hideSubTime()};o.prototype.onShowHide=function(t){if(t.actId==43&&!t.visible){var e=+this._model.netData.cfgList[0].p2;var i=csv.HorseattrProxy.getIns().getCfgArr()[e-1];var n=new avatar.AvatarData;n.mountKey=i.horseres;var a=this.imgzuoqi.parent.localToGlobal(new Laya.Point(this.imgzuoqi.x,this.imgzuoqi.y));app.ViewManager.toggleDialog(o,-1)}};o.SINGLE_KEY="waixiantegou.WaiXianTeGouPhoenixMainView";return o}(ui.waixiantegou.fenghuangviewUI);e.WaiXianTeGouPhoenixMainView=t})(waixiantegou||(waixiantegou={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var waixiantegou;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=i.WaiXianTeGouModel.getIns();this.activityTimeView=new activitytaren.ActivityTimeView(this.labelmiaoshu2,new Laya.Handler(this,this.endTimeCallBack),"{0}")};e.prototype.onDisplay=function(){this.gumaibtn.on(Laya.Event.CLICK,this,this.onClick);this.btnclose.on(Laya.Event.CLICK,this,this.onClickClose);this.callLater(this.onGetInfo)};e.prototype.onUnDisplay=function(){this.gumaibtn.off(Laya.Event.CLICK,this,this.onClick);this.btnclose.off(Laya.Event.CLICK,this,this.onClickClose)};e.prototype.onGetInfo=function(){this.refreshAll()};e.prototype.refreshAll=function(){var t;if(this._model.netData){t=this._model.netData.timeVo}else{t=activitytaren.ActivityTaRenModel.getIns().getActivityID_By_functionid(206).timeVo}this.guwulab2.text=app.getLang("shenyingtegou_tips1");this.activityTimeView.start(t.endTime);this.labelmiaoshu2.visible=true;this.labelmiaoshu3.visible=true;this.daojuimg.setData(game.ItemUtil.parserList(this.dataSource.item+"-1")[0])};e.prototype.onClick=function(){app.ViewManager.toggleDialog(i.WaiXianTeGouPhoenixMainView,1,1,null,null,null,true,206)};e.prototype.onClickClose=function(){app.ViewManager.toggleDialog(i.WaiXianTeGouPhoenixMainView,-1)};e.prototype.onClickMore=function(){app.ViewManager.toggleDialog(i.WaiXianTeGouShuXingPhoenixView,1,0)};e.prototype.hideSubTime=function(){this.activityTimeView.stop();this.labelmiaoshu3.visible=false;this.labelmiaoshu2.visible=false};e.prototype.endTimeCallBack=function(){this.hideSubTime()};e.SINGLE_KEY="waixiantegou.WaiXianTeGouPhoenixShopTipView";return e}(ui.waixiantegou.fenghuanggoumaitipUI);i.WaiXianTeGouPhoenixShopTipView=t})(waixiantegou||(waixiantegou={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var waixiantegou;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listdaoju.itemRender=mount.MountSkillCell01;this.listdaoju.renderHandler=new Laya.Handler(this,this.onSkillRenderHandler);this.centerMediator=new game.CenterLayoutMediator(this.listdaoju,this,96,this.listdaoju.spaceX);this.listshuxing.itemRender=mount.MountHorseCell02;this.listshuxing.renderHandler=new Laya.Handler(this,this.onAttatRenderHandler);this._model=i.WaiXianTeGouModel.getIns();this._mountAvatar=new avatar.AvatarAnimation;this.imgzuoqi.addChild(this._mountAvatar)};e.prototype.onDisplay=function(){this.btndatingshengji.on(Laya.Event.CLICK,this,this.onClick);this.closebtn.on(Laya.Event.CLICK,this,this.onClickClose);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){this.btndatingshengji.off(Laya.Event.CLICK,this,this.onClick);this.closebtn.off(Laya.Event.CLICK,this,this.onClickClose)};e.prototype.refreshAll=function(){this.onCheckSetData()};e.prototype.onSkillRenderHandler=function(t){t.setData(t.dataSource)};e.prototype.onAttatRenderHandler=function(t){t.setData(t.dataSource)};e.prototype.onCheckSetData=function(){var t=+this._model.netData.cfgList[0].p2;var e=csv.HorseattrProxy.getIns().getCfg(t);if(!e)return;this.setAvatar();var i;var n=e.horseskill.split(";");var a=[];for(i=0;i<n.length;i++){var o=csv.SkillProxy.getIns().getSkillByKey(n[i]);a.push(o)}this.centerMediator.array=a;var s=Attributes.decode(e.attr);var r=[];for(i=0;i<s.baseList.length;i++){r.push(s.baseList[i])}this.listshuxing.array=r};e.prototype.setAvatar=function(){var t=+this._model.netData.cfgList[0].p2;var e=csv.HorseattrProxy.getIns().getCfg(t);var i=new avatar.AvatarData;i.mountKey=e.horseres;this._mountAvatar.setAniData(i);this._mountAvatar.setAni(avatar.AvatarAnimation.ANI_ENUMS.IDLE,0);this._mountAvatar.play()};e.prototype.onClick=function(){app.ViewManager.toggleDialog(e,-1)};e.prototype.onClickClose=function(){app.ViewManager.toggleDialog(e,-1)};e.SINGLE_KEY="waixiantegou.WaiXianTeGouShuXingPhoenixView";return e}(ui.waixiantegou.fenghuangshuxingtipUI);i.WaiXianTeGouShuXingPhoenixView=t})(waixiantegou||(waixiantegou={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var xianshimiaosha;(function(l){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.XIANSHIMIAOSHA_SHOP,l.XianShiMiaoShaTabView);main.MainUIIcon.iconClassMap[csv.MainIconProxy.TYPE_ICON_XIANSHIMIAOSHA]=l.XianShiMiaoShaIcon};e.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.ActLimitedBuyDataNtf,this,this.onActLimitedBuyDataNtf)};e.prototype.onActLimitedBuyDataNtf=function(t,e){e.data.sort(this.onSort);if(l.XianShiMiaoShaModle.getIns().data&&l.XianShiMiaoShaModle.getIns().data.length>0&&e.data.length>0){if(l.XianShiMiaoShaModle.getIns().selecTId){var i=false;for(var n=0;n<e.data.length;n++){if(e.data[n].cfg_id==l.XianShiMiaoShaModle.getIns().selecTId){i=true;break}}if(!i){app.ViewManager.toggleDialog(l.XianShiMiaoShaView,-1)}}}if(e.data.length==0){app.ViewManager.toggleDialog(l.XianShiMiaoShaView,-1)}l.XianShiMiaoShaModle.getIns().data=e.data;newshangcheng.NewShangChengModel.getIns().scPop.xianshiMiaoShalist=l.XianShiMiaoShaModle.getIns().data;newshangcheng.NewShangChengModel.getIns().checkHuoDong();main.BigLeftTopList.getIns().refreshAll();l.XianShiMiaoShaModle.getIns().event(l.XianShiMiaoShaModle.EVENTS.UPDATE_MAIN_VIEW);if(app.ViewManager.DisplayedInStage(newshangcheng.NewShangChengView.SINGLE_KEY)){if(l.XianShiMiaoShaModle.getIns().data.length<=0){newshangcheng.NewShangChengModel.getIns().updateView()}else{l.XianShiMiaoShaModle.getIns().event(l.XianShiMiaoShaModle.EVENTS.UPDATE_TAB_VIEW)}}if(!this._padlarId){this._padlarId=[];for(var n=0;n<e.data.length;n++){this._padlarId.push(e.data[n].cfg_id)}}else{var a=false;for(var n=0;n<e.data.length;n++){if(this._padlarId.indexOf(e.data[n].cfg_id)==-1){this._padlarId.push(e.data[n].cfg_id);a=true}}if(a){var o=l.XianShiMiaoShaModle.getIns().data[l.XianShiMiaoShaModle.getIns().data.length-1];var s=o.cfg_id;var r=csv.XianShiMiaoShaProxy.getIns().getCfg(s);if(parseInt(r.eventype)==2){Laya.timer.once(300,this,function(){app.ViewManager.toggleDialog(l.XianShiMiaoShaView,1,0,[s])})}else if(s==202){if(!l.XianShiMiaoShaModle.getIns().mountData)l.XianShiMiaoShaModle.getIns().mountData=[];l.XianShiMiaoShaModle.getIns().mountData.push(s)}else{app.ViewManager.toggleDialog(l.XianShiMiaoShaView,1,0,[s])}}}};e.prototype.onSort=function(t,e){if(t.time>e.time){return 1}else if(t.time<e.time){return-1}else{return 0}};e.SINGLE_KEY="xianshimiaosha.XianShiMiaoShaModule";return e}(app.ModuleBase);l.XianShiMiaoShaModule=t})(xianshimiaosha||(xianshimiaosha={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var xianshimiaosha;(function(t){var e;(function(t){t[t["kLimitedBuytEventTypeTeamLevel"]=1]="kLimitedBuytEventTypeTeamLevel";t[t["kLimitedBuytEventTypeCheckPoint"]=2]="kLimitedBuytEventTypeCheckPoint";t[t["kLimitedBuytEventTypeRoleCount"]=3]="kLimitedBuytEventTypeRoleCount";t[t["kLimitedBuytEventTypeSoul"]=4]="kLimitedBuytEventTypeSoul";t[t["kLimitedBuytEventTypeMountain"]=5]="kLimitedBuytEventTypeMountain";t[t["kLimitedBuytEventTypeMagicWeapon"]=6]="kLimitedBuytEventTypeMagicWeapon";t[t["kLimitedBuytEventTypeDate"]=7]="kLimitedBuytEventTypeDate";t[t["kLimitedBuytEventTypeSoulXiuLian"]=8]="kLimitedBuytEventTypeSoulXiuLian";t[t["kLimitedBuytEventTypeCheckPointFail"]=9]="kLimitedBuytEventTypeCheckPointFail";t[t["kLimitedBuytEventTypeMJUnlock"]=10]="kLimitedBuytEventTypeMJUnlock";t[t["kLimitedBuytEventTypeEquipStren"]=11]="kLimitedBuytEventTypeEquipStren";t[t["kLimitedBuytEventTypeEquipStar"]=12]="kLimitedBuytEventTypeEquipStar";t[t["kLimitedBuytEventTypeGem"]=13]="kLimitedBuytEventTypeGem";t[t["kLimitedBuytEventTypeRefine"]=14]="kLimitedBuytEventTypeRefine";t[t["kLimitedBuytEventTypeQuench"]=15]="kLimitedBuytEventTypeQuench";t[t["kLimitedBuytEventTypeHorse"]=16]="kLimitedBuytEventTypeHorse";t[t["kLimitedBuytEventTypeHorseId"]=17]="kLimitedBuytEventTypeHorseId";t[t["kLimitedBuytEventTypeBlackMarketPrimary"]=18]="kLimitedBuytEventTypeBlackMarketPrimary";t[t["kLimitedBuytEventTypeBlackMarketPremium"]=19]="kLimitedBuytEventTypeBlackMarketPremium"})(e=t.LimitedBuytEventType||(t.LimitedBuytEventType={}));var i=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){};e.prototype.isOpenCheck=function(){if(!e.getIns().data){return false}if(e.getIns().data.length==0){return false}else{return true}};e.prototype.getActLimitedBuyData=function(t){for(var e=0;e<this.data.length;e++){if(this.data[e].cfg_id==t){return this.data[e]}}return null};e.prototype.getMountSkin=function(t){var e="";switch(t.showtype){case 1:e=csv.HorseattrProxy.getIns().getCfg(t.show).horseres;break;case 2:e=csv.SkinProxy.getIns().getCfg(t.show).modelres;break}return e};e.prototype.getStartTime=function(t){var e=csv.XianShiMiaoShaProxy.getIns().getCfg(t);if(!e){game.Alert.show("seckill.csv id = "+t+" 不存在");return 0}var i=0;for(var n=0;n<this.data.length;n++){if(this.data[n].cfg_id==t){i=this.data[n].time}}if(i>0){return i-parseInt(e.timeon)}return 0};e.SINGLE_KEY="xianshimiaosha.XianShiMiaoShaModle";e.EVENTS={UPDATE_MAIN_VIEW:"UPDATE_MAIN_VIEW",UPDATE_TAB_VIEW:"UPDATE_TAB_VIEW"};return e}(app.ModelBase);t.XianShiMiaoShaModle=i})(xianshimiaosha||(xianshimiaosha={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("seckill.csv");this.cfgMap=t.getMap("id");this.actidMap=t.getMap("actid")};e.prototype.getCfg=function(t){return this.cfgMap[t]};e.SINGLE_KEY="csv.XianShiMiaoShaProxy";return e}(app.ModelBase);t.XianShiMiaoShaProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var xianshimiaosha;(function(n){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.timeView=new activitytaren.ActivityTimeView(this.weikaiqilab,new Laya.Handler(this,this.endHandler),app.getLang("miaosha_time_1"));this.on(Laya.Event.CLICK,this,this.onClick);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.endHandler=function(){};e.prototype.onClick=function(){if(this._cfg){app.ViewManager.toggleDialog(n.XianShiMiaoShaView,1,0,[this._cfg.id])}};e.prototype.onDisplay=function(){this.callLater(this.updateLayout)};e.prototype.onUnDisplay=function(){if(this.timeView){this.timeView.stop()}};e.prototype.updateLayout=function(){};e.prototype.setData=function(t){this._cfg=csv.XianShiMiaoShaProxy.getIns().getCfg(t.cfg_id);this.img1.skin="res/static/xinshangcheng2/"+this._cfg.cp2+".png";if(this.timeView){this.timeView.stop()}var e=n.XianShiMiaoShaModle.getIns().getActLimitedBuyData(this._cfg.id);if(e){this.timeView.start(e.time)}var i=csv.XianShiMiaoShaProxy.getIns().getCfg(this._cfg.id);if(newshangcheng.NewShangChengModel.getIns().isXinCanShow(i.actid)){game.RedDotView.addTo(this,this.width-20,5,1,1,game.RedDotView.ENUM_TYPE.XIN)}else{game.RedDotView.removeFrom(this)}};e.SINGLE_KEY="xianshimiaosha.XianShiItemCell";return e}(ui.xinshangcheng2.xianshiitem2UI);n.XianShiItemCell=t})(xianshimiaosha||(xianshimiaosha={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var xianshimiaosha;(function(a){var t=function(n){__extends(t,n);function t(t,e){if(e===void 0){e=main.IconListBase.SIZE}var i=n.call(this,t,e)||this;i.setTimeLabel();i.timeView=new activitytaren.ActivityTimeView(i.lblTime,new Laya.Handler(i,i.endHandler),undefined,undefined,activitytaren.ActivityTimeView.TYPE_KEEP_2_BIT);return i}t.prototype.onClick=function(t){t.stopPropagation();this._isClicked=true;this.funcAdapter.changeDot();game.ClosureManager.callFunction(csv.FunctionsProxy.ENUMS.XIANSHIMIAOSHA_SHOP);Laya.timer.once(200,this,this.onOnce)};t.prototype.onOnce=function(){app.ViewManager.toggleDialog(a.XianShiMiaoShaView,1,0)};t.prototype.onDisplay=function(){n.prototype.onDisplay.call(this);this.clearData();this.updateLayout()};t.prototype.onUnDisplay=function(){n.prototype.onUndisplay.call(this);Laya.timer.clear(this,this.onOnce)};t.prototype.clearData=function(){if(this.timeView){this.timeView.stop()}};t.prototype.updateLayout=function(){if(!main.LeftIconList.getIns().parent){return}var t=a.XianShiMiaoShaModle.getIns().data;if(t.length==0){return}if(this.timeView){this.timeView.stop()}var e=a.XianShiMiaoShaModle.getIns().getActLimitedBuyData(t[0].cfg_id);if(e){this.timeView.start(e.time)}var i=csv.XianShiMiaoShaProxy.getIns().getCfg(t[0].cfg_id);this.skin="res/static/mainicon/"+i.mainicon+".png"};t.prototype.endHandler=function(){};return t}(main.MainUIIcon);a.XianShiMiaoShaIcon=t})(xianshimiaosha||(xianshimiaosha={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var xianshimiaosha;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.listbaoxiang.itemRender=i.XianShiItemCell;this.listbaoxiang.renderHandler=new Laya.Handler(this,this.onCell);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){i.XianShiMiaoShaModle.getIns().on(i.XianShiMiaoShaModle.EVENTS.UPDATE_TAB_VIEW,this,this.onMainView);this.callLater(this.updateLayout)};e.prototype.onUnDisplay=function(){i.XianShiMiaoShaModle.getIns().off(i.XianShiMiaoShaModle.EVENTS.UPDATE_TAB_VIEW,this,this.onMainView)};e.prototype.onCell=function(t){t.setData(t.dataSource)};e.prototype.onMainView=function(){this.updateLayout();this.listbaoxiang.refresh()};e.prototype.updateLayout=function(){var t=[];for(var e=i.XianShiMiaoShaModle.getIns().data.length-1;e>=0;e--){t.push(i.XianShiMiaoShaModle.getIns().data[e])}this.listbaoxiang.array=t};e.SINGLE_KEY="xianshimiaosha.XianShiMiaoShaTabView";return e}(ui.xinshangcheng2.xianshimiaoshaviewUI);i.XianShiMiaoShaTabView=t})(xianshimiaosha||(xianshimiaosha={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var xianshimiaosha;(function(n){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this._mountAvatar=new avatar.AvatarAnimation;this.imgzuoqi.addChild(this._mountAvatar);this.labelmiaoshu5.x=132;this.labelmiaoshu5.width=484;this.timeView=new activitytaren.ActivityTimeView(this.labelmiaoshu5,new Laya.Handler(this,this.endHandler),app.getLang("miaosha_time_1"));this.daoju.itemRender=grids.GridView;this.daoju.renderHandler=grids.GridView.CommonItemRender;this.labelmiaoshu1.on(Laya.Event.CLICK,this,this.onlabelmiaoshu1Click);this.btngoumai.clickHandler=new Laya.Handler(this,this.onBtngoumaiClick);this.imgxianshi.anchorX=this.imgxianshi.anchorY=1;this.imgxianshi.x+=this.imgxianshi.width;this.imgxianshi.y+=this.imgxianshi.height;this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.endHandler=function(){};e.prototype.onDisplay=function(){guide.GuideModel.getIns().boOpen=false;n.XianShiMiaoShaModle.getIns().on(n.XianShiMiaoShaModle.EVENTS.UPDATE_MAIN_VIEW,this,this.updateLayout);this.callLater(this.updateLayout)};e.prototype.onUnDisplay=function(){guide.GuideModel.getIns().boOpen=true;n.XianShiMiaoShaModle.getIns().off(n.XianShiMiaoShaModle.EVENTS.UPDATE_MAIN_VIEW,this,this.updateLayout);if(this.timeView){this.timeView.stop()}this.timer.clear(this,this.onTween1);this.timer.clear(this,this.onTween2);app.MyTween.clearAll(this.imgxianshi);Laya.timer.clearAll(this);if(this._cfg){var t=csv.XianShiMiaoShaProxy.getIns().getCfg(this._cfg.id);newshangcheng.NewShangChengModel.getIns().delXin(t.actid)}};e.prototype.onTween1=function(){app.MyTween.to(this.imgxianshi,{scaleX:1,scaleY:1},200,null,Laya.Handler.create(this,this.tweenComplete))};e.prototype.onTween2=function(){app.MyTween.to(this.imgxianshi,{scaleX:0,scaleY:0},200,null,Laya.Handler.create(this,this.tweenComplete))};e.prototype.tweenComplete=function(){var t=Number(this._cfg.eject)*1e3;if(this.imgxianshi.scaleX==1){this.timer.once(t,this,this.onTween2)}else{this.timer.once(t,this,this.onTween1)}};e.prototype.onlabelmiaoshu1Click=function(){app.ViewManager.toggleDialog(n.ZhanShiTip,1,0,this._cfg)};e.prototype.onBtngoumaiClick=function(){if(this._cfg){var t=csv.XianShiMiaoShaProxy.getIns().getCfg(this._cfg.id);shop.ShopModel.getIns().chongzhi(t.recharge)}};e.prototype.updateLayout=function(){if(this.dataSource.length>0){this._cfg=csv.XianShiMiaoShaProxy.getIns().getCfg(this.dataSource[0])}else{this._cfg=csv.XianShiMiaoShaProxy.getIns().getCfg(n.XianShiMiaoShaModle.getIns().data[0].cfg_id)}if(!this._cfg)return;n.XianShiMiaoShaModle.getIns().selecTId=this._cfg.id;if(parseInt(this._cfg.eject)){this.imgxianshi.scale(0,0);this.timer.once(200,this,this.onTween1)}else{this.imgxianshi.scale(1,1)}if(parseInt(this._cfg.showparam)>0){this.imgzuoqi.visible=true;this.setAvatar();this.imgziyuan.visible=false}else{this.imgziyuan.visible=true;this.imgziyuan.skin="res/static/xinshangcheng2/"+this._cfg.show+".png";this.imgzuoqi.visible=false;this._mountAvatar.stop()}this.setShowType(this._cfg);this.imgxianshi.skin="res/static/xinshangcheng2/"+this._cfg.cp3+".png";this.youhui.value=this._cfg.cp4+"%";if(this.timeView){this.timeView.stop()}var t=n.XianShiMiaoShaModle.getIns().getActLimitedBuyData(this._cfg.id);if(t){this.timeView.start(t.time)}var e=csv.RechargeProxy.getIns().getRechargeMapCell(this._cfg.recharge);var i=parseInt(e.recharge)/100;this.goumai.text=app.getLang("touzilicai_txt02",i);this.labelmiaoshu2.text=app.getLang("xinshangcheng_03",e.limit-t.count,e.limit)};e.prototype.setAvatar=function(){var t=n.XianShiMiaoShaModle.getIns().getMountSkin(this._cfg);var e=new avatar.AvatarData;e.mountKey=t;this._mountAvatar.setAniData(e);this._mountAvatar.setAni(avatar.AvatarAnimation.ANI_ENUMS.IDLE,0);this._mountAvatar.play();if(this._cfg.adjust!=""){var i=app.str2Array(this._cfg.adjust,",");this._mountAvatar.scale(Number(i[0]),Number(i[0]));this._mountAvatar.x=parseInt(i[1]);this._mountAvatar.y=parseInt(i[2])}};e.prototype.setShowType=function(t){switch(t.showtype){case 0:this.labelmiaoshu1.visible=false;this.daojubox.visible=true;this.miaoshubox.visible=false;var e=game.ItemUtil.parserList(t.cp5);if(e.length>4){this.daoju.repeatX=4;this.daoju.hScrollBarSkin=" "}else{this.daoju.repeatX=e.length;this.daoju.hScrollBarSkin=""}if(e.length>3){this.daoju.width=392}else{this.daoju.width=this.daoju.repeatX*98+(this.daoju.repeatX-1)*this.daoju.spaceX}this.daoju.array=e;this.daoju.x=(this.daojubox.width-this.daoju.width*this.daoju.scaleX)/2;break;case 1:this.labelmiaoshu1.visible=true;this.daojubox.visible=false;this.miaoshubox.visible=true;this.imgmeishuzi2.skin="res/static/xinshangcheng2/"+this._cfg.cp5+".png";break;default:this.labelmiaoshu1.visible=true;this.daojubox.visible=false;this.miaoshubox.visible=false;break}};e.SINGLE_KEY="xianshimiaosha.XianShiMiaoShaView";return e}(ui.xinshangcheng2.zuoqimiaoshaviewUI);n.XianShiMiaoShaView=t})(xianshimiaosha||(xianshimiaosha={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var xianshimiaosha;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.listdaoju.itemRender=mount.MountSkillCell01;this.listdaoju.renderHandler=new Laya.Handler(this,this.onSkillRenderHandler);this.centerMediator=new game.CenterLayoutMediator(this.listdaoju,this,96,this.listdaoju.spaceX);this.listshuxing.itemRender=mount.MountHorseCell02;this.listshuxing.renderHandler=new Laya.Handler(this,this.onAttatRenderHandler);this._mountAvatar=new avatar.AvatarAnimation;this.imgzuoqi.addChild(this._mountAvatar);this.btndatingshengji.on(Laya.Event.CLICK,this,this.onClick);this.closebtn.on(Laya.Event.CLICK,this,this.onClickClose);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){this.onCheckSetData()};e.prototype.onSkillRenderHandler=function(t){t.setData(t.dataSource)};e.prototype.onAttatRenderHandler=function(t){t.setData(t.dataSource)};e.prototype.onCheckSetData=function(){if(this.dataSource){this._cfg=this.dataSource}var t;var e;var i;switch(this._cfg.showtype){case 1:t=csv.HorseattrProxy.getIns().getCfg(this._cfg.show);this.labeltitle.text=app.getLang(t.name);this.setAvatar(t.horseres);var n=app.str2Array(t.offsets,";");this._mountAvatar.x=parseInt(n[0]);this._mountAvatar.y=parseInt(n[1]);var a=t.horseskill.split(";");var o=[];for(i=0;i<a.length;i++){var s=csv.SkillProxy.getIns().getSkillByKey(a[i]);o.push(s)}this.centerMediator.array=o;e=Attributes.decode(t.attr);break;case 2:t=csv.SkinProxy.getIns().getCfg(this._cfg.show);this.labeltitle.text=app.getLang(t.title);this.setAvatar(t.modelres);this.centerMediator.array=[];e=Attributes.decode(t.attrfirst);break}var r=[];for(i=0;i<e.baseList.length;i++){r.push(e.baseList[i])}this.listshuxing.array=r};e.prototype.setAvatar=function(t){var e=new avatar.AvatarData;e.mountKey=t;this._mountAvatar.setAniData(e);this._mountAvatar.setAni(avatar.AvatarAnimation.ANI_ENUMS.IDLE,0);this._mountAvatar.play()};e.prototype.onClick=function(){app.ViewManager.toggleDialog(e,-1)};e.prototype.onClickClose=function(){app.ViewManager.toggleDialog(e,-1)};e.SINGLE_KEY="xianshimiaosha.ZhanShiTip";return e}(ui.waixiantegou.fenghuangshuxingtipUI);t.ZhanShiTip=e})(xianshimiaosha||(xianshimiaosha={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var xianyaodingzhi;(function(i){var n=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.function_id=csv.FunctionsProxy.ENUMS.XIAN_YAO_DING_ZHI;return t}return t}(activitytaren.ActivityTimeIcon);var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.CustomGiftChoiceResp,this,this.onCustomGiftChoiceResp);this.addMsgListener(app.ProtocolResponse.CustomGiftChoiceSyn,this,this.onCustomGiftChoiceSyn)};e.prototype.init=function(){this.model=i.XiangyaoDingZhiModel.getIns();game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.XIAN_YAO_DING_ZHI,i.XiangyaodingzhiView,null,game.ECommonType.DIALOG_TYPE);main.MainUIIcon.iconClassMap[csv.MainIconProxy.TYPE_ICON_XING_YAO_DING_ZHI]=n};e.prototype.onCustomGiftChoiceResp=function(t,e){if(e.ret==1){manager.FlowManager.instance.flowByStyle1(app.getLang("xiangyaodignzhi_04"))}};e.prototype.onCustomGiftChoiceSyn=function(t,e){this.model.customGiftData=e.data;if(app.ViewManager.DisplayedInStage(i.XiangyaodingzhiView.SINGLE_KEY)){i.XiangyaodingzhiView.getIns().onRefreshHandler()}};return e}(app.ModuleBase);i.XianYaoDingZhiModule=t})(xianyaodingzhi||(xianyaodingzhi={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var xianyaodingzhi;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){this.actmodel=activitytaren.ActivityTaRenModel.getIns()};e.prototype.getSelect=function(t,e){if(this.customGiftData){for(var i=0;i<this.customGiftData.length;i++){var n=this.customGiftData[i];if(n.cfgId==t&&n.vecItem){return n.vecItem[e]}}}return game.GridsModel.EMPTY};e.prototype.isSellOut=function(t){var e=activitytaren.ActivityTaRenModel.getIns().iconMan.getActVOlist_by_client_type(activitytaren.ActivityTaRenType.XIANG_YAO_DING_ZHI);for(var i=0;i<e.length;i++){var n=e[i];if(n&&n.actid==t){var a=n.getSubInfo(n.curCfg.id);if(a&&a.status==0){return false}}}return true};e.SINGLE_KEY="xianyaodingzhi.XiangyaoDingZhiModel";return e}(app.ModelBase);t.XiangyaoDingZhiModel=e;var i=function(){function t(){}t.SYN_UPDATA_DATE="SYN_DATA";return t}();t.XiangyaoDingEvent=i})(xianyaodingzhi||(xianyaodingzhi={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("recharge_dingzhi.csv");this.cfgMap=t.getMap("id")};e.SINGLE_KEY="csv.XiangyaodingZhiProxy";return e}(app.ModelBase);t.XiangyaodingZhiProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var xianyaodingzhi;(function(i){var n=function(){function t(){}return t}();i.SelectVo=n;var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.model=i.XiangyaoDingZhiModel.getIns();this.btnchongzhi.clickHandler=new Laya.Handler(this,this.onClickHandler);this.jiahao.clickHandler=new Laya.Handler(this,this.onJiaHaoHandler)};e.prototype.onJiaHaoHandler=function(){this.openSelect()};e.prototype.onClickHandler=function(){this.openSelect()};e.prototype.openSelect=function(){var t=new n;t.cfg=this.cfg;t.index=this.index;t.xydzVo=this.vo;app.ViewManager.toggleDialog(i.XiangyaoDingZhiLibaoView,1,0,t)};e.prototype.setData=function(t,e,i,n,a){this.vo=t;this.index=n;this.cfg=e;this.clear();if(i!=game.GridsModel.EMPTY){var o=game.ItemUtil.createVO(i.itemID);o.setCount(i.value);this.gezi.setData(o);if(a.status==0){this.btnchongzhi.visible=true}}else{this.jiahao.visible=true;this.gezi.setData(game.GridsModel.EMPTY)}};e.prototype.clear=function(){var t=this;t.boxlock.visible=false;t.btnchongzhi.visible=false;t.xuanzhong.visible=false;t.jiahao.visible=false;t.imgjiaobiao.visible=false;t.imgzhuang.visible=false;t.imgte.visible=false;t.imgyixuanze.visible=false};return e}(ui.xiangyaodingzhi.xiangyaodingzhiitem02UI);i.XiangyaodingzhiGridItemView=t})(xianyaodingzhi||(xianyaodingzhi={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var xianyaodingzhi;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){};e.prototype.onUnDisplay=function(){this.tihuanani.stop();this.tihuanani.visible=false};e.prototype.setData=function(t,e,i){this.setLeftItemVo(t);this.imgyixuanze.visible=e;var n=t.itemCfg.reqLevel;if(game.Context.isTeamLvReach(n,false)){this.gezi.gray=false;this.jiahao.gray=false}else{this.boxlock.visible=true;this.gezi.gray=true;this.jiahao.gray=true}};e.prototype.setLeftItemVo=function(t){var e=this;e.boxlock.visible=false;e.btnchongzhi.visible=false;e.xuanzhong.visible=false;e.jiahao.visible=false;e.imgjiaobiao.visible=false;e.imgzhuang.visible=false;e.imgte.visible=false;e.imgyixuanze.visible=false;e.gezi.setData(t);e.gezi.gray=false;e.jiahao.gray=false;this.tihuanani.stop();this.tihuanani.visible=false};return e}(ui.xiangyaodingzhi.xiangyaodingzhiitem02UI);t.XiangYaoDingzhiItem02View=e;var i=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.initialize=function(){e.prototype.initialize.call(this);this.jiahao.clickHandler=new Laya.Handler(this,this.onJiaoBiaoClick)};t.prototype.onJiaoBiaoClick=function(){};t.prototype.setLeftItemVo=function(t){e.prototype.setLeftItemVo.call(this,t);if(t==game.GridsModel.EMPTY){this.jiahao.visible=true}};t.prototype.setData=function(t,e){this.setLeftItemVo(t);this.xuanzhong.visible=e};return t}(e);t.XiangYaoDingzhiSelectItemView=i})(xianyaodingzhi||(xianyaodingzhi={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var xianyaodingzhi;(function(p){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.dataList=[];return t}t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.itemdaoju02.itemRender=p.XiangyaodingzhiGridItemView;this.itemdaoju02.renderHandler=new Laya.Handler(this,this.onRenderHander);this.model=p.XiangyaoDingZhiModel.getIns();this.btnqianwangxuanze.clickHandler=new Laya.Handler(this,this.onGotoHandler)};Object.defineProperty(t.prototype,"cfg",{get:function(){return this.vo.actcfg},enumerable:true,configurable:true});t.prototype.onGotoHandler=function(){if(game.Context.getServerTime()>this.actVo.timeVo.endTime){manager.FlowManager.instance.flowByStyle1(app.getLang("huodong_text06"));return}var t=this.actVo.getSubInfo(this.cfg.id);if(!t){return}if(t.status==0){this.imgyigoumai.visible=false;if(this.hasEmpty()){var e=new p.SelectVo;e.cfg=this.cfg;e.index=0;e.xydzVo=this.vo;app.ViewManager.toggleDialog(p.XiangyaoDingZhiLibaoView,1,0,e)}else{var i=csv.RechargeProxy.getIns().cfgMap[this.cfg.p1];shop.ShopModel.getIns().chongzhi(i.id)}}else if(t.status==1){app.ProtocolRequest.RecvActPrizeReq(this.cfg.id)}else{}};t.prototype.onRenderHander=function(t,e){t.setData(this.vo,this.cfg,this.dataList[e],e,this.info)};t.prototype.onDisplay=function(){};t.prototype.onUnDisplay=function(){};t.prototype.onWidthChange=function(){this.imglibao.x=this.cliplibao.x+this.cliplibao.width-this.cliplibao.spaceX*this.cliplibao.value.length};t.prototype.hasEmpty=function(){for(var t=0;t<this.dataList.length;t++){var e=this.dataList[t];if(e==game.GridsModel.EMPTY){return true}}};t.prototype.setData=function(t,e){var i=csv.XiangyaodingZhiProxy.getIns().cfgMap[t.p2];if(!i){console.error(">>> cfgCls.Recharge_dingzhiXCfg id,cfgCls.Activity_tarenXCfg p2 = "+t.p2+" 找不到!")}this.vo=new p.XianyaoDingZhiVo(i,t);this.actVo=e;this.cliplibao.value=this.vo.getRMB();this.cliplibao.on(Laya.Event.RESIZE,this,this.onWidthChange);this.dataList=[];var n=false;for(var a=0;a<this.vo.count;a++){var o=this.model.getSelect(t.id,a);if(o==game.GridsModel.EMPTY){this.dataList.push(o);n=true}else{this.dataList.push(o)}}this.itemdaoju02.array=this.vo.rewardList;var s=this.vo.cfg.reward1.split("-");var r=game.ItemUtil.createVO(parseInt(s[0]));r.setCount(parseInt(s[1]));this.setLeftItemVo(this.itemdaoju01,r);game.RedDotView.removeFrom(this.btnqianwangxuanze);var l=e.getSubInfo(t.id);this.info=l;if(!l){return}if(!this.vo.rechargeCfg){return}this.labelxiangou.text=app.getLang("xiangyaodignzhi_01",this.info.num,this.vo.rechargeCfg.limit);if(l.status==0){this.isBuyed=false;this.gray=false;this.imgyigoumai.visible=false;this.btnqianwangxuanze.visible=true;if(n){this.btnqianwangxuanze.label=app.getLang("xiangyaodignzhi_05")}else{var h=csv.RechargeProxy.getIns().cfgMap[t.p1];this.btnqianwangxuanze.label=app.getLang("xiangyaodignzhi_06",app.convert_Yuan(h.recharge))}}else if(l.status==1){game.RedDotView.addTo(this.btnqianwangxuanze);this.btnqianwangxuanze.visible=true;this.btnqianwangxuanze.label=app.getLang("xiangyaodignzhi_07");this.gray=false;this.imgyigoumai.visible=false}else{this.isBuyed=true;this.imgyigoumai.visible=true;this.btnqianwangxuanze.visible=false;this.gray=true}};t.prototype.setLeftItemVo=function(t,e){t.boxlock.visible=false;t.btnchongzhi.visible=false;t.xuanzhong.visible=false;t.jiahao.visible=false;t.imgjiaobiao.visible=false;t.imgzhuang.visible=false;t.imgte.visible=false;t.gezi.setData(e);t.imgyixuanze.visible=false};return t}(ui.xiangyaodingzhi.xiangyaodingzhiitem01UI);p.XiangyaodingzhiItemView=t})(xianyaodingzhi||(xianyaodingzhi={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var xianyaodingzhi;(function(i){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.selectItemList=[];return t}t.prototype.initialize=function(){e.prototype.initialize.call(this);this.model=i.XiangyaoDingZhiModel.getIns();this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.btnqueding.clickHandler=new Laya.Handler(this,this.onQueDingHandle);this.btnquxiao.clickHandler=new Laya.Handler(this,this.onQuXiaoHander);this.watchBtn.clickHandler=new Laya.Handler(this,this.onWatchHandler);this.listdaojuxuanze.itemRender=i.XiangYaoDingzhiItem02View;this.listdaojuxuanze.renderHandler=new Laya.Handler(this,this.onGridHander);this.listdaojuxuanze.selectEnable=true;this.listdaojuxuanze.selectHandler=new Laya.Handler;this.itemlist.itemRender=i.XiangYaoDingzhiSelectItemView;this.itemlist.renderHandler=new Laya.Handler(this,this.onToplistHander);this.itemlist.selectEnable=true;this.itemlist.selectHandler=new Laya.Handler(this,this.onTopSelectHandler);var t=new Laya.Sprite;t.graphics.drawRect(0,0,this.width,this.height,"#ff0000");t.alpha=0;this.addChildAt(t,0);t.hitArea=new Laya.Rectangle(0,0,this.width,this.height);t.on(Laya.Event.CLICK,this,this.onBgClick)};t.prototype.onTopSelectHandler=function(t){if(t!=-1){var e=this.selectVo.xydzVo.rewardList[t];this.listdaojuxuanze.array=game.ItemUtil.parserList(e);this.refreshSelect()}};t.prototype.withOutEmpty=function(){for(var t=0;t<this.selectItemList.length;t++){if(this.selectItemList[t]==game.GridsModel.EMPTY){return false}}return true};t.prototype.refreshSelect=function(){var t=this.selectItemList[this.itemlist.selectedIndex];if(t!=undefined){if(t!=game.GridsModel.EMPTY){this.watchBtn.visible=true;this.setDesc(game.ItemUtil.getDesc(t));this.imgxuanze.visible=false;this.labeltitle.text=t.getName()+"x"+t.count;if(this.withOutEmpty()){this.btnqueding.label=app.getLang("button_name2");this.btnqueding.gray=false;this.btnqueding.mouseEnabled=true}else{this.btnqueding.label=app.getLang("xiangyaodignzhi_03");this.btnqueding.gray=false;this.btnqueding.mouseEnabled=true}}else{this.watchBtn.visible=false;this.labeltitle.text="";this.setDesc("");this.imgxuanze.visible=true;this.btnqueding.label=app.getLang("xiangyaodignzhi_03");this.btnqueding.gray=true;this.btnqueding.mouseEnabled=false}var e=105;var i=e+this.itemlist.spaceX;this.imgjiantou.x=this.itemlist.x+this.itemlist.selectedIndex*i+(e-60)/2}};t.prototype.onBgClick=function(){this.onCloseHandler()};t.prototype.onCloseHandler=function(){app.ViewManager.toggleDialog(t,-1)};t.prototype.onGridHander=function(t,e){var i=false;if(this.itemlist.selectedIndex!=-1&&this.selectItemList[this.itemlist.selectedIndex]!=game.GridsModel.EMPTY){var n=this.selectItemList[this.itemlist.selectedIndex];var a=t.dataSource;if(n&&a&&a.count==n.count&&n.itemCfg.id==a.itemCfg.id){i=true}}t.setData(t.dataSource,i,e);t.gezi.clickHandler=new Laya.Handler(this,this.onGridClick,[t.gezi])};t.prototype.onToplistHander=function(t,e){t.setData(t.dataSource,e==this.itemlist.selectedIndex);t.gezi.locktip=true};t.prototype.onGridClick=function(t,e){var i=e.itemCfg.reqLevel;if(game.Context.isTeamLvReach(i,false)){this.hideWarn();if(this.checkSame(e)){this.playEnd(e)}else{if(this.aniTween){return}var n=t.localToGlobal(new Laya.Point(t.parent.y,t.parent.y));var a=this.itemlist.getCell(this.itemlist.selectedIndex);var o=a.localToGlobal(new Laya.Point(a.parent.y,a.parent.y));this.aniTween=manager.ItemFlyManager.playFlyItemByPos(e,n,o,new Laya.Handler(this,this.playEnd,[e]),300)}}else{this.showWarn(app.getLang("xiangyaodignzhi_08",i))}};t.prototype.checkSame=function(t){var e=this.selectItemList[this.itemlist.selectedIndex];if(e!=game.GridsModel.EMPTY&&e!=undefined){if(e.itemCfg.id==t.itemCfg.id&&e.count==t.count){return true}}};t.prototype.playEnd=function(t){this.selectItemList[this.itemlist.selectedIndex]=t;this.itemlist.array=this.selectItemList;this.itemlist.refresh();this.listdaojuxuanze.refresh();this.refreshSelect();this.aniTween=null};t.prototype.onWatchHandler=function(){tip.TipManager.show(this.itemlist.selectedItem)};t.prototype.onQuXiaoHander=function(){this.onCloseHandler()};t.prototype.onQueDingHandle=function(t){if(this.btnqueding.label==app.getLang("button_name2")){var e=new CustomGiftData;e.cfgId=this.selectVo.cfg.id;e.vecItem=[];var i=[];for(var n=0;n<this.selectItemList.length;n++){var a=this.selectItemList[n];var o=new ItemData;o.itemID=a.itemCfg.id;o.value=a.count;e.vecItem.push(o)}i.push(e);app.ProtocolRequest.CustomGiftChoiceReq(i);this.onCloseHandler();return}var s=false;for(var n=0;n<this.selectItemList.length;n++){if(this.selectItemList[n]==game.GridsModel.EMPTY){this.itemlist.selectedIndex=n;s=true;break}}if(t!=undefined){this.itemlist.selectedIndex=t}else{if(!s){this.itemlist.selectedIndex=this.selectItemList.length-1}}};t.prototype.onDisplay=function(){this.hideWarn();if(!this.initBoxdaojuY){this.initBoxdaojuY=this.boxdaoju.y}if(!this.btnclose01Y){this.btnclose01Y=this.btnclose01.y;var t=this.btnclose01.localToGlobal(new Laya.Point(this.btnclose01.parent.x,this.btnclose01.parent.y));this.btnclose01.y=this.btnclose01Y-t.y+(Laya.stage.height-95);var e=new Laya.Point(this.imgzhezhao.x,this.imgzhezhao.y);var i=this.imgzhezhao.localToGlobal(new Laya.Point(this.imgzhezhao.parent.x,this.imgzhezhao.parent.y));this.imgzhezhao.x=e.x-i.x;this.imgzhezhao.y=e.y-i.y;this.imgzhezhao.width=Laya.stage.width;this.imgzhezhao.height=Laya.stage.height;this.boxkaiqi.hitArea=new Laya.Rectangle(0,0,this.imgzhezhao.width,this.imgzhezhao.height);this.boxkaiqi.on(Laya.Event.CLICK,this,this.hideWarn)}this.ani1.play(0,false);this.callLater(this.callLaterHandler)};t.prototype.showWarn=function(t){if(t===void 0){t=""}if(t!=""){this.txtkaiqi.text=t;this.boxkaiqi.visible=true}else{this.boxkaiqi.visible=false}};t.prototype.hideWarn=function(){this.boxkaiqi.visible=false};t.prototype.clear=function(){this.watchBtn.visible=false;this.labeltitle.text="";this.setDesc(app.getLang("xiangyaodignzhi_02"));this.btnqueding.label=app.getLang("xiangyaodignzhi_03")};t.prototype.setDesc=function(t){this.desctf.text=t;this.desctf.hitArea=new Laya.Rectangle(0,0,this.desctf.contextWidth,this.desctf.contextHeight);this.desctf.y=this.desctf.fontSize;this.desctf.size(this.desctf.width,this.desctf.contextHeight+this.desctf.fontSize);this.panelList.scrollTo(0,0);this.panelList.refresh();this.panelList.scrollRect=new Laya.Rectangle(0,0,this.desctf.contextWidth+this.desctf.fontSize,this.desctf.contextHeight+this.desctf.fontSize)};t.prototype.callLaterHandler=function(){this.clear();var t=this.dataSource;this.selectVo=t;this.selectItemList=[];this.cliplibao.value=t.xydzVo.getRMB();for(var e=0;e<t.xydzVo.rewardList.length;e++){var i=this.model.getSelect(t.cfg.id,e);if(i==game.GridsModel.EMPTY){this.selectItemList.push(game.GridsModel.EMPTY)}else{var n=game.ItemUtil.createVO(i.itemID);n.setCount(i.value);this.selectItemList.push(n)}}this.itemlist.array=this.selectItemList;this.onQueDingHandle(this.selectVo.index)};t.prototype.onUnDisplay=function(){this.listdaojuxuanze.selectedIndex=-1;this.itemlist.selectedIndex=-1;this.selectItemList=[]};return t}(ui.xiangyaodingzhi.xiangyaodingzhilibaoviewUI);i.XiangyaoDingZhiLibaoView=t})(xianyaodingzhi||(xianyaodingzhi={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var xianyaodingzhi;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.model=i.XiangyaoDingZhiModel.getIns();this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.activityTimeView=new activitytaren.ActivityTimeView(this.labeltime,new Laya.Handler(this,this.endTimeCallBack),app.getLang("huodong_text05"));this.listlibao.itemRender=i.XiangyaodingzhiItemView;this.listlibao.renderHandler=new Laya.Handler(this,this.onRenderHandler)};e.prototype.onRenderHandler=function(t,e){t.setData(t.dataSource,this.actVo)};e.prototype.endTimeCallBack=function(){this.labeltime.text=""};e.prototype.isSell=function(t){var e=this.actVo.getSubInfo(t);if(!e){return}return e.status==2};e.prototype.getNewList=function(){var t=this.actVo.cfgList;var e=[];for(var i=0;i<t.length;i++){if(!this.isSell(t[i].id)){e.push(t[i])}}for(var i=0;i<t.length;i++){if(this.isSell(t[i].id)){e.push(t[i])}}return e};e.prototype.onDisplay=function(){this.imgdiban.width=Laya.stage.width;this.imgdiban.height=Laya.stage.height;activitytaren.ActivityTaRenModel.getIns().on(activitytaren.ActivityTaRenModel.ACTIVIT_TAREN_EVENT.GET_MAIN_PANEL_INFO,this,this.onGetMainPanel);activitytaren.ActivityTaRenModel.getIns().on(activitytaren.ActivityTaRenModel.ACTIVIT_TAREN_EVENT.UPDATE_ACTIVIT_DATA,this,this.onCallLater);this.callLater(this.onCallLater)};e.prototype.onRefreshHandler=function(){this.listlibao.array=this.getNewList();this.listlibao.refresh()};e.prototype.endHandler=function(){this.activityTimeView.start(this.actVo.timeVo.endTime);this.onRefreshHandler()};e.prototype.onCallLater=function(){activitytaren.ActivityTaRenModel.getIns().getInfoByActID(this.actVo.actid,new Laya.Handler(this,this.endHandler))};e.prototype.onGetMainPanel=function(){this.onRefreshHandler()};e.prototype.onUnDisplay=function(){this.activityTimeView.stop();activitytaren.ActivityTaRenModel.getIns().off(activitytaren.ActivityTaRenModel.ACTIVIT_TAREN_EVENT.GET_MAIN_PANEL_INFO,this,this.onGetMainPanel);activitytaren.ActivityTaRenModel.getIns().off(activitytaren.ActivityTaRenModel.ACTIVIT_TAREN_EVENT.UPDATE_ACTIVIT_DATA,this,this.onCallLater)};e.SINGLE_KEY="xianyaodingzhi.XiangyaodingzhiView";return e}(ui.xiangyaodingzhi.xiangyaodingzhiviewUI);i.XiangyaodingzhiView=t})(xianyaodingzhi||(xianyaodingzhi={}));var xianyaodingzhi;(function(t){var e=function(){function t(t,e){this.cfg=t;this.actcfg=e;this.rewardList=[];if(t.select_item1!=""){this.rewardList.push(t.select_item1)}if(t.select_item2!=""){this.rewardList.push(t.select_item2)}if(t.select_item3!=""){this.rewardList.push(t.select_item3)}this.rechargeCfg=csv.RechargeProxy.getIns().cfgMap[e.p1];if(!this.rechargeCfg){game.Alert.show("recharge actcfg.p1:"+this.actcfg.p1+",没有数据");return this.actcfg.p1}}Object.defineProperty(t.prototype,"count",{get:function(){return this.rewardList.length},enumerable:true,configurable:true});t.prototype.getRMB=function(){var t=csv.RechargeProxy.getIns().cfgMap[this.actcfg.p1];if(!this.rechargeCfg){game.Alert.show(">> recharge actcfg.p1:"+this.actcfg.p1+",没有数据");return this.actcfg.p1}return app.convert_Yuan(t.recharge).toString()};return t}();t.XianyaoDingZhiVo=e})(xianyaodingzhi||(xianyaodingzhi={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var xinfa;(function(u){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){app.ViewManager.regist(u.XinFaXiuLianView,"zhuangbei.atlas","xinfa.atlas");app.ViewManager.regist(u.XinFaLevelUpView,"zhuangbei.atlas","xinfa.atlas","jineng.atlas");app.ViewManager.regist(u.XinFaFenJieView,"zhuangbei.atlas","xinfa.atlas");app.ViewManager.regist(u.XinFaBagView,"zhuangbei.atlas","xinfa.atlas");app.ViewManager.regist(u.XinFaGongMing,"zhuangbei.atlas","xinfa.atlas");app.ViewManager.regist(u.XinFaTupoXiaoHaoView,"zhuangbei.atlas","xinfa.atlas");game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.XIN_FA_XIULIAN,u.XinFaXiuLianView);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.XIN_FA_LEVEL_UP,u.XinFaLevelUpView);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.XIN_FA_BAG,u.XinFaBagView);csv.FunctionsProxy.getIns().on(csv.FunctionsProxy.EVENTS.CHANGE,this,this.onRedDotChange);u.XinFaModel.getIns().on(u.XinFaModel.EVENT_XINFA_XIULIAN_RED_CHECK,this,this.onXinFaXiuLianCheckHandler)};e.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.XinfaInfoAck,this,this.onXinfaInfoAckHandle);this.addMsgListener(app.ProtocolResponse.XinfaEquipAck,this,this.onXinfaEquipAckHandle);this.addMsgListener(app.ProtocolResponse.XinfaDecomposeAck,this,this.onXinfaDecomposeAckHandle);this.addMsgListener(app.ProtocolResponse.XinfaUpdateeAck,this,this.onXinfaUpdateeAckHandle);this.addMsgListener(app.ProtocolResponse.XinfaUnlockAck,this,this.onXinfaUnlockAckHandle);this.addMsgListener(app.ProtocolResponse.XinfaGongMingAttr,this,this.onXinfaGongMingAttrHandle);game.GridsModel.getIns().on(game.GridsModel.EVENTS.UPDATE,this,this.itemRefreshAll)};e.prototype.onXinfaGongMingAttrHandle=function(t,e){if(ent.DebugConfig.isDebugger){}u.XinFaModel.getIns().xinfared.refresh(e.roleid,e.gongmingid);u.XinFaModel.getIns().event(u.XinFaModel.EVENT_XINFA_XIULIAN_RED_CHECK)};e.prototype.onXinFaXiuLianCheckHandler=function(){this.onXiuLianCheck()};e.prototype.itemRefreshAll=function(){Laya.timer.callLater(this,this.onUpdateRedDot)};e.prototype.onXinfaInfoAckHandle=function(t,e){u.XinFaModel.getIns().data=e;u.XinFaModel.getIns().event(u.XinFaModel.XIN_FA_GET_INFO);this.onRedDotChange()};e.prototype.isDidAwear=function(t){var e=t.items[0];var i=e.items;for(var n=0;n<i.length;n++){var a=i[n];if(t.part==a.part){if(a.vecItem.length<=0){return false}break}}return true};e.prototype.onXinfaEquipAckHandle=function(t,e){if(e.result==1){var i=e.items[0];var n=u.XinFaModel.getIns().data;var a=n.xinfaArray;for(var o=0;o<a.length;o++){var s=a[o];if(Uint64.equal(s.id,e.roleid)){var r=s.items;if(r){for(var l=0;l<r.length;l++){var h=r[l];if(h.part==e.part){s.items=i.items;break}}}break}}if(this.isDidAwear(e)){manager.EffectManager.playStageEffect("skill_xiangqianchenggong")}u.XinFaModel.getIns().event(u.XinFaModel.XIN_FA_EQUIP_ACK);this.onRedDotChange()}else{if(ent.DebugConfig.isDebugger){console.log("******************心法镶嵌失败!!!")}}};e.prototype.onXinfaDecomposeAckHandle=function(t,e){if(e.result){u.XinFaModel.getIns().event(u.XinFaModel.XIN_FA_PILIAN_FENGJIE);this.onRedDotChange()}else{console.log("分解失败")}};e.prototype.onXinfaUpdateeAckHandle=function(t,e){if(e.result){var i=u.XinFaModel.getIns().data;var n=i.xinfaArray;for(var a=0;a<n.length;a++){var o=n[a];if(Uint64.equal(o.id,e.roleid)){var s=o.items;if(s){for(var r=0;r<s.length;r++){var l=s[r];if(l.part==e.part){l.lv=e.lv;break}}}break}}manager.EffectManager.playStageEffect("skill_shengjichenggong");u.XinFaModel.getIns().event(u.XinFaModel.XIN_FA_LEVEL_UP_SUCCEED);this.onRedDotChange()}else{if(ent.DebugConfig.isDebugger){console.log("******************心法升级失败!!!")}}};e.prototype.delayHandler=function(){u.XinFaTuPoView.getIns().isLock=false;u.XinFaModel.getIns().event(u.XinFaModel.XIN_FA_TUPO_EVENT)};e.prototype.onXinfaUnlockAckHandle=function(t,e){if(e.result){var i=u.XinFaModel.getIns().data;var n=i.xinfaArray;for(var a=0;a<n.length;a++){var o=n[a];if(Uint64.equal(o.id,e.roleid)){var s=o.items;var r=false;if(s){for(var l=0;l<s.length;l++){var h=s[l];if(h.part==e.part){h.lock=0;r=true}}}if(!r){var p=new XinfaItemData;p.part=e.part;p.lock=0;p.lv=0;p.vecItem=[];o.items.push(p)}break}}manager.EffectManager.playStageEffect("skill_tupochenggong");this.onRedDotChange()}else{}this.delayHandler()};e.prototype.onRedDotChange=function(){Laya.timer.callLater(this,this.onUpdateRedDot)};e.prototype.onUpdateRedDot=function(){this.onTuPoCheck();this.onXiuLianCheck();this.onCheckLevelUp();this.onBagCheck()};e.prototype.onXiuLianCheck=function(){var t=u.XinFaModel.getIns().getSelectRoleIndex();var e=u.XinFaModel.getIns().isHasGongMing();var i=u.XinFaModel.getIns().getSelectTuPoIndex();if(i!=-1||t!=-1||e){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.XIN_FA_XIULIAN)}else{game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.XIN_FA_XIULIAN)}};e.prototype.onTuPoCheck=function(){var t=u.XinFaModel.getIns().getSelectTuPoIndex();if(t!=-1){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.XIN_FA_TUPO)}else{game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.XIN_FA_TUPO)}};e.prototype.onBagCheck=function(){var t=csv.FunctionsProxy.ENUMS.XIN_FA_BAG;if(u.XinFaModel.getIns().isShowRedTab){game.ClosureManager.addDot(t)}else{game.ClosureManager.removeDot(t)}};e.prototype.onCheckLevelUp=function(){if(u.XinFaModel.getIns().isCanLevelUpByAllList()){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.XIN_FA_LEVEL_UP)}else{game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.XIN_FA_LEVEL_UP)}};return e}(app.ModuleBase);u.XinFaModule=t})(xinfa||(xinfa={}));var xinfa;(function(f){var t=function(){function t(){}return t}();f.IXinFaSuitResult=t;var e=function(){function t(){}t.prototype.isCanXiuLian=function(t,e){var i={};var n=f.XinFaModel.getIns().getXinfaItemData(t,parseInt(e.id));var a=f.XinFaNewRedModel.getIns().getEquipList(t,e);i.result=a;var o=false;if(n){if(n.vecItem.length>0){var s=n.vecItem[0];var r=s.itemId;var l=csv.XinFanProxy.getIns().cfgMap[r];if(a.isBestFull()){o=false}else{if(a.isLocked(r)){o=false}else{if(a.isNeedCheck(e)){if(a.isGetBest()==false){if(a.isContain(s.itemId)){o=false}else{if(a.isHaveEquipBag(l.postype)){o=true}}}}else{var h=f.XinFaModel.getIns().isBetterThanOther(t,r);if(h.length>0){i.result.betterId=h;o=true}}}}}else{if(n.lock==0){var p=e.type;var u=game.GridsModel.getIns().getGridByType(game.GridsModel.BAG_XINFA);var c=u.itemList;c=f.XinFaModel.getIns().filterEquip(t,c,p);if(c.length>0){var h=[];for(var g=0;g<c.length;g++){h.push(c[g].getItemId())}if(h.length>0){i.result.betterId=h;o=true}}}}}i.result.isHasRed=o;return i};t.prototype.getPosByCanXiulianIndex=function(t){var e=csv.XinFanProxy.getIns().posArr;for(var i=0;i<e.length;i++){var n=e[i];if(this.isCanXiuLian(t,n).result.isHasRed){return n.position}}return 0};t.prototype.getIsCanWear=function(t){var e=csv.XinFanProxy.getIns().posArr;for(var i=0;i<e.length;i++){var n=e[i];if(this.isCanXiuLian(t,n).result.isHasRed){return true}}};t.prototype.isLattleCanTuPo=function(t,e){var i=true;var n=f.XinFaModel.getIns().getXinfaItemData(t,parseInt(e.id));if(n){if(n.vecItem.length>0){i=false}else{if(n.lock==0){i=false}}}else{}if(i){var a=f.XinFaModel.getIns().getNeedCfg(e,t);var o=a.cost;var s=app.str2Array(o,"-");var r=game.ItemUtil.createVO(parseInt(s[0]));if(r){var l=game.GridsModel.getIns().getItemCount(r.getItemId());if(l>=parseInt(s[1])){return true}}}};t.prototype.getIsCanTuPo=function(t){var e=csv.XinFanProxy.getIns().posArr;for(var i=0;i<e.length;i++){var n=e[i];if(this.isLattleCanTuPo(t,n)){return true}}};return t}();f.XinFaLattleCanWear=e})(xinfa||(xinfa={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var xinfa;(function(I){function L(t){var e;if(t==2){e="0-1-2"}else{e="3-4-5-6-7-8"}return e}var w=function(){function t(){}Object.defineProperty(t.prototype,"lockCount",{get:function(){var t=0;if(this.lockItemid){for(var e in this.lockItemid){t++}}return t},enumerable:true,configurable:true});t.prototype.pushSuid=function(t,e){for(var i=0;i<this.suidIds.length;i++){var n=this.suidIds[i];var a=csv.XinFanProxy.getIns().xinfasuitMap[n];if(a.needid==csv.XinFanProxy.getIns().xinfasuitMap[t].needid){return}}for(var i=0;i<e.length;i++){this.lockItemid[e[i]]=true}this.suidIds.push(t)};t.prototype.isLocked=function(t){return this.lockItemid[t]==true};t.prototype.isNeedCheck=function(t){for(var e=0;e<this.list.length;e++){if(this.list[e].isNeedCheck(t)){return true}}};t.prototype.isContain=function(t){for(var e=0;e<this.list.length;e++){if(this.list[e].isContain(t)){return true}}};t.prototype.isBetterWithStar=function(t){for(var e=0;e<this.list.length;e++){if(this.list[e].isBetterWithStar(t)){return true}}};t.prototype.isHaveEquipBag=function(t){var e=L(t);for(var i=0;i<this.list.length;i++){var n=this.list[i];if(n.cfg.position==e){return n.res.matchs.length>0}}};t.prototype.isGetBest=function(){for(var t=0;t<this.list.length;t++){if(this.list[t].isGetBest()){return true}}return false};t.prototype.isBestFull=function(){for(var t=0;t<this.list.length;t++){if(this.list[t].isBestFull()){return true}}return false};t.prototype.print=function(){for(var t=0;t<this.list.length;t++){var e=this.list[t];console.log("###############################################");console.log("是否有需要的替换的心法:%s",e.res.matchs.length>0);var i=csv.XinFanProxy.getIns().xinfasuitMap[e.cfg.id];console.log("匹配上的套装id:%d 总共成功匹配的件数:%d 需要的装备id:%s,需要的数量%d",e.cfg.id,e.res.weards.length,i.needid,i.neednum);console.log("已经穿戴中的装备:",e.res.weards);console.log("背包中的装备:",e.res.matchs);console.log("###############################################")}};return t}();I.XingFaSuitCheck=w;var b=function(){function t(){}Object.defineProperty(t.prototype,"bagslist",{get:function(){return this.res.list},enumerable:true,configurable:true});t.prototype.isContain=function(t){var e=this.cfg.needid.split(";");if(e.indexOf(t.toString())!=-1){return true}};t.prototype.isBetterWithStar=function(t){for(var e=0;e<this.res.weards.length;e++){var i=this.res.weards[e];var n=csv.XinFanProxy.getIns().cfgMap[i];if(t>n.stars){return true}}};t.prototype.isGetBest=function(){if(this.res.weards.length>=this.cfg.neednum){return true}return false};t.prototype.isBestFull=function(){var t=this.res.unlockCnt;if(t==this.res.weards.length&&t==this.cfg.neednum){return true}return false};t.prototype.isNeedCheck=function(t){var e=this.cfg.position.split("-");return e.indexOf(t.position.toString())!=-1};return t}();var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){};e.prototype.initNewCfg=function(){if(!this._newSuitList){var t=csv.XinFanProxy.getIns().xinfasuitArr;var e=[];var i=[6,4,2];for(var n=0;n<i.length;n++){for(var a=0;a<t.length;a++){var o=t[a];var s=i[n];if(s==o.neednum&&o.position=="3-4-5-6-7-8"){e.push(o)}}}var r=[3,2];for(var l=0;l<r.length;l++){for(var a=0;a<t.length;a++){var o=t[a];var s=r[l];if(s==o.neednum&&o.position=="0-1-2"){e.push(o)}}}this._newSuitList=e}};e.prototype.addItems=function(t,e,i,n,a){var o={};o.weards=[];o.suitid=t.id;o.matchs=[];o.unlockCnt=a;o.list=[];var s=[];for(var r=0;r<i.length;r++){var l=parseInt(i[r]);var h=false;for(var p=0;p<n.length;p++){var u=n[p].itemId;if(u==l){h=true;if(o.weards.length<t.neednum){o.weards.push(u)}}}if(!h){s.push(l)}}if(o.weards.length>=t.neednum){o.isOK=true}else{o.isOK=false}for(var c=0;c<e.length;c++){var g=e[c];for(var p=0;p<s.length;p++){var f=s[p];if(f==g.itemId){o.list.push(g);if(o.matchs.indexOf(f)==-1){o.matchs.push(f)}}}}return o};e.prototype.getEquipList=function(t,e){var i=new w;var n=L(e.type);var a=[];i.list=a;i.suidIds=[];i.lockItemid={};this.initNewCfg();var o=I.XinFaModel.getIns().getUnlockCnt(t,e.type);var s=game.GridsModel.getIns().getGridByType(game.GridsModel.BAG_XINFA);var r=s.itemList;var l=[];for(var h=0;h<r.length;h++){var p=r[h];var u=new ItemInfoData;u.instId=p.getInstId();u.count=p.count;u.itemId=p.getItemId();l.push(u)}var c=I.XinFaModel.getIns().getEquiplist(t);var g=[];if(c){for(var h=0;h<c.length;h++){if(c[h].vecItem&&c[h].vecItem.length>0){g.push(c[h].vecItem[0])}}}for(var h=0;h<this._newSuitList.length;h++){var f=this._newSuitList[h];if(f.position==n){var d=f.needid;var y=d.split(";");var v=this.addItems(f,l,y,g,o);if(v.isOK){i.pushSuid(f.id,v.weards)}else{var _=v.matchs.length+v.weards.length;if(o-i.lockCount>=f.neednum){if(o>=f.neednum){if(_>0&&_>=f.neednum){var m=new b;m.res=v;m.cfg=f;if(m.bagslist.length>0||m.res.weards.length>=f.neednum){a.push(m);break}}}}}}}return i};e.SINGLE_KEY="xinfa.XinFaNewRedModel";return e}(app.ModelBase);I.XinFaNewRedModel=t})(xinfa||(xinfa={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("xinfaattr.csv");this.cfgMap=t.getMap("id");var e=app.Config.getResById("xinfacasepos.csv");this.positionMap=e.getMap("position");this.posMap=e.getMap("id");this.posArr=e.getArray();var i=app.Config.getResById("xinfacase.csv");this.xinfacaseMap=i.getMap("id");this.xinfacaseArr=i.getArray();this.lvMap=app.Config.getResById("xinfalv.csv").getMap("lv");this.maxLevel=0;for(var n in this.lvMap){if(parseInt(n)>this.maxLevel){this.maxLevel=parseInt(n)}}var a=app.Config.getResById("xinfasuit.csv");this.xinfasuitMap=a.getMap("id");this.xinfasuitArr=a.getArray();this.xinFaSuitVOList=[];for(var o=0;o<this.xinfasuitArr.length;o++){var s=this.xinfasuitArr[o];var r=parseInt(s.suitid);var l=this.isExistSuit(r);if(!l){var h=new xinfa.XinFaSuitVO;h.suitid=r;h.cfgList.push(s);this.xinFaSuitVOList.push(h)}else{l.cfgList.push(s)}}};e.prototype.isExistSuit=function(t){var e=this.xinFaSuitVOList;for(var i=0;i<e.length;i++){var n=e[i];if(n.suitid==t){return n}}return null};e.prototype.getSuitArrByItem=function(t){var e=[];for(var i=0;i<this.xinfasuitArr.length;i++){var n=this.xinfasuitArr[i];var a=app.str2Array(n.needid,";");if(a.indexOf(t)!=-1){e.push(n)}}return e};e.prototype.getSuitName=function(t){for(var e=0;e<this.xinfasuitArr.length;e++){var i=this.xinfasuitArr[e];var n=app.str2Array(i.needid,";");if(n.indexOf(t.toString())!=-1){return i}}};e.prototype.getAttrByLv=function(t){if(!t){return[]}var e=csv.XinFanProxy.getIns().lvMap[t];return Attributes.decode(e.attr).baseList};e.SINGLE_KEY="csv.XinFanProxy";return e}(app.ModelBase);t.XinFanProxy=e})(csv||(csv={}));var xinfa;(function(t){var e=function(){function t(){this.list=[]}t.prototype.hasRed=function(){if(this.list.length>0){return true}};t.prototype.isCheckBuSuitId=function(t,e){var i=this.getAllids(t);for(var n=0;n<i.length;n++){var a=i[n];for(var o=0;o<this.list.length;o++){var s=this.list[o];if(s.id==a&&Uint64.equal(e,s.roleId)){return true}}}};t.prototype.getAllids=function(t){var e=[];var i=csv.XinFanProxy.getIns().xinfasuitArr;for(var n=0;n<i.length;n++){var a=i[n];if(parseInt(a.suitid)==t){if(e.indexOf(parseInt(a.id))==-1){e.push(parseInt(a.id))}}}return e};t.prototype.clickRed=function(t,e){if(t){var i=this.getAllids(t.suitid);if(ent.DebugConfig.isDebugger){}app.ProtocolRequest.XinfaDelteRedPointReq(e,i)}};t.prototype.refreshByRole=function(t){var e=[];for(var i=0;i<this.list.length;i++){var n=this.list[i];if(!Uint64.equal(t,n.roleId)){e.push(n)}}return e};t.prototype.hasRedByRole=function(t){if(t){for(var e=0;e<this.list.length;e++){var i=this.list[e];if(Uint64.equal(t,i.roleId)){return true}}}};t.prototype.refresh=function(t,e){this.list=this.refreshByRole(t);for(var i=0;i<e.length;i++){var n={};n.roleId=t;n.id=e[i];this.list.push(n)}};return t}();t.XinFaRed=e})(xinfa||(xinfa={}));var xinfa;(function(g){var t=function(){function t(){}t.prototype.isSame=function(t,e,i){for(var n=0;n<t.length;n++){var a=t[n];if(a&&a.vecItem.length>0){var o=a.vecItem[0];var s=csv.XinFanProxy.getIns().cfgMap[o.itemId];if(s.postype==e&&s.subtype==i){return false}}}return true};t.prototype.checkRole=function(t,e){var i=e.getItemId();var n=csv.XinFanProxy.getIns().cfgMap[i];var a=parseInt(n.postype);var o=parseInt(n.stars);var s=parseInt(n.subtype);if(t.items&&t.items.length<=0){return true}var r=csv.XinFanProxy.getIns().posArr;for(var l=0;l<r.length;l++){var h=r[l];var p=g.XinFaModel.getIns().getXinfaItemData(t.id,parseInt(h.id));if(p){var u=parseInt(h.type);if(p.vecItem.length>0){if(u==a){var c=csv.XinFanProxy.getIns().cfgMap[p.vecItem[0].itemId];if(o>parseInt(c.stars)){return false}}}else{if(p.lock==0){if(u==a){if(this.isSame(t.items,a,s)){return false}}}}}}return true};t.prototype.isAllowRecovery=function(t){if(!t.serverData){return false}if(t.serverData&&t.itemCfg.type!=csv.ItemProxy.TYPES.XIN_FA){return false}var e=g.XinFaModel.getIns().data.xinfaArray;for(var i=0;i<e.length;i++){var n=e[i];if(Uint64.compare(n.id,Uint64.ZERO)!=0){if(this.checkRole(n,t)==false){return false}}}return true};t.prototype.sortHandle=function(t,e){var i=csv.XinFanProxy.getIns().cfgMap[parseInt(t.itemCfg.id)];var n=csv.XinFanProxy.getIns().cfgMap[parseInt(e.itemCfg.id)];if(i.postype>n.postype){return-1}else if(i.postype==n.postype){if(i.stars>n.stars){return-1}else if(i.stars==n.stars){if(i.id>n.id){return-1}else if(i.id<n.id){return 1}return 0}return 1}else if(i.postype<n.postype){return 1}};t.prototype.loginfo=function(t,e){if(e===void 0){e=""}for(var i=0;i<t.length;i++){var n=t[i];var a=csv.XinFanProxy.getIns().cfgMap[n.getItemId()];console.log(e+n.getItemId(),"postype",a.postype,"stars",a.stars,Math.random())}};t.prototype.sortList=function(t){t=t.sort(this.sortHandle);return t};return t}();g.XinFenJieCheck=t})(xinfa||(xinfa={}));var xinfa;(function(t){var e=function(){function t(t,e){this.btnleft=t;this.btnright=e}t.prototype.refresh=function(t,e,i){if(i===void 0){i=5}if(e<=i){this.btnleft.visible=this.btnright.visible=false}else{if(t<=0){this.btnright.visible=true;this.btnleft.visible=false}else{if(t+i>=e){this.btnright.visible=false;this.btnleft.visible=true}else{this.btnright.visible=true;this.btnleft.visible=true}}}};return t}();t.RightLeftManControl=e})(xinfa||(xinfa={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var xinfa;(function(o){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.ronglianbtn.label=app.getLang("xinfa_text_12");this.ronglianbtn.clickHandler=new Laya.Handler(this,this.onPiLiangHandle);this.baglist.itemRender=grids.GridView;this.baglist.renderHandler=grids.GridView.CommonItemRender;this.baglist.vScrollBarSkin=" ";this.jiahaobtn.visible=false};e.prototype.onPiLiangHandle=function(){app.ViewManager.toggleDialog(o.XinFaFenJieView,1,0)};e.prototype.onDisplay=function(){game.GridsModel.getIns().on(game.GridsModel.EVENTS.UPDATE,this,this.onUpdateHander);game.MoneyModel.getIns().on(game.MoneyModel.EVENTS.MONEY_CHANGE,this,this.onMoneyChange);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){game.GridsModel.getIns().off(game.GridsModel.EVENTS.UPDATE,this,this.onUpdateHander);game.MoneyModel.getIns().off(game.MoneyModel.EVENTS.MONEY_CHANGE,this,this.onMoneyChange)};e.prototype.onMoneyChange=function(){this.numlabel.text=game.MoneyModel.format(game.MoneyModel.getIns().getMoney(game.MoneyModel.MONEY_ENUM.XIN_FA_EXP))};e.prototype.onUpdateHander=function(){this.callLater(this.refreshAll)};Object.defineProperty(e.prototype,"openSize",{get:function(){return o.XinFaModel.getIns().openSize},enumerable:true,configurable:true});e.prototype.refreshAll=function(){var t=game.GridsModel.getIns().getGridByType(game.GridsModel.BAG_XINFA);var e=t.itemList.length;var i=[];i=i.concat(o.XinFaModel.getIns().xinFenJieCheck.sortList(t.itemList));for(var n=e;n<this.openSize;n++){i.push(game.GridsModel.EMPTY)}this.baglist.array=i;var a=game.ItemUtil.createVO(game.ItemUtil.ENUMS.XING_FA_ZHENQING);this.onMoneyChange();this.itemmoney.icon.width=40;this.itemmoney.icon.height=40;this.itemmoney.icon.skin=a.getIconUrl();this.ronglianglabel.text=a.getName();this.labelrongliang.text=app.getLang("xinfa_text_13",e,this.openSize)};return e}(ui.xinfaxiulian.xinfabeibaoviewUI);o.XinFaBagView=t})(xinfa||(xinfa={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var xinfa;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.setData=function(t,e){this.txtName.color=e;this.txtName.text=Attributes.getPropName(t.propId)+" +"+Attributes.getPropValue(t.propId,t.value,t.formula);this.txtValue.text=""};return e}(ui.common.commonattr2UI);t.XinFaCommonattr2UIView=e})(xinfa||(xinfa={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var xinfa;(function(n){var t=function(i){__extends(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}t.prototype.doClick=function(){if(this.dataSource==game.GridsModel.EMPTY||this.dataSource==game.GridsModel.LOCKED){}else{this.select=!this.select;n.XinFaModel.getIns().event(n.XinFaModel.XIN_FA_FENGJIE_SELECTED,[this.dataSource,this.select])}};Object.defineProperty(t.prototype,"select",{get:function(){return this._selected},set:function(t){this._selected=t},enumerable:true,configurable:true});t.prototype.setData=function(t,e){if(e===void 0){e=""}i.prototype.setData.call(this,t,e);this.select=n.XinFaFenJieView.getIns().selectList.indexOf(t)!=-1};return t}(grids.GridView);n.XinFaFeiJieItemView=t})(xinfa||(xinfa={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var xinfa;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.on(Laya.Event.CLICK,this,this.onClick)};e.prototype.onClick=function(){};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){this.shuxing.text=app.getLang(t.name)};e.SINGLE_KEY="xinfa.XinFaFenJieItem";return e}(ui.xinfaxiulian.xinfafenjiexuanzexialalitemUI);t.XinFaFenJieItem=e})(xinfa||(xinfa={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var xinfa;(function(l){var i;(function(t){t[t["Normal"]=2]="Normal";t[t["Better"]=4]="Better";t[t["Best"]=5]="Best";t[t["MushBest"]=6]="MushBest"})(i||(i={}));var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.curList=[];t.selectList=[];t.curId=0;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listMediator=new common.ListSelectMediator(this.listpinzhi,this.btnxiala,this.labelpinzhi,l.XinFaFenJieItem,new Laya.Handler(this,this.onListSelectHandler),31,200);var t=[{id:i.Normal,name:app.getLang("xinfa_text_14")},{id:i.Better,name:app.getLang("xinfa_text_15")},{id:i.Best,name:app.getLang("xinfa_text_16")}];this.dataList=t;this.listMediator.array=t;this.listbeibao.itemRender=l.XinFaFeiJieItemView;this.listbeibao.renderHandler=new Laya.Handler(this,this.onListRenderHandler);this.btnguanbi.clickHandler=new Laya.Handler(this,this.onClickHandle);this.btnguanbi.label=app.getLang("xinfa_text_12");this.updateMoneyIcon()};t.prototype.onListRenderHandler=function(t,e){t.setData(t.dataSource)};t.prototype.onClickHandle=function(){var t=[];for(var e=0;e<this.selectList.length;e++){t.push(this.selectList[e].serverData.instId)}if(t.length>0)app.ProtocolRequest.XinfaDecomposeReq(t)};t.prototype.onDisplay=function(){game.GridsModel.getIns().on(game.GridsModel.EVENTS.UPDATE,this,this.onUpdateEvt);l.XinFaModel.getIns().on(l.XinFaModel.XIN_FA_PILIAN_FENGJIE,this,this.onFenJieHandle);l.XinFaModel.getIns().on(l.XinFaModel.XIN_FA_FENGJIE_SELECTED,this,this.onSelectItemHandle);this.callLater(this.refreshAll)};t.prototype.onSelectItemHandle=function(t,e){if(e){if(this.selectList.indexOf(t)==-1){this.selectList.push(t)}}else{var i=this.selectList.indexOf(t);if(i!=-1){this.selectList.splice(i,1)}}this.onUpdateEvt()};t.prototype.filter=function(t,e){var i=[];for(var n=0;n<t.length;n++){var a=t[n];var o=a.getItemId();var s=csv.XinFanProxy.getIns().cfgMap[o];var r=parseInt(s.stars);if(r<=e){if(l.XinFaModel.getIns().isAllowRecovery(a,true)){i.push(a)}}}i=l.XinFaModel.getIns().xinFenJieCheck.sortList(i);return i};t.prototype.onListSelectHandler=function(t){this.curId=t;var e=game.GridsModel.getIns().getGridByType(game.GridsModel.BAG_XINFA);var i=[];var n=this.filter(e.itemList,t);i=i.concat(n);this.selectList=n;for(var a=i.length;a<l.XinFaModel.getIns().openSize;a++){i.push(game.GridsModel.EMPTY)}this.curList=i;this.listbeibao.array=i;this.onUpdateEvt()};t.prototype.onFenJieHandle=function(){this.onListSelectHandler(this.curId)};t.prototype.onUnDisplay=function(){game.GridsModel.getIns().off(game.GridsModel.EVENTS.UPDATE,this,this.onUpdateEvt);l.XinFaModel.getIns().off(l.XinFaModel.XIN_FA_FENGJIE_SELECTED,this,this.onSelectItemHandle);l.XinFaModel.getIns().off(l.XinFaModel.XIN_FA_PILIAN_FENGJIE,this,this.onFenJieHandle)};t.prototype.updateMoneyIcon=function(){var t=game.ItemUtil.createVO(game.ItemUtil.ENUMS.XING_FA_ZHENQING);this.itemmoney.icon.width=40;this.itemmoney.icon.height=40;this.itemmoney.icon.skin=t.getIconUrl()};t.prototype.refreshAll=function(){this.listMediator.init();this.selectList=[];this.onListSelectHandler(this.dataList[0].id);this.onUpdateEvt()};t.prototype.onUpdateEvt=function(){this.labelxuanzhongnum.text=app.getLang("xinfa_text_18",this.selectCnt,l.XinFaModel.getIns().openSize);this.updateGetZhengQi()};t.prototype.calcaulateCnt=function(t){var e=csv.XinFanProxy.getIns().cfgMap[t];var i=e.recovery;var n=app.str2Array(i,"-");return parseInt(n[1])};Object.defineProperty(t.prototype,"selectCnt",{get:function(){return this.selectList.length},enumerable:true,configurable:true});t.prototype.updateGetZhengQi=function(){var t=0;var e=this.selectList;for(var i=0;i<e.length;i++){var n=e[i];if(n==game.GridsModel.EMPTY||n==game.GridsModel.LOCKED){}else{t+=this.calcaulateCnt(n.getItemId())}}this.labelnum.text=t.toString()};t.SINGLE_KEY="xinfa.XinFaFenJieView";return t}(ui.xinfaxiulian.xinfafenjieviewUI);l.XinFaFenJieView=t})(xinfa||(xinfa={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var xinfa;(function(h){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listyeqian.itemRender=ui.xinfaxiulian.xinfagongmingitemUI;this.listyeqian.renderHandler=new Laya.Handler(this,this.onRenderHandler);this.listyeqian.selectEnable=true;this.listyeqian.selectHandler=new Laya.Handler(this,this.onSelectHandler);this.xfList=new h.XinFaLatticeList(this,h.XinFaShowItemView);this.xfList.selectHandler=new Laya.Handler(this,this.onSelectHandle);this.xfList.unselectHandler=new Laya.Handler(this,this.unselectHandler);this.listPanel.vScrollBarSkin=" ";this.listPanel.scrollRect=new Laya.Rectangle(0,0,this.listPanel.width,this.listPanel.height)};e.prototype.unselectHandler=function(t,e){t.setSelect(false)};e.prototype.onSelectHandle=function(t,e){};Object.defineProperty(e.prototype,"role",{get:function(){return this.dataSource[0]},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"isOther",{get:function(){return this.dataSource[1]==true},enumerable:true,configurable:true});e.prototype.setItemRed=function(t,e){if(e){game.RedDotView.addTo(t,t.width-5,5)}else{game.RedDotView.removeFrom(t)}};e.prototype.onRenderHandler=function(t,e){var i=t.dataSource;t.btnyeqian.selected=i.selected;t.btnName.text=i.getName();t.btnName.color=i.getNameColor();t.imgxuanzhong.visible=i.selected;var n=app.str2Array(i.cfg.needid,";");t.labelxinxi.text=h.XinFaModel.getIns().getSuitCount(this.role,n)+"/"+n.length;var a=h.XinFaModel.getIns().xinfared.isCheckBuSuitId(i.suitid,this.role);this.setItemRed(t,a)};e.prototype.onItemClick=function(t){if(t){h.XinFaModel.getIns().xinfared.clickRed(t,this.role)}};e.prototype.onSelectHandler=function(t){this._oldIndex=t;var e=csv.XinFanProxy.getIns().xinFaSuitVOList;var i=null;for(var n=0;n<e.length;n++){var a=e[n];if(n==t){i=a;a.selected=true}else{a.selected=false}}this.listyeqian.refresh();this.xfList.refreshData(this.role,i);this.refreshListPanel(i.cfgList);if(this.isOther){}else{if(this.isfirstClick){this.isfirstClick=false}else{this.onItemClick(i)}}};e.prototype.addLine=function(t){if(this.line){this.line.removeSelf();Laya.Pool.recover("Line",this.line)}var e=Laya.Pool.getItemByClass("Line",Laya.Sprite);e.graphics.drawRect(0,0,this.listPanel.width,20,"#ff0000");e.alpha=0;this.listPanel.addChild(e);e.y=t-2;this.line=e};e.prototype.refreshListPanel=function(t){if(!this.displays){this.displays=[]}while(this.displays.length){var e=this.displays.pop();if(e&&e.parent){e.removeSelf();Laya.Pool.recover("XinFaGongMingItemView",e)}}var i=20;for(var n=0;n<t.length;n++){var a=Laya.Pool.getItemByClass("XinFaGongMingItemView",h.XinFaGongMingItemView);var o=t[n];var s=h.XinFaModel.getIns().getSuitCntByCfgList(this.role,o);var r=parseInt(o.neednum);var l=game.STYLES.GRAY_COLOR_S;if(s>=r){l=game.STYLES.GREEN_COLOR_S}a.setData(this.role,o,l);this.listPanel.addChild(a);a.y=i;i+=a.realHeight;this.displays.push(a)}this.addLine(i);this.onRefresh()};e.prototype.onRefresh=function(){this.listPanel.refresh();this.listPanel.vScrollBar.stopScroll();this.listPanel.vScrollBar.value=0};e.prototype.onXinFaXiuLianCheckHandler=function(){this.listyeqian.refresh()};e.prototype.onDisplay=function(){h.XinFaModel.getIns().on(h.XinFaModel.EVENT_XINFA_XIULIAN_RED_CHECK,this,this.onXinFaXiuLianCheckHandler);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){h.XinFaModel.getIns().off(h.XinFaModel.EVENT_XINFA_XIULIAN_RED_CHECK,this,this.onXinFaXiuLianCheckHandler)};e.prototype.refreshAll=function(){var t=csv.XinFanProxy.getIns().xinFaSuitVOList;this.listyeqian.array=t;if(t.length){if(!this.isOther){this.isfirstClick=true}if(this.listyeqian.selectedIndex==this._oldIndex){this.listyeqian.selectedIndex=0;this.onSelectHandler(0)}else{this.listyeqian.selectedIndex=0}}};return e}(ui.xinfaxiulian.xinfagongmingviewUI);h.XinFaGongMing=t})(xinfa||(xinfa={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var xinfa;(function(s){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.GAP=10;return t}t.prototype.initialize=function(){e.prototype.initialize.call(this)};t.prototype.setData=function(t,e,i){this.labelshuxing01.text=app.getLang("xinfa_text_6",parseInt(e.neednum));this.labelshuxing01.color=i;var n=Attributes.decode(e.suitprop).baseList;this.realHeight=this.refershProps(n,i);this.realHeight+=this.createSkillDesc(this.realHeight,e,i)};t.prototype.refershProps=function(t,e){if(!this.displays){this.displays=[]}while(this.displays.length){var i=this.displays.pop();if(i&&i.parent){i.removeSelf();Laya.Pool.recover("XinFaCommonattr2UIView",i)}}var n=0;for(var a=0;a<t.length;a++){var o=Laya.Pool.getItemByClass("XinFaCommonattr2UIView",s.XinFaCommonattr2UIView);o.setData(t[a],e);o.x=this.labelshuxing01.x+this.labelshuxing01.width;this.addChild(o);o.y=n;n+=o.height+this.GAP;this.displays.push(o)}return n};t.prototype.createSkillDesc=function(t,e,i){var n=0;if(this.commonattr){this.commonattr.removeSelf();Laya.Pool.recover("ui.common.commonattr7UI",this.commonattr)}if(e.suitskill&&e.suitskill.length>0){var a=e.suitskill.split("-");var o=csv.SkillProxy.getIns().getCfg(a[0],parseInt(a[1])).explain;if(o&&o.length>0){var s=Laya.Pool.getItemByClass("ui.common.commonattr7UI",ui.common.commonattr7UI);s.txtvalue.wordWrap=true;s.txtvalue.width=278;s.txtvalue.text=app.getLang(o);s.txtvalue.color=i;s.x=this.labelshuxing01.x+this.labelshuxing01.width;s.y=t;this.addChild(s);n+=s.txtvalue.contextHeight+this.GAP;this.commonattr=s;s.height=s.txtvalue.contextHeight}}return n};return t}(ui.xinfaxiulian.xinfagongmingitem01UI);s.XinFaGongMingItemView=t})(xinfa||(xinfa={}));var xinfa;(function(t){var r;(function(t){t[t["Other"]=0]="Other";t[t["LevelUp"]=1]="LevelUp"})(r=t.EListType||(t.EListType={}));var e=function(){function t(t,e,i,n,a){if(i===void 0){i="itemzhuangbei_0"}if(n===void 0){n=9}if(a===void 0){a=r.Other}this.latticeList=[];for(var o=0;o<n;o++){var s=new e(o,t[i+(o+1).toString()]);s.listType=a;s.selectHandler=new Laya.Handler(this,this.onSelectHandle);this.latticeList.push(s)}}t.prototype.onSelectHandle=function(t){if(this.curSelect){if(this.unselectHandler){this.unselectHandler.runWith([this.curSelect,this.curSelect.index])}}this.curSelect=t;this.selectHandle(t,t.index)};t.prototype.selectHandle=function(t,e){if(this.selectHandler){this.selectHandler.runWith([t,e])}};t.prototype.selectByIndex=function(t){for(var e=0;e<this.latticeList.length;e++){var i=this.latticeList[e];if(i.index==t){i.selectItem();break}}};t.prototype.getItemByIndex=function(t){for(var e=0;e<this.latticeList.length;e++){var i=this.latticeList[e];if(i.index==t){return i}}};t.prototype.refreshData=function(t,e,i){var n=this.latticeList;for(var a=0;a<n.length;a++){var o=csv.XinFanProxy.getIns().positionMap[a];var s=n[a];s.setData(o,t,e,i)}};t.prototype.setOther=function(t){var e=this.latticeList;for(var i=0;i<e.length;i++){var n=e[i];n.other=t}};t.prototype.getPos=function(t){var e=this.latticeList;for(var i=0;i<e.length;i++){var n=csv.XinFanProxy.getIns().positionMap[i];if(t==parseInt(n.position)){return i}}};return t}();t.XinFaLatticeList=e})(xinfa||(xinfa={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var xinfa;(function(d){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.roleSelectIndex=0;t.equipSelectIndex=0;return t}t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.roleMediator=new common.RoleListMediator(this.itemxuanze.xuanzelist,equip.RoleItem,new Laya.Handler(this,this.onRoleSelectHandle));this.imgtishi.removeSelf();this.xfList=new d.XinFaLatticeList(this,d.XinFaXiuLianItem,"itemzhuangbei_0",9,d.EListType.LevelUp);this.xfList.selectHandler=new Laya.Handler(this,this.onXinFaListSelectHandle);this.xfList.unselectHandler=new Laya.Handler(this,this.unselectHandler);this.listshuxing01.itemRender=ui.common.commonattr1UI;this.listshuxing01.renderHandler=new Laya.Handler(this,this.onlistshuxing01);this.listshuxing02.itemRender=ui.common.commonattr1UI;this.listshuxing02.renderHandler=new Laya.Handler(this,this.onlistshuxing01);this.listshuxing03.itemRender=ui.common.commonattr1UI;this.listshuxing03.renderHandler=new Laya.Handler(this,this.onlistshuxing01);this.animationtupo.stop();this.animationtupo.visible=false;this.btntupo.label=app.getLang("xinfa_text_11");this.btntupo.clickHandler=new Laya.Handler(this,this.onLevelUpHandler);this.labeltishi.text="";this.labeltip.text=app.getLang("xinfa_text_21")};t.prototype.onXinFaListSelectHandle=function(t,e){if(t.isUnLock){t.setSelect(true)}this.onSelectHandler(e)};t.prototype.unselectHandler=function(t,e){t.setSelect(false)};t.prototype.updateBtnStatus=function(){};Object.defineProperty(t.prototype,"selectXinFaLvVO",{get:function(){for(var t=0;t<this._newArr.length;t++){var e=this._newArr[t];var i=e.posCfg;if(i.position==this.equipSelectIndex){return e}}},enumerable:true,configurable:true});t.prototype.onLevelUpHandler=function(){var t=this.selectXinFaLvVO;if(t){var e=parseInt(t.posCfg.id);var i=d.XinFaModel.getIns().getLvStatus(this.roleID,e);if(i==d.XIN_LV_STATUS.ITEM_NOT_ENOUGH){var n=d.XinFaModel.getIns().getLevel(this.roleID,e);var a=csv.XinFanProxy.getIns().lvMap[n+1];if(a){var o=app.str2Array(a.cost,"-");var s=game.ItemUtil.createVO(parseInt(o[0]));manager.FlowManager.instance.flowByStyle1(app.getLang("item_not_enough",s.getName()))}return}else if(i==d.XIN_LV_STATUS.IS_MAX_LEVEL){manager.FlowManager.instance.flowByStyle1(app.getLang("xinfa_text_23"));return}else if(i==d.XIN_LV_STATUS.QUA_LIMT){manager.FlowManager.instance.flowByStyle1(app.getLang("xinfa_text_19"));return}d.XinFaModel.getIns().once(d.XinFaModel.XIN_FA_LEVEL_UP_SUCCEED,this,this.xinFaLevelUp);app.ProtocolRequest.XinfaUpdateReq(this.roleID,e)}};t.prototype.xinFaLevelUp=function(){this.xfList.refreshData(this.roleID);this.onSelectHandler(this.equipSelectIndex);this.refreshHeads()};t.prototype.onlistshuxing01=function(t,e){var i=t.dataSource;t.txtName.text=Attributes.getPropName(i.propId);t.txtValue.text="+"+Attributes.getPropValue(i.propId,i.value,i.formula)};t.prototype.setBtnEffect=function(t){if(t){game.RedDotView.addTo(this.btntupo)}else{game.RedDotView.removeFrom(this.btntupo)}};t.prototype.getLvLabel=function(t){return"Lv "+t};t.prototype.setPre=function(t,e){};t.prototype.onSelectHandler=function(t){if(t==-1){return}if(!this.xfList.getItemByIndex(t).isUnLock){return}this.imgtishi2.visible=false;this.equipSelectIndex=t;var e;this.noAttr.visible=false;this.labelshuxing01.text="";var i=this.selectXinFaLvVO;var n=false;if(i){var a=i.posCfg;e=a;var o=d.XinFaModel.getIns().getXinFaId(this.roleID,a.id);if(o){this.allAttr.visible=true;n=true}this.xinfaName.text=i.getName();this.imgxinfa.skin=""}for(var s=0;s<this._newArr.length;s++){var r=this._newArr[s];if(i&&i==r){r.isSelect=true}else{r.isSelect=false}}if(n&&e){var l=d.XinFaModel.getIns().getLevel(this.roleID,parseInt(e.id));if(l>=csv.XinFanProxy.getIns().maxLevel){this.boxshuxing.visible=true;this.labelshuxing03.text=this.getLvLabel(l);var h=csv.XinFanProxy.getIns().getAttrByLv(l);this.listshuxing03.array=h;this.listshuxing01.visible=false;this.labelshuxing01.visible=false;this.listshuxing02.visible=false;this.imgjiantou.visible=false;this.labelshuxing02.text="";this.boxshengjixiaohao.visible=false;this.imgyimanji.visible=true}else{this.labelshuxing01.visible=true;if(l<=0){this.labelshuxing01.text="";this.noAttr.visible=true}else{this.labelshuxing01.text=this.getLvLabel(l)}this.listshuxing01.visible=true;this.listshuxing01.array=csv.XinFanProxy.getIns().getAttrByLv(l);this.boxshuxing.visible=false;this.imgyimanji.visible=false;this.listshuxing02.visible=true;this.imgjiantou.visible=true;var p=l+1;this.listshuxing02.array=csv.XinFanProxy.getIns().getAttrByLv(p);this.labelshuxing02.text=this.getLvLabel(p);this.boxshengjixiaohao.visible=true;var u=csv.XinFanProxy.getIns().lvMap[p];if(u){var c=app.str2Array(u.cost,"-");var g=game.ItemUtil.createVO(parseInt(c[0]));g.setCount(parseInt(c[1]));if(g){game.ItemShowUtil.showType1(g,this.itemxiaohao,this.labelnum,true)}}var f=d.XinFaModel.getIns().isCanLv(this.roleID,parseInt(e.id));this.setBtnEffect(f);if(!d.XinFaModel.getIns().isQuaOk(this.roleID,e.id)){this.boxshengjixiaohao.visible=false;this.labeltishi.text=app.getLang("xinfa_text_19")}else{this.boxshengjixiaohao.visible=true;this.labeltishi.text=""}}if(e){this.setPre(e,this.roleID)}}else{this.labeltishi.text="";this.imgyimanji.visible=false;this.allAttr.visible=false;this.boxshuxing.visible=false;this.boxshengjixiaohao.visible=false;this.xinfaName.text="";this.imgxinfa.skin=d.XinFaModel.getIns().getTitleImg(this.xfList.getItemByIndex(t).cfg);this.imgtishi2.visible=true}};Object.defineProperty(t.prototype,"allAttr",{get:function(){return this.boxshuxingyulan},enumerable:true,configurable:true});t.prototype.onRareRender=function(t,e){t.setData(this.roleID)};t.prototype.onRoleSelectHandle=function(){this.roleSelectIndex=this.roleMediator.selectedIndex;this.equipSelectIndex=this.getCanLvEquipIndex(game.Context.roleList[this.roleSelectIndex].insId);this.roleSelectChange();this.onSelectHandler(this.equipSelectIndex)};t.prototype.onDisplay=function(){game.MoneyModel.getIns().on(game.MoneyModel.EVENTS.MONEY_CHANGE,this,this.onUpdate);game.GridsModel.getIns().on(game.GridsModel.EVENTS.UPDATE,this,this.onUpdate);this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){game.GridsModel.getIns().off(game.GridsModel.EVENTS.UPDATE,this,this.onUpdate);game.MoneyModel.getIns().off(game.MoneyModel.EVENTS.MONEY_CHANGE,this,this.onUpdate)};t.prototype.onUpdate=function(){this.roleSelectChange();this.onSelectHandler(this.equipSelectIndex)};t.prototype.getCanLevelUpIndex=function(){var t=d.XinFaModel.getIns().getLevelUpRoleRedArr();for(var e=0;e<t.length;e++){if(t[e]){return e}}return 0};t.prototype.getCanLvEquipIndex=function(t){var e=csv.XinFanProxy.getIns().posArr;for(var i=0;i<e.length;i++){var n=e[i];if(d.XinFaModel.getIns().isCanLv(t,parseInt(n.id))){return n.position}}for(var i=0;i<e.length;i++){var n=e[i];if(d.XinFaModel.getIns().getIsOpen(t,n.id)){return n.position}}return 0};t.prototype.refreshAll=function(){this.roleSelectIndex=this.getCanLevelUpIndex();this.refreshHeads();this.equipSelectIndex=this.getCanLvEquipIndex(game.Context.roleList[this.roleSelectIndex].insId);this.roleSelectChange()};Object.defineProperty(t.prototype,"roleID",{get:function(){return this.roleMediator.selectedRoleVo.insId},enumerable:true,configurable:true});t.prototype.refreshHeads=function(){this.roleMediator.setData(this.roleSelectIndex,d.XinFaModel.getIns().getLevelUpRoleRedArr())};t.prototype.roleSelectChange=function(){this.refreshHeads();this._newArr=d.XinFaModel.getIns().refreshNewArr(this.roleID);this.updateBtnStatus();this.xfList.refreshData(this.roleID);this.xfList.selectByIndex(this.equipSelectIndex)};return t}(ui.xinfaxiulian.xinfashengjiviewnewUI);d.XinFaLevelUpView=t})(xinfa||(xinfa={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var xinfa;(function(t){var e=function(s){__extends(t,s);function t(t,e){var i=s.call(this,t,e)||this;i._isUnLock=false;return i}Object.defineProperty(t.prototype,"isUnLock",{get:function(){return this._isUnLock},enumerable:true,configurable:true});t.prototype.onMouseUpEvt=function(){if(this.itemVo){tip.TipManager.showxinfa(this.itemVo)}};t.prototype.setData=function(t,e,i){var n=i.getPart(t.position);if(n){this._isUnLock=true}else{this._isUnLock=false}s.prototype.setData.call(this,t,e,i);var a=this.skin.imgicon;if(n){var o=this.skin.imgicon;o.skin=n.getIconUrl();this.setQuality(n.getXfQuality())}else{a.skin="";this.setQuality()}this.itemVo=n};return t}(t.XinFaLatticeView);t.XinFaShowItemView=e})(xinfa||(xinfa={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var xinfa;(function(h){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.isLock=false;t.roleSelectIndex=0;t.equipSelectIndex=0;t.LimitMS=200;t.curtime=0;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.roleMediator=new common.RoleListMediator(this.itemxuanze.xuanzelist,equip.RoleItem,new Laya.Handler(this,this.onRoleSelectHandle));this.xfList=new h.XinFaLatticeList(this,h.XinFaLatticeView);this.xfList.selectHandler=new Laya.Handler(this,this.onSelectHandle);this.xfList.unselectHandler=new Laya.Handler(this,this.unselectHandler);this.btntupo.clickHandler=new Laya.Handler(this,this.tuPoHandle);this.animationtupo.stop();this.animationtupo.visible=false;this.setBtnEffect(false);this.tishitip.text=app.getLang("xinfa_text_22")};t.prototype.setBtnEffect=function(t){if(t){game.RedDotView.addTo(this.btntupo)}else{game.RedDotView.removeFrom(this.btntupo)}};t.prototype.onTuPoEvt=function(){this.roleSelectChange()};t.prototype.tuPoHandle=function(){var t=Laya.timer.currTimer-this.curtime;if(t<this.LimitMS){return}this.curtime=Laya.timer.currTimer;h.XinFaModel.getIns().once(h.XinFaModel.XIN_FA_TUPO_EVENT,this,this.onTuPoEvt);if(this.isLock){return}if(this.curSelectItem){this.isLock=true;var e=parseInt(this.curSelectItem.cfg.id);app.ProtocolRequest.XinfaUnlockReq(this.roleID,e)}};t.prototype.unselectHandler=function(t,e){t.setSelect(false)};Object.defineProperty(t.prototype,"roleID",{get:function(){return this.roleMediator.selectedRoleVo.insId},enumerable:true,configurable:true});t.prototype.onSelectHandle=function(t,e){this.equipSelectIndex=e;t.setSelect(true);this.curSelectItem=t;var i=t.cfg;this.imgname.skin=h.XinFaModel.getIns().getTitleImg(i);var n=h.XinFaModel.getIns().getNeedCfg(i,this.roleID);var a=n.cost;var o=app.str2Array(a,"-");var s=game.ItemUtil.createVO(parseInt(o[0]));s.setCount(parseInt(o[1]));var r=false;if(s){r=game.ItemShowUtil.showType1(s,this.itemdaoju,this.labelnum,true)}var l=false;if(r&&h.XinFaModel.getIns().isAllUnLock(this.roleID)){l=true}this.setBtnEffect(l)};t.prototype.updateLattice=function(){};t.prototype.onDisplay=function(){game.MoneyModel.getIns().on(game.MoneyModel.EVENTS.MONEY_CHANGE,this,this.onUpdate);game.GridsModel.getIns().on(game.GridsModel.EVENTS.UPDATE,this,this.onUpdate);this.callLater(this.refreshAll)};t.prototype.onUpdate=function(){this.roleSelectChange()};t.prototype.onRoleSelectHandle=function(){this.equipSelectIndex=0;this.roleSelectIndex=this.roleMediator.selectedIndex;this.roleSelectChange()};t.prototype.roleSelectChange=function(){var t=h.XinFaModel.getIns().getNearPosByRoldID(this.roleID);if(t==undefined){this.equipSelectIndex=0;this.tupoview.visible=false;this.btntupo.visible=false;this.tishitip.visible=true}else{this.tupoview.visible=true;this.equipSelectIndex=this.xfList.getPos(t);this.btntupo.visible=true;this.tishitip.visible=false}this.refreshHeads();this.xfList.refreshData(this.roleID,undefined,true);this.xfList.selectByIndex(this.equipSelectIndex)};t.prototype.onUnDisplay=function(){this.isLock=false;this.curSelectItem=null;game.GridsModel.getIns().off(game.GridsModel.EVENTS.UPDATE,this,this.onUpdate);game.MoneyModel.getIns().off(game.MoneyModel.EVENTS.MONEY_CHANGE,this,this.onUpdate)};t.prototype.refreshHeads=function(){this.roleMediator.setData(this.roleSelectIndex,h.XinFaModel.getIns().getTupoReds())};t.prototype.refreshAll=function(){var t=h.XinFaModel.getIns().getSelectTuPoIndex();if(t==-1){t=0}this.roleSelectIndex=t;this.refreshHeads();this.roleSelectChange()};t.SINGLE_KEY="xinfa.XinFaTuPoView";return t}(ui.xinfaxiulian.xueweitupoviewUI);h.XinFaTuPoView=t})(xinfa||(xinfa={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var xinfa;(function(o){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.btntupo.clickHandler=new Laya.Handler(this,this.onClickHanlder)};e.prototype.onClickHanlder=function(){app.ProtocolRequest.XinfaUnlockReq(this.uid,parseInt(this.cfg.id));this.close()};e.prototype.onDisplay=function(){this.callLater(this.callLayerHandler)};e.prototype.callLayerHandler=function(){this.uid=this.dataSource[0];this.cfg=this.dataSource[1];var t=o.XinFaModel.getIns().getNeedCfg(this.cfg,this.uid);var e=t.cost;var i=app.str2Array(e,"-");var n=game.ItemUtil.createVO(parseInt(i[0]));n.setCount(parseInt(i[1]));var a=false;if(n){a=game.ItemShowUtil.showType1(n,this.itemtupoxiaohao,this.labelnum,true)}if(o.XinFaModel.getIns().xinFaLattleCanWear.isLattleCanTuPo(this.uid,this.cfg)){game.RedDotView.addTo(this.btntupo)}else{game.RedDotView.removeFrom(this.btntupo)}};e.prototype.onUnDisplay=function(){};e.SINGLE_KEY="xinfa.XinFaTupoXiaoHaoView";return e}(ui.xinfaxiulian.tupoxiaohaotipUI);o.XinFaTupoXiaoHaoView=t})(xinfa||(xinfa={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var xinfa;(function(l){var t=function(r){__extends(t,r);function t(t,e){var i=r.call(this,t,e)||this;l.XinFaModel.getIns().on(l.XinFaModel.XIN_FA_EQUIP_ACK,i,i.onUpdateEvt);return i}t.prototype.onMouseUpEvt=function(){if(this.itemVo){var t=[];if(this.other||this.listType==l.EListType.LevelUp){}else{t=[tip.TipManager.TIP_BTN_TYPE.XIN_FA_REPLACE,tip.TipManager.TIP_BTN_TYPE.XIN_FA_UPLOAD]}var e=false;if(this.other){e=true}if(this.listType==l.EListType.LevelUp){if(this.isSelected){e=true}}else{e=true}if(e){tip.TipManager.showxinfa(this.itemVo,t)}}else{if(this.isUnLock){if(this.listType==l.EListType.LevelUp){}else{if(this.other){}else{l.XinFaModel.getIns().openSelectBag(this.roleid,new Laya.Handler(this,this.onSelectHandler),this.cfg,undefined,true)}}}else{if(this.listType==l.EListType.LevelUp){manager.FlowManager.instance.flowByStyle1(app.getLang("xinfa_text_20"))}else{if(this.other){}else{app.ViewManager.toggleDialog(l.XinFaTupoXiaoHaoView,1,0,[this.roleid,this.cfg])}}}}this.selectItem()};t.prototype.onSelectHandler=function(t){app.ProtocolRequest.XinfaEquipReq(this.roleid,this.part,t.serverData.instId)};t.prototype.onUpdateEvt=function(){this.setData(this.cfg,this.roleid)};t.prototype.setData=function(t,e){r.prototype.setData.call(this,t,e);var i=l.XinFaModel.getIns().getXinFaId(e,t.id);var n=false;var a=0;if(i!=undefined){var o=new items.XinFaItemVO(csv.ItemProxy.getIns().itemCfgMap[i]);o.tipsArr=[tip.TipManager.TIP_BTN_TYPE.XIN_FA_REPLACE,tip.TipManager.TIP_BTN_TYPE.XIN_FA_UPLOAD];o.setData(e,t.id);this.itemVo=o;this.skin.imgicon.skin=o.getIconUrl();if(o.xinfa&&o.xinfa.data){a=o.xinfa.data.lv}this.setQuality(o.getXfQuality())}else{this.itemVo=null;this.skin.imgicon.skin="";if(this.isUnLock){n=true}this.setQuality()}if(a>0){this.skin.cliplv.visible=true;this.skin.cliplv.value=a.toString()}else{this.skin.cliplv.visible=false}if(this.other){n=false}this.skin.imgadd.visible=n;var s=false;if(this.listType==l.EListType.LevelUp){this.skin.imgadd.visible=false;if(this.itemVo!=null&&l.XinFaModel.getIns().isQuaOk(e,t.id)&&l.XinFaModel.getIns().isCanLv(e,parseInt(t.id))){s=true}}else{s=l.XinFaModel.getIns().xinFaLattleCanWear.isCanXiuLian(e,t).result.isHasRed;if(s==false&&this.isUnLock==false){if(l.XinFaModel.getIns().xinFaLattleCanWear.isLattleCanTuPo(e,t)){s=true}}}if(this.other){s=false}if(s){game.RedDotView.addTo(this.redDisplay)}else{game.RedDotView.removeFrom(this.redDisplay)}};t.prototype.checkRed=function(){};return t}(l.XinFaLatticeView);l.XinFaXiuLianItem=t})(xinfa||(xinfa={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var xinfa;(function(n){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.roleSelectIndex=0;t.equipSelectIndex=0;return t}t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.roleMediator=new common.RoleListMediator(this.itemxuanze.xuanzelist,equip.RoleItem,new Laya.Handler(this,this.onRoleSelectHandle));this.xfList=new n.XinFaLatticeList(this,n.XinFaXiuLianItem);this.xfList.selectHandler=new Laya.Handler(this,this.onSelectHandle);this.xfList.unselectHandler=new Laya.Handler(this,this.unselectHandler);this.listshuxing.itemRender=n.XingFaAttrView;this.listshuxing.renderHandler=new Laya.Handler(this,this.onAttrHandle);this.btnxinfagongming.clickHandler=new Laya.Handler(this,this.xinFaGongMing);n.XinFaModel.getIns().on(n.XinFaModel.XIN_FA_EQUIP_ACK,this,this.xinfaEquipAck);game.HelperViewHandler.register(csv.FunctionsProxy.ENUMS.XIN_FA_XIULIAN,[this.btnhelp,this.labelguizeshuoming]);this.labeweizhuangbei.visible=false};t.prototype.xinfaEquipAck=function(){this.roleSelectChange()};t.prototype.xinFaGongMing=function(){app.ViewManager.toggleDialog(n.XinFaGongMing,1,0,[this.roleID])};t.prototype.onAttrHandle=function(t,e){t.setData()};t.prototype.onSelectHandle=function(t,e){this.equipSelectIndex=e;t.setSelect(true);var i=n.XinFaModel.getIns().getAllAttr(this.roleID);this.listshuxing.array=i;this.clippingfennum.value=n.XinFaModel.getIns().get_zlus(this.roleMediator.selectedRoleVo,i).toString();this.imgxinfa.skin=n.XinFaModel.getIns().getTitleImg(t.cfg)};t.prototype.unselectHandler=function(t,e){t.setSelect(false)};t.prototype.onDisplay=function(){n.XinFaModel.getIns().on(n.XinFaModel.EVENT_XINFA_XIULIAN_RED_CHECK,this,this.onXinFaXiuLianCheckHandler);n.XinFaModel.getIns().on(n.XinFaModel.XIN_FA_TUPO_EVENT,this,this.onTuPoHandler);this.initHandler()};t.prototype.initHandler=function(){n.XinFaModel.getIns().once(n.XinFaModel.XIN_FA_GET_INFO,this,this.getInfo);app.ProtocolRequest.XinfaInfoReq()};t.prototype.getInfo=function(){this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){n.XinFaModel.getIns().off(n.XinFaModel.EVENT_XINFA_XIULIAN_RED_CHECK,this,this.onXinFaXiuLianCheckHandler);n.XinFaModel.getIns().off(n.XinFaModel.XIN_FA_TUPO_EVENT,this,this.onTuPoHandler);this.roleMediator.setData(-1)};t.prototype.onTuPoHandler=function(){this.refreshHeads();this.roleSelectChange()};t.prototype.onXinFaXiuLianCheckHandler=function(){this.refreshHeads();this.roleSelectChange()};Object.defineProperty(t.prototype,"roleID",{get:function(){return this.roleMediator.selectedRoleVo.insId},enumerable:true,configurable:true});t.prototype.getSelectIndex=function(){var t=n.XinFaModel.getIns().getSelectTuPoIndex();if(t==-1){t=n.XinFaModel.getIns().getSelectRoleIndex();if(t==-1){t=0}}return t};t.prototype.refreshAll=function(){this.roleSelectIndex=this.getSelectIndex();this.refreshHeads();this.selectEquip();this.roleSelectChange()};t.prototype.onGongMingRedHandler=function(){if(n.XinFaModel.getIns().xinfared.hasRedByRole(this.roleID)){game.RedDotView.addTo(this.btnxinfagongming)}else{game.RedDotView.removeFrom(this.btnxinfagongming)}};t.prototype.selectEquip=function(){var t=n.XinFaModel.getIns().getNearPosByRoldID(this.roleID);if(t==undefined){this.equipSelectIndex=n.XinFaModel.getIns().xinFaLattleCanWear.getPosByCanXiulianIndex(this.roleID)}else{this.equipSelectIndex=t}};t.prototype.refreshHeads=function(){this.roleMediator.setData(this.roleSelectIndex,n.XinFaModel.getIns().getXiuiLianReds())};t.prototype.onRoleSelectHandle=function(){this.selectEquip();this.roleSelectIndex=this.roleMediator.selectedIndex;this.roleSelectChange()};t.prototype.roleSelectChange=function(){this.refreshHeads();this.xfList.refreshData(this.roleID);this.xfList.selectByIndex(this.equipSelectIndex);this.onGongMingRedHandler()};return t}(ui.xinfaxiulian.xinfaxiulianviewUI);n.XinFaXiuLianView=t})(xinfa||(xinfa={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var xinfa;(function(t){var e=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t.txtValue.x=130;return t}Object.defineProperty(t.prototype,"prop",{get:function(){return this.dataSource},enumerable:true,configurable:true});t.prototype.setData=function(){var t=this.prop;if(t){this.txtName.text=Attributes.getPropName(t.propId);this.txtValue.color=game.STYLES.GREEN_COLOR_S;this.txtValue.text="+"+Attributes.getPropValue(t.propId,t.value,t.formula)}};return t}(ui.common.commonattr1UI);t.XingFaAttrView=e})(xinfa||(xinfa={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var xinfa;(function(r){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.imgxuanzhong.visible=false;this.itemdaoju.clickHandler=new Laya.Handler(this,this.clickHandler)};e.prototype.clickHandler=function(){};e.prototype.setData=function(t){var e=this.dataSource;var i=e.isSelect;this.imgxuanzhong.visible=i;this.cfg=e.posCfg;var n=false;var a=r.XinFaModel.getIns().getXinFaId(t,this.cfg.id);if(a){var o=new items.XinFaItemVO(csv.ItemProxy.getIns().itemCfgMap[a]);this.itemVo=o;o.setData(t,this.cfg.id);this.itemdaoju.setData(o);var s=r.XinFaModel.getIns().isCanLv(t,parseInt(this.cfg.id));n=s}else{this.itemdaoju.setData(null);this.itemVo=null}if(n){game.RedDotView.addTo(this,this.width-5,5)}else{game.RedDotView.removeFrom(this)}};return e}(ui.lianpenglianzi.lianpengitem04UI);r.XinLaLevelItemView=t})(xinfa||(xinfa={}));var xinfa;(function(t){var e=function(){function t(){}return t}();t.XinFaLatticeVO=e})(xinfa||(xinfa={}));var xinfa;(function(t){var e=function(){function t(){}t.prototype.getName=function(){var t=this.vo;if(t){if(t.vecItem.length>0){return csv.ItemProxy.getName(t.vecItem[0].itemId)}}return""};t.prototype.getColor=function(){if(this.vo){if(this.vo.vecItem.length>0){var t=csv.ItemProxy.getIns().getItemCfgById(this.vo.vecItem[0].itemId);return game.STYLES.ITEM_QUALITY[csv.ItemProxy.getQua(t)]}}};return t}();t.XinFaLvItemVO=e})(xinfa||(xinfa={}));var xinfa;(function(t){var e=function(){function t(){this.selected=false;this.cfgList=[]}Object.defineProperty(t.prototype,"cfg",{get:function(){if(this.cfgList.length){return this.cfgList[0]}},enumerable:true,configurable:true});t.prototype.getName=function(){return this.cfg.nameame};t.prototype.getNameColor=function(){return game.STYLES.ITEM_QUALITY_S[this.cfg.quality]};t.prototype.getPart=function(t){if(!this._suitMapPos){this._suitMapPos={};var e=app.str2Array(this.cfg.position,"-");var i=app.str2Array(this.cfg.needid,";");for(var n=0;n<e.length;n++){var a=parseInt(e[n]);var o=parseInt(i[n]);var s=new items.XinFaItemVO(csv.ItemProxy.getIns().itemCfgMap[o]);this._suitMapPos[a]=s}}return this._suitMapPos[t]};return t}();t.XinFaSuitVO=e})(xinfa||(xinfa={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var xsqg;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){app.ViewManager.regist(i.XianShiQiangGouView,"shangcheng.atlas");game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.XIAN_SHI_QIANG_GOU,i.XianShiQiangGouView);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.XIAN_SHI_QIANG_GOU2,i.XianShiQiangGouView)};e.prototype.initCommands=function(){};return e}(app.ModuleBase);i.XsqgModule=t})(xsqg||(xsqg={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var xsqg;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){};e.prototype.sortHandler=function(t,e){if(t.id>e.id){return 1}else if(t.id<e.id){return-1}return 0};e.prototype.getList=function(t){var e=[];for(var i=0;i<t.length;i++){var n=t[i];var a=parseInt(n.p1);var o=parseInt(n.p2);var s=0;var r=game.Context.roleList;if(r){for(var l=0;l<r.length;l++){var h=r[l];if(h&&!Uint64.equal(h.insId,Uint64.ZERO)){if(h.level>=o){s++}}}}if(s>=a){e.push(n)}}var p=[];var u=[];for(var c=0;c<e.length;c++){if(this.getSubCnt(e[c])==0){p.push(e[c])}else{u.push(e[c])}}u=u.sort(this.sortHandler);p=p.sort(this.sortHandler);return u.concat(p)};e.prototype.getSubCnt=function(t){var e=activitytaren.ActivityTaRenModel.getIns().getSubInfo(t.id);var i=parseInt(t.p3);if(e){i=e.num}return i};e.SINGLE_KEY="xsqg.XianShiQiangGouModel";return e}(app.ModelBase);t.XianShiQiangGouModel=e})(xsqg||(xsqg={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var xsqg;(function(w){var t=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.on(Laya.Event.MOUSE_UP,this,this.onClickHandler);var t=this.imgmoney;this.moneyWidth=t.width;this.moneyHeight=t.height};t.prototype.onClickHandler=function(){var t=this.isCanBatch;var e=-1;var i=w.XianShiQiangGouModel.getIns().getSubCnt(this.cfg);if(i<=0){manager.FlowManager.instance.flowByStyle1(app.getLang("xianshiqianggou_text_4"));return}var n=this.cfg.cost;if(t){e=tip.TipManager.getCanBuyCount(n);if(e>i){e=i}}else{}tip.TipManager.normalShop(this.itemVO,n,new Laya.Handler(this,this.buyCallBack,[this.cfg,this.moneyItemVO]),e)};t.prototype.buyCallBack=function(t,e,i){app.ProtocolRequest.RecvActPrizeReq(t.id,i)};t.prototype.updateActivitData=function(){this.getInfo()};t.prototype.getInfo=function(){this.setData(this.cfg,this.actid)};t.prototype.onDisplay=function(){activitytaren.ActivityTaRenModel.getIns().on(activitytaren.ActivityTaRenModel.ACTIVIT_TAREN_EVENT.UPDATE_ACTIVIT_DATA,this,this.updateActivitData);game.MoneyModel.getIns().on(game.MoneyModel.EVENTS.MONEY_CHANGE,this,this.onRefreshHandle);this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){activitytaren.ActivityTaRenModel.getIns().off(activitytaren.ActivityTaRenModel.ACTIVIT_TAREN_EVENT.UPDATE_ACTIVIT_DATA,this,this.updateActivitData);game.MoneyModel.getIns().off(game.MoneyModel.EVENTS.MONEY_CHANGE,this,this.onRefreshHandle)};t.prototype.onRefreshHandle=function(){this.setData(this.cfg,this.actid)};Object.defineProperty(t.prototype,"cfg",{get:function(){return this.dataSource},enumerable:true,configurable:true});t.prototype.refreshAll=function(){};Object.defineProperty(t.prototype,"isCanBatch",{get:function(){return parseInt(this.cfg.p4)==1},enumerable:true,configurable:true});t.prototype.getMoneyValue=function(t){return parseInt(app.str2Array(t,"-")[1])};t.prototype.setData=function(t,e){if(!t){return}this.actid=e;var i=t;var n=app.str2Array(i.award,"-");var a=game.ItemUtil.createVO(parseInt(n[0]));if(!a){this.labelname.text=n[0];this.itemdaoju.setData(game.GridsModel.EMPTY);return}a.setCount(parseInt(n[1]));var o=this.labelname;o.text=a.getName();o.color=game.STYLES.ITEM_QUALITY_S[a.getQuality()];this.itemdaoju.locktip=true;this.itemdaoju.setData(a);this.itemVO=a;var s=app.str2Array(i.cost,"-");var r=parseInt(s[0]);var l=game.ItemUtil.createVO(r);l.setCount(parseInt(s[1]));this.moneyItemVO=l;var h=parseInt(s[1]);var p=l.getIconUrl();this.moneyimg.icon.skin=p;this.moneyimg.icon.width=this.moneyWidth;this.moneyimg.icon.height=this.moneyHeight;if(parseInt(i.p5)==0){this.yuanjiabox.visible=false;this.hengimg.visible=false}else{this.yuanjiabox.visible=true;this.hengimg.visible=true}this.yuanjialab.text=this.getMoneyValue(i.p5).toString();this.imgmoney.icon.skin=p;this.imgmoney.icon.width=this.moneyWidth;this.imgmoney.icon.height=this.moneyHeight;this.labelmoneynum.text=h.toString();var u=game.GridsModel.getIns().getItemCount(r);var c=game.STYLES.GREEN_COLOR_S;if(u>=h){}else{c=game.STYLES.RED_COLOR}this.labelmoneynum.color=c;var g=this,f=g.zhekoubox,d=g.zhekoulab;var y=parseInt(i.p6);if(y!=0){f.visible=true;var v=app.str2Array(app.getLang("xianshiqianggou_text_1"),",");d.text=v[y-1]+app.getLang("xianshiqianggou_text_2")}else{f.visible=false}var _=this,m=_.zhezhaobox,I=_.goumailab;m.visible=false;var L=w.XianShiQiangGouModel.getIns().getSubCnt(this.cfg);I.text=app.getLang("xianshiqianggou_text_3",L,this.cfg.p3);if(L>0){I.color=game.STYLES.GREEN_COLOR_S}else{I.color=game.STYLES.RED_COLOR_S}};return t}(ui.kaifu.kaifushengdianitem1UI);w.XianShiQiangGouItemView=t})(xsqg||(xsqg={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var xsqg;(function(a){var i=activitytaren.ActivityTaRenModel;var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.baglist.itemRender=a.XianShiQiangGouItemView;this.baglist.renderHandler=new Laya.Handler(this,this.onItemRenderHandler);this.baglist.repeatX=0;this.baglist.vScrollBarSkin=" ";this.activityTimeView=new activitytaren.ActivityTimeView(this.shijian,new Laya.Handler(this,this.endTimeCallBack),"{0}",new Laya.Handler(this,this.updateHandler))};e.prototype.getTime=function(t){if(t>60){var e=util.TimeUtil.sec2Str(t,false,3);this.shijian.text=e}else if(t>0&&t<=60){var e=util.TimeUtil.sec2Str(t,false,4);this.shijian.text=e}else{this.shijian.text=app.getLang("huodong_text07")}};e.prototype.updateHandler=function(t){var e=i.getIns().time2str(t);this.shijian.color=e.color;if(t>0){this.shijian.text=e.timestr}else{this.shijian.text=app.getLang("huodong_text07")}};e.prototype.endTimeCallBack=function(){this.hideSubTime()};e.prototype.onItemRenderHandler=function(t,e){t.setData(t.dataSource,this.actVo.actid)};e.prototype.onDisplay=function(){this.callLater(this.onGetInfo)};e.prototype.onGetInfo=function(){this.onEndHandler()};e.prototype.onEndHandler=function(){this.refreshAll()};e.prototype.updateActivitData=function(){this.refreshAll()};e.prototype.onUnDisplay=function(){this.hideSubTime()};e.prototype.hideTabRed=function(){if(this.actVo){var t=[];var e=new ActivityRedStatus;e.actId=this.actVo.actid;e.status=0;t.push(e);activitytaren.ActivityTaRenModel.getIns().redRefresh(t)}};e.prototype.refreshAll=function(){if(this.actVo){this.hideTabRed();var t=this.actVo;this.shengyu.visible=true;var e=t.timeVo;var i=e.endTime;this.activityTimeView.start(i);var n=a.XianShiQiangGouModel.getIns().getList(csv.ActivityTarenProxy.getIns().activityidMap[t.actid]);this.baglist.array=n}else{this.baglist.array=[];console.log("活动无数据!")}};e.prototype.hideSubTime=function(){this.activityTimeView.stop();this.shijian.text=app.getLang("huodong_text07")};return e}(ui.kaifu.kaifushengdianUI);a.XianShiQiangGouView=t})(xsqg||(xsqg={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yaowangfight;(function(a){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){this._model=boss.BossModel.getIns();app.ViewManager.regist(a.YaowangFightMainView,"bosszong.atlas","bosszhandou.atlas","yaowangzhengba.atlas","bingqi.atlas");main.MainUIIcon.iconClassMap[csv.MainIconProxy.YAO_WANG_FIGHT]=a.YaowangFightIcon;game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.YAO_WANG_BOSS,a.YaowangFightMainView);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.YAO_WANG_BOSS_AWARD,a.YaowangAwardView);this._model.on(boss.BossEvent.BOSS_AWARD_CHANGE,this,this.onUpdateRedDot)};e.prototype.initCommands=function(){};e.prototype.onUpdateRedDot=function(t){if(t!=boss.BossModel.AWARD_TYPE.YAOWANG){return}var e=csv.DailyTimeProxy.ENUM_TYPE.BOSS_YEWAI;var i=this._model.getDailyTime(e);var n=i.fnum+i.gnum;if(n>0&&boss.BossModel.getIns().getBossAwards(boss.BossModel.AWARD_TYPE.YAOWANG).length>0&&a.YaowangFightModel.getIns().isFristOpen==false){Laya.timer.once(1e3,this,function(){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.YAO_WANG_BOSS_AWARD)})}else{game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.YAO_WANG_BOSS_AWARD)}};e.SINGLE_KEY="yaowangfight.YaowangFightModule";return e}(app.ModuleBase);a.YaowangFightModule=t})(yaowangfight||(yaowangfight={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yaowangfight;(function(a){var t;(function(t){t[t["AHEAD"]=0]="AHEAD";t[t["OPEN"]=1]="OPEN";t[t["END"]=2]="END"})(t=a.YAOWANG_STATE||(a.YAOWANG_STATE={}));var e=function(e){__extends(n,e);function n(){var t=e!==null&&e.apply(this,arguments)||this;t.isFristOpen=false;return t}n.getIns=function(){return app.Singleton.getInstance(n)};n.prototype.init=function(){};n.prototype.getYaowangState=function(){var t=+game.Config.getParams(1115);var e=dailytask.DailyTaskModel.getIns().getOpenActivityByType(csv.ActivityFunction.ENUM.YAO_WANG_FIGHT);if(e){return a.YAOWANG_STATE.OPEN}else{var i=csv.ActivityFunction.getIns().getNextOpenTime(csv.ActivityFunction.ENUM.YAO_WANG_FIGHT);if(i<=t){return a.YAOWANG_STATE.AHEAD}else{return a.YAOWANG_STATE.END}}};n.prototype.getBossList=function(){var t={};var e=csv.BossProxy.getIns().getBossArrByType(csv.BossProxy.ENUM.BOSS_YAO_WANG);var i=[];for(var n=0;n<e.length;n++){if(game.Context.isTeamLvReach(this._needMinusLv(e[n].teamlv))){i.push(e[n])}}var a=i[i.length-1].param1;for(var o=1;o<=a;o++){for(var s=0;s<i.length;s++){if(t[o]){if(i[s].param1==o){t[o].push(i[s])}}else{t[o]=[];if(i[s].param1==o){t[o].push(i[s])}}}}return t};n.prototype.getMaxTabNum=function(){var t=csv.BossProxy.getIns().getBossArrByType(csv.BossProxy.ENUM.BOSS_YAO_WANG);var e=[];for(var i=0;i<t.length;i++){if(game.Context.isTeamLvReach(this._needMinusLv(t[i].teamlv))){e.push(t[i])}}return e[e.length-1].param1};n.prototype.getBossItemByTeamLv=function(){var t=csv.BossProxy.getIns().getBossArrByType(csv.BossProxy.ENUM.BOSS_YAO_WANG);for(var e=t.length-1;e>=0;e--){if(game.Context.teamLv>=this._needMinusLv(t[e].teamlv)){return t[e]}}};n.prototype._needMinusLv=function(t){var e=t-fabaonew.FaBaoNewModel.getIns().getPlayMode(fabaonew.Etask_type.YaoWangNeedLevel);return e<0?0:e};n.prototype.getBossEnterDataArr=function(t){var e=[];for(var i=0;i<t.length;i++){e.push({id:t[i].id,state:boss.BossModel.getIns().getYaowangBossState(t[i].id)})}return e};n.prototype.yaowangAwardRed=function(){var t=csv.DailyTimeProxy.ENUM_TYPE.BOSS_YEWAI;var e=boss.BossModel.getIns().getDailyTime(t);var i=e.fnum+e.gnum;if(i>0&&boss.BossModel.getIns().getBossAwards(boss.BossModel.AWARD_TYPE.YAOWANG).length>0&&n.getIns().isFristOpen==false){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.YAO_WANG_BOSS_AWARD)}else{game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.YAO_WANG_BOSS_AWARD)}};n.SINGLE_KEY="yaowangfight.YaowangFightModel";n.UPDATE_PLAYER_MOVE="UPDATE_PLAYER_MOVE";n.UPDATE_PLAYER_POWER="UPDATE_PLAYER_POWER";n.UPDATE_LAYER_VIEW="UPDATE_LAYER_VIEW";n.SEND_NEXT_POS="SEND_NEXT_POS";n.CLICK_CD="CLICK_CD";n.UPDATE_BUFF="UPDATE_BUFF";n.MAX_TAB_NUM=0;return n}(app.ModelBase);a.YaowangFightModel=e})(yaowangfight||(yaowangfight={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yaowangfight;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=boss.BossModel.getIns();this.btrnlingqu.on(Laya.Event.CLICK,this,this.onClick);this.imgyilingqu.visible=false};e.prototype.onClick=function(){app.ViewManager.toggleDialog(i.YaowangAwardTipsView,1,0,this._vo)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){this._index=t.index;this._vo=t;this.itemdaoju.setData(t.vo);var e=i.YaowangAwardView.getIns().setDailyTime();if(e==0){this.btrnlingqu.gray=true;this.btrnlingqu.mouseEnabled=false}else{this.btrnlingqu.gray=false;this.btrnlingqu.mouseEnabled=true}if(this._model.getBossNewDex(boss.BossModel.AWARD_TYPE.YAOWANG).indexOf(t.index)!=-1){game.RedDotView.addTo(this,35,10,1,1,1)}else{game.RedDotView.removeFrom(this)}};e.SINGLE_KEY="yaowangfight.YaowangAwardItem";return e}(ui.yaowangzhengba.jiangliitemUI);i.YaowangAwardItem=t})(yaowangfight||(yaowangfight={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yaowangfight;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=boss.BossModel.getIns()};e.prototype.onDisplay=function(){this.callLater(this.refreshAll);this.quedingbtn.on(Laya.Event.CLICK,this,this._clickYes);this.quxiaobtn.on(Laya.Event.CLICK,this,this._clickNo);this.label01.text=app.getLang("bosskingrewardtips_4")};e.prototype.onUnDisplay=function(){this.quedingbtn.off(Laya.Event.CLICK,this,this._clickYes);this.quxiaobtn.off(Laya.Event.CLICK,this,this._clickNo)};e.prototype.refreshAll=function(){this._vo=this.dataSource;this.daoju.setData(this._vo.vo);this.labelmiaoshu.text=this._vo.vo.getName()};e.prototype._clickYes=function(){app.ProtocolRequest.WorldBossBagAwardReq(1,[this._vo.index]);app.ViewManager.toggleDialog(i.YaowangAwardTipsView,-1,0)};e.prototype._clickNo=function(){app.ViewManager.toggleDialog(i.YaowangAwardTipsView,-1,0)};e.SINGLE_KEY="yaowangfight.YaowangAwardTipsView";return e}(ui.yaowangzhengba.tishitipUI);i.YaowangAwardTipsView=t})(yaowangfight||(yaowangfight={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yaowangfight;(function(e){var t=function(t){__extends(r,t);function r(){return t!==null&&t.apply(this,arguments)||this}r.getIns=function(){return app.Singleton.getInstance(r)};r.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.baglist.itemRender=e.YaowangAwardItem;this.baglist.renderHandler=new Laya.Handler(this,this.onRender);this._model=boss.BossModel.getIns();game.HelperViewHandler.registerStr([this.btntishi,this.labeltishi],"func265t","func265")};r.prototype.onRender=function(t,e){t.setData(t.dataSource)};r.prototype.onDisplay=function(){this.callLater(this.refreshAll);this._model.on(boss.BossEvent.BOSS_AWARD_CHANGE,this,this.refreshAll);this.labeltishi.text=app.getLang("bosskingrewardtips_2")};r.prototype.onUnDisplay=function(){this._model.setBossNewDex(boss.BossModel.AWARD_TYPE.YAOWANG,[]);e.YaowangFightModel.getIns().isFristOpen=true;e.YaowangFightModel.getIns().yaowangAwardRed();this._model.off(boss.BossEvent.BOSS_AWARD_CHANGE,this,this.refreshAll)};r.prototype.setDailyTime=function(){var t=csv.DailyTimeProxy.ENUM_TYPE.BOSS_YEWAI;var e=this._model.getDailyTime(t);this._leastTime=e.fnum+e.gnum;var i=csv.DailyTimeProxy.getIns().getCfg(t);var n=parseInt(i.time);this.labelmiaoshu.text=app.getLang("bosskingrewardtips_1",n-this._leastTime);return this._leastTime};r.prototype.refreshAll=function(){var t=[];this.setDailyTime();var e=this._model.getBossAwards(boss.BossModel.AWARD_TYPE.YAOWANG);for(var i=0;i<e.length;i++){var n=e[i];var a=game.ItemUtil.createVO(n.itemID);a.setCount(n.value);var o={index:i,vo:a};t.push(o)}t.sort(this.sortAward);this.baglist.array=t;this.neirong.visible=true;if(t.length==0){this.zanwuimg.visible=true}else{this.zanwuimg.visible=false}var s=r.getIns().setDailyTime();if(s==0){this.neirong.visible=false;this.yongwanimg.visible=true;this.zanwuimg.visible=false}else{this.yongwanimg.visible=false}};r.prototype.sortAward=function(t,e){if(t.vo.itemCfg.p2!==e.vo.itemCfg.p2){return e.vo.itemCfg.p2-t.vo.itemCfg.p2}if(t.vo.itemCfg.p3!==e.vo.itemCfg.p3){return e.vo.itemCfg.p3-t.vo.itemCfg.p3}return 0};r.SINGLE_KEY="yaowangfight.YaowangAwardView";return r}(ui.yaowangzhengba.yaowangzhengbajiangliviewUI);e.YaowangAwardView=t})(yaowangfight||(yaowangfight={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yaowangfight;(function(o){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getInstance=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=o.YaowangFightModel.getIns()};e.prototype.onDisplay=function(){this.callLater(this.updateLayout);boss.BossModel.getIns().on(boss.BossEvent.BOSS_YAOWANG_ROLENUM_CHANGE,this,this._checkRoleNum);this.on(Laya.Event.CLICK,this,this.onClick)};e.prototype.onUnDisplay=function(){boss.BossModel.getIns().off(boss.BossEvent.BOSS_YAOWANG_ROLENUM_CHANGE,this,this._checkRoleNum);this.off(Laya.Event.CLICK,this,this.onClick)};e.prototype.updateLayout=function(){};e.prototype.setData=function(t){this.btnyeqian.label=app.getLang("bosskingdungeon_"+t.id);var e=this._model.getYaowangState();this.zhuangtaiimg.visible=false;if(e!=o.YAOWANG_STATE.OPEN){this.mouseEnabled=false;this.gray=true;this.yijisha.visible=false}else{this.mouseEnabled=true;this.gray=false;if(t.state==0){this._checkRoleNum();this.yijisha.visible=false}else{this.gray=true;this.mouseEnabled=false;this.yijisha.visible=true}}};e.prototype._checkRoleNum=function(){if(this.dataSource&&this.dataSource.state==0){var t=boss.BossModel.getIns().yBossRoleNum[this.dataSource.id]?boss.BossModel.getIns().yBossRoleNum[this.dataSource.id]:0;var e=game.Config.getParams(1158).split(";");this.zhuangtaiimg.visible=true;if(t>+e[1]){this.zhuangtaiimg.skin="yaowangzhengba/bg_jiaobao_zhuangtai_3.png"}else if(t>+e[0]){this.zhuangtaiimg.skin="yaowangzhengba/bg_jiaobao_zhuangtai_2.png"}else{this.zhuangtaiimg.skin="yaowangzhengba/bg_jiaobao_zhuangtai_1.png"}}};e.prototype.onClick=function(){var t=this;if(!battle.BattleModel.getIns().checkJumpState()){return}var e=this._model.getYaowangState();if(e!=o.YAOWANG_STATE.OPEN){manager.FlowManager.instance.flowByStyle1(app.getLang("活动时间已结束！"));return}var i=csv.DailyTimeProxy.ENUM_TYPE.BOSS_YEWAI;var n=boss.BossModel.getIns().getDailyTime(i);var a=n.fnum+n.gnum;if(boss.BossModel.getIns().yaowangLastKill.length>0&&a<=0){game.Alert.show(app.getLang("bosskingrewardtips_6"),new Laya.Handler(this,function(){app.ProtocolRequest.JoinBossReq(t.dataSource.id)}),new Laya.Handler(this,null));return}app.ProtocolRequest.JoinBossReq(this.dataSource.id)};e.SINGLE_KEY="yaowangfight.YaowangBossJoinItem";return e}(ui.yaowangzhengba.yeqianitemUI);o.YaowangBossJoinItem=t})(yaowangfight||(yaowangfight={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yaowangfight;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getInstance=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=i.YaowangFightModel.getIns()};e.prototype.onDisplay=function(){this.callLater(this.updateLayout)};e.prototype.onUnDisplay=function(){};e.prototype.updateLayout=function(){};e.prototype.setData=function(t){var e=app.str2Array(t,"-");var i=Attributes.getWuxingEnumType(parseInt(e[0]));this.tubiao.skin="public/bg_wuxing_"+i+".png";this.labelshuzi.text=e[e.length-1]};e.SINGLE_KEY="yaowangfight.YaowangFightElementItem";return e}(ui.yaowangzhengba.yeqianitem1UI);i.YaowangFightElementItem=t})(yaowangfight||(yaowangfight={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yaowangfight;(function(s){var t=function(n){__extends(t,n);function t(t,e){if(e===void 0){e=main.IconListBase.SIZE}var i=n.call(this,t,e)||this;i.setTimeLabel();return i}t.prototype.onDisplay=function(){n.prototype.onDisplay.call(this);this.clearData();this.init();boss.BossModel.getIns().on(boss.BossEvent.BOSS_YAOWANG,this,this.onInfoHandler);dailytask.DailyTaskModel.getIns().on(dailytask.DailyTaskModel.OPEN_ACTIVITY_CHANGE,this,this.onInfoHandler)};t.prototype.onUndisplay=function(){n.prototype.onUndisplay.call(this);this.clearData();boss.BossModel.getIns().off(boss.BossEvent.BOSS_YAOWANG,this,this.onInfoHandler);dailytask.DailyTaskModel.getIns().off(dailytask.DailyTaskModel.OPEN_ACTIVITY_CHANGE,this,this.onInfoHandler)};t.prototype.clearData=function(){if(this.timeView){this.timeView.stop()}};t.prototype.init=function(){this.onInfoHandler()};t.prototype.onInfoHandler=function(){var e=this;if(!this.timeView){this.timeView=new activitytaren.ActivityTimeView(this.lblTime,new Laya.Handler(this,this.onEnd),undefined,undefined,activitytaren.ActivityTimeView.TYPE_COLON_HIDE_HOUR)}this.lblTime.visible=true;var i=0;var t=dailytask.DailyTaskModel.getIns().getOpenActivityByType(csv.ActivityFunction.ENUM.YAO_WANG_FIGHT);if(t){this.timeView.stop();this.timeView.timeStr="bosskingmaintime_2";this.lblTime.color=game.STYLES.RED_COLOR;var n=csv.ActivityFunction.getIns().getCfg(t.id);var a=n.closetime.split("-");var o=+a[0]*3600+ +a[1]*60+ +a[0];i=game.Context.getServerZeroTime()+o;this.timeView.start(i)}else{Laya.timer.once(500,this,function(){e.timeView.timeStr="bosskingmaintime_1";var t=s.YaowangFightModel.getIns().getYaowangState();if(t==s.YAOWANG_STATE.AHEAD){e.timeView.stop();e.lblTime.color=game.STYLES.DESC_TXT_COLOR;i=csv.ActivityFunction.getIns().getNextOpenTime(csv.ActivityFunction.ENUM.YAO_WANG_FIGHT)+game.Context.getServerTime();e.timeView.start(i)}else{e.lblTime.visible=false;e.timeView.text="";e.timeView.stop()}})}};t.prototype.onEnd=function(){this.lblTime.visible=false;this.timeView.text="";this.clearData()};return t}(main.MainUIIcon);s.YaowangFightIcon=t})(yaowangfight||(yaowangfight={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yaowangfight;(function(c){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t._selTabNum=0;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=c.YaowangFightModel.getIns();this.listshuxing.itemRender=c.YaowangFightElementItem;this.listshuxing.renderHandler=new Laya.Handler(this,this.onRenderHandler);this.jianglilist.itemRender=grids.GridView;this.jianglilist.renderHandler=new Laya.Handler(this,this.onCellHandler);this.listyeqian.itemRender=c.YaowangBossJoinItem;this.listyeqian.renderHandler=new Laya.Handler(this,this.onRenderHandler2);game.HelperViewHandler.registerStr([this.btnwenhao,this.shuoming],"func10t","func10");this.roleAvatar=new avatar.AvatarAnimation;this._roleAvatar=new avatar.AvatarData;this.weizhi.addChild(this.roleAvatar)};t.prototype.onDisplay=function(){this.callLater(this.refreshAll);this._maxTabNum=this._model.getMaxTabNum();this.btnzuop.on(Laya.Event.CLICK,this,this._onLeft);this.btnyou.on(Laya.Event.CLICK,this,this._onRight);this.btnpaihangjiangli.on(Laya.Event.CLICK,this,this._openRankView);dailytask.DailyTaskModel.getIns().on(dailytask.DailyTaskModel.OPEN_ACTIVITY_CHANGE,this,this._updateMainView);boss.BossModel.getIns().on(boss.BossEvent.BOSS_WORLD_CHANGE,this,this._updateMainView)};t.prototype.onUnDisplay=function(){this.btnzuop.off(Laya.Event.CLICK,this,this._onLeft);this.btnyou.off(Laya.Event.CLICK,this,this._onRight);this.btnpaihangjiangli.off(Laya.Event.CLICK,this,this._openRankView);dailytask.DailyTaskModel.getIns().off(dailytask.DailyTaskModel.OPEN_ACTIVITY_CHANGE,this,this._updateMainView);boss.BossModel.getIns().off(boss.BossEvent.BOSS_WORLD_CHANGE,this,this._updateMainView);this.dataSource=null};t.prototype.refreshAll=function(){var t;this._bossListByTab=this._model.getBossList();this.btnpaihangjiangli.visible=true;if(this.dataSource.length>0&&this.dataSource[0]){var e=this.dataSource[0];var i=csv.BossProxy.getIns().getCfg(e);t=this._selTabNum=i.param1}else{var n=this._model.getBossItemByTeamLv();t=this._selTabNum=n.param1-+game.Config.getParams(1116)}this._updateMainView(t);this._model.yaowangAwardRed()};t.prototype._updateMainView=function(t){if(t===void 0){t=this._selTabNum}var e=this._model.getYaowangState();if(e==c.YAOWANG_STATE.END){this.neirongbox.visible=false;this.boxdaojishi1.visible=true;this.imgdaojishi.text=app.getLang("bosskingopentips_2")}else{this.neirongbox.visible=true;this.boxdaojishi1.visible=false;if(e==c.YAOWANG_STATE.OPEN){this.boxdaojishi2.visible=false}else{this.boxdaojishi2.visible=true;this.startLoop()}var i=this._bossCfgArr=this._bossListByTab[t];var n=i[0];var a=csv.MonsterProxy.getIns().getMonsterBase(n.bosssetbase);var o=csv.BossProxy.getIns().getMonsterId(n.bosssetbase);var s=csv.MonsterProxy.getIns().getCfg(o);this.btnzuop.visible=true;this.btnyou.visible=true;if(this._selTabNum<=1){this.btnzuop.visible=false}if(this._selTabNum>=this._maxTabNum){this.btnyou.visible=false}this.listshuxing.array=a.element.split(";");var r=[];var l=csv.ItemProxy.getIns().getItemCfgById(+n.dropshow.split("-")[0]);this.daoju.skin="res/icon/item/"+l.reskey+".png";this.jieshuimg.skin="public/"+l.cornermarker+".png";this._lastAwardIsGet();var h=n.propdropshow.split(";");for(var p=0;p<h.length;p++){r.push(game.ItemUtil.parserList(h[p])[0])}this.jianglilist.array=r;var u=this._model.getBossEnterDataArr(i);this.listyeqian.array=u;this.imgname.skin="res/static/bosszong/"+n.bossname+".png";this.clipdengji.value=s.monlevel+"";if(this.isBossDead(u)&&e!=c.YAOWANG_STATE.AHEAD){this._roleAvatar.roleKey="npc_mubei";this._roleAvatar.fileName=game.AniView.FILE_NAME.MONSTER;this.roleAvatar.setAniData(this._roleAvatar);this.roleAvatar.setAni(avatar.AvatarAnimation.ANI_ENUMS.IDLE,0);this.roleAvatar.play();this.imgdi.visible=false;this.listshuxing.visible=false}else{this._roleAvatar.roleKey=s.res;this._roleAvatar.fileName=game.AniView.FILE_NAME.MONSTER;this.roleAvatar.setAniData(this._roleAvatar);this.roleAvatar.setAni(avatar.AvatarAnimation.ANI_ENUMS.IDLE,6);this.roleAvatar.play();this.imgdi.visible=true;this.listshuxing.visible=true}}};t.prototype._lastAwardIsGet=function(){var t=false;var e=boss.BossModel.getIns().yaowangLastKill;if(e&&e.length>0){for(var i=0;i<e.length;i++){for(var n=0;n<this._bossCfgArr.length;n++){if(e[i]==this._bossCfgArr[n].id){t=true;break}}}}this.yilingqu.visible=t};t.prototype.isBossDead=function(t){for(var e=0;e<t.length;e++){if(t[e].state==0){return false}}return true};t.prototype.startLoop=function(){this.loopFreshTime();Laya.timer.loop(1e3,this,this.loopFreshTime)};t.prototype.loopFreshTime=function(){var t=csv.ActivityFunction.getIns().getNextOpenTime(csv.ActivityFunction.ENUM.YAO_WANG_FIGHT);if(t>=0){this.labdaojishi1.text=app.getLang("bosskingplanetime_1",util.TimeUtil.sec2Str(t,false,undefined,true))}else{Laya.timer.clear(this,this.loopFreshTime);Laya.timer.once(1e3,this,this._updateMainView)}};t.prototype.onRenderHandler=function(t,e){t.setData(t.dataSource)};t.prototype.onCellHandler=function(t,e){t.setData(t.dataSource)};t.prototype.onRenderHandler2=function(t,e){t.setData(t.dataSource)};t.prototype._onLeft=function(){this._selTabNum-=1;this._selTabNum=this._selTabNum<=1?1:this._selTabNum;this._updateMainView(this._selTabNum)};t.prototype._onRight=function(){this._selTabNum+=1;this._selTabNum=this._selTabNum>=this._maxTabNum?this._maxTabNum:this._selTabNum;this._updateMainView(this._selTabNum)};t.prototype._openRankView=function(){app.ViewManager.toggleDialog(c.YaowangRankView,1,0,this._bossCfgArr)};t.SINGLE_KEY="yaowangfight.YaowangFightMainView";return t}(ui.yaowangzhengba.yaowangzhengbaviewUI);c.YaowangFightMainView=t})(yaowangfight||(yaowangfight={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yaowangfight;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=i.YaowangFightModel.getIns()};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t,e){this.lapelpaiming.text=app.getLang("bosskingrank_"+(e+1));var i=t.split("-");var n=game.ItemUtil.parserList(i[1])[0];this.daoju.setData(n);this.imgbg.skin=rank.RankModel.getRankBgUrl(e+1)};e.SINGLE_KEY="yaowangfight.YaowangRankItem";return e}(ui.yaowangzhengba.yaowangitem03UI);i.YaowangRankItem=t})(yaowangfight||(yaowangfight={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yaowangfight;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listpaiming01.itemRender=i.YaowangRankItem;this.listpaiming01.renderHandler=new Laya.Handler(this,this.onRender);this._model=i.YaowangFightModel.getIns()};e.prototype.onRender=function(t,e){t.setData(t.dataSource,e)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){var t=this.dataSource[0];this.listpaiming01.array=t.param2.split(";")};e.prototype.getRankArr=function(){};e.SINGLE_KEY="yaowangfight.YaowangRankView";return e}(ui.yaowangzhengba.yaowangpaihangbangjiangliviewUI);i.YaowangRankView=t})(yaowangfight||(yaowangfight={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yishou;(function(i){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.isInitEvt=false;return t}t.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.YiShouNtf,this,this.onYiShouNtf);this.addMsgListener(app.ProtocolResponse.YiShouKillResp,this,this.onYiShouKillResp);this.addMsgListener(app.ProtocolResponse.YiShouAwardResp,this,this.onYiShouAwardResp);this.addMsgListener(app.ProtocolResponse.YiShouExchangeResp,this,this.onYiShouExchangeResp)};t.prototype.init=function(){this.model=i.YiShouModel.getIns();game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.YI_SHOU_RU_QING,i.YiShowView,null,game.ECommonType.COMMON_TYPE_YISHOU_RU_QIN);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.YI_SHOU_RU_QING_TIAOZHAN,i.YiShouTiaoZhanView,null,game.ECommonType.COMMON_TYPE_YISHOU_RU_QIN);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.YI_SHOU_RU_QING_DUIHUAN,i.YiShouDuiHuanShopView,null,game.ECommonType.COMMON_TYPE_YISHOU_RU_QIN);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.YI_SHOU_RU_QING_PAIHANG,i.YiShouPaiHangView,null,game.ECommonType.COMMON_TYPE_YISHOU_RU_QIN);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.YI_SHOU_RU_QING_LI_BAO,i.YiShouDuiHuanView,null,game.ECommonType.COMMON_TYPE_YISHOU_RU_QIN)};t.prototype.onYiShouNtf=function(t,e){this.model.info=e;this.model.updateDuihuanRed();this.model.event(i.YiShouEvent.EVENT_INFO_UPDATE);this.initEvt()};t.prototype.initEvt=function(){if(!this.isInitEvt){this.isInitEvt=true;game.GridsModel.getIns().on(game.GridsModel.EVENTS.UPDATE,this,this.refreshAll)}};t.prototype.refreshAll=function(){this.model.updateDuihuanRed()};t.prototype.onYiShouKillResp=function(t,e){if(e.ret==1){this.model.event(i.YiShouEvent.EVENT_KILL_SUCCEED)}};t.prototype.onYiShouAwardResp=function(t,e){if(e.ret){}};t.prototype.onYiShouExchangeResp=function(t,e){if(e.ret){}};return t}(app.ModuleBase);i.YiShouModule=t})(yishou||(yishou={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yishou;(function(t){var a=function(){function t(){this.needCheck=false}t.prototype.hasRed=function(){if(this.needCheck){if(!this.moneyVo){this.moneyVo=game.ItemUtil.parserList(this.cfg.consume)[0]}if(!this.model){this.model=i.getIns()}var t=game.GridsModel.getIns().getItemCount(this.moneyVo.getItemId());if(t>=this.moneyVo.count){var e=this.model.getDuihuanCount(this.cfg.id);if(e>=this.cfg.value){return false}return true}}return false};return t}();var i=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){this.duiHuanRedList=[];var t=csv.YiShouProxy.getIns().ruqin_duihuanArr;for(var e=0;e<t.length;e++){var i=t[e];if(i.remind){var n=new a;n.cfg=i;this.duiHuanRedList.push(n)}}};e.prototype.isLingqued=function(t){if(this.info.playerData.length>0){var e=this.info.playerData[0].recvBid;return e.indexOf(t)!=-1}};e.prototype.setDuiHuanSelect=function(t,e){for(var i=0;i<this.duiHuanRedList.length;i++){var n=this.duiHuanRedList[i];if(n.cfg.id==t){n.needCheck=e}}this.updateDuihuanRed()};e.prototype.updateDuihuanRed=function(){var t=false;for(var e=0;e<this.duiHuanRedList.length;e++){if(this.duiHuanRedList[e].hasRed()){t=true;break}}var i=csv.FunctionsProxy.ENUMS.YI_SHOU_RU_QING_DUIHUAN;if(t){game.ClosureManager.addDot(i)}else{game.ClosureManager.removeDot(i)}};e.prototype.getDuihuanIdRed=function(t){for(var e=0;e<this.duiHuanRedList.length;e++){if(this.duiHuanRedList[e].cfg.id==t){return this.duiHuanRedList[e].hasRed()}}return false};Object.defineProperty(e.prototype,"killNum",{get:function(){return this.info.playerData[0].killNum},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"allKillNum",{get:function(){if(this.info.serverData.length){return this.info.serverData[0].totalKill}return 0},enumerable:true,configurable:true});e.prototype.getDuihuanCount=function(t){if(this.info.playerData.length>0){var e=this.info.playerData[0];if(e.exchangeData){var i=e.exchangeData;for(var n=0;n<i.length;n++){var a=i[n];if(a.id==t){return a.value}}}}return 0};e.SINGLE_KEY="yishou.YiShouModel";return e}(app.ModelBase);t.YiShouModel=i;var e=function(){function t(){}t.EVENT_INFO_UPDATE="EVENT_INFO_UPDATE";t.EVENT_KILL_SUCCEED="EVENT_ITEM_UPDATE";return t}();t.YiShouEvent=e})(yishou||(yishou={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e;(function(t){t[t["Self"]=1]="Self";t[t["Loop"]=2]="Loop";t[t["All"]=3]="All"})(e=t.EYiShouTiaoZhanType||(t.EYiShouTiaoZhanType={}));var i=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(t){var e=app.Config.getResById("ruqin_duihuan.csv");this.ruqin_duihuanArr=e.getArray();e=app.Config.getResById("ruqin_jishajiangli.csv");this.ruqin_jishajiangliArr=e.getArray();this.ruqin_jishajiangliMap=e.getMap("id");e=app.Config.getResById("ruqin_paihangbang.csv");this.ruqin_paihangbangArr=e.getArray();e=app.Config.getResById("ruqin_renwu.csv");this.ruqin_renwuArr=e.getArray()};e.prototype.getListByType=function(t){var e=[];for(var i=0;i<this.ruqin_renwuArr.length;i++){var n=this.ruqin_renwuArr[i];if(n.type==t){e.push(n)}}return e};e.prototype.getListByActid=function(t){var e=[];for(var i=0;i<this.ruqin_duihuanArr.length;i++){var n=this.ruqin_renwuArr[i];if(n.activityid==t){e.push(n)}}return e};e.prototype.getArrByLayer=function(t){var e=[];for(var i=0;i<this.ruqin_duihuanArr.length;i++){var n=this.ruqin_duihuanArr[i];if(n.layer==t){e.push(n)}}return e};e.SINGLE_KEY="csv.YiShouProxy";return e}(app.ModelBase);t.YiShouProxy=i})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yishou;(function(n){var a=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.funcid=csv.FunctionsProxy.ENUMS.YI_SHOU_RU_QING_DUIHUAN;return t}t.prototype.initialize=function(){e.prototype.initialize.call(this);this.model=n.YiShouModel.getIns();this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.duihuanbtn.clickHandler=new Laya.Handler(this,this.onDuiHuangHandler);this.tixing.clickHandler=new Laya.Handler(this,this.onTiXingHanlder)};t.prototype.onTiXingHanlder=function(){this.model.setDuiHuanSelect(this.cfg.id,this.tixing.selected);this.updateDuihuanBtn()};t.prototype.onDuiHuangHandler=function(){if(this.isSellOut){}else{if(game.SystemSetModel.getInstance().alertViewCheck(this.funcid)){this.onOkHandle()}else{game.Alert.show(app.getLang("yishou_09",game.STYLES.ITEM_QUALITY_S[this.itemVo.getQuality()],this.itemVo.getName(),this.itemVo.count),new Laya.Handler(this,this.onOkHandle),new Laya.Handler,0,"","","center","center",this.funcid)}}};t.prototype.onOkHandle=function(){app.ProtocolRequest.YiShouExchangeReq(this.cfg.id,1)};t.prototype.onDisplay=function(){};t.prototype.onUnDisplay=function(){};t.prototype.clear=function(){this.shouqinimg.visible=false;this.imgxuanzhong.visible=false};t.prototype.setData=function(t){this.cfg=t;this.clear();this.moneyVo=game.ItemUtil.parserList(this.cfg.consume)[0];var e=game.ItemUtil.parserList(t.item)[0];this.itemVo=e;this.daojugezi.setData(e);this.daojuname.text=e.getName();this.daojuname.color=game.STYLES.ITEM_QUALITY[e.getQuality()];this.onCost();var i=this.model.getDuihuanCount(t.id);this.xiangoulab.text=app.getLang("yishou_08",i,t.value);if(i>=t.value){this.duihuanbtn.gray=true;this.duihuanbtn.mouseEnabled=false;this.isSellOut=true;this.shouqinimg.visible=true}else{this.duihuanbtn.gray=false;this.duihuanbtn.mouseEnabled=true;this.isSellOut=false;this.shouqinimg.visible=false}if(t.remind){this.tixing.visible=true}else{this.tixing.visible=false}this.updateDuihuanBtn()};t.prototype.updateDuihuanBtn=function(){var t=false;if(this.cfg.remind&&this.model.getDuihuanIdRed(this.cfg.id)){t=true}if(t){game.RedDotView.addTo(this.duihuanbtn)}else{game.RedDotView.removeFrom(this.duihuanbtn)}};t.prototype.onCost=function(){this.huobi.parserIcon(this.moneyVo.getItemId().toString());var t=game.GridsModel.getIns().getItemCount(this.moneyVo.getItemId());this.shuzhi.color=t<this.moneyVo.count?game.STYLES.RED_COLOR_S:game.STYLES.GREEN_COLOR_S;this.shuzhi.text=this.moneyVo.count.toString()};return t}(ui.yishouruqin.ysrqduihuanitemUI);var o=function(){function t(t,e,i,n){this.ani=i;this._list=t;this.clickHandler=n;e.clickHandler=new Laya.Handler(this,this.onClick)}t.prototype.onClick=function(){for(var t=0;t<this._list.length;t++){var e=this._list[t];if(e==this){e.setSelect(true);this.clickHandler.runWith(t)}else{e.setSelect(false)}}};Object.defineProperty(t.prototype,"anivisible",{set:function(t){if(t){this.ani.visible=true;this.ani.play(0,true)}else{this.ani.visible=false;this.ani.stop()}},enumerable:true,configurable:true});t.prototype.setSelect=function(t){this.anivisible=t};return t}();var t=function(i){__extends(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}t.prototype.initialize=function(){i.prototype.initialize.call(this);this.model=n.YiShouModel.getIns();this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.wuping.parserIcon(game.ItemUtil.ENUMS.YISHOU__MONEY.toString());this.liebiao.itemRender=a;this.liebiao.renderHandler=new Laya.Handler(this,this.onLibaoRenderHandler);this.__list=[];var t=new Laya.Handler(this,this.onSelectHandler);for(var e=0;e<5;e++){this.__list.push(new o(this.__list,this["ceng"+(e+1)],this["guang"+(e+1)],t))}};t.prototype.onLibaoRenderHandler=function(t){t.setData(t.dataSource)};t.prototype.onSelectHandler=function(t){var e=csv.YiShouProxy.getIns().getArrByLayer(t+1);this.liebiao.array=e};t.prototype.selectIndex=function(t){this.curIndex=t;this.__list[t].onClick()};t.prototype.onRefresh=function(){this.selectIndex(this.curIndex)};t.prototype.onDisplay=function(){this.model.on(n.YiShouEvent.EVENT_INFO_UPDATE,this,this.onRefresh);game.MoneyModel.getIns().on(game.MoneyModel.EVENTS.MONEY_CHANGE,this,this.onMoneyChange);this.selectIndex(0);this.onMoneyChange()};t.prototype.onUnDisplay=function(){game.MoneyModel.getIns().off(game.MoneyModel.EVENTS.MONEY_CHANGE,this,this.onMoneyChange);this.model.off(n.YiShouEvent.EVENT_INFO_UPDATE,this,this.onRefresh)};t.prototype.onMoneyChange=function(){this.shuliang.text=game.MoneyModel.format(game.MoneyModel.getIns().getMoney(game.MoneyModel.MONEY_ENUM.YISHOU__MONEY))};return t}(ui.yishouruqin.yishouruqinview5UI);n.YiShouDuiHuanShopView=t})(yishou||(yishou={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yishou;(function(t){var i=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.iconT=new tongtiange.ParseIcon;return t}t.prototype.initialize=function(){e.prototype.initialize.call(this);this.gezilist.itemRender=grids.GridView;this.gezilist.renderHandler=grids.GridView.CommonItemRender;this.newscModel=newshangcheng.NewShangChengModel.getIns();this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};t.prototype.onDisplay=function(){this.on(Laya.Event.CLICK,this,this.onChongZhiHandler)};t.prototype.onUnDisplay=function(){this.off(Laya.Event.CLICK,this,this.onChongZhiHandler)};t.prototype.onChongZhiHandler=function(){var t=this.cutType;if(t==tongtiange.ShopType.ChongZhi){this.newscModel.onLiBaoAction(this.actVo,this.cfg)}else if(t==tongtiange.ShopType.GoldBuy){var e=this.actVo.getSubInfo(this.cfg.id);if(!e){return}if(e.status==activitytaren.ActivityTaRenLingQuStatus.IS_ALREADY_LING_QU){return}var i=this.cfg.p1;if(game.MoneyModel.getIns().getMoney(game.MoneyModel.MONEY_ENUM.GOLD)<i){shop.ShopModel.getIns().askChongZhi()}else{game.Alert.show(app.getLang("ttg_tips12",i),new Laya.Handler(this,this.onOkHandler))}}};t.prototype.onOkHandler=function(){app.ProtocolRequest.RecvActPrizeReq(this.cfg.id,1)};t.prototype.onWidthChange=function(){this.refreshmoney(this.shuzhi1,this.yuanbox,this.yuan)};Object.defineProperty(t.prototype,"cutType",{get:function(){return this.cfg.p3},enumerable:true,configurable:true});t.prototype.clear=function(){this.daoju.skin="";game.RedDotView.removeFrom(this);this.shouqinimg.visible=false;this.shuzhi2.visible=false;this.yuanbaobox.visible=false;this.yuanbox.visible=false;this.jiyuanbox.visible=false};t.prototype.refreshmoney=function(t,e,i){t.x=(e.width-t.width-i.width)/2;i.x=t.x+t.width+10};t.prototype.onWidthChange3=function(){this.refreshmoney(this.shuzhi3,this.yuanbaobox,this.yuanbaoimg)};t.prototype.setData=function(t,e){this.actVo=t;this.cfg=e;var i=t.getSubInfo(e.id);this.clear();if(i){this.info=i;this.actVo=t;var n=void 0;var a=this.cutType;var o=0;var s=void 0;if(a==tongtiange.ShopType.GoldBuy){this.iconT.parseTaren(e.p6);n=e.p5;o=this.cfg.p1;if(o==0){this.jiyuanbox.visible=true}else{this.yuanbaobox.visible=true;this.shuzhi3.value=o.toString();this.shuzhi3.on(Laya.Event.RESIZE,this,this.onWidthChange3);s=e.p4}if(i.num>0){game.RedDotView.addTo(this,this.width-20,20)}}else{var r=csv.RechargeProxy.getIns().cfgMap[parseInt(e.p1)];if(r){s=r.limit;this.iconT.parseRecharge(r);o=r.recharge;n=r.reward;if(o==0){this.jiyuanbox.visible=true}else{this.yuanbox.visible=true;this.shuzhi1.value=app.convert_Yuan(o).toString();this.shuzhi1.on(Laya.Event.RESIZE,this,this.onWidthChange)}}else{console.error("recharge id "+e.p1+" 未找到")}}if(this.newscModel.isSellout(this.actVo,e.id)){this.shouqinimg.visible=true}else{if(o==0){game.RedDotView.addTo(this)}}if(this.iconT.showicon!=""){this.imgdaoju.skin=csv.ItemProxy.getUrl(this.iconT.showicon)}this.daoju.skin=this.iconT.res;this.imgjiaobiao.skin=this.iconT.subscript;this.xiangoulab.text=app.getLang("xinshangcheng_01",i.num,s);if(n){this.newscModel.setListVaule(this.gezilist,n)}}};return t}(ui.yishouruqin.ysrqxianshilibaoitemUI);var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.tarenModel=activitytaren.ActivityTaRenModel.getIns();this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.activityTimeView=new activitytaren.ActivityTimeView(this.daojishilab,new Laya.Handler(this,this.endTimeCallBack),app.getLang("huodong_text05"));this.liebiao.itemRender=i;this.liebiao.renderHandler=new Laya.Handler(this,this.onRenderHandler)};e.prototype.onRenderHandler=function(t,e){t.setData(this.actVo,t.dataSource)};e.prototype.endTimeCallBack=function(){this.activityTimeView.stop();this.daojishilab.text=""};e.prototype.onDisplay=function(){if(this.actVo){this.activityTimeView.start(this.actVo.timeVo.endTime);this.tarenModel.on(activitytaren.ActivityTaRenModel.ACTIVIT_TAREN_EVENT.UPDATE_ACTIVIT_DATA,this,this.onGetMainPanel);this.onGetMainPanel()}};e.prototype.onGetMainPanel=function(){this.liebiao.array=this.actVo.curCfgList};e.prototype.onUnDisplay=function(){this.tarenModel.off(activitytaren.ActivityTaRenModel.ACTIVIT_TAREN_EVENT.UPDATE_ACTIVIT_DATA,this,this.onGetMainPanel);this.activityTimeView.stop()};return e}(ui.yishouruqin.yishouruqinview3UI);t.YiShouDuiHuanView=e})(yishou||(yishou={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yishou;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){};e.prototype.onUnDisplay=function(){};return e}(ui.yishouruqin.yishouruqinview3UI);t.YiShouLibaoView=e})(yishou||(yishou={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yishou;(function(t){var i=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.control=new rank.RankItemNewControl;this.control.setSkin(this)};return e}(ui.yishouruqin.ysrqpaihangbangitemUI);var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.rankControl=new rank.RankControl;this.rankControl.setSkin(this,i,rank.RankModel.TYPE_ENUM.YI_SHOU_RU_QING);this.jianglibtn.clickHandler=new Laya.Handler(this,this.onJiangliHandler)};e.prototype.onJiangliHandler=function(){app.ViewManager.toggleDialog(a,1,0)};return e}(ui.yishouruqin.yishouruqinview4UI);t.YiShouPaiHangView=e;var n=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.listdaoju.itemRender=grids.GridView;this.listdaoju.renderHandler=grids.GridView.CommonItemRender};e.prototype.getRank=function(t){var e=t.rangk.split("-");if(e[0]==e[1]){return e[0]}return t.rangk};e.prototype.setData=function(t){this.labelpaiming.text=app.getLang("yishou_12",this.getRank(t));var e=game.ItemUtil.parserList(t.reward);this.listdaoju.array=e;this.listdaoju.width=(100+this.listdaoju.spaceX)*e.length;this.listdaoju.x=this.width-this.listdaoju.width*this.listdaoju.scaleX};return e}(ui.yishouruqin.ysrqpaihangjiangliitemUI);var a=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.curType=rank.RankModel.TYPE_ENUM.YI_SHOU_RU_QING;return t}t.prototype.initialize=function(){e.prototype.initialize.call(this);this._rankmodel=rank.RankModel.getIns();this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.labeltishi.text=app.getLang("yishou_11");this.listpaiming.itemRender=n;this.listpaiming.renderHandler=new Laya.Handler(this,this.onRenderHandler);this.listdaoju.itemRender=grids.GridView;this.listdaoju.renderHandler=grids.GridView.CommonItemRender};t.prototype.onRenderHandler=function(t,e){t.setData(t.dataSource)};t.prototype.onDisplay=function(){var t=csv.YiShouProxy.getIns().ruqin_paihangbangArr;var e=activitytaren.ActivityTaRenModel.getIns().iconMan.getOpenActidByType(activitytaren.ActivityTaRenType.YI_SHOU_RUQING);var i=[];if(e){for(var n=0;n<t.length;n++){var a=t[n];if(a.activityid==e){i.push(a)}}}this.myArr=i;this.listpaiming.array=this.myArr;this.callLater(this.onCallterHandler)};t.prototype.onCallterHandler=function(){app.ProtocolRequest.GetRankListReq(this.curType);this._rankmodel.on(rank.RankModel.RANK_DATA_CHANGE,this,this.onDataChange)};t.prototype.onUnDisplay=function(){this._rankmodel.off(rank.RankModel.RANK_DATA_CHANGE,this,this.onDataChange)};t.prototype.getMyReward=function(t){if(t==0){return""}var e=this.myArr;for(var i=0;i<e.length;i++){var n=e[i];var a=n.rangk.split("-");var o=parseInt(a[0]);var s=parseInt(a[1]);if(t>=o&&t<=s){return n.reward}}return""};t.prototype.getList=function(){var t=[];var e=this.myArr;for(var i=0;i<e.length;i++){var n=e[i];t.push(n)}return t};t.prototype.onDataChange=function(){this.labeltishi.text=app.getLang("ttg_tips8");var t=rank.RankModel.getIns().getRankInfo(this.curType);var e=[];if(t.rank==0){this.labeljifenjianglicishu.text=app.getLang("ttg_tips7");this.labelcishunum.text="";this.listdaoju.array=e}else{this.labeljifenjianglicishu.text=app.getLang("ttg_tips5");this.labelcishunum.text=t.rank.toString();e=game.ItemUtil.parserList(this.getMyReward(t.rank));this.listdaoju.array=e}var i=e.length*(98+this.listdaoju.spaceX);this.listdaoju.x=this.width-i*this.listdaoju.scaleX-100;this.listdaoju.width=i;this.listpaiming.array=this.getList()};return t}(ui.yishouruqin.ysrqpaihangjiangliUI)})(yishou||(yishou={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yishou;(function(n){var i=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.model=n.YiShouModel.getIns();this.liebiao.itemRender=grids.GridView;this.liebiao.renderHandler=grids.GridView.CommonItemRender;this.qianwangbtn.clickHandler=new Laya.Handler(this,this.onQianWang);this.lingqubtn.clickHandler=new Laya.Handler(this,this.onLingquClick)};e.prototype.onLingquClick=function(){app.ProtocolRequest.YiShouAwardReq(this.cfg.id)};e.prototype.onQianWang=function(){game.WindowsResigter.call(csv.FunctionsProxy.ENUMS.YI_SHOU_RU_QING)};e.prototype.setData=function(t){this.cfg=t;var e=0;if(t.type==csv.EYiShouTiaoZhanType.All){e=this.model.allKillNum;this.tiaojian.text=app.getLang("yishou_07",t.value)}else{e=this.model.killNum;this.tiaojian.text=app.getLang("yishou_05",t.value)}this.shuzhi.text=e+"/"+t.value;this.liebiao.array=game.ItemUtil.parserList(t.reward);this.jindutiao.value=e/t.value;this.lingqubtn.visible=false;this.yilingqu.visible=false;this.qianwangbtn.visible=false;if(this.model.isLingqued(this.cfg.id)){this.yilingqu.visible=true}else{if(e<this.cfg.value){this.qianwangbtn.visible=true}else{this.lingqubtn.visible=true}}};return e}(ui.yishouruqin.ysrqpaimingitem1UI);var a=function(){function t(t){this.skin=t;this.model=n.YiShouModel.getIns();this.arr=csv.YiShouProxy.getIns().getListByType(csv.EYiShouTiaoZhanType.Loop);this.skin.daoju.itemRender=grids.GridView;this.skin.daoju.renderHandler=grids.GridView.CommonItemRender;this.skin.lingqubtn.clickHandler=new Laya.Handler(this,this.onlingQuHandler);this.zuo.clickHandler=new Laya.Handler(this,this.onArrowHandler,[this.zuo]);this.you.clickHandler=new Laya.Handler(this,this.onArrowHandler,[this.you])}Object.defineProperty(t.prototype,"zuo",{get:function(){return this.skin.zuo},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"you",{get:function(){return this.skin.you},enumerable:true,configurable:true});t.prototype.onArrowHandler=function(t){var e=this.arr.indexOf(this.cfg);switch(t){case this.zuo:if(e==0){}else{this.cfg=this.arr[e-1];this.update()}break;case this.you:if(e+1>=this.arr.length){}else{this.cfg=this.arr[e+1];this.update()}break}};t.prototype.onlingQuHandler=function(){app.ProtocolRequest.YiShouAwardReq(this.cfg.id)};t.prototype.update=function(){if(!this.cfg){this.cfg=this.arr[0]}var t=this.cfg;if(t){this.skin.lunci.text=app.getLang("yishou_06",this.model.killNum,this.cfg.value);this.skin.daoju.array=game.ItemUtil.parserList(t.reward);this.skin.lingqubtn.visible=false;this.skin.yilingquimg.visible=false;this.skin.weiwanchegnimg.visible=false;if(this.model.isLingqued(t.id)){this.skin.yilingquimg.visible=true}else{if(t.value<this.model.killNum){this.skin.lingqubtn.visible=true}else{this.skin.weiwanchegnimg.visible=true}}var e=this.arr.indexOf(t);this.zuo.visible=this.you.visible=false;if(e==0){this.zuo.visible=false;this.you.visible=true}else if(e==this.arr.length-1){this.zuo.visible=true;this.you.visible=false}else{this.zuo.visible=this.you.visible=true}}};return t}();var o=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.ysView=new a(this);this.model=n.YiShouModel.getIns();this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.liebiao.itemRender=i;this.liebiao.renderHandler=new Laya.Handler(this,this.onItemRender)};e.prototype.onItemRender=function(t,e){t.setData(t.dataSource)};e.prototype.onDisplay=function(){this.model.on(n.YiShouEvent.EVENT_INFO_UPDATE,this,this.onUpdateEvt);this.onUpdateEvt()};e.onSortHandler=function(t,e){var i=n.YiShouModel.getIns();if(i.isLingqued(t.id)){return 1}else{if(t.id>e.id){return 1}return-1}};e.prototype.onUpdateEvt=function(){var t=csv.YiShouProxy.getIns().getListByType(csv.EYiShouTiaoZhanType.Self);t.sort(e.onSortHandler);this.liebiao.array=t;this.ysView.update()};e.prototype.onUnDisplay=function(){this.model.off(n.YiShouEvent.EVENT_INFO_UPDATE,this,this.onUpdateEvt)};return e}(ui.yishouruqin.yishouruqinphview1UI);var s=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.model=n.YiShouModel.getIns();this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.liebiao.itemRender=i;this.liebiao.renderHandler=new Laya.Handler(this,this.onItemRender)};e.prototype.onItemRender=function(t,e){t.setData(t.dataSource)};e.prototype.onDisplay=function(){this.model.on(n.YiShouEvent.EVENT_INFO_UPDATE,this,this.onUpdateEvt);this.onUpdateEvt()};e.prototype.onUpdateEvt=function(){var t=csv.YiShouProxy.getIns().getListByType(csv.EYiShouTiaoZhanType.All);t.sort(o.onSortHandler);this.liebiao.array=t};e.prototype.onUnDisplay=function(){this.model.off(n.YiShouEvent.EVENT_INFO_UPDATE,this,this.onUpdateEvt)};return e}(ui.yishouruqin.yishouruqinphview2UI);var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t._actid=0;t.geren=new o;t.quanfu=new s;return t}t.prototype.initialize=function(){e.prototype.initialize.call(this);this.actModel=activitytaren.ActivityTaRenModel.getIns();this.activityTimeView=new activitytaren.ActivityTimeView(this.daojishi,new Laya.Handler(this,this.endTimeCallBack),app.getLang("huodong_text05"));this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.tabList=[];this.tabList.push(this.yeqian1,this.yeqian2);for(var t=0;t<this.tabList.length;t++){this.tabList[t].clickHandler=new Laya.Handler(this,this.onTabClick,[t])}};t.prototype.endTimeCallBack=function(){this.activityTimeView.stop();this.daojishi.text=""};t.prototype.onTabClick=function(t){this.selectHandler(t)};t.prototype.onDisplay=function(){this._actid=activitytaren.ActivityTaRenModel.getIns().iconMan.getOpenActidByType(activitytaren.ActivityTaRenType.YI_SHOU_RUQING);if(this._actid){activitytaren.ActivityTaRenModel.getIns().getInfoByActID(this._actid,new Laya.Handler(this,this.getInfoHandler))}};t.prototype.getInfoHandler=function(){this._actVo=activitytaren.ActivityTaRenModel.getIns().getActivityID_By_functionid(csv.FunctionsProxy.ENUMS.YI_SHOU_RU_QING);this.activityTimeView.start(this._actVo.timeVo.endTime);this.selectHandler(0)};t.prototype.onUnDisplay=function(){this.activityTimeView.stop()};t.prototype.selectHandler=function(t){while(this.jiemian.numChildren){this.jiemian.removeChildAt(0)}switch(t){case 0:this.jiemian.addChild(this.geren);break;case 1:this.jiemian.addChild(this.quanfu);break}for(var e=0;e<this.tabList.length;e++){var i=this.tabList[e];if(t==e){i.selected=true}else{i.selected=false}}};return t}(ui.yishouruqin.yishouruqinview2UI);n.YiShouTiaoZhanView=t})(yishou||(yishou={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yishou;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.getBossId=function(){return this.model.info.playerData[0].curBossId};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.activityTimeView=new activitytaren.ActivityTimeView(this.daojishi,new Laya.Handler(this,this.endTimeCallBack),app.getLang("huodong_text05"));this.wuping.skin=csv.ItemProxy.getUrl(csv.ItemProxy.getIns().itemCfgMap[game.ItemUtil.ENUMS.YISHOU__MONEY]);this.wuping.scaleX=this.wuping.scaleY=.4;game.HelperViewHandler.register(csv.FunctionsProxy.ENUMS.YI_SHOU_RU_QING,[this.wenhaobtn]);this.jishajiangli.listdaoju.itemRender=grids.GridView;this.jishajiangli.listdaoju.renderHandler=grids.GridView.CommonItemRender;this.model=i.YiShouModel.getIns();this.tianleiC=new n(this.tianlei,this.leiji2);this.tianqieC=new n(this.tianqie,this.leiji1);this.listtishi.itemRender=ui.yishouruqin.ysrqpiaoziUI;this.listtishi.renderHandler=new Laya.Handler(this,this.onRenderHandler);this.listtishi.vScrollBarSkin=" "};e.prototype.onRenderHandler=function(t,e){var i=t.dataSource;t.huodetxt.text=app.getLang("yishou_02",i.roleName,i.num)};e.prototype.endTimeCallBack=function(){this.activityTimeView.stop();this.daojishi.text=""};e.prototype.onDisplay=function(){this.activityTimeView.start(this.actVo.timeVo.endTime);game.MoneyModel.getIns().on(game.MoneyModel.EVENTS.MONEY_CHANGE,this,this.onMoneyChange);this.onMoneyChange();this.model.on(i.YiShouEvent.EVENT_INFO_UPDATE,this,this.onCallLater);this.callLater(this.onCallLater)};e.prototype.onCallLater=function(){var t=csv.YiShouProxy.getIns().ruqin_jishajiangliMap[this.getBossId()];this.jishajiangli.listdaoju.array=game.ItemUtil.parserList(t.reward);this.imgmingzi.skin=t.showname;this.imgyishou.skin=t.appearance;this.tianleiC.setData(t.cost1,1,this.actVo);this.tianqieC.setData(t.cost1,t.cost2,this.actVo);var e=this.model.info.playerData[0];var i=parseInt(t.damage);this.jindutiao.value=e.costNum/t.kill;this.labeljindu.text=e.costNum*i+"/"+t.kill*i;var n=[];if(this.model.info.serverData.length>0){n=this.model.info.serverData[0].killData||[]}this.listtishi.array=n;if(n.length>0){this.listtishi.scrollTo(n.length-1)}var a=this.getNextCnt(e.killNum);if(a==-1){this.cengshulab.text=app.getLang("yishou_03")}else{this.cengshulab.text=app.getLang("yishou_04",a-e.killNum)}};e.prototype.getNextCnt=function(t){var e=csv.YiShouProxy.getIns().getListByActid(this.actVo.actid);if(e){if(t==0){return e[0].value}for(var i=0;i<e.length;i++){var n=e[i];if(i<e.length-1){var a=e[i+1];if(t>=n.value&&t<a.value){return a.value}}}return-1}return 0};e.prototype.onMoneyChange=function(){this.shuliang.text=game.MoneyModel.format(game.MoneyModel.getIns().getMoney(game.MoneyModel.MONEY_ENUM.YISHOU__MONEY))};e.prototype.onUnDisplay=function(){this.tianleiC.onUnDisplay();this.tianqieC.onUnDisplay();this.activityTimeView.stop();this.model.off(i.YiShouEvent.EVENT_INFO_UPDATE,this,this.onCallLater);game.MoneyModel.getIns().off(game.MoneyModel.EVENTS.MONEY_CHANGE,this,this.onMoneyChange)};return e}(ui.yishouruqin.yishouruqinview1UI);i.YiShowView=t;var n=function(){function t(t,e){this.canUse=false;this.useNum=0;this.ani=e;this.model=i.YiShouModel.getIns();this.skin=t;this.skin.btnanniu.clickHandler=new Laya.Handler(this,this.onClickHandler)}t.prototype.onClickHandler=function(){if(this.canUse){this.model.once(i.YiShouEvent.EVENT_KILL_SUCCEED,this,this.onSucceed);app.ProtocolRequest.YiShouKillReq(this.actVo.actid,this.useNum)}else{manager.FlowManager.instance.flowByStyle1(app.getLang("yishou_01"))}};t.prototype.onUnDisplay=function(){this.model.off(i.YiShouEvent.EVENT_KILL_SUCCEED,this,this.onSucceed)};t.prototype.onSucceed=function(){this.ani.play(0,false)};t.prototype.setData=function(t,e,i){this.actVo=i;var n=t.split("-");var a=parseInt(n[0]);var o=parseInt(n[1])*e;var s=game.ItemUtil.createVO(a);s.setCount(o);this.skin.daojuegezi.setData(s);var r=game.GridsModel.getIns().getItemCount(a);var l=game.STYLES.GREEN_COLOR_S;this.canUse=true;if(r<o){this.canUse=false;l=game.STYLES.RED_COLOR_S}this.useNum=o;this.skin.labelcishu.color=l;this.skin.labelcishu.text=r+"/"+o};return t}()})(yishou||(yishou={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yuanshencode;(function(l){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.init=function(){this._model=l.YuanshenModel.getIns();this._xlmodel=l.KuafuXiulianModel.getIns();app.ViewManager.regist(l.KuafuXiulianReportView,"jingjichang.atlas");app.ViewManager.regist(l.YuanshenXiuLianView,"jiuchongyaota.atlas");game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.YUANSHEN_DONGFU,l.YuanshenMainView);game.FuncDotAdapter.registRedFunc(csv.FunctionsProxy.ENUMS.YUANSHEN_DONGFU,this._model,this._model.fuyaoFuidRed);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.KUAFU_XIULIAN,l.KuafuXiulianView);this._model.on(l.YuanshenModel.UPDATE_YUANSHEN_DATA,this,this.onRedDotChange);this._model.on(l.YuanshenModel.ROLE_TUPO_STATE_RETURN,this,this.onRedDotChange);this._model.on(l.YuanshenModel.YANG_CHEN_LV_RO_JIHUO,this,this.onRedDotChange)};e.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.SecSoulDataNtf,this,this.onSecSoulDataNtf);this.addMsgListener(app.ProtocolResponse.SecSoulShieldNtf,this,this.onSecSoulShieldNtf);this.addMsgListener(app.ProtocolResponse.SecSoulDujieDamage,this,this.onSecSoulDujieDamage);this.addMsgListener(app.ProtocolResponse.SecSoulDujieEnd,this,this.onSecSoulDujieEnd);this.addMsgListener(app.ProtocolResponse.SecSoulEventNtf,this,this.onSecSoulEventNtf);this.addMsgListener(app.ProtocolResponse.SecSoulStartResp,this,this.onSecSoulStartResp);this.addMsgListener(app.ProtocolResponse.SecSoulTupoAck,this,this.onSecSoulTupoAck);this.addMsgListener(app.ProtocolResponse.SecSoulDujieStartAck,this,this.onSecSoulDujieStartAck);this.addMsgListener(app.ProtocolResponse.SecSoulTreasureUpResp,this,this.onSecSoulTreasureUpResp);this.addMsgListener(app.ProtocolResponse.SecSoulEventResp,this,this.onSecSoulEventResp);this.addMsgListener(app.ProtocolResponse.SecSoulMakeUpResp,this,this.onSecSoulMakeUpResp);this.addMsgListener(app.ProtocolResponse.CrossSecSoulTimeNtf,this,this.onCrossSecSoulTimeNtf);this.addMsgListener(app.ProtocolResponse.CrossSecSoulSecenesAck,this,this.onCrossSecSoulSecenesAck);this.addMsgListener(app.ProtocolResponse.CrossSecSoulBattleRecordAck,this,this.onCrossSecSoulBattleRecordAck);this.addMsgListener(app.ProtocolResponse.CrossSecSoulChallengeAck,this,this.onCrossSecSoulChallengeAck);this.addMsgListener(app.ProtocolResponse.CrossSecSoulSetBattleArrayAck,this,this.onCrossSecSoulSetBattleArrayAck)};e.prototype.onCrossSecSoulTimeNtf=function(t,e){this._xlmodel.challenge=e.challenge;this._xlmodel.weekly_total=e.weekly_total;this._xlmodel.start_time=e.start_time;this._xlmodel.currId=e.cfg_id;this._xlmodel.updataRedDot();this._xlmodel.event(l.KuafuXiulianModel.INFO_RESET)};e.prototype.onCrossSecSoulSecenesAck=function(t,e){if(e.result){this._xlmodel.setXiulianInfo(e.data)}};e.prototype.onCrossSecSoulBattleRecordAck=function(t,e){if(e.result){if(!this._xlmodel.selfAskReport){this._xlmodel.boRecordRed=true;this._xlmodel.updataRedDot();this._xlmodel.updataSelf()}else{this._xlmodel.selfAskReport=false}this._xlmodel.battleRecords=e.record_data;this._xlmodel.event(l.KuafuXiulianModel.REPORT_REFRESH)}};e.prototype.onCrossSecSoulChallengeAck=function(t,e){};e.prototype.onCrossSecSoulSetBattleArrayAck=function(t,e){};e.prototype.onRedDotChange=function(){Laya.timer.callLater(this,this.onUpdateRedDot)};e.prototype.onUpdateRedDot=function(){this._model.fuyaoFuidRed()};e.prototype._goFunView=function(){};e.prototype.onSecSoulDataNtf=function(t,e){var i=e.dongfudata;SortUtil.sortOnArr(i,["id"],[SortUtil.NUMERIC]);var n=l.YuanshenModel.getIns().getDongfuNetItemData(5);if(n&&n.lock==0&&e.dongfudata[4].lock==1){app.ViewManager.toggleDialog(mjhole.MjHoleDongfuGetView,1,0,null)}this._model.dongfuNetArr=i;this._model.secsouldata=e.secsouldata;this._model.elixirdata=e.elixirdata;this._model.status=e.status;this._model.timedata=e.timedata;this._model.event(l.YuanshenModel.UPDATE_YUANSHEN_DATA);this._model.fuyaoFuidRed();for(var a=0;a<game.Context.roleList.length;a++){var o=this._model.getXiuLianNetItemData(game.Context.roleList[a].insId);if(o){var s=csv.YuanshenProxy.getIns().get_xiulianCustomCfgMap3(o.realm1,o.realm2,o.realm3);var r=csv.YuanshenProxy.getIns().get_xiulianAttrCfgMapItem(game.Context.roleList[a].prof,s.id);game.Context.roleList[a].soulStar=r.id}}role.LeadingRoleView.getIns().updataSkin();l.KuafuXiulianModel.getIns().updataRedDot();this._model.fuyaoFuidRed()};e.prototype.onSecSoulEventNtf=function(t,e){this._model.eventdata=e.eventdata;this._model.event(l.YuanshenModel.FU_YUAN_EVENT)};e.prototype.onSecSoulShieldNtf=function(t,e){this._model.event(l.YuanshenModel.DU_LEI_JIE_HUDUN);this._model.leidunTime=e.endtime};e.prototype.onSecSoulDujieDamage=function(t,e){this._model.event(l.YuanshenModel.DU_LEI_JIE_DAMAGE,e)};e.prototype.onSecSoulDujieEnd=function(t,e){Laya.timer.once(2e3,this,function(){if(e.ret==1){manager.EffectManager.playStageEffect("skill_dujiechenggong",0,-200,null,1.5)}else{manager.EffectManager.playStageEffect("skill_dujieshibai",0,-200,null,1.5);app.SoundManager.getIns().playSound("fail")}});Laya.timer.once(3e3,this,function(){if(e.ret==1){app.ViewManager.toggleDialog(l.YuanshenXiulianTupoBigSucceedView,1,0);app.ViewManager.toggleDialog(l.YuanshenDuJieView,-1,0);app.ViewManager.toggleDialog(l.YuanshenDuJieLeiView,-1,0)}else{app.ViewManager.toggleDialog(l.YuanshenDuJieView,-1,0);app.ViewManager.toggleDialog(l.YuanshenDuJieLeiView,-1,0)}l.YuanshenDuJieView.getIns().stopGuard()})};e.prototype.onSecSoulStartResp=function(t,e){if(e.ret==1){}};e.prototype.onSecSoulTupoAck=function(t,e){this._model.event(l.YuanshenModel.ROLE_TUPO_STATE_RETURN,e.ret)};e.prototype.onSecSoulDujieStartAck=function(t,e){if(e.ret==1){app.ViewManager.toggleDialog(l.YuanshenDuJieLeiView,1,0,e);console.log("开始渡劫")}else{}};e.prototype.onSecSoulTreasureUpResp=function(t,e){if(e.ret==1){this._model.event(l.YuanshenModel.YANG_CHEN_LV_RO_JIHUO)}else{}};e.prototype.onSecSoulEventResp=function(t,e){if(e.ret==1){this._model.checkEventResult(e.id)}else{}};e.prototype.onSecSoulMakeUpResp=function(t,e){this._model.makeUpData=e.data;this._model.event(l.YuanshenModel.YUANSHEN_ADDVIEW_DATA)};e.SINGLE_KEY="yuanshencode.YuanshenModule";return e}(app.ModuleBase);l.YuanshenModule=t})(yuanshencode||(yuanshencode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yuanshencode;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=i.KuafuXiulianModel.getIns();this.quedingbtn.on(Laya.Event.CLICK,this,this.onConfirm);this.quxiaobtn.on(Laya.Event.CLICK,this,this.onCancle)};e.prototype.onConfirm=function(){app.ViewManager.toggleDialog(e,-1,0);app.ViewManager.toggleDialog(i.KuafuXiulianRoleSelectView,1,0,this._data)};e.prototype.onCancle=function(){app.ViewManager.toggleDialog(e,-1,0)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){this._data=this.dataSource;this.label01.text=app.getLang(this._data.gridname);this.label01.color=game.STYLES.KFXL_QUA[this._data.quality];this.label02.text=app.getLang("kfxiulian_3_3",Math.ceil(this._data.xlexp*this._data.absorptivity/100));this.label03.text=app.getLang("kfxiulian_3_4");this._battleTime=this._model.challenge-game.Context.getServerTime();this.loopProtectTime();Laya.timer.loop(1e3,this,this.loopProtectTime)};e.prototype.loopProtectTime=function(){if(this._battleTime>=0){this.quedingbtn.disabled=true;this.lengquelab.visible=true;this.lengquelab.text=app.getLang("kfxiulian_4_5",util.TimeUtil.formatTime(this._battleTime))}else{this.quedingbtn.disabled=false;this.lengquelab.visible=false;Laya.timer.clear(this,this.loopProtectTime)}this._battleTime--};e.SINGLE_KEY="yuanshencode.KuafuXiulianMonTip";return e}(ui.kuafuxiulian.kuafuxiuliantishitipUI);i.KuafuXiulianMonTip=t;var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=i.KuafuXiulianModel.getIns();this.quedingbtn.on(Laya.Event.CLICK,this,this.onConfirm);this.quxiaobtn.on(Laya.Event.CLICK,this,this.onCancle)};e.prototype.onConfirm=function(){app.ViewManager.toggleDialog(e,-1,0);app.ViewManager.toggleDialog(i.KuafuXiulianRoleSelectView,1,0,this._data)};e.prototype.onCancle=function(){app.ViewManager.toggleDialog(e,-1,0)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){Laya.timer.clearAll(this)};e.prototype.refreshAll=function(){this._data=this.dataSource;this.label01.text=app.getLang(this._data.gridname);this.label01.color=game.STYLES.KFXL_QUA[this._data.quality];this.label02.text=app.getLang("kfxiulian_3_3",Math.ceil(this._data.xlexp*this._data.absorptivity/100));var t=this._model.getXiulianInfoById(this._data.id);this.wanjianame.text=game.Context.getSerName(t.cursvrid)+t.uname;this.touxiangimg.skin=csv.MyTeamProxy.getIns().getTeamIcon(t.simpleteamavatar);this.touxiangkuang.skin=csv.HeadFrameProxy.getIns().getIcon(t.headframeId);this.dengjilab.text=t.team_level.toString();this.shuzhi.value=game.MoneyModel.format(t.score.toNumber())+"";this._leastTime=game.Context.getServerTime()-t.start_time;this.jindutiao.value=t.hp_percent/100;this.jindutiaoshuzi.text=t.hp_percent+"%";this.loopFreshTime();Laya.timer.loop(1e3,this,this.loopFreshTime);this._battleTime=this._model.challenge-game.Context.getServerTime();this.loopProtectTime();Laya.timer.loop(1e3,this,this.loopProtectTime)};e.prototype.loopFreshTime=function(){if(this._leastTime>=0){this.xiulianshijian.visible=true;this.xiulianshijian.text=app.getLang("kfxiulian_4_4",util.TimeUtil.formatTime(this._leastTime))}else{this.xiulianshijian.visible=false;Laya.timer.clear(this,this.loopFreshTime)}this._leastTime++};e.prototype.loopProtectTime=function(){if(this._battleTime>=0){this.quedingbtn.disabled=true;this.shengyulab.visible=true;this.shengyulab.text=app.getLang("kfxiulian_4_5",util.TimeUtil.formatTime(this._battleTime))}else{this.quedingbtn.disabled=false;this.shengyulab.visible=false;Laya.timer.clear(this,this.loopProtectTime)}this._battleTime--};e.SINGLE_KEY="yuanshencode.KuafuXiulianRoleTip";return e}(ui.kuafuxiulian.kuafuxiulianzhenduotipUI);i.KuafuXiulianRoleTip=e})(yuanshencode||(yuanshencode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yuanshencode;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.btnqueding.clickHandler=new Laya.Handler(this,this.close);this.listjilu.itemRender=n;this.listjilu.renderHandler=new Laya.Handler(this,this.onRenderHander);this._model=i.KuafuXiulianModel.getIns()};e.prototype.onRenderHander=function(t){t.setData(t.dataSource)};e.prototype.onDisplay=function(){this._model.on(i.KuafuXiulianModel.REPORT_REFRESH,this,this.refreshAll);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){this._model.off(i.KuafuXiulianModel.REPORT_REFRESH,this,this.refreshAll)};e.prototype.refreshAll=function(){this.listjilu.array=this._model.battleRecords.concat().reverse();this.wuimg.visible=this._model.battleRecords.length==0};e.SINGLE_KEY="yuanshencode.KuafuXiulianReportView";return e}(ui.jingjichang.zhanbaotipUI);i.KuafuXiulianReportView=t;var n=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.labeltime02.text="";this.labeljifen.visible=false;this.btnbofang.clickHandler=new Laya.Handler(this,this.onHuiFang)};e.prototype.onHuiFang=function(){var t=i.KuafuXiulianModel.getIns().battleRecords.indexOf(this._data);if(t!=-1){i.KuafuXiulianModel.getIns().boCheckRecord=true;app.ProtocolRequest.CrossSecSoulBattleRecordShowReq(t)}};e.prototype.setData=function(t){this._data=t;if(t.is_win){this.imgshengli.skin="jingjichang/bg_jingjichang_sheng.png"}else{this.imgshengli.skin="jingjichang/bg_jingjichang_bai.png"}this.imgzhudongtiaozhan.skin=t.is_active==0?"jingjichang/bg_jjc_fang.png":"jingjichang/bg_jjc_gong.png";this.itemtouxiang.imgtouxiang.skin=csv.MyTeamProxy.getIns().getTeamIcon(t.simpleteamavatar);this.itemtouxiang.imgframe.skin=csv.HeadFrameProxy.getIns().getIcon(t.headframeId);this.labelname.text=game.Context.getSerName(t.cursvrid)+t.uname;this.labeltime01.text=util.TimeUtil.formatDate(t.time,true)};return e}(ui.jingjichang.zhanbaoitemUI);i.KuafuXiulianReportItem=n})(yuanshencode||(yuanshencode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yuanshencode;(function(o){var t=function(e){__extends(i,e);function i(){var t=e!==null&&e.apply(this,arguments)||this;t.fullScreen="fullScreen";return t}i.getIns=function(){return app.Singleton.getInstance(i)};i.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listchuzhan.itemRender=n;this.listchuzhan.renderHandler=new Laya.Handler(this,this.onRenderHandler);this._model=o.KuafuXiulianModel.getIns();this.btnjinru.on(Laya.Event.CLICK,this,this.onClick);this.labeltaitou.text=app.getLang("kfxiulian_8_1")};i.prototype.onRenderHandler=function(t,e){t.setData(t.dataSource,this._bigrealm)};i.prototype.onClick=function(){if(this._model.definedProfs.length){app.ProtocolRequest.CrossSecSoulSetBattleArrayReq(this._model.myId,this._model.definedProfs);app.ViewManager.toggleDialog(i,-1,0);var t=o.YuanshenModel.getIns().getDongfuNetItemData(6);app.ViewManager.toggleDialog(o.YuanshenXiuLianView,1,0,t)}else{manager.FlowManager.instance.flowByStyle1(app.getLang("kfxiulian_8_4"))}};i.prototype.onDisplay=function(){this.callLater(this.refreshAll)};i.prototype.onUnDisplay=function(){};i.prototype.refreshAll=function(){this._data=csv.YuanshenProxy.getIns().getKfCfgMapItem(this._model.myId);this._bigrealm=role.RoleVO.getBigRealm(this._data.realm);this._model.definedProfs=[];var t=[];for(var e=0;e<game.Context.battleRoleList.length;e++){var i=game.Context.battleRoleList[e];var n=role.RoleVO.getXiulianId(i.soulStar);if(n>=this._data.realm){this._model.definedProfs.push(i.prof);t.push(i)}if(this._model.definedProfs.length>=5){break}}for(var e=0;e<game.Context.waitRoleList.length;e++){if(this._model.definedProfs.length>=5){break}var i=game.Context.waitRoleList[e];var n=role.RoleVO.getXiulianId(i.soulStar);if(n>=this._data.realm){this._model.definedProfs.push(i.prof);t.push(i)}}SortUtil.sortOnArr(t,["prof"],[SortUtil.NUMERIC]);for(var e=0;e<game.Context.roleList.length;e++){var i=game.Context.roleList[e];if(this._model.definedProfs.indexOf(i.prof)==-1){t.push(i)}}this.listchuzhan.array=t;if(this._bigrealm==0){this.tiaojian.visible=false}else{this.tiaojian.visible=true;var a=o.YuanshenModel.getIns().getBigRealm(this._bigrealm);this.tiaojian.text=app.getLang("mijingjiesuo_jingjiexianzhi",a)}};i.SINGLE_KEY="yuanshencode.KuafuXiulianRoleDefinedView";return i}(ui.mijing.zhenrongviewUI);o.KuafuXiulianRoleDefinedView=t;var n=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.on(Laya.Event.CLICK,this,this.onClick);this._model=o.KuafuXiulianModel.getIns();this.xuanze.mouseEnabled=false};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t,e){this._vo=t;this._needBigrealm=e;this.zhenrongitem.setData(t);this.zhenrongitem.imgxuanzhong.visible=this.xuanze.selected=this._model.definedProfs.indexOf(t.prof)!=-1;this.labelwa.text=t.getName();this._myBigrealm=role.RoleVO.getBigRealm(t.soulStar);this.labeldfengji.text=o.YuanshenModel.getIns().getBigRealm(this._myBigrealm)};e.prototype.onClick=function(){if(!this._vo.soulStar||this._needBigrealm>this._myBigrealm){manager.FlowManager.instance.flowByStyle1(app.getLang("mijingjiesuo_02"));return}var t=this._model.definedProfs.indexOf(this._vo.prof);if(t==-1){if(this._model.definedProfs.length>=5){return}this._model.definedProfs.push(this._vo.prof);this.zhenrongitem.imgxuanzhong.visible=this.xuanze.selected=true}else{this._model.definedProfs.splice(t,1);this.zhenrongitem.imgxuanzhong.visible=this.xuanze.selected=false}};e.SINGLE_KEY="yuanshencode.KuafuXiulianRoleDefinedItem";return e}(ui.mijing.zhenrongitemUI);o.KuafuXiulianRoleDefinedItem=n})(yuanshencode||(yuanshencode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yuanshencode;(function(o){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.fullScreen="fullScreen";return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listchuzhan.itemRender=i;this.listchuzhan.renderHandler=new Laya.Handler(this,this.onRenderHandler);this._model=o.KuafuXiulianModel.getIns();this.btnjinru.on(Laya.Event.CLICK,this,this.onClick)};t.prototype.onRenderHandler=function(t,e){t.setData(t.dataSource,this._bigrealm)};t.prototype.onClick=function(){if(!this._model.battleProfs.length){manager.FlowManager.instance.flowByStyle1(app.getLang("kfxiulian_5_4"));return}app.ViewManager.toggleDialog(t,-1,0);app.ViewManager.toggleDialog(t,-1,0);this._model.checkXiulianInfo(this.dataSource.id)};t.prototype.onDisplay=function(){this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){};t.prototype.refreshAll=function(){this._model.battleProfs=[];var t=[];for(var e=0;e<game.Context.battleRoleList.length;e++){var i=game.Context.battleRoleList[e];var n=role.RoleVO.getXiulianId(i.soulStar);if(n>=this.dataSource.realm){this._model.battleProfs.push(i.prof);t.push(i)}if(this._model.battleProfs.length>=5){break}}for(var e=0;e<game.Context.waitRoleList.length;e++){if(this._model.battleProfs.length>=5){break}var i=game.Context.waitRoleList[e];var n=role.RoleVO.getXiulianId(i.soulStar);if(n>=this.dataSource.realm){this._model.battleProfs.push(i.prof);t.push(i)}}SortUtil.sortOnArr(t,["prof"],[SortUtil.NUMERIC]);for(var e=0;e<game.Context.roleList.length;e++){var i=game.Context.roleList[e];if(this._model.battleProfs.indexOf(i.prof)==-1){t.push(i)}}this.listchuzhan.array=t;this._bigrealm=role.RoleVO.getBigRealm(this.dataSource.realm);if(this._bigrealm==0){this.tiaojian.visible=false}else{this.tiaojian.visible=true;var a=o.YuanshenModel.getIns().getBigRealm(this._bigrealm);this.tiaojian.text=app.getLang("mijingjiesuo_jingjiexianzhi",a)}};t.SINGLE_KEY="yuanshencode.KuafuXiulianRoleSelectView";return t}(ui.mijing.zhenrongviewUI);o.KuafuXiulianRoleSelectView=t;var i=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.on(Laya.Event.CLICK,this,this.onClick);this._model=o.KuafuXiulianModel.getIns();this.xuanze.mouseEnabled=false};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t,e){this._vo=t;this._needBigrealm=e;this.zhenrongitem.setData(t);this.zhenrongitem.imgxuanzhong.visible=this.xuanze.selected=this._model.battleProfs.indexOf(t.prof)!=-1;this.labelwa.text=t.getName();this._myBigrealm=role.RoleVO.getBigRealm(t.soulStar);this.labeldfengji.text=o.YuanshenModel.getIns().getBigRealm(this._myBigrealm)};e.prototype.onClick=function(){if(!this._vo.soulStar||this._needBigrealm>this._myBigrealm){manager.FlowManager.instance.flowByStyle1(app.getLang("mijingjiesuo_02"));return}var t=this._model.battleProfs.indexOf(this._vo.prof);if(t==-1){if(this._model.battleProfs.length>=5){return}this._model.battleProfs.push(this._vo.prof);this.zhenrongitem.imgxuanzhong.visible=this.xuanze.selected=true}else{this._model.battleProfs.splice(t,1);this.zhenrongitem.imgxuanzhong.visible=this.xuanze.selected=false}};e.SINGLE_KEY="yuanshencode.KuafuXiulianRoleSelectItem";return e}(ui.mijing.zhenrongitemUI);o.KuafuXiulianRoleSelectItem=i})(yuanshencode||(yuanshencode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yuanshencode;(function(l){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=l.KuafuXiulianModel.getIns();this.panel=new i;this.ditu.addChild(this.panel);this.lrMediator=new game.LeftRightMoveMediator(this.zuo,this.you,this.panel);this.lrMediator.selectHandler=new Laya.Handler(this,this.onSelect);this.zhanbaobtn.on(Laya.Event.CLICK,this,this.onReport);this.shijian.text=app.getLang("kfxiulian_1_10",util.TimeUtil.formatTime(this._model.startTime,false,false),util.TimeUtil.formatTime(this._model.endTime,false,false));this.fanye.renderHandler=new Laya.Handler(this,this._onYeqianRender);this.centerLayout=new game.CenterLayoutMediator(this.fanye,this.fanyebox,32,this.fanye.spaceX);this.centerLayout.array=csv.YuanshenProxy.getIns().getAllKfArr();game.HelperViewHandler.register(csv.FunctionsProxy.ENUMS.KUAFU_XIULIAN,[this.wenhao])};e.prototype._onYeqianRender=function(t,e){if(e==this.fanye.selectedIndex){t.skin="res/static/dujiefuben/btn_create_fanye01.png"}else{t.skin="res/static/dujiefuben/btn_create_fanye02.png"}};e.prototype.onReport=function(){this._model.selfAskReport=true;app.ProtocolRequest.CrossSecSoulBattleRecordReq();app.ViewManager.toggleDialog(l.KuafuXiulianReportView,1,0);this._model.boRecordRed=false;game.RedDotView.removeFrom(this.zhanbaobtn)};e.prototype.onSelect=function(){this.callLater(this.laterFillPanel)};e.prototype.reAskInfo=function(){this.panel.setData(this.lrMediator.selectData);this.fillPanel()};e.prototype.onDisplay=function(){this._model.on(l.KuafuXiulianModel.INFO_RESET,this,this.refreshAll);this._model.on(l.KuafuXiulianModel.RE_ASK,this,this.reAskInfo);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){Laya.timer.clearAll(this);this._model.off(l.KuafuXiulianModel.INFO_RESET,this,this.refreshAll);this._model.off(l.KuafuXiulianModel.RE_ASK,this,this.reAskInfo);var t=game.SystemSetModel.getInstance().settingData.data;var e=game.Context.getServerTime()-game.Context.getServerZeroTime();if(!t[game.SettingType.kfxlEnterRed]&&e>=this._model.startTime&&e<=this._model.endTime){game.SystemSetModel.getInstance().setValueByType(1,game.SettingType.kfxlEnterRed);this._model.updataRedDot()}};e.prototype.refreshAll=function(){var t=0;for(var e=0,i=game.Context.roleList.length;e<i;e++){var n=role.RoleVO.getXiulianId(game.Context.roleList[e].soulStar);if(n>t){t=n}}var a=0;var o=csv.YuanshenProxy.getIns().getAllKfArr();var s=0;if(this._model.battleId){var r=csv.YuanshenProxy.getIns().getKfCfgMapItem(this._model.battleId);s=r.type;this._model.battleId=0}else if(this._model.currId){var r=csv.YuanshenProxy.getIns().getKfCfgMapItem(this._model.currId);s=r.type}for(var e=0,i=o.length;e<i;e++){var r=o[e];if(s){if(s==r.id){a=e;break}continue}if(t>=r.realm){a=e}}this.lrMediator.array=o;this.lrMediator.index=a;if(this._model.isBattleEnd){app.ViewManager.toggleDialog(l.KuafuXiulianRoleDefinedView,1,0);this._model.isBattleEnd=0}if(this._model.boRecordRed){game.RedDotView.addTo(this.zhanbaobtn)}else{game.RedDotView.removeFrom(this.zhanbaobtn)}this.callLater(this.laterFillPanel)};e.prototype.laterFillPanel=function(){this.callLater(this.fillPanel)};e.prototype.fillPanel=function(){this.showData=this.lrMediator.selectData;this.fanye.selectedIndex=this.fanye.array.indexOf(this.showData);this.xiulianchangname.text=app.getLang(this.showData.scenename);this.lab1.text=app.getLang("kfxiulian_1_12",this.showData.quality3);this.lab2.text=app.getLang("kfxiulian_1_13",this.showData.quality2);this.lab3.text=app.getLang("kfxiulian_1_14",this.showData.quality1);var t=0;if(this._model.start_time){t=game.Context.getServerTime()-this._model.start_time}var e=game.Config.getIntParams(1257)-this._model.weekly_total-t;if(e<0){e=0}this._leastTime=e;if(e>0){this.loopProtectTime();if(this._model.start_time){Laya.timer.loop(1e3,this,this.loopProtectTime)}else{Laya.timer.clear(this,this.loopProtectTime)}}else{this.daojishi.text=app.getLang("kfxiulian_1_5")}var i=this.panel.ty;if(i){var n=this.ditu.height/2-100;i-=n}if(i>this.panel.height-this.ditu.height){i=this.panel.height-this.ditu.height}else if(i<0){i=0}this.ditu.vScrollBar.value=i};e.prototype.loopProtectTime=function(){if(this._leastTime>=0){this.daojishi.text=app.getLang("kfxiulian_1_2",util.TimeUtil.formatTime(this._leastTime))}else{Laya.timer.clear(this,this.loopProtectTime)}this._leastTime--};e.SINGLE_KEY="yuanshencode.KuafuXiulianView";return e}(ui.kuafuxiulian.kuafuxiulianviewUI);l.KuafuXiulianView=t;var i=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t.itemArr=[];t.imgBg=new Laya.Image;t.width=648;t.imgBg.x=t.width/2;t.imgBg.y=0;t.imgBg.pivot(201,0);t.imgBg.scale(2,2);t.addChild(t.imgBg);t._model=l.KuafuXiulianModel.getIns();return t}t.prototype.setData=function(t){while(this.itemArr.length){var e=this.itemArr.shift();e.removeSelf();Laya.Pool.recover(p.SINGLE_KEY,e)}var i=csv.YuanshenProxy.getIns().getKfTypeArr(t.id);var n=0;var a=[];this.ty=0;for(var o=0,s=i.length;o<s;o++){var r=i[o];var e=Laya.Pool.getItemByClass(p.SINGLE_KEY,p);e.x=r.sitex;e.y=r.sitey;e.setData(r);this.addChild(e);this.itemArr.push(e);var l=e.y+e.height;if(n<l){n=l}a.push(r.id);if(this._model.currId==r.id){this.ty=e.y}}var h=game.Context.getServerTime()-game.Context.getServerZeroTime();if(h>=this._model.startTime&&h<=this._model.endTime){app.ProtocolRequest.CrossSecSoulSecenesReq(a)}this.height=n+50;this.imgBg.skin="res/static/guajiditu/"+t.res+".jpg"};t.prototype.leftMove=function(){};t.prototype.rightMove=function(){};return t}(Laya.Box);l.KuafuXiulianPanel=i;var p=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.on(Laya.Event.CLICK,this,this.onClick);this._model=l.KuafuXiulianModel.getIns();this.ani1.on(Laya.Event.COMPLETE,this,this.onAniEnd)};e.prototype.onClick=function(){var t=game.Context.getServerTime()-game.Context.getServerZeroTime();if(t>=this._model.startTime&&t<=this._model.endTime){var e=0;for(var i=0,n=game.Context.roleList.length;i<n;i++){var a=role.RoleVO.getXiulianId(game.Context.roleList[i].soulStar);if(a>e){e=a}}if(this._data.realm>e){var o=csv.YuanshenProxy.getIns().getXiulianCfgItem(this._data.realm).bigrealm;manager.FlowManager.instance.flowByStyle1(app.getLang("kfxiulian_1_4",l.YuanshenModel.getIns().getBigRealm(o)));return}var s=0;if(this._model.start_time){s=game.Context.getServerTime()-this._model.start_time}var r=game.Config.getIntParams(1257)-this._model.weekly_total-s;if(r<=0){manager.FlowManager.instance.flowByStyle1(app.getLang("kfxiulian_1_5"));return}if(this._leastTime>=0){manager.FlowManager.instance.flowByStyle1(app.getLang("kfxiulian_1_7"));return}if(this.state!=1&&this._model.start_time){game.Alert.show(app.getLang("kfxiulian_2_2"),Laya.Handler.create(this,this.onOk),new Laya.Handler)}else{this.onOk()}}else{manager.FlowManager.instance.flowByStyle1(app.getLang("kfxiulian_1_3",util.TimeUtil.formatTime(this._model.startTime,false,false),util.TimeUtil.formatTime(this._model.endTime,false,false)))}};e.prototype.onOk=function(){if(this.state==0){app.ViewManager.toggleDialog(l.KuafuXiulianMonTip,1,0,this._data)}else if(this.state==2){app.ViewManager.toggleDialog(l.KuafuXiulianRoleTip,1,0,this._data)}else{var t=l.YuanshenModel.getIns().getDongfuNetItemData(6);app.ViewManager.toggleDialog(l.YuanshenXiuLianView,1,0,t)}};e.prototype.onDisplay=function(){this.shuzi.visible=false;this._model.on(l.KuafuXiulianModel.INFO_REFERSH,this,this.refreshAll);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){this.ani1.stop();Laya.timer.clearAll(this);this._model.off(l.KuafuXiulianModel.INFO_REFERSH,this,this.refreshAll);l.YuanshenModel.getIns().off(l.YuanshenModel.UPDATE_YUANSHEN_DATA,this,this.updata)};e.prototype.refreshAll=function(){if(this._data){this.setData(this._data)}};e.prototype.setData=function(t){l.YuanshenModel.getIns().off(l.YuanshenModel.UPDATE_YUANSHEN_DATA,this,this.updata);this._data=t;this.jueseming.color=game.STYLES.KFXL_QUA[this._data.quality];this.dongfuimg.skin="res/static/kuafuxiulian/bg_kfxl_df_"+t.quality+".png";var e=this._model.getXiulianInfoById(t.id);game.RedDotView.removeFrom(this.redpoint);if(!e||Uint64.equal(e.uid,Uint64.ZERO)){this.state=0;var i=csv.BossProxy.getIns().getMonsterId(t.monstersetbase);var n=csv.MonsterProxy.getIns().getCfg(i);this.touxiangimg.skin=csv.MonsterProxy.getMonsterHeadUrl(n);this.jueseming.text=app.getLang(n.monname);this.touxiangkuang.skin="";this.dengjishuzhi.text=n.monlevel.toString();this.daojishi.visible=false;Laya.timer.clear(this,this.loopFreshTime)}else{this.jueseming.text=game.Context.getSerName(e.cursvrid)+e.uname;this.touxiangimg.skin=csv.MyTeamProxy.getIns().getTeamIcon(e.simpleteamavatar);this.touxiangkuang.skin=csv.HeadFrameProxy.getIns().getIcon(e.headframeId);this.dengjishuzhi.text=e.team_level.toString();if(Uint64.equal(e.uid,game.Context.mainRoleId)){this.state=1;this.daojishi.visible=true;Laya.timer.clear(this,this.loopFreshTime);var a=l.YuanshenModel.getIns().getDongfuNetItemData(6);if(Uint64.equal(a.combatid,Uint64.ZERO)){this.daojishi.text=app.getLang("kfxiulian_1_16")}else{this.daojishi.text=app.getLang("kfxiulian_1_8")}l.YuanshenModel.getIns().on(l.YuanshenModel.UPDATE_YUANSHEN_DATA,this,this.updata);if(l.YuanshenModel.getIns().getKuafuRed()){game.RedDotView.addTo(this.redpoint)}}else{this.state=2;this._leastTime=e.protection-game.Context.getServerTime();this.loopFreshTime();Laya.timer.loop(1e3,this,this.loopFreshTime)}}this.woimg.visible=this.state==1};e.prototype.loopFreshTime=function(){if(this._leastTime>=0){this.daojishi.visible=true;this.daojishi.text=app.getLang("kfxiulian_1_15",util.TimeUtil.formatTime(this._leastTime,false))}else{this.daojishi.visible=false;Laya.timer.clear(this,this.loopFreshTime)}this._leastTime--};e.prototype.updata=function(){var t=l.YuanshenModel.getIns();var e=l.YuanshenModel.getIns().getDongfuNetItemData(6);var i=t.getXiuLianNetItemData(e.combatid);if(i){var n=Uint64.toNumber(i.exp);if(this.lastExp&&n>this.lastExp){var a=n-this.lastExp;this.shuzi.text=app.getLang("kfxiulian_1_9",a);this.shuzi.visible=true;this.ani1.play(0,false)}this.lastExp=Uint64.toNumber(i.exp)}};e.prototype.onAniEnd=function(){this.shuzi.visible=false;this.ani1.stop()};e.SINGLE_KEY="yuanshencode.KuafuXiulianItem";return e}(ui.kuafuxiulian.kuafuxiulianitemUI);l.KuafuXiulianItem=p})(yuanshencode||(yuanshencode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yuanshencode;(function(n){var t=function(t){__extends(o,t);function o(){return t!==null&&t.apply(this,arguments)||this}o.getIns=function(){return app.Singleton.getInstance(o)};o.prototype.init=function(){this._xiulianInfo={};this.battleProfs=[];this.definedProfs=[];this.battleRecords=[];this.isBattleEnd=0;var t=app.str2Array(game.Config.getParams(1256),";");this.startTime=parseInt(t[0]);this.endTime=parseInt(t[1]);var e=this.startTime-(game.Context.getServerTime()-game.Context.getServerZeroTime());if(e>0){Laya.timer.once(e*1e3,this,this.openAsk)}e=this.endTime-(game.Context.getServerTime()-game.Context.getServerZeroTime());if(e>0){Laya.timer.once(e*1e3,this,this.clearAllInfo)}};o.prototype.openAsk=function(){this.updataRedDot();this.event(o.RE_ASK)};o.prototype.clearAllInfo=function(){if(this.start_time){this.weekly_total+=game.Context.getServerTime()-this.start_time}this.start_time=0;this.currId=0;this._xiulianInfo={};this.event(o.RE_ASK)};o.prototype.clearKuaTian=function(){var t=this.startTime-(game.Context.getServerTime()-game.Context.getServerZeroTime());if(t>0){Laya.timer.once(t*1e3,this,this.updataRedDot)}};o.prototype.updataRedDot=function(){var t=game.SystemSetModel.getInstance().settingData.data;var e=game.Context.getServerTime()-game.Context.getServerZeroTime();if(e<this.startTime||e>this.endTime){game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.KUAFU_XIULIAN);return}if(!t[game.SettingType.kfxlEnterRed]){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.KUAFU_XIULIAN);return}if(this.boRecordRed){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.KUAFU_XIULIAN);return}if(!this.start_time){var i=game.Config.getIntParams(1257)-this.weekly_total;if(i>0){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.KUAFU_XIULIAN);return}}else if(n.YuanshenModel.getIns().getKuafuRed()){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.KUAFU_XIULIAN);return}game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.KUAFU_XIULIAN)};o.prototype.setXiulianInfo=function(t){console.log(t);if(this.checkId){var e=this.getXiulianInfoById(this.checkId);if(!e){manager.FlowManager.instance.flowByStyle1("没有服务器数据");return}if(Uint64.equal(e.uid,t[0].uid)){app.ProtocolRequest.CrossSecSoulChallengeReq(this.checkId,this.battleProfs);this.battleId=this.checkId}else{game.Alert.show(app.getLang("kfxiulian_1_17"),Laya.Handler.create(this,this.reAskInfo))}this.checkId=null}for(var i=0,n=t.length;i<n;i++){var a=t[i];this._xiulianInfo[a.cfg_id]=a}this.event(o.INFO_REFERSH)};o.prototype.getXiulianInfoById=function(t){return this._xiulianInfo[t]};o.prototype.reAskInfo=function(){this.event(o.RE_ASK)};o.prototype.checkXiulianInfo=function(t){this.checkId=t;app.ProtocolRequest.CrossSecSoulSecenesReq([t])};o.prototype.updataSelf=function(){if(this.currId){app.ProtocolRequest.CrossSecSoulSecenesReq([this.currId])}};o.INFO_RESET="info_reset";o.RE_ASK="res_ask";o.INFO_REFERSH="info_refresh";o.REPORT_REFRESH="report_refresh";return o}(app.ModelBase);n.KuafuXiulianModel=t})(yuanshencode||(yuanshencode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yuanshencode;(function(h){var t=function(e){__extends(g,e);function g(){var t=e!==null&&e.apply(this,arguments)||this;t.isNeedOpenDongfu=true;t.timeStamp=0;t.tupoFlag=false;t.clientIsCanSelRole=true;t.sortArrLen=0;return t}g.getIns=function(){return app.Singleton.getInstance(g)};g.prototype.init=function(){this.dongfuCfgArr=csv.YuanshenProxy.getIns().getHoleCfgArr();this.clientXiancaoArr=this.getXianCaoArr();g.MAX_DONG_FU_NUM=csv.YuanshenProxy.getIns().getHoleCfgArr().length;var t=csv.YuanshenProxy.getIns().getXiulianCfgArr();g.MAX_BIG_REALM=t[t.length-1].bigrealm;g.MAX_SAMLL_REALM=3;g.MAX_CHONG_NUM=t[t.length-1].section;g.YANG_CHEN_MAX_LV=this._getYangchenMax()};g.prototype.initWaShuxingMap=function(){this.waShuxingMap={};for(var t=1;t<=7;t++){this.waShuxingMap[t]={};for(var e=0;e<g.PROP_SORT_ARRAY.length;e++){var i=g.PROP_SORT_ARRAY[e];this.waShuxingMap[t][i]=0}}};g.prototype.getWaPropMap=function(t){return this.waShuxingMap[t]};g.prototype.setWaPropMap=function(t,e,i){if(this.waShuxingMap[t][e]==0){this.waShuxingMap[t][e]=i}else{this.waShuxingMap[t][e]+=i}};g.prototype.getXiuLianTimeData=function(t){for(var e=0;e<this.timedata.length;e++){if(Uint64.equal(t,this.timedata[e].combatid)){return this.timedata[e]}}return null};g.prototype._getYangchenMax=function(){var t=csv.YuanshenProxy.getIns().get_yangchenlvCfgArr();var e=-1;for(var i=0;i<t.length;i++){if(t[i].treasureid==1){e++}else{break}}return e};g.prototype.getDongfuNetItemData=function(t){var e;if(this.dongfuNetArr){e=this.dongfuNetArr[t-1]}return e};g.prototype.getDongFuOpenIndex=function(t,e){if(e===void 0){e=0}var i=[];var n=this.getDongfuNetItemDataOpenArr();var a=g.YUANSHEN_ROLE_SORT;for(var o=0;o<a.length;o++){for(var s=0;s<n.length;s++){if(n[s].id==a[o]){i.push(n[s]);break}}}var r=0;for(var o=0;o<i.length;o++){if(i[o].id==t){r=o;break}}this.sortArrLen=i.length;var l=r+e;return l};g.prototype.getDongfuNetItemOpenData=function(t,e){var i=[];var n=this.getDongfuNetItemDataOpenArr();var a=g.YUANSHEN_ROLE_SORT;for(var o=0;o<a.length;o++){for(var s=0;s<n.length;s++){if(n[s].id==a[o]){i.push(n[s]);break}}}var r=0;for(var o=0;o<i.length;o++){if(i[o].id==t){r=o;break}}var l=r+e;if(l<=0){l=0}else if(l>=h.YuanshenModel.MAX_DONG_FU_NUM){l=h.YuanshenModel.MAX_DONG_FU_NUM}return i[l]};g.prototype.getDongfuNetItemDataOpenArr=function(){var t=[];for(var e=0;e<this.dongfuNetArr.length;e++){if(this.dongfuNetArr[e].lock==1&&this.dongfuNetArr[e].id!=6){t.push(this.dongfuNetArr[e])}}return t};g.prototype.getXiuLianNetItemData=function(t){for(var e=0;e<this.secsouldata.length;e++){if(Uint64.equal(t,this.secsouldata[e].combatid)){return this.secsouldata[e]}}return null};g.prototype.getXiuLianNetYaoItemData=function(t){for(var e=0;e<this.elixirdata.length;e++){if(Uint64.equal(t,this.elixirdata[e].combatid)){return this.elixirdata[e]}}};g.prototype.getXiuLianAllNetYaoItemData=function(){var t=0;for(var e=0;e<this.elixirdata.length;e++){t+=this.elixirdata[e].grass}return t};g.prototype.getSelectYaoData=function(t,e){for(var i=0;i<t.length;i++){if(t[i].itemID==e){return t[i]}}return null};g.prototype.getChiyaoDongtaiArr=function(t){var e=[];var i=csv.YuanshenProxy.getIns().get_chiyaoCfgMap(t).number;var n=i.split(";");n.map(function(t){e.push({num:+t.split("-")[1],percent:+t.split("-")[0]})});return e};g.prototype.getMaxChong=function(t,e){var i=0;var n=csv.YuanshenProxy.getIns().get_xiulianCustomCfgMap2(t,e);for(var a in n){i++}return i};g.prototype.getWaRoleVo=function(t){for(var e=0;e<game.Context.roleList.length;e++){if(Uint64.equal(game.Context.roleList[e].insId,t.combatid)){return game.Context.roleList[e]}}};g.prototype.checkAttr=function(t){var e=[];var i=t.split(";");for(var n=0;n<i.length;n++){var a=i[n].split("-");var o=a[0];a.shift();var s=a.join("-");e.push({type:o,attr:s})}return e};g.prototype.getXianCaoArr=function(){var t=[];var e=csv.ItemProxy.getIns().arr;for(var i=0;i<e.length;i++){if(e[i].type==h.YuanshenModel.XIAN_CAO_TYPE&&e[i].subtype==h.YuanshenModel.XIAN_CAO_SUBTYPE){t.push(e[i])}}return t};g.prototype.getXianYaoArr=function(){var t=[];var e=csv.ItemProxy.getIns().arr;for(var i=0;i<e.length;i++){if(e[i].type==h.YuanshenModel.XIAN_CAO_TYPE&&(e[i].subtype==h.YuanshenModel.XIAN_YAO_SUBTYPE||e[i].subtype==h.YuanshenModel.XIAN_YAO_SUBTYPE2)){t.push(e[i])}}return t};g.prototype.getDujieArr=function(){var t=[];var e=csv.ItemProxy.getIns().arr;for(var i=0;i<e.length;i++){if(e[i].type==h.YuanshenModel.XIAN_CAO_TYPE&&e[i].subtype==h.YuanshenModel.DU_JIE_SUBTYPE){t.push(e[i])}}return t};g.prototype.getYangchenArr=function(t){var e=[];var i=csv.YuanshenProxy.getIns().get_yangchenCfgArr();for(var n=0;n<i.length;n++){if(i[n].holeid==t){e.push(i[n])}}return e};g.prototype.isOpenYangchen=function(t,e){if(!t||t.length==0){return null}for(var i=0;i<t.length;i++){if(t[i].treasureid==e){return t[i]}}return null};g.prototype.getFuyuanEventDataItem=function(t){if(!this.eventdata){return null}for(var e=0;e<this.eventdata.length;e++){if(this.eventdata[e].dfid==t){return this.eventdata[e]}}return null};g.prototype.getFuyuanEventDataItemSp=function(){if(!this.eventdata){return null}for(var t=0;t<this.eventdata.length;t++){if(this.eventdata[t].dfid==0){return this.eventdata[t]}}return null};g.prototype.checkEventType=function(t,e){var i=t.eventtype;if(i==1){app.ViewManager.toggleDialog(h.Yuanshen2YangchenPushView,1,0,[t,e])}else{this.oldEventdata=this.eventdata;app.ProtocolRequest.SecSoulEventReq(e.id,0)}};g.prototype.checkEventResult=function(t){var e=t;var i=this.oldEventdata;var n=null;for(var a=0;a<i.length;a++){if(e==i[a].id){n=i[a];break}}if(n){var o=csv.YuanshenProxy.getIns().get_shijianCfgMap(n.blessid);if(o.eventtype==1||o.eventtype==2){app.ViewManager.toggleDialog(h.YuanshenEventResultView,1,0,o.rewards)}else if(o.eventtype==3){var s=Attributes.decode(o.rewards).baseList[0];var r=Attributes.getPropName(s.propId);var l="+"+Attributes.getPropValue(s.propId,s.value,s.formula);manager.FlowManager.instance.flowByStyle1(r+l)}}};g.prototype.xiancaoBtnRed=function(t,e){if(t===void 0){t=this.clientDongfuVo}var i=[];var n=this.getXiuLianNetItemData(e?e:this.clientDongfuVo.combatid);if(n){var a=csv.YuanshenProxy.getIns().get_xiulianCustomCfgMap3(n.realm1,n.realm2,n.realm3);var o=this.getXiuLianNetItemData(t.combatid);for(var s=0;s<this.clientXiancaoArr.length;s++){if(o.realm1>=this.clientXiancaoArr[s].p4&&game.GridsModel.getIns().hasEnoughItems(this.clientXiancaoArr[s].id+"-"+1)){i.push(this.clientXiancaoArr[s])}}if(a.xlexp==0){return false}if(Uint64.toNumber(n.exp)>=a.xlexp*50){return false}if(i.length>0){return true}else{return false}}return false};g.prototype.tiancaiBtnRed=function(t){if(t===void 0){t=this.clientDongfuVo}var e=this.getYangchenArr(t.id)[0];var i=this.isOpenYangchen(t.treasure,e.id);var n;if(i){n=csv.YuanshenProxy.getIns().get_yangchenlvCfgMap(e.id,i.treasurelv);if(i.treasurelv>=h.YuanshenModel.YANG_CHEN_MAX_LV){return false}else{return true}}else{n=csv.YuanshenProxy.getIns().get_yangchenlvCfgMap(e.id,0)}if(game.GridsModel.getIns().hasEnoughItems(n.cost)){return true}else{return false}};g.prototype.getKuafuRed=function(t){if(t===void 0){t=6}if(!this.dongfuNetArr){return false}var e=this.getDongfuNetItemData(t);if(e.lock==1){if(e.combatid.getLow()==0&&e.combatid.getHigh()==0){return true}}if(e.combatid.getLow()!=0&&e.combatid.getHigh()!=0){var i=this.getXiuLianNetItemData(e.combatid);var n=this.getDongfuNetItemData(t);if(i.ltime&&i.ltime>game.Context.getServerTime()){}else{var a=csv.YuanshenProxy.getIns().get_xiulianCustomCfgMap3(i.realm1,i.realm2,i.realm3);if(i.type==1){if(Uint64.toNumber(i.exp)>=a.xlexp){if(game.Context.roleList[this.getWaRoleVo(e).prof-1].level>=a.rolelevel){return true}}}else{return true}}if(this.xiancaoBtnRed(n,e.combatid)){return true}var o=g.getIns().getXianYaoArr();for(var s=0;s<o.length;s++){if(g.getIns().fuyaoItemRed(o[s],e.combatid)){return true}}}else{return false}};g.prototype.dongfuRed=function(t,e){if(e===void 0){e=1}var i=false;if(!this.dongfuNetArr){return false}var n=this.getDongfuNetItemData(t);if(n.lock==1){if(n.combatid.getLow()==0&&n.combatid.getHigh()==0){game.ClosureManager.addXin(csv.FunctionsProxy.ENUMS.YUANSHEN_DONGFU,4);return true}}if(n.combatid.getLow()!=0&&n.combatid.getHigh()!=0){var a=this.getXiuLianNetItemData(n.combatid);var o=this.getDongfuNetItemData(t);if(e==1){if(a.ltime&&a.ltime>game.Context.getServerTime()){}else{var s=csv.YuanshenProxy.getIns().get_xiulianCustomCfgMap3(a.realm1,a.realm2,a.realm3);if(a.type==1){if(Uint64.toNumber(a.exp)>=s.xlexp){if(game.Context.roleList[this.getWaRoleVo(n).prof-1].level>=s.rolelevel){return true}}}else{return true}}}else if(e==2){var r=this.getWaRoleVo(o);var s=csv.YuanshenProxy.getIns().get_xiulianCustomCfgMap3(a.realm1,a.realm2,a.realm3);if(s.rolelevel!=0){if(r.level<s.rolelevel){return true}}if(a.ltime&&a.ltime>game.Context.getServerTime()){return true}var l=Uint64.toNumber(a.exp);if(+s.xlexp*50==l||a.realm1==g.MAX_BIG_REALM&&a.realm2==3&&a.realm3==g.MAX_CHONG_NUM){return true}if(a.ltime&&a.ltime>game.Context.getServerTime()){}else{var h=csv.YuanshenProxy.getIns().get_xiulianCustomCfgMap3(a.realm1,a.realm2,a.realm3);if(a.type==1){if(Uint64.toNumber(a.exp)>=h.xlexp){if(game.Context.roleList[this.getWaRoleVo(n).prof-1].level>=h.rolelevel){return true}}}else{return true}}}if(this.eventdata&&this.eventdata.length>0){for(var p=0;p<this.eventdata.length;p++){if(this.eventdata[p].status!=1){return true}}}if(this.xiancaoBtnRed(o,n.combatid)){return true}var u=g.getIns().getXianYaoArr();for(var c=0;c<u.length;c++){if(g.getIns().fuyaoItemRed(u[c],n.combatid)){return true}}if(fabaonew.FaBaoNewModel.getIns().fabaoYuanshenRedDot(t)){return true}}else{return false}};g.prototype.fuyaoRed=function(){var t=this.getXianYaoArr();for(var e=0;e<t.length;e++){if(this.fuyaoItemRed(t[e])){return true}}return false};g.prototype.fuyaoFuidRed=function(){if(!csv.FunctionsProxy.getIns().isOpen(csv.FunctionsProxy.ENUMS.YUANSHEN_DONGFU)){return}var t=false;var e=-1;var i=game.SystemSetModel.getInstance().settingData.data;var n=i[game.SettingType.yuanshenXiulian].toString();game.ClosureManager.removeXin(csv.FunctionsProxy.ENUMS.YUANSHEN_DONGFU,4);for(var a=1,o=6;a<o;++a){if(this.dongfuRed(a,2)){t=true;if(n[a-1]=="2"){e=a;break}}}var s=[1,5,2,3,4];var r=0;for(var l=0;l<s.length;l++){if(e==s[l]){r=l}}if(t){game.ClosureManager.removeXin(csv.FunctionsProxy.ENUMS.YUANSHEN_DONGFU);if(e!=-1){for(var a=0,o=n.length;a<o;a++){if(r==a&&n[a]=="2"){game.ClosureManager.addXin(csv.FunctionsProxy.ENUMS.YUANSHEN_DONGFU);break}}}game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.YUANSHEN_DONGFU)}else{game.ClosureManager.removeXin(csv.FunctionsProxy.ENUMS.YUANSHEN_DONGFU);game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.YUANSHEN_DONGFU)}h.KuafuXiulianModel.getIns().updataRedDot()};g.prototype.fuyaoItemRed=function(t,e){var i=this.getXiuLianNetItemData(e?e:this.clientDongfuVo.combatid);var n=this.getXiuLianNetYaoItemData(e?e:this.clientDongfuVo.combatid);if(i){var a=csv.YuanshenProxy.getIns().get_xiulianCustomCfgMap3(i.realm1,i.realm2,i.realm3);if(t.p3==1){if(i.realm1>=+t.p4&&game.GridsModel.getIns().getItemCount(t.id)>0){}else{return false}if(a.xlexp==0){return false}if(Uint64.toNumber(i.exp)>=a.xlexp*50){return false}if(n&&n.elixir.length!=0&&this.getSelectYaoData(n.elixir,t.id)){var o=this.getChiyaoDongtaiArr(t.id);var s=this.getSelectYaoData(n.elixir,t.id);var r=h.YuanshenChiYaoView.getInstance()._getGailv(o,s.value);if(r.percent==0){return false}}return true}else{if(i.realm1>=+t.p1&&game.GridsModel.getIns().getItemCount(t.id)>0){if(n&&n.elixir.length!=0&&this.getSelectYaoData(n.elixir,t.id)){var s=this.getSelectYaoData(n.elixir,t.id);if(s.value>=t.p2){return false}}return true}else{return false}}}return false};g.prototype.tupoBtnRed=function(){var t=this.getXiuLianNetItemData(this.clientDongfuVo.combatid);var e=csv.YuanshenProxy.getIns().get_xiulianCustomCfgMap3(t.realm1,t.realm2,t.realm3);var i=e.break.split(";");for(var n=0;n<i.length;n++){var a=game.ItemUtil.parserList(i[n])[0];if(a){var o=game.GridsModel.getIns().getItemCount(a.getItemId());if(o>0){return true}}}return false};g.prototype.getYuanshenAllLv=function(){var t=0;for(var e=0;e<game.Context.roleList.length;e++){var i=this.getXiuLianNetItemData(game.Context.roleList[e].insId);if(i){var n=csv.YuanshenProxy.getIns().get_xiulianCustomCfgMap3(i.realm1,i.realm2,i.realm3);t+=n.id}}return t};g.prototype.getYuanshenLvLowWa=function(){var t;var e=-1;for(var i=0;i<game.Context.roleList.length;i++){var n=this.getXiuLianNetItemData(game.Context.roleList[i].insId);if(n){var a=csv.YuanshenProxy.getIns().get_xiulianCustomCfgMap3(n.realm1,n.realm2,n.realm3);if(e==-1){e=a.id;t=game.Context.roleList[i].getName()}else{if(a.id<e){e=a.id;t=game.Context.roleList[i].getName()}}}else{return game.Context.roleList[i].getName()}}return t};g.prototype.getYuanshenmMaxLvWa=function(){var t=-1;var e=null;for(var i=0;i<game.Context.roleList.length;i++){var n=this.getXiuLianNetItemData(game.Context.roleList[i].insId);if(n){var a=csv.YuanshenProxy.getIns().get_xiulianCustomCfgMap3(n.realm1,n.realm2,n.realm3);if(t==-1){t=a.id;e=a}else{if(a.id>t){t=a.id;e=a}}}}return e};g.prototype.getBigRealm=function(t){var e=app.getLang("mijingjiesuo_lv0");switch(t){case 1:e="炼气";break;case 2:e="筑基";break;case 3:e="结丹";break;case 4:e="元婴";break;case 5:e="化神";break;case 6:e="洞玄";break;case 7:e="炼虚";break;case 8:e="合体";break;case 9:e="大乘";break;case 10:e="渡劫";break}return e};g.prototype.getSamllRealm=function(t){var e="前期";switch(t){case 1:e="前期";break;case 2:e="中期";break;case 3:e="后期";break}return e};g.prototype.getChineseNum=function(t){var e="一";switch(t){case 0:e="零";break;case 1:e="一";break;case 2:e="二";break;case 3:e="三";break;case 4:e="四";break;case 5:e="五";break;case 6:e="六";break;case 7:e="七";break;case 8:e="八";break;case 9:e="九";break;case 10:e="十";break;case 11:e="十一";break;case 12:e="十二";break;case 13:e="十三";break;case 14:e="十四";break;case 15:e="十五";break;case 16:e="十六";break;case 17:e="十七";break;case 18:e="十八";break;case 19:e="十九";break;case 20:e="二十";break}return e};g.EXP_UPDATA_CD=1;g.SINGLE_KEY="yuanshencode.YuanshenModel";g.UPDATE_YUANSHEN_DATA="UPDATE_YUANSHEN_DATA";g.ROLE_TUPO="ROLE_TUPO";g.ROLE_TUPO_STATE_RETURN="ROLE_TUPO_STATE_RETURN";g.DU_LEI_JIE_DAMAGE="DU_LEI_JIE_DAMAGE";g.DU_LEI_JIE_HUDUN="DU_LEI_JIE_HUDUN";g.YANG_CHEN_LV_RO_JIHUO="YANG_CHEN_LV_RO_JIHUO";g.FU_YUAN_EVENT="FU_YUAN_EVENT";g.UPDATE_YUANSHEN_FLOW="UPDATE_YUANSHEN_FLOW";g.YUANSHEN_ADDVIEW_DATA="YUANSHEN_ADDVIEW_DATA";g.XIAN_CAO_TYPE=22;g.XIAN_CAO_SUBTYPE=1;g.XIAN_YAO_SUBTYPE=2;g.XIAN_YAO_SUBTYPE2=5;g.DU_JIE_SUBTYPE=4;g.YUANSHEN_ROLE_SORT=[1,5,2,3,4];g.PROP_SORT_ARRAY=[78,4,1,137,133,135,145,141,122,123,124,125,126,127,128,129,130,131];return g}(app.ModelBase);h.YuanshenModel=t})(yuanshencode||(yuanshencode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("hole.csv");this._holeCfgMap=t.getMap("id");this._holeCfgArr=t.getArray();var e=app.Config.getResById("xiulian.csv");this._xiulianCfgArr=e.getArray();this._xiulianCustomCfgMap=e.getMap("bigrealm","smallrealm","section");this._xiulianCfgMap=e.getMap("id");var i=app.Config.getResById("xiulian_attr.csv");this._xiulianAttrCfgArr=i.getArray();this._xiulianMap=i.getMap("id");this._xiulianAttrCfgMap=i.getMap("job","xiulian");var n=app.Config.getResById("xiulianmedicine.csv");this._chiyaoCfgArr=n.getArray();this._chiyaoCfgMap=n.getMap("id");var a=app.Config.getResById("leijie.csv");this._dujieCfgArr=a.getArray();this._dujieCfgMap=a.getMap("bigrealm");var o=app.Config.getResById("xiuliantujing.csv");this._xiuliantujingCfgArr=o.getArray();this._xiuliantujingCfgMap=o.getMap("id");var s=app.Config.getResById("hole_treasure.csv");this._yangchenCfgArr=s.getArray();this._yangchenCfgMap=s.getMap("id");var r=app.Config.getResById("hole_treasurelv.csv");this._yangchenlvCfgArr=r.getArray();this._yangchenlvCfgMap=r.getMap("treasureid","lv");var l=app.Config.getResById("fuyuan.csv");this._shijianCfgArr=l.getArray();this._shijianCfgMap=l.getMap("id");var h=app.Config.getResById("event.csv");this._fuyuanCfgArr=h.getArray();this._fuyuanCfgMap=h.getMap("id");var p=app.Config.getResById("kfxiulian.csv");var u=p.getArray();this._kfCfgMap={};this._kfTypeMap={};for(var c=0;c<u.length;++c){var g=u[c];this._kfCfgMap[g.id]=g;if(!this._kfTypeMap[g.type]){this._kfTypeMap[g.type]=[]}this._kfTypeMap[g.type].push(g)}p=app.Config.getResById("kfxiulianscene.csv");this._kfAllArr=p.getArray()};e.prototype.getKfCfgMapItem=function(t){return this._kfCfgMap[t]};e.prototype.getAllKfArr=function(){return this._kfAllArr};e.prototype.getKfTypeArr=function(t){return this._kfTypeMap[t]};e.prototype.getHoleCfgMapItem=function(t){return this._holeCfgMap[t]};e.prototype.getHoleCfgArr=function(){return this._holeCfgArr};e.prototype.getXiulianCfgMap=function(){return this._xiulianCfgMap};e.prototype.getXiulianCfgItem=function(t){return this._xiulianCfgMap[t]};e.prototype.getXiulianCfgArr=function(){return this._xiulianCfgArr};e.prototype.get_xiulianCustomCfgMap1=function(t){return this._xiulianCustomCfgMap[t]};e.prototype.get_xiulianCustomCfgMap2=function(t,e){return this._xiulianCustomCfgMap[t][e]};e.prototype.get_xiulianCustomCfgMap3=function(t,e,i){return this._xiulianCustomCfgMap[t][e][i]};e.prototype.getRoleItemModel=function(t){var e=this._xiulianMap[t];if(e){return e.model}return""};e.prototype.getXiulianRoleItem=function(t){var e=this._xiulianMap[t];return e};e.prototype.get_xiulianAttrWaCfgMap=function(t){return this._xiulianAttrCfgMap[t]};e.prototype.get_xiulianAttrCfgMapItem=function(t,e){return this._xiulianAttrCfgMap[t][e]};e.prototype.get_xiulianAttrCfgArr=function(){return this._xiulianAttrCfgArr};e.prototype.get_chiyaoCfgMap=function(t){return this._chiyaoCfgMap[t]};e.prototype.get_chiyaoCfgArr=function(){return this._chiyaoCfgArr};e.prototype.get_dujieCfgMap=function(t){return this._dujieCfgMap[t]};e.prototype.get_dujieCfgArr=function(){return this._dujieCfgArr};e.prototype.get_xiuliantujingCfgMap=function(t){return this._xiuliantujingCfgMap[t]};e.prototype.get_xiuliantujingCfgArr=function(){return this._xiuliantujingCfgArr};e.prototype.get_yangchenCfgMap=function(t){return this._yangchenCfgMap[t]};e.prototype.get_yangchenCfgArr=function(){return this._yangchenCfgArr};e.prototype.get_yangchenlvCfgMap=function(t,e){return this._yangchenlvCfgMap[t][e]};e.prototype.get_yangchenlvCfgArr=function(){return this._yangchenlvCfgArr};e.prototype.get_shijianCfgMap=function(t){return this._shijianCfgMap[t]};e.prototype.get_shijianCfgArr=function(){return this._shijianCfgArr};e.prototype.get_fuyuanCfgMap=function(t){return this._fuyuanCfgMap[t]};e.prototype.get_fuyuanCfgArr=function(){return this._fuyuanCfgArr};e.SINGLE_KEY="csv.YuanshenProxy";return e}(app.ModelBase);t.YuanshenProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yuanshencode;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.on(Laya.Event.CLICK,this,this.onClick);this.anchorX=this.anchorY=.5};e.prototype.init=function(t){this._index=t;this.visible=true};e.prototype.setBright=function(){this.imgjihuo.visible=true;this.imgweijihuo.visible=false};e.prototype.setDarkness=function(){this.imgjihuo.visible=false;this.imgweijihuo.visible=true};e.prototype.setAni=function(){this.animationfaguang.visible=true;this.animationfaguang.play(0,false)};e.prototype.beHide=function(){this.visible=false};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.onClick=function(t){t.stopPropagation();app.ViewManager.toggleView(i.YuanshenGouyuTipsView,i.YuanshenXiuLianView.getIns(),1,[this._index,this.x,this.y])};return e}(ui.yuanshen.xiulianitem01UI);i.JadeItem=t})(yuanshencode||(yuanshencode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yuanshencode;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=i.YuanshenModel.getIns()};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){this.imgArrow.visible=true;this.txtName.visible=true;this.txtValue.visible=true;if(t.type==1){this.txtName.text="福源值"}else{this.txtName.text="灵气值";if(t.next==0){this.imgArrow.visible=false;this.txtName.visible=false;this.txtValue.visible=false}}this.txtValue.text=t.now;this.txtNext.text=t.next};e.SINGLE_KEY="yuanshencode.Yuanshen2yangchenPropItem";return e}(ui.common.commonattr4UI);i.Yuanshen2yangchenPropItem=t})(yuanshencode||(yuanshencode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yuanshencode;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=i.YuanshenModel.getIns()};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){this.txtName.visible=true;this.txtValue.visible=true;if(t.type==1){this.txtName.text="福源值"}else{this.txtName.text="灵气值"}this.txtValue.text=t.now};e.SINGLE_KEY="yuanshencode.Yuanshen2yangchenPropMaxItem";return e}(ui.common.commonattr2UI);i.Yuanshen2yangchenPropMaxItem=t})(yuanshencode||(yuanshencode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yuanshencode;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this._model=i.YuanshenModel.getIns();this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.btntijiao.clickHandler=new Laya.Handler(this,this._submitItem);this.btnadd.visible=false};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){this._item=null};e.prototype.refreshAll=function(){this._cfg=this.dataSource[0];this._item=this.dataSource[0].p1;this._netData=this.dataSource[1];this.itemdaoju.setData(null);this._addItem()};e.prototype._addItem=function(){var t=+this._item.split("-")[0];var e=+this._item.split("-")[1];var i=game.ItemUtil.parserList(this._item)[0];this.itemdaoju.setData(i);this.labshuzi.text=game.GridsModel.getIns().getItemCount(t)+"/"+e};e.prototype._submitItem=function(){if(game.GridsModel.getIns().hasEnoughItems(this._item,false,true,false)){var t=+this._item.split("-")[0];this._model.oldEventdata=this._model.eventdata;app.ProtocolRequest.SecSoulEventReq(this._netData.id,t);app.ViewManager.toggleDialog(e,-1,0)}};e.SINGLE_KEY="yuanshencode.Yuanshen2YangchenPushView";return e}(ui.alert.yuanshentijiaotipUI);i.Yuanshen2YangchenPushView=t})(yuanshencode||(yuanshencode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yuanshencode;(function(a){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=a.YuanshenModel.getIns();this.listshuxing.itemRender=a.Yuanshen2yangchenPropItem;this.listshuxing.renderHandler=new Laya.Handler(this,this.onRenderHandler);this.listshuxingmanji.itemRender=a.Yuanshen2yangchenPropMaxItem;this.listshuxingmanji.renderHandler=new Laya.Handler(this,this.onRenderHandler2)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll);this._model.on(a.YuanshenModel.YANG_CHEN_LV_RO_JIHUO,this,this.refreshAll);this.btnshengji.on(Laya.Event.CLICK,this,this._onClickCheck)};e.prototype.onUnDisplay=function(){this.btnshengji.off(Laya.Event.CLICK,this,this._onClickCheck);this._model.off(a.YuanshenModel.YANG_CHEN_LV_RO_JIHUO,this,this.refreshAll)};e.prototype.refreshAll=function(){var t=this._cfg=this._model.getYangchenArr(this._model.clientDongfuVo.id)[0];this.imgname.skin="";var e=this._model.isOpenYangchen(this._model.clientDongfuVo.treasure,t.id);this.imgyimanji.visible=false;this.boxshengji.visible=true;this.listshuxingmanji.visible=false;this.listshuxing.visible=true;if(e){if(e.treasurelv>=a.YuanshenModel.YANG_CHEN_MAX_LV){this.listshuxingmanji.visible=true;this.listshuxing.visible=false;this.imgyimanji.visible=true;this.boxshengji.visible=false;this.listshuxing.array=this.listshuxingmanji.array=this._getProp(e)}else{var i=csv.YuanshenProxy.getIns().get_yangchenlvCfgMap(this._cfg.id,e.treasurelv);var n=game.ItemUtil.parserList(i.cost)[0];this.itemdaoju.setData(n);this.listshuxing.array=this.listshuxingmanji.array=this._getProp(e);this.btnshengji.label=app.getLang("升级")}}else{this.imgtiancaidibao.skin=t.pic+".png";var n=game.ItemUtil.parserList(t.activation)[0];this.itemdaoju.setData(n);this.btnshengji.label=app.getLang("激活");this.listshuxing.array=this.listshuxingmanji.array=this._getProp()}};e.prototype._getProp=function(t){var e;if(t){e=csv.YuanshenProxy.getIns().get_yangchenlvCfgMap(this._cfg.id,t.treasurelv);if(t.treasurelv>=a.YuanshenModel.YANG_CHEN_MAX_LV){return[{type:1,now:e.attr1,next:e.attr1},{type:2,now:e.attr2,next:e.attr2}]}else{e=csv.YuanshenProxy.getIns().get_yangchenlvCfgMap(this._cfg.id,t.treasurelv);var i=csv.YuanshenProxy.getIns().get_yangchenlvCfgMap(this._cfg.id,t.treasurelv+1);return[{type:1,now:e.attr1,next:i.attr1},{type:2,now:e.attr2,next:i.attr2}]}}else{e=csv.YuanshenProxy.getIns().get_yangchenlvCfgMap(this._cfg.id,0);return[{type:1,now:0,next:e.attr1},{type:2,now:0,next:e.attr2}]}};e.prototype.onRenderHandler=function(t,e){t.setData(t.dataSource)};e.prototype.onRenderHandler2=function(t,e){t.setData(t.dataSource)};e.prototype._onClickCheck=function(){app.ProtocolRequest.SecSoulTreasureUpReq(this._cfg.id)};e.SINGLE_KEY="yuanshencode.Yuanshen2yangchenView";return e}(ui.yuanshen.yangchengtipUI);a.Yuanshen2yangchenView=t})(yuanshencode||(yuanshencode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yuanshencode;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getInstance=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=i.YuanshenModel.getIns()};e.prototype.onDisplay=function(){this.callLater(this.updateLayout);this._model.on(i.YuanshenModel.UPDATE_YUANSHEN_DATA,this,this.updateRed);this.on(Laya.Event.CLICK,this,this.onClick)};e.prototype.onUnDisplay=function(){this._model.off(i.YuanshenModel.UPDATE_YUANSHEN_DATA,this,this.updateRed);this.off(Laya.Event.CLICK,this,this.onClick)};e.prototype.updateLayout=function(){};e.prototype.setData=function(t,e){this._index=e;this._vo=t;var i=game.ItemUtil.parserList(t.id)[0];this._item=i;this.itemdaoju.setData(i);this.btnName.text=i.itemCfg.namedispaly;this.updateRed();this.setSelect()};e.prototype.setSelectState=function(t){this.selectState=t;this.setSelect()};e.prototype.setSelect=function(){this.btnyeqian.selected=this.imgxuanzhong.visible=Boolean(this.selectState==component.SimpleGroupList.SELECTED)};e.prototype.onClick=function(){i.YuanshenChiYaoView.getInstance().updateMainView(this.dataSource)};e.prototype.setSelect2=function(t){if(this._index==t){this.selectState=1;this.btnyeqian.selected=this.imgxuanzhong.visible=true}else{this.btnyeqian.selected=this.imgxuanzhong.visible=false}};e.prototype.updateRed=function(){if(this._vo){this._model.fuyaoItemRed(this._vo)?game.RedDotView.addTo(this):game.RedDotView.removeFrom(this)}};e.SINGLE_KEY="yuanshencode.YuanshenChiYaoItem";return e}(ui.yuanshen.fuyaoitemUI);i.YuanshenChiYaoItem=t})(yuanshencode||(yuanshencode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yuanshencode;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this._model=i.YuanshenModel.getIns();this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.btnxiala.pivotX=18;this.btnxiala.pivotY=18;this.btnxiala.x=140;this.btnxiala.y=25};e.prototype.onDisplay=function(){game.GridsModel.getIns().on(game.GridsModel.EVENTS.UPDATE,this,this.setRed);this._model.on(i.YuanshenModel.UPDATE_YUANSHEN_DATA,this,this.setRed);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){game.GridsModel.getIns().off(game.GridsModel.EVENTS.UPDATE,this,this.setRed);this._model.off(i.YuanshenModel.UPDATE_YUANSHEN_DATA,this,this.setRed)};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){this._type=t;this.labelname.text=i.YuanshenModel.getIns().getBigRealm(t);this.setRed()};e.prototype.setArrow=function(t){if(t==component.SimpleGroupList.OPEN){this.btnxiala.scaleY=-1}else{this.btnxiala.scaleY=1}};e.prototype.setRed=function(){game.RedDotView.removeFrom(this);var t=this._model.getXianYaoArr();var e=[];for(var i=0;i<t.length;i++){if(t[i].p6==+this._type){e.push(t[i])}}for(var i=0;i<e.length;i++){if(this._model.fuyaoItemRed(e[i])){game.RedDotView.addTo(this);break}}};e.SINGLE_KEY="yuanshencode.YuanshenChiYaoTypeItem";return e}(ui.yuanshen.fuyaoitem01UI);i.YuanshenChiYaoTypeItem=t})(yuanshencode||(yuanshencode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yuanshencode;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getInstance=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this._model=i.YuanshenModel.getIns();this.btnyijianfuyong.clickHandler=new Laya.Handler(this,this._clickChiyao);this.btnfuyong.clickHandler=new Laya.Handler(this,this._clickChiyaoAll);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.list=new component.SimpleGroupList;this.list.groupRender=i.YuanshenChiYaoTypeItem;this.list.groupRenderHandler=new Laya.Handler(this,this.onTypeRenderHandler);this.list.itemRender=i.YuanshenChiYaoItem;this.list.itemRenderHandler=new Laya.Handler(this,this.onRenderSetData);this.list.vScrollBarSkin=" ";this.list.groupKey="p6";this.list.boOpenOne=true;this.addChild(this.list);this.list.width=165;this.list.height=705;this.list.x=65;this.list.y=92;this.btnwenhoa.x=576};e.prototype.onDisplay=function(){this.callLater(this.updateLayout);this._model.on(i.YuanshenModel.UPDATE_YUANSHEN_DATA,this,this.updateReturnView);this.btnwenhoa.on(Laya.Event.CLICK,this,this._clickTips)};e.prototype.onUnDisplay=function(){this.btnwenhoa.off(Laya.Event.CLICK,this,this._clickTips);this._model.off(i.YuanshenModel.UPDATE_YUANSHEN_DATA,this,this.updateReturnView)};e.prototype.updateLayout=function(){this._xiulianNetData=this._model.getXiuLianNetItemData(this._model.clientDongfuVo.combatid);this._xiulianYaoNetData=this._model.getXiuLianNetYaoItemData(this._model.clientDongfuVo.combatid);this.list.mouseEnabled=true;this.list.dataSource=this._model.getXianYaoArr();var t=this._xiulianNetData.realm1-2<=0?0:this._xiulianNetData.realm1-2;this.list.openByIndex(0,t);var e=this._selectItem(t+2);this.updateMainView(e)};e.prototype._selectItem=function(t){var e=this._model.getXianYaoArr();for(var i=0;i<e.length;i++){if(e[i].p6==t){return e[i]}}};e.prototype.onSelectHandler=function(t){this.updateMainView(t)};e.prototype.updateReturnView=function(){this._xiulianNetData=this._model.getXiuLianNetItemData(this._model.clientDongfuVo.combatid);this._xiulianYaoNetData=this._model.getXiuLianNetYaoItemData(this._model.clientDongfuVo.combatid);this.updateMainView(this._itemData)};e.prototype.updateMainView=function(t){var e=this._itemData=t?t:this._model.getXianYaoArr()[0];if(!e){return}var i=this._item=game.ItemUtil.parserList(e.id)[0];this._red(e);if(e.p3==1){this.btnyijianfuyong.visible=true;this.btnfuyong.visible=true;this.btnyijianfuyong.x=316;var n=this._selItemCfgArr=this._model.getChiyaoDongtaiArr(e.id);this.btnwenhoa.visible=true;this.labeltishi.visible=true;if(this._xiulianYaoNetData&&this._xiulianYaoNetData.elixir.length!=0&&this._model.getSelectYaoData(this._xiulianYaoNetData.elixir,e.id)){var a=this._model.getSelectYaoData(this._xiulianYaoNetData.elixir,e.id);this.labelname.text=e.namedispaly+"x"+game.GridsModel.getIns().getItemCount(e.id);this.itemdaoju.setData(i);this.labelmiaoshu.text=csv.ItemProxy.getItemDes(e.id);this.label01.text=this._model.getBigRealm(+e.p4);this.label02.text=app.getLang("增加{0}点修为",e.p1);this._addXiuwei=this._getGailv(n,a.value);var o=this._tempData=this._getNowNumValue(n,a.value);if(this._addXiuwei.percent==0){this.label03.text=this._addXiuwei.percent+"%   ";this.labeltishi.text=app.getLang("xiulian_shuoming_3")}else{this.label03.text=this._addXiuwei.percent+"%   "+o.use+"/"+o.now+"颗";this.labeltishi.text="再服用"+this._getXiaoGuoNum(n,a.value)+"颗，药效比例将下降"}this.label04.text=a.value+"";this.label05.text="增加"+this._getNumValue(n,a.value,e.p1)+"点修为"}else{this._addXiuwei=this._getGailv(n,1);this.labelname.text=e.namedispaly+"x"+game.GridsModel.getIns().getItemCount(e.id);this.itemdaoju.setData(i);this.labelmiaoshu.text=csv.ItemProxy.getItemDes(e.id);this.label01.text=this._model.getBigRealm(+e.p4);this.label02.text=app.getLang("增加{0}点修为",e.p1);this.label03.text=this._getGailv(n,1).percent+"%   "+"0/"+this._getGailv(n,1).num+"颗";this.label04.text=0+"";this.label05.text="增加"+0+"点修为";this.labeltishi.text="再服用"+n[0].num+"颗，药效比例将下降"}if(this._xiulianNetData){if(this._xiulianNetData.realm1>=+e.p4){this.label01.color="#567474"}else{this.label01.color=game.STYLES.RED_COLOR}}}else{this.btnyijianfuyong.visible=true;this.btnfuyong.visible=false;this.btnyijianfuyong.x=386;this.btnwenhoa.visible=false;this.labeltishi.visible=false;var s=Attributes.decode(e.p4).baseList[0];var r=Attributes.getPropName(s.propId);var l=Attributes.getPropValue(s.propId,s.value,s.formula);if(this._xiulianYaoNetData&&this._xiulianYaoNetData.elixir.length!=0&&this._model.getSelectYaoData(this._xiulianYaoNetData.elixir,e.id)){var a=this._model.getSelectYaoData(this._xiulianYaoNetData.elixir,e.id);this.labelname.text=e.namedispaly+"x"+game.GridsModel.getIns().getItemCount(e.id);this.itemdaoju.setData(i);this.labelmiaoshu.text=csv.ItemProxy.getItemDes(e.id);this.label01.text=this._model.getBigRealm(+e.p1);this.label02.text=app.getLang("增加{0}点{1}",r,l);this.label03.text=100+"%   "+a.value+"/"+e.p2;this.label04.text=a.value+"";this.label05.text="增加"+a.value*+l+"点"+r;if(this._xiulianNetData){if(this._xiulianNetData.realm1>=+e.p1){this.label01.color="#567474"}else{this.label01.color=game.STYLES.RED_COLOR}}}else{this.labelname.text=e.namedispaly+"x"+game.GridsModel.getIns().getItemCount(e.id);this.itemdaoju.setData(i);this.labelmiaoshu.text=csv.ItemProxy.getItemDes(e.id);this.label01.text=this._model.getBigRealm(+e.p1);this.label02.text=app.getLang("增加{0}点{1}",r,l);this.label03.text=100+"%   "+"0/"+e.p2;this.label04.text=0+"";this.label05.text="增加"+0+"点"+r;if(this._xiulianNetData){if(this._xiulianNetData.realm1>=+e.p1){this.label01.color="#567474"}else{this.label01.color=game.STYLES.RED_COLOR}}}}};e.prototype._getGailv=function(t,e){var i=t.length-1;if(e>=t[i].num){return t[i]}for(var n=0;n<t.length;n++){if(e<t[n].num){return t[n]}}};e.prototype._getNumValue=function(t,e,i){var n=0;var a=0;for(var o=0;o<t.length;o++){if(e>=t[o].num){n+=(t[o].num-a)*i*(t[o].percent/100);a=t[o].num}else{n+=(e-a)*i*(t[o].percent/100);break}}return n};e.prototype._getNowNumValue=function(t,e){var i=0;var n=t[t.length-1].num;for(var a=0;a<t.length;a++){if(e>=t[a].num){i=t[a].num}else{n=t[a].num-i;i=e-i;break}}return{use:i,now:n}};e.prototype._getXiaoGuoNum=function(t,e){for(var i=0;i<t.length;i++){if(e<t[i].num){return t[i].num-e}}};e.prototype._isEffectIsLow=function(t,e){for(var i=0;i<t.length;i++){if(e==t[i].num){return true}}return false};e.prototype.onRenderSetData=function(t,e){t.setData(t.dataSource,e)};e.prototype.onTypeRenderHandler=function(t,e){t.setData(t.dataSource)};e.prototype._clickChiyao=function(){if(!game.GridsModel.getIns().hasEnoughItems(this._item.getItemId()+"-"+1,false,false,true)){manager.FlowManager.instance.flowByStyle1(app.getLang("xiulian_shuoming_18"));return}if(this._xiulianNetData){if(this._itemData.p3==1){if(this._xiulianNetData.realm1<+this._itemData.p4){manager.FlowManager.instance.flowByStyle1(app.getLang("xiulian_shuoming_12"));return}}else{if(this._xiulianNetData.realm1<+this._itemData.p1){manager.FlowManager.instance.flowByStyle1(app.getLang("xiulian_shuoming_12"));return}}}var t=csv.YuanshenProxy.getIns().get_xiulianCustomCfgMap3(this._xiulianNetData.realm1,this._xiulianNetData.realm2,this._xiulianNetData.realm3);if(this._xiulianYaoNetData&&this._xiulianYaoNetData.elixir.length!=0&&this._model.getSelectYaoData(this._xiulianYaoNetData.elixir,this._itemData.id)){var e=this._model.getSelectYaoData(this._xiulianYaoNetData.elixir,this._itemData.id);if(this._itemData.p3==1){if(this._addXiuwei.percent==0){manager.FlowManager.instance.flowByStyle1(app.getLang("xiulian_shuoming_16"));return}if(t.xlexp==0){manager.FlowManager.instance.flowByStyle1(app.getLang("xiulian_shuoming_14"));return}if(Uint64.toNumber(this._xiulianNetData.exp)>=t.xlexp*50){manager.FlowManager.instance.flowByStyle1(app.getLang("xiulian_shuoming_14"));return}if(this._isEffectIsLow(this._selItemCfgArr,e.value+1)){manager.FlowManager.instance.flowByStyle1(app.getLang("xiulian_shuoming_13",this._addXiuwei.percent/100*this._itemData.p1),null,game.STYLES.GREEN_COLOR)}else{}}else{if(this._xiulianNetData.realm1<+this._itemData.p1){manager.FlowManager.instance.flowByStyle1(app.getLang("xiulian_shuoming_12"));return}if(+this._itemData.p2<=e.value){manager.FlowManager.instance.flowByStyle1(app.getLang("xiulian_shuoming_16"));return}}}else{if(this._itemData.p3==1){if(Uint64.toNumber(this._xiulianNetData.exp)>=t.xlexp*50){manager.FlowManager.instance.flowByStyle1(app.getLang("xiulian_shuoming_14"));return}}}if(this._itemData.p3==1){manager.FlowManager.instance.flowByStyle1(app.getLang("xiulian_shuoming_17",this._addXiuwei.percent/100*this._itemData.p1),null,game.STYLES.GREEN_COLOR)}else{var i=this._itemData.p4.split("-");var n=Attributes.getPropName(i[0]);manager.FlowManager.instance.flowByStyle1(app.getLang("xiulian_shuoming_20",n+"+"+i[i.length-1]),null,game.STYLES.GREEN_COLOR)}app.ProtocolRequest.SecSoulUseItemReq(this._model.clientDongfuVo.combatid,this._item.getItemId(),1)};e.prototype._clickChiyaoAll=function(){if(!game.GridsModel.getIns().hasEnoughItems(this._item.getItemId()+"-"+1,false,false,true)){manager.FlowManager.instance.flowByStyle1(app.getLang("xiulian_shuoming_18"));return}if(this._xiulianNetData){if(this._itemData.p3==1){if(this._xiulianNetData.realm1<+this._itemData.p4){manager.FlowManager.instance.flowByStyle1(app.getLang("xiulian_shuoming_12"));return}}}var t=0;var e=game.GridsModel.getIns().getItemCount(this._item.getItemId());var i=csv.YuanshenProxy.getIns().get_xiulianCustomCfgMap3(this._xiulianNetData.realm1,this._xiulianNetData.realm2,this._xiulianNetData.realm3);if(this._xiulianYaoNetData&&this._xiulianYaoNetData.elixir.length!=0&&this._model.getSelectYaoData(this._xiulianYaoNetData.elixir,this._itemData.id)){if(this._itemData.p3==1){if(this._addXiuwei.percent==0){manager.FlowManager.instance.flowByStyle1(app.getLang("xiulian_shuoming_16"));return}if(Uint64.toNumber(this._xiulianNetData.exp)>=i.xlexp*50){manager.FlowManager.instance.flowByStyle1(app.getLang("xiulian_shuoming_14"));return}var n=this._tempData.now-this._tempData.use;t=e>=n?n:e;if(e>=n){t=n;manager.FlowManager.instance.flowByStyle1(app.getLang("xiulian_shuoming_13",this._addXiuwei.percent/100*this._itemData.p1*t),null,game.STYLES.GREEN_COLOR)}else{t=e;manager.FlowManager.instance.flowByStyle1(app.getLang("xiulian_shuoming_17",this._addXiuwei.percent/100*this._itemData.p1*t),null,game.STYLES.GREEN_COLOR)}if(n==0){return}}}else{if(this._itemData.p3==1){if(Uint64.toNumber(this._xiulianNetData.exp)>=i.xlexp*50){manager.FlowManager.instance.flowByStyle1(app.getLang("xiulian_shuoming_14"));return}var n=+this._addXiuwei.num;t=e>=n?n:e;manager.FlowManager.instance.flowByStyle1(app.getLang("xiulian_shuoming_17",this._addXiuwei.percent/100*this._itemData.p1*t),null,game.STYLES.GREEN_COLOR)}}app.ProtocolRequest.SecSoulUseItemReq(this._model.clientDongfuVo.combatid,this._item.getItemId(),t)};e.prototype._red=function(t){if(this._model.fuyaoItemRed(t)){game.RedDotView.addTo(this.btnyijianfuyong);game.RedDotView.addTo(this.btnfuyong)}else{game.RedDotView.removeFrom(this.btnyijianfuyong);game.RedDotView.removeFrom(this.btnfuyong)}};e.prototype._clickTips=function(t){app.ViewManager.toggleView(role.RoleDeatilAttibuteTip,app.AppContainer.flowLayer,1,[this._getYaoStr(),t.stageX-50,t.stageY-20,200,-10,-15,-10])};e.prototype._getYaoStr=function(){var t="药效比例\n";if(this._selItemCfgArr){for(var e=0;e<this._selItemCfgArr.length;e++){t+=this._selItemCfgArr[e].percent+"%\n"}}return t};e.SINGLE_KEY="yuanshencode.YuanshenChiYaoView";return e}(ui.yuanshen.fuyaoviewUI);i.YuanshenChiYaoView=t})(yuanshencode||(yuanshencode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yuanshencode;(function(i){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.fullScreen="fullScreen";return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this._model=i.YuanshenModel.getIns();this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};t.prototype.onDisplay=function(){this.callLater(this.refreshAll);this.imgdianji01.on(Laya.Event.CLICK,this,this._useItem1);this.imgdianji03.on(Laya.Event.CLICK,this,this._useItem3);this._model.on(i.YuanshenModel.DU_LEI_JIE_DAMAGE,this,this._updateView);game.GridsModel.getIns().on(game.GridsModel.EVENTS.ITEM_UPDATE,this,this._updateItem);Laya.timer.loop(1e3,this,this.stopGuard);this.itemdaoju02.visible=false;this.labelnum02.visible=false;Laya.Dialog.manager.maskLayer.alpha=0};t.prototype.onUnDisplay=function(){this._model.off(i.YuanshenModel.DU_LEI_JIE_DAMAGE,this,this._updateView);game.GridsModel.getIns().off(game.GridsModel.EVENTS.ITEM_UPDATE,this,this._updateItem);this.imgdianji01.off(Laya.Event.CLICK,this,this._useItem1);this.imgdianji03.off(Laya.Event.CLICK,this,this._useItem3);Laya.Dialog.manager.maskLayer.alpha=.7;Laya.timer.clearAll(this)};t.prototype.refreshAll=function(){this._data=this.dataSource;this._updateItem();this._updateHp(Uint64.toNumber(this._data.hp),Uint64.toNumber(this._data.hp));this.boxleijie.visible=false;this.clipleijie.width=112;this.clipleijie.align="";this.boxtexiao.visible=false;this.shandian.alpha=0;this.clipnum.alpha=0};t.prototype.playHit=function(){var t=this;this.boxtexiao.visible=true;this.animationlei01.play(0,false);this.animationlei02.play(0,false);this.animationlei03.play(0,false);Laya.timer.once(600,this,function(){t.boxtexiao.visible=false})};t.prototype._updateView=function(t){this._resp=t;this.boxleijie.visible=true;this.clipleijie.value=this._model.getChineseNum(t.index);this.clipnum.value="-"+Uint64.toNumber(this._resp.damage);this.ani2.play(0,false);Laya.timer.once(500,this,this._playAniLei)};t.prototype._playAniLei=function(){this._updateItem();this._updateHp(Uint64.toNumber(this._data.hp),Uint64.toNumber(this._resp.hp));app.SoundManager.getIns().playSound("thunder");Laya.timer.once(200,this,this.playHit)};t.prototype._updateHp=function(t,e){this.barjindutiao.value=e/t;this.labeljindu.text=e+"/"+t};t.prototype._updateItem=function(){var t=this._itemArr=this._model.getDujieArr();this.itemdaoju01.setData(t[1].id);this.itemdaoju03.setData(t[2].id);this.labelnum01.text="x"+game.GridsModel.getIns().getItemCount(t[1].id);this.labelnum03.text="x"+game.GridsModel.getIns().getItemCount(t[2].id)};t.prototype._useItem1=function(t){t.stopPropagation();if(!game.GridsModel.getIns().hasEnoughItems(this._itemArr[1].id+"-"+1)){manager.FlowManager.instance.flowByStyle1(app.getLang("道具不足"));return}app.ProtocolRequest.SecSoulUseItemReq(this._model.clientDongfuVo.combatid,this._itemArr[1].id,1);i.YuanshenDuJieView.getIns().playGuard(3)};t.prototype._useItem3=function(t){t.stopPropagation();if(!game.GridsModel.getIns().hasEnoughItems(this._itemArr[2].id+"-"+1)){manager.FlowManager.instance.flowByStyle1(app.getLang("道具不足"));return}app.ProtocolRequest.SecSoulUseItemReq(this._model.clientDongfuVo.combatid,this._itemArr[2].id,1);i.YuanshenDuJieView.getIns().playGuard(2)};t.prototype.stopGuard=function(){if(this._model.leidunTime&&game.Context.getServerTime()>=this._model.leidunTime){i.YuanshenDuJieView.getIns().stopGuard()}};t.SINGLE_KEY="yuanshencode.YuanshenDuJieLeiView";return t}(ui.yuanshen.leijieviewUI);i.YuanshenDuJieLeiView=t})(yuanshencode||(yuanshencode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yuanshencode;(function(r){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.fullScreen="fullScreen";return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this._model=r.YuanshenModel.getIns();this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.btnnitianerxing.clickHandler=new Laya.Handler(this,this.startDujie);this.btnshaozuozhengdun.clickHandler=new Laya.Handler(this,this.closeView);this.btndaoju01.width=178;this.btndaoju02.width=178;this.btndaoju03.width=178;this.btnnitianerxing.width=255;this.btnshaozuozhengdun.width=255;this.animationxuli.play();this.animationxuli01.play();this.animationxuli02.play();this.btndaoju03.visible=false};t.prototype.onDisplay=function(){this.callLater(this.refreshAll);this.btnwenhao.on(Laya.Event.CLICK,this,this._openTips);this.btndaoju01.on(Laya.Event.CLICK,this,this._openItemTips);this.btndaoju02.on(Laya.Event.CLICK,this,this._openItemTips2)};t.prototype.onUnDisplay=function(){this.ani2.stop();this.btnwenhao.off(Laya.Event.CLICK,this,this._openTips);this.btndaoju01.off(Laya.Event.CLICK,this,this._openItemTips);this.btndaoju02.off(Laya.Event.CLICK,this,this._openItemTips2)};t.prototype.refreshAll=function(){this.setVisi(true);this.boxdaoju.visible=true;this.ani3.gotoAndStop(0);this.ani3.play(0,false);this.ani2.play(0);var t=this._model.getXiuLianNetItemData(this._model.clientDongfuVo.combatid);var e=t.realm1+1>r.YuanshenModel.MAX_BIG_REALM?r.YuanshenModel.MAX_BIG_REALM:t.realm1+1;var i=csv.YuanshenProxy.getIns().get_dujieCfgMap(e);this.clipnum.value=i.damage1+"";var n=game.ItemUtil.parserList(70201)[0];var a=game.ItemUtil.parserList(70202)[0];var o=game.GridsModel.getIns().getItemCount(n.getItemId());var s=game.GridsModel.getIns().getItemCount(a.getItemId());this.labelnum01.text="x"+o;this.labelnum02.text="x"+s;this.imghuluwa.skin="res/static/yuanshen/bg_xiulian_huluwa_0"+this._model.getWaRoleVo(this._model.clientDongfuVo).prof+".png";this._resize()};t.prototype._resize=function(){this.hitArea=new Laya.Rectangle(Laya.stage.x-this.x,Laya.stage.y-this.y,Laya.stage.width,Laya.stage.height);this.imgdiban.y=this.imgzhezhao.y=Laya.stage.y-this.y;this.imgdiban.height=this.imgzhezhao.height=Laya.stage.height};t.prototype.setVisi=function(t){this.imgxiangyun01.visible=t;this.imgxiangyun02.visible=t;this.imgxiangyun03.visible=t;this.imgxiangyun04.visible=t};t.prototype.startDujie=function(){this._model.clientOldVo=this._model.getXiuLianNetItemData(this._model.clientDongfuVo.combatid);app.ProtocolRequest.SecSoulDujieStartReq(this._model.clientDongfuVo.combatid,0);this.boxdaoju.visible=false};t.prototype.closeView=function(){app.ViewManager.toggleDialog(t,-1,0)};t.prototype._openTips=function(t){app.ViewManager.toggleView(role.RoleDeatilAttibuteTip,app.AppContainer.flowLayer,1,[app.getLang("xiulian_shuoming_9"),t.stageX-50,t.stageY-20,null,-5])};t.prototype.playGuard=function(t){this.animationfaguang.source="uieffect/ui_yuanshen_qiuxingguang0"+t+".ani";this.animationfaguang.visible=true;this.animationfaguang.play()};t.prototype.stopGuard=function(){this.animationfaguang.visible=false;this.animationfaguang.stop()};t.prototype._openItemTips=function(){var t=game.ItemUtil.parserList(70201)[0];tip.TipManager.show(t)};t.prototype._openItemTips2=function(){var t=game.ItemUtil.parserList(70202)[0];tip.TipManager.show(t)};t.prototype._openItemTips3=function(){var t=game.ItemUtil.parserList(70200)[0];tip.TipManager.show(t)};t.SINGLE_KEY="yuanshencode.YuanshenDuJieView";return t}(ui.yuanshen.dujieviewUI);r.YuanshenDuJieView=t})(yuanshencode||(yuanshencode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yuanshencode;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.daojulist.itemRender=grids.GridView;this.daojulist.renderHandler=grids.GridView.CommonItemRender;this._model=i.YuanshenModel.getIns()};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){this.quedingbtn.visible=false;this.guanbilab.visible=false;var t=this.dataSource;var e=game.ItemUtil.parserList(t)[0];this.daojulist.array=[e]};e.SINGLE_KEY="yuanshencode.YuanshenEventResultView";return e}(ui.jiesuan.tongyongtanchuangUI);i.YuanshenEventResultView=t})(yuanshencode||(yuanshencode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yuanshencode;(function(e){var t=function(t){__extends(s,t);function s(){return t!==null&&t.apply(this,arguments)||this}s.getIns=function(){return app.Singleton.getInstance(s)};s.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=e.YuanshenModel.getIns();this.listshuxing.renderHandler=new Laya.Handler(this,this.onRenderHandler)};s.prototype.onBtnClose=function(){};s.prototype.onDisplay=function(){this.callLater(this.refreshAll)};s.prototype.onUnDisplay=function(){};s.prototype.refreshAll=function(){var t=this._model.getXiuLianNetItemData(this._model.clientDongfuVo.combatid);if(!t){app.ViewManager.toggleView(s,this,-1);return}this.x=this.dataSource[1];this.y=this.dataSource[2];this.zOrder=901;this.labeljihuo.text=this.dataSource[0]+1+"重激活";var e=this._model.getWaRoleVo(this._model.clientDongfuVo).prof;var i=csv.YuanshenProxy.getIns().get_xiulianCustomCfgMap3(t.realm1,t.realm2,this.dataSource[0]+1);if(i==undefined){app.ViewManager.toggleView(s,this,-1);return}var n=csv.YuanshenProxy.getIns().get_xiulianAttrCfgMapItem(e,i.id);var a=this._model.checkAttr(n.attr);var o=[];a.map(function(t){if(t.type=="1"){o.push(t.attr)}});this.listshuxing.array=Attributes.decode(o.join(";")).baseList;this.listshuxing.repeatY=this.listshuxing.array.length};s.prototype.onRenderHandler=function(t,e){t.text=Attributes.getPropName(t.dataSource.propId)+"+"+Attributes.getPropValue(t.dataSource.propId,t.dataSource.value,t.dataSource.formula)};s.SINGLE_KEY="yuanshencode.YuanshenGouyuTipsView";return s}(ui.yuanshen.guangdiantipUI);e.YuanshenGouyuTipsView=t})(yuanshencode||(yuanshencode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yuanshencode;(function(i){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t._cd=0;return t}t.getInstance=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=i.YuanshenModel.getIns()};t.prototype.onDisplay=function(){this.callLater(this.updateLayout);this.on(Laya.Event.CLICK,this,this.onClick);this.itemdaoju.mouseEnabled=false};t.prototype.onUnDisplay=function(){this.off(Laya.Event.CLICK,this,this.onClick)};t.prototype.updateLayout=function(){};t.prototype.setData=function(t){var e=game.ItemUtil.parserList(t)[0];this._item=e;this.itemdaoju.setData(e);this.labeltime.text=app.getLang("-")+e.itemCfg.p3+"秒";this.labelname.text=e.itemCfg.namedispaly;this.labelnum.text=game.GridsModel.getIns().getItemCount(e.getItemId())+""};t.prototype.onClick=function(){if(!game.GridsModel.getIns().hasEnoughItems(this._item.getItemId()+"-"+1,false,false,true)){manager.FlowManager.instance.flowByStyle1(app.getLang("道具不足"));return}if(game.Context.getServerTime()<this._cd){return}this._cd=game.Context.getServerTime()+1;app.ProtocolRequest.SecSoulUseItemReq(this._model.clientDongfuVo.combatid,this._item.getItemId(),1);manager.FlowManager.instance.flowByStyle1("-"+this._item.itemCfg.p3+"秒")};t.SINGLE_KEY="yuanshencode.YuanshenHurtItem";return t}(ui.yuanshen.yuanshenshousunitemUI);i.YuanshenHurtItem=t})(yuanshencode||(yuanshencode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yuanshencode;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getInstance=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this._model=i.YuanshenModel.getIns();this.listdaoju.itemRender=i.YuanshenHurtItem;this.listdaoju.renderHandler=new Laya.Handler(this,this.onRenderSetData);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.updateLayout);Laya.timer.loop(1e3,this,this._updateTime);this._model.on(i.YuanshenModel.UPDATE_YUANSHEN_DATA,this,this.updateLayout)};e.prototype.onUnDisplay=function(){this._model.off(i.YuanshenModel.UPDATE_YUANSHEN_DATA,this,this.updateLayout);Laya.timer.clearAll(this)};e.prototype.updateLayout=function(){this._xiulianNetData=this._model.getXiuLianNetItemData(this._model.clientDongfuVo.combatid);var t=csv.YuanshenProxy.getIns().get_xiulianCustomCfgMap3(this._xiulianNetData.realm1,this._xiulianNetData.realm2,this._xiulianNetData.realm3);this.listdaoju.array=t.break.split(";")};e.prototype.onRenderSetData=function(t,e){t.setData(t.dataSource)};e.prototype._updateTime=function(){if(this._xiulianNetData.ltime&&this._xiulianNetData.ltime>game.Context.getServerTime()){var t=this._xiulianNetData.ltime-game.Context.getServerTime();this.label01.text=app.getLang("恢复时长：")+util.TimeUtil.formatTime(t)}else{app.ViewManager.toggleDialog(e,-1,0)}};e.SINGLE_KEY="yuanshencode.YuanshenHurtView";return e}(ui.yuanshen.yuanshenshousuntipUI);i.YuanshenHurtView=t})(yuanshencode||(yuanshencode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yuanshencode;(function(I){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.imgdianji.on(Laya.Event.CLICK,this,this.onClick);this.imgfei01.on(Laya.Event.CLICK,this,this._onClickEvent);this.imgfei02.on(Laya.Event.CLICK,this,this._onClickEvent);this.labeljiesuo.on(Laya.Event.CLICK,this,this._openFun);this.btnkaiqi.on(Laya.Event.CLICK,this,this.openDongfu);this._model=I.YuanshenModel.getIns();this._step1Handler=new Laya.Handler(this,this.showStep);this.mouseThrough=true};e.prototype.onClick=function(t){t.stopPropagation();if(this._netData.lock==0){var e=csv.YuanshenProxy.getIns().getHoleCfgMapItem(this._netData.id);if(e.type==1){manager.FlowManager.instance.flowByStyle1(app.getLang("xiulian_error1",this._str))}else{game.Alert.show(app.getLang("bagnum_tips2"),new Laya.Handler(this,this._openView),null,0,"","fullScreen","center","center",0,"","button_name8");manager.FlowManager.instance.flowByStyle1(app.getLang("vip"+e.condition+"解锁"))}}else if(this._netData.lock==1){app.ViewManager.toggleDialog(I.YuanshenXiuLianView,1,0,this._netData)}else{manager.FlowManager.instance.flowByStyle1(app.getLang("xiulian_shuoming_24"))}};e.prototype._openView=function(){app.ViewManager.toggleDialog(vipcode.VipView,1,0)};e.prototype._onClickEvent=function(t){t.stopPropagation();var e=this._cfg=csv.YuanshenProxy.getIns().get_shijianCfgMap(this._netEventData.blessid);talk.TalkModel.getIns().createPlotid(e.story);talk.TalkModel.getIns().callBack=this._step1Handler;talk.TalkModel.getIns().event(talk.TalkModel.STORY_TIGGER,csv.StoriesProxy.ENUM_TIGGER.FU_YUAN_EVENT)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){this.ani1.play(0,true);this.ani2.play(0,true);this.ani3.play(0,true);this.animationfaguang.play(0,true);this.itemtouxiang.labelboss.visible=false;this.itemtouxiang.imgdi2.visible=false};e.prototype.setData=function(t,e){this._index=e;this._vo=t;this.itemtishi01.visible=false;var i;this.imgfei01.visible=false;this.imgfei02.visible=false;this.btnkaiqi.visible=false;this.animationjuqi.visible=false;if(this._index%2==0){i=this.imgfei01;this.boxduihua01.visible=true;this.boxduihua02.visible=false}else{i=this.imgfei02;this.boxduihua02.visible=true;this.boxduihua01.visible=false}this._netData=this._model.getDongfuNetItemData(t.id);this.labellingqinum.text="洞府灵气："+t.xlexp;var n=this._model.getXiuLianNetItemData(this._netData.combatid);if(n){this.labellingqinum.text="洞府灵气："+this._netData.spirit}else{this.labellingqinum.text="洞府灵气："+t.xlexp}if(this._netData.lock==0||this._netData.lock==2){this.itemtouxiang.visible=false;this.imgjiesuobg.visible=true;if(t.type==1){this.labeljiesuo.visible=true}else{this.imgkaiqi.visible=true}I.YuanshenMainView.getIns().viewdongfu["dongfu0"+t.id].visible=false;if(this._netData.lock==2){this.btnkaiqi.visible=true;this.labeljiesuo.visible=false;this.imgjiesuobg.visible=false}}else{I.YuanshenMainView.getIns().viewdongfu["dongfu0"+t.id].visible=true;if(this._netData.combatid.getLow()!=0&&this._netData.combatid.getHigh()!=0){var a=this._model.getWaRoleVo(this._netData).prof;this.itemtouxiang.imgtouxiang.skin=role.RoleVO.getHeadIconUrl(a);this.itemtouxiang.visible=true}else{this.itemtouxiang.visible=false}this.imgjiesuobg.visible=false;this.labeljiesuo.visible=false;this.imgkaiqi.visible=false}if(t.type==1){this.imgkaiqi.visible=false;var o=csv.GuajiProxy.getIns().getCfgGuanqia(t.condition);var s=csv.GuajiProxy.getIns().getPart(o.id);this._str=o.chapter+"-"+s.index;this.labeljiesuo.underline=true;this.labeljiesuo.mouseEnabled=true;this.labeljiesuo.text=app.getLang("xiulian_shuoming_15",o.chapter+"-"+s.index)}else{this.labeljiesuo.visible=false}var r=this._netEventData=this._model.getFuyuanEventDataItem(t.id);if(r&&r.status!=1){var l=csv.YuanshenProxy.getIns().get_fuyuanCfgMap(r.eventid);this.imgfei01.skin=this.imgfei02.skin="res/static/yuanshen/"+l.pic+".png";this.labelduihua01.text=this.labelduihua02.text=app.getLang(l.talk);i.visible=true}else{i.visible=false;this.boxduihua02.visible=false;this.boxduihua01.visible=false}if(this._netData.lock==1){this.imglingqibg.visible=true;this.labellingqinum.visible=true}else{this.imglingqibg.visible=false;this.labellingqinum.visible=false}if(game.Context.disableIosRecharge()&&t.type==2){this.visible=false}if(this._model.dongfuRed(t.id)){var h=[1,5,2,3,4];var p=0;for(var u=0;u<h.length;u++){if(t.id==h[u]){p=u}}var c=game.SystemSetModel.getInstance().settingData.data;var g=c[game.SettingType.yuanshenXiulian].toString();for(var f=0,d=g.length;f<d;f++){if(p==f&&g[f]=="2"){game.RedDotView.addTo(I.YuanshenMainView.getIns().viewdongfu["sprite0"+t.id],null,null,1,1,game.RedDotView.ENUM_TYPE.XIN);return}}var y=this._model.getDongfuNetItemData(t.id);if(y.lock==1){if(y.combatid.getLow()==0&&y.combatid.getHigh()==0){game.RedDotView.addTo(I.YuanshenMainView.getIns().viewdongfu["sprite0"+t.id],null,null,1,1,game.RedDotView.ENUM_TYPE.KONG)}else{game.RedDotView.addTo(I.YuanshenMainView.getIns().viewdongfu["sprite0"+t.id])}}}else{game.RedDotView.removeFrom(I.YuanshenMainView.getIns().viewdongfu["sprite0"+t.id])}this.itemtishi01.visible=false;Laya.timer.clearAll(this);if(this._netData.lock==1){if(this._netData.combatid.getLow()!=0&&this._netData.combatid.getHigh()!=0){var v=this._model.getWaRoleVo(this._netData);var _=csv.YuanshenProxy.getIns().get_xiulianCustomCfgMap3(n.realm1,n.realm2,n.realm3);if(_.rolelevel!=0){if(v.level<_.rolelevel){this.itemtishi01.visible=true;this.itemtishi01.setData(app.getLang("xiulian_shuoming_25",_.rolelevel))}}if(n.ltime&&n.ltime>game.Context.getServerTime()){this.itemtishi01.visible=true;this._updateTime();Laya.timer.loop(1e3,this,this._updateTime)}var m=Uint64.toNumber(n.exp);if(+_.xlexp*50==m||n.realm1==I.YuanshenModel.MAX_BIG_REALM&&n.realm2==3&&n.realm3==I.YuanshenModel.MAX_CHONG_NUM){this.itemtishi01.visible=true;this.itemtishi01.setData(app.getLang("xiulian_shuoming_27"))}}}};e.prototype._updateTime=function(){var t=this._model.getXiuLianNetItemData(this._netData.combatid);if(t.ltime&&t.ltime>game.Context.getServerTime()){var e=t.ltime-game.Context.getServerTime();var i=util.TimeUtil.formatTime(e);this.itemtishi01.setData(app.getLang("xiulian_shuoming_26",i))}};e.prototype.showStep=function(){this._model.checkEventType(this._cfg,this._netEventData)};e.prototype.openDongfu=function(){var t=this;app.ProtocolRequest.OpenDongfuReq(this._vo.id);this.animationjuqi.visible=true;this.animationjuqi.play(0,false);Laya.timer.once(1e3,this,function(){t.animationjuqi.visible=false});if(this._vo.mijing){mjhole.MjHoleModel.getIns().openLockDongfu(this._vo.mijing)}else{app.ViewManager.toggleDialog(mjhole.MjHoleDongfuGetView,1,0,null)}};e.prototype._openFun=function(){if(battle.BattleModel.getIns().checkBattleState(true)){return}game.ClosureManager.callFunction(csv.FunctionsProxy.ENUMS.PASS,true,false,this._vo.condition+"");if(this._netData.lock==2){var t=csv.GuajiProxy.getIns().getMijingCfg(this._vo.mijing);if(t.type==1){app.ViewManager.toggleDialog(guaji.MijingInfoView,1,0,[t])}else if(t.type==2){app.ViewManager.toggleDialog(guaji.DongInfoView,1,0,[t])}}};e.SINGLE_KEY="yuanshencode.YuanshenMainItem";return e}(ui.yuanshen.dongfuitemUI);I.YuanshenMainItem=t})(yuanshencode||(yuanshencode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yuanshencode;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.width=this.imgzhezhao.width=750;this._model=i.YuanshenModel.getIns();this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.on(Laya.Event.CLICK,this,this.onClick);this.roleMediator=new common.RoleListMediator2(this.itemrenwu.listrenwu,i.YuanshenSelRoleItem,new Laya.Handler(this,this._isPlayAni));guide.GuideModel.getIns().register(csv.GuideProxy.ENUM_VIEW.YUANSHEN_ROLE_SELECT,this,this.getGuideItemBtn,500)};e.prototype.getGuideItemBtn=function(t){return this.itemrenwu.listrenwu.cells[t-1]};e.prototype.onDisplay=function(){this._resize();this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){this._vo=this.dataSource;var t=[];var e=0;if(this._vo.crossDf){var i=csv.YuanshenProxy.getIns().getKfCfgMapItem(this._vo.crossDf);e=i.realm}for(var n=0;n<game.Context.roleList.length;n++){var a=game.Context.roleList[n];if(this._cancelSelf(a.insId)){}else{if(e<=role.RoleVO.getXiulianId(a.soulStar)){t.push(a)}}}this.roleMediator.setData(-1,t)};e.prototype.onClick=function(t){t.stopPropagation()};e.prototype._isCanJoinRoleSel=function(t){for(var e=0;e<this._model.dongfuNetArr.length;e++){if(Uint64.equal(t,this._model.dongfuNetArr[e].combatid)){return this._model.dongfuNetArr[e]}}return null};e.prototype._cancelSelf=function(t){if(this._vo.combatid.getLow()!=0&&this._vo.combatid.getHigh()!=0){if(Uint64.equal(t,this._vo.combatid)){return true}}return false};e.prototype._resize=function(){this.y=i.YuanshenXiuLianView.getIns().imgdiban.height-(i.YuanshenXiuLianView.getIns().imgdiban.height-i.YuanshenXiuLianView.getIns().height)/2-this.height};e.prototype._isPlayAni=function(){if(this._model.clientDongfuVo.combatid.getLow()!=0&&this._model.clientDongfuVo.combatid.getHigh()!=0){Laya.Tween.to(i.YuanshenXiuLianView.getIns().imghuluwa,{alpha:0},500,null,new Laya.Handler(this,this._roleSelectChange));Laya.Tween.to(i.YuanshenXiuLianView.getIns().boxbtn,{alpha:0},500,null,new Laya.Handler(this,null));i.YuanshenXiuLianView.getIns().animationjuqi.visible=false}else{this._roleSelectChange()}this._model.clientIsCanSelRole=false;app.ViewManager.toggleView(e,this,-1)};e.prototype._roleSelectChange=function(){var t=this.itemrenwu.listrenwu.array[this.roleMediator.selectedIndex];var e=this._isCanJoinRoleSel(t.role.insId);if(e){game.Alert.show(app.getLang("kfxiulian_10_2"),Laya.Handler.create(this,this.onConfirm,[e,t]),new Laya.Handler)}else{app.ProtocolRequest.SecSoulStartReq(this._vo.id,t.role.insId,1)}i.YuanshenXiuLianView.getIns().labeljindutiao02.visible=false;i.YuanshenXiuLianView.getIns().setAniMaskX();Laya.Tween.to(i.YuanshenXiuLianView.getIns().imghuluwa,{alpha:1},500,null,new Laya.Handler(this,null));Laya.Tween.to(i.YuanshenXiuLianView.getIns().boxbtn,{alpha:1},500,null,new Laya.Handler(this,this._clickCd));i.YuanshenXiuLianView.getIns().animationjuqi.visible=true};e.prototype.onConfirm=function(t,e){app.ProtocolRequest.SecSoulStartReq(t.id,Uint64.fromNumber(0),2);app.ProtocolRequest.SecSoulStartReq(this._vo.id,e.role.insId,1)};e.prototype._clickCd=function(){this._model.clientIsCanSelRole=true};e.SINGLE_KEY="yuanshencode.YuanshenSelectRoleView";return e}(ui.yuanshen.kaishixiuliantipUI);i.YuanshenSelectRoleView=t})(yuanshencode||(yuanshencode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yuanshencode;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.imgjiahao.on(Laya.Event.CLICK,this,this.onAdd);this._model=i.YuanshenModel.getIns()};e.prototype.onAdd=function(){game.RoleModel.getIns().onShowRoleUnlockView()};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t,e){this.animationxiulianzhong.play(0,true);this._role=t.role;this.labeldujie.visible=false;if(this._role){this.setDujie();this.labelnum.visible=true;this.bgshuzi.visible=true;this.labelnum.text=csv.ReBirthProxy.getIns().getTransLvl(this._role.level).toString();this.imglock.visible=false;this.imgjiahao.visible=false;this.imgtouxiang.visible=true;this.imgtouxiang.skin=this._role.getHeadIconUrl();this.chuzhanimg.visible=this._role.infight==1;if(this._role.tupoLv){var i=csv.LevelProxy.getIns().getHuluStyle(this._role.tupoLv);this.hulu.hulu.skin=csv.LevelProxy.HULU_ICONS[i.grade];this.dengji.text=this._role.tupoLv.toString();this.hulu.visible=true;this.dengji.visible=true}else{this.hulu.visible=false;this.dengji.visible=false}}else{this.labelnum.visible=false;this.bgshuzi.visible=false;this.imgtouxiang.visible=false;this.imglock.visible=true;this.imgjiahao.visible=false;this.chuzhanimg.visible=false;this.hulu.visible=false;this.dengji.visible=false;var n=game.Context.roleList.length;if(n==e&&!t.boOther){this.imglock.visible=false;this.imgjiahao.visible=true}}this.imgxuanzhong.visible=t.select;if(t.boRed){game.RedDotView.addTo(this,121,7)}else{game.RedDotView.removeFrom(this)}this.checkAni(e)};e.prototype.setDujie=function(){this.labeldujie.visible=true;var t=this._model.getXiuLianNetItemData(this._role.insId);this.imgname.skin="res/static/jiesuohulu/bg_"+this._role.prof+".png";if(t){var e=csv.YuanshenProxy.getIns().get_xiulianCustomCfgMap3(t.realm1,t.realm2,t.realm3);var i=this._model.getBigRealm(t.realm1);var n=this._model.getSamllRealm(t.realm2);var a=this._model.getChineseNum(t.realm3);if(t.realm1==1){this.labeldujie.text=i+a+"重"}else{this.labeldujie.text=i+n+a+"重"}}else{this.labeldujie.text="无境界"}this.animationxiulianzhong.visible=false;for(var o=0;o<this._model.dongfuNetArr.length;o++){if(this._model.dongfuNetArr[o].lock==1&&Uint64.equal(this._model.dongfuNetArr[o].combatid,this._role.insId)){this.animationxiulianzhong.visible=true}}};e.prototype.checkAni=function(t){this.jihuotexiao.stop();this.jihuotexiao.visible=false;if(game.Context.roleList.length==t){if(game.RoleModel.getIns().checkAddRoleCondiion(t+1)){this.jihuotexiao.play();this.jihuotexiao.visible=true}}};e.SINGLE_KEY="yuanshencode.YuanshenSelRoleItem";return e}(ui.yuanshen.kaishixiulianitemUI);i.YuanshenSelRoleItem=t})(yuanshencode||(yuanshencode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yuanshencode;(function(o){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=o.YuanshenModel.getIns()};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){this.label01.text=Attributes.getPropName(t.now);this.label02.text=Attributes.getPropValue(t.old,this._getAddRoleAttrNum(t.old,1));this.label03.text=Attributes.getPropValue(t.now,this._getAddRoleAttrNum(t.now,2))};e.prototype._getAddRoleAttrNum=function(t,e){var i=0;for(var n=0;n<game.Context.roleList.length;n++){if(Uint64.equal(this._model.clientDongfuVo.combatid,game.Context.roleList[n].insId)){if(t==78){i=Math.floor(+(game.Context.roleList[n].attribute[2]/1.1))}else{i=game.Context.roleList[n].attribute[t]}break}}if(e==1){var a=o.YuanshenXiulianTupoBigSucceedView.getIns().getOldProp();for(var n=0;n<a.length;n++){if(a[n].propId==t){if(a[n].formula==1){i-=i*(a[n].value/1e4)}else{i-=a[n].value}break}}}return Math.ceil(i)};e.SINGLE_KEY="yuanshencode.YuanshenTupoBigPropItem";return e}(ui.yuanshen.jingjietupoitemUI);o.YuanshenTupoBigPropItem=t})(yuanshencode||(yuanshencode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yuanshencode;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){this.label01.text=Attributes.getPropName(t.propId);this.label02.text="+"+Attributes.getPropValue(t.propId,t.value,t.formula)};e.SINGLE_KEY="yuanshencode.YuanshenTupoPropItem";return e}(ui.yuanshen.tupopingjingitemUI);t.YuanshenTupoPropItem=e})(yuanshencode||(yuanshencode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yuanshencode;(function(r){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.isAuto=false;return t}t.getInstance=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=r.YuanshenModel.getIns();this.imgxiangying.on(Laya.Event.MOUSE_DOWN,this,this.onMouseDown);this.imgxiangying.on(Laya.Event.MOUSE_UP,this,this.onMouseUp);this.imgxiangying.on(Laya.Event.MOUSE_OUT,this,this.onMouseOut)};t.prototype.onDisplay=function(){this.callLater(this.updateLayout)};t.prototype.onUnDisplay=function(){};t.prototype.updateLayout=function(){};t.prototype.setData=function(t,e){this._index=e;var i=game.ItemUtil.parserList(t.id+"-1")[0];this._item=i;var n=game.GridsModel.getIns().getItemCount(i.getItemId());i.setCount(n);this.itemdaoju.setData(i);this.itemmoney.setIconSkin("public/icn_xiuwei.png");this.labelname.text=t.namedispaly;this.labeltime.text=t.p1};t.prototype.onMouseDown=function(t){if(!this.isAuto){Laya.timer.once(500,this,this.timeShenji,[t]);this.isAuto=true}};t.prototype.onMouseOut=function(){this.isAuto=false;Laya.timer.clearAll(this)};t.prototype.onMouseUp=function(t){this.isAuto=false;Laya.timer.clearAll(this);this.onClick(t)};t.prototype.timeShenji=function(t){Laya.timer.loop(100,this,this.onClick,[t])};t.prototype.onClick=function(t){t.stopPropagation();if(!game.GridsModel.getIns().hasEnoughItems(this._item.getItemId()+"-"+1)){Laya.timer.clearAll(this);manager.FlowManager.instance.flowByStyle1(app.getLang("道具不足"));return}var e=this._model.getXiuLianNetItemData(this._model.clientDongfuVo.combatid);var i=csv.YuanshenProxy.getIns().get_xiulianCustomCfgMap3(e.realm1,e.realm2,e.realm3);if(i.xlexp==0){manager.FlowManager.instance.flowByStyle1(app.getLang("xiulian_shuoming_21"));return}if(Uint64.toNumber(e.exp)>=i.xlexp*50){manager.FlowManager.instance.flowByStyle1(app.getLang("xiulian_shuoming_14"));return}var n=t.stageX;var a=r.YuanshenXiuLianView.getIns().globalToLocal(new Laya.Point(n,t.stageY));var o=r.YuanshenXiuLianView.getIns().imghuluwa.parent.localToGlobal(new Laya.Point(r.YuanshenXiuLianView.getIns().imghuluwa.x-50,r.YuanshenXiuLianView.getIns().imghuluwa.y+50));var s=Laya.Pool.getItemByClass(manager.TailYuanshenFlyItem.SINGLE_KEY,manager.TailYuanshenFlyItem);s.init(a.x,a.y,o,0,0,r.YuanshenXiuLianView.getIns());app.ProtocolRequest.SecSoulUseItemReq(this._model.clientDongfuVo.combatid,this._item.getItemId(),1);manager.FlowManager.instance.flowByStyle1("修为+"+this._item.itemCfg.p1,null,game.STYLES.GREEN_COLOR);Laya.timer.once(800,this,function(){r.YuanshenXiuLianView.getIns().animationfaguang.visible=true;r.YuanshenXiuLianView.getIns().animationfaguang.play(0,false)});Laya.timer.once(1300,this,function(){r.YuanshenXiuLianView.getIns().animationfaguang.stop();r.YuanshenXiuLianView.getIns().animationfaguang.visible=false})};t.SINGLE_KEY="yuanshencode.YuanshenXianCaoItem";return t}(ui.yuanshen.xiancaoitemUI);r.YuanshenXianCaoItem=t})(yuanshencode||(yuanshencode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yuanshencode;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.imgzhezhao.width=this.boxdaoju.width=750;this.listdaoju.centerX=.5;this.labeltishi.centerX=.5;this.boxdaoju.centerX=.5;this.boxqianwang.centerX=.5;this._model=i.YuanshenModel.getIns();this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listdaoju.repeatX=6;this.listdaoju.itemRender=i.YuanshenXianCaoItem;this.listdaoju.renderHandler=new Laya.Handler(this,this.onRenderSetData);this.listdaoju.hScrollBarSkin="";guide.GuideModel.getIns().register(csv.GuideProxy.ENUM_VIEW.EAT_XIANDAN,this,this.getGuideItemBtn)};e.prototype.getGuideItemBtn=function(t){var e=[];var i=this._model.getXiuLianNetItemData(this._model.clientDongfuVo.combatid);for(var n=0;n<this._model.clientXiancaoArr.length;n++){if(i.realm1>=this._model.clientXiancaoArr[n].p4&&game.GridsModel.getIns().hasEnoughItems(this._model.clientXiancaoArr[n].id+"-"+1)){e.push(this._model.clientXiancaoArr[n])}}e.sort(function(t,e){if(+t.p4>+e.p4){return-1}else if(+t.p4==+e.p4){if(t.qua>e.qua){return-1}else{return 1}}else{return 1}});this.listdaoju.array=e;for(var n=0,a=this.listdaoju.cells.length;n<a;n++){var o=this.listdaoju.cells[n];if(o.dataSource&&o.dataSource.id==t){return o}}return null};e.prototype.onDisplay=function(){this.callLater(this.refreshAll);this.on(Laya.Event.CLICK,this,this.onClick);this.labliandan.on(Laya.Event.CLICK,this,this.onClickGo);this.labjishi.on(Laya.Event.CLICK,this,this.onClickGo2);this._model.on(i.YuanshenModel.UPDATE_YUANSHEN_DATA,this,this.refreshAll)};e.prototype.onUnDisplay=function(){this.off(Laya.Event.CLICK,this,this.onClick);this.labliandan.off(Laya.Event.CLICK,this,this.onClickGo);this.labjishi.off(Laya.Event.CLICK,this,this.onClickGo2);this._model.off(i.YuanshenModel.UPDATE_YUANSHEN_DATA,this,this.refreshAll)};e.prototype.refreshAll=function(){if(csv.FunctionsProxy.getIns().isOpen(csv.FunctionsProxy.ENUMS.BLACK_MARKET)){this.labliandan.x=1;this.labjishi.visible=true}else{this.labliandan.x=71;this.labjishi.visible=false}this._resize();var t=[];var e=this._model.getXiuLianNetItemData(this._model.clientDongfuVo.combatid);for(var i=0;i<this._model.clientXiancaoArr.length;i++){if(e.realm1>=this._model.clientXiancaoArr[i].p4&&game.GridsModel.getIns().hasEnoughItems(this._model.clientXiancaoArr[i].id+"-"+1)){t.push(this._model.clientXiancaoArr[i])}}var n=t.sort(function(t,e){if(+t.p4>+e.p4){return-1}else if(+t.p4==+e.p4){if(t.qua>e.qua){return-1}else{return 1}}else{return 1}});this.listdaoju.array=n;if(this.listdaoju.array.length==0){this.listdaoju.visible=false;this.boxqianwang.visible=true}else{this.listdaoju.visible=true;this.boxqianwang.visible=false}var a=this._model.getXiuLianAllNetYaoItemData();this.labeltishi.text=app.getLang("今日服用次数：")+a+"/"+game.Config.getParams(966)};e.prototype._resize=function(){this.y=i.YuanshenXiuLianView.getIns().imgdiban.height-(i.YuanshenXiuLianView.getIns().imgdiban.height-i.YuanshenXiuLianView.getIns().height)/2-this.height};e.prototype.onRenderSetData=function(t,e){t.setData(t.dataSource,e)};e.prototype.onClick=function(t){t.stopPropagation()};e.prototype.onClickGo=function(t){game.ClosureManager.callFunction(csv.FunctionsProxy.ENUMS.REFINE_HOUSE,true,false,"1");app.ViewManager.toggleDialog(i.YuanshenXiuLianView,-1,1)};e.prototype.onClickGo2=function(){game.ClosureManager.callFunction(csv.FunctionsProxy.ENUMS.BLACK_MARKET);app.ViewManager.toggleDialog(i.YuanshenXiuLianView,-1,1)};e.SINGLE_KEY="yuanshencode.YuanshenXianCaoView";return e}(ui.yuanshen.xiancaotipUI);i.YuanshenXianCaoView=t})(yuanshencode||(yuanshencode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yuanshencode;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getInstance=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=i.YuanshenModel.getIns()};e.prototype.onDisplay=function(){this.callLater(this.updateLayout);this.btnqianwang.on(Laya.Event.CLICK,this,this.onClick)};e.prototype.onUnDisplay=function(){this.btnqianwang.off(Laya.Event.CLICK,this,this.onClick)};e.prototype.updateLayout=function(){};e.prototype.setData=function(t){var e=this._vo=csv.YuanshenProxy.getIns().get_xiuliantujingCfgMap(t.cfgId);this.imgmubiaoicon.skin=e.icon+".png";this.labeltitle.text=app.getLang("xiulian_tujing_"+e.id);this.label01.text=app.getLang(e.describe,t.value);this.label02.text=""};e.prototype.onClick=function(){Laya.Dialog.closeAll();game.ClosureManager.callFunction(this._vo.function_id)};e.SINGLE_KEY="yuanshencode.YuanshenXiulianAddItem";return e}(ui.yuanshen.xiulianzengfuitemUI);i.YuanshenXiulianAddItem=t})(yuanshencode||(yuanshencode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yuanshencode;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this._model=i.YuanshenModel.getIns();this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listjijiangkaiqi.itemRender=i.YuanshenXiulianAddItem;this.listjijiangkaiqi.renderHandler=new Laya.Handler(this,this.onRenderSetData)};e.prototype.onDisplay=function(){this._model.on(i.YuanshenModel.YUANSHEN_ADDVIEW_DATA,this,this.refreshAll);app.ProtocolRequest.SecSoulMakeUpReq(this._model.clientDongfuVo.id);this.btnwenhao.on(Laya.Event.CLICK,this,this._openTips)};e.prototype.onUnDisplay=function(){this.btnwenhao.off(Laya.Event.CLICK,this,this._openTips);this._model.off(i.YuanshenModel.YUANSHEN_ADDVIEW_DATA,this,this.refreshAll)};e.prototype.refreshAll=function(){var t=this._model.getXiuLianNetItemData(this._model.clientDongfuVo.combatid);if(t){var e=csv.YuanshenProxy.getIns().get_xiulianCustomCfgMap3(t.realm1,t.realm2,t.realm3);this.label01.text="修炼速度："+Math.floor(this._model.clientDongfuVo.spirit*t.rate*.01)+"/分钟";this.label02.text="洞府灵气："+this._model.clientDongfuVo.spirit;this.label03.text="吸收率:"+t.rate+"%"}else{this.label01.text="修炼速度：0";this.label02.text="洞府灵气："+this._model.clientDongfuVo.spirit;this.label03.text="吸收率: 0%"}if(this._model.makeUpData){this.listjijiangkaiqi.visible=true;var i=this._model.makeUpData.sort(function(t,e){return t.cfgId-e.cfgId});this.listjijiangkaiqi.array=i}else{this.listjijiangkaiqi.visible=false}};e.prototype._updateDungeonView=function(){};e.prototype.onRenderSetData=function(t,e){t.setData(t.dataSource)};e.prototype._openTips=function(t){var e=0;if(this._model.clientDongfuVo.id==6){e=csv.YuanshenProxy.getIns().getKfCfgMapItem(this._model.clientDongfuVo.crossDf).xlexp}else{e=csv.YuanshenProxy.getIns().getHoleCfgMapItem(this._model.clientDongfuVo.id).xlexp}app.ViewManager.toggleView(role.RoleDeatilAttibuteTip,app.AppContainer.flowLayer,1,[app.getLang("xiulian_shuoming_4",e),t.stageX-50,t.stageY-20,90])};e.SINGLE_KEY="yuanshencode.YuanshenXiulianAddView";return e}(ui.yuanshen.xiulianzengfuviewUI);i.YuanshenXiulianAddView=t})(yuanshencode||(yuanshencode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yuanshencode;(function(h){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=h.YuanshenModel.getIns();this.listleijishuxing.renderHandler=new Laya.Handler(this,this.onRenderHandler)};e.prototype.onBtnClose=function(){};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){this._model.initWaShuxingMap();var t=this._model.getXiuLianNetItemData(this._model.clientDongfuVo.combatid);if(!t){app.ViewManager.toggleView(h.YuanshenGouyuTipsView,this,-1);return}var e=this._model.getWaRoleVo(this._model.clientDongfuVo).prof;var i=csv.YuanshenProxy.getIns().get_xiulianCustomCfgMap3(t.realm1,t.realm2,t.realm3);for(var n=1;n<=i.id;n++){this._getPropItem(e,n)}var a=[];var o=[];var s=this._model.getWaPropMap(e);for(var r in s){if(s[r]!=0){a.push({propId:+r,value:s[r]})}}for(var n=0;n<h.YuanshenModel.PROP_SORT_ARRAY.length;n++){for(var l=0;l<a.length;l++){if(h.YuanshenModel.PROP_SORT_ARRAY[n]==a[l].propId){o.push(a[l])}}}this.listleijishuxing.array=o;this.listleijishuxing.repeatY=this.listleijishuxing.array.length;this.height=this.tipsbg.height=this.listleijishuxing.height+100;this.listleijishuxing.centerX=0};e.prototype._getPropItem=function(a,t){var o=this;var e=csv.YuanshenProxy.getIns().get_xiulianAttrCfgMapItem(a,t);if(e){var i=this._model.checkAttr(e.attrclient);var n=[];i.map(function(t){if(t.type=="1"){n.push(t.attr)}});n.map(function(t){var e=t.split("-");var i=e[0];var n=+e[e.length-1];o._model.setWaPropMap(a,+i,n)})}};e.prototype.onRenderHandler=function(t,e){if(t.dataSource.propId==127||t.dataSource.propId==128||t.dataSource.propId==129||t.dataSource.propId==130||t.dataSource.propId==131){t.text=Attributes.getPropName(t.dataSource.propId-5)+"+"+Attributes.getPropValue(t.dataSource.propId-5,t.dataSource.value,1)}else{t.text=Attributes.getPropName(t.dataSource.propId)+"+"+Attributes.getPropValue(t.dataSource.propId,t.dataSource.value,0)}};e.SINGLE_KEY="yuanshencode.YuanshenXiulianPropTipsView";return e}(ui.yuanshen.tipleijishuxingUI);h.YuanshenXiulianPropTipsView=t})(yuanshencode||(yuanshencode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yuanshencode;(function(i){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.fullScreen="fullScreen";return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.imgdiban.y=Laya.stage.y-this.y;this.imgdiban.height=Laya.stage.height;this._circleMoveMediator=new game.CircleMoveMediator(this.imgzhuangshi,i.JadeItem,this.imgzhuangshi.width/2-25);this._handler=new Laya.Handler(this,this.onHandler)};t.prototype.onDisplay=function(){this.x=(Laya.stage.width-this.width)/2;this.y=(Laya.stage.height-this.height)/2;this.animationqi01.play();this.animationqi03.play();this.animationqi04.play();this.animationfaguang.play();this.animationjuqi.play();this.ani1.play();this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){this._circleMoveMediator.stopMove()};t.prototype.refreshAll=function(){this.ani2.gotoAndStop(0);this.ani3.gotoAndStop(0);var t=this.dataSource[0];var e=this.dataSource[1];var i=this.dataSource[2];var n=this.dataSource[3];var a=csv.YuanshenProxy.getIns().getHoleCfgMapItem(t);this.imgdiban.skin="res/static/yuanshen/bg_xiulian_bg_0"+a.id+".jpg";this.imgdibanyuanquan.skin="res/static/yuanshen/bg_xiulian_diban_0"+a.id+".png";this.imgzhuangshi02.skin="res/static/yuanshen/bg_xiulian_yuanpan_0"+a.id+".png";this.imgzhuangshi03.skin="res/static/yuanshen/bg_xiulian_bg_long_0"+a.id+".png";this.imgyuanshen.skin="res/static/yuanshenzhenshen/"+e+".png";this.imghuluwa.skin="res/static/yuanshen/bg_xiulian_huluwa_0"+i+".png";this._circleMoveMediator.setCount(n);this._circleMoveMediator.setJiHuoCount(n);this._circleMoveMediator.setOutMove(true,5);this._circleMoveMediator.startClose(this._handler)};t.prototype.onHandler=function(){this.ani2.on(Laya.Event.COMPLETE,this,this.onStop);this.ani2.play(0,false)};t.prototype.onStop=function(){this.ani2.off(Laya.Event.COMPLETE,this,this.onStop);this.onAni3()};t.prototype.onAni3=function(){this.ani3.on(Laya.Event.COMPLETE,this,this.onComplete);this.ani3.play(0,false)};t.prototype.onComplete=function(){app.ViewManager.toggleView(t,app.AppContainer.talkLayer,-1);i.YuanshenXiuLianView.getIns()._tupoAni()};t.SINGLE_KEY="yuanshencode.YuanshenXiuLianShowView";return t}(ui.yuanshen.xiuliandonghuaUI);i.YuanshenXiuLianShowView=t})(yuanshencode||(yuanshencode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yuanshencode;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.on(Laya.Event.CLICK,this,this.onClick);this._model=i.YuanshenModel.getIns();this.listxinxi.itemRender=i.YuanshenTupoBigPropItem;this.listxinxi.renderHandler=new Laya.Handler(this,this.onRenderHandler);this.listxinxi.repeatY=7};e.prototype.onClick=function(){app.ViewManager.toggleDialog(e,-1,0)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){var t=this._xiulianNetData=this._model.getXiuLianNetItemData(this._model.clientDongfuVo.combatid);this.updateRealm(t);var e=this._model.getWaRoleVo(this._model.clientDongfuVo).prof;var i=csv.YuanshenProxy.getIns().get_xiulianCustomCfgMap3(t.realm1,t.realm2,t.realm3);var n=csv.YuanshenProxy.getIns().get_xiulianAttrCfgMapItem(e,i.id);var a=this._model.checkAttr(n.attr);this.listxinxi.array=this._getProp(t);this.playAni();this.updateTopAward(a)};e.prototype.playAni=function(){var t=this.listxinxi.cells;for(var e=0;e<t.length;e++){t[e].x=this.listxinxi.width}for(var e=0;e<t.length;e++){Laya.Tween.to(t[e],{x:0},300,null,null,50*e)}};e.prototype.getOldProp=function(){var t=this._model.getXiuLianNetItemData(this._model.clientDongfuVo.combatid);var e=[];var i=this._model.getWaRoleVo(this._model.clientDongfuVo).prof;var n=csv.YuanshenProxy.getIns().get_xiulianCustomCfgMap3(t.realm1,t.realm2,t.realm3);var a=csv.YuanshenProxy.getIns().get_xiulianAttrCfgMapItem(i,n.id);var o=this._model.checkAttr(a.attr);o.map(function(t){if(t.type=="1"){e.push(t.attr)}});return Attributes.decode(e.join(";")).baseList};e.prototype._getProp=function(t){var e=[];var i=this._model.getWaRoleVo(this._model.clientDongfuVo).prof;var n=csv.YuanshenProxy.getIns().get_xiulianCustomCfgMap3(t.realm1,t.realm2,t.realm3);var a=csv.YuanshenProxy.getIns().get_xiulianAttrCfgMapItem(i,n.id).attr_bigshow;var o=a.split(";");for(var s=0;s<o.length;s++){e.push({now:+o[s],old:+o[s]})}return e};e.prototype.onRenderHandler=function(t,e){t.setData(t.dataSource)};e.prototype.updateTopAward=function(t){var e="";this.boxtiancaidibao.visible=false;if(this._xiulianNetData.realm2==1){this.boxtiancaidibao.visible=true;this._addYuanMoeld();this.animationfaguang.play()}for(var i=0;i<t.length;i++){if(t[i].type!=1){e=t[i].attr;break}}if(e==""){this.itemicon.visible=false;this.itemdaoju.visible=false;this.itemskill.visible=false;return}var n=e.split("-");var a=+t[0].type;if(a==2){this.itemicon.visible=false;this.itemdaoju.visible=false;this.itemskill.visible=true;var o=new SkillData;o.id=parseInt(n[0]);o.lv=parseInt(n[1]);this.itemskill.setData(o)}else if(a==3){this.itemicon.visible=false;this.itemdaoju.visible=true;this.itemskill.visible=false;var s=game.ItemUtil.parserList(e)[0];this.itemdaoju.setData(s)}else{this.itemicon.visible=true;this.itemdaoju.visible=false;this.itemskill.visible=false;this.itemicon.skin=csv.FunctionsProxy.getIns().getCfg(+n[0]).buttonicon}};e.prototype._addYuanMoeld=function(){var t=this._model.getWaRoleVo(this._model.clientDongfuVo).prof;var e=csv.YuanshenProxy.getIns().get_xiulianCustomCfgMap3(this._xiulianNetData.realm1,this._xiulianNetData.realm2,this._xiulianNetData.realm3);var i=csv.YuanshenProxy.getIns().get_xiulianAttrCfgMapItem(t,e.id);this.imgtiancaidibao.skin="res/static/yuanshenzhenshen/"+i.res+".png"};e.prototype.updateRealm=function(t){if(this._model.clientOldVo.realm1==1){this.clipnum01.value=this._model.getBigRealm(this._model.clientOldVo.realm1)}else{this.clipnum01.value=this._model.getBigRealm(this._model.clientOldVo.realm1)+this._model.getSamllRealm(this._model.clientOldVo.realm2)}this.clipnum02.value=this._model.getBigRealm(t.realm1)+this._model.getSamllRealm(t.realm2)};e.SINGLE_KEY="yuanshencode.YuanshenXiulianTupoBigSucceedView";return e}(ui.yuanshen.jingjietupoviewUI);i.YuanshenXiulianTupoBigSucceedView=t})(yuanshencode||(yuanshencode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yuanshencode;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this._model=i.YuanshenModel.getIns();this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll);this.btnadd.on(Laya.Event.CLICK,this,this.onClick);this.xuanzhongimg.on(Laya.Event.CLICK,this,this.onClick)};e.prototype.onUnDisplay=function(){this.btnadd.off(Laya.Event.CLICK,this,this.onClick);this.xuanzhongimg.off(Laya.Event.CLICK,this,this.onClick)};e.prototype.refreshAll=function(){this.gezi.mouseEnabled=false;this.shuzhi.visible=false};e.prototype.setData=function(t){if(this._model.tupoBtnRed()){game.RedDotView.addTo(this)}else{game.RedDotView.removeFrom(this)}if(!t){this.btnadd.visible=true;this.xuanzhongimg.visible=false;this.gezi.setData(null)}else{this.btnadd.visible=false;this.xuanzhongimg.visible=true;this.gezi.setData(t)}};e.prototype.onClick=function(){app.ViewManager.toggleDialog(i.YuanshenXiulianTupoSelectView,1,0)};e.SINGLE_KEY="yuanshencode.YuanshenXiulianTupoItem";return e}(ui.common.xiaohaoitem2UI);i.YuanshenXiulianTupoItem=t})(yuanshencode||(yuanshencode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yuanshencode;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=i.YuanshenModel.getIns();this.listtupo.itemRender=i.YuanshenTupoPropItem;this.listtupo.renderHandler=new Laya.Handler(this,this.onRenderHandler)};e.prototype.onBtnClose=function(){};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){this.animation01.play();this.animation02.play();var t=this._model.getXiuLianNetItemData(this._model.clientDongfuVo.combatid);var e=this._model.getWaRoleVo(this._model.clientDongfuVo).prof;var i=csv.YuanshenProxy.getIns().get_xiulianCustomCfgMap3(t.realm1,t.realm2,t.realm3);var n=this._model.getBigRealm(t.realm1);var a=this._model.getSamllRealm(t.realm2);var o=this._model.getChineseNum(t.realm3);if(t.realm1==1){this.label01.text=app.getLang(n+"：突破瓶颈至"+o+"重")}else{this.label01.text=app.getLang(n+a+"：突破瓶颈至"+o+"重")}var s=csv.YuanshenProxy.getIns().get_xiulianAttrCfgMapItem(e,i.id);var r=this._model.checkAttr(s.attr);var l=[];r.map(function(t){l.push(t.attr)});this.listtupo.array=Attributes.decode(l.join(";")).baseList};e.prototype.onRenderHandler=function(t,e){t.setData(t.dataSource)};e.SINGLE_KEY="yuanshencode.YuanshenXiulianTupoSamllSucceedView";return e}(ui.yuanshen.tupopingjingviewUI);i.YuanshenXiulianTupoSamllSucceedView=t})(yuanshencode||(yuanshencode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yuanshencode;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getInstance=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=i.YuanshenModel.getIns()};e.prototype.onDisplay=function(){this.callLater(this.updateLayout);this.on(Laya.Event.CLICK,this,this.onClick)};e.prototype.onUnDisplay=function(){this.off(Laya.Event.CLICK,this,this.onClick)};e.prototype.updateLayout=function(){};e.prototype.setData=function(t){var e=game.ItemUtil.parserList(t)[0];this._item=e;var i=game.GridsModel.getIns().getItemCount(e.getItemId());e.setCount(i);if(i<=0){this.itemdaoju.gray=true}else{this.itemdaoju.gray=false}this.itemdaoju.setData(e);this.labeltitle.text=e.itemCfg.namedispaly;this.label01.text=app.getLang("成功率: +")+e.itemCfg.p1+"%";this.label02.text=app.getLang("元神恢复时长：-")+e.itemCfg.p2+"%"};e.prototype.onClick=function(){if(!game.GridsModel.getIns().hasEnoughItems(this._item.getItemId()+"-"+1)){manager.FlowManager.instance.flowByStyle1(app.getLang("道具不足"));return}this._model.event(i.YuanshenModel.ROLE_TUPO,this._item);app.ViewManager.toggleDialog(i.YuanshenXiulianTupoSelectView,-1,0)};e.SINGLE_KEY="yuanshencode.YuanshenXiulianTupoSelectItem";return e}(ui.yuanshen.tupodanyaoitemUI);i.YuanshenXiulianTupoSelectItem=t})(yuanshencode||(yuanshencode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yuanshencode;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getInstance=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this._model=i.YuanshenModel.getIns();this.listjijiangkaiqi.vScrollBarSkin="";this.listjijiangkaiqi.itemRender=i.YuanshenXiulianTupoSelectItem;this.listjijiangkaiqi.renderHandler=new Laya.Handler(this,this.onRenderSetData);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.updateLayout)};e.prototype.onUnDisplay=function(){};e.prototype.updateLayout=function(){var t=this._model.getXiuLianNetItemData(this._model.clientDongfuVo.combatid);var e=csv.YuanshenProxy.getIns().get_xiulianCustomCfgMap3(t.realm1,t.realm2,t.realm3);this.listjijiangkaiqi.array=e.break.split(";").reverse()};e.prototype.onRenderSetData=function(t,e){t.setData(t.dataSource)};e.SINGLE_KEY="yuanshencode.YuanshenXiulianTupoSelectView";return e}(ui.yuanshen.tupodanyaoviewUI);i.YuanshenXiulianTupoSelectView=t})(yuanshencode||(yuanshencode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var yuanshencode;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this._model=i.YuanshenModel.getIns();this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.btnzaidengdeng.clickHandler=new Laya.Handler(this,this._closeView);this.btntupo.clickHandler=new Laya.Handler(this,this._tupoReq)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll);this.btnwenhao.on(Laya.Event.CLICK,this,this._openTips);this._model.on(i.YuanshenModel.ROLE_TUPO,this,this.updateTuPoView);this.label01.width=200;this.label02.width=350};e.prototype.onUnDisplay=function(){this.btnwenhao.off(Laya.Event.CLICK,this,this._openTips);this._model.off(i.YuanshenModel.ROLE_TUPO,this,this.updateTuPoView);this._item=null};e.prototype.refreshAll=function(){this._item=null;this.itemdaoju.setData(null);var t=this._model.getXiuLianNetItemData(this._model.clientDongfuVo.combatid);var e=fabaonew.FaBaoNewModel.getIns().getPlayMode(fabaonew.Etask_type.PoJingSucceed)/100;var i=this._cfg=csv.YuanshenProxy.getIns().get_xiulianCustomCfgMap3(t.realm1,t.realm2,t.realm3);var n=this._successLv=i.successrate+e+i.failrate*t.failtime;this.label01.text=app.getLang("成功率：")+n+"%";this.label02.text=app.getLang("若失败恢复元神时长：")+Math.ceil(i.time/60*100)/100+"分";this.btnwenhao.x=this.label01.x+this.label01.width+10};e.prototype.updateTuPoView=function(t){this._item=t;t.setCount(-1);this.itemdaoju.setData(t);var e=this._model.getXiuLianNetItemData(this._model.clientDongfuVo.combatid);var i=fabaonew.FaBaoNewModel.getIns().getPlayMode(fabaonew.Etask_type.PoJingSucceed)/100;var n=this._cfg=csv.YuanshenProxy.getIns().get_xiulianCustomCfgMap3(e.realm1,e.realm2,e.realm3);var a=this._successLv=n.successrate+i+n.failrate*e.failtime;this.label01.text=app.getLang("xiulian_shuoming_6",a+"%","+"+t.itemCfg.p1+"%");this.label02.text=app.getLang("xiulian_shuoming_7",n.time/60+"分","-"+Math.ceil(n.time/60*t.itemCfg.p2*.01*100)/100+"分");this.btnwenhao.x=this.label01.x+this.label01.width+10};e.prototype._closeView=function(){app.ViewManager.toggleDialog(e,-1,0)};e.prototype._tupoReq=function(){if(this._model.getWaRoleVo(this._model.clientDongfuVo).level<this._cfg.rolelevel){manager.FlowManager.instance.flowByStyle1(app.getLang("xiulian_shuoming_11",this._cfg.rolelevel));return}this._model.clientOldVo=this._model.getXiuLianNetItemData(this._model.clientDongfuVo.combatid);if(this._item){app.ProtocolRequest.SecSoulTupoReq(this._model.clientDongfuVo.combatid,this._item.getItemId())}else{app.ProtocolRequest.SecSoulTupoReq(this._model.clientDongfuVo.combatid,0)}app.ViewManager.toggleDialog(e,-1,0)};e.prototype._openTips=function(t){var e=this._model.getXiuLianNetItemData(this._model.clientDongfuVo.combatid);var i=csv.YuanshenProxy.getIns().get_xiulianCustomCfgMap3(e.realm1,e.realm2,e.realm3);var n=fabaonew.FaBaoNewModel.getIns().getPlayMode(fabaonew.Etask_type.PoJingSucceed)/100;app.ViewManager.toggleView(role.RoleDeatilAttibuteTip,app.AppContainer.flowLayer,1,[app.getLang("xiulian_shuoming_8",this._cfg.successrate+"%")+"\n"+app.getLang("xiulian_shuoming_10",i.failrate*e.failtime+"%")+"\n"+app.getLang("xiulian_shuoming_22",n+"%"),t.stageX-50,t.stageY-20,85,-5])};e.SINGLE_KEY="yuanshencode.YuanshenXiulianTupoView";return e}(ui.yuanshen.xiufatupotipUI);i.YuanshenXiulianTupoView=t})(yuanshencode||(yuanshencode={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var zeroshopping;(function(e){var t=function(t){__extends(a,t);function a(){return t!==null&&t.apply(this,arguments)||this}a.prototype.init=function(){app.ViewManager.regist(e.ZeroShoppingMainView,"lingyuanlibao.atlas");app.ViewManager.regist(e.ZeroShoppingEnterview,"lingyuanlibao.atlas");game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.LING_YUAN_GOU_MONEY,e.ZeroShoppingMainView,null,6);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.LING_YUAN_GOU_LIST,e.ZeroShoppingEnterview);this._model=e.ZeroShoppingModel.getIns();activitytaren.ActivityTaRenModel.getIns().on(activitytaren.ActivityTaRenModel.ACTIVIT_TAREN_EVENT.RED_UPDATE,this,this.redGetHandler);activitytaren.ActivityTaRenModel.getIns().on(activitytaren.ActivityTaRenModel.ACTIVIT_TAREN_EVENT.GET_MAIN_PANEL_INFO,this,this.onGetMainPanel)};a.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.ZeroBuyResp,this,this.checkZeroBuyResp)};a.prototype.checkZeroBuyResp=function(t){this._model.event(e.ZeroShoppingEvent.ZERO_SHOPPING_REFRESH)};a.prototype.redGetHandler=function(t){for(var e=0;e<t.length;e++){var i=t[e];if(i.actId==23){activitytaren.ActivityTaRenModel.getIns().getInfoByActID(i.actId,new Laya.Handler(this,this.yourHandler))}}};a.prototype.yourHandler=function(){var t=activitytaren.ActivityTaRenModel.getIns().iconMan.getActVoByActid(23);this._model.netData=t;var e=this._model.getJinJieRiArr();activitytaren.ActivityTaRenModel.getIns().lockRed(csv.FunctionsProxy.ENUMS.LING_YUAN_GOU_LIST,false);for(var i=0;i<e.length;i++){if(e[i].state==0&&a.FristEnter){activitytaren.ActivityTaRenModel.getIns().lockRed(csv.FunctionsProxy.ENUMS.LING_YUAN_GOU_LIST,true);activitytaren.ActivityTaRenModel.getIns().setCustRed(csv.FunctionsProxy.ENUMS.LING_YUAN_GOU_LIST,true);break}}};a.prototype.onGetMainPanel=function(t){if(t.actID==23){var e=activitytaren.ActivityTaRenModel.getIns().iconMan.getActVoByActid(23);this._model.netData=e;var i=this._model.getJinJieRiArr();if(i){activitytaren.ActivityTaRenModel.getIns().lockRed(csv.FunctionsProxy.ENUMS.LING_YUAN_GOU_LIST,false);for(var n=0;n<i.length;n++){if(i[n].state==0&&a.FristEnter){activitytaren.ActivityTaRenModel.getIns().lockRed(csv.FunctionsProxy.ENUMS.LING_YUAN_GOU_LIST,true);activitytaren.ActivityTaRenModel.getIns().setCustRed(csv.FunctionsProxy.ENUMS.LING_YUAN_GOU_LIST,true);break}}}}};a.SINGLE_KEY="zeroshopping.ZeroShoppingModule";a.FristEnter=true;return a}(app.ModuleBase);e.ZeroShoppingModule=t})(zeroshopping||(zeroshopping={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var zeroshopping;(function(t){var e=function(){function t(){}t.ZERO_SHOPPING_REFRESH="ZERO_SHOPPING_REFRESH";return t}();t.ZeroShoppingEvent=e;var s=function(){function t(){}return t}();t.ZeroShoppingVo=s;var i=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.selectTempIndex=0;t.awardTime=-1;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.init=function(){};t.prototype.getJinJieRiArr=function(){if(this.netData){var t=this.netData.cfgList;var e=this.netData.info.prize;this.retArr=[];for(var i=0;i<t.length;i++){var n=new s;n.id=+t[i].id;n.actId=+t[i].activityid;n.isNeedBuy=t[i].cost==""?false:true;n.cost=+t[i].cost.split("-")[1];n.dayNum=t[i].p1;n.backMoney=t[i].p2;n.levelLIimit=t[i].p3;n.award=t[i].award;n.receive_effect=t[i].receive_effect;n.tabIcon=t[i].p4?t[i].p4:"";n.tabStr=t[i].p5?t[i].p5:"";n.itemIcon=t[i].p6?t[i].p6:"";n.itemStr=t[i].p7?t[i].p7:"";n.banner=t[i].p8?t[i].p8:"";this.retArr.push(n)}for(var i=0;i<this.retArr.length;i++){var a=this.retArr[i];var o=e[i];a.time=o.option;a.state=o.status}this.selectitemId=this.retArr[0].id;this.itemActId=this.retArr[0].actId;return this.retArr}return null};t.prototype.checkAwardByDay=function(t){var e=[];var i=this.retArr[t].award.split(";");for(var n=0;n<i.length;n++){e.push(game.ItemUtil.parserList(i[n])[0])}return e};t.prototype.getEffect=function(t){return this.retArr[t].receive_effect};t.prototype.checkDataByDay=function(t){return this.retArr[t]};t.prototype.removeTempRed=function(){};t.SINGLE_KEY="zeroshopping.ZeroShoppingModel";return t}(app.ModelBase);t.ZeroShoppingModel=i})(zeroshopping||(zeroshopping={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){this.initActivityTaRen()};e.prototype.initActivityTaRen=function(){var t=app.Config.getResById("activity_taren.csv");this._activityTaRenMap=t.getMap("id");this._activityTaRenArr=t.getArray()};e.prototype.getActivityTaRenMapCell=function(t){return this._activityTaRenMap[t]};e.prototype.getActivityTaRenArr=function(){return this._activityTaRenArr};e.SINGLE_KEY="csv.ZeroShoppingProxy";return e}(app.ModelBase);t.ZeroShoppingProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var zeroshopping;(function(o){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=o.ZeroShoppingModel.getIns();this.on(Laya.Event.CLICK,this,this.onChongZhiHandler);this.activityTimeView=new activitytaren.ActivityTimeView(this.labeltimenum,new Laya.Handler(this,this.endTimeCallBack),"{0}")};Object.defineProperty(e.prototype,"curCfg",{get:function(){var t=csv.ActivityTarenProxy.getIns().cfgMap[this._data.id];return t},enumerable:true,configurable:true});e.prototype.onChongZhiHandler=function(){if(!csv.FunctionsProxy.getIns().isOpen(csv.FunctionsProxy.ENUMS.LING_YUAN_GOU_LIST,true)){return}if(this._data.id==261){this._model.selectTempIndex=0}else if(this._data.id==262){this._model.selectTempIndex=1}else if(this._data.id==263){this._model.selectTempIndex=2}newshangcheng.NewShangChengModel.getIns().delXin(this.curCfg.tipsid);game.ClosureManager.callFunction(csv.FunctionsProxy.ENUMS.LING_YUAN_GOU_MONEY,true,false,"true")};e.prototype.onDisplay=function(){};e.prototype.onUnDisplay=function(){};e.prototype.setData=function(t,e,i){this._data=t;this._index=e;var n=this._model.checkDataByDay(e);this.bannerimg.skin="res/static/yuanbaotehui/"+n.banner+".png";this.zhanshiimg.skin="res/static/yuanbaotehui/"+n.itemIcon+".png";this.imgname.skin="res/static/yuanbaotehui/"+n.tabStr+".png";this.clipnum.value=n.dayNum;this.clipmoneynum.value=n.backMoney.split("-")[1];this.activityTimeView.start(this._model.awardTime);this._model.selectitemId=this._model.retArr[e].id;if(this._model.retArr[e].time>0){this._model.awardTime=game.Context.getServerZeroTime(this._model.retArr[e].time)+ +this._model.retArr[e].dayNum*86400}else{var a=i.timeVo;this._model.awardTime=a.endTime}this.activityTimeView.start(this._model.awardTime);game.RedDotView.removeFrom(this.bannerimg);if(n.state==1||n.state==3){game.RedDotView.addTo(this.bannerimg)}this.labeltime.visible=true;this.labeltimenum.visible=true;this.yilingquimg.visible=false;if(n.state==0){if(o.ZeroShoppingModule.FristEnter){game.RedDotView.addTo(this.bannerimg)}else{game.RedDotView.removeFrom(this.bannerimg)}if(this.labeltimenum.text==""){this.labeltime.text=""}else{this.labeltime.text=app.getLang("活动倒计时:")}}else if(n.state==1){if(this.labeltimenum.text==""){this.labeltime.text=""}else{this.labeltime.text=app.getLang("领取元宝倒计时:")}}else if(n.state==2){if(this.labeltimenum.text==""){this.labeltime.text=""}else{this.labeltime.text=app.getLang("领取元宝倒计时:")}}else if(n.state==3){this.labeltimenum.visible=false;this.labeltime.visible=false}else if(n.state==4){this.labeltime.visible=false;this.labeltimenum.visible=false;this.yilingquimg.visible=true}if(newshangcheng.NewShangChengModel.getIns().isXinCanShow(this.curCfg.tipsid)){game.RedDotView.addTo(this,this.width,5,1,1,game.RedDotView.ENUM_TYPE.XIN)}else{game.RedDotView.removeFrom(this)}};e.prototype.hideSubTime=function(){this.activityTimeView.stop();this.labeltime.visible=false;this.labeltimenum.visible=false;this._model.event(o.ZeroShoppingEvent.ZERO_SHOPPING_REFRESH)};e.prototype.endTimeCallBack=function(){this.hideSubTime()};return e}(ui.yuanbaotehui.yuanbaotehui_lingyuangouitemUI);o.ZeroShoppingEnterItem=t})(zeroshopping||(zeroshopping={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var zeroshopping;(function(n){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.bannerlist.itemRender=n.ZeroShoppingEnterItem;this.bannerlist.renderHandler=new Laya.Handler(this,this.onRenderHandler);this._model=n.ZeroShoppingModel.getIns()};e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.onDisplay=function(){app.ViewManager.toggleView(main.MoneyView,this,1);activitytaren.ActivityTaRenModel.getIns().on(activitytaren.ActivityTaRenModel.ACTIVIT_TAREN_EVENT.UPDATE_ACTIVIT_DATA,this,this.refrshNetData);activitytaren.ActivityTaRenModel.getIns().on(activitytaren.ActivityIconStatuManager.EVENT_ACRIVITY_SINGLE_VISIBLE,this,this.onShowHide);this.callLater(this.refrshNetData)};e.prototype.onUnDisplay=function(){app.ViewManager.toggleView(main.MoneyView,app.AppContainer.uiLayer,1);activitytaren.ActivityTaRenModel.getIns().off(activitytaren.ActivityIconStatuManager.EVENT_ACRIVITY_SINGLE_VISIBLE,this,this.onShowHide);activitytaren.ActivityTaRenModel.getIns().off(activitytaren.ActivityTaRenModel.ACTIVIT_TAREN_EVENT.UPDATE_ACTIVIT_DATA,this,this.refrshNetData);n.ZeroShoppingModule.FristEnter=false;if(activitytaren.ActivityTaRenModel.getIns().isRedLock(csv.FunctionsProxy.ENUMS.LING_YUAN_GOU_LIST)){var t=this._model.getJinJieRiArr();var e=true;for(var i=0;i<t.length;i++){if(t[i].state==1||t[i].state==3){e=false}}if(e){activitytaren.ActivityTaRenModel.getIns().setCustRed(csv.FunctionsProxy.ENUMS.LING_YUAN_GOU_LIST,false)}}};e.prototype.refrshNetData=function(){var i=this;main.MoneyView.getIns().setPos(200,0);var t=activitytaren.ActivityTaRenModel.getIns().iconMan.getActVoByActid(23);if(t){this.bannerlist.visible=true;this.tishiimg.visible=false;activitytaren.ActivityTaRenModel.getIns().getInfoByActID(23,new Laya.Handler(this,function(t){var e=activitytaren.ActivityTaRenModel.getIns().iconMan.getActVoByActid(23);i.actVo=e;i._model.netData=e;i.refreshAll()}))}else{this.bannerlist.visible=false;this.tishiimg.visible=true}};e.prototype.refreshAll=function(){var t=this._model.getJinJieRiArr();if(t){this.bannerlist.array=t.sort(function(t,e){if(t.state&&t.state==4){return 1}if(e.state&&e.state==4){return-1}})}};e.prototype.onRenderHandler=function(t,e){t.setData(t.dataSource,e,this.actVo)};e.prototype.onShowHide=function(t){if(t.actId==23&&!t.visible){this.bannerlist.visible=false;this.tishiimg.visible=true}};e.SINGLE_KEY="zeroshopping.ZeroShoppingEnterview";return e}(ui.yuanbaotehui.yuanbaotehui_lingyuangouUI);n.ZeroShoppingEnterview=t})(zeroshopping||(zeroshopping={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var zeroshopping;(function(n){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.effectArr=[];t.leaveId=-1;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this._model=n.ZeroShoppingModel.getIns();this.listyeqian.itemRender=n.ZeroShoppingTabItem;this.listyeqian.scrollRectOffY=15;this.listyeqian.renderHandler=new Laya.Handler(this,this.onDailyTabHandler);this.listyeqian.selectEnable=true;this.listyeqian.selectHandler=new Laya.Handler(this,this.onSelectHandler);this.listdaoju.itemRender=grids.GridView;this.listdaoju.renderHandler=new Laya.Handler(this,this.onCellHandler);this.labeltimenum.x=420;this.activityTimeView=new activitytaren.ActivityTimeView(this.labeltimenum,new Laya.Handler(this,this.endTimeCallBack),"{0}")};t.prototype.onSelectHandler=function(t){this.refreCellView(t)};t.prototype.onDailyTabHandler=function(t,e){t.lingquEffect=this.listyeqian.selectedIndex==e;t.setData(t.dataSource,e)};t.prototype.onCellHandler=function(t,e){t.setData(t.dataSource,"",.69,undefined,this.effectArr[e])};t.prototype.onDisplay=function(){n.ZeroShoppingModule.FristEnter=false;if(activitytaren.ActivityTaRenModel.getIns().isRedLock(csv.FunctionsProxy.ENUMS.LING_YUAN_GOU_LIST)){var t=this._model.getJinJieRiArr();var e=true;for(var i=0;i<t.length;i++){if(t[i].state==1||t[i].state==3){e=false}}if(e){activitytaren.ActivityTaRenModel.getIns().setCustRed(csv.FunctionsProxy.ENUMS.LING_YUAN_GOU_LIST,false)}}this.animationzhanshi.play();this.animationzhuangshi.play();this.btnqianggou.on(Laya.Event.CLICK,this,this.onClick);app.ViewManager.toggleView(main.MoneyView,this,1);this._model.on(n.ZeroShoppingEvent.ZERO_SHOPPING_REFRESH,this,this.refrshNetData);activitytaren.ActivityTaRenModel.getIns().on(activitytaren.ActivityTaRenModel.ACTIVIT_TAREN_EVENT.UPDATE_ACTIVIT_DATA,this,this.refrshNetData);activitytaren.ActivityTaRenModel.getIns().on(activitytaren.ActivityIconStatuManager.EVENT_ACRIVITY_SINGLE_VISIBLE,this,this.onShowHide);this.callLater(this.onGetInfo)};t.prototype.onGetInfo=function(){if(this.functionid){this._model.netData=this.actVo;this.refreshAll()}};t.prototype.onUnDisplay=function(){this.onLeave(this.leaveId);this.leaveId=-1;this.animationzhanshi.stop();this.animationzhuangshi.stop();this._model.selectitemId=undefined;this._model.itemActId=undefined;app.ViewManager.toggleView(main.MoneyView,app.AppContainer.uiLayer,1);this.btnqianggou.off(Laya.Event.CLICK,this,this.onClick);this._model.off(n.ZeroShoppingEvent.ZERO_SHOPPING_REFRESH,this,this.refrshNetData);activitytaren.ActivityTaRenModel.getIns().off(activitytaren.ActivityIconStatuManager.EVENT_ACRIVITY_SINGLE_VISIBLE,this,this.onShowHide);activitytaren.ActivityTaRenModel.getIns().off(activitytaren.ActivityTaRenModel.ACTIVIT_TAREN_EVENT.UPDATE_ACTIVIT_DATA,this,this.refrshNetData);if(this.dataSource[0]=="true"&&game.MoneyModel.getIns().getMoney(game.MoneyModel.MONEY_ENUM.GOLD)>=this.subViewData.cost){game.WindowsResigter.call(csv.FunctionsProxy.ENUMS.LING_YUAN_GOU_LIST)}};t.prototype.refreshAll=function(){this.setTabList();this.refreCellView(this._model.selectTempIndex)};t.prototype.setTabList=function(){this.listyeqian.hScrollBarSkin="";this.listyeqian.array=this._model.getJinJieRiArr();this.listyeqian.selectedIndex=this._model.selectTempIndex};t.prototype.setCellList=function(t){this.effectArr=this._model.getEffect(t).split(";");this.listdaoju.array=this._model.checkAwardByDay(t);this.listdaoju.refresh()};t.prototype.onLeave=function(t){var e=csv.ActivityTarenProxy.getIns().cfgMap[t];if(e){newshangcheng.NewShangChengModel.getIns().delXin(e.tipsid);this.leaveId=this._model.selectitemId}};t.prototype.refreCellView=function(t){main.MoneyView.getIns().setPos(338);this._model.selectitemId=this._model.retArr[t].id;if(this.leaveId==-1){this.leaveId=this._model.selectitemId}else{if(this._model.selectitemId!=this.leaveId){this.onLeave(this.leaveId)}}if(this._model.retArr[t].time>0){this._model.awardTime=game.Context.getServerZeroTime(this._model.retArr[t].time)+ +this._model.retArr[t].dayNum*86400}else{var e=this.actVo.timeVo;this._model.awardTime=e.endTime}this.setCellList(t);var i=this._model.checkDataByDay(t);this.subViewData=i;this.imgname.skin="res/static/yuanbaotehui/"+i.tabStr+".png";this.imgzhanshi.skin="res/static/yuanbaotehui/"+i.itemIcon+".png";this.clipnum.value=i.dayNum;this.clipmoneynum.value=i.backMoney.split("-")[1];this.lingquEffect=false;this.labeltime.visible=true;this.labeltimenum.visible=true;this.itemmoney.visible=false;this.labelmoneynum.visible=false;this.labelmoneynum.text=i.cost+"";this.labeltimenum.x=387;game.RedDotView.removeFrom(this.btnqianggou);if(i.state==0){if(this.labeltimenum.text==""){this.labeltime.text=""}else{this.labeltime.text=app.getLang("活动倒计时:")}this.btnqianggou.disabled=false;if(this.subViewData.isNeedBuy){this.itemmoney.visible=true;this.labelmoneynum.visible=true;this.btnqianggou.label=app.getLang("立即抢购")}else{this.btnqianggou.disabled=true;this.btnqianggou.label=app.getLang("zero_text_01",i.levelLIimit)}}else if(i.state==1){this.lingquEffect=true;this.btnqianggou.disabled=false;if(this.labeltimenum.text==""){this.labeltime.text=""}else{this.labeltime.text=app.getLang("领取元宝倒计时:");this.labeltimenum.x=424}this.btnqianggou.label=app.getLang("领取奖励");game.RedDotView.addTo(this.btnqianggou)}else if(i.state==2){this.btnqianggou.disabled=true;if(this.labeltimenum.text==""){this.labeltime.text=""}else{this.labeltime.text=app.getLang("领取元宝倒计时:");this.labeltimenum.x=424}this.btnqianggou.label=app.getLang("等待领取")}else if(i.state==3){this.lingquEffect=true;this.labeltime.visible=false;this.labeltimenum.visible=false;this.btnqianggou.disabled=false;this.btnqianggou.label=app.getLang("领取元宝");game.RedDotView.addTo(this.btnqianggou)}else if(i.state==4){this.labeltime.visible=false;this.labeltimenum.visible=false;this.btnqianggou.disabled=true;this.btnqianggou.label=app.getLang("已领取")}if(game.Context.getServerTime()<this._model.awardTime){this.activityTimeView.start(this._model.awardTime)}else{this.labeltime.visible=false;this.labeltimenum.visible=false}};t.prototype.refrshNetData=function(){var e=this;activitytaren.ActivityTaRenModel.getIns().getInfoByActID(this._model.itemActId,new Laya.Handler(this,function(t){if(e._model.netData){e._model.netData.info=t;e._model.getJinJieRiArr();e.setTabList();e.refreCellView(e._model.selectTempIndex)}}))};t.prototype.onClick=function(){var t=this;if(this.subViewData.isNeedBuy){if(this.subViewData.state==0){if(game.Context.getServerTime()>=this._model.awardTime){manager.FlowManager.instance.flowByStyle1(app.getLang("活动已结束"));return}if(game.MoneyModel.getIns().getMoney(game.MoneyModel.MONEY_ENUM.GOLD)>=this.subViewData.cost){game.Alert.show(app.getLang("freegift_tips",this.subViewData.cost,app.getLang(this.subViewData.itemStr)),new Laya.Handler(this,function(){activitytaren.ActivityTaRenModel.getIns().lockRed(csv.FunctionsProxy.ENUMS.LING_YUAN_GOU_LIST,false);app.ProtocolRequest.ZeroBuyReq(t._model.selectitemId)}),new Laya.Handler)}else{shop.ShopModel.getIns().askChongZhi()}}else{activitytaren.ActivityTaRenModel.getIns().lockRed(csv.FunctionsProxy.ENUMS.LING_YUAN_GOU_LIST,false);app.ProtocolRequest.RecvActPrizeReq(this._model.selectitemId)}}else{var e=this._isCanLinqu(+this.subViewData.levelLIimit);if(e){activitytaren.ActivityTaRenModel.getIns().lockRed(csv.FunctionsProxy.ENUMS.LING_YUAN_GOU_LIST,false);app.ProtocolRequest.RecvActPrizeReq(this._model.selectitemId)}else{manager.FlowManager.instance.flowByStyle1(app.getLang("等级不足"))}}};t.prototype._isCanLinqu=function(t){for(var e=0;e<game.Context.roleList.length;e++){if(game.Context.roleList[e].level>=t){return true}}return false};t.prototype.hideSubTime=function(){this.activityTimeView.stop();this.labeltime.visible=false;this.labeltimenum.visible=false;this._model.event(n.ZeroShoppingEvent.ZERO_SHOPPING_REFRESH)};t.prototype.endTimeCallBack=function(){this.hideSubTime()};Object.defineProperty(t.prototype,"lingquEffect",{set:function(t){if(t){this.animationbtn.play();this.animationbtn.visible=true}else{this.animationbtn.stop();this.animationbtn.visible=false}},enumerable:true,configurable:true});t.prototype.onShowHide=function(t){if(t.actId==23&&!t.visible){app.ViewManager.toggleDialog(n.ZeroShoppingMainView,-1,0)}};t.SINGLE_KEY="zeroshopping.ZeroShoppingMainView";return t}(ui.lingyuanlibao.lingyuanlibaoUI);n.ZeroShoppingMainView=t})(zeroshopping||(zeroshopping={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var zeroshopping;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this._model=i.ZeroShoppingModel.getIns();this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.on(Laya.Event.CLICK,this,this.onClick);this.btnlingyuanlibao.on(Laya.Event.MOUSE_MOVE,this,this.changeLabSkin);this.btnlingyuanlibao.on(Laya.Event.MOUSE_OUT,this,this.changeLabSkin2)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t,e){this._tempData=t;this._tempIndex=e;if(this.btnlingyuanlibao.selected){this.imgname.skin="lingyuanlibao/"+t.tabIcon+"_xuanzhong"+".png"}else{this.imgname.skin="lingyuanlibao/"+t.tabIcon+".png"}game.RedDotView.removeFrom(this.btnlingyuanlibao);if(t.state==1||t.state==3){game.RedDotView.addTo(this.btnlingyuanlibao)}var i=csv.ActivityTarenProxy.getIns().cfgMap[t.id];if(newshangcheng.NewShangChengModel.getIns().isXinCanShow(i.tipsid)){game.RedDotView.addTo(this,this.width,5,1,1,game.RedDotView.ENUM_TYPE.XIN)}else{game.RedDotView.removeFrom(this)}};e.prototype.onClick=function(){if(!this._tempData){console.log("this._tempData is undefined");return}this._model.selectitemId=this._tempData.id;this._model.itemActId=this._tempData.actId;this._model.selectTempIndex=this._tempIndex};e.prototype.changeLabSkin=function(){if(!this._tempData){console.log("this._tempData is undefined");return}this.imgname.skin="lingyuanlibao/"+this._tempData.tabIcon+"_xuanzhong"+".png"};e.prototype.changeLabSkin2=function(){if(!this._tempData){console.log("this._tempData is undefined");return}if(!this.btnlingyuanlibao.selected){this.imgname.skin="lingyuanlibao/"+this._tempData.tabIcon+".png"}};Object.defineProperty(e.prototype,"lingquEffect",{set:function(t){this.btnlingyuanlibao.selected=t},enumerable:true,configurable:true});e.SINGLE_KEY="zeroshopping.ZeroShoppingTabItem";return e}(ui.lingyuanlibao.lingyuanlibaoitemUI);i.ZeroShoppingTabItem=t})(zeroshopping||(zeroshopping={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var zhanlin;(function(n){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){app.ViewManager.regist(n.ZhanLinTreasureView,"zhanling.atlas");app.ViewManager.regist(n.HuodezhanlingView,"zhanling.atlas");app.ViewManager.regist(n.ZhanlingjiangliView,"zhanling.atlas");app.ViewManager.regist(n.ZhanlingrenwuView,"zhanling.atlas","youjian.atlas");app.ViewManager.regist(n.ZhanlingpaihangView,"zhanling.atlas");app.ViewManager.regist(n.HuodezhanlingView,"zhanling.atlas");app.ViewManager.regist(n.ZhanLingGouMaiDengjiTip,"zhanling.atlas");app.ViewManager.regist(n.ZhanlinggoumaitipView,"zhanling.atlas");app.ViewManager.regist(n.ZhanlingpaihangjiangliView,"zhanling.atlas");app.ViewManager.regist(n.ZhanLinMainView,"zhanling.atlas");game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.ZHAN_LING_TASK,n.ZhanlingrenwuView);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.ZHAN_LING_RANK,n.ZhanlingpaihangView);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.ZHAN_LING_RECHANGE,n.ZhanlingduihuanView);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.ZHAN_LIN_MAIN,n.ZhanlingjiangliView);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.ZHAN_LIN_MAIN_BEI,n.ZhanlingjiangliView,null,game.ECommonType.COMMON_SHANG_CHENG_WITHOUT_BTN);game.TaskModel.getIns().on(game.TaskModel.EVENTS.TASK_REFRESH,this,this.refreshAllRed);csv.FunctionsProxy.getIns().on(csv.FunctionsProxy.EVENTS.CHANGE,this,this.onFunctionChange)};Object.defineProperty(e.prototype,"model",{get:function(){return n.ZhanLinModel.getIns()},enumerable:true,configurable:true});e.prototype.onFunctionChange=function(){if(csv.FunctionsProxy.getIns().isOpen(csv.FunctionsProxy.ENUMS.ZHAN_LING_TASK)){app.ProtocolRequest.WarOrderTaskInfoReq();app.ProtocolRequest.WarOrderInfoReq();csv.FunctionsProxy.getIns().off(csv.FunctionsProxy.EVENTS.CHANGE,this,this.onFunctionChange)}};e.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.WarOrderInfoAck,this,this.onWarOrderInfoAckHandler);this.addMsgListener(app.ProtocolResponse.WarOrderGetRewardAck,this,this.onWarOrderGetRewardAckHandler);this.addMsgListener(app.ProtocolResponse.WarOrderUpGradeAck,this,this.onWarOrderUpGradeAckHandler);this.addMsgListener(app.ProtocolResponse.WarOrderShopInfoAck,this,this.onWarOrderShopInfoAckHandler);this.addMsgListener(app.ProtocolResponse.WarOrderShopBuyAck,this,this.onWarOrderShopBuyAckHandler);this.addMsgListener(app.ProtocolResponse.WarOrderGetExpBagAck,this,this.onWarOrderGetExpBagAckHandler);this.addMsgListener(app.ProtocolResponse.WarOrderRewardInfoAck,this,this.onWarOrderRewardInfoAckHandler);this.addMsgListener(app.ProtocolResponse.WarOrderTaskInfoAck,this,this.onWarOrderTaskInfoAckHandler);this.addMsgListener(app.ProtocolResponse.WarGetTaskRewardAck,this,this.onWarGetTaskRewardAckHandler);this.addMsgListener(app.ProtocolResponse.WarBuyLevelAck,this,this.onWarBuyLevelAckHandler);this.addMsgListener(app.ProtocolResponse.WarBuyExpAck,this,this.onWarBuyExpAck)};e.prototype.onWarBuyExpAck=function(t,e){if(e.result==1){}};e.prototype.onWarBuyLevelAckHandler=function(t,e){if(e.result==1){n.ZhanLinModel.getIns().event(n.ZhanLinModel.EVENT_LEVEL_UP_SUCCEED)}};e.prototype.onWarOrderTaskInfoAckHandler=function(t,e){n.ZhanLinModel.getIns().taskInfo=e;n.ZhanLinModel.getIns().redRefresh();n.ZhanLinModel.getIns().event(n.ZhanLinModel.GET_TASK_INFO)};e.prototype.onWarGetTaskRewardAckHandler=function(t,e){if(e.result){n.ZhanLinModel.getIns().redRefresh();n.ZhanLinModel.getIns().event(n.ZhanLinModel.TASK_LING_QU_END,[e.taskId])}};e.prototype.refreshAllRed=function(){n.ZhanLinModel.getIns().redRefresh()};e.prototype.onWarOrderInfoAckHandler=function(t,e){n.ZhanLinModel.getIns().zhanLinVo.setData(e);n.ZhanLinModel.getIns().once(n.ZhanLinModel.EVENT_ZHANLING_REWARD_INFO,this,this.onRewardInfo);app.ProtocolRequest.WarOrderRewardInfoReq()};e.prototype.onRewardInfo=function(){n.ZhanLinModel.getIns().event(n.ZhanLinModel.EVENT_ZHANLIN_INFO_CHANGE);this.refreshAllRed()};e.prototype.onWarOrderGetRewardAckHandler=function(t,e){if(e.result==1){n.ZhanLinModel.getIns().once(n.ZhanLinModel.EVENT_ZHANLING_REWARD_INFO,this,this.getRewardHandler);app.ProtocolRequest.WarOrderRewardInfoReq()}else{}};e.prototype.getRewardHandler=function(){n.ZhanLinModel.getIns().redRefresh();n.ZhanLinModel.getIns().event(n.ZhanLinModel.EVENT_LING_QU_SUCCEED)};e.prototype.onWarOrderUpGradeAckHandler=function(t,e){if(e.result==1){app.ViewManager.toggleDialog(n.HuodezhanlingView,1,0);n.ZhanLinModel.getIns().event(n.ZhanLinModel.EVENT_PAY_GOLD_LEVEL);n.ZhanLinModel.getIns().redRefresh()}else{console.log("==========================>战令进阶失败!!!")}};e.prototype.onWarOrderShopInfoAckHandler=function(t,e){n.ZhanLinModel.getIns().zhanLinVo.shopItemList=e.shopItem;n.ZhanLinModel.getIns().event(n.ZhanLinModel.EVENT_ZHANLING_DUIHUAN_SHOP)};e.prototype.onWarOrderShopBuyAckHandler=function(t,e){if(e.result==1){n.ZhanLinModel.getIns().once(n.ZhanLinModel.EVENT_ZHANLING_DUIHUAN_SHOP,this,this.onGetShopHandler);app.ProtocolRequest.WarOrderShopInfoReq()}else{console.log("onWarOrderShopBuyAckHandler->战令商店兑换失败!")}};e.prototype.onGetShopHandler=function(){n.ZhanLinModel.getIns().event(n.ZhanLinModel.EVENT_EXCHANGE_SUCCEED)};e.prototype.onWarOrderGetExpBagAckHandler=function(t,e){if(e.result==1){var i=n.ZhanLinModel.getIns().zhanLinVo;if(i){i.data.expBagState=0}else{console.error("没有战令数据!!!")}console.log("===================>成功领取每日签到礼包!!!");n.ZhanLinModel.getIns().event(n.ZhanLinModel.EVENT_LINGQU_EVERYDAY_PACKAGE);n.ZhanLinModel.getIns().redRefresh()}};e.prototype.onWarOrderRewardInfoAckHandler=function(t,e){n.ZhanLinModel.getIns().zhanLinVo.rewardStateList=e.rewardState||[];n.ZhanLinModel.getIns().event(n.ZhanLinModel.EVENT_ZHANLING_REWARD_INFO);n.ZhanLinModel.getIns().redRefresh()};e.SINGLE_KEY="zhanlin.ZhanLinModule";return e}(app.ModuleBase);n.ZhanLinModule=t})(zhanlin||(zhanlin={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var zhanlin;(function(l){var t;(function(t){t[t["COMPLETE_NOT_COMITE"]=1]="COMPLETE_NOT_COMITE";t[t["RUNNING"]=2]="RUNNING";t[t["IS_COMITE"]=3]="IS_COMITE"})(t=l.E_TASK_STATUS||(l.E_TASK_STATUS={}));var h;(function(t){t[t["CAN_LING_QU"]=1]="CAN_LING_QU";t[t["NOT_ENOUGH_LING"]=2]="NOT_ENOUGH_LING";t[t["IS_ALREADY_LINGQUED"]=3]="IS_ALREADY_LINGQUED"})(h=l.E_ZHAN_LING_LINGQU_STATUS||(l.E_ZHAN_LING_LINGQU_STATUS={}));var a;(function(t){t[t["NORMAL"]=0]="NORMAL";t[t["RANK_NOT_ENOURH"]=1]="RANK_NOT_ENOURH";t[t["MONEY_NOT_ENOUGH"]=2]="MONEY_NOT_ENOUGH";t[t["WITHOUT_COUNT"]=3]="WITHOUT_COUNT"})(a=l.E_DuiHuanStatus||(l.E_DuiHuanStatus={}));var p;(function(t){t[t["SERVER_CAN_LING_QU"]=0]="SERVER_CAN_LING_QU";t[t["IS_ALREADY_GET_LINGQUED"]=1]="IS_ALREADY_GET_LINGQUED"})(p=l.E_SERVER_ZHAN_LING_LINGQU_STATUS||(l.E_SERVER_ZHAN_LING_LINGQU_STATUS={}));var e=function(e){__extends(o,e);function o(){var t=e!==null&&e.apply(this,arguments)||this;t.dontTips=false;t.debugStatus=undefined;return t}o.getIns=function(){return app.Singleton.getInstance(o)};o.prototype.getMsg=function(t){switch(t){case a.RANK_NOT_ENOURH:return app.getLang("zhanling_text18");case a.MONEY_NOT_ENOUGH:return app.getLang("zhanling_text19");case a.WITHOUT_COUNT:return app.getLang("zhanling_text17")}return t.toString()};o.prototype.getTaskVo=function(t){if(this.taskInfo){var e=this.taskInfo.taskList;if(e){for(var i=0;i<e.length;i++){var n=e[i];if(n.taskId==t){return n}}}}return null};o.prototype.init=function(t){this.time=new l.ZhanLinTimeVo;this.zhanLinVo=new l.ZhanLinVo;var e=game.Config.getParams(1246).split("-");this.buyExp=parseInt(e[1]);this.needPayGold=parseInt(e[2]);this.limitDay=parseFloat(game.Config.getParams(1245))};o.prototype.getTime=function(t){var e=t.split("-");var i=util.TimeUtil.getTimeByDate(parseInt(e[0]),parseInt(e[1]),parseInt(e[2]),parseInt(e[3]),parseInt(e[4]),parseInt(e[5]));return i};o.prototype.onEndHandler=function(){if(game.Config.getIntParams(1226)==1){if(app.ViewManager.DisplayedInStage(l.ZhanlingjiangliView.SINGLE_KEY)||app.ViewManager.DisplayedInStage(l.ZhanlingrenwuView.SINGLE_KEY)){game.WindowsResigter.closeCommon(1)}}this.onHuoDongEvt()};o.prototype.onHuoDongEvt=function(){activitytaren.ActivityTaRenModel.getIns().event(activitytaren.ActivityIconStatuManager.EVENET_ACTIVITY_STATUS_CHANGED);l.ZhanLinModule.getIns().onFunctionChange()};o.prototype.onCheckMainDlgHandler=function(){return this.isOpen()};o.prototype.onCheckStart=function(){if(this.start_t!=0&&this.end_t!=0){if(game.Context.getServerTime()<this.start_t&&!this.isOpen()){Laya.timer.once(1e3,this,this.onCheckStart)}else{this.event(o.EVENT_HUODONG_START);this.onCheckEnd()}}};o.prototype.onCheckEnd=function(){if(this.isOpen()){Laya.timer.once(1e3,this,this.onCheckEnd)}else{this.event(o.EVENT_HUODONG_END)}};o.prototype.isOpen=function(){return csv.FunctionsProxy.getIns().isOpen(csv.FunctionsProxy.ENUMS.ZHAN_LIN_MAIN)};o.prototype.isJiangLiHaveReward=function(){var t=this.zhanLinVo.warorder;for(var e=0;e<t.length;e++){var i=t[e];var n=this.getLingQuStatus(i);if(n.status==h.CAN_LING_QU){return true}}};o.prototype.onRefreshJiangLi=function(){if(this.isJiangLiHaveReward()){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.ZHAN_LING_REWARD);return true}else{game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.ZHAN_LING_REWARD)}};Object.defineProperty(o.prototype,"rankType",{get:function(){return rank.RankModel.TYPE_ENUM.ENMRANKTYPE_ZHAN_LING},enumerable:true,configurable:true});o.prototype.redRefresh=function(){var t=this.onRefreshJiangLi();if(t){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.ZHAN_LIN_MAIN)}else{game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.ZHAN_LIN_MAIN)}};o.prototype.startExchange=function(t,e){var i=parseInt(t);console.log("开始兑换id=%d",i);o.getIns().once(o.EVENT_EXCHANGE_SUCCEED,this,function(){if(e){e.run()}});app.ProtocolRequest.WarOrderShopBuyReq(i)};o.prototype.getLingQuStatus=function(t){var e=0;var i=1;var n={status:h.NOT_ENOUGH_LING,lingQuState1:false,lingQuState2:false,list:[]};if(!this.zhanLinVo.data){return n}var a=this.zhanLinVo.data.lv;if(a<t.level){n.status=h.NOT_ENOUGH_LING;return n}var o=this.getLingQuVo(t);if(!o){if(a>=t.level){n.status=h.CAN_LING_QU;n.list.push(e);if(this.hasWarOrder()){n.list.push(i)}return n}}if(o){if(this.hasWarOrder()){var s=false;if(o.rewardState1==p.SERVER_CAN_LING_QU){n.list.push(e);s=true}var r=false;if(o.rewardState2==p.SERVER_CAN_LING_QU){n.list.push(i);r=true}if(s){n.status=h.CAN_LING_QU}else if(r){n.status=h.CAN_LING_QU}else if(!s&&!r){n.status=h.IS_ALREADY_LINGQUED}if(o.rewardState1==p.SERVER_CAN_LING_QU){n.lingQuState1=false}else{n.lingQuState1=true}if(o.rewardState2==p.SERVER_CAN_LING_QU){n.lingQuState2=false}else{n.lingQuState2=true}}else{if(o.rewardState1==p.SERVER_CAN_LING_QU){n.list.push(e);n.status=h.CAN_LING_QU;n.lingQuState1=false}else{n.status=h.IS_ALREADY_LINGQUED;n.lingQuState1=true}n.lingQuState2=false}}return n};o.prototype.getLingQuVo=function(t){if(this.zhanLinVo){var e=this.zhanLinVo.rewardStateList;if(e){for(var i=0;i<e.length;i++){var n=e[i];if(n.lv==t.level){return n}}}}};o.prototype.getBuyCnt=function(t){var e=this.zhanLinVo;if(e.shopItemList){var i=this.zhanLinVo.getShopVo(t.ID);if(i){return i.progress}}return 0};o.prototype.getSubCnt=function(t){var e=parseInt(t.numlimit)-this.getBuyCnt(t);return e};o.prototype.hasWarOrder=function(){if(this.zhanLinVo.data){return this.zhanLinVo.data.buyProgress==1}return false};o.prototype.curRankList=function(){var t=[];for(var e=0;e<20;e++){var i=new l.ZhanLinRankVo;i.rank=e+1;i.titleId=e+1;i.name="玩家"+e;i.zlLv=e+1;t.push(i)}return t};o.prototype.getRankList=function(t){t.run()};o.prototype.getTaskLingQuCnt=function(t){if(!this.taskInfo){return 0}if(!this.taskInfo.taskList){return 0}for(var e=0;e<this.taskInfo.taskList.length;e++){var i=this.taskInfo.taskList[e];if(i.taskId==t){return i.GetRewardCount||0}}return 0};o.prototype.getTaskFinishCnt=function(t){var e=game.TaskModel.getIns().getTaskData(t);if(e&&e.data){return e.getNum()}return 0};o.prototype.get_param=function(t){if(t.subtype==csv.TaskProxy.SUBTYPE.GET_GOLD||t.subtype==csv.TaskProxy.SUBTYPE.GET_MONEY){var e=t.param.split("-");return e[1]}return t.param};o.prototype.getDuiHuanStatus=function(t){var e=parseInt(t.ranklimit);if(e!=0){var i=o.getIns().zhanLinVo;if(i.myrank>e){return a.RANK_NOT_ENOURH}}if(!game.GridsModel.getIns().hasEnoughItems(t.cost)){return a.MONEY_NOT_ENOUGH}if(parseInt(t.numlimit)!=0){var n=this.getSubCnt(t);if(n<=0){return a.WITHOUT_COUNT}}return a.NORMAL};o.prototype.checkTask=function(){var t=csv.ZhanLinProxy.getIns().warordertaskList;for(var e=0;e<t.length;e++){var i=t[e];if(i){var n={};this.getTaskStatus(n,i.taskid);if(n.status==l.E_TASK_STATUS.COMPLETE_NOT_COMITE){return true}}}};o.prototype.checkTaskRed=function(){if(this.taskInfo&&this.checkTask()||this.zhanLinVo.isCanTaskLingqu){game.ClosureManager.addDot(csv.FunctionsProxy.ENUMS.ZHAN_LING_TASK);return true}else{game.ClosureManager.removeDot(csv.FunctionsProxy.ENUMS.ZHAN_LING_TASK)}};o.prototype.getPreviousIndex=function(t){if(t-1<0){return 0}return t-1};o.prototype.getLingQuIndex=function(t){for(var e=0;e<t.length;e++){var i=t[e];var n=o.getIns().getLingQuStatus(i);if(n.status==h.CAN_LING_QU){return this.getPreviousIndex(e)}}for(var e=0;e<t.length;e++){var i=t[e];var n=o.getIns().getLingQuStatus(i);if(n.status==h.NOT_ENOUGH_LING){return this.getPreviousIndex(e)}}return 0};o.prototype.getLingQuCfg=function(){var t=this.zhanLinVo.warorder;for(var e=0;e<t.length;e++){var i=t[e];var n=this.getLingQuStatus(i);if(n.status==h.CAN_LING_QU){return i}}};o.prototype.startOneLinQu=function(){var t=this.getLingQuCfg();if(t){this.lingqu(t,this,this.startOneLinQu)}else{this.event(o.EVENT_EXP_CHANGED)}};o.prototype.lingqu=function(t,e,i){o.getIns().once(o.EVENT_LING_QU_SUCCEED,e,i);var n=o.getIns().getLingQuStatus(t);var a=n.list;if(a.length>0){app.ProtocolRequest.WarOrderGetRewardReq(t.level,a)}};o.prototype.getRmb=function(){var t=this.time.getAct();if(t){return csv.RechargeProxy.getIns().cfgMap[t.curCfg.p1]}return csv.RechargeProxy.getIns().getCfgByType(8)};o.prototype.startBuyExp=function(){var t=game.GridsModel.getIns().getItemCount(game.ItemUtil.ENUMS.YUANBAO);if(t<this.needPayGold){shop.ShopModel.getIns().askChongZhi()}else{app.ProtocolRequest.WarBuyExpReq()}};o.prototype.getTaskStatus=function(t,e){t.taskid=e;t.taskVo=null;var i=csv.TaskProxy.getIns().getCfg(e);t.taskCfg=i;var n=csv.ZhanLinProxy.getIns().getTaskCfg(e);t.warTaskCfg=n;if(!i){if(ent.DebugConfig.isDebugger){console.error("任务id = %d 不存在！",e)}t.status=l.E_TASK_STATUS.RUNNING}else{if(!this.taskInfo){t.status=l.E_TASK_STATUS.RUNNING}else{var a=this.getTaskVo(e);if(!a){t.status=l.E_TASK_STATUS.RUNNING}else{var o=t.warTaskCfg;if((a.GetRewardCount||0)>=parseInt(o.limit)){t.status=l.E_TASK_STATUS.IS_COMITE}else{if(a.finishCount<a.GetRewardCount){t.status=l.E_TASK_STATUS.RUNNING}else{if(a.finishCount>a.GetRewardCount){t.status=l.E_TASK_STATUS.COMPLETE_NOT_COMITE}else{var s=parseInt(this.get_param(t.taskCfg));var r=this.getTaskFinishCnt(t.taskid);if(r>=s){t.status=l.E_TASK_STATUS.COMPLETE_NOT_COMITE}else{t.status=l.E_TASK_STATUS.RUNNING}}}}t.taskVo=a}}}};o.SINGLE_KEY="zhanlin.ZhanLinModel";o.EVENT_ZHANLIN_INFO_CHANGE="EVENT_ZHANLIN_INFO_CHANGE";o.EVENT_EXCHANGE_SUCCEED="EVENT_EXCHANGE_SUCCEED";o.EVENT_PAY_GOLD_LEVEL="EVENT_PAY_GOLD_LEVEL";o.EVENT_EXP_CHANGED="EVENT_EXP_CHANGED";o.EVENT_LING_QU_SUCCEED="EVENT_LING_QU_SUCCEED";o.EVENT_ZHANLING_BUY="EVENT_ZHANLING_BUY";o.EVENT_ZHANLING_TASK_LINGQU_SUCCEED="EVENT_ZHANLING_TASK_LINGQU_SUCCEED";o.EVENT_ZHANLING_REWARD_INFO="EVENT_ZHANLING_REWARD_INFO";o.EVENT_ZHANLING_DUIHUAN_SHOP="EVENT_ZHANLING_DUIHUAN_SHOP";o.EVENT_LINGQU_EVERYDAY_PACKAGE="EVENT_LINGQU_EVERYDAY_PACKAGE";o.EVENT_LEVEL_UP_SUCCEED="EVENT_LEVEL_UP_SUCCEED";o.EVENT_HUODONG_END="EVENT_HUODONG_END";o.EVENT_HUODONG_START="EVENT_HUODONG_START";return o}(app.ModelBase);l.ZhanLinModel=e})(zhanlin||(zhanlin={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};Object.defineProperty(e.prototype,"warordertaskList",{get:function(){var t=zhanlin.ZhanLinModel.getIns().zhanLinVo.dayKey;return this.warorderTaskMap[t]},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"warorder",{get:function(){var t=this.getDayKeyByOpenDay();var e=this.warDayMap[t];return e},enumerable:true,configurable:true});e.prototype.init=function(){var t=app.Config.getResById("warorder.csv");this.warDayMap=t.getMapList("day");t=app.Config.getResById("warordershop.csv");this.warorderShopMap=t.getMapList("day");t=app.Config.getResById("warorderrank.csv");this.warorderRankMap=t.getMapList("day");t=app.Config.getResById("warordertask.csv");this.warorderTaskMap=t.getMapList("day")};e.prototype.getRewardList=function(){var t="";var e=zhanlin.ZhanLinModel.getIns().zhanLinVo.warorder;for(var i=0;i<e.length;i++){var n=e[i];t+=n.reward+";"}var a=game.ItemUtil.parserList(t);return game.ItemUtil.hebingItems(a)};e.prototype.getAdvancedrewardList=function(t){var e="";var i=zhanlin.ZhanLinModel.getIns().zhanLinVo.warorder;for(var n=0;n<i.length;n++){var a=i[n];if(t!=undefined){if(t>=a.level){e+=a.advancedreward+";"}}else{e+=a.advancedreward+";"}}var o=game.ItemUtil.parserList(e);var s=game.ItemUtil.hebingItems(o);return this.sortHander(s)};e.prototype.sortHander=function(t){var e=game.Config.getParams(1270).split(";");var i=[];while(e.length>0){var n=parseInt(e.shift());for(var a=0;a<t.length;a++){if(t[a].itemCfg.id==n){i.push(t[a]);t.splice(a,1)}}}while(t.length>0){i.push(t[t.length-1]);t.pop()}return i};e.prototype.getDayKeyByOpenDay=function(){if(!this.dayList){this.dayList=[];for(var t in this.warDayMap){this.dayList.push(parseInt(t))}}var e;var i;var n=game.Context.getOpenServerDay();for(var a=0;a<this.dayList.length;a++){var o=this.dayList[a];if(a<this.dayList.length-1){var s=this.dayList[a+1];if(n>=o&&n<s){i=o;break}}}if(i==undefined){i=this.dayList[this.dayList.length-1]}return i};e.prototype.getTaskCfg=function(t){var e=this.warordertaskList;for(var i=0;i<e.length;i++){var n=e[i];if(n.taskid==t){return n}}};e.prototype.getRewardByRank=function(t){var e=this.getWarorderRankList();for(var i=0;i<e.length;i++){var n=e[i];var a=parseInt(n.rewardlow);var o=parseInt(n.rewardup);if(t>=a&&t<=o){var s=game.ItemUtil.parserList(n.reward);if(s&&s.length>0){return s[0]}}}return null};e.prototype.getWarorderRankList=function(){var t=zhanlin.ZhanLinModel.getIns().zhanLinVo.dayKey;return this.warorderRankMap[t]};e.SINGLE_KEY="csv.ZhanLinProxy";return e}(app.ModelBase);t.ZhanLinProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var zhanlin;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onUnDisplay=function(){this.guangxiao.stop()};Object.defineProperty(e.prototype,"data",{get:function(){return this.dataSource},enumerable:true,configurable:true});e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.refreshAll=function(){var t=this,e=t.zhanlingimg,i=t.guangxiao;e.skin="";i.play()};return e}(ui.zhanling.huodezhanlingUI);t.HuodezhanlingView=e})(zhanlin||(zhanlin={}));var zhanlin;(function(t){var e=function(){function t(t,e,i){this.label=t;this.id=i;e.skin=csv.ItemProxy.getItemSmallIcon(i)}t.prototype.onDisplay=function(){game.MoneyModel.getIns().on(game.MoneyModel.EVENTS.MONEY_CHANGE,this,this.onMoneyHandler);this.refresh()};t.prototype.onUnDisplay=function(){game.MoneyModel.getIns().off(game.MoneyModel.EVENTS.MONEY_CHANGE,this,this.onMoneyHandler)};t.prototype.onMoneyHandler=function(){this.refresh()};t.prototype.refresh=function(){var t=this.id;var e=game.GridsModel.getIns().getItemCount(t);this.label.text=e.toString()};return t}();t.MoneyRefresh=e})(zhanlin||(zhanlin={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var zhanlin;(function(u){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.anniu.clickHandler=new Laya.Handler(this,this.onClickHandler);this.anniu.label=app.getLang("zhanling_text02");this.baoxiangimg.on(Laya.Event.MOUSE_UP,this,this.onMouseUpHandler)};e.prototype.onMouseUpHandler=function(){tip.TipManager.show(this.itemVo)};e.prototype.onClickHandler=function(){if(!this.cfg){return}var t=u.ZhanLinModel.getIns().getDuiHuanStatus(this.cfg);if(t==u.E_DuiHuanStatus.NORMAL){u.ZhanLinModel.getIns().startExchange(this.cfg.ID)}else{manager.FlowManager.instance.flowByStyle1(u.ZhanLinModel.getIns().getMsg(t))}};e.prototype.onDisplay=function(){};e.prototype.onUnDisplay=function(){};e.prototype.setUseIcon=function(t){var e=this,i=e.linpaiimg,n=e.xiaohaolab;var a=app.str2Array(t,"-");var o=parseInt(a[0]);var s=game.ItemUtil.createVO(o);if(s){var r=parseInt(a[1]);s.setCount(r);i.skin=csv.ItemProxy.getItemSmallIcon(o);var l=game.GridsModel.getIns().getItemCount(o);var h=game.STYLES.GREEN_COLOR_S;if(l<r){h=game.STYLES.RED_COLOR_S}n.color=h;n.text=r.toString();this.needItemVo=s}};e.prototype.geticon=function(t){if(t.res==""){return"res/icon/zhanling/bg_zhanling_bx_1.png"}return"res/icon/zhanling/"+t.res+".png"};Object.defineProperty(e.prototype,"sub",{get:function(){return u.ZhanLinModel.getIns().getSubCnt(this.cfg)},enumerable:true,configurable:true});e.prototype.setData=function(t,e){this.cfg=t;this.index=e;var i=this,n=i.baoxiangimg,a=i.baoxiangname,o=i.limitshuoming,s=i.xiangoushuzhi,r=i.xiangoubox;n.skin=this.geticon(t);var l=game.ItemUtil.createVO(parseInt(t.reward));this.itemVo=l;a.text=l.getName();this.setUseIcon(t.cost);var h=false;if(t.ranklimit==0){o.text="";h=true}else{var p=u.ZhanLinModel.getIns().zhanLinVo;if(p.myrank!=0&&p.myrank<=t.ranklimit){o.color=game.STYLES.GREEN_COLOR_S;o.text="";h=true}else{o.color=game.STYLES.GREEN_COLOR_S;o.text=app.getLang("zhanling_text07",t.ranklimit)}}this.boxxiaohao.visible=h;if(u.ZhanLinModel.getIns().getDuiHuanStatus(this.cfg)==u.E_DuiHuanStatus.NORMAL){this.anniu.gray=false}else{this.anniu.gray=true}if(parseInt(t.numlimit)==0){r.visible=false}else{r.visible=true;s.text=app.getLang("zhanling_text08",this.sub,t.numlimit)}};return e}(ui.zhanling.zhanlingduihuanitemnewUI);u.ZhanlingduihuanitemView=t})(zhanlin||(zhanlin={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var zhanlin;(function(i){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.jianglist.itemRender=i.ZhanlingduihuanitemView;this.jianglist.renderHandler=new Laya.Handler(this,this.onRenderHandler);this.jianglist.repeatX=this.jianglist.repeatY=0;this.moneyRefresh=new i.MoneyRefresh(this.shuzhi2,this.daoju2,game.ItemUtil.ENUMS.ZHAN_LING)};e.prototype.onRenderHandler=function(t,e){t.setData(t.dataSource,e)};e.prototype.onDisplay=function(){this.onExchangeHandler();this.moneyRefresh.onDisplay();game.MoneyModel.getIns().on(game.MoneyModel.EVENTS.MONEY_CHANGE,this,this.onMoneyHandler);i.ZhanLinModel.getIns().on(i.ZhanLinModel.EVENT_EXCHANGE_SUCCEED,this,this.onExchangeHandler);i.ZhanLinModel.getIns().once(i.ZhanLinModel.EVENT_ZHANLING_DUIHUAN_SHOP,this,this.onGetShopHandler);app.ProtocolRequest.WarOrderShopInfoReq()};e.prototype.onGetShopHandler=function(){rank.RankModel.getIns().once(rank.RankModel.RANK_DATA_CHANGE,this,this.getGetRankHandler);app.ProtocolRequest.GetRankListReq(i.ZhanLinModel.getIns().rankType)};e.prototype.getGetRankHandler=function(t){if(t==i.ZhanLinModel.getIns().rankType){var e=rank.RankModel.getIns().getRankInfo(t);this.callLater(this.refreshAll)}};e.prototype.onExchangeHandler=function(){this.refreshAll()};e.prototype.onMoneyHandler=function(){this.refreshAll()};e.prototype.onUnDisplay=function(){this.moneyRefresh.onUnDisplay();game.MoneyModel.getIns().off(game.MoneyModel.EVENTS.MONEY_CHANGE,this,this.onMoneyHandler);i.ZhanLinModel.getIns().off(i.ZhanLinModel.EVENT_EXCHANGE_SUCCEED,this,this.onExchangeHandler)};e.prototype.refreshAll=function(){this.jianglist.array=csv.ZhanLinProxy.getIns().warorderShopMap[i.ZhanLinModel.getIns().zhanLinVo.dayKey]};return e}(ui.zhanling.zhanlingduihuannewUI);i.ZhanlingduihuanView=t})(zhanlin||(zhanlin={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var zhanlin;(function(v){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.offset=1;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listwuping.itemRender=grids.GridView;this.listwuping.renderHandler=grids.GridView.CommonItemRender;this.listwuping.hScrollBarSkin="";this.listwuping.vScrollBarSkin=" ";this._numChoose=new game.NumChoose(this.btnjian,this.btnjia,this.labelshuzi,this.btnzuida);this._numChoose.init();this._numChoose.on(game.NumChoose.VALUE_CHANGE,this,this.onValueChange);this.btngoumai.clickHandler=new Laya.Handler(this,this.onGouMaiHandler)};t.prototype.onValueChange=function(){this.offset=this._numChoose.currValue;this.refreshAll()};Object.defineProperty(t.prototype,"curLevel",{get:function(){var t=v.ZhanLinModel.getIns().zhanLinVo;return t.level},enumerable:true,configurable:true});t.prototype.onSucceedHandler=function(t){app.ViewManager.toggleDialog(v.ZhanlinggoumaitipView,1,0,[t,this.offset]);this.close()};t.prototype.onGouMaiHandler=function(){if(game.GridsModel.getIns().hasEnoughItems(this.needMoney)){v.ZhanLinModel.getIns().once(v.ZhanLinModel.EVENT_LEVEL_UP_SUCCEED,this,this.onSucceedHandler,[this.curLevel]);app.ProtocolRequest.WarBuyLevelReq(this.offset)}else{shop.ShopModel.getIns().askChongZhi(false,new Laya.Handler(this,this.close))}};t.prototype.onDisplay=function(){this.reset();this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){};t.prototype.reset=function(){this.offset=1;this._numChoose.currValue=this.offset;var t=csv.ZhanLinProxy.getIns().warDayMap[csv.ZhanLinProxy.getIns().getDayKeyByOpenDay()];var e=v.ZhanLinModel.getIns().zhanLinVo;var i=e.level;this._numChoose.maxValue=t.length-i};t.prototype.onSortHandler=function(t,e){if(t.itemCfg.qua>e.itemCfg.qua){return-1}else if(t.itemCfg.qua<e.itemCfg.qua){return 1}return 0};t.prototype.refreshAll=function(){var t=v.ZhanLinModel.getIns().zhanLinVo;var e=t.level;var i=csv.ZhanLinProxy.getIns().getDayKeyByOpenDay();var n=csv.ZhanLinProxy.getIns().warDayMap[i];var a=[];var o=[];for(var s=0;s<n.length;s++){var r=n[s];if(r.level>e&&r.level<=e+this.offset){var l=game.ItemUtil.parserList(r.reward);for(var h=0;h<l.length;h++){o.push(l[h])}if(v.ZhanLinModel.getIns().hasWarOrder()){var p=game.ItemUtil.parserList(r.advancedreward);for(var u=0;u<p.length;u++){o.push(p[u])}}var c=game.ItemUtil.parserList(r.price);for(var g=0;g<c.length;g++){a.push(c[g])}}}this._numChoose.currValue=this.offset;this._numChoose.setCurrValue();this.labelmiaoshu.text=app.getLang("zhanling_goumai",e,this.offset+e);var f=game.ItemUtil.hebingItems(o);f=f.sort(this.onSortHandler);this.listwuping.array=f;a=game.ItemUtil.hebingItems(a);var d=a[0];var y=d.getItemId()+"-"+d.count;this.needMoney=y;this.huohi.parserIcon(y);this.labelhuaxiao.text=d.count.toString();if(game.GridsModel.getIns().hasEnoughItems(y)){this.labelhuaxiao.color=game.STYLES.YELLOW_YB_COLOR_S}else{this.labelhuaxiao.color=game.STYLES.RED_COLOR_S}};t.SINGLE_KEY="zhanlin.ZhanLingGouMaiDengjiTip";return t}(ui.zhanling.zhanlinggoumaidengjitipUI);v.ZhanLingGouMaiDengjiTip=t})(zhanlin||(zhanlin={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var zhanlin;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.quedingbtn.clickHandler=new Laya.Handler(this,this.close)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){var t=this.dataSource[0];this.dengjiclip1.value=t.toString();this.dengjiclip2.value=(t+parseInt(this.dataSource[1])).toString()};e.SINGLE_KEY="zhanlin.ZhanlinggoumaitipView";return e}(ui.zhanling.zhanlinggoumaitipUI);t.ZhanlinggoumaitipView=e})(zhanlin||(zhanlin={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var zhanlin;(function(s){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.funcid=csv.FunctionsProxy.ENUMS.ZHAN_LIN_MAIN;return t}t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.lingqubtn.clickHandler=new Laya.Handler(this,this.onLingQuHandler);this.jinduItem=new i(this.jindu)};t.prototype.onLingQuHandler=function(){if(!csv.FunctionsProxy.getIns().isOpen(this.funcid,true)){return}if(this.lingqubtn.label==app.getLang("jixulingqu")){app.ViewManager.toggleDialog(s.ZhanLinTreasureView,1,0)}else{this.model.startOneLinQu()}};t.prototype.onLingQuRefresh=function(){this.setData(this.cfg,this.index)};t.prototype.onUnDisplay=function(){};t.prototype.onDisplay=function(){t.itemHeight=this.height};t.prototype.onExpChangeHander=function(){this.setData(this.cfg,this.index)};t.prototype.lingQuState1=function(t){this.lingqu1.visible=t};t.prototype.lingQuState2=function(t){this.lingqu2.visible=this.lingqu3.visible=t};Object.defineProperty(t.prototype,"model",{get:function(){return s.ZhanLinModel.getIns()},enumerable:true,configurable:true});t.prototype.setData=function(t,e){this.index=e;this.cfg=t;this.lingqu.text="";this.lingqubtn.visible=false;this.gezi1.setData(game.ItemUtil.parserList(t.reward)[0]);this.gezi1.setCntScale(this.gezi1.scaleX);var i=game.ItemUtil.parserList(t.advancedreward);this.gezi2.setData(i[0]);this.gezi2.setCntScale(this.gezi2.scaleX);this.gezi3.setData(i[1]);this.gezi3.setCntScale(this.gezi3.scaleX);this.jinduItem.setData(t);var n=this.model.zhanLinVo.getExp(t.level);this.wenben.text=n.toString();var a=this.model.getLingQuStatus(t);var o=a.status;this.lingQuState1(a.lingQuState1);this.lingQuState2(a.lingQuState2);switch(o){case s.E_ZHAN_LING_LINGQU_STATUS.CAN_LING_QU:this.yiqingqu.visible=false;this.lingqubtn.visible=true;this.lingqubtn.mouseEnabled=true;this.lingqubtn.visible=true;this.lingqubtn.gray=false;this.lingqubtn.label=app.getLang("guild_btn2");game.RedDotView.addTo(this.lingqubtn);break;case s.E_ZHAN_LING_LINGQU_STATUS.IS_ALREADY_LINGQUED:if(a.lingQuState1&&!a.lingQuState2){this.yiqingqu.visible=false;this.lingqubtn.mouseEnabled=true;this.lingqubtn.visible=true;this.lingqubtn.gray=false;this.lingqubtn.visible=true;this.lingqubtn.label=app.getLang("jixulingqu");game.RedDotView.removeFrom(this.lingqubtn)}else{this.yiqingqu.visible=true;this.lingqubtn.visible=false}break;case s.E_ZHAN_LING_LINGQU_STATUS.NOT_ENOUGH_LING:game.RedDotView.removeFrom(this.lingqubtn);this.yiqingqu.visible=false;this.lingqubtn.visible=false;this.lingqubtn.mouseEnabled=false;this.lingqu.text=app.getLang("xinshangcheng_10",n);this.lingqubtn.gray=true;this.lingqubtn.label=app.getLang("guild_btn2");break}};t.itemHeight=0;return t}(ui.xinshangcheng2.zhanlingitemnewUI);s.Zhanlingjiangliitem1View=t;var i=function(){function t(t){this.skin=t}Object.defineProperty(t.prototype,"vo",{get:function(){return s.ZhanLinModel.getIns().zhanLinVo},enumerable:true,configurable:true});t.prototype.showYuan=function(t){if(t){this.skin.yuan.skin="res/static/xinshangcheng2/bg_zl_yuan_2.png"}else{this.skin.yuan.skin="res/static/xinshangcheng2/bg_zl_yuan_1.png"}};t.prototype.setData=function(t){var e=this.vo.getZhanLinCellVo(t);if(e.progressTop==-1){this.skin.jindutiao.visible=false}else{this.skin.jindutiao.visible=true;this.skin.jindutiao.value=e.progressTop}if(e.progressBottom==-1){this.skin.jindutiao2.visible=false}else{this.skin.jindutiao2.visible=true;this.skin.jindutiao2.value=e.progressBottom}this.showYuan(e.showBall)};return t}()})(zhanlin||(zhanlin={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var zhanlin;(function(o){var i=activitytaren.ActivityTimeView;var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};Object.defineProperty(e.prototype,"zhanLiVo",{get:function(){return o.ZhanLinModel.getIns().zhanLinVo},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"funcid",{get:function(){return csv.FunctionsProxy.ENUMS.ZHAN_LIN_MAIN},enumerable:true,configurable:true});e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listliebiao.itemRender=o.Zhanlingjiangliitem1View;this.listliebiao.renderHandler=new Laya.Handler(this,this.onRenderHandler);this.listliebiao.scrollBar.on(Laya.Event.CHANGE,this,this.onListChangleHandler);this.timeview=new i(this.daojishi,new Laya.Handler(this,this.timeEndHander),app.getLang("zhanling_text04"),null,activitytaren.ActivityTimeView.TYPE_LIMIT_DAY);this.goumaibtn.clickHandler=new Laya.Handler(this,this.onHuodeDengJiHandler);this.qianwang.on(Laya.Event.CLICK,this,this.onQianWang);this.goumai.on(Laya.Event.CLICK,this,this.onGouMaiJiFeng);game.HelperViewHandler.register(this.funcid,[this.wenhao])};e.prototype.onGouMaiJiFeng=function(){if(!csv.FunctionsProxy.getIns().isOpen(this.funcid,true)){return}var t=this.model.zhanLinVo.getExp(this.zhanLiVo.warorder[this.zhanLiVo.warorder.length-1].level);if(this.model.zhanLinVo.allExp>=t){manager.FlowManager.instance.flowByStyle1(app.getLang("zhanling_text22"));return}if(this.model.dontTips){this.model.startBuyExp()}else{app.ViewManager.toggleDialog(o.ZhanLinAlert,1,0)}};e.prototype.checkGouMaiTime=function(){if(app.ViewManager.DisplayedInStage(e.SINGLE_KEY)){var t=this.model.limitDay;if(this.subTicket>t*86400){this.goumai.visible=false}else{this.goumai.visible=true}this.subTicket--;Laya.timer.once(1e3,this,this.checkGouMaiTime)}};e.prototype.onQianWang=function(){if(csv.FunctionsProxy.getIns().isOpen(this.funcid,true)){game.ClosureManager.callFunctionByNpcOpen(csv.FunctionsProxy.ENUMS.DAILY_TASK)}};e.prototype.onListChangleHandler=function(){var t=this.listliebiao.scrollBar.value;var e=(this.listliebiao.height+t)/o.Zhanlingjiangliitem1View.itemHeight;var i=Math.floor(e);if(i+1>=this.zhanLiVo.warorder.length){i--}for(var n=i+1;n<this.zhanLiVo.warorder.length;n++){var a=this.zhanLiVo.warorder[n];if(a.grandreward==1){this.dandu.setData(a,n);break}}};e.prototype.onHuodeDengJiHandler=function(){if(!csv.FunctionsProxy.getIns().isOpen(this.funcid,true)){return}if(this.model.hasWarOrder()){this.onOkHandler()}else{if(this.subTicket<this.model.limitDay*86400){var t=this.subTicket/86400;game.Alert.show(app.getLang("xinshangcheng_11",Math.ceil(t)),new Laya.Handler(this,this.onOkHandler))}else{this.onOkHandler()}}};e.prototype.onOkHandler=function(){app.ViewManager.toggleDialog(o.ZhanLinTreasureView,1,0)};e.prototype.onYiJiangLinquHandler=function(){o.ZhanLinModel.getIns().startOneLinQu()};e.prototype.onExpHandler=function(){o.ZhanLinMainView.getIns().selectByFuncid(csv.FunctionsProxy.ENUMS.ZHAN_LING_TASK)};e.prototype.timeEndHander=function(){};e.prototype.onRenderHandler=function(t,e){t.setData(t.dataSource,e)};e.prototype.onUnDisplay=function(){game.RoleModel.getIns().off(game.RoleModel.EVENTS.KUAI_TIAN,this,this.onKuaTianClear);o.ZhanLinModel.getIns().off(o.ZhanLinModel.EVENT_ZHANLIN_INFO_CHANGE,this,this.onGetInfo);o.ZhanLinModel.getIns().off(o.ZhanLinModel.EVENT_EXP_CHANGED,this,this.onExpChangeHander);o.ZhanLinModel.getIns().off(o.ZhanLinModel.EVENT_ZHANLING_BUY,this,this.onZhanLingBuyHandler);o.ZhanLinModel.getIns().off(o.ZhanLinModel.EVENT_PAY_GOLD_LEVEL,this,this.onBuyRefresh);o.ZhanLinModel.getIns().off(o.ZhanLinModel.EVENT_LING_QU_SUCCEED,this,this.onSucceedHandler);this.setBtnEffect(false);this.timeview.stop()};e.prototype.onSucceedHandler=function(){this.refreshAll()};e.prototype.onDisplay=function(){o.ZhanLinModel.getIns().on(o.ZhanLinModel.EVENT_LING_QU_SUCCEED,this,this.onSucceedHandler);o.ZhanLinModel.getIns().on(o.ZhanLinModel.EVENT_EXP_CHANGED,this,this.onExpChangeHander);o.ZhanLinModel.getIns().on(o.ZhanLinModel.EVENT_ZHANLING_BUY,this,this.onZhanLingBuyHandler);o.ZhanLinModel.getIns().on(o.ZhanLinModel.EVENT_PAY_GOLD_LEVEL,this,this.onBuyRefresh);o.ZhanLinModel.getIns().on(o.ZhanLinModel.EVENT_ZHANLIN_INFO_CHANGE,this,this.onGetInfo);game.RoleModel.getIns().on(game.RoleModel.EVENTS.KUAI_TIAN,this,this.onKuaTianClear);app.ProtocolRequest.WarOrderInfoReq()};e.prototype.onKuaTianClear=function(){};e.prototype.onBuyRefresh=function(){this.refreshAll()};e.prototype.onGetInfo=function(){this.callLater(this.callLaterHandler)};e.prototype.callLaterHandler=function(){this.refreshAll();var t=this.zhanLiVo.warorder;if(t.length>0){this.listliebiao.scrollTo(this.model.getLingQuIndex(t))}};Object.defineProperty(e.prototype,"model",{get:function(){return o.ZhanLinModel.getIns()},enumerable:true,configurable:true});e.prototype.onZhanLingBuyHandler=function(){this.refreshAll()};e.prototype.onExpChangeHander=function(){this.refreshAll()};e.prototype.setLevel=function(t){this.fenshu.value=t.allExp.toString()};e.prototype.setCurExp=function(){var t=o.ZhanLinModel.getIns().zhanLinVo;this.setLevel(t);var e=t.status;switch(e){case o.ZhanLinVo.STATUS_MAX_LEVEL:break;case o.ZhanLinVo.STZTUS_ZERO:case o.ZhanLinVo.STATUS_NORMAL:break}};e.prototype.getShowList=function(){var t=this.zhanLiVo.warorder;var e=[];var i=0;if(t[t.length-1].grandreward==1){i=t[t.length-1].level}for(var n=0;n<t.length;n++){var a=t[n];if(a.level!=i){e.push(a)}}return e};e.prototype.setBtnEffect=function(t){if(t){this.guangxiao.visible=true;this.guangxiao.play(0,true)}else{this.guangxiao.visible=false;this.guangxiao.stop()}};e.prototype.refreshAll=function(){this.listliebiao.array=this.getShowList();this.onListChangleHandler();var t=o.ZhanLinModel.getIns().time.endTime;this.subTicket=t-game.Context.getServerTime();this.checkGouMaiTime();this.timeview.start(t);this.setBtnEffect(false);this.suo.visible=o.ZhanLinModel.getIns().hasWarOrder()==false;if(o.ZhanLinModel.getIns().hasWarOrder()){this.goumaibtn.label=app.getLang("zhanling_text20")}else{this.goumaibtn.label=app.getLang("zhanling_text16",app.convert_Yuan(o.ZhanLinModel.getIns().getRmb().recharge));this.setBtnEffect(true)}this.setCurExp()};e.SINGLE_KEY="zhanlin.ZhanlingjiangliView";return e}(ui.xinshangcheng2.zhanlingnewUI);o.ZhanlingjiangliView=t;var e=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.fullScreen="";return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.cancelBtn.clickHandler=new Laya.Handler(this,this.onCloseHandler);this.quedingbtn.clickHandler=new Laya.Handler(this,this.onOkHandler);this.gouxuan.clickHandler=new Laya.Handler(this,this.onGouXuan);this.gouxuan.visible=true};t.prototype.onGouXuan=function(){this.model.dontTips=this.gouxuan.selected};t.prototype.onDisplay=function(){this.label03.text=app.getLang("xinshangcheng_12",this.model.needPayGold,this.model.buyExp)};Object.defineProperty(t.prototype,"model",{get:function(){return o.ZhanLinModel.getIns()},enumerable:true,configurable:true});t.prototype.onOkHandler=function(){this.model.startBuyExp();this.onCloseHandler()};t.prototype.onCloseHandler=function(){app.ViewManager.toggleDialog(o.ZhanLinAlert,-1)};t.SINGLE_KEY="zhanlin.ZhanLinAlert";return t}(ui.alert.zhanlinalertUI);o.ZhanLinAlert=e})(zhanlin||(zhanlin={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var zhanlin;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){};e.prototype.refreshAll=function(){};e.prototype.setData=function(t){this.data=t;var e=this,i=e.labelpaiming,n=e.imgtouxian,a=e.labelname,o=e.labelliliannum,s=e.gezi;i.text=t.rank.toString();n.skin=t.titleSkin;a.text=t.name;o.text=t.zlLv.toString();s.setData(t.curReward)};e.prototype.setRankData=function(t,e){var i=rank.RankModel.getIns().getRankNum(e,t.uid);var n=this,a=n.labelpaiming,o=n.imgtouxian,s=n.labelname,r=n.labelliliannum,l=n.gezi;a.text=i.toString();o.skin=csv.TitleProxy.getIns().getNobleSkin(t.headtitle);s.text=t.name||"";r.text=t.value.toNumber().toString();var h=csv.ZhanLinProxy.getIns().getRewardByRank(i);l.setData(h)};return e}(ui.zhanling.zhanlingpaihangitemUI);t.Zhanlingpaihangitem=e})(zhanlin||(zhanlin={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var zhanlin;(function(t){var i=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onDisplay=function(){};e.prototype.onUnDisplay=function(){};e.prototype.setData=function(t){if(parseInt(t.rewardlow)==1){this.lapelpaiming.text=app.getLang("zhanling_paiming",t.rewardlow)}else{this.lapelpaiming.text=app.getLang("zhanling_paiming1",t.rewardlow,t.rewardup)}var e=game.ItemUtil.parserList(t.reward);if(e.length>0){this.gezi.setData(e[0])}};return e}(ui.zhanling.zhanlingpaihangbangjiangliitemUI);var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listjiangli.renderHandler=new Laya.Handler(this,this.onRenderHander);this.listjiangli.itemRender=i};e.prototype.onRenderHander=function(t,e){t.setData(t.dataSource)};e.prototype.onDisplay=function(){this.listjiangli.array=csv.ZhanLinProxy.getIns().getWarorderRankList()};e.prototype.onUnDisplay=function(){};e.SINGLE_KEY="zhanlin.ZhanlingpaihangjiangliView";return e}(ui.zhanling.zhanlingpaihangjiangliviewUI);t.ZhanlingpaihangjiangliView=e})(zhanlin||(zhanlin={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var zhanlin;(function(l){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}Object.defineProperty(e.prototype,"rankType",{get:function(){return l.ZhanLinModel.getIns().rankType},enumerable:true,configurable:true});e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listpaihangbang.itemRender=l.Zhanlingpaihangitem;this.listpaihangbang.renderHandler=new Laya.Handler(this,this.onRenderHandler);this.labelliliannum.removeSelf();this.imgpaihangjiangli.on(Laya.Event.MOUSE_UP,this,this.onPaiHangEvt)};e.prototype.onPaiHangEvt=function(){app.ViewManager.toggleDialog(l.ZhanlingpaihangjiangliView,1,0)};e.prototype.onRenderHandler=function(t,e){t.setRankData(t.dataSource,this.rankType)};e.prototype.getGetRankHandler=function(t){if(t==this.rankType){this.callLater(this.refreshAll)}};e.prototype.onDisplay=function(){rank.RankModel.getIns().once(rank.RankModel.RANK_DATA_CHANGE,this,this.getGetRankHandler);app.ProtocolRequest.GetRankListReq(this.rankType)};e.prototype.onUnDisplay=function(){this.removeAvatar()};e.prototype.removeAvatar=function(){if(this.skt&&this.skt.parent){this.skt.stop()}};e.prototype.refreshAll=function(){var t=this,e=t.itemtouxiang,i=t.labelpaimingnum,n=t.labellilian,a=t.labelliliannum;var o=l.ZhanLinModel.getIns().zhanLinVo;if(game.Context.roleList.length>0){var s=game.Context.roleList[0];e.imgtouxiang.skin=s.getHeadIconUrl()}if(o.myrank==0){i.text=app.getLang("zhanling_text09")}else{i.text=o.myrank.toString()}var r=o.rankReward;if(r){this.gezi.setData(r);this.gezi.visible=true}else{this.gezi.visible=false}n.text=app.getLang("zhanling_text12",o.level);this.getRankBack()};e.prototype.getRankBack=function(){var t=rank.RankModel.getIns().getRankInfo(this.rankType);var e=t.rankList;this.listpaihangbang.array=e;var i=this,n=i.imgjuese,a=i.labelname,o=i.imgchenghao;if(e.length>0){this.removeAvatar();var s=e[0];var r=s.classskin;var l=csv.DefclassProxy.getIns().getCfg(r).model;if(this.skt&&this.skt.parent){this.skt.removeSelf()}else{this.skt=new common.CSkt}this.skt.init(role.RoleVO.getSkinSkt(l));this.skt.x=n.x;this.skt.y=n.y;this.skt.scale(.4,.4);this.addChild(this.skt);a.text=s.name;o.skin=csv.TitleProxy.getIns().getNobleSkin(s.headtitle)}else{this.removeAvatar();a.text="";o.skin=""}};return e}(ui.zhanling.zhanlingpaihangnewUI);l.ZhanlingpaihangView=t})(zhanlin||(zhanlin={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var zhanlin;(function(_){var t=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.initialize=function(){e.prototype.initialize.call(this);this.vo={};this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.qianwangbtn.clickHandler=new Laya.Handler(this,this.onQianWangHandler);var t=this.lingqubtn;t.clickHandler=new Laya.Handler(this,this.onLingQuHandler);game.RedDotView.addTo(t)};t.prototype.onQianWangHandler=function(){if(this.cfg.client_params){if(this.cfg.client_params==csv.FunctionsProxy.ENUMS.REFINE_HOUSE.toString()){game.ClosureManager.callFunction(csv.FunctionsProxy.ENUMS.REFINE_HOUSE,true,false,"1")}else{game.ClosureManager.callFunction(parseInt(this.cfg.client_params))}}else{if(ent.DebugConfig.isDebugger)console.error("task.csv id = %s 的字段client_params没有值!",this.cfg.task_id)}};t.prototype.onLingQuHandler=function(){if(this.vo)app.ProtocolRequest.WarGetTaskRewardReq(this.vo.taskid)};t.prototype.onDisplay=function(){};t.prototype.onUnDisplay=function(){};t.prototype.get_param=function(t){return _.ZhanLinModel.getIns().get_param(t)};t.prototype.getIsAlreadyCnt=function(){if(!this.vo){return 0}return _.ZhanLinModel.getIns().getTaskLingQuCnt(this.vo.taskid)};t.prototype.getLeftCnt=function(t,e){var i=parseInt(this.get_param(t));if(e>i){return i}return e};t.prototype.setData=function(t){_.ZhanLinModel.getIns().getTaskStatus(this.vo,t);var e=this.vo.taskCfg;this.cfg=e;var i=this,n=i.shuominglab,a=i.cishilab,o=i.tiaojianlab,s=i.shuzhiclip;var r=this.vo.warTaskCfg;if(!r){console.error("配置warordertask.csv id = %d 不存在!",e.task_id);return}var l=_.ZhanLinModel.getIns().getTaskFinishCnt(this.vo.taskid);if(this.vo.status==_.E_TASK_STATUS.COMPLETE_NOT_COMITE){l=parseInt(this.get_param(e))}var h=this.getLeftCnt(e,l);var p=app.getLang(" ({0}/{1})",game.MoneyModel.format(h),game.MoneyModel.format(parseInt(this.get_param(e))));if(_.ZhanLinModel.getIns().debugStatus){p+="-"+e.task_id+","+this.vo.status}n.text=r.name2||"name2 = null";var u=false;if(parseInt(r.limit)==0){a.text=""}else{var c=this.getIsAlreadyCnt();a.text=app.getLang("zhanling_text11",c,r.limit);if(c<parseInt(r.limit)){u=true}}o.text=e.name;if(u){this.cnt.visible=true;this.cnt.text=p;this.cnt.x=this.tiaojianlab.x+this.tiaojianlab.textField.textWidth;this.cnt.color=game.STYLES.GREEN_COLOR_S}else{this.cnt.visible=false}s.value=app.str2Array(r.reward,"-")[1];var g=this,f=g.yilingquimg,d=g.lingqubtn,y=g.qianwangbtn;var v=this.vo.status;switch(v){case _.E_TASK_STATUS.RUNNING:f.visible=false;if(e.client_params){d.gray=false;d.visible=false;y.gray=false;y.visible=true}else{d.visible=true;d.gray=true;d.mouseEnabled=false;y.visible=false;game.RedDotView.removeFrom(d)}break;case _.E_TASK_STATUS.IS_COMITE:f.visible=true;d.visible=false;y.visible=false;break;case _.E_TASK_STATUS.COMPLETE_NOT_COMITE:f.visible=false;d.gray=false;d.visible=true;d.mouseEnabled=true;game.RedDotView.addTo(d);y.visible=false;break}};return t}(ui.zhanling.zhanlingrenwuitemUI);_.ZhanlingrenwuitemView=t})(zhanlin||(zhanlin={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var zhanlin;(function(h){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.oldTaskList=[];this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.itemList=[];this.oldTaskList=[];this.qiandaobtn.clickHandler=new Laya.Handler(this,this.onLingQuHandler)};e.prototype.onLingQuHandler=function(){if(this.vo.isCanTaskLingqu){h.ZhanLinModel.getIns().once(h.ZhanLinModel.EVENT_LINGQU_EVERYDAY_PACKAGE,this,this.onLingQuPackageHandler);app.ProtocolRequest.WarOrderGetExpBagReq()}};e.prototype.onLingQuPackageHandler=function(){this.onRefreshHandler(false)};e.prototype.onRenderHandler=function(t,e){t.setData(t.dataSource)};Object.defineProperty(e.prototype,"vo",{get:function(){return h.ZhanLinModel.getIns().zhanLinVo},enumerable:true,configurable:true});e.prototype.onDisplay=function(){h.ZhanLinModel.getIns().on(h.ZhanLinModel.EVENT_HUODONG_END,this,this.onEndHandler);h.ZhanLinModel.getIns().once(h.ZhanLinModel.GET_TASK_INFO,this,this.onInitHandler);app.ProtocolRequest.WarOrderTaskInfoReq()};e.prototype.onEndHandler=function(){this.refreshAll()};e.prototype.onInitHandler=function(){h.ZhanLinModel.getIns().on(h.ZhanLinModel.TASK_LING_QU_END,this,this.onTaskSubmitAct);game.TaskModel.getIns().on(game.TaskModel.EVENTS.TASK_REFRESH,this,this.onTaskRefreshHandler);this.callLater(this.refreshAll)};e.prototype.onTaskSubmitAct=function(t){var e=this,i=e.dengjiclip,n=e.shijian,a=e.qiandaobtn;var o=this.vo;i.value=o.level.toString();n.text=o.taskExp+"/"+o.upTaskkExp;this.refreshBtn();if(t>0){var s=void 0;for(var r in this.itemList){if(t==this.itemList[r].vo.taskid){s=this.itemList[r];break}}if(s){s.setData(t);var l=s.vo.status;if(l==h.E_TASK_STATUS.IS_COMITE){Laya.Tween.to(s,{x:s.x-s.width},300,Laya.Ease.quartOut,new Laya.Handler(this,this.onComplete,[s]))}}}};e.prototype.onComplete=function(t){t.removeSelf();Laya.Tween.clearAll(t);Laya.Pool.recover("zhanlin.ZhanlingrenwuitemView",t);var e=csv.ZhanLinProxy.getIns().warordertaskList;if(e.length>0){var i=this.getTaskIdList(e);this.oldTaskList=this.newTaskidList(i);this.baglist.scrollTo(0)}this.cleanItems();this.updateItem()};e.prototype.onTaskRefreshHandler=function(){this.onRefreshHandler(false)};e.prototype.onUnDisplay=function(){h.ZhanLinModel.getIns().off(h.ZhanLinModel.TASK_LING_QU_END,this,this.onTaskSubmitAct);game.TaskModel.getIns().off(game.TaskModel.EVENTS.TASK_REFRESH,this,this.onTaskRefreshHandler);h.ZhanLinModel.getIns().off(h.ZhanLinModel.EVENT_HUODONG_END,this,this.onEndHandler)};e.prototype.refreshAll=function(){this.onRefreshHandler()};e.prototype.sortHandler=function(t,e){var i={};var n={};h.ZhanLinModel.getIns().getTaskStatus(i,t);h.ZhanLinModel.getIns().getTaskStatus(n,e);if(i.status<n.status){return-1}else if(i.status>n.status){return 1}return 0};e.prototype.getTaskIdList=function(t){var e=[];for(var i=0;i<t.length;i++){e.push(t[i].taskid)}return e};e.prototype.newTaskidList=function(t){var e=[];var i;for(i=0;i<t.length;i++){var n={};h.ZhanLinModel.getIns().getTaskStatus(n,t[i]);if(n.status==h.E_TASK_STATUS.COMPLETE_NOT_COMITE){e.push(t[i])}}for(i=0;i<t.length;i++){var n={};var a=t[i];h.ZhanLinModel.getIns().getTaskStatus(n,a);if(n.status==h.E_TASK_STATUS.RUNNING){var o=h.ZhanLinModel.getIns().getTaskLingQuCnt(a);var s=n.warTaskCfg;if(o<parseInt(s.limit)){e.push(t[i])}}}for(i=0;i<t.length;i++){var n={};var a=t[i];h.ZhanLinModel.getIns().getTaskStatus(n,a);if(n.status==h.E_TASK_STATUS.IS_COMITE){var o=h.ZhanLinModel.getIns().getTaskLingQuCnt(a);var s=n.warTaskCfg;if(o>=parseInt(s.limit)){e.push(t[i])}}}if(e.length<t.length){if(ent.DebugConfig.isDebugger){console.error("次数小于一定次数! sub = "+(t.length-e.length))}}return e};e.prototype.refreshBtn=function(){if(this.vo.isCanTaskLingqu){this.imgyilingqu.visible=false;game.RedDotView.addTo(this.qiandaobtn)}else{this.imgyilingqu.visible=true;game.RedDotView.removeFrom(this.qiandaobtn)}};e.prototype.onRefreshHandler=function(t){if(t===void 0){t=true}var e=this,i=e.dengjiclip,n=e.shijian;var a=this.vo;i.value=a.level.toString();n.text=a.taskExp+"/"+a.upTaskkExp;this.refreshBtn();var o=csv.ZhanLinProxy.getIns().warordertaskList;if(t&&o.length>0){var s=this.getTaskIdList(o);this.oldTaskList=this.newTaskidList(s);this.baglist.scrollTo(0)}this.cleanItems();this.updateItem()};e.prototype.cleanItems=function(){while(this.itemList.length>0){var t=this.itemList.pop();if(t){t.removeSelf();Laya.Pool.recover("zhanlin.ZhanlingrenwuitemView",t)}}};e.prototype.updateItem=function(){if(this.oldTaskList.length>0){var t=void 0;var e=0;for(var i=0;i<this.oldTaskList.length;i++){t=Laya.Pool.getItemByClass("zhanlin.ZhanlingrenwuitemView",h.ZhanlingrenwuitemView);t.setData(this.oldTaskList[i]);t.x=0;t.y=e;e+=t.height+tip.TipManager.GAPS.GAP_ARROW;this.addItem(t)}}};e.prototype.addItem=function(t){this.baglist.addChild(t);this.itemList.push(t)};e.SINGLE_KEY="zhanlin.ZhanlingrenwuView";return e}(ui.zhanling.zhanlingrenwuUI);h.ZhanlingrenwuView=t})(zhanlin||(zhanlin={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var zhanlin;(function(t){var i=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.setData=function(t){var e=csv.FunctionsProxy.getIns().getCfg(t);this.qiehuanbtn.label=e.buttonname;if(game.ClosureManager.hasDot(t)){game.RedDotView.addTo(this.qiehuanbtn)}else{game.RedDotView.removeFrom(this.qiehuanbtn)}};Object.defineProperty(e.prototype,"selected",{set:function(t){this.qiehuanbtn.selected=t},enumerable:true,configurable:true});return e}(ui.zhanling.zhanlingyeqianitemUI);var e=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t._selectedIndex=-1;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.liatyeqian.itemRender=i;this.liatyeqian.renderHandler=new Laya.Handler(this,this.onRenderHandler);this.liatyeqian.selectHandler=new Laya.Handler(this,this.onSelectHandler);this.liatyeqian.selectEnable=true};t.prototype.onRenderHandler=function(t,e){t.setData(t.dataSource)};t.prototype.onSelectHandler=function(t){if(this._selectedIndex==t){return}this._selectedIndex=t;var e=this.funcids[this._selectedIndex];var i=game.WindowsResigter.getFunctionView(e);var n=i&&i.closure;while(this.neibuview.numChildren>0){this.neibuview.removeChildAt(0)}app.ViewManager.toggleView(n,this.neibuview,1,null,null,null,-1,e,false);for(var a=0;a<this.liatyeqian.cells.length;a++){var o=this.liatyeqian.cells[a];o.selected=a==t}};t.prototype.onDisplay=function(){game.Context.on(game.ContextEvent.FUNCTION_DOT_CHANGE,this,this.dotChange);this.callLater(this.refreshAll)};t.prototype.onUnDisplay=function(){game.Context.off(game.ContextEvent.FUNCTION_DOT_CHANGE,this,this.dotChange);this._selectedIndex=-1};t.prototype.dotChange=function(t){for(var e=0,i=this.funcids.length;e<i;e++){var n=this.funcids[e];if(t==n){this.liatyeqian.refresh();break}}};t.prototype.getHasRed=function(){for(var t=0;t<this.funcids.length;t++){if(game.ClosureManager.hasDot(this.funcids[t])){return t}}return 0};t.prototype.refreshAll=function(){this.funcids=[];var t=[];t.push(csv.FunctionsProxy.ENUMS.ZHAN_LING_REWARD,csv.FunctionsProxy.ENUMS.ZHAN_LING_TASK,csv.FunctionsProxy.ENUMS.ZHAN_LING_RECHANGE,csv.FunctionsProxy.ENUMS.ZHAN_LING_RANK);for(var e=0;e<t.length;e++){var i=t[e];if(csv.FunctionsProxy.getIns().isOpen(i)===true){this.funcids.push(i)}}this.liatyeqian.array=this.funcids;if(this.funcids.length>0){this.liatyeqian.selectedIndex=this.getHasRed()}};t.prototype.selectByFuncid=function(t){for(var e=0;e<this.funcids.length;e++){if(this.funcids[e]==t){this.liatyeqian.selectedIndex=e}}};t.SINGLE_KEY="zhanlin.ZhanLinMainView";return t}(ui.zhanling.zhanlingyeqianviewUI);t.ZhanLinMainView=e})(zhanlin||(zhanlin={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var zhanlin;(function(i){var n=shop.ShopModel;var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.daojulist.itemRender=grids.GridView;this.daojulist.renderHandler=grids.GridView.CommonItemRender;this.daojulist.hScrollBarSkin="";this.daojulist2.itemRender=grids.GridView;this.daojulist2.renderHandler=grids.GridView.CommonItemRender;this.daojulist2.hScrollBarSkin="";this.label01.text=app.getLang("zhanling_text21");this.goumaibtn.clickHandler=new Laya.Handler(this,this.onClickHandler);this.shuominglab2.removeSelf()};e.prototype.onClickHandler=function(){if(i.ZhanLinModel.getIns().isOpen()){n.getIns().chongzhi(i.ZhanLinModel.getIns().getRmb().id)}else{manager.FlowManager.instance.flowByStyle1(app.getLang("huodong_text_14"))}};e.prototype.buy=function(){var t=game.GridsModel.getIns().getItemCount(game.ItemUtil.ENUMS.YUANBAO);if(!this.itemVo){return}var e=this.itemVo.count;if(t<e){shop.ShopModel.getIns().askChongZhi(true);return}app.ProtocolRequest.WarOrderUpGradeReq()};e.prototype.onBuyRefresh=function(){app.ViewManager.toggleDialog(i.ZhanLinTreasureView,-1)};e.prototype.onDisplay=function(){this.model.on(i.ZhanLinModel.EVENT_PAY_GOLD_LEVEL,this,this.onBuyRefresh);this.callLater(this.refreshAll)};e.prototype.onUnDisplay=function(){this.model.off(i.ZhanLinModel.EVENT_PAY_GOLD_LEVEL,this,this.onBuyRefresh)};Object.defineProperty(e.prototype,"model",{get:function(){return i.ZhanLinModel.getIns()},enumerable:true,configurable:true});e.prototype.onRefreshList=function(t,e){var i=5;if(e.length<i){t.width=(t.spaceX+100)*e.length}else{t.width=(t.spaceX+100)*i}t.array=e};e.prototype.refreshAll=function(){this.onRefreshList(this.daojulist,csv.ZhanLinProxy.getIns().getAdvancedrewardList());this.onRefreshList(this.daojulist2,csv.ZhanLinProxy.getIns().getAdvancedrewardList(this.model.zhanLinVo.level));this.daojulist.scrollTo(0);this.daojulist2.scrollTo(0);this.shuzhi.text=this.model.zhanLinVo.allExp.toString();var t=game.ItemUtil.parserList(game.Config.getParams(371))[0];this.itemVo=t;if(this.model.hasWarOrder()){this.goumaibtn.gray=true;this.goumaibtn.mouseEnabled=false;this.goumaibtn.label=app.getLang("huodong_text_08")}else{this.goumaibtn.mouseEnabled=true;this.goumaibtn.gray=false;this.goumaibtn.label=app.getLang("zhanling_text16",app.convert_Yuan(this.model.getRmb().recharge))}};return e}(ui.xinshangcheng2.zhanlingjinjieUI);i.ZhanLinTreasureView=t})(zhanlin||(zhanlin={}));var zhanlin;(function(t){var e=function(){function t(){}Object.defineProperty(t.prototype,"curReward",{get:function(){if(this._reward){return this._reward}this._reward=csv.ZhanLinProxy.getIns().getRewardByRank(this.rank);return this._reward},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"titleSkin",{get:function(){if(this.titleId==0){return""}var t=csv.TitleProxy.getIns().getNobleCfg(this.titleId);var e=csv.TitleProxy.getIns().getNobleSkin(t);return e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"prof",{get:function(){return 2},enumerable:true,configurable:true});return t}();t.ZhanLinRankVo=e})(zhanlin||(zhanlin={}));var zhanlin;(function(i){var t=function(){function t(){this.actListVo=csv.ActivityTarenProxy.getIns().getCfgListByType(activitytaren.ActivityTaRenType.ZHAN_LIN)}t.prototype.getTime=function(t){var e=t.split("-");var i=util.TimeUtil.getTimeByDate(parseInt(e[0]),parseInt(e[1]),parseInt(e[2]),parseInt(e[3]),parseInt(e[4]),parseInt(e[5]));return i};t.prototype.getAct=function(){var t=game.Context.getServerTime();for(var e=0;e<this.actListVo.length;e++){var i=this.actListVo[e];var n=i.timeVo;if(t>=n.startTime&&t<n.endTime){return i}}};Object.defineProperty(t.prototype,"startTime",{get:function(){var t=this.getAct();if(t){return t.timeVo.startTime}return-1},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"endTime",{get:function(){var t=i.ZhanLinModel.getIns().zhanLinVo;if(t.data){return t.data.sessionEndTime||0}var e=this.getAct();if(e){return e.timeVo.endTime}return-1},enumerable:true,configurable:true});return t}();i.ZhanLinTimeVo=t})(zhanlin||(zhanlin={}));var zhanlin;(function(e){var t=function(){function a(){this.status=0;this._exp=-1;this._level=0;this.exp=0}Object.defineProperty(a.prototype,"myrank",{get:function(){var t=rank.RankModel.getIns().getRankInfo(e.ZhanLinModel.getIns().rankType);if(!t){return 0}return t.rank},enumerable:true,configurable:true});a.prototype.getNextCfg=function(t){for(var e=0;e<this.warorder.length;e++){var i=this.warorder[e];if(i==t&&this.warorder[e+1]){return this.warorder[e+1]}}return this.warorder[this.warorder.length-1]};Object.defineProperty(a.prototype,"rankReward",{get:function(){return csv.ZhanLinProxy.getIns().getRewardByRank(this.myrank)},enumerable:true,configurable:true});Object.defineProperty(a.prototype,"exp",{get:function(){return this._exp},set:function(t){this._exp=t;this.calclateLv();this.warorder=csv.ZhanLinProxy.getIns().warorder;this.progressVoList=[];for(var e=0;e<this.warorder.length;e++){var i=new n(this);i.cfg=this.warorder[e];this.progressVoList.push(i)}for(var e=0;e<this.progressVoList.length;e++){var i=this.progressVoList[e];if(i.calculate()){e++}}},enumerable:true,configurable:true});Object.defineProperty(a.prototype,"allExp",{get:function(){return this.getExp(this.level)+this.exp},enumerable:true,configurable:true});a.prototype.getZhanLinCellVo=function(t){for(var e=0;e<this.progressVoList.length;e++){var i=this.progressVoList[e];if(i.cfg==t){return i}}};a.prototype.calclateLv=function(){var t=csv.ZhanLinProxy.getIns().getDayKeyByOpenDay();this.dayKey=t;var e=csv.ZhanLinProxy.getIns().warDayMap[t];if(this.level>=e.length){this.cfg=e[e.length-1];this.nextCfg=null;this.status=a.STATUS_MAX_LEVEL;return}for(var i=0;i<e.length;i++){var n=e[i];if(n.level==this.level+1){this.cfg=e[i-1];this.nextCfg=n;this.status=a.STATUS_NORMAL;return}}this.cfg=null;this.nextCfg=e[0];this.status=a.STZTUS_ZERO};Object.defineProperty(a.prototype,"level",{get:function(){return this._level},set:function(t){this._level=t},enumerable:true,configurable:true});a.prototype.getExp=function(t){var e=0;for(var i=0;i<this.warorder.length;i++){var n=this.warorder[i];if(t>=n.level){e+=n.exp}}return e};Object.defineProperty(a.prototype,"expPercent",{get:function(){var t=this.status;switch(t){case a.STZTUS_ZERO:return 0;case a.STATUS_MAX_LEVEL:return 1;case a.STATUS_NORMAL:var e=this,i=e.cfg,n=e.nextCfg;if(i&&n){return this._exp/n.exp}}return 0},enumerable:true,configurable:true});Object.defineProperty(a.prototype,"taskExp",{get:function(){var t=this.data;if(t){return t.todayExp.toNumber()||0}return 0},enumerable:true,configurable:true});Object.defineProperty(a.prototype,"upTaskkExp",{get:function(){return parseInt(game.Config.getParams(369))},enumerable:true,configurable:true});Object.defineProperty(a.prototype,"isCanTaskLingqu",{get:function(){if(!e.ZhanLinModel.getIns().isOpen()){return false}var t=this.data;if(t){return t.expBagState==1}return false},enumerable:true,configurable:true});a.prototype.setData=function(t){this.data=t;this.level=t.lv;this.exp=t.exp.toNumber()};a.prototype.getShopVo=function(t){var e=this.shopItemList;for(var i=0;i<e.length;i++){var n=e[i];if(n.id==parseInt(t)){return n}}return null};a.STATUS_MAX_LEVEL=1;a.STATUS_NORMAL=0;a.STZTUS_ZERO=2;return a}();e.ZhanLinVo=t;var n=function(){function t(t){this.showBall=false;this.vo=t}Object.defineProperty(t.prototype,"front",{get:function(){var t=this.vo.progressVoList.indexOf(this);return this.vo.progressVoList[t-1]},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"next",{get:function(){var t=this.vo.progressVoList.indexOf(this);return this.vo.progressVoList[t+1]},enumerable:true,configurable:true});t.prototype.calculate=function(){var t=false;if(this.vo.level>this.cfg.level){this.progressTop=this.progressBottom=1;this.showBall=true}else if(this.vo.level==this.cfg.level){if(this.next){var e=this.vo.getExp(this.cfg.level);var i=this.vo.getExp(this.next.cfg.level);this.progressTop=1;this.showBall=true;var n=(i-e)/2;if(this.vo.exp<=n){this.progressBottom=this.vo.exp/n}else{this.progressBottom=1;this.next.progressBottom=0;this.next.progressTop=(this.vo.exp-n)/n;t=true}}else{this.showBall=true;this.progressTop=1}}else{this.progressTop=this.progressBottom=0}if(!this.front){this.progressTop=-1}if(!this.next){this.progressBottom=-1}return t};return t}();e.ZhanLinCellVo=n})(zhanlin||(zhanlin={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var zhanqi;(function(i){var t=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t.fullScreen="fullScreen";t.lastMouseX=0;t.lastMouseY=0;t.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#ffffff");t.panel=new i.HexPanel(Laya.stage.width,Laya.stage.height);t.panel.initMap("res/tiledmap/fudi1.json");t.addChild(t.panel);Laya.stage.on(Laya.Event.MOUSE_DOWN,t,t.mouseDown);Laya.stage.on(Laya.Event.MOUSE_UP,t,t.mouseUp);return t}t.prototype.mouseMove=function(){var t=this.panel.mapX-(Laya.stage.mouseX-this.lastMouseX);var e=this.panel.mapY-(Laya.stage.mouseY-this.lastMouseY);this.panel.moveViewPort(t,e)};t.prototype.mouseUp=function(){this.panel.mapX=this.panel.rect.x;this.panel.mapY=this.panel.rect.y;Laya.stage.off(Laya.Event.MOUSE_MOVE,this,this.mouseMove);if(Laya.stage.mouseX==this.lastMouseX&&Laya.stage.mouseY==this.lastMouseY){var t=this.panel.getColAndRowByStageXy(Laya.stage.mouseX,Laya.stage.mouseY);this.panel.movePath(t.col,t.row)}};t.prototype.mouseDown=function(){this.lastMouseX=Laya.stage.mouseX;this.lastMouseY=Laya.stage.mouseY;Laya.stage.on(Laya.Event.MOUSE_MOVE,this,this.mouseMove)};t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.init=function(){app.ViewManager.toggleView(t,app.AppContainer.zhezhaoLayer,1)};t.SINGLE_KEY="gm.ZhanqiView";return t}(Laya.Sprite);i.ZhanqiView=t})(zhanqi||(zhanqi={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var zhanqi;(function(o){var t=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t.avatar=new avatar.AvatarAnimation;t.avatar.setAniData(game.Context.mainRole);t.avatar.play();t.addChild(t.avatar);t.avatar.scale(1,1);return t}Object.defineProperty(t.prototype,"roleState",{get:function(){return this._roleState},set:function(t){this._roleState=t;if(t==role.RoleStateConst.IDLE){this.setRoleAni(avatar.AvatarAnimation.ANI_ENUMS.IDLE,this.dir)}else if(t==role.RoleStateConst.MOVE){this.setRoleAni(avatar.AvatarAnimation.ANI_ENUMS.RUN,this.dir)}else if(t==role.RoleStateConst.DIE){this.setRoleAni(avatar.AvatarAnimation.ANI_ENUMS.DIE,this.dir)}else if(t==role.RoleStateConst.JUMP){this.setRoleAni(avatar.AvatarAnimation.ANI_ENUMS.JUMP,this.dir)}else if(t==role.RoleStateConst.HIT){this.setRoleAni(avatar.AvatarAnimation.ANI_ENUMS.HIT,this.dir)}},enumerable:true,configurable:true});t.prototype.setRoleAni=function(t,e,i){if(i===void 0){i=false}this.avatar.setAni(t,e,i)};t.prototype.setRolePos=function(t,e){var i=o.ZhanqiView.getIns().panel;this.data=i.getGridData(t,e);this.avatar.x=this.data.x+i.gridW/2;this.avatar.y=this.data.y+i.gridH/2};t.prototype.startMovePath=function(t){if(this.boMove){this.newPosArr=t;return}this.newPosArr=null;t.shift();this.posArr=t;this.movePath()};t.prototype.movePath=function(){if(this.newPosArr){this.stopMove();this.startMovePath(this.newPosArr);return}if(!this.posArr.length){this.stopMove();return}var t=this.posArr.shift();var e=o.ZhanqiView.getIns().panel;var i=e.getGridData(t.col,t.row);var n=i.x+e.gridW/2;var a=i.y+e.gridH/2;this.dir=o.HexGrid.getDir(this.avatar.x,this.avatar.y,n,a);this.roleState=role.RoleStateConst.MOVE;Laya.Tween.to(this.avatar,{x:n,y:a},game.Config.getIntParams(2016),null,Laya.Handler.create(this,this.onMoveEnd,[i]));this.boMove=true};t.prototype.onMoveEnd=function(t){this.data=t;this.movePath()};t.prototype.stopMove=function(){this.roleState=role.RoleStateConst.IDLE;this.boMove=false;Laya.Tween.clearAll(this.avatar)};return t}(Laya.Sprite);o.HexAvatar=t})(zhanqi||(zhanqi={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var zhanqi;(function(t){var e=function(o){__extends(r,o);function r(t,e,i,n){var a=o.call(this)||this;a.w=t;a.h=e;a.bc=i;a.graphics.drawTexture(n);a.lab=new Laya.Label;a.lab.width=t;a.lab.fontSize=20;a.lab.align="center";a.lab.y=(e-20)/2;a.addChild(a.lab);return a}r.prototype.setData=function(t){this.data=t;this.x=t.x;this.y=t.y;this.lab.text=t.col+","+t.row};r.prototype.drawHexGrid=function(){var t=r.getHexPoints();var e=t[0];var i=t[1];var n=t[2];var a=t[3];var o=t[4];var s=t[5];this.graphics.drawPoly(0,0,[i.x,i.y,n.x,n.y,a.x,a.y,o.x,o.y,s.x,s.y,e.x,e.y],"#000000")};r.prototype.drawHexPath=function(){var t=r.getHexPoints();var e=t[0];var i=t[1];var n=t[2];var a=t[3];var o=t[4];var s=t[5];this.graphics.drawLines(0,0,[e.x,e.y,i.x,i.y,n.x,n.y,a.x,a.y,o.x,o.y,s.x,s.y,e.x,e.y],"#33ff00")};r.getHexGrid=function(t,e,i,n){if(this._pool.length>0){return this._pool.shift()}return new r(t,e,i,n)};r.recoverHexGrid=function(t){t.removeSelf();this._pool.push(t)};r.setHexPoints=function(t,e,i){if(!this._hexPoints){var n=[];n.push(new Laya.Point((t-i)/2,0));n.push(new Laya.Point((t+i)/2,0));n.push(new Laya.Point(t,e/2));n.push(new Laya.Point((t+i)/2,e));n.push(new Laya.Point((t-i)/2,e));n.push(new Laya.Point(0,e/2));this._hexPoints=n}};r.getHexPoints=function(){return this._hexPoints};r.getHexPointsByXy=function(t,e){var i=r.getHexPoints();var n=[];for(var a=0,o=i.length;a<o;a++){var s=new Laya.Point;s.x=i[a].x+t;s.y=i[a].y+e;n.push(s)}return n};r.getHexPointsStr=function(t,e){var i=this.getHexPointsByXy(t,e);var n=[];for(var a=0;a<6;a++){var o=a+1>=6?0:a+1;var s=i[a];var r=i[o];if(s.x<r.x){n.push([s.x,s.y,r.x,r.y])}else{n.push([r.x,r.y,s.x,s.y])}}return n};r.getDir=function(t,e,i,n){var a=Math.atan2(n-e,i-t);var o=0;if(a>0&&a<Math.PI/2){o=0}else if(a==Math.PI/2){o=7}else if(a>Math.PI/2&&a<Math.PI){o=6}else if(a>-Math.PI/2&&a<0){o=2}else if(a==-Math.PI/2){o=3}else if(a<-Math.PI/2&&a>-Math.PI){o=4}return o};r._pool=[];return r}(Laya.Sprite);t.HexGrid=e;var i=function(){function t(t,e){this.col=t;this.row=e;this.gx=t;this.gz=e-(t-(t&1))/2;this.gy=-this.gx-this.gz}return t}();t.HexGridData=i})(zhanqi||(zhanqi={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var zhanqi;(function(u){var t=function(n){__extends(t,n);function t(t,e){var i=n.call(this)||this;i.mapX=0;i.mapY=0;i.drawSp=new Laya.Sprite;i.rectW=t;i.rectH=e;i.rect=new Laya.Rectangle(0,0,i.rectW,i.rectH);i.scrollRect=i.rect;i.gridLayer=new Laya.Sprite;i.addChild(i.gridLayer);i.pathLayer=new Laya.Sprite;i.addChild(i.pathLayer);i.avatarLayer=new Laya.Sprite;i.addChild(i.avatarLayer);i.mine=new u.HexAvatar;i.avatarLayer.addChild(i.mine);return i}t.prototype.initMap=function(t){this.loader=new Laya.Loader;this.loader.once("complete",this,this.onJsonComplete);this.loader.load(t,"json",false)};t.prototype.onJsonComplete=function(t){this.jsonData=t;this.staggeraxis=this.jsonData.staggeraxis;this.staggerindex=this.jsonData.staggerindex;this.maxCol=this.jsonData.width;this.maxRow=this.jsonData.height;this.gridW=this.jsonData.tilewidth;this.gridH=this.jsonData.tileheight;this.gridBc=this.jsonData.hexsidelength;u.HexGrid.setHexPoints(this.gridW,this.gridH,this.gridBc);this.gapX=(this.gridW+this.gridBc)/2;this.mapWidth=this.maxCol*this.gapX+this.gridW-this.gapX;this.gapY=this.gridH;this.mapHeight=this.maxRow*this.gapY+this.gapY/2;this.addCol=Math.ceil(this.rect.width/this.gapX);this.addRow=Math.ceil(this.rect.height/this.gapY);this.lastGrids={};this.loader.once("complete",this,this.createMap);this.loader.load("res/tiledmap/grid.png","image",false)};t.prototype.createMap=function(t){this.gridTexture=t;this.gridData=[];for(var e=0;e<this.maxRow;e++){this.gridData[e]=[];for(var i=0;i<this.maxCol;i++){var n=new u.HexGridData(i,e);n.x=i*this.gapX;n.y=i%2==0?e*this.gapY:(e+.5)*this.gapY;this.gridData[e][i]=n}}this.mapGrids=new isometric.MapGrid2(this.maxCol,this.maxRow,0,0,this.gridData);this.astar=new isometric.AStar2;this.mine.setRolePos(0,0);this.updateViewPort()};t.prototype.setCamera=function(t,e){var i=this.getGridData(t,e);var n=i.x-this.rect.width/2+this.gridW/2;var a=i.y-this.rect.height/2+this.gridH/2;if(n<0){n=0}else if(n>this.mapWidth-this.rect.width){n=this.mapWidth-this.rect.width}if(a<0){a=0}else if(a>this.mapHeight-this.rect.height){a=this.mapHeight-this.rect.height}var o=Math.atan2(a-this.rect.y,n-this.rect.x);Laya.timer.frameLoop1(1,this,this.moveCamera,[n,a,o])};t.prototype.moveCamera=function(t,e,i){var n=new Laya.Point(this.rect.x,this.rect.y);var a=Math.floor(n.distance(t,e));var o=a/50;if(o<100){o=100}var s=o*Laya.timer.delta*.01;var r;if(s>a){s=a;r=true}var l=this.rect.x+Math.cos(i)*s;var h=this.rect.y+Math.sin(i)*s;this.moveViewPort(l,h);if(r){this.moveCameraEnd()}};t.prototype.moveCameraEnd=function(){Laya.timer.clear(this,this.moveCamera);this.mapX=this.rect.x;this.mapY=this.rect.y};t.prototype.updateViewPort=function(){var t=Math.floor(this.rect.x/this.gapX);var e=Math.floor(this.rect.y/this.gapY);if(this.lastCol==t&&this.lastRow==e){return}var i={};var n=t+this.addCol;if(n>=this.maxCol){n=this.maxCol-1}var a=e+this.addRow;if(a>=this.maxRow){a=this.maxRow-1}for(var o=e;o<=a;o++){for(var s=t;s<=n;s++){var r=s+"-"+o;var l=this.getLastGrids(r);if(!l){l=u.HexGrid.getHexGrid(this.gridW,this.gridH,this.gridBc,this.gridTexture)}this.gridLayer.addChild(l);l.setData(this.getGridData(s,o));i[r]=l}}for(var r in this.lastGrids){if(!i[r]){var l=this.lastGrids[r];u.HexGrid.recoverHexGrid(l)}}this.lastCol=t;this.lastRow=e;this.lastGrids=i};t.prototype.getLastGrids=function(t){if(this.lastGrids[t]){return this.lastGrids[t]}return null};t.prototype.getGridData=function(t,e){return this.gridData[e][t]};t.prototype.moveViewPort=function(t,e){if(t<0){t=0}else if(t>this.mapWidth-this.rect.width){t=this.mapWidth-this.rect.width}if(e<0){e=0}else if(e>this.mapHeight-this.rect.height){e=this.mapHeight-this.rect.height}this.rect.x=t;this.rect.y=e;this.scrollRect=this.rect;this.updateViewPort()};t.prototype.setDraw=function(t){var e=[];for(var i=0;i<t.length-1;i+=2){var n=t[i];var a=t[i+1];var o=this.getGridData(n,a);e.push(o)}this.drawPath(e)};t.prototype.drawPath=function(t){this.drawSp.graphics.clear();var e=[];var i=t.length;for(var n=0;n<i;n++){var a=t[n];var o=u.HexGrid.getHexPointsStr(a.x,a.y);e=e.concat(o)}i=e.length;for(var n=0;n<i;n++){var s=e[n];if(s==null){continue}var r=true;for(var l=n+1;l<i;l++){var h=e[l];if(h==null){continue}if(s[0]==h[0]&&s[1]==h[1]&&s[2]==h[2]&&s[3]==h[3]){e[n]=null;e[l]=null;r=false;break}}if(r){this.drawSp.graphics.drawLine(s[0],s[1],s[2],s[3],"#33ff00",5)}}this.pathLayer.addChild(this.drawSp)};t.prototype.movePath=function(t,e){this.mapGrids.setStartNode(this.mine.data.col,this.mine.data.row);this.mapGrids.setEndNode(t,e);this.astar.findPath(this.mapGrids);this.mine.startMovePath(this.astar.pathArr)};t.prototype.getColAndRowByStageXy=function(t,e){var i=t+this.rect.x;var n=Math.floor(i/this.gapX);var a=i-n*this.gapX;var o;var s;if(n%2==0){s=e+this.rect.y;o=Math.floor(s/this.gapY)}else{s=e+this.rect.y-this.gridH/2;o=Math.floor(s/this.gapY)}if(a<this.gapX-this.gridBc){var r=s-o*this.gapY;var l=u.HexGrid.getHexPoints();if(r>this.gapY/2){var h=[l[4].x-l[5].x,l[4].y-l[5].y];var p=[a-l[5].x,r-l[5].y];if(h[0]*p[1]-h[1]*p[0]>0){if(n%2!=0){o+=1}n-=1}}else{var h=[l[5].x-l[0].x,l[5].y-l[0].y];var p=[a-l[0].x,r-l[0].y];if(h[0]*p[1]-h[1]*p[0]>0){if(n%2==0){o-=1}n-=1}}}return{col:n,row:o}};return t}(Laya.Sprite);u.HexPanel=t})(zhanqi||(zhanqi={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var zhenjiuqiwa;(function(n){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.ZJQW_RANK,n.ZhengjiuqiwapaihangbangView);game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.ZJQW_MAIN,n.Zhengjiuqiwaview)};e.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.DgnSaveSeventhAck,this,this.onDgnSaveSeventhAckHandler);this.addMsgListener(app.ProtocolResponse.SaveSeventhHPNotice,this,this.onSaveSeventhHPNoticeHandler);this.addMsgListener(app.ProtocolResponse.SaveSeventhAddBoxNotice,this,this.onSaveSeventhAddBoxNotice);this.addMsgListener(app.ProtocolResponse.SaveSeventhGetBoxAck,this,this.onSaveSeventhGetBoxAck)};e.prototype.onDgnSaveSeventhAckHandler=function(t,e){};e.prototype.onSaveSeventhHPNoticeHandler=function(t,e){var i=e.hitHp.toNumber();n.ZhenjiuQiWaModel.getIns().calculate(i);n.ZhenjiuQiWaModel.getIns().event(n.EVENT_ZJQU.UPDDATA_BLOOD,i)};e.prototype.onSaveSeventhAddBoxNotice=function(t,e){if(e.boxIdList){for(var i=0;i<e.boxIdList.length;i++){scene.SceneMediator.getInstance().addChest(e.boxIdList[i])}}};e.prototype.onSaveSeventhGetBoxAck=function(t,e){if(e.result==1){n.ZhenjiuQiWaModel.getIns().event(n.EVENT_ZJQU.PICK_UP)}else{console.log("捡宝箱失败",e)}};e.SINGLE_KEY=".ZhengjiuQiwaModule";return e}(app.ModuleBase);n.ZhengjiuQiwaModule=t})(zhenjiuqiwa||(zhenjiuqiwa={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var zhenjiuqiwa;(function(t){t.TIME_LABEL_OFFSET_Y=350;var e;(function(t){t["PICK_UP"]="PICK_UP";t["PUSH_ITEM"]="PUSH_ITEM";t["UPDDATA_BLOOD"]="UPDDATA_BLOOD"})(e=t.EVENT_ZJQU||(t.EVENT_ZJQU={}));var i=function(){function t(){this.curBloodCnt=0;this.changeCnt=0}Object.defineProperty(t.prototype,"percent",{get:function(){var t=(this.cfg.max-this.hitBlood)/(this.cfg.max-this.cfg.min);if(t<=0){t=.1}return t},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"state",{get:function(){return this.cfg.cfg.stage||0},enumerable:true,configurable:true});return t}();t.BloodVO=i;var n=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.bloodVO=new i;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.init=function(t){};Object.defineProperty(t.prototype,"subTime",{get:function(){var t=dailytask.DailyTaskModel.getIns().getTask(csv.DailyTaskProxy.ENUM_ACTIVITY_TYPE.ZJQW);if(t){var e=this.allTime-t.dnum;if(e<0){e=0}return e}return this.allTime},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"allTime",{get:function(){var t=csv.DailyTimeProxy.getIns().getCfg(16);return t.time},enumerable:true,configurable:true});t.prototype.rankList=function(){var t=[];for(var e=0;e<7;e++){var i={};i.rank=e+1;i.bloodnum=e;i.playerName=e+"name";i.titleid=e+1+"001";t.push(i)}return t};t.prototype.sword=function(){return 1e4};t.prototype.add=function(t,e){for(var i=0;i<t.length;i++){if(t[i].itemid==e.itemid){t[i].cnt+=e.cnt;return true}}return false};t.prototype.getItemList=function(t){var e=[];for(var i=0;i<t.length;i++){var n=t[i];var a=csv.ZhenjiuQiWaProxy.getIns().saveDungeonMap[n.boxCfgId];if(a){var o={};var s=a.award.split("-");o.itemid=parseInt(s[0]);o.cnt=parseInt(s[1]);if(!this.add(e,o)){e.push(o)}}}var r="";for(var i=0;i<e.length;i++){var l=e[i];r+=l.itemid+"-"+l.cnt+";"}return game.ItemUtil.parserList(r)};t.prototype.getPosList=function(t,e){if(t===void 0){t=0}if(e===void 0){e=0}var i=[];var n=2;i.push(new Laya.Point(-3,-3));i.push(new Laya.Point(-4,-4));i.push(new Laya.Point(+3,+3));i.push(new Laya.Point(+4,+4));i.push(new Laya.Point(-3,0));i.push(new Laya.Point(+3,0));i.push(new Laya.Point(-3,0));i.push(new Laya.Point(-5,0));i.push(new Laya.Point(+3,0));i.push(new Laya.Point(+5,0));i.push(new Laya.Point(0,-3));i.push(new Laya.Point(0,-5));i.push(new Laya.Point(0,+3));i.push(new Laya.Point(0,+5));i.push(new Laya.Point(-5,-3));i.push(new Laya.Point(-3,-5));i.push(new Laya.Point(+3,+5));i.push(new Laya.Point(+5,+3));i.push(new Laya.Point(-4,+3));i.push(new Laya.Point(-3,+4));i.push(new Laya.Point(+3,-4));i.push(new Laya.Point(+4,-3));return i};t.prototype.initCheck=function(){if(!this._checkList){this._checkList=[];var t=csv.ZhenjiuQiWaProxy.getIns().saveDungenArr;var e=0;for(var i=0;i<t.length;i++){var n=t[i];var a=n.level.split("-");var o=parseInt(a[0]);var s=parseInt(a[1]);var r=s-o+1;for(var l=0;l<r;l++){var h={};var p=0;if(this._checkList.length>0){p=this._checkList[this._checkList.length-1].max}h.min=p;h.max=e+(l+1)*n.blood;h.cfg=n;h.index=l+o-1;this._checkList.push(h)}e+=n.blood*r}}};t.prototype.getOldCfg=function(){if(this.bloodVO.cfg&&this.bloodVO.cfg.cfg){return this.bloodVO.cfg.cfg}};t.prototype.calculate=function(t){var e=this.getOldCfg();var i=this.bloodVO.curBloodCnt;this.bloodVO.curBloodCnt=this.getBloodCnt(t);this.bloodVO.hitBlood=t;this.bloodVO.changeCnt=this.bloodVO.curBloodCnt-i;var n=this.bloodVO.cfg.cfg;var a=false;if(e){if(e.id!=n.id){a=true}}else{a=true}if(a&&n.lang&&n.lang!=""){var o=battle.BattleModel.getIns().bossInfo;if(o){var s=scene.SceneMediator.getInstance().getViewById(o.insId);var r=n.lang.split("-");var l=r[Math.floor(r.length*Math.random())];var h=csv.ZhenjiuQiWaProxy.getIns().saveRuleList[0].bossword;s.addBubble(l,h)}else{}}};t.prototype.getBloodCnt=function(t,e){if(e===void 0){e=true}this.initCheck();for(var i=0;i<this._checkList.length;i++){var n=this._checkList[i];if(t>=n.min&&t<n.max){if(e){this.bloodVO.cfg=n}return n.index}}return 0};t.SINGLE_KEY="zhenjiuqiwa.ZhenjiuQiWaModel";return t}(app.ModelBase);t.ZhenjiuQiWaModel=n})(zhenjiuqiwa||(zhenjiuqiwa={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("save_rank.csv");this.saveRankList=t.getArray();t=app.Config.getResById("save_rule.csv");this.saveRuleList=t.getArray();t=app.Config.getResById("save_dungeon.csv");this.saveDungeonMap=t.getMap("id");this.saveDungenArr=t.getArray()};e.SINGLE_KEY="csv.ZhenjiuQiWaProxy";return e}(app.ModelBase);t.ZhenjiuQiWaProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var zhenjiuqiwa;(function(t){var i=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.list.itemRender=grids.GridView;this.list.renderHandler=grids.GridView.CommonItemRender;this.labelwanjiaxuweiyidai.visible=false};e.prototype.onUnDisplay=function(){};e.prototype.onDisplay=function(){};e.prototype.setData=function(t){this.list.array=game.ItemUtil.parserList(t.award);this.lapelpaiming.text=t.rank};return e}(ui.zhengjiuqiwa.paihangbangliebitem03UI);var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listpaiming01.itemRender=i;this.listpaiming01.renderHandler=new Laya.Handler(this,this.onListPaiMingHandler)};e.prototype.onListPaiMingHandler=function(t,e){t.setData(t.dataSource)};e.prototype.onUnDisplay=function(){};e.prototype.onDisplay=function(){this.listpaiming01.array=csv.ZhenjiuQiWaProxy.getIns().saveRankList};return e}(ui.zhengjiuqiwa.zhengjiuqiwapaihangbangjiangliviewUI);t.Zhengjiuqiwapaihangbangjiangliview=e})(zhenjiuqiwa||(zhenjiuqiwa={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var zhenjiuqiwa;(function(i){function n(t){}function s(t){var e=i.ZhenjiuQiWaModel.getIns().getBloodCnt(t.value.toNumber(),false);return e}var a=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.CLICK,this,this.showMenu)};e.prototype.showMenu=function(t){t.stopPropagation();n(this._data)};e.prototype.setData=function(t,e){this._data=t;if(Uint64.equal(t.uid,Uint64.ZERO)){this.touxian.skin=null;this.lapelpaiming.text=(e+1).toString();this.labelwanjia.text=app.getLang("rank_empty");this.labelxueguan.text="";this.labelwanjiaxuweiyidai.visible=false}else{this.touxian.skin=csv.TitleProxy.getIns().getNobleSkin(t.headtitle);this.lapelpaiming.text=(e+1).toString();this.labelwanjia.text=t.name+"";this.labelxueguan.text=app.getLang("save_txt01",s(t));this.labelwanjiaxuweiyidai.visible=false}};return e}(ui.zhengjiuqiwa.paihangbangliebitem02UI);var o=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.CLICK,this,this.showMenu)};e.prototype.showMenu=function(t){t.stopPropagation();n(this._data)};Object.defineProperty(e.prototype,"mRank",{set:function(t){this.imgpaiming.skin="res/static/zhengjiuqiwa/bg_paiming_"+t+".png"},enumerable:true,configurable:true});e.prototype.setData=function(t,e){this._data=t;if(Uint64.equal(t.uid,Uint64.ZERO)){this.mRank=e+1;this.laeblwanjia.text=app.getLang("rank_empty");this.labelxueguan.text="";this.touxian.skin=null}else{this.mRank=e+1;this.laeblwanjia.text=t.name+"";this.labelxueguan.text=app.getLang("save_txt01",s(t));this.touxian.skin=csv.TitleProxy.getIns().getNobleSkin(t.headtitle)}};return e}(ui.zhengjiuqiwa.paihangbangliebitem01UI);var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listpaiming01.removeSelf();this.list=new Laya.MultiList;this.list.width=this.listpaiming01.width;this.list.height=this.listpaiming01.height;this.list.repeatX=1;this.addChild(this.list);this.list.vScrollBarSkin=" ";this.list.x=this.listpaiming01.x;this.list.y=this.listpaiming01.y;this.list.itemRender=a;this.list.setCustomItem(0,new o);this.list.setCustomItem(1,new o);this.list.setCustomItem(2,new o);this.list.renderHandler=new Laya.Handler(this,this.onRender);this.btnchakan.clickHandler=new Laya.Handler(this,this.onChakanHandler);this.list.array=[];this.uninRank();game.HelperViewHandler.registerStr([this.btnrule,this.paihangbangguize],"func86t","func165")};e.prototype.onChakanHandler=function(){app.ViewManager.toggleDialog(i.Zhengjiuqiwapaihangbangjiangliview,1,0)};e.prototype.onRender=function(t,e){t.setData(t.dataSource,e)};e.prototype.onUnDisplay=function(){rank.RankModel.getIns().off(rank.RankModel.RANK_DATA_CHANGE,this,this.rankChange)};e.prototype.onDisplay=function(){rank.RankModel.getIns().once(rank.RankModel.RANK_DATA_CHANGE,this,this.rankChange);app.ProtocolRequest.GetRankListReq(rank.RankModel.TYPE_ENUM.ENMRANKTYPE_ZJQW)};e.prototype.rankChange=function(){this.callLater(this.onRefreshHandler)};e.prototype.getSelf=function(t){for(var e=0;e<t.length;e++){if(Uint64.equal(game.Context.mainRole.insId,t[e].uid)){return t[e]}}};e.prototype.uninRank=function(){this.labelwodepaimingnum.text=app.getLang("save_txt02");this.labelmiaoshu.text="";this.labelduanwei.text=""};e.prototype.onRefreshHandler=function(){var t=rank.RankModel.getIns().getRankInfo(rank.RankModel.TYPE_ENUM.ENMRANKTYPE_ZJQW);var e=[];e=e.concat(t.rankList);var i=100;if(e.length<i){for(var n=t.rankList.length;n<i;n++){var a=new RankData;a.uid=Uint64.ZERO;e.push(a)}}this.list.array=e;if(t.rank==0){this.uninRank()}else{this.labelwodepaimingnum.text=t.rank.toString();var o=this.getSelf(t.rankList);this.labelmiaoshu.text=o.value.toNumber().toString();this.labelduanwei.text=app.getLang("save_txt01",s(o))}};return e}(ui.zhengjiuqiwa.zhengjiuqiwapaihangbangviewUI);i.ZhengjiuqiwapaihangbangView=t})(zhenjiuqiwa||(zhenjiuqiwa={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var zhenjiuqiwa;(function(t){var i=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.imgxuanzhong.visible=false};e.prototype.setData=function(t){var e=new items.ItemVO(csv.ItemProxy.getIns().itemCfgMap[t.itemID]);e.setCount(t.value);this.gezi.setData(e)};return e}(ui.jiesuan.jiesuanbagitemUI);var e=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.closeTime=10;t.maxUseSec=5;t._progressValue=0;return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.gezilist.itemRender=i;this.gezilist.renderHandler=new Laya.Handler(this,this.onGeziHandler);this.quedingbtn.clickHandler=new Laya.Handler(this,this.onOkHandler);this.closebtn.clickHandler=new Laya.Handler(this,this.onOkHandler);this._tx=this.gezilist.x;this.hpMediator=new ZjqwHpBarMediator(this.xuetiao1,this.xuetiao2,this.xuetiaotouming,this.xuetiaodi);var t="item_pack_40022";this.imgbaoxiang.skin="res/icon/item/"+t+".png"};t.prototype.onOkHandler=function(){app.ProtocolRequest.LeaveDailyDgnReq();this.close()};t.prototype.onGeziHandler=function(t,e){t.setData(t.dataSource)};t.prototype.onUnDisplay=function(){};t.prototype.onDisplay=function(){util.SkUtil.setWinSkt(this.imgwofang);this.callLater(this.refreshHandler)};t.prototype.playBloodAni=function(t,e){this.hpMediator.setPercentNum(1,t,e)};Object.defineProperty(t.prototype,"oneSecMax",{get:function(){return game.Config.getIntParams(611)},enumerable:true,configurable:true});t.prototype.refreshHandler=function(){var t=this.dataSource;var e=game.ItemUtil.hebingItems(t.award);var i=t.battleval[0].toNumber();this.bloodCnt=i;var n=this.maxUseSec*this.oneSecMax;var a=this.maxUseSec;var o=i;if(o>n){o=n}else{if(o>this.oneSecMax){a=o/this.oneSecMax}else{a=1}}this.gezilist.array=e;this.gezilist.scrollTo(0);if(e.length>=4){this.gezilist.x=this._tx}else{this.gezilist.x=(this.width-(98+this.gezilist.spaceX)*e.length)/2}this.sub=this.closeTime+1;this.onDelayHander();this.playBloodAni(o,a*1e3);this.progressValue=0;Laya.Tween.to(this,{progressValue:1},a*1e3,Laya.Ease.linearNone,Laya.Handler.create(this,this.onProgressEndHandler))};Object.defineProperty(t.prototype,"progressValue",{get:function(){return this._progressValue},set:function(t){this._progressValue=t;this.labelshuliang.text="x"+Math.floor(t*this.bloodCnt).toString()},enumerable:true,configurable:true});t.prototype.onProgressEndHandler=function(){this.hpMediator.stop()};t.prototype.onDelayHander=function(){if(app.ViewManager.DisplayedInStage(t.SINGLE_KEY)){if(this.sub>0){this.sub--;this.quedingbtn.label=app.getLang("save_txt03",this.sub);Laya.timer.once(1e3,this,this.onDelayHander)}else{this.onOkHandler()}}else{}};t.SINGLE_KEY="zhenjiuqiwa.ZhengjiuqiwashengliView";return t}(ui.jiesuan.zhengjiuqiwashengliUI);t.ZhengjiuqiwashengliView=e})(zhenjiuqiwa||(zhenjiuqiwa={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var zhenjiuqiwa;(function(n){var r=27;function a(t){var e=[];var i=t.split(";");while(i.length>0){var n=i.shift();var a=n.split("-");var o=new SkillData;o.id=parseInt(a[0]);o.lv=parseInt(a[1]);e.push(o)}return e}var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay)};e.prototype.onUnDisplay=function(){n.ZhenjiuQiWaModel.getIns().off(n.EVENT_ZJQU.UPDDATA_BLOOD,this,this.onUpdateBloodHandler)};e.prototype.onDisplay=function(){this.visible=false;this.y=app.AppContainer.UI_LAYER_Y.ZHENJIU_QU_WA;n.ZhenjiuQiWaModel.getIns().on(n.EVENT_ZJQU.UPDDATA_BLOOD,this,this.onUpdateBloodHandler)};e.prototype.onUpdateBloodHandler=function(){this.visible=true;var t=n.ZhenjiuQiWaModel.getIns().bloodVO.state;var e=util.convertToChinaNum(t);this.clipshuzi.value=e;this.imgduan.x=53+e.length*79};return e}(ui.banghui.diyijieduanUI);n.DiyijieduanView=t;var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listjiangli.itemRender=grids.GridView;this.listjiangli.renderHandler=grids.GridView.CommonItemRender;this.btnzhengjiu.clickHandler=new Laya.Handler(this,this.onStartSave);this.listjineng.itemRender=xiulian.SkillGridView;this.listjineng.renderHandler=new Laya.Handler(this,this.onSkillHandler);game.HelperViewHandler.registerStr([this.btnrule,this.labeljieshao],"func86t","func164")};e.prototype.onSkillHandler=function(t,e){t.setData(t.dataSource,false,false,true)};e.prototype.onStartSave=function(){app.ProtocolRequest.DgnSaveSeventhReq()};e.prototype.onUnDisplay=function(){};e.prototype.onDisplay=function(){this.callLater(this.onRefreshHandler)};e.prototype.onRefreshHandler=function(){var t=csv.ZhenjiuQiWaProxy.getIns().saveRuleList[0];this._cfg=t;this.listjiangli.array=game.ItemUtil.parserList(t.awardshow);this.listjineng.array=a(t.skillshow);this.labelmiaoshu.text=t.des||"";var e=n.ZhenjiuQiWaModel.getIns().subTime;var i=n.ZhenjiuQiWaModel.getIns().allTime;this.labelshuzi.text=e+"/"+i;if(e<=0){this.btnzhengjiu.gray=true}else{this.btnzhengjiu.gray=false}};return e}(ui.zhengjiuqiwa.zhengjiuqiwaviewnewUI);n.Zhengjiuqiwaview=e;var l=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listdiaoluo.itemRender=grids.GridView;this.listdiaoluo.renderHandler=grids.GridView.CommonItemRender;this.listdiaoluo.array=[];this.listdata=[]};e.prototype.onUnDisplay=function(){n.ZhenjiuQiWaModel.getIns().off(n.EVENT_ZJQU.PUSH_ITEM,this,this.onGetHandler);n.ZhenjiuQiWaModel.getIns().off(n.EVENT_ZJQU.UPDDATA_BLOOD,this,this.onUpdateBloodHandler)};e.prototype.onDisplay=function(){this.x=Laya.stage.width-this.width;this.y=Laya.stage.height-this.height-chat.ChatMiniView.HEIGHT;this.listdiaoluo.array=[];this.text2.text="";n.ZhenjiuQiWaModel.getIns().on(n.EVENT_ZJQU.PUSH_ITEM,this,this.onGetHandler);n.ZhenjiuQiWaModel.getIns().on(n.EVENT_ZJQU.UPDDATA_BLOOD,this,this.onUpdateBloodHandler);this.callLater(this.onRefreshHandler)};e.prototype.onUpdateBloodHandler=function(t){this.text2.text=app.getLang("save_txt01",n.ZhenjiuQiWaModel.getIns().bloodVO.curBloodCnt)};e.prototype.onGetHandler=function(t){this.listdata.push(t);this.listdiaoluo.array=n.ZhenjiuQiWaModel.getIns().getItemList(this.listdata)};e.prototype.onRefreshHandler=function(){};e.SINGLE_KEY="zhenjiuqiwa.WodeshanghaiitemUIView";return e}(ui.bosszhandou.wodeshanghaiitemUI);n.WodeshanghaiitemUIView=l;var i=function(e){__extends(t,e);function t(){var t=e.call(this,1,1,-r,-r)||this;t.mouseEnabled=true;t.isoType=isometric.IsoType.HIT_TYPE;t.hitArea=new Laya.Rectangle(-r,-r,r*2,r*2);t.on(Laya.Event.CLICK,t,t.onMouseUp);return t}t.prototype.onMouseUp=function(){if(this.clickHandler){this.clickHandler.run()}};return t}(isometric.IsoSprite);var o=function(){function t(t){if(t===void 0){t=2}this.x1=0;this.y1=0;this.len=0;this.gap=r;this._SCALE=.85;this.indexMap={};this.len=Laya.stage.width/2/Math.sqrt(3)*this._SCALE;this.posList=[];var e=this.len/this.gap;if(e>1){e-=t}for(var i=0;i<e-1;i++){this.len=this.len-this.gap;this.drawNode()}}t.prototype.getMapCnt=function(){var t=0;for(var e in this.indexMap){t++}return t};t.prototype.getRandomPosIndex=function(){var t=this.getMapCnt();var e=Math.floor(Math.random()*this.posList.length);if(t>=this.posList.length){return e}if(this.indexMap[e]==undefined){this.indexMap[e]=e;return e}return this.getRandomPosIndex()};t.prototype.drawNode=function(){this.a=Math.sqrt(3)*this.len;this.b=1*this.len;var t=0;for(var e=0;e<360;e++){this.getXY(e);this.posList.push(new Laya.Point(this.outx,this.outy))}};t.prototype.getXY=function(t){this.outx=this.a*Math.cos(t)+this.x1;this.outy=this.b*Math.sin(t)+this.y1};return t}();n.RandomCirle=o;var s=function(e){__extends(t,e);function t(){var t=e.call(this,1,1,-r,-r)||this;t.JUMP_MS=50;t.FLY_SEC=500;t.HIGH=100;t._hitAera=new i;t._hitAera.clickHandler=new Laya.Handler(t,t.onMouseUp);scene.SceneMediator.getInstance().isoWorld.addIsoChild(t._hitAera);return t}t.prototype.setIsoPos=function(t){this.isoPos=t;this._hitAera.isoPos=t};t.prototype.setScreenPosition=function(t,e,i){this.endhandler=i;this.targetY=e;this.x=t;this.y=e-this.HIGH/2;this._hitAera.x=t;this._hitAera.y=e;Laya.Tween.to(this,{y:this.targetY-this.HIGH},this.JUMP_MS,null,new Laya.Handler(this,this.delayHandler))};t.prototype.delayHandler=function(){Laya.Tween.to(this,{y:this.targetY},this.JUMP_MS,null,this.endhandler)};t.prototype.setData=function(t){this._vo=t;var e=csv.ZhenjiuQiWaProxy.getIns().saveDungeonMap[t.boxCfgId];if(e){var i=game.ItemUtil.parserList(e.award)[0];var n=i.getIconUrl();this.loadImage(n,0,0,r*2,r*2,new Laya.Handler(this,this.onComplete))}};t.prototype.onComplete=function(){};t.prototype.onMouseUp=function(){n.ZhenjiuQiWaModel.getIns().once(n.EVENT_ZJQU.PICK_UP,this,this.onSucceedHandler);app.ProtocolRequest.SaveSeventhGetBoxReq(this._vo.boxId)};t.prototype.onSucceedHandler=function(){var t=new Laya.Point(this.x,this.y);this._hitAera.clickHandler=null;var e=this.parent.localToGlobal(t);var i=l.getIns();var n=i.parent.localToGlobal(new Laya.Point(i.x,i.y));n.x+=i.width/2;n.y-=r;var a=new Laya.Point(n.x-e.x,n.y-e.y);var o=this.x+a.x;var s=this.y+a.y;Laya.Tween.to(this,{alpha:1,x:o,y:s},this.FLY_SEC,null,new Laya.Handler(this,this.onFlyComplete))};t.prototype.onFlyComplete=function(){this._hitAera.removeSelf();this.removeSelf();n.ZhenjiuQiWaModel.getIns().event(n.EVENT_ZJQU.PUSH_ITEM,this._vo)};return t}(isometric.IsoSprite);n.ChestView=s})(zhenjiuqiwa||(zhenjiuqiwa={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var zhuanpan;(function(s){var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initCommands=function(){this.addMsgListener(app.ProtocolResponse.DialDrawResp,this,this.onDialDrawResp);this.addMsgListener(app.ProtocolResponse.DialDrawDataNtf,this,this.onDialDrawDataNtf);this.addMsgListener(app.ProtocolResponse.DialDrawAwardResp,this,this.onDialDrawAwardResp)};e.prototype.init=function(){game.WindowsResigter.registFunctionView(csv.FunctionsProxy.ENUMS.ZHUAN_PAN,s.XingyunzhuanpanView,null,game.ECommonType.COMMON_TYPE_5);app.ViewManager.regist(s.XingyunzhuanpanView,"lixianjingyan.atlas","shouchongjiangli.atlas","xingyunxunbao.atlas");main.MainUIIcon.iconClassMap[csv.MainIconProxy.TYPE_ICON_ZHUANPAN]=s.XingyunIcon};e.prototype.onDialDrawAwardResp=function(t,e){if(e.result){this.model.event(s.ZhuanPanEvent.EVENT_XIANYAO_LINGQU)}};Object.defineProperty(e.prototype,"model",{get:function(){return s.ZhuanPanModel.getIns()},enumerable:true,configurable:true});e.prototype.check=function(t){if(t){for(var e=0;e<t.drawdata.length;e++){var i=t.drawdata[e];if(!this.model.actMap[i.activityid]){this.model.actMap[i.activityid]=new s.ZhuanPanVo(i.activityid)}var n=this.model.actMap[i.activityid];n.dialdraw=i;n.checkRed()}}};e.prototype.onDialDrawResp=function(t,e){if(e.result==1){this.check(this.model.info);for(var i=0;i<e.drawdata.length;i++){var n=e.drawdata[i];var a=csv.ZhuanPanProxy.getIns().zhuanpanwupinMap[n.id];if(a.grandprize!=0){var o=util.TimeUtil.getChineseNum(a.grandprize);if(a.endgrandprize==1){manager.FlowManager.instance.flowByStyle1(app.getLang("xinshangcheng_14",o,o))}else{manager.FlowManager.instance.flowByStyle1(app.getLang("xinshangcheng_13",o))}}}this.model.event(s.ZhuanPanEvent.EVENT_LOTTERY_GET,[e])}else{this.model.isEnd=true}};e.prototype.onDialDrawDataNtf=function(t,e){this.model.info=e;this.check(e);this.model.event(s.ZhuanPanEvent.EVENT_INFO_UPDATE)};e.SINGLE_KEY="zhuanpan.ZhuanpanModule";return e}(app.ModuleBase);s.ZhuanpanModule=t})(zhuanpan||(zhuanpan={}));var zhuanpan;(function(t){var e=function(){function t(){this.cutNum=6;this.accValue=.1;this.subValue=.1;this.slow=1;this.min=1;this.start=3;this.end=3;this.delaytime=300;this.index=0;this.needPlay=1}t.prototype.getIndex=function(t){t=t%this.cutNum;var e=this.index+this.start+this.end+this.min;var i=this.index;while(1){i++;if(i>=e&&i%this.cutNum==t){break}}this.needPlay=i-e+this.min};return t}();var i=function(){function t(t){this.vo=new e;this.cur=0;this.isEnd=true;this.offset=0;this.ani1=t}t.prototype.start=function(t,e){this.end=e;if(!this.isEnd){console.log("start>>> fail");return}this.vo.getIndex(t);this.angle=360/this.vo.cutNum;this.cur=0;this.isEnd=false;this.start_rotation=this.curRotation;Laya.timer.once(1,this,this.onFrame)};Object.defineProperty(t.prototype,"curRotation",{get:function(){return this.ani1.rotation+this.offset},set:function(t){this.ani1.rotation=t-this.offset},enumerable:true,configurable:true});t.prototype.onFrame=function(){if(this.curRotation+this.vo.accValue>=this.start_rotation+this.vo.start*this.angle){this.curRotation=this.start_rotation+this.vo.start*this.angle;this.vo.index+=this.vo.start;this.start_rotation=this.curRotation;Laya.timer.once(1,this,this.onFrame2)}else{this.cur+=this.vo.accValue;this.curRotation+=this.cur;Laya.timer.once(1,this,this.onFrame)}};t.prototype.onFrame2=function(){if(this.curRotation+this.cur>this.start_rotation+this.vo.needPlay*this.angle){this.curRotation=this.start_rotation+this.vo.needPlay*this.angle;this.vo.index+=this.vo.needPlay;this.start_rotation=this.curRotation;Laya.timer.once(1,this,this.onFrame3)}else{this.curRotation+=this.cur;Laya.timer.once(1,this,this.onFrame2)}};t.prototype.onDelayEnd=function(){this.end.run()};t.prototype.onFrame3=function(){if(this.curRotation+this.cur>=this.start_rotation+this.vo.end*this.angle){this.curRotation=this.start_rotation+this.vo.end*this.angle;this.vo.index+=this.vo.end;this.vo.index=this.vo.index%this.vo.cutNum;this.isEnd=true;if(this.end){Laya.timer.once(this.vo.delaytime,this,this.onDelayEnd)}}else{this.cur-=this.vo.subValue;if(this.cur<this.vo.slow){this.cur=this.vo.slow}this.curRotation+=this.cur;Laya.timer.once(1,this,this.onFrame3)}};t.prototype.stop=function(){};return t}();t.LuckRControl=i})(zhuanpan||(zhuanpan={}));var zhuanpan;(function(e){var i=function(){function t(){this.cutNum=8;this.slowTime=3e3;this.min=4;this.start=3;this.end=20;this.index=0;this.needPlay=1}t.prototype.getIndex=function(t){t=t%this.cutNum;var e=this.index+this.start+this.end+this.min;var i=this.index;while(1){i++;if(i>=e&&i%this.cutNum==t){break}}this.needPlay=i-e+this.min};return t}();var t=function(){function t(t){this.vo=new i;this.isEnd=true;this.offset=0;this.ani1=t}t.prototype.start=function(t,e,i){if(i===void 0){i=false}this.end=e;if(!this.isEnd){return}this.vo.getIndex(t);this.angle=360/this.vo.cutNum;this.isEnd=false;this.start_rotation=this.curRotation;Laya.timer.once(1,this,this.onFrame,[i])};Object.defineProperty(t.prototype,"curRotation",{get:function(){return this.ani1.rotation+this.offset},set:function(t){this.ani1.rotation=t-this.offset},enumerable:true,configurable:true});t.prototype.onFinishHandler2=function(){this.curRotation=(this.start_rotation||0)+(this.vo.start+this.vo.needPlay+this.vo.end)*(this.angle||0);this.isEnd=true;e.ZhuanPanModel.getIns().isEnd=true};t.prototype.stop=function(){if(this.curTween){this.curTween.clear()}this.onFinishHandler2();Laya.timer.clear(this,this.onDelayEnd);this.onDelayEnd()};t.prototype.onFrame=function(t){this.vo.index+=this.vo.start+this.vo.needPlay+this.vo.end;var e=0;if(!t){e=this.vo.slowTime}this.curTween=Laya.Tween.to(this,{curRotation:this.start_rotation+(this.vo.start+this.vo.needPlay+this.vo.end)*this.angle},e,Laya.Ease.quintInOut,new Laya.Handler(this,this.onFinishHandler2));if(this.end){Laya.timer.once(this.vo.slowTime,this,this.onDelayEnd)}};t.prototype.onDelayEnd=function(){if(this.end){this.end.run();this.end=null}};return t}();e.LuckRControl2=t})(zhuanpan||(zhuanpan={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var zhuanpan;(function(t){var i;(function(t){t[t["IsLingQued"]=1]="IsLingQued";t[t["CanLingQu"]=2]="CanLingQu";t[t["Normal"]=3]="Normal"})(i=t.LingQuStatus||(t.LingQuStatus={}));var e=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.isEnd=true;t.isSkipAnim=false;t.actMap={};return t}t.getIns=function(){return app.Singleton.getInstance(t)};t.prototype.init=function(){};Object.defineProperty(t.prototype,"actmodel",{get:function(){return activitytaren.ActivityTaRenModel.getIns()},enumerable:true,configurable:true});t.prototype.parse=function(){};t.prototype.getLingQuStatus=function(t){if(t==1){return i.Normal}else if(t==2){return i.IsLingQued}return i.CanLingQu};t.prototype.getDialDrawData=function(t){if(this.info){for(var e=0;e<this.info.drawdata.length;e++){if(this.info.drawdata[e].activityid==t){return this.info.drawdata[e]}}}};t.SINGLE_KEY="zhenjiuqiwa.ZhuanPanModel";return t}(app.ModelBase);t.ZhuanPanModel=e;var n=function(){function t(){}t.EVENT_LINGQU_SUCCEED="EVENT_LINGQU_SUCCEED";t.EVENT_INFO_UPDATE="EVENT_INFO_UPDATE";t.EVENT_LOTTERY_GET="EVENT_LOTTERY_GET";t.EVENT_XIANYAO_LINGQU="EVENT_XIANYAO_LINGQU";return t}();t.ZhuanPanEvent=n})(zhuanpan||(zhuanpan={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var csv;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.init=function(){var t=app.Config.getResById("zhuanpan.csv");this.arr=t.getArray();t=app.Config.getResById("zhuanpangongshi.csv");this.zhuanpangongshiMap=t.getMap("activityid");t=app.Config.getResById("zhuanpanwupin.csv");this.zhuanpanwupinMap=t.getMap("id")};e.SINGLE_KEY="csv.ZhuanPanProxy";return e}(app.ModelBase);t.ZhuanPanProxy=e})(csv||(csv={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var zhuanpan;(function(t){var i=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.setData=function(t){var e=t.split("-");var i=parseInt(e[0]);var n=parseInt(e[1]);var a=parseInt(e[2]);var o=game.ItemUtil.createVO(i);o.setCount(n);this.itemdaoju.setData(o);this.labelgailvnum.text=Math.floor(a/100*100)/100+"%"};return e}(ui.xingyunzhuanpan.gailvgongshiitemUI);var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.getIns=function(){return app.Singleton.getInstance(e)};e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.quedingbtn.clickHandler=new Laya.Handler(this,this.onCloseHandler);this.listdaoju.itemRender=i;this.listdaoju.renderHandler=new Laya.Handler(this,this.onGailvgongItemHandler)};e.prototype.onCloseHandler=function(){app.ViewManager.toggleDialog(e,-1)};e.prototype.onGailvgongItemHandler=function(t){t.setData(t.dataSource)};e.prototype.onDisplay=function(){this.callLater(this.onCallLater)};e.prototype.onUnDisplay=function(){};e.prototype.onCallLater=function(){this.gongshiReward=this.dataSource[0];this.listdaoju.array=this.gongshiReward};e.SINGLE_KEY="zhuanpan.Gailvgongshitip";return e}(ui.xingyunzhuanpan.gailvgongshitipUI);t.Gailvgongshitip=e})(zhuanpan||(zhuanpan={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var zhuanpan;(function(t){var e=function(n){__extends(t,n);function t(t,e){if(e===void 0){e=main.IconListBase.SIZE}var i=n.call(this,t,e)||this;i.setTimeLabel();i.timeView=new activitytaren.ActivityTimeView(i.lblTime,null,undefined,undefined,activitytaren.ActivityTimeView.TYPE_LIMIT_DAY);return i}t.prototype.onClick=function(t){n.prototype.onClick.call(this,t)};t.prototype.onDisplay=function(){n.prototype.onDisplay.call(this);var t=activitytaren.ActivityTaRenModel.getIns().getActivityID_By_functionid(csv.FunctionsProxy.ENUMS.ZHUAN_PAN);if(t){if(t.timeVo.allTime>=365*util.TimeUtil.secOneDay){this.timeView.stop()}else{this.timeView.start(t.timeVo.endTime)}}};t.prototype.onUndisplay=function(){n.prototype.onUndisplay.call(this);if(this.timeView){this.timeView.stop()}};return t}(main.MainUIIcon);t.XingyunIcon=e})(zhuanpan||(zhuanpan={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var zhuanpan;(function(o){var i=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.animationzhuanhua.stop();this.animationzhuanhua.visible=false;this.animationhuode.stop();this.animationhuode.visible=false};e.prototype.setData=function(t){var e=csv.ZhuanPanProxy.getIns().zhuanpanwupinMap[t.id];var i=e.item.split("-");var n=game.ItemUtil.createVO(parseInt(i[0]));if(n.itemCfg.type==csv.ItemProxy.TYPES.FA_BAO&&t.flag==1){var a=n.itemCfg.p4.split("-");n=game.ItemUtil.createVO(parseInt(a[0]));n.setCount(parseInt(a[1]))}else{n.setCount(parseInt(i[1]))}this.itemdaoju.setData(n)};return e}(ui.xingyunzhuanpan.gongxihuodeitemUI);o.Gongxihuodeitem=i;var t=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.listdaoju.itemRender=i;this.listdaoju.renderHandler=new Laya.Handler(this,this.onRenderHander);this.btnqueding.clickHandler=new Laya.Handler(this,this.onCloseHandler);this.btnshici.clickHandler=new Laya.Handler(this,this.onTackOut)};e.prototype.onTackOut=function(){this.vo.action(this.rewardResult.drawdata.length)};e.prototype.onCloseHandler=function(){app.ViewManager.toggleDialog(o.XingyunrewardView,-1,0)};e.prototype.onRenderHander=function(t){t.setData(t.dataSource)};Object.defineProperty(e.prototype,"model",{get:function(){return o.ZhuanPanModel.getIns()},enumerable:true,configurable:true});e.prototype.onDisplay=function(){guide.GuideModel.getIns().boOpen=false;this.model.on(o.ZhuanPanEvent.EVENT_LOTTERY_GET,this,this.onLotteryHadnler);this.animation01.play();this.animation02.play();this.callLater(this.onCalllater)};e.prototype.onLotteryHadnler=function(t){this.dataSource[0]=t;this.onCalllater()};e.prototype.onCalllater=function(){this.rewardResult=this.dataSource[0];this.vo=this.model.actMap[this.rewardResult.activityid];var t=this.vo.cfg;var e="";if(this.rewardResult.drawdata.length==1){this.itemhuode.visible=true;this.listdaoju.visible=false;this.itemhuode.setData(this.rewardResult.drawdata[0]);e=t.p3}else{this.itemhuode.visible=false;this.listdaoju.visible=true;this.listdaoju.array=this.rewardResult.drawdata;e=t.p4}this.btnshici.label=app.getLang("xingyun03",this.rewardResult.drawdata.length);var i=e.split("-");var n=parseInt(i[0]);var a=parseInt(i[1]);this.itemmoney.parserIcon(e);this.labelmoney.text=a.toString();if(game.GridsModel.getIns().getItemCount(n)>=a){this.labelmoney.color=game.STYLES.GREEN_COLOR_S}else{this.labelmoney.color=game.STYLES.RED_COLOR_S}};e.prototype.onUnDisplay=function(){guide.GuideModel.getIns().boOpen=true;this.model.off(o.ZhuanPanEvent.EVENT_LOTTERY_GET,this,this.onLotteryHadnler);this.animation01.stop();this.animation02.stop();var t=this.rewardResult;for(var e=0;e<t.drawdata.length;e++){var i=t.drawdata[e];var n=csv.ZhuanPanProxy.getIns().zhuanpanwupinMap[i.id];if(n.grandprize!=0&&n.endgrandprize!=1){if(app.ViewManager.DisplayedInStage(o.XingyunzhuanpanView.SINGLE_KEY)){var a=o.XingyunzhuanpanView.getIns();a.rewardList[n.grid].playAnim()}}}};return e}(ui.xingyunzhuanpan.gongxihuodetipUI);o.XingyunrewardView=t})(zhuanpan||(zhuanpan={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var zhuanpan;(function(t){var e=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.animationzoumadeng.stop();this.animationzoumadeng.visible=false};e.prototype.onUnDisplay=function(){this.animStop()};e.prototype.animStop=function(){this.animationsaoguang.stop();this.animationsaoguang.visible=false};e.prototype.onComplete=function(){this.animStop()};e.prototype.playAnim=function(){this.animationsaoguang.visible=true;this.animationsaoguang.on(Laya.Event.COMPLETE,this,this.onComplete);this.animationsaoguang.play()};e.prototype.onDisplay=function(){};e.prototype.clear=function(){this.imgyihuode.visible=false;this.ywseleced.visible=false};e.prototype.setData=function(t){var e=t.getItem().split("-");var i=game.ItemUtil.createVO(parseInt(e[0]));i.setCount(parseInt(e[1]));this.clear();this.itemdaoju.setData(i);this.imgxingyundajiang.visible=i.itemCfg.type==csv.ItemProxy.TYPES.FA_BAO};e.prototype.setAni=function(t){};return e}(ui.xingyunzhuanpan.xingyunzhuanpanitem02UI);t.Xingyunzhuanpanitem02View=e})(zhuanpan||(zhuanpan={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(e.hasOwnProperty(i))t[i]=e[i]};return function(t,e){n(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}();var zhuanpan;(function(a){var t=function(e){__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.fullScreen="fullScreen";t.isfirstTime=true;t.animTime=100;return t}t.getIns=function(){return app.Singleton.getInstance(t)};Object.defineProperty(t.prototype,"model",{get:function(){return a.ZhuanPanModel.getIns()},enumerable:true,configurable:true});t.prototype.initialize=function(){e.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.checkboxtiaoguo.clickHandler=new Laya.Handler(this,this.checkboxtiaoguoClick);this.control=new a.XinyunZhuanSecListControl(this.listxingyunzhi,this.btnleft,this.btnright);game.HelperViewHandler.register(csv.FunctionsProxy.ENUMS.ZHUAN_PAN,[this.btnshuoming]);this.timeView=new activitytaren.ActivityTimeView(this.labeldaojishi,null,"{0}",null,activitytaren.ActivityTimeView.TYPE_LIMIT_DAY);this.btnqianwang.clickHandler=new Laya.Handler(this,this.onQianWang);this.btnchoujiang01.clickHandler=new Laya.Handler(this,this.onChouKaHandler);this.btnchoujiang02.clickHandler=new Laya.Handler(this,this.onTenHandler);this.boxbannerY=this.boxbanner.y;this.rewardList=[];this.rewardList.push(this.itemdaoju01);this.rewardList.push(this.itemdaoju02);this.rewardList.push(this.itemdaoju03);this.rewardList.push(this.itemdaoju04);this.rewardList.push(this.itemdaoju05);this.rewardList.push(this.itemdaoju06);this.rewardList.push(this.itemdaoju07);this.rewardList.push(this.itemdaoju08);this.animList=[];this.animList.push(this.animationdengzhu01);this.animList.push(this.animationdengzhu02);this.animList.push(this.animationdengzhu03);this.animList.push(this.animationdengzhu04);this.animList.push(this.animationdengzhu05);this.animList.push(this.animationdengzhu06);this.animList.push(this.animationdengzhu07);this.animList.push(this.animationdengzhu08);this.c=new a.LuckRControl2(this.imgjiantou);this.c.start(this.animList.length-1,null,true);this.labelgailvgongshi.on(Laya.Event.CLICK,this,this.onYuLangHander);this.btngailvgongshi.clickHandler=new Laya.Handler(this,this.onQianWangHuoDong);this.imgmoney01.on(Laya.Event.CLICK,this,this.onTipShow,[game.MoneyModel.MONEY_ENUM.SILVER]);this.labelmoney03.on(Laya.Event.CLICK,this,this.onTipShow,[game.MoneyModel.MONEY_ENUM.SILVER]);this.imgmoney02.on(Laya.Event.CLICK,this,this.onTipShow,[game.MoneyModel.MONEY_ENUM.GOLD]);this.labelmoney04.on(Laya.Event.CLICK,this,this.onTipShow,[game.MoneyModel.MONEY_ENUM.GOLD]);guide.GuideModel.getIns().register(csv.GuideProxy.ENUM_VIEW.ZHUANPAN_FIRST,this,this.getGuideItemBtn,200);guide.GuideModel.getIns().register(csv.GuideProxy.ENUM_VIEW.ZHUANPAN_ONCE,this.btnchoujiang01)};t.prototype.getGuideItemBtn=function(){return this.listxingyunzhi.getCell(0)};t.prototype.onQianWangHuoDong=function(){if(this.skipVo){game.ClosureManager.callFunction(this.skipVo.funid)}};t.prototype.getActVo=function(){var t=csv.SubjectProxy.getIns().ejectActIds;for(var e=0;e<t.length;e++){var i=t[e];var n=activitytaren.ActivityTaRenModel.getIns().iconMan.getActVoByActid(i);if(n){return n}}};t.prototype.huoDongIcon=function(){var t=false;if(this.skipVo){if(this.skipVo){this.timeView.start(this.skipVo.timeVo.endTime);this.btngailvgongshi.visible=true;t=true}}if(!t){this.timeView.stop();this.btngailvgongshi.visible=false}};t.prototype.onTipShow=function(t){var e;if(game.MoneyModel.MONEY_ENUM.GOLD==t){shop.ShopModel.getIns().moneyTips()}else if(game.MoneyModel.MONEY_ENUM.SILVER==t){e=game.ItemUtil.createVO(game.ItemUtil.ENUMS.TONGBI)}if(e){tip.TipManager.show(e,true)}};t.prototype.randomPlayAnim=function(){for(var t=0;t<this.animList.length;t++){var e=true;if(Math.random()<.5){e=false}var i=this.animList[t];if(e){i.visible=true;i.animationfaguang.play(0,true)}else{i.visible=false;i.animationfaguang.stop()}}if(this.isPlaying){Laya.timer.once(this.animTime,this,this.randomPlayAnim)}};t.prototype.onYuLangHander=function(){app.ViewManager.toggleDialog(a.Gailvgongshitip,1,0,[this.zpVo.gongshiReward])};t.prototype.rewardListClear=function(){for(var t=0;t<this.rewardList.length;t++){this.rewardList[t].setAni(false)}};t.prototype.chouka=function(t){if(this.c.isEnd){this.model.isEnd=false;this.rewardListClear();this.zpVo.action(t)}else{manager.FlowManager.instance.flowByStyle1(app.getLang("xingyun08"))}};t.prototype.onTenHandler=function(){this.chouka(10)};t.prototype.onChouKaHandler=function(){this.chouka(1)};t.prototype.onLinkHandler=function(){game.ClosureManager.callFunction(csv.FunctionsProxy.ENUMS.SEVEN_DAY)};t.prototype.onQianWang=function(){app.ViewManager.toggleDialog(guaji.GuajiPassView,1,1)};t.prototype.checkboxtiaoguoClick=function(){this.model.isSkipAnim=this.checkboxtiaoguo.selected};t.prototype.onTimeEnd=function(){this.labeltime.text=""};t.prototype.onDisplay=function(){game.Context.event(game.ContextEvent.FUNCTION_OPEN);game.MoneyModel.getIns().on(game.MoneyModel.EVENTS.MONEY_CHANGE,this,this.onMoneyChange);this.updateMoneyLayout();this.model.on(a.ZhuanPanEvent.EVENT_LINGQU_SUCCEED,this,this.onLingquSucceed);this.model.on(a.ZhuanPanEvent.EVENT_LOTTERY_GET,this,this.onLotteryGet);this.model.on(a.ZhuanPanEvent.EVENT_INFO_UPDATE,this,this.onRefreshHandler);this.on(Laya.Event.RESIZE,this,this.onResize);this.animationfaguang01.play(0,true);this.animationfaguang02.play(0,true);this.animationfaguang03.play(0,true);this.animationfaguang04.play(0,true);this.stopAnim();this.callLater(this.onCallLater)};t.prototype.onResize=function(){if(!this._bottomY){this._bottomY=this.height-this.boxbtn.y}var t=Laya.stage.height-ScreenAdapter.OFFSET_BOTTOM-ScreenAdapter.OFFSET_Y;this.height=t;this.imgbg.width=Laya.stage.width;this.imgbg.height=Laya.stage.height;this.x=(Laya.stage.width-this.width)/2;if(!this.isSetImgXY){this.isSetImgXY=true;var e=this.imgbg.parent.localToGlobal(new Laya.Point(this.imgbg.x,this.imgbg.y));this.imgbg.x=-e.x;this.imgbg.y=-e.y}this.boxbanner.y=this.boxbannerY+ScreenAdapter.OFFSET_Y;this.hitArea=new Laya.Rectangle(-this.x,-this.y,Laya.stage.width,Laya.stage.height);this.boxbtn.y=Laya.stage.height-this._bottomY-ScreenAdapter.OFFSET_BOTTOM};t.prototype.onAnimPlayEnd=function(t){var e=csv.ZhuanPanProxy.getIns().zhuanpanwupinMap[t.drawdata[0].id];this.rewardListClear();this.rewardList[e.grid].setAni(true);app.ViewManager.toggleDialog(a.XingyunrewardView,1,0,[t]);this.imgjiantou.animationdengzhu.visible=false;this.imgjiantou.animationdengzhu.animationfaguang.stop();this.stopAnim()};t.prototype.onLotteryGet=function(t){if(this.model.isSkipAnim){this.onAnimPlayEnd(t)}else{var e=csv.ZhuanPanProxy.getIns().zhuanpanwupinMap[t.drawdata[0].id];this.imgjiantou.animationdengzhu.visible=true;this.imgjiantou.animationdengzhu.animationfaguang.play(0,true);this.isPlaying=true;Laya.timer.once(this.animTime,this,this.randomPlayAnim);this.c.start(e.grid,new Laya.Handler(this,this.onAnimPlayEnd,[t]))}};t.prototype.onLingquSucceed=function(){this.onRefreshHandler()};t.prototype.onCallLater=function(){this.onResize();this.onRefreshHandler();this.control.refreshList()};t.prototype.onRefreshHandler=function(){this.zpVo=this.model.actMap[this.actVo.actid];this.control.fullData(this.zpVo);this.skipVo=this.getActVo();if(this.zpVo.isFinishAllPass()){this.labeltongguan.text=app.getLang("xingyun05")}else{this.labeltongguan.text=app.getLang("xingyun10",this.zpVo.everyCnt)}for(var t=0;t<this.rewardList.length;t++){this.rewardList[t].setData(this.zpVo.rewads[t])}if(this.tween){this.tween.clear()}if(this.isfirstTime){this.isfirstTime=false;this.curLuckValue=this.zpVo.dialdraw.luck}else{this.tween=Laya.Tween.to(this,{curLuckValue:this.zpVo.dialdraw.luck},1e3)}this.setCoin(this.itemmoney01,this.labelmoney01,this.zpVo.cfg.p3);this.setCoin(this.itemmoney02,this.labelmoney02,this.zpVo.cfg.p4);if(this.zpVo.ishasRed(1)){game.RedDotView.addTo(this.btnchoujiang01)}else{game.RedDotView.removeFrom(this.btnchoujiang01)}if(this.zpVo.ishasRed(10)){game.RedDotView.addTo(this.btnchoujiang02)}else{game.RedDotView.removeFrom(this.btnchoujiang02)}this.huoDongIcon()};Object.defineProperty(t.prototype,"curLuckValue",{get:function(){return parseInt(this.labelxingyunzhinum.text)},set:function(t){this.labelxingyunzhinum.text=Math.floor(t).toString()},enumerable:true,configurable:true});t.prototype.setCoin=function(t,e,i){t.parserIcon(i);var n=i.split("-");var a=parseInt(n[0]);var o=parseInt(n[1]);var s=game.GridsModel.getIns().getItemCount(a);if(s<o){e.color=game.STYLES.RED_COLOR_S}else{e.color=game.STYLES.GREEN_COLOR_S}e.text=game.GridsModel.getIns().getItemCount(a)+"/"+o;t.on(Laya.Event.CLICK,this,this.onTipClick,[a])};t.prototype.onTipClick=function(t){tip.TipManager.show(game.ItemUtil.createVO(t))};t.prototype.onMoneyChange=function(t){if(t==game.MoneyModel.MONEY_ENUM.GOLD||t==game.MoneyModel.MONEY_ENUM.SILVER){this.callLater(this.updateMoneyLayout)}};t.prototype.updateMoneyLayout=function(){this.labelmoney03.text=game.MoneyModel.format(game.MoneyModel.getIns().getMoney(game.MoneyModel.MONEY_ENUM.SILVER));this.labelmoney04.text=game.MoneyModel.format(game.MoneyModel.getIns().getMoney(game.MoneyModel.MONEY_ENUM.GOLD))};t.prototype.onUnDisplay=function(){game.Context.event(game.ContextEvent.FUNCTION_CLOSE);this.timeView.stop();this.isfirstTime=true;this.animationfaguang01.stop();this.animationfaguang02.stop();this.animationfaguang03.stop();this.animationfaguang04.stop();this.off(Laya.Event.RESIZE,this,this.onResize);this.model.off(a.ZhuanPanEvent.EVENT_LOTTERY_GET,this,this.onLotteryGet);this.model.off(a.ZhuanPanEvent.EVENT_LINGQU_SUCCEED,this,this.onLingquSucceed);this.model.off(a.ZhuanPanEvent.EVENT_INFO_UPDATE,this,this.onRefreshHandler);game.MoneyModel.getIns().off(game.MoneyModel.EVENTS.MONEY_CHANGE,this,this.onMoneyChange);if(this.tween){this.tween.clear()}this.c.stop();this.stopAnim();this.model.isEnd=true};t.prototype.stopAnim=function(){Laya.timer.clear(this,this.randomPlayAnim);this.isPlaying=false;for(var t=0;t<this.animList.length;t++){var e=this.animList[t];e.visible=false}};t.SINGLE_KEY="zhuanpan.XingyunzhuanpanView";return t}(ui.xingyunzhuanpan.xingyunzhuanpanviewUI);a.XingyunzhuanpanView=t;var e=function(){function t(){}return t}();a.XingyunCfgVo=e;var i=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.initialize=function(){t.prototype.initialize.call(this);this.on(Laya.Event.DISPLAY,this,this.onDisplay);this.on(Laya.Event.UNDISPLAY,this,this.onUnDisplay);this.on(Laya.Event.CLICK,this,this.onLingQuClick)};e.prototype.onLingQuClick=function(){switch(this.status){case a.LingQuStatus.Normal:var t=game.ItemUtil.createVO(this.zpvo.rewardItemId);t.setCount(this.zpvo.rewardCnt);tip.TipManager.show(t);break;case a.LingQuStatus.IsLingQued:break;case a.LingQuStatus.CanLingQu:app.ProtocolRequest.DialDrawAwardReq(this.zpvo.actid,this.guanqiaId);break}};e.prototype.onDisplay=function(){};e.prototype.onUnDisplay=function(){};e.prototype.clear=function(){this.animationlingqu.stop();this.animationlingqu.visible=false;this.imgyilingqu.visible=false};e.prototype.convertLabel=function(){var t=this.guanqiaId;var e=csv.GuajiProxy.getIns().getCfgGuanqia(t);if(e){var i=csv.GuajiProxy.getIns().getPart(e.id);return e.chapter+"-"+i.index}else{}return""};e.prototype.setData=function(t,e){this.zpvo=t;this.guanqiaId=e;var i=t.getLingQuStatusGuanKa(e);this.status=i;this.clear();this.labelnum.text=this.convertLabel();this.imgdaoju.skin=csv.ItemProxy.getUrl(t.rewardItemId);if(t.rewardCnt>1){this.cntl.text=t.rewardCnt.toString()}else{this.cntl.text=""}var n=false;switch(i){case a.LingQuStatus.Normal:break;case a.LingQuStatus.IsLingQued:this.imgyilingqu.visible=true;break;case a.LingQuStatus.CanLingQu:this.animationlingqu.visible=true;this.animationlingqu.play();n=true;break}if(n){game.RedDotView.addTo(this)}else{game.RedDotView.removeFrom(this)}};return e}(ui.xingyunzhuanpan.xingyunzhuanpanitem01UI);a.Xingyunzhuanpanitem01View=i})(zhuanpan||(zhuanpan={}));var zhuanpan;(function(s){var t=function(){function t(t,e,i){this.list=t;this.list.scrollRectOffX=10;this.list.scrollRectOffY=10;e.visible=i.visible=false;t.itemRender=s.Xingyunzhuanpanitem01View;t.renderHandler=new Laya.Handler(this,this.onRenderHandler);t.hScrollBarSkin=null}t.prototype.onRenderHandler=function(t){t.setData(this.vo,t.dataSource)};t.prototype.fullData=function(t){this.vo=t;this.refreshList()};t.prototype.refreshList=function(){var t=this.scrollToCanLingQu();if(t>=this.vo.dataList.length-this.vo.everyCnt){t=this.vo.dataList.length-this.vo.everyCnt}var e=[];for(var i=0;i<this.vo.everyCnt;i++){e.push(this.vo.dataList[t+i].id)}this.list.array=e};t.prototype.scrollToCanLingQu=function(){var t=this.vo.dataList;for(var e=0;e<t.length;e++){var i=t[e].id;if(this.vo.getLingQuStatusGuanKa(i)==s.LingQuStatus.CanLingQu){var n=e-1;if(e-1<0){n=0}return n}}var a=0;for(var e=0;e<t.length;e++){var i=t[e].id;if(this.vo.getLingQuStatusGuanKa(i)==s.LingQuStatus.IsLingQued){if(e<t.length-1){var o=this.vo.getLingQuStatusGuanKa(t[e+1].id);if(o==s.LingQuStatus.Normal){a=e;break}}}}return a};return t}();s.XinyunZhuanSecListControl=t})(zhuanpan||(zhuanpan={}));var zhuanpan;(function(u){var t=function(){function t(t){this.everyCnt=0;this.delayTime=1;this.actid=t;var e=csv.ActivityTarenProxy.getIns().activityidMap[this.actid];var i=e[0];this.cfg=i;var n=i.p1.split("-");this.everyCnt=parseInt(n[0]);this.rewardItemId=parseInt(n[1]);this.rewardCnt=parseInt(n[2]);for(var a=0;a<csv.ZhuanPanProxy.getIns().arr.length;a++){if(csv.ZhuanPanProxy.getIns().arr[a].activityid==this.actid){this.zhuanPanCfg=csv.ZhuanPanProxy.getIns().arr[a];break}}this.parse(this.zhuanPanCfg.reward);var o=csv.ZhuanPanProxy.getIns().zhuanpangongshiMap[t];this.gongshiReward=o.reward.split(";");game.GridsModel.getIns().on(game.GridsModel.EVENTS.UPDATE,this,this.setRed);activitytaren.ActivityTaRenModel.getIns().on(activitytaren.ActivityIconStatuManager.EVENT_ACRIVITY_SINGLE_VISIBLE,this,this.onShowHide);this.initDataList()}t.prototype.initDataList=function(){this.dataList=[];for(var t=0;t<csv.GuajiProxy.getIns().guanqiaList.length;t++){var e=csv.GuajiProxy.getIns().guanqiaList[t];if(e.id%this.everyCnt==0){this.dataList.push(e)}}};t.prototype.onShowHide=function(t){if(t.actId==this.actid&&!t.visible){this.clear()}};t.prototype.setRed=function(){this.checkRed()};t.prototype.clear=function(){game.GridsModel.getIns().off(game.GridsModel.EVENTS.UPDATE,this,this.setRed);activitytaren.ActivityTaRenModel.getIns().off(activitytaren.ActivityIconStatuManager.EVENT_ACRIVITY_SINGLE_VISIBLE,this,this.onShowHide)};t.prototype.isFinishAllPass=function(){return false};t.prototype.getSubGuankaId=function(){return this.everyCnt-(guaji.GuajiModel.getIns().passId-1)%this.everyCnt};t.prototype.onOk=function(t,e){if(e){shop.ShopModel.getIns().askChongZhi()}else{app.ProtocolRequest.DialDrawReq(this.actid,t);if(app.ViewManager.DisplayedInStage(u.XingyunzhuanpanView.SINGLE_KEY)){app.ViewManager.toggleDialog(u.XingyunrewardView,-1)}}};t.prototype.action=function(t){if(this.curTime){if(game.Context.getServerTime()-this.curTime<this.delayTime){u.ZhuanPanModel.getIns().isEnd=true;return}}this.curTime=game.Context.getServerTime();var e="";if(t==1){e=this.cfg.p3}else{e=this.cfg.p4}var i=parseInt(e.split("-")[0]);var n=game.GridsModel.getIns().getItemCount(i);var a=parseInt(e.split("-")[1]);var o=n-a;if(o>=0){this.onOk(t,false)}else{o=Math.abs(o);if(this.goldCnt!=0&&this.dialdraw.buynum+o>this.goldCnt){manager.FlowManager.instance.flowByStyle1(app.getLang("xingyun04"))}else{var s=csv.ItemProxy.getIns().itemCfgMap[i];var r=s.p4.split("-");var l=parseInt(r[1]);var h=game.GridsModel.getIns().getItemCount(parseInt(r[0]));var p=false;if(h<l*o){p=true}if(!game.SystemSetModel.getInstance().funIds[csv.FunctionsProxy.ENUMS.ZHUAN_PAN]){game.Alert.show(app.getLang("xingyun06",l*o,o),new Laya.Handler(this,this.onOk,[t,p]),null,0,"","","center","center",csv.FunctionsProxy.ENUMS.ZHUAN_PAN)}else{this.onOk(t,p)}}}};t.prototype.ishasRed=function(t){if(t==1){return false}var e="";if(t==1){e=this.cfg.p3}else{e=this.cfg.p4}if(game.GridsModel.getIns().hasEnoughItems(e)){return true}return false};t.prototype.hasLingqu=function(){for(var t=0;t<this.dataList.length;t++){if(this.getLingQuStatusGuanKa(this.dataList[t].id)==u.LingQuStatus.CanLingQu){return true}}return false};t.prototype.hasRed=function(){return this.ishasRed(1)||this.ishasRed(10)||this.hasLingqu()};t.prototype.checkRed=function(){var t=[];var e=new ActivityRedStatus;e.actId=this.actid;e.status=this.hasRed()?1:0;t.push(e);activitytaren.ActivityTaRenModel.getIns().redRefresh(t)};Object.defineProperty(t.prototype,"goldCnt",{get:function(){if(this.cfg.p2==""){return 0}return parseInt(this.cfg.p2)},enumerable:true,configurable:true});t.prototype.parse=function(t){this.rewads=[];var e=t.split(";");for(var i=0;i<e.length;i++){var n=e[i].split("-");var a=new o(this);a.index=i;a.pos=parseInt(n[0]);a.weight=parseInt(n[1]);this.rewads.push(a)}};t.prototype.getLingQuStatusGuanKa=function(t){if(this.dialdraw){var e=this.dialdraw.reward;if(e.indexOf(t)!=-1){return u.LingQuStatus.IsLingQued}if(t<guaji.GuajiModel.getIns().passId){return u.LingQuStatus.CanLingQu}}return u.LingQuStatus.Normal};t.prototype.getIsLingQuIds=function(){var t=[];if(this.dialdraw){t=this.dialdraw.reward||[];t.sort(function(t,e){return t-e})}return t};return t}();u.ZhuanPanVo=t;var o=function(){function t(t){this.zp=t}t.prototype.getItem=function(){var t=this.zp.dialdraw.openid[this.index];var e=csv.ZhuanPanProxy.getIns().zhuanpanwupinMap[t];return e.item};return t}();u.ZhuanPanRewardVo=o})(zhuanpan||(zhuanpan={}));Laya.Texture.prototype.getPixels=function(t,e,i,n){if(Laya.Render.isConchApp){var a=this.bitmap;if(a.source&&a.source.getImageData){var o=a.source.getImageData(t,e,i,n);if(o){var s=new Uint8Array(o);return Array["from"](s)}}return null}else if(Laya.Render.isWebGL){return Laya.RunDriver.getTexturePixels(this,t,e,i,n)}else{Laya.Browser.canvas.size(i,n);Laya.Browser.canvas.clear();Laya.Browser.context.drawTexture(this,-t,-e,this.width,this.height,0,0);var r=Laya.Browser.context.getImageData(0,0,i,n)}return r.data};var ent;(function(t){var a=app.Singleton;var e=Laya.Loader;var i=app.DasParser;var n=function(){function n(){game.Context.initHtmlParam();ScreenAdapter.init();i.init();Csv.init();LayaConfig.init();this.checkLogin()}n.prototype.checkLogin=function(){if(window["appConfig"]&&window["appConfig"]["pf"]==gamesdk.UrlCfg.PF.TOMATO){if(window["TL"]){window["getLoginInfo"]=function(t,e,i){if(!i){i=Math.floor((new Date).getTime())}var n={};n.userid=t;n.token=e;n.time=Math.floor(i/1e3);if(app.SDK){app.SDK.onLoginSuc(n)}};window["logoutStatus"]=function(){app.SDK.logout()};this.startGame()}else{Laya.timer.once(200,this,this.checkLogin)}}else if(window["appConfig"]&&window["appConfig"]["pf"]==gamesdk.UrlCfg.PF.WXMINI){console.log("gamesdk.UrlCfg.PF.WXMINI....................");if(window["GameWXmini"]){console.log("GameWXministartGame....................");this.startGame()}else{Laya.timer.once(200,this,this.checkLogin)}}else{this.startGame()}};n.prototype.startGame=function(){gamesdk.UrlCfg.init();LayaConfig.overrideClass();ScreenAdapter.initPrevAdapter();if(window["appConfig"]&&window["appConfig"]["wcfg_url"]){app.Http.request(window["appConfig"]["wcfg_url"],this,this.onWCFGResponse,undefined,"post","json",1)}else{this.init()}};n.prototype.onWCFGResponse=function(t){var e={};if(t.ret==1){e=t.map||{}}else{}game.Context.webCfg=e;this.init()};n.prototype.init=function(){if(window["appConfig"]&&window["appConfig"]["wenjuan"]){game.Context.webCfg.wenjuan=window["appConfig"]["wenjuan"]}if(window["appConfig"]&&window["appConfig"]["ver"]){app.Http.request(window["appConfig"]["ver_url"],this,this.verUrlHandler,undefined,"post","json",1)}else{this.enter()}};n.prototype.verUrlHandler=function(t){if(typeof t=="string"){t=JSON.parse(t)}if(t.ret==1){var e=window["appConfig"]["base_url_type"];if(e==undefined||e!=undefined&&Number(e)==0){if(t.version<window["appConfig"]["ver"]){game.Context.isTishen=true;Laya.URL.basePath=Laya.URL.basePath.replace("/assets/","ts/assets/");console.log("切换到提审服:"+Laya.URL.basePath)}}else if(e!=undefined&&Number(e)==1){}else if(e!=undefined&&Number(e)==2){Laya.URL.basePath=Laya.URL.basePath.replace("/assets/","ts/assets/");console.log("切换到提审服:"+Laya.URL.basePath)}}this.enter()};n.prototype.enter=function(){var t;t=Laya.URL.basePath+"manifest.json?"+Math.random();Laya.ResourceVersion.enable(t,Laya.Handler.create(this,this.onManifestComplete),1);app.SoundManager.getIns().onClickBtnSound();game.Context.createVersion(1)};n.prototype.onManifestComplete=function(){if(game.Context.useZip){app.Config.initZipCfg([game.Context.use_xbin?"res/config/login_xbin.das":"res/config/login.das"],this,this.loadLoginCsvs)}else{Laya.loader.load([{url:"res/atlas/ui.json",type:e.JSON}],Laya.Handler.create(this,this.onUIComplete))}};n.prototype.onUIComplete=function(){var t=Laya.Loader.getRes("res/atlas/prepose_ui.json");var e=Laya.Loader.getRes("res/atlas/ui.json");Laya.View.uiMap=e?e:t;app.Config.init(this,this.onConfigInit)};n.prototype.onInitResComplete=function(){manager.LoadingManager.instance.removeGameLoading("onInitResComplete");var t=app.Config.getResById("lang.json");try{if(t){Laya.Text.langPacks=JSON.parse(t)}}catch(t){game.Alert.show("<span color='#ff0000'>请检查lang.json</span>")}util.TimeUtil.initLang();app.Protocol.init();var e=a.getInstance(game.LoginModuleManager);e.init();e.startup();app.Version.ResVersion=Laya.ResourceVersion.manifest["version"];var i=new Laya.Label;i.text="装";i.font="functiontitle";app.SDK.login();Laya.SoundManager.setMusicVolume(0);this.currV=0;Laya.timer.frameLoop(5,this,this.loopBgmVolume,[.01]);Laya.SoundManager.playMusic("res/sound/create_music."+n.soundSuffix,0)};n.prototype.loopBgmVolume=function(t){this.currV+=t;if(this.currV>1){Laya.SoundManager.setMusicVolume(1);Laya.timer.clear(this,this.loopBgmVolume)}else{Laya.SoundManager.setMusicVolume(this.currV)}};n.prototype.onInitResProgress=function(t){manager.LoadingManager.instance.updateGameLoading(t)};n.prototype.onConfigInit=function(){if(app.Config.LoginArr.length){manager.LoadingManager.instance.showGameLoading("onConfigInit");Laya.loader.load(app.Config.LoginArr,Laya.Handler.create(this,this.onInitResComplete),Laya.Handler.create(this,this.onInitResProgress,null,false))}else{this.onInitResComplete()}};n.prototype.loadLoginCsvs=function(){this.onUIComplete()};Object.defineProperty(n,"soundSuffix",{get:function(){if(window["appConfig"]&&window["appConfig"]["disableSound"]===true){return""}if(window["tr"]&&window["tr"].platform=="android"){return"ogg"}return"mp3"},enumerable:true,configurable:true});return n}();t.Entry=n})(ent||(ent={}));window["onload"]=function(t){app.isPc=!(window.navigator.userAgent.toLowerCase().indexOf("mobile")>-1);if(window["tr"]&&window["tr"].platform=="android"){app.isPc=false}app.Singleton.getInstance(ent.Entry);if(t=="main.min"){}else if(t=="main2.min"){manager.LoadingManager.instance.removeGameLoading("main2.min");login.LoginModel.getIns().subPackageEnd()}};if(window["xhhdJavascript"]){window["onVerifyResult"]=function(t,e,i){console.log("onVerifyResult:",t,e,i);var n={};n.userid=t;n.token=e;n.time=Math.floor(i/1e3);console.log("app.SDK:",app.SDK);if(app.SDK){app.SDK.onLoginSuc(n)}return 1};window["switchAccountSuccess"]=function(){console.log("switchAccountSuccess...");app.SDK.logout()}}